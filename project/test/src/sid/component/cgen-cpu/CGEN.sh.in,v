head	1.7;
access;
symbols
	sid-snapshot-20180601:1.7
	sid-snapshot-20180501:1.7
	sid-snapshot-20180401:1.7
	sid-snapshot-20180301:1.7
	sid-snapshot-20180201:1.7
	sid-snapshot-20180101:1.7
	sid-snapshot-20171201:1.7
	sid-snapshot-20171101:1.7
	sid-snapshot-20171001:1.7
	sid-snapshot-20170901:1.7
	sid-snapshot-20170801:1.7
	sid-snapshot-20170701:1.7
	sid-snapshot-20170601:1.7
	sid-snapshot-20170501:1.7
	sid-snapshot-20170401:1.7
	sid-snapshot-20170301:1.7
	sid-snapshot-20170201:1.7
	sid-snapshot-20170101:1.7
	sid-snapshot-20161201:1.7
	sid-snapshot-20161101:1.7
	sid-snapshot-20160901:1.7
	sid-snapshot-20160801:1.7
	sid-snapshot-20160701:1.7
	sid-snapshot-20160601:1.7
	sid-snapshot-20160501:1.7
	sid-snapshot-20160401:1.7
	sid-snapshot-20160301:1.7
	sid-snapshot-20160201:1.7
	sid-snapshot-20160101:1.7
	sid-snapshot-20151201:1.7
	sid-snapshot-20151101:1.7
	sid-snapshot-20151001:1.7
	sid-snapshot-20150901:1.7
	sid-snapshot-20150801:1.7
	sid-snapshot-20150701:1.7
	sid-snapshot-20150601:1.7
	sid-snapshot-20150501:1.7
	sid-snapshot-20150401:1.7
	sid-snapshot-20150301:1.7
	sid-snapshot-20150201:1.7
	sid-snapshot-20150101:1.7
	sid-snapshot-20141201:1.7
	sid-snapshot-20141101:1.7
	sid-snapshot-20141001:1.7
	sid-snapshot-20140901:1.7
	sid-snapshot-20140801:1.7
	sid-snapshot-20140701:1.7
	sid-snapshot-20140601:1.7
	sid-snapshot-20140501:1.7
	sid-snapshot-20140401:1.7
	sid-snapshot-20140301:1.7
	sid-snapshot-20140201:1.7
	sid-snapshot-20140101:1.7
	sid-snapshot-20131201:1.7
	sid-snapshot-20131101:1.7
	sid-snapshot-20131001:1.7
	sid-snapshot-20130901:1.7
	sid-snapshot-20130801:1.7
	sid-snapshot-20130701:1.7
	sid-snapshot-20130601:1.7
	sid-snapshot-20130501:1.7
	sid-snapshot-20130401:1.7
	sid-snapshot-20130301:1.7
	sid-snapshot-20130201:1.7
	sid-snapshot-20130101:1.7
	sid-snapshot-20121201:1.7
	sid-snapshot-20121101:1.7
	sid-snapshot-20121001:1.7
	sid-snapshot-20120901:1.7
	sid-snapshot-20120801:1.7
	sid-snapshot-20120701:1.7
	sid-snapshot-20120601:1.7
	sid-snapshot-20120501:1.7
	sid-snapshot-20120401:1.7
	sid-snapshot-20120301:1.7
	sid-snapshot-20120201:1.7
	sid-snapshot-20120101:1.7
	sid-snapshot-20111201:1.7
	sid-snapshot-20111101:1.7
	sid-snapshot-20111001:1.7
	sid-snapshot-20110901:1.7
	sid-snapshot-20110801:1.7
	sid-snapshot-20110701:1.7
	sid-snapshot-20110601:1.7
	sid-snapshot-20110501:1.7
	sid-snapshot-20110401:1.7
	sid-snapshot-20110301:1.7
	sid-snapshot-20110201:1.7
	sid-snapshot-20110101:1.7
	sid-snapshot-20101201:1.7
	sid-snapshot-20101101:1.7
	sid-snapshot-20101001:1.7
	sid-snapshot-20100901:1.7
	sid-snapshot-20100801:1.7
	sid-snapshot-20100701:1.7
	sid-snapshot-20100601:1.7
	sid-snapshot-20100501:1.7
	sid-snapshot-20100401:1.7
	sid-snapshot-20100301:1.7
	sid-snapshot-20100201:1.7
	sid-snapshot-20100101:1.7
	sid-snapshot-20091201:1.7
	sid-snapshot-20091101:1.7
	sid-snapshot-20091001:1.7
	sid-snapshot-20090901:1.7
	sid-snapshot-20090801:1.7
	sid-snapshot-20090701:1.7
	sid-snapshot-20090601:1.7
	sid-snapshot-20090501:1.7
	sid-snapshot-20090401:1.7
	sid-snapshot-20090301:1.7
	sid-snapshot-20090201:1.7
	sid-snapshot-20090101:1.7
	sid-snapshot-20081201:1.7
	sid-snapshot-20081101:1.7
	sid-snapshot-20081001:1.7
	sid-snapshot-20080901:1.7
	sid-snapshot-20080801:1.7
	sid-snapshot-20080701:1.7
	sid-snapshot-20080601:1.7
	sid-snapshot-20080501:1.7
	sid-snapshot-20080403:1.7
	sid-snapshot-20080401:1.7
	sid-snapshot-20080301:1.7
	sid-snapshot-20080201:1.7
	sid-snapshot-20080101:1.7
	sid-snapshot-20071201:1.7
	sid-snapshot-20071101:1.7
	sid-snapshot-20071001:1.7
	sid-20020905-branchpoint:1.1
	sid-20020905-branch:1.1.0.2
	cygnus_cvs_20020108_pre:1.1;
locks; strict;
comment	@# @;


1.7
date	2006.07.14.18.51.34;	author brolley;	state Exp;
branches;
next	1.6;

1.6
date	2006.05.10.20.44.31;	author brolley;	state Exp;
branches;
next	1.5;

1.5
date	2005.02.07.18.51.31;	author jimb;	state Exp;
branches;
next	1.4;

1.4
date	2003.09.08.18.55.35;	author devans;	state Exp;
branches;
next	1.3;

1.3
date	2003.04.16.18.13.51;	author brolley;	state Exp;
branches;
next	1.2;

1.2
date	2002.09.20.01.00.28;	author aoliva;	state Exp;
branches;
next	1.1;

1.1
date	2000.12.07.19.30.47;	author fche;	state Exp;
branches;
next	;


desc
@@


1.7
log
@2006-07-14  Dave Brolley  <brolley@@redhat.com>

        * CGEN.sh.in (fileopts): Place semantic switches first so that they
        are processed first.
@
text
@#! /bin/sh
# Generate CGEN simulator files.
#
# Usage: /bin/sh cgen.sh cpu-decode srcdir \
#	cgendir cgenflags \
#	arch archflags cpu isa mach prefix file-prefix \
#	arch-file file-specs
#
# cpu-decode: specified as is, exists for consistency with other such scripts.
#
# file-specs: any of
#	desc.h             - generate desc.h file (architecture-wide decls)
#	cpu.h              - generate cpu.h file (#included in cpu's class)
#	defs.h             - generate defs.h file (cpu-family specific decls)
#	decode.h           - generate decoder header file
#	decode.cxx         - generate decoder
#	model.h            - generate model header file
#	model.cxx          - generate model
#	semantics.cxx      - generate semantics
#	sem-switch.cxx     - generate semantics, pbb switch version
#
# archflags: any combination of
#	with-multiple-isa  - the architecture has multiple isas
#	with-scache        - generate scache support
#	with-sem-fns       - tell the decoder semantic fns will be generated
#	with-sem-switch    - tell the decoder a semantic switch will be gen'd
#
# We store the generated files in the source directory until we decide to
# ship a Scheme interpreter (or other implementation).
# Maybe we never will.

# NB: starting pwd is BUILD/sid/component/cgen-cpu/TARGET


# We want to behave like make, any error forces us to stop.
set -e
# set -x

action=$1
srcdir=$2
cgendir=$3
cgenflags=$4
arch=$5
archflags=$6
cpu=$7
isa=$8
mach=$9
# bring parms past 9 portably into view
shift ; prefix=$9
shift ; fileprefix=$9
shift ; archfile=$9
shift ; filespecs=$9

rootdir=${srcdir}/../../../..
brootdir=../../../..

lowercase='abcdefghijklmnopqrstuvwxyz'
uppercase='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
ARCH=`echo ${arch} | tr "${lowercase}" "${uppercase}"`
CPU=`echo ${cpu} | tr "${lowercase}" "${uppercase}"`
PREFIX=`echo ${prefix} | tr "${lowercase}" "${uppercase}"`


# Find GUILE in the install or build trees
if [ -x ${brootdir}/guile/libguile/guile ]
then
    cgen="env GUILE_LOAD_PATH=${brootdir}/guile:${rootdir}/guile ${brootdir}/guile/libguile/guile"
else
    cgen=guile
fi
cgen="${cgen} -l ${cgendir}/guile.scm -s"

rm -f tmp-desc-$$.h1 tmp-desc-$$.h
rm -f tmp-cpu-$$.h1 tmp-cpu-$$.h
rm -f tmp-defs-$$.h1 tmp-defs-$$.h
rm -f tmp-sem-$$.cxx1 tmp-sem-$$.cxx
rm -f tmp-semsw-$$.cxx1 tmp-semsw-$$.cxx
rm -f tmp-dec-$$.h1 tmp-dec-$$.h
rm -f tmp-dec-$$.cxx1 tmp-dec-$$.cxx

# Do semantics first, if specified because some information is collected
# about write stacks during this pass which is used by other passes.
fileopts=""
for f in $filespecs
do
    case $f in
    desc.h) fileopts="$fileopts -H tmp-desc-$$.h1" ;;
    cpu.h) fileopts="$fileopts -C tmp-cpu-$$.h1" ;;
    defs.h) fileopts="$fileopts -E tmp-defs-$$.h1" ;;
    decode.h) fileopts="$fileopts -T tmp-dec-$$.h1" ;;
    decode.cxx) fileopts="$fileopts -D tmp-dec-$$.cxx1" ;;
    model.h) fileopts="$fileopts -N tmp-mod-$$.h1" ;;
    model.cxx) fileopts="$fileopts -M tmp-mod-$$.cxx1" ;;
    semantics.cxx) fileopts="-S tmp-sem-$$.cxx1 $fileopts" ;;
    sem-switch.cxx) fileopts="-X tmp-semsw-$$.cxx1 $fileopts" ;;
    write.cxx) fileopts="$fileopts -W tmp-write-$$.cxx1" ;;
    *) echo "unknown file spec: $f" >&2 ; exit 1 ;;
    esac
done

${cgen} ${cgendir}/cgen-sid.scm \
	-s ${cgendir} \
	${cgenflags} \
	-f "${archflags}" \
	-m ${mach} \
	-i ${isa} \
	-a ${archfile} \
	${fileopts}


# NB below, the ``@@ prefix @@'' sequence is quoted strange, since
# it this cgen notation collides with autoconf's.

for f in $filespecs
do
    case $f in
    desc.h)
	sed -e "s,@@ARCH@@,${ARCH},g" -e "s,@@arch@@,${arch},g" \
	    -e "s=@@CPU@@=${CPU}=g" -e "s=@@cpu@@=${cpu}=g" \
	    -e "s=@@PREFIX@@=${PREFIX}=g" -e "s=@@"prefix"@@=${prefix}=g" \
	    < tmp-desc-$$.h1 > tmp-desc-$$.h
	${rootdir}/move-if-change tmp-desc-$$.h ${srcdir}/${fileprefix}desc.h
	;;
    cpu.h)
	sed -e "s=@@ARCH@@=${ARCH}=g" -e "s=@@arch@@=${arch}=g" \
	    -e "s=@@CPU@@=${CPU}=g" -e "s=@@cpu@@=${cpu}=g" \
	    -e "s=@@PREFIX@@=${PREFIX}=g" -e "s=@@"prefix"@@=${prefix}=g" \
	    < tmp-cpu-$$.h1 > tmp-cpu-$$.h
	${rootdir}/move-if-change tmp-cpu-$$.h ${srcdir}/${fileprefix}cpu.h
	;;
    defs.h)
	sed -e "s=@@ARCH@@=${ARCH}=g" -e "s=@@arch@@=${arch}=g" \
	    -e "s=@@CPU@@=${CPU}=g" -e "s=@@cpu@@=${cpu}=g" \
	    -e "s=@@PREFIX@@=${PREFIX}=g" -e "s=@@"prefix"@@=${prefix}=g" \
	    < tmp-defs-$$.h1 > tmp-defs-$$.h
	${rootdir}/move-if-change tmp-defs-$$.h ${srcdir}/${fileprefix}defs.h
	;;
    decode.h)
	sed -e "s=@@ARCH@@=${ARCH}=g" -e "s=@@arch@@=${arch}=g" \
	    -e "s=@@CPU@@=${CPU}=g" -e "s=@@cpu@@=${cpu}=g" \
	    -e "s=@@PREFIX@@=${PREFIX}=g" -e "s=@@"prefix"@@=${prefix}=g" \
	    < tmp-dec-$$.h1 > tmp-dec-$$.h
	${rootdir}/move-if-change tmp-dec-$$.h ${srcdir}/${fileprefix}decode.h
	;;
    decode.cxx)
	sed -e "s=@@ARCH@@=${ARCH}=g" -e "s=@@arch@@=${arch}=g" \
	    -e "s=@@CPU@@=${CPU}=g" -e "s=@@cpu@@=${cpu}=g" \
	    -e "s=@@PREFIX@@=${PREFIX}=g" -e "s=@@"prefix"@@=${prefix}=g" \
	    < tmp-dec-$$.cxx1 > tmp-dec-$$.cxx
	${rootdir}/move-if-change tmp-dec-$$.cxx ${srcdir}/${fileprefix}decode.cxx
	;;
    model.h)
	sed -e "s=@@ARCH@@=${ARCH}=g" -e "s=@@arch@@=${arch}=g" \
	    -e "s=@@CPU@@=${CPU}=g" -e "s=@@cpu@@=${cpu}=g" \
	    -e "s=@@PREFIX@@=${PREFIX}=g" -e "s=@@"prefix"@@=${prefix}=g" \
	    < tmp-mod-$$.h1 > tmp-mod-$$.h
	${rootdir}/move-if-change tmp-mod-$$.h ${srcdir}/${fileprefix}model.h
	;;
    model.cxx)
	sed -e "s=@@ARCH@@=${ARCH}=g" -e "s=@@arch@@=${arch}=g" \
	    -e "s=@@CPU@@=${CPU}=g" -e "s=@@cpu@@=${cpu}=g" \
	    -e "s=@@PREFIX@@=${PREFIX}=g" -e "s=@@"prefix"@@=${prefix}=g" \
	    < tmp-mod-$$.cxx1 > tmp-mod-$$.cxx
	${rootdir}/move-if-change tmp-mod-$$.cxx ${srcdir}/${fileprefix}model.cxx
	;;
    semantics.cxx)
	sed -e "s=@@ARCH@@=${ARCH}=g" -e "s=@@arch@@=${arch}=g" \
	    -e "s=@@CPU@@=${CPU}=g" -e "s=@@cpu@@=${cpu}=g" \
	    -e "s=@@PREFIX@@=${PREFIX}=g" -e "s=@@"prefix"@@=${prefix}=g" \
	    < tmp-sem-$$.cxx1 > tmp-sem-$$.cxx
	${rootdir}/move-if-change tmp-sem-$$.cxx ${srcdir}/${fileprefix}sem.cxx
	;;
    sem-switch.cxx)
	sed -e "s=@@ARCH@@=${ARCH}=g" -e "s=@@arch@@=${arch}=g" \
	    -e "s=@@CPU@@=${CPU}=g" -e "s=@@cpu@@=${cpu}=g" \
	    -e "s=@@PREFIX@@=${PREFIX}=g" -e "s=@@"prefix"@@=${prefix}=g" \
	    < tmp-semsw-$$.cxx1 > tmp-semsw-$$.cxx
	${rootdir}/move-if-change tmp-semsw-$$.cxx ${srcdir}/${fileprefix}semsw.cxx
	;;
    write.cxx)
	sed -e "s=@@ARCH@@=${ARCH}=g" -e "s=@@arch@@=${arch}=g" \
	    -e "s=@@CPU@@=${CPU}=g" -e "s=@@cpu@@=${cpu}=g" \
	    -e "s=@@PREFIX@@=${PREFIX}=g" -e "s=@@"prefix"@@=${prefix}=g" \
	    < tmp-write-$$.cxx1 > tmp-write-$$.cxx
	${rootdir}/move-if-change tmp-write-$$.cxx ${srcdir}/${fileprefix}write.cxx
	;;
    esac
done

rm -f tmp-desc-$$.h1 tmp-desc-$$.h
rm -f tmp-cpu-$$.h1 tmp-cpu-$$.h
rm -f tmp-defs-$$.h1 tmp-defs-$$.h
rm -f tmp-sem-$$.cxx1 tmp-sem-$$.cxx
rm -f tmp-semsw-$$.cxx1 tmp-semsw-$$.cxx
rm -f tmp-write-$$.cxx1 tmp-write-$$.cxx
rm -f tmp-dec-$$.h1 tmp-dec-$$.h
rm -f tmp-dec-$$.cxx1 tmp-dec-$$.cxx
rm -f tmp-mod-$$.h1 tmp-mod-$$.h
rm -f tmp-mod-$$.cxx1 tmp-mod-$$.cxx

exit 0
@


1.6
log
@2006-05-10  Dave Brolley  <brolley@@redhat.com>

        * CGEN.sh.in: Correct usage comment.
@
text
@d81 2
d94 2
a95 2
    semantics.cxx) fileopts="$fileopts -S tmp-sem-$$.cxx1" ;;
    sem-switch.cxx) fileopts="$fileopts -X tmp-semsw-$$.cxx1" ;;
@


1.5
log
@cgen/ChangeLog:
2005-02-07  Jim Blandy  <jimb@@redhat.com>

	* guile.scm: New file, containing Guile-specific definitions and
	adaptations.  This is loaded by the app-specific shell scripts.
	Initially identical to fixup.scm.
	* cgen-sid.scm: Don't load fixup.scm here.

sid/component/cgen-cpu/ChangeLog:
2005-02-02  Jim Blandy  <jimb@@redhat.com>

	* CGEN.sh.in: Request on the command line that cgen/guile.scm be
	loaded before cgen-sid.scm; cgen-sid.scm no longer loads fixup.scm.
@
text
@d5 1
a5 1
#	cgen cgendir cgenflags \
@


1.4
log
@	* CGEN.sh.h: New arg arch-file.
	* arm7t/Makefile.am (cgen-arm,cgen-arm7f,cgen-arm7f-arm): Update call
	to CGEN.sh.
	* arm7t/Makefile.in: Regenerate.
	* m32r/Makefile.am (cgen-m32r): Update call to CGEN.sh.
	* m32r/Makefile.in: Regenerate.
	* xstormy16/Makefile.am (cgen-xstormy16): Update call to CGEN.sh.
	* xstormy16/Makefile.in: Regenerate.
@
text
@d71 1
a71 1

d99 1
a99 1
${cgen} -s ${cgendir}/cgen-sid.scm \
@


1.3
log
@003-04-16  Dave Brolley  <brolley@@redhat.com>

        * common-xml/interface.xml: Document trace-count? and
        final-insn-count?.
        * CGEN.sh.in: Implement generation of model.cxx and model.h
        * cgen-model.h: New file.
@
text
@d6 2
a7 1
#	arch archflags cpu isa mach prefix file-prefix file-specs
d51 1
d105 1
a105 1
	-a ${arch} \
@


1.2
log
@* Import these changes from the config master repository:
@
text
@d16 2
d88 2
d148 14
d194 2
@


1.1
log
@* public snapshot of sid simulator
@
text
@d69 7
a75 7
rm -f tmp-desc.h1 tmp-desc.h
rm -f tmp-cpu.h1 tmp-cpu.h
rm -f tmp-defs.h1 tmp-defs.h
rm -f tmp-sem.cxx1 tmp-sem.cxx
rm -f tmp-semsw.cxx1 tmp-semsw.cxx
rm -f tmp-dec.h1 tmp-dec.h
rm -f tmp-dec.cxx1 tmp-dec.cxx
d81 8
a88 8
    desc.h) fileopts="$fileopts -H tmp-desc.h1" ;;
    cpu.h) fileopts="$fileopts -C tmp-cpu.h1" ;;
    defs.h) fileopts="$fileopts -E tmp-defs.h1" ;;
    decode.h) fileopts="$fileopts -T tmp-dec.h1" ;;
    decode.cxx) fileopts="$fileopts -D tmp-dec.cxx1" ;;
    semantics.cxx) fileopts="$fileopts -S tmp-sem.cxx1" ;;
    sem-switch.cxx) fileopts="$fileopts -X tmp-semsw.cxx1" ;;
    write.cxx) fileopts="$fileopts -W tmp-write.cxx1" ;;
d113 2
a114 2
	    < tmp-desc.h1 > tmp-desc.h
	${rootdir}/move-if-change tmp-desc.h ${srcdir}/${fileprefix}desc.h
d120 2
a121 2
	    < tmp-cpu.h1 > tmp-cpu.h
	${rootdir}/move-if-change tmp-cpu.h ${srcdir}/${fileprefix}cpu.h
d127 2
a128 2
	    < tmp-defs.h1 > tmp-defs.h
	${rootdir}/move-if-change tmp-defs.h ${srcdir}/${fileprefix}defs.h
d134 2
a135 2
	    < tmp-dec.h1 > tmp-dec.h
	${rootdir}/move-if-change tmp-dec.h ${srcdir}/${fileprefix}decode.h
d141 2
a142 2
	    < tmp-dec.cxx1 > tmp-dec.cxx
	${rootdir}/move-if-change tmp-dec.cxx ${srcdir}/${fileprefix}decode.cxx
d148 2
a149 2
	    < tmp-sem.cxx1 > tmp-sem.cxx
	${rootdir}/move-if-change tmp-sem.cxx ${srcdir}/${fileprefix}sem.cxx
d155 2
a156 2
	    < tmp-semsw.cxx1 > tmp-semsw.cxx
	${rootdir}/move-if-change tmp-semsw.cxx ${srcdir}/${fileprefix}semsw.cxx
d162 2
a163 2
	    < tmp-write.cxx1 > tmp-write.cxx
	${rootdir}/move-if-change tmp-write.cxx ${srcdir}/${fileprefix}write.cxx
d168 8
a175 8
rm -f tmp-desc.h1 tmp-desc.h
rm -f tmp-cpu.h1 tmp-cpu.h
rm -f tmp-defs.h1 tmp-defs.h
rm -f tmp-sem.cxx1 tmp-sem.cxx
rm -f tmp-semsw.cxx1 tmp-semsw.cxx
rm -f tmp-write.cxx1 tmp-write.cxx
rm -f tmp-dec.h1 tmp-dec.h
rm -f tmp-dec.cxx1 tmp-dec.cxx
@

