head	1.8;
access;
symbols
	sid-snapshot-20180601:1.8
	sid-snapshot-20180501:1.8
	sid-snapshot-20180401:1.8
	sid-snapshot-20180301:1.8
	sid-snapshot-20180201:1.8
	sid-snapshot-20180101:1.8
	sid-snapshot-20171201:1.8
	sid-snapshot-20171101:1.8
	sid-snapshot-20171001:1.8
	sid-snapshot-20170901:1.8
	sid-snapshot-20170801:1.8
	sid-snapshot-20170701:1.8
	sid-snapshot-20170601:1.8
	sid-snapshot-20170501:1.8
	sid-snapshot-20170401:1.8
	sid-snapshot-20170301:1.8
	sid-snapshot-20170201:1.8
	sid-snapshot-20170101:1.8
	sid-snapshot-20161201:1.8
	sid-snapshot-20161101:1.8
	sid-snapshot-20160901:1.8
	sid-snapshot-20160801:1.8
	sid-snapshot-20160701:1.8
	sid-snapshot-20160601:1.8
	sid-snapshot-20160501:1.8
	sid-snapshot-20160401:1.8
	sid-snapshot-20160301:1.8
	sid-snapshot-20160201:1.8
	sid-snapshot-20160101:1.8
	sid-snapshot-20151201:1.8
	sid-snapshot-20151101:1.8
	sid-snapshot-20151001:1.8
	sid-snapshot-20150901:1.8
	sid-snapshot-20150801:1.8
	sid-snapshot-20150701:1.8
	sid-snapshot-20150601:1.8
	sid-snapshot-20150501:1.8
	sid-snapshot-20150401:1.8
	sid-snapshot-20150301:1.8
	sid-snapshot-20150201:1.8
	sid-snapshot-20150101:1.8
	sid-snapshot-20141201:1.8
	sid-snapshot-20141101:1.7
	sid-snapshot-20141001:1.7
	sid-snapshot-20140901:1.7
	sid-snapshot-20140801:1.7
	sid-snapshot-20140701:1.7
	sid-snapshot-20140601:1.7
	sid-snapshot-20140501:1.7
	sid-snapshot-20140401:1.7
	sid-snapshot-20140301:1.7
	sid-snapshot-20140201:1.7
	sid-snapshot-20140101:1.7
	sid-snapshot-20131201:1.7
	sid-snapshot-20131101:1.7
	sid-snapshot-20131001:1.7
	binutils-2_24-branch:1.7.0.8
	binutils-2_24-branchpoint:1.7
	binutils-2_21_1:1.4
	sid-snapshot-20130901:1.7
	gdb_7_6_1-2013-08-30-release:1.7
	sid-snapshot-20130801:1.7
	sid-snapshot-20130701:1.7
	sid-snapshot-20130601:1.7
	sid-snapshot-20130501:1.7
	gdb_7_6-2013-04-26-release:1.7
	sid-snapshot-20130401:1.7
	binutils-2_23_2:1.7
	gdb_7_6-branch:1.7.0.6
	gdb_7_6-2013-03-12-branchpoint:1.7
	sid-snapshot-20130301:1.7
	sid-snapshot-20130201:1.7
	sid-snapshot-20130101:1.7
	sid-snapshot-20121201:1.7
	gdb_7_5_1-2012-11-29-release:1.7
	binutils-2_23_1:1.7
	sid-snapshot-20121101:1.7
	binutils-2_23:1.7
	sid-snapshot-20121001:1.7
	sid-snapshot-20120901:1.7
	gdb_7_5-2012-08-17-release:1.7
	sid-snapshot-20120801:1.7
	binutils-2_23-branch:1.7.0.4
	binutils-2_23-branchpoint:1.7
	gdb_7_5-branch:1.7.0.2
	gdb_7_5-2012-07-18-branchpoint:1.7
	sid-snapshot-20120701:1.6
	sid-snapshot-20120601:1.6
	sid-snapshot-20120501:1.6
	binutils-2_22_branch:1.6.0.6
	gdb_7_4_1-2012-04-26-release:1.6
	sid-snapshot-20120401:1.6
	sid-snapshot-20120301:1.6
	sid-snapshot-20120201:1.6
	gdb_7_4-2012-01-24-release:1.6
	sid-snapshot-20120101:1.6
	gdb_7_4-branch:1.6.0.4
	gdb_7_4-2011-12-13-branchpoint:1.6
	sid-snapshot-20111201:1.6
	binutils-2_22:1.6
	sid-snapshot-20111101:1.6
	sid-snapshot-20111001:1.6
	binutils-2_22-branch:1.6.0.2
	binutils-2_22-branchpoint:1.6
	gdb_7_3_1-2011-09-04-release:1.5
	sid-snapshot-20110901:1.6
	sid-snapshot-20110801:1.6
	gdb_7_3-2011-07-26-release:1.5
	sid-snapshot-20110701:1.5
	sid-snapshot-20110601:1.5
	sid-snapshot-20110501:1.5
	gdb_7_3-branch:1.5.0.2
	gdb_7_3-2011-04-01-branchpoint:1.5
	sid-snapshot-20110401:1.5
	sid-snapshot-20110301:1.5
	cygwin-1_7_8-release:1.4
	sid-snapshot-20110201:1.4
	sid-snapshot-20110101:1.4
	binutils-2_21:1.4
	sid-snapshot-20101201:1.4
	binutils-2_21-branch:1.4.0.40
	binutils-2_21-branchpoint:1.4
	sid-snapshot-20101101:1.4
	sid-snapshot-20101001:1.4
	binutils-2_20_1:1.4
	gdb_7_2-2010-09-02-release:1.4
	sid-snapshot-20100901:1.4
	cygwin-1_7_7-release:1.4
	sid-snapshot-20100801:1.4
	gdb_7_2-branch:1.4.0.38
	gdb_7_2-2010-07-07-branchpoint:1.4
	sid-snapshot-20100701:1.4
	sid-snapshot-20100601:1.4
	sid-snapshot-20100501:1.4
	sid-snapshot-20100401:1.4
	gdb_7_1-2010-03-18-release:1.4
	sid-snapshot-20100301:1.4
	gdb_7_1-branch:1.4.0.36
	gdb_7_1-2010-02-18-branchpoint:1.4
	sid-snapshot-20100201:1.4
	sid-snapshot-20100101:1.4
	gdb_7_0_1-2009-12-22-release:1.4
	sid-snapshot-20091201:1.4
	sid-snapshot-20091101:1.4
	binutils-2_20:1.4
	gdb_7_0-2009-10-06-release:1.4
	sid-snapshot-20091001:1.4
	gdb_7_0-branch:1.4.0.34
	gdb_7_0-2009-09-16-branchpoint:1.4
	arc-sim-20090309:1.4
	binutils-arc-20081103-branch:1.4.0.32
	binutils-arc-20081103-branchpoint:1.4
	binutils-2_20-branch:1.4.0.30
	binutils-2_20-branchpoint:1.4
	sid-snapshot-20090901:1.4
	sid-snapshot-20090801:1.4
	msnyder-checkpoint-072509-branch:1.4.0.28
	msnyder-checkpoint-072509-branchpoint:1.4
	sid-snapshot-20090701:1.4
	dje-cgen-play1-branch:1.4.0.26
	dje-cgen-play1-branchpoint:1.4
	sid-snapshot-20090601:1.4
	sid-snapshot-20090501:1.4
	sid-snapshot-20090401:1.4
	arc-20081103-branch:1.4.0.24
	arc-20081103-branchpoint:1.4
	arc-insight_6_8-branch:1.4.0.22
	arc-insight_6_8-branchpoint:1.4
	insight_6_8-branch:1.4.0.20
	insight_6_8-branchpoint:1.4
	sid-snapshot-20090301:1.4
	binutils-2_19_1:1.4
	sid-snapshot-20090201:1.4
	sid-snapshot-20090101:1.4
	reverse-20081226-branch:1.4.0.18
	reverse-20081226-branchpoint:1.4
	sid-snapshot-20081201:1.4
	multiprocess-20081120-branch:1.4.0.16
	multiprocess-20081120-branchpoint:1.4
	sid-snapshot-20081101:1.4
	binutils-2_19:1.4
	sid-snapshot-20081001:1.4
	reverse-20080930-branch:1.4.0.14
	reverse-20080930-branchpoint:1.4
	binutils-2_19-branch:1.4.0.12
	binutils-2_19-branchpoint:1.4
	sid-snapshot-20080901:1.4
	sid-snapshot-20080801:1.4
	reverse-20080717-branch:1.4.0.10
	reverse-20080717-branchpoint:1.4
	sid-snapshot-20080701:1.4
	msnyder-reverse-20080609-branch:1.4.0.8
	msnyder-reverse-20080609-branchpoint:1.4
	drow-reverse-20070409-branch:1.3.0.2
	drow-reverse-20070409-branchpoint:1.3
	sid-snapshot-20080601:1.4
	sid-snapshot-20080501:1.4
	sid-snapshot-20080403:1.4
	sid-snapshot-20080401:1.4
	gdb_6_8-2008-03-27-release:1.4
	sid-snapshot-20080301:1.4
	gdb_6_8-branch:1.4.0.6
	gdb_6_8-2008-02-26-branchpoint:1.4
	sid-snapshot-20080201:1.4
	sid-snapshot-20080101:1.4
	sid-snapshot-20071201:1.4
	sid-snapshot-20071101:1.4
	gdb_6_7_1-2007-10-29-release:1.4
	gdb_6_7-2007-10-10-release:1.4
	sid-snapshot-20071001:1.4
	gdb_6_7-branch:1.4.0.4
	gdb_6_7-2007-09-07-branchpoint:1.4
	binutils-2_18:1.4
	binutils-2_18-branch:1.4.0.2
	binutils-2_18-branchpoint:1.4
	binutils_latest_snapshot:1.7;
locks; strict;
comment	@ * @;


1.8
date	2014.11.05.18.23.27;	author dj;	state Exp;
branches;
next	1.7;

1.7
date	2012.07.13.23.39.45;	author devans;	state Exp;
branches;
next	1.6;

1.6
date	2011.07.01.18.24.39;	author brobecke;	state Exp;
branches;
next	1.5;

1.5
date	2011.02.28.18.30.14;	author ktietz;	state Exp;
branches;
next	1.4;

1.4
date	2007.05.03.23.40.11;	author brobecke;	state Exp;
branches;
next	1.3;

1.3
date	2007.04.06.06.01.54;	author brobecke;	state Exp;
branches;
next	1.2;

1.2
date	2007.04.02.11.20.52;	author schwab;	state Exp;
branches;
next	1.1;

1.1
date	2007.03.29.21.03.48;	author dj;	state Exp;
branches;
next	;


desc
@@


1.8
log
@merge from gcc
@
text
@/* File name comparison routine.

   Copyright (C) 2007 Free Software Foundation, Inc.

   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 2, or (at your option)
   any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software Foundation,
   Inc., 51 Franklin Street - Fifth Floor, Boston, MA 02110-1301, USA.  */

#ifdef HAVE_CONFIG_H
#include "config.h"
#endif

#ifdef HAVE_STRING_H
#include <string.h>
#endif

#ifdef HAVE_STDLIB_H
#include <stdlib.h>
#endif

#include "filenames.h"
#include "safe-ctype.h"
#include "libiberty.h"

/*

@@deftypefn Extension int filename_cmp (const char *@@var{s1}, const char *@@var{s2})

Return zero if the two file names @@var{s1} and @@var{s2} are equivalent.
If not equivalent, the returned value is similar to what @@code{strcmp}
would return.  In other words, it returns a negative value if @@var{s1}
is less than @@var{s2}, or a positive value if @@var{s2} is greater than
@@var{s2}.

This function does not normalize file names.  As a result, this function
will treat filenames that are spelled differently as different even in
the case when the two filenames point to the same underlying file.
However, it does handle the fact that on DOS-like file systems, forward
and backward slashes are equal.

@@end deftypefn

*/

int
filename_cmp (const char *s1, const char *s2)
{
#if !defined(HAVE_DOS_BASED_FILE_SYSTEM) \
    && !defined(HAVE_CASE_INSENSITIVE_FILE_SYSTEM)
  return strcmp(s1, s2);
#else
  for (;;)
    {
      int c1 = *s1;
      int c2 = *s2;

#if defined (HAVE_CASE_INSENSITIVE_FILE_SYSTEM)
      c1 = TOLOWER (c1);
      c2 = TOLOWER (c2);
#endif

#if defined (HAVE_DOS_BASED_FILE_SYSTEM)
      /* On DOS-based file systems, the '/' and the '\' are equivalent.  */
      if (c1 == '/')
        c1 = '\\';
      if (c2 == '/')
        c2 = '\\';
#endif

      if (c1 != c2)
        return (c1 - c2);

      if (c1 == '\0')
        return 0;

      s1++;
      s2++;
    }
#endif
}

/*

@@deftypefn Extension int filename_ncmp (const char *@@var{s1}, const char *@@var{s2}, size_t @@var{n})

Return zero if the two file names @@var{s1} and @@var{s2} are equivalent
in range @@var{n}.
If not equivalent, the returned value is similar to what @@code{strncmp}
would return.  In other words, it returns a negative value if @@var{s1}
is less than @@var{s2}, or a positive value if @@var{s2} is greater than
@@var{s2}.

This function does not normalize file names.  As a result, this function
will treat filenames that are spelled differently as different even in
the case when the two filenames point to the same underlying file.
However, it does handle the fact that on DOS-like file systems, forward
and backward slashes are equal.

@@end deftypefn

*/

int
filename_ncmp (const char *s1, const char *s2, size_t n)
{
#if !defined(HAVE_DOS_BASED_FILE_SYSTEM) \
    && !defined(HAVE_CASE_INSENSITIVE_FILE_SYSTEM)
  return strncmp(s1, s2, n);
#else
  if (!n)
    return 0;
  for (; n > 0; --n)
  {
      int c1 = *s1;
      int c2 = *s2;

#if defined (HAVE_CASE_INSENSITIVE_FILE_SYSTEM)
      c1 = TOLOWER (c1);
      c2 = TOLOWER (c2);
#endif

#if defined (HAVE_DOS_BASED_FILE_SYSTEM)
      /* On DOS-based file systems, the '/' and the '\' are equivalent.  */
      if (c1 == '/')
        c1 = '\\';
      if (c2 == '/')
        c2 = '\\';
#endif

      if (c1 == '\0' || c1 != c2)
        return (c1 - c2);

      s1++;
      s2++;
  }
  return 0;
#endif
}

/*

@@deftypefn Extension hashval_t filename_hash (const void *@@var{s})

Return the hash value for file name @@var{s} that will be compared
using filename_cmp.
This function is for use with hashtab.c hash tables.

@@end deftypefn

*/

hashval_t
filename_hash (const void *s)
{
  /* The cast is for -Wc++-compat.  */
  const unsigned char *str = (const unsigned char *) s;
  hashval_t r = 0;
  unsigned char c;

  while ((c = *str++) != 0)
    {
      if (c == '\\')
	c = '/';
      c = TOLOWER (c);
      r = r * 67 + c - 113;
    }

  return r;
}

/*

@@deftypefn Extension int filename_eq (const void *@@var{s1}, const void *@@var{s2})

Return non-zero if file names @@var{s1} and @@var{s2} are equivalent.
This function is for use with hashtab.c hash tables.

@@end deftypefn

*/

int
filename_eq (const void *s1, const void *s2)
{
  /* The casts are for -Wc++-compat.  */
  return filename_cmp ((const char *) s1, (const char *) s2) == 0;
}

/*

@@deftypefn Extension int canonical_filename_eq (const char *@@var{a}, const char *@@var{b})

Return non-zero if file names @@var{a} and @@var{b} are equivalent.
This function compares the canonical versions of the filenames as returned by
@@code{lrealpath()}, so that so that different file names pointing to the same
underlying file are treated as being identical.

@@end deftypefn

*/

int
canonical_filename_eq (const char * a, const char * b)
{
  char * ca = lrealpath(a);
  char * cb = lrealpath(b);
  int res = filename_eq (ca, cb);
  free (ca);
  free (cb);
  return res;
}
@


1.7
log
@	include/
	* filenames.h: #include "hashtab.h".
	(filename_hash, filename_eq): Declare.
	libiberty/
	* filename_cmp.c (filename_hash, filename_eq): New functions.
@
text
@d27 4
d33 1
d198 24
@


1.6
log
@[libiberty/filename_cmp] Darwin has case-insensitive filesystems

include/ChangeLog:

        * filenames.h (HAVE_CASE_INSENSITIVE_FILE_SYSTEM): Define
        on Darwin, as well as on the systems that use a DOS-like
        filesystem.

libiberty/ChangeLog:

        * filename_cmp.c (filename_cmp, filename_ncmp): Add handling of
        HAVE_CASE_INSENSITIVE_FILE_SYSTEM.
@
text
@d144 49
@


1.5
log
@ChangeLog libiberty/
2011-02-28  Kai Tietz  <kai.tietz@@onevision.com>

	* filename_cmp.c (filename_ncmp): New function.
	* functions.texi: Regenerated.

ChangeLog include/
2011-02-28  Kai Tietz  <kai.tietz@@onevision.com>

	* filenames.h (filename_ncmp): New prototype.

ChangeLog bfd/
2011-02-28  Kai Tietz  <kai.tietz@@onevision.com>

	* archive.c (_bfd_find_nested_archive): Use filename_(n)cmp.
	(adjust_relative_path): Likewise.
	(_bfd_construct_extended_name_table): Likewise.
	* corefile.c (generic_core_file_matches_executable_p): Likewise.
	* elf32-bfin.c (bfinfdpic_relocate_section): Likewise.
	* elf32-frv.c (elf32_frv_relocate_section): Likewise.
	* elf32-spu.c (sort_bfds): Likewise.
	(spu_elf_auto_overlay): Likewise.
	* syms.c (_bfd_stab_section_find_nearest_line): Likewise.
	* xcofflink.c (xcoff_set_import_path): Likewise.
	* xtensa-isa.c (xtensa_regfile_lookup): Likewise.
	(xtensa_regfile_lookup_shortname): Likewise.
@
text
@d53 2
a54 1
#ifndef HAVE_DOS_BASED_FILE_SYSTEM
d59 2
a60 2
      int c1 = TOLOWER (*s1);
      int c2 = TOLOWER (*s2);
d62 6
d73 1
d111 2
a112 1
#ifndef HAVE_DOS_BASED_FILE_SYSTEM
d119 2
a120 2
      int c1 = TOLOWER (*s1);
      int c2 = TOLOWER (*s2);
d122 6
d133 1
@


1.4
log
@        * filename_cmp.c: Replace include of ctype.h by include of
        safe-ctype.h.
        (filename_cmp): Use TOLOWER instead of tolower for conversions
        that are locale-independent.
        * Makefile.in (filename_cmp.o): Add dependency on safe-ctype.h.
@
text
@d79 49
@


1.3
log
@        * filename_cmp.c (filename_cmp): Improve documentation.
@
text
@a26 1
#include <ctype.h>
d28 1
d58 2
a59 2
      int c1 = tolower (*s1);
      int c2 = tolower (*s2);
@


1.2
log
@	* filename_cmp.c: Include "config.h".
@
text
@d34 5
a38 4
Return zero if the two paths @@var{s1} and @@var{s2} are equivalent.
If not equivalent, the returned value is similar to what strcmp would
return.  In other words, it returns a negative value if @@var{s1} is less
than @@var{s2}, or a positive value if @@var{s2} is greater than @@var{s2}.
d40 1
a40 1
This function does not normalize path names. As a result, this function
@


1.1
log
@merge from gcc
@
text
@d19 4
@

