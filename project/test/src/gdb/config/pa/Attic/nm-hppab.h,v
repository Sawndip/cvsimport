head	1.6;
access;
symbols
	gdb_6_0-2003-10-04-release:1.5
	kettenis_sparc-20030918-branch:1.5.0.26
	kettenis_sparc-20030918-branchpoint:1.5
	carlton_dictionary-20030917-merge:1.5
	ezannoni_pie-20030916-branchpoint:1.5
	ezannoni_pie-20030916-branch:1.5.0.24
	cagney_x86i386-20030821-branch:1.5.0.22
	cagney_x86i386-20030821-branchpoint:1.5
	carlton_dictionary-20030805-merge:1.5
	carlton_dictionary-20030627-merge:1.5
	gdb_6_0-branch:1.5.0.20
	gdb_6_0-2003-06-23-branchpoint:1.5
	jimb-ppc64-linux-20030613-branch:1.5.0.18
	jimb-ppc64-linux-20030613-branchpoint:1.5
	cagney_convert-20030606-branch:1.5.0.16
	cagney_convert-20030606-branchpoint:1.5
	cagney_writestrings-20030508-branch:1.5.0.14
	cagney_writestrings-20030508-branchpoint:1.5
	jimb-ppc64-linux-20030528-branch:1.5.0.12
	jimb-ppc64-linux-20030528-branchpoint:1.5
	carlton_dictionary-20030523-merge:1.5
	cagney_fileio-20030521-branch:1.5.0.10
	cagney_fileio-20030521-branchpoint:1.5
	kettenis_i386newframe-20030517-mergepoint:1.5
	jimb-ppc64-linux-20030509-branch:1.5.0.8
	jimb-ppc64-linux-20030509-branchpoint:1.5
	kettenis_i386newframe-20030504-mergepoint:1.5
	carlton_dictionary-20030430-merge:1.5
	kettenis_i386newframe-20030419-branch:1.5.0.6
	kettenis_i386newframe-20030419-branchpoint:1.5
	carlton_dictionary-20030416-merge:1.5
	cagney_frameaddr-20030409-mergepoint:1.5
	kettenis_i386newframe-20030406-branch:1.5.0.4
	kettenis_i386newframe-20030406-branchpoint:1.5
	cagney_frameaddr-20030403-branchpoint:1.5
	cagney_frameaddr-20030403-branch:1.5.0.2
	cagney_framebase-20030330-mergepoint:1.5
	cagney_framebase-20030326-branch:1.4.0.14
	cagney_framebase-20030326-branchpoint:1.4
	cagney_lazyid-20030317-branch:1.4.0.12
	cagney_lazyid-20030317-branchpoint:1.4
	kettenis-i386newframe-20030316-mergepoint:1.4
	offbyone-20030313-branch:1.4.0.10
	offbyone-20030313-branchpoint:1.4
	kettenis-i386newframe-20030308-branch:1.4.0.8
	kettenis-i386newframe-20030308-branchpoint:1.4
	carlton_dictionary-20030305-merge:1.4
	cagney_offbyone-20030303-branch:1.4.0.6
	cagney_offbyone-20030303-branchpoint:1.4
	carlton_dictionary-20030207-merge:1.4
	interps-20030203-mergepoint:1.4
	interps-20030202-branch:1.4.0.4
	interps-20030202-branchpoint:1.4
	cagney-unwind-20030108-branch:1.4.0.2
	cagney-unwind-20030108-branchpoint:1.4
	carlton_dictionary-20021223-merge:1.4
	gdb_5_3-2002-12-12-release:1.3
	carlton_dictionary-20021115-merge:1.3
	kseitz_interps-20021105-merge:1.3
	kseitz_interps-20021103-merge:1.3
	drow-cplus-merge-20021020:1.3
	drow-cplus-merge-20021025:1.3
	carlton_dictionary-20021025-merge:1.3
	carlton_dictionary-20021011-merge:1.3
	drow-cplus-branch:1.3.0.26
	drow-cplus-branchpoint:1.3
	kseitz_interps-20020930-merge:1.3
	carlton_dictionary-20020927-merge:1.3
	carlton_dictionary-branch:1.3.0.24
	carlton_dictionary-20020920-branchpoint:1.3
	gdb_5_3-branch:1.3.0.22
	gdb_5_3-2002-09-04-branchpoint:1.3
	kseitz_interps-20020829-merge:1.3
	cagney_sysregs-20020825-branch:1.3.0.20
	cagney_sysregs-20020825-branchpoint:1.3
	readline_4_3-import-branch:1.3.0.18
	readline_4_3-import-branchpoint:1.3
	gdb_5_2_1-2002-07-23-release:1.3
	kseitz_interps-20020528-branch:1.3.0.16
	kseitz_interps-20020528-branchpoint:1.3
	cagney_regbuf-20020515-branch:1.3.0.14
	cagney_regbuf-20020515-branchpoint:1.3
	jimb-macro-020506-branch:1.3.0.12
	jimb-macro-020506-branchpoint:1.3
	gdb_5_2-2002-04-29-release:1.3
	gdb_5_2-branch:1.3.0.10
	gdb_5_2-2002-03-03-branchpoint:1.3
	gdb_5_1_1-2002-01-24-release:1.3
	gdb_5_1_0_1-2002-01-03-release:1.3
	cygnus_cvs_20020108_pre:1.3
	gdb_5_1_0_1-2002-01-03-branchpoint:1.3
	gdb_5_1_0_1-2002-01-03-branch:1.3.0.8
	gdb_5_1-2001-11-21-release:1.3
	gdb_s390-2001-09-26-branch:1.3.0.6
	gdb_s390-2001-09-26-branchpoint:1.3
	gdb_5_1-2001-07-29-branch:1.3.0.4
	gdb_5_1-2001-07-29-branchpoint:1.3
	dberlin-typesystem-branch:1.3.0.2
	dberlin-typesystem-branchpoint:1.3
	gdb-post-ptid_t-2001-05-03:1.3
	gdb-pre-ptid_t-2001-05-03:1.3
	insight-precleanup-2001-01-01:1.1.1.2
	gdb-post-protoization-2000-07-29:1.1.1.2
	gdb-pre-protoization-2000-07-29:1.1.1.2
	gdb-premipsmulti-2000-06-06-branch:1.1.1.2.0.4
	gdb-premipsmulti-2000-06-06-branchpoint:1.1.1.2
	gdb-post-params-removal-2000-06-04:1.1.1.2
	gdb-pre-params-removal-2000-06-04:1.1.1.2
	gdb-post-params-removal-2000-05-28:1.1.1.2
	gdb-pre-params-removal-2000-05-28:1.1.1.2
	gdb_5_0-2000-05-19-release:1.1.1.2
	gdb_4_18_2-2000-05-18-release:1.1.1.2
	gdb_4_95_1-2000-05-11-snapshot:1.1.1.2
	gdb_4_95_0-2000-04-27-snapshot:1.1.1.2
	gdb_5_0-2000-04-10-branch:1.1.1.2.0.2
	gdb_5_0-2000-04-10-branchpoint:1.1.1.2
	repo-unification-2000-02-06:1.1.1.2
	insight-2000-02-04:1.1.1.2
	gdb-2000-02-04:1.1.1.2
	gdb-2000-02-02:1.1.1.2
	gdb-2000-02-01:1.1.1.2
	gdb-2000-01-31:1.1.1.2
	gdb-2000-01-26:1.1.1.2
	gdb-2000-01-24:1.1.1.2
	gdb-2000-01-17:1.1.1.2
	gdb-2000-01-10:1.1.1.2
	gdb-2000-01-05:1.1.1.2
	gdb-1999-12-21:1.1.1.2
	gdb-1999-12-13:1.1.1.2
	gdb-1999-12-07:1.1.1.2
	gdb-1999-12-06:1.1.1.2
	gdb-1999-11-16:1.1.1.2
	gdb-1999-11-08:1.1.1.2
	gdb-1999-11-01:1.1.1.2
	gdb-1999-10-25:1.1.1.2
	gdb-1999-10-18:1.1.1.2
	gdb-1999-10-11:1.1.1.2
	gdb-1999-10-04:1.1.1.2
	gdb-1999-09-28:1.1.1.2
	gdb-1999-09-21:1.1.1.2
	gdb-1999-09-13:1.1.1.2
	gdb-1999-09-08:1.1.1.2
	gdb-1999-08-30:1.1.1.2
	gdb-1999-08-23:1.1.1.2
	gdb-1999-08-16:1.1.1.2
	gdb-1999-08-09:1.1.1.2
	gdb-1999-08-02:1.1.1.2
	gdb-1999-07-26:1.1.1.2
	gdb-1999-07-19:1.1.1.2
	gdb-1999-07-12:1.1.1.2
	gdb-post-reformat-19990707:1.1.1.2
	gdb-1999-07-07-post-reformat-snapshot:1.1.1.2
	gdb-pre-reformat-19990707:1.1.1.1
	gdb-1999-07-07:1.1.1.1
	gdb-1999-07-05:1.1.1.1
	gdb-1999-06-28:1.1.1.1
	gdb-1999-06-21:1.1.1.1
	gdb-1999-06-14:1.1.1.1
	gdb-1999-06-07:1.1.1.1
	gdb-1999-06-01:1.1.1.1
	gdb-4_18-branch:1.1.1.1.0.2
	gdb-4_18-release:1.1.1.1
	gdb-1999-05-25:1.1.1.1
	gdb-1999-05-19:1.1.1.1
	gdb-1999-05-10:1.1.1.1
	gdb-19990504:1.1.1.1
	gdb-19990422:1.1.1.1
	SNAPSHOT:1.1.1
	gdb-4_18:1.1.1.1
	GDB_4_18:1.1.1;
locks; strict;
comment	@ * @;
expand	@o@;


1.6
date	2003.10.06.20.23.40;	author cagney;	state dead;
branches;
next	1.5;

1.5
date	2003.03.27.15.23.17;	author cagney;	state Exp;
branches
	1.5.24.1;
next	1.4;

1.4
date	2002.12.23.17.07.28;	author drow;	state Exp;
branches
	1.4.14.1;
next	1.3;

1.3
date	2001.03.14.23.23.14;	author cagney;	state Exp;
branches
	1.3.24.1
	1.3.26.1;
next	1.2;

1.2
date	2001.03.06.08.21.34;	author kevinb;	state Exp;
branches;
next	1.1;

1.1
date	99.04.16.01.34.24;	author shebs;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	99.04.16.01.34.24;	author shebs;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	99.07.07.20.16.15;	author jsm;	state Exp;
branches;
next	;

1.3.24.1
date	2002.12.23.19.39.04;	author carlton;	state Exp;
branches;
next	1.3.24.2;

1.3.24.2
date	2003.04.16.19.56.58;	author carlton;	state Exp;
branches;
next	1.3.24.3;

1.3.24.3
date	2003.11.11.23.51.06;	author carlton;	state dead;
branches;
next	;

1.3.26.1
date	2003.12.14.20.27.40;	author drow;	state dead;
branches;
next	;

1.4.14.1
date	2003.03.30.16.35.23;	author cagney;	state Exp;
branches;
next	;

1.5.24.1
date	2004.03.23.20.30.16;	author ezannoni;	state dead;
branches;
next	;


desc
@@


1.6
log
@2003-10-06  Andrew Cagney  <cagney@@redhat.com>

	* config/nm-m3.h, config/h8500/h8500.mt: Delete obsolete files.
	* config/h8500/tm-h8500.h, config/i386/nm-ptx4.h: Ditto.
	* config/i386/nm-symmetry.h, config/i386/ptx.mh: Ditto.
	* config/i386/ptx.mt, config/i386/ptx4.mh: Ditto.
	* config/i386/ptx4.mt, config/i386/symmetry.mh: Ditto.
	* config/i386/symmetry.mt, config/i386/tm-ptx.h: Ditto.
	* config/i386/tm-ptx4.h, config/i386/tm-symmetry.h: Ditto.
	* config/i386/xm-ptx.h, config/i386/xm-ptx4.h: Ditto.
	* config/i386/xm-symmetry.h, config/mips/mipsm3.mh: Ditto.
	* config/mips/mipsm3.mt, config/mips/tm-mipsm3.h: Ditto.
	* config/mips/xm-mipsm3.h, config/mn10200/mn10200.mt: Ditto.
	* config/mn10200/tm-mn10200.h, config/pa/hppabsd.mh: Ditto.
	* config/pa/hppabsd.mt, config/pa/hppaosf.mh: Ditto.
	* config/pa/hppaosf.mt, config/pa/hppapro.mt: Ditto.
	* config/pa/nm-hppab.h, config/pa/nm-hppao.h: Ditto.
	* config/pa/tm-hppab.h, config/pa/tm-hppao.h: Ditto.
	* config/pa/tm-pro.h, config/pa/xm-hppab.h: Ditto.
	* config/pa/xm-pa.h, config/sparc/sparclet.mt: Ditto.
	* config/sparc/sparclite.mt, config/sparc/tm-sparclet.h: Ditto.
	* config/sparc/tm-sparclite.h, config/z8k/tm-z8k.h: Ditto.
	* config/z8k/z8k.mt: Ditto.
@
text
@// OBSOLETE /* HPPA PA-RISC machine native support for BSD, for GDB.
// OBSOLETE    Copyright 1991, 1992, 1993, 1994, 1995, 2002 Free Software Foundation, Inc.
// OBSOLETE 
// OBSOLETE    This file is part of GDB.
// OBSOLETE 
// OBSOLETE    This program is free software; you can redistribute it and/or modify
// OBSOLETE    it under the terms of the GNU General Public License as published by
// OBSOLETE    the Free Software Foundation; either version 2 of the License, or
// OBSOLETE    (at your option) any later version.
// OBSOLETE 
// OBSOLETE    This program is distributed in the hope that it will be useful,
// OBSOLETE    but WITHOUT ANY WARRANTY; without even the implied warranty of
// OBSOLETE    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// OBSOLETE    GNU General Public License for more details.
// OBSOLETE 
// OBSOLETE    You should have received a copy of the GNU General Public License
// OBSOLETE    along with this program; if not, write to the Free Software
// OBSOLETE    Foundation, Inc., 59 Temple Place - Suite 330,
// OBSOLETE    Boston, MA 02111-1307, USA.  */
// OBSOLETE 
// OBSOLETE #include "somsolib.h"
// OBSOLETE #include "regcache.h"
// OBSOLETE 
// OBSOLETE #define U_REGS_OFFSET 0
// OBSOLETE 
// OBSOLETE #define KERNEL_U_ADDR 0
// OBSOLETE 
// OBSOLETE /* What a coincidence! */
// OBSOLETE #define REGISTER_U_ADDR(addr, blockend, regno)				\
// OBSOLETE { addr = (int)(blockend) + REGISTER_BYTE (regno);}
// OBSOLETE 
// OBSOLETE /* 3rd argument to ptrace is supposed to be a caddr_t.  */
// OBSOLETE 
// OBSOLETE #define	PTRACE_ARG3_TYPE caddr_t
// OBSOLETE 
// OBSOLETE /* HPUX 8.0, in its infinite wisdom, has chosen to prototype ptrace
// OBSOLETE    with five arguments, so programs written for normal ptrace lose.  */
// OBSOLETE #define FIVE_ARG_PTRACE
// OBSOLETE 
// OBSOLETE 
// OBSOLETE /* fetch_inferior_registers is in hppab-nat.c.  */
// OBSOLETE #define FETCH_INFERIOR_REGISTERS
// OBSOLETE 
// OBSOLETE /* attach/detach works to some extent under BSD and HPUX.  So long
// OBSOLETE    as the process you're attaching to isn't blocked waiting on io,
// OBSOLETE    blocked waiting on a signal, or in a system call things work 
// OBSOLETE    fine.  (The problems in those cases are related to the fact that
// OBSOLETE    the kernel can't provide complete register information for the
// OBSOLETE    target process...  Which really pisses off GDB.)  */
// OBSOLETE 
// OBSOLETE #define ATTACH_DETACH
// OBSOLETE 
// OBSOLETE /* The PA-BSD kernel has support for using the data memory break bit
// OBSOLETE    to implement fast watchpoints.
// OBSOLETE 
// OBSOLETE    Watchpoints on the PA act much like traditional page protection
// OBSOLETE    schemes, but with some notable differences.
// OBSOLETE 
// OBSOLETE    First, a special bit in the page table entry is used to cause
// OBSOLETE    a trap when a specific page is written to.  This avoids having
// OBSOLETE    to overload watchpoints on the page protection bits.  This makes
// OBSOLETE    it possible for the kernel to easily decide if a trap was caused
// OBSOLETE    by a watchpoint or by the user writing to protected memory and can
// OBSOLETE    signal the user program differently in each case.  
// OBSOLETE 
// OBSOLETE    Second, the PA has a bit in the processor status word which causes
// OBSOLETE    data memory breakpoints (aka watchpoints) to be disabled for a single
// OBSOLETE    instruction.  This bit can be used to avoid the overhead of unprotecting
// OBSOLETE    and reprotecting pages when it becomes necessary to step over a watchpoint.
// OBSOLETE 
// OBSOLETE 
// OBSOLETE    When the kernel receives a trap indicating a write to a page which
// OBSOLETE    is being watched, the kernel performs a couple of simple actions.  First
// OBSOLETE    is sets the magic "disable memory breakpoint" bit in the processor
// OBSOLETE    status word, it then sends a SIGTRAP to the process which caused the
// OBSOLETE    trap.
// OBSOLETE 
// OBSOLETE    GDB will take control and catch the signal for the inferior.  GDB then
// OBSOLETE    examines the PSW-X bit to determine if the SIGTRAP was caused by a 
// OBSOLETE    watchpoint firing.  If so GDB single steps the inferior over the
// OBSOLETE    instruction which caused the watchpoint to trigger (note because the
// OBSOLETE    kernel disabled the data memory break bit for one instruction no trap
// OBSOLETE    will be taken!).  GDB will then determines the appropriate action to
// OBSOLETE    take.  (this may include restarting the inferior if the watchpoint
// OBSOLETE    fired because of a write to an address on the same page as a watchpoint,
// OBSOLETE    but no write to the watched address occured).  */
// OBSOLETE 
// OBSOLETE #define TARGET_HAS_HARDWARE_WATCHPOINTS		/* Enable the code in procfs.c */
// OBSOLETE 
// OBSOLETE /* The PA can watch any number of locations, there's no need for it to reject
// OBSOLETE    anything (generic routines already check that all intermediates are
// OBSOLETE    in memory).  */
// OBSOLETE #define TARGET_CAN_USE_HARDWARE_WATCHPOINT(type, cnt, ot) \
// OBSOLETE 	((type) == bp_hardware_watchpoint)
// OBSOLETE 
// OBSOLETE /* When a hardware watchpoint fires off the PC will be left at the
// OBSOLETE    instruction which caused the watchpoint.  It will be necessary for
// OBSOLETE    GDB to step over the watchpoint.
// OBSOLETE 
// OBSOLETE    On a PA running BSD, it is trivial to identify when it will be
// OBSOLETE    necessary to step over a hardware watchpoint as we can examine
// OBSOLETE    the PSW-X bit.  If the bit is on, then we trapped because of a 
// OBSOLETE    watchpoint, else we trapped for some other reason.  */
// OBSOLETE #define STOPPED_BY_WATCHPOINT(W) \
// OBSOLETE   ((W).kind == TARGET_WAITKIND_STOPPED \
// OBSOLETE    && (W).value.sig == TARGET_SIGNAL_TRAP \
// OBSOLETE    && ((int) read_register (IPSW_REGNUM) & 0x00100000))
// OBSOLETE 
// OBSOLETE /* The PA can single step over a watchpoint if the kernel has set the
// OBSOLETE    "X" bit in the processor status word (disable data memory breakpoint
// OBSOLETE    for one instruction).
// OBSOLETE 
// OBSOLETE    The kernel will always set this bit before notifying the inferior
// OBSOLETE    that it hit a watchpoint.  Thus, the inferior can single step over
// OBSOLETE    the instruction which caused the watchpoint to fire.  This avoids
// OBSOLETE    the traditional need to disable the watchpoint, step the inferior,
// OBSOLETE    then enable the watchpoint again.  */
// OBSOLETE #define HAVE_STEPPABLE_WATCHPOINT
// OBSOLETE 
// OBSOLETE /* Use these macros for watchpoint insertion/deletion.  */
// OBSOLETE /* type can be 0: write watch, 1: read watch, 2: access watch (read/write) */
// OBSOLETE #define target_insert_watchpoint(addr, len, type) hppa_set_watchpoint (addr, len, 1)
// OBSOLETE #define target_remove_watchpoint(addr, len, type) hppa_set_watchpoint (addr, len, 0)
@


1.5
log
@2003-03-27  Andrew Cagney  <cagney@@redhat.com>

	* NEWS: Mention removal of support for hppa*-*-bsd* and
	hppa*-*-osf* natives, and hppa*-*-pro* target.
	* config/pa/xm-hppah.h: Do not include "pa/xm-pa.h".
	* config/pa/xm-pa.h: Obsolete file.
	* config/pa/xm-hppab.h: Obsolete file.
	* config/pa/nm-hppab.h: Obsolete file.
	* config/pa/tm-hppab.h: Obsolete file.
	* config/pa/tm-hppao.h: Obsolete file.
	* config/pa/nm-hppao.h: Obsolete file.
	* config/pa/tm-pro.h: Obsolete file.
	* config/pa/hppaosf.mt: Obsolete file.
	* config/pa/hppaosf.mh: Obsolete file.
	* config/pa/hppapro.mt: Obsolete file.
	* config/pa/hppabsd.mt: Obsolete file.
	* config/pa/hppabsd.mh: Obsolete file.
	* configure.host: Disable hppa*-*-bsd* and hppa*-*-osf*.
	* configure.tgt: Disable hppa*-*-bsd*, hppa*-*-pro* and
	hppa*-*-osf*.
@
text
@@


1.5.24.1
log
@merge mainline changes into branch
@
text
@@


1.4
log
@	* config/pa/nm-hppab.h: Delete duplicate CANNOT_STORE_REGISTER decl.
	* config/pa/nm-hppao.h: Delete duplicate CANNOT_STORE_REGISTER decl.

	* config/pa/nm-hppah.h: Delete duplicate CANNOT_STORE_REGISTER decl.
@
text
@d1 123
a123 123
/* HPPA PA-RISC machine native support for BSD, for GDB.
   Copyright 1991, 1992, 1993, 1994, 1995, 2002 Free Software Foundation, Inc.

   This file is part of GDB.

   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 2 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 59 Temple Place - Suite 330,
   Boston, MA 02111-1307, USA.  */

#include "somsolib.h"
#include "regcache.h"

#define U_REGS_OFFSET 0

#define KERNEL_U_ADDR 0

/* What a coincidence! */
#define REGISTER_U_ADDR(addr, blockend, regno)				\
{ addr = (int)(blockend) + REGISTER_BYTE (regno);}

/* 3rd argument to ptrace is supposed to be a caddr_t.  */

#define	PTRACE_ARG3_TYPE caddr_t

/* HPUX 8.0, in its infinite wisdom, has chosen to prototype ptrace
   with five arguments, so programs written for normal ptrace lose.  */
#define FIVE_ARG_PTRACE


/* fetch_inferior_registers is in hppab-nat.c.  */
#define FETCH_INFERIOR_REGISTERS

/* attach/detach works to some extent under BSD and HPUX.  So long
   as the process you're attaching to isn't blocked waiting on io,
   blocked waiting on a signal, or in a system call things work 
   fine.  (The problems in those cases are related to the fact that
   the kernel can't provide complete register information for the
   target process...  Which really pisses off GDB.)  */

#define ATTACH_DETACH

/* The PA-BSD kernel has support for using the data memory break bit
   to implement fast watchpoints.

   Watchpoints on the PA act much like traditional page protection
   schemes, but with some notable differences.

   First, a special bit in the page table entry is used to cause
   a trap when a specific page is written to.  This avoids having
   to overload watchpoints on the page protection bits.  This makes
   it possible for the kernel to easily decide if a trap was caused
   by a watchpoint or by the user writing to protected memory and can
   signal the user program differently in each case.  

   Second, the PA has a bit in the processor status word which causes
   data memory breakpoints (aka watchpoints) to be disabled for a single
   instruction.  This bit can be used to avoid the overhead of unprotecting
   and reprotecting pages when it becomes necessary to step over a watchpoint.


   When the kernel receives a trap indicating a write to a page which
   is being watched, the kernel performs a couple of simple actions.  First
   is sets the magic "disable memory breakpoint" bit in the processor
   status word, it then sends a SIGTRAP to the process which caused the
   trap.

   GDB will take control and catch the signal for the inferior.  GDB then
   examines the PSW-X bit to determine if the SIGTRAP was caused by a 
   watchpoint firing.  If so GDB single steps the inferior over the
   instruction which caused the watchpoint to trigger (note because the
   kernel disabled the data memory break bit for one instruction no trap
   will be taken!).  GDB will then determines the appropriate action to
   take.  (this may include restarting the inferior if the watchpoint
   fired because of a write to an address on the same page as a watchpoint,
   but no write to the watched address occured).  */

#define TARGET_HAS_HARDWARE_WATCHPOINTS		/* Enable the code in procfs.c */

/* The PA can watch any number of locations, there's no need for it to reject
   anything (generic routines already check that all intermediates are
   in memory).  */
#define TARGET_CAN_USE_HARDWARE_WATCHPOINT(type, cnt, ot) \
	((type) == bp_hardware_watchpoint)

/* When a hardware watchpoint fires off the PC will be left at the
   instruction which caused the watchpoint.  It will be necessary for
   GDB to step over the watchpoint.

   On a PA running BSD, it is trivial to identify when it will be
   necessary to step over a hardware watchpoint as we can examine
   the PSW-X bit.  If the bit is on, then we trapped because of a 
   watchpoint, else we trapped for some other reason.  */
#define STOPPED_BY_WATCHPOINT(W) \
  ((W).kind == TARGET_WAITKIND_STOPPED \
   && (W).value.sig == TARGET_SIGNAL_TRAP \
   && ((int) read_register (IPSW_REGNUM) & 0x00100000))

/* The PA can single step over a watchpoint if the kernel has set the
   "X" bit in the processor status word (disable data memory breakpoint
   for one instruction).

   The kernel will always set this bit before notifying the inferior
   that it hit a watchpoint.  Thus, the inferior can single step over
   the instruction which caused the watchpoint to fire.  This avoids
   the traditional need to disable the watchpoint, step the inferior,
   then enable the watchpoint again.  */
#define HAVE_STEPPABLE_WATCHPOINT

/* Use these macros for watchpoint insertion/deletion.  */
/* type can be 0: write watch, 1: read watch, 2: access watch (read/write) */
#define target_insert_watchpoint(addr, len, type) hppa_set_watchpoint (addr, len, 1)
#define target_remove_watchpoint(addr, len, type) hppa_set_watchpoint (addr, len, 0)
@


1.4.14.1
log
@Merge with mainline.
@
text
@d1 123
a123 123
// OBSOLETE /* HPPA PA-RISC machine native support for BSD, for GDB.
// OBSOLETE    Copyright 1991, 1992, 1993, 1994, 1995, 2002 Free Software Foundation, Inc.
// OBSOLETE 
// OBSOLETE    This file is part of GDB.
// OBSOLETE 
// OBSOLETE    This program is free software; you can redistribute it and/or modify
// OBSOLETE    it under the terms of the GNU General Public License as published by
// OBSOLETE    the Free Software Foundation; either version 2 of the License, or
// OBSOLETE    (at your option) any later version.
// OBSOLETE 
// OBSOLETE    This program is distributed in the hope that it will be useful,
// OBSOLETE    but WITHOUT ANY WARRANTY; without even the implied warranty of
// OBSOLETE    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// OBSOLETE    GNU General Public License for more details.
// OBSOLETE 
// OBSOLETE    You should have received a copy of the GNU General Public License
// OBSOLETE    along with this program; if not, write to the Free Software
// OBSOLETE    Foundation, Inc., 59 Temple Place - Suite 330,
// OBSOLETE    Boston, MA 02111-1307, USA.  */
// OBSOLETE 
// OBSOLETE #include "somsolib.h"
// OBSOLETE #include "regcache.h"
// OBSOLETE 
// OBSOLETE #define U_REGS_OFFSET 0
// OBSOLETE 
// OBSOLETE #define KERNEL_U_ADDR 0
// OBSOLETE 
// OBSOLETE /* What a coincidence! */
// OBSOLETE #define REGISTER_U_ADDR(addr, blockend, regno)				\
// OBSOLETE { addr = (int)(blockend) + REGISTER_BYTE (regno);}
// OBSOLETE 
// OBSOLETE /* 3rd argument to ptrace is supposed to be a caddr_t.  */
// OBSOLETE 
// OBSOLETE #define	PTRACE_ARG3_TYPE caddr_t
// OBSOLETE 
// OBSOLETE /* HPUX 8.0, in its infinite wisdom, has chosen to prototype ptrace
// OBSOLETE    with five arguments, so programs written for normal ptrace lose.  */
// OBSOLETE #define FIVE_ARG_PTRACE
// OBSOLETE 
// OBSOLETE 
// OBSOLETE /* fetch_inferior_registers is in hppab-nat.c.  */
// OBSOLETE #define FETCH_INFERIOR_REGISTERS
// OBSOLETE 
// OBSOLETE /* attach/detach works to some extent under BSD and HPUX.  So long
// OBSOLETE    as the process you're attaching to isn't blocked waiting on io,
// OBSOLETE    blocked waiting on a signal, or in a system call things work 
// OBSOLETE    fine.  (The problems in those cases are related to the fact that
// OBSOLETE    the kernel can't provide complete register information for the
// OBSOLETE    target process...  Which really pisses off GDB.)  */
// OBSOLETE 
// OBSOLETE #define ATTACH_DETACH
// OBSOLETE 
// OBSOLETE /* The PA-BSD kernel has support for using the data memory break bit
// OBSOLETE    to implement fast watchpoints.
// OBSOLETE 
// OBSOLETE    Watchpoints on the PA act much like traditional page protection
// OBSOLETE    schemes, but with some notable differences.
// OBSOLETE 
// OBSOLETE    First, a special bit in the page table entry is used to cause
// OBSOLETE    a trap when a specific page is written to.  This avoids having
// OBSOLETE    to overload watchpoints on the page protection bits.  This makes
// OBSOLETE    it possible for the kernel to easily decide if a trap was caused
// OBSOLETE    by a watchpoint or by the user writing to protected memory and can
// OBSOLETE    signal the user program differently in each case.  
// OBSOLETE 
// OBSOLETE    Second, the PA has a bit in the processor status word which causes
// OBSOLETE    data memory breakpoints (aka watchpoints) to be disabled for a single
// OBSOLETE    instruction.  This bit can be used to avoid the overhead of unprotecting
// OBSOLETE    and reprotecting pages when it becomes necessary to step over a watchpoint.
// OBSOLETE 
// OBSOLETE 
// OBSOLETE    When the kernel receives a trap indicating a write to a page which
// OBSOLETE    is being watched, the kernel performs a couple of simple actions.  First
// OBSOLETE    is sets the magic "disable memory breakpoint" bit in the processor
// OBSOLETE    status word, it then sends a SIGTRAP to the process which caused the
// OBSOLETE    trap.
// OBSOLETE 
// OBSOLETE    GDB will take control and catch the signal for the inferior.  GDB then
// OBSOLETE    examines the PSW-X bit to determine if the SIGTRAP was caused by a 
// OBSOLETE    watchpoint firing.  If so GDB single steps the inferior over the
// OBSOLETE    instruction which caused the watchpoint to trigger (note because the
// OBSOLETE    kernel disabled the data memory break bit for one instruction no trap
// OBSOLETE    will be taken!).  GDB will then determines the appropriate action to
// OBSOLETE    take.  (this may include restarting the inferior if the watchpoint
// OBSOLETE    fired because of a write to an address on the same page as a watchpoint,
// OBSOLETE    but no write to the watched address occured).  */
// OBSOLETE 
// OBSOLETE #define TARGET_HAS_HARDWARE_WATCHPOINTS		/* Enable the code in procfs.c */
// OBSOLETE 
// OBSOLETE /* The PA can watch any number of locations, there's no need for it to reject
// OBSOLETE    anything (generic routines already check that all intermediates are
// OBSOLETE    in memory).  */
// OBSOLETE #define TARGET_CAN_USE_HARDWARE_WATCHPOINT(type, cnt, ot) \
// OBSOLETE 	((type) == bp_hardware_watchpoint)
// OBSOLETE 
// OBSOLETE /* When a hardware watchpoint fires off the PC will be left at the
// OBSOLETE    instruction which caused the watchpoint.  It will be necessary for
// OBSOLETE    GDB to step over the watchpoint.
// OBSOLETE 
// OBSOLETE    On a PA running BSD, it is trivial to identify when it will be
// OBSOLETE    necessary to step over a hardware watchpoint as we can examine
// OBSOLETE    the PSW-X bit.  If the bit is on, then we trapped because of a 
// OBSOLETE    watchpoint, else we trapped for some other reason.  */
// OBSOLETE #define STOPPED_BY_WATCHPOINT(W) \
// OBSOLETE   ((W).kind == TARGET_WAITKIND_STOPPED \
// OBSOLETE    && (W).value.sig == TARGET_SIGNAL_TRAP \
// OBSOLETE    && ((int) read_register (IPSW_REGNUM) & 0x00100000))
// OBSOLETE 
// OBSOLETE /* The PA can single step over a watchpoint if the kernel has set the
// OBSOLETE    "X" bit in the processor status word (disable data memory breakpoint
// OBSOLETE    for one instruction).
// OBSOLETE 
// OBSOLETE    The kernel will always set this bit before notifying the inferior
// OBSOLETE    that it hit a watchpoint.  Thus, the inferior can single step over
// OBSOLETE    the instruction which caused the watchpoint to fire.  This avoids
// OBSOLETE    the traditional need to disable the watchpoint, step the inferior,
// OBSOLETE    then enable the watchpoint again.  */
// OBSOLETE #define HAVE_STEPPABLE_WATCHPOINT
// OBSOLETE 
// OBSOLETE /* Use these macros for watchpoint insertion/deletion.  */
// OBSOLETE /* type can be 0: write watch, 1: read watch, 2: access watch (read/write) */
// OBSOLETE #define target_insert_watchpoint(addr, len, type) hppa_set_watchpoint (addr, len, 1)
// OBSOLETE #define target_remove_watchpoint(addr, len, type) hppa_set_watchpoint (addr, len, 0)
@


1.3
log
@Include regcache.h
@
text
@d2 1
a2 1
   Copyright 1991, 1992, 1993, 1994, 1995 Free Software Foundation, Inc.
a39 14

/* This macro defines the register numbers (from REGISTER_NAMES) that
   are effectively unavailable to the user through ptrace().  It allows
   us to include the whole register set in REGISTER_NAMES (inorder to
   better support remote debugging).  If it is used in
   fetch/store_inferior_registers() gdb will not complain about I/O errors
   on fetching these registers.  If all registers in REGISTER_NAMES
   are available, then return false (0).  */

#define CANNOT_STORE_REGISTER(regno)            \
                   ((regno) == 0) ||     \
                   ((regno) == PCSQ_HEAD_REGNUM) || \
                   ((regno) >= PCSQ_TAIL_REGNUM && (regno) < IPSW_REGNUM) ||  \
                   ((regno) > IPSW_REGNUM && (regno) < FP4_REGNUM)
@


1.3.26.1
log
@Merge drow-cplus-branch to:
  cvs rtag -D 2003-12-14 00:00:00 UTC drow-cplus-merge-20031214 gdb+dejagnu
@
text
@@


1.3.24.1
log
@2002-12-23  David Carlton  <carlton@@math.stanford.edu>

	* Merge from mainline; tag is carlton_dictionary-20021223-merge.
@
text
@d2 1
a2 1
   Copyright 1991, 1992, 1993, 1994, 1995, 2002 Free Software Foundation, Inc.
d40 14
@


1.3.24.2
log
@2003-04-16  David Carlton  <carlton@@bactrian.org>

	* Merge with mainline; tag is carlton_dictionary-20030416-merge.
@
text
@d1 123
a123 123
// OBSOLETE /* HPPA PA-RISC machine native support for BSD, for GDB.
// OBSOLETE    Copyright 1991, 1992, 1993, 1994, 1995, 2002 Free Software Foundation, Inc.
// OBSOLETE 
// OBSOLETE    This file is part of GDB.
// OBSOLETE 
// OBSOLETE    This program is free software; you can redistribute it and/or modify
// OBSOLETE    it under the terms of the GNU General Public License as published by
// OBSOLETE    the Free Software Foundation; either version 2 of the License, or
// OBSOLETE    (at your option) any later version.
// OBSOLETE 
// OBSOLETE    This program is distributed in the hope that it will be useful,
// OBSOLETE    but WITHOUT ANY WARRANTY; without even the implied warranty of
// OBSOLETE    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// OBSOLETE    GNU General Public License for more details.
// OBSOLETE 
// OBSOLETE    You should have received a copy of the GNU General Public License
// OBSOLETE    along with this program; if not, write to the Free Software
// OBSOLETE    Foundation, Inc., 59 Temple Place - Suite 330,
// OBSOLETE    Boston, MA 02111-1307, USA.  */
// OBSOLETE 
// OBSOLETE #include "somsolib.h"
// OBSOLETE #include "regcache.h"
// OBSOLETE 
// OBSOLETE #define U_REGS_OFFSET 0
// OBSOLETE 
// OBSOLETE #define KERNEL_U_ADDR 0
// OBSOLETE 
// OBSOLETE /* What a coincidence! */
// OBSOLETE #define REGISTER_U_ADDR(addr, blockend, regno)				\
// OBSOLETE { addr = (int)(blockend) + REGISTER_BYTE (regno);}
// OBSOLETE 
// OBSOLETE /* 3rd argument to ptrace is supposed to be a caddr_t.  */
// OBSOLETE 
// OBSOLETE #define	PTRACE_ARG3_TYPE caddr_t
// OBSOLETE 
// OBSOLETE /* HPUX 8.0, in its infinite wisdom, has chosen to prototype ptrace
// OBSOLETE    with five arguments, so programs written for normal ptrace lose.  */
// OBSOLETE #define FIVE_ARG_PTRACE
// OBSOLETE 
// OBSOLETE 
// OBSOLETE /* fetch_inferior_registers is in hppab-nat.c.  */
// OBSOLETE #define FETCH_INFERIOR_REGISTERS
// OBSOLETE 
// OBSOLETE /* attach/detach works to some extent under BSD and HPUX.  So long
// OBSOLETE    as the process you're attaching to isn't blocked waiting on io,
// OBSOLETE    blocked waiting on a signal, or in a system call things work 
// OBSOLETE    fine.  (The problems in those cases are related to the fact that
// OBSOLETE    the kernel can't provide complete register information for the
// OBSOLETE    target process...  Which really pisses off GDB.)  */
// OBSOLETE 
// OBSOLETE #define ATTACH_DETACH
// OBSOLETE 
// OBSOLETE /* The PA-BSD kernel has support for using the data memory break bit
// OBSOLETE    to implement fast watchpoints.
// OBSOLETE 
// OBSOLETE    Watchpoints on the PA act much like traditional page protection
// OBSOLETE    schemes, but with some notable differences.
// OBSOLETE 
// OBSOLETE    First, a special bit in the page table entry is used to cause
// OBSOLETE    a trap when a specific page is written to.  This avoids having
// OBSOLETE    to overload watchpoints on the page protection bits.  This makes
// OBSOLETE    it possible for the kernel to easily decide if a trap was caused
// OBSOLETE    by a watchpoint or by the user writing to protected memory and can
// OBSOLETE    signal the user program differently in each case.  
// OBSOLETE 
// OBSOLETE    Second, the PA has a bit in the processor status word which causes
// OBSOLETE    data memory breakpoints (aka watchpoints) to be disabled for a single
// OBSOLETE    instruction.  This bit can be used to avoid the overhead of unprotecting
// OBSOLETE    and reprotecting pages when it becomes necessary to step over a watchpoint.
// OBSOLETE 
// OBSOLETE 
// OBSOLETE    When the kernel receives a trap indicating a write to a page which
// OBSOLETE    is being watched, the kernel performs a couple of simple actions.  First
// OBSOLETE    is sets the magic "disable memory breakpoint" bit in the processor
// OBSOLETE    status word, it then sends a SIGTRAP to the process which caused the
// OBSOLETE    trap.
// OBSOLETE 
// OBSOLETE    GDB will take control and catch the signal for the inferior.  GDB then
// OBSOLETE    examines the PSW-X bit to determine if the SIGTRAP was caused by a 
// OBSOLETE    watchpoint firing.  If so GDB single steps the inferior over the
// OBSOLETE    instruction which caused the watchpoint to trigger (note because the
// OBSOLETE    kernel disabled the data memory break bit for one instruction no trap
// OBSOLETE    will be taken!).  GDB will then determines the appropriate action to
// OBSOLETE    take.  (this may include restarting the inferior if the watchpoint
// OBSOLETE    fired because of a write to an address on the same page as a watchpoint,
// OBSOLETE    but no write to the watched address occured).  */
// OBSOLETE 
// OBSOLETE #define TARGET_HAS_HARDWARE_WATCHPOINTS		/* Enable the code in procfs.c */
// OBSOLETE 
// OBSOLETE /* The PA can watch any number of locations, there's no need for it to reject
// OBSOLETE    anything (generic routines already check that all intermediates are
// OBSOLETE    in memory).  */
// OBSOLETE #define TARGET_CAN_USE_HARDWARE_WATCHPOINT(type, cnt, ot) \
// OBSOLETE 	((type) == bp_hardware_watchpoint)
// OBSOLETE 
// OBSOLETE /* When a hardware watchpoint fires off the PC will be left at the
// OBSOLETE    instruction which caused the watchpoint.  It will be necessary for
// OBSOLETE    GDB to step over the watchpoint.
// OBSOLETE 
// OBSOLETE    On a PA running BSD, it is trivial to identify when it will be
// OBSOLETE    necessary to step over a hardware watchpoint as we can examine
// OBSOLETE    the PSW-X bit.  If the bit is on, then we trapped because of a 
// OBSOLETE    watchpoint, else we trapped for some other reason.  */
// OBSOLETE #define STOPPED_BY_WATCHPOINT(W) \
// OBSOLETE   ((W).kind == TARGET_WAITKIND_STOPPED \
// OBSOLETE    && (W).value.sig == TARGET_SIGNAL_TRAP \
// OBSOLETE    && ((int) read_register (IPSW_REGNUM) & 0x00100000))
// OBSOLETE 
// OBSOLETE /* The PA can single step over a watchpoint if the kernel has set the
// OBSOLETE    "X" bit in the processor status word (disable data memory breakpoint
// OBSOLETE    for one instruction).
// OBSOLETE 
// OBSOLETE    The kernel will always set this bit before notifying the inferior
// OBSOLETE    that it hit a watchpoint.  Thus, the inferior can single step over
// OBSOLETE    the instruction which caused the watchpoint to fire.  This avoids
// OBSOLETE    the traditional need to disable the watchpoint, step the inferior,
// OBSOLETE    then enable the watchpoint again.  */
// OBSOLETE #define HAVE_STEPPABLE_WATCHPOINT
// OBSOLETE 
// OBSOLETE /* Use these macros for watchpoint insertion/deletion.  */
// OBSOLETE /* type can be 0: write watch, 1: read watch, 2: access watch (read/write) */
// OBSOLETE #define target_insert_watchpoint(addr, len, type) hppa_set_watchpoint (addr, len, 1)
// OBSOLETE #define target_remove_watchpoint(addr, len, type) hppa_set_watchpoint (addr, len, 0)
@


1.3.24.3
log
@2003-11-11  David Carlton  <carlton@@kealia.com>

	* Merge with mainline; tag is carlton-dictionary-20031111-merge.
@
text
@@


1.2
log
@Update/correct copyright notices.
@
text
@d22 1
@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
   Copyright 1991, 1992 Free Software Foundation, Inc. 
d4 1
a4 1
This file is part of GDB.
d6 14
a19 13
This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
d78 1
a78 1
   
d101 1
a101 1
#define TARGET_HAS_HARDWARE_WATCHPOINTS	/* Enable the code in procfs.c */
@


1.1.1.1
log
@Initial creation of sourceware repository
@
text
@@


1.1.1.2
log
@import gdb-1999-07-07 post reformat
@
text
@d4 1
a4 1
   This file is part of GDB.
d6 13
a18 14
   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 2 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 59 Temple Place - Suite 330,
   Boston, MA 02111-1307, USA.  */
d77 1
a77 1

d100 1
a100 1
#define TARGET_HAS_HARDWARE_WATCHPOINTS		/* Enable the code in procfs.c */
@

