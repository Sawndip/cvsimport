head	1.3;
access;
symbols
	cagney_x86i386-20030821-branch:1.2.0.60
	cagney_x86i386-20030821-branchpoint:1.2
	carlton_dictionary-20030805-merge:1.2
	carlton_dictionary-20030627-merge:1.2
	gdb_6_0-branch:1.2.0.58
	gdb_6_0-2003-06-23-branchpoint:1.2
	jimb-ppc64-linux-20030613-branch:1.2.0.56
	jimb-ppc64-linux-20030613-branchpoint:1.2
	cagney_writestrings-20030508-branch:1.2.0.54
	cagney_writestrings-20030508-branchpoint:1.2
	jimb-ppc64-linux-20030528-branch:1.2.0.52
	jimb-ppc64-linux-20030528-branchpoint:1.2
	carlton_dictionary-20030523-merge:1.2
	cagney_fileio-20030521-branch:1.2.0.50
	cagney_fileio-20030521-branchpoint:1.2
	kettenis_i386newframe-20030517-mergepoint:1.2
	jimb-ppc64-linux-20030509-branch:1.2.0.48
	jimb-ppc64-linux-20030509-branchpoint:1.2
	kettenis_i386newframe-20030504-mergepoint:1.2
	carlton_dictionary-20030430-merge:1.2
	kettenis_i386newframe-20030419-branch:1.2.0.46
	kettenis_i386newframe-20030419-branchpoint:1.2
	carlton_dictionary-20030416-merge:1.2
	cagney_frameaddr-20030409-mergepoint:1.2
	kettenis_i386newframe-20030406-branch:1.2.0.44
	kettenis_i386newframe-20030406-branchpoint:1.2
	cagney_frameaddr-20030403-branchpoint:1.2
	cagney_frameaddr-20030403-branch:1.2.0.42
	cagney_framebase-20030330-mergepoint:1.2
	cagney_framebase-20030326-branch:1.2.0.40
	cagney_framebase-20030326-branchpoint:1.2
	cagney_lazyid-20030317-branch:1.2.0.38
	cagney_lazyid-20030317-branchpoint:1.2
	kettenis-i386newframe-20030316-mergepoint:1.2
	offbyone-20030313-branch:1.2.0.36
	offbyone-20030313-branchpoint:1.2
	kettenis-i386newframe-20030308-branch:1.2.0.34
	kettenis-i386newframe-20030308-branchpoint:1.2
	carlton_dictionary-20030305-merge:1.2
	cagney_offbyone-20030303-branch:1.2.0.32
	cagney_offbyone-20030303-branchpoint:1.2
	carlton_dictionary-20030207-merge:1.2
	interps-20030203-mergepoint:1.2
	interps-20030202-branch:1.2.0.30
	interps-20030202-branchpoint:1.2
	cagney-unwind-20030108-branch:1.2.0.28
	cagney-unwind-20030108-branchpoint:1.2
	carlton_dictionary-20021223-merge:1.2
	gdb_5_3-2002-12-12-release:1.2
	carlton_dictionary-20021115-merge:1.2
	kseitz_interps-20021105-merge:1.2
	kseitz_interps-20021103-merge:1.2
	drow-cplus-merge-20021020:1.2
	drow-cplus-merge-20021025:1.2
	carlton_dictionary-20021025-merge:1.2
	carlton_dictionary-20021011-merge:1.2
	drow-cplus-branch:1.2.0.26
	drow-cplus-branchpoint:1.2
	kseitz_interps-20020930-merge:1.2
	carlton_dictionary-20020927-merge:1.2
	carlton_dictionary-branch:1.2.0.24
	carlton_dictionary-20020920-branchpoint:1.2
	gdb_5_3-branch:1.2.0.22
	gdb_5_3-2002-09-04-branchpoint:1.2
	kseitz_interps-20020829-merge:1.2
	cagney_sysregs-20020825-branch:1.2.0.20
	cagney_sysregs-20020825-branchpoint:1.2
	readline_4_3-import-branch:1.2.0.18
	readline_4_3-import-branchpoint:1.2
	gdb_5_2_1-2002-07-23-release:1.2
	kseitz_interps-20020528-branch:1.2.0.16
	kseitz_interps-20020528-branchpoint:1.2
	cagney_regbuf-20020515-branch:1.2.0.14
	cagney_regbuf-20020515-branchpoint:1.2
	jimb-macro-020506-branch:1.2.0.12
	jimb-macro-020506-branchpoint:1.2
	gdb_5_2-2002-04-29-release:1.2
	gdb_5_2-branch:1.2.0.10
	gdb_5_2-2002-03-03-branchpoint:1.2
	gdb_5_1_1-2002-01-24-release:1.2
	gdb_5_1_0_1-2002-01-03-release:1.2
	cygnus_cvs_20020108_pre:1.2
	gdb_5_1_0_1-2002-01-03-branch:1.2.0.8
	gdb_5_1_0_1-2002-01-03-branchpoint:1.2
	gdb_5_1-2001-11-21-release:1.2
	gdb_s390-2001-09-26-branch:1.2.0.6
	gdb_s390-2001-09-26-branchpoint:1.2
	gdb_5_1-2001-07-29-branch:1.2.0.4
	gdb_5_1-2001-07-29-branchpoint:1.2
	dberlin-typesystem-branch:1.2.0.2
	dberlin-typesystem-branchpoint:1.2
	gdb-post-ptid_t-2001-05-03:1.2
	gdb-pre-ptid_t-2001-05-03:1.2
	insight-precleanup-2001-01-01:1.1.1.4
	gdb-post-protoization-2000-07-29:1.1.1.4
	gdb-pre-protoization-2000-07-29:1.1.1.4
	gdb-premipsmulti-2000-06-06-branch:1.1.1.4.0.4
	gdb-premipsmulti-2000-06-06-branchpoint:1.1.1.4
	gdb-post-params-removal-2000-06-04:1.1.1.4
	gdb-pre-params-removal-2000-06-04:1.1.1.4
	gdb-post-params-removal-2000-05-28:1.1.1.4
	gdb-pre-params-removal-2000-05-28:1.1.1.4
	gdb_5_0-2000-05-19-release:1.1.1.4
	gdb_4_18_2-2000-05-18-release:1.1.1.4
	gdb_4_95_1-2000-05-11-snapshot:1.1.1.4
	gdb_4_95_0-2000-04-27-snapshot:1.1.1.4
	gdb_5_0-2000-04-10-branch:1.1.1.4.0.2
	gdb_5_0-2000-04-10-branchpoint:1.1.1.4
	repo-unification-2000-02-06:1.1.1.4
	insight-2000-02-04:1.1.1.4
	gdb-2000-02-04:1.1.1.4
	gdb-2000-02-02:1.1.1.4
	gdb-2000-02-01:1.1.1.4
	gdb-2000-01-31:1.1.1.4
	gdb-2000-01-26:1.1.1.4
	gdb-2000-01-24:1.1.1.4
	gdb-2000-01-17:1.1.1.4
	gdb-2000-01-10:1.1.1.4
	gdb-2000-01-05:1.1.1.4
	gdb-1999-12-21:1.1.1.4
	gdb-1999-12-13:1.1.1.4
	gdb-1999-12-07:1.1.1.4
	gdb-1999-12-06:1.1.1.4
	gdb-1999-11-16:1.1.1.4
	gdb-1999-11-08:1.1.1.4
	gdb-1999-11-01:1.1.1.4
	gdb-1999-10-25:1.1.1.4
	gdb-1999-10-18:1.1.1.4
	gdb-1999-10-11:1.1.1.4
	gdb-1999-10-04:1.1.1.4
	gdb-1999-09-28:1.1.1.4
	gdb-1999-09-21:1.1.1.4
	gdb-1999-09-13:1.1.1.4
	gdb-1999-09-08:1.1.1.4
	gdb-1999-08-30:1.1.1.3
	gdb-1999-08-23:1.1.1.3
	gdb-1999-08-16:1.1.1.3
	gdb-1999-08-09:1.1.1.3
	gdb-1999-08-02:1.1.1.3
	gdb-1999-07-26:1.1.1.2
	gdb-1999-07-19:1.1.1.2
	gdb-1999-07-12:1.1.1.2
	gdb-post-reformat-19990707:1.1.1.2
	gdb-1999-07-07-post-reformat-snapshot:1.1.1.2
	gdb-pre-reformat-19990707:1.1.1.2
	gdb-1999-07-07:1.1.1.2
	gdb-1999-07-05:1.1.1.2
	gdb-1999-06-28:1.1.1.2
	gdb-1999-06-21:1.1.1.1
	gdb-1999-06-14:1.1.1.1
	gdb-1999-06-07:1.1.1.1
	gdb-1999-06-01:1.1.1.1
	gdb-4_18-branch:1.1.1.1.0.2
	gdb-4_18-release:1.1.1.1
	gdb-1999-05-25:1.1.1.1
	gdb-1999-05-19:1.1.1.1
	gdb-1999-05-10:1.1.1.1
	gdb-19990504:1.1.1.1
	gdb-19990422:1.1.1.1
	SNAPSHOT:1.1.1
	gdb-4_18:1.1.1.1
	GDB_4_18:1.1.1;
locks; strict;
comment	@# @;
expand	@o@;


1.3
date	2003.08.23.03.55.59;	author chastain;	state dead;
branches;
next	1.2;

1.2
date	2001.03.06.08.21.53;	author kevinb;	state Exp;
branches
	1.2.24.1
	1.2.26.1
	1.2.58.1;
next	1.1;

1.1
date	99.04.16.01.34.32;	author shebs;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	99.04.16.01.34.32;	author shebs;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	99.06.28.16.04.28;	author jsm;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	99.08.02.23.46.55;	author jsm;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	99.09.09.00.00.28;	author shebs;	state Exp;
branches;
next	;

1.2.24.1
date	2003.08.30.03.40.34;	author chastain;	state dead;
branches;
next	;

1.2.26.1
date	2003.12.14.20.27.51;	author drow;	state dead;
branches;
next	;

1.2.58.1
date	2003.08.25.03.53.48;	author chastain;	state dead;
branches;
next	;


desc
@@


1.3
log
@2003-08-22  Michael Chastain  <mec@@shout.net>

	* gdb.cp: New directory.
	* gdb.cp/*: Copy from gdb.c++/*.
	* gdb.c++/*: Remove.
	* Makefile.in: Change gdb.c++ to gdb.cp.
	* configure.in:  Ditto.
	* configure: Regnerate.
@
text
@# Copyright 1998, 1999 Free Software Foundation, Inc.

# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  

# Please email any bugs, comments, and/or additions to this file to:
# bug-gdb@@prep.ai.mit.edu
# Tests for pointer-to-member support
# Written by Satish Pai <pai@@apollo.hp.com> 1997-08-19

# This file is part of the gdb testsuite


if $tracelevel then {
        strace $tracelevel
        }

if { [skip_cplus_tests] } { continue }

#
# test running programs
#

# Start with a fresh gdb
gdb_exit
gdb_start
gdb_reinitialize_dir $srcdir/$subdir

set prms_id 0
set bug_id 0

set testfile "member-ptr"
set srcfile ${testfile}.cc
set binfile ${objdir}/${subdir}/${testfile}

# Create and source the file that provides information about the compiler
# used to compile the test case.

if [get_compiler_info ${binfile} "c++"] {
    return -1
}

# Nearly all of these tests fail when compiled with G++, so just give up
# until GDB gets enhanced. -sts 1999-06-22

if {$gcc_compiled} {
    continue 
}

if  { [gdb_compile "${srcdir}/${subdir}/${srcfile}" "${binfile}" executable {debug c++}] != "" } {
     gdb_suppress_entire_file "Testcase compile failed, so all tests in this file will automatically fail."
}


gdb_exit
gdb_start
gdb_reinitialize_dir $srcdir/$subdir
gdb_load ${binfile}


if ![runto_main] then {
    perror "couldn't run to breakpoint"
    continue
}

send_gdb "break 83\n"
gdb_expect {
   -re "Breakpoint \[0-9\]*.*line 83\\.\r\n$gdb_prompt $" {
      pass "set break at 83"
    }
    -re ".*$gdb_prompt $" { fail "set break at 83" }
    timeout { fail "(timeout) set break at 83" }
}

send_gdb "continue\n"
gdb_expect {
   -re "Continuing\\.\r\n\r\nBreakpoint.*at.*member-ptr\\.cc:83\r\n83\[ \t]*pmi = NULL;\r\n$gdb_prompt $" {
      pass "continue to 83"
    }
    -re ".*$gdb_prompt $" { fail "continue to 83" }
    timeout { fail "(timeout) continue to 83" }
}

# ptype on pointer to data member

send_gdb "ptype pmi\n"
gdb_expect {
   -re "type = int \\( A::\\*\\)\r\n$gdb_prompt $" {
      pass "ptype pmi"
    }
    -re ".*$gdb_prompt $" { fail "ptype pmi" }
    timeout { fail "(timeout) ptype pmi" }
}

# print pointer to data member

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print pmi\n"
gdb_expect {
   -re "\\$\[0-9\]* = \\(int \\( A::\\*\\)\\) &A::j\r\n$gdb_prompt $" {
      pass "print pmi"
    }
    -re ".*$gdb_prompt $" { fail "print pmi" }
    timeout { fail "(timeout) print pmi" }
}


# print dereferenced pointer to data member

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print a.*pmi\n"
gdb_expect {
   -re "\\$\[0-9\]* = 121\r\n$gdb_prompt $" {
      pass "print a.*pmi"
    }
    -re ".*$gdb_prompt $" { fail "print a.*pmi" }
    timeout { fail "(timeout) print a.*pmi" }
}

# print dereferenced pointer to data member
# this time, dereferenced through a pointer

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print a_p->*pmi\n"
gdb_expect {
   -re "\\$\[0-9\]* = 121\r\n$gdb_prompt $" {
      pass "print a->*pmi"
    }
    -re ".*$gdb_prompt $" { fail "print a->*pmi" }
    timeout { fail "(timeout) print a->*pmi" }
}


# set the pointer to data member

send_gdb "set var pmi = &A::jj\n"
gdb_expect {
   -re "$gdb_prompt $" {
      pass "set var (not really a pass)"
    }
    timeout { fail "(timeout) " }
}

# Now print the pointer again

send_gdb "print pmi\n"
gdb_expect {
   -re "\\$\[0-9\]* = \\(int \\( A::\\*\\)\\) &A::jj\r\n$gdb_prompt $" {
      pass "print pmi after setting"
    }
    -re ".*$gdb_prompt $" { fail "print pmi after setting" }
    timeout { fail "(timeout) print pmi after setting" }
}

# print dereferenced pointer to data member again

send_gdb "print a.*pmi\n"
gdb_expect {
   -re "\\$\[0-9\]* = 1331\r\n$gdb_prompt $" {
      pass "print a.*pmi after setting"
    }
    -re ".*$gdb_prompt $" { fail "print a.*pmi after setting" }
    timeout { fail "(timeout) print a.*pmi after setting" }
}

# set the pointer to data member back to A::j

send_gdb "set var pmi = &A::j\n"
gdb_expect {
   -re "$gdb_prompt $" {
      pass "set var back to A::j (not really a pass)"
    }
    timeout { fail "(timeout) set var pmi" }
}

# print dereferenced pointer to data member yet again (extra check, why not)

send_gdb "print a.*pmi\n"
gdb_expect {
   -re "\\$\[0-9\]* = 121\r\n$gdb_prompt $" {
      pass "print a.*pmi after resetting"
    }
    -re ".*$gdb_prompt $" { fail "print a.*pmi after resetting" }
    timeout { fail "(timeout) print a.*pmi after resetting" }
}

# Set the data member pointed to.

send_gdb "print a.*pmi = 33\n"
gdb_expect {
   -re "\\$\[0-9\]* = 33\r\n$gdb_prompt $" {
      pass "print command to set"
    }
    -re ".*$gdb_prompt $" { fail "print command to set" }
    timeout { fail "(timeout) print command to set" }
}

# Now check that the data really was changed
send_gdb "print a.*pmi\n"
gdb_expect {
   -re "\\$\[0-9\]* = 33\r\n$gdb_prompt $" {
      pass "print a.*pmi after setting member pointed to"
    }
    -re ".*$gdb_prompt $" { fail "print a.*pmi after setting member pointed to" }
    timeout { fail "(timeout) print a.*pmi after setting member pointed to" }
}

# Double-check by printing a.
setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print a\n"
gdb_expect {
   -re "\\$\[0-9\]* = \{c = 120 'x', j = 33, jj = 1331, static s = 10, Virtual table at $hex\}\r\n$gdb_prompt $" {
      pass "print a after setting member pointed to by pmi"
    }
    -re ".*$gdb_prompt $" { fail "print a after setting member pointed to by pmi" }
    timeout { fail "(timeout) print a after setting member pointed to by pmi" }
}


# Set the data member pointed to, using ->*

send_gdb "print a_p->*pmi = 44\n"
gdb_expect {
   -re "\\$\[0-9\]* = 44\r\n$gdb_prompt $" {
      pass "print command to set (->)"
    }
    -re ".*$gdb_prompt $" { fail "print command to set (->)" }
    timeout { fail "(timeout) print command to set (->)" }
}

# Now check that the data really was changed
send_gdb "print a_p->*pmi\n"
gdb_expect {
   -re "\\$\[0-9\]* = 44\r\n$gdb_prompt $" {
      pass "print a_p->*pmi after setting member pointed to"
    }
    -re ".*$gdb_prompt $" { fail "print a_p->*pmi after setting member pointed to" }
    timeout { fail "(timeout) print a_p->*pmi after setting member pointed to" }
}

# Double-check by printing a.
setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print a\n"
gdb_expect {
   -re "\\$\[0-9\]* = \{c = 120 'x', j = 44, jj = 1331, static s = 10, Virtual table at $hex\}\r\n$gdb_prompt $" {
      pass "print a after setting member pointed to by pmi (->) "
    }
    -re ".*$gdb_prompt $" { fail "print a after setting member pointed to by pmi (->) " }
    timeout { fail "(timeout) print a after setting member pointed to by pmi (->) " }
}


# Do a ptype on the dereferenced pointer to member
# pai/1997-08-20 Doesn't work

# send_gdb "ptype a.*pmi\n"
# gdb_expect {
#   -re "type = int\r\n$gdb_prompt $" {
#      pass "ptype a.*pmi"
#    }
#    -re ".*$gdb_prompt $" { fail "ptype a.*pmi" }
#    timeout { fail "(timeout) ptype a.*pmi" }
#}

# Try to dereference the pointer to data member without any object

send_gdb "print *pmi\n"
gdb_expect {
   -re "Attempt to dereference pointer to member without an object\r\n$gdb_prompt $" {
      pass "attempt to print ptr to member without object"
    }
    -re ".*$gdb_prompt $" { fail "attempt to print ptr to member without object" }
    timeout { fail "(timeout) attempt to print ptr to member without object" }
}

# Try to ptype a dereference of the pointer to data member without any object

send_gdb "ptype *pmi\n"
gdb_expect {
   -re "Attempt to dereference pointer to member without an object\r\n$gdb_prompt $" {
      pass "attempt to ptype ptr to member without object"
    }
    -re ".*$gdb_prompt $" { fail "attempt to ptype ptr to member without object" }
    timeout { fail "(timeout) attempt to ptype ptr to member without object" }
}

# Ptype a pointer to a method.

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "ptype pmf\n"
gdb_expect {
   -re "type = int \\( A::\\*\\)\\(\\.\\.\\.\\)\r\n$gdb_prompt $" {
      pass "ptype pmf"
    }
    -re ".*$gdb_prompt $" { fail "ptype pmf" }
    timeout { fail "(timeout) ptype pmf" }
}

# print a pointer to a method

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print pmf\n"
gdb_expect {
   -re "\\$\[0-9\]* = \\(int \\( A::\\*\\)\\(\\.\\.\\.\\)\\) \\?\\? <not supported with HP aCC>\r\n$gdb_prompt $" {
      pass "print pmf"
    }
    -re ".*$gdb_prompt $" { fail "print pmf" }
    timeout { fail "(timeout) print pmf" }
}


# Ptype a pointer to a pointer to a method

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "ptype pmf_p\n"
gdb_expect {
   -re "type = int \\( A::\\*\\*\\)\\(\\.\\.\\.\\)\r\n$gdb_prompt $" {
      pass "ptype pmf_p"
    }
    -re ".*$gdb_prompt $" { fail "ptype pmf_p" }
    timeout { fail "(timeout) ptype pmf_p" }
}

# print a pointer to a pointer to a method

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print pmf_p\n"
gdb_expect {
   -re "\\$\[0-9\]* = \\(int \\( A::\\*\\*\\)\\(\\.\\.\\.\\)\\) $hex\r\n$gdb_prompt $" {
      pass "print pmf_p"
    }
    -re ".*$gdb_prompt $" { fail "print pmf_p" }
    timeout { fail "(timeout) print pmf_p" }
}

# print dereferenced pointer to method

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print a.*pmf\n"
gdb_expect {
   -re "Pointers to methods not supported with HP aCC\r\n$gdb_prompt $" {
      pass "print a.*pmf (known aCC limitation)"
    }
    -re ".*$gdb_prompt $" { fail "print a.*pmf" }
    timeout { fail "(timeout) print a.*pmf" }
}

# print dereferenced pointer to method, using ->*

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print a_p->*pmf\n"
gdb_expect {
   -re "Pointers to methods not supported with HP aCC\r\n$gdb_prompt $" {
      pass "print a_p->*pmf (known aCC limitation)"
    }
    -re ".*$gdb_prompt $" { fail "print a_p->*pmf" }
    timeout { fail "(timeout) print a_p->*pmf" }
}

# set the pointer to data member

setup_xfail "hppa*-*-*"
send_gdb "set var pmf = &A::foo\n"
gdb_expect {
   -re "Assignment to pointers to methods not implemented with HP aCC\r\n$gdb_prompt $" {
      pass "set var pmf (known aCC limitation)"
    }
    -re ".*$gdb_prompt $" { fail "set var pmf" }
    timeout { fail "(timeout) set var pmf" }
}

# Try to dereference the pointer to method without any object

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print *pmf\n"
gdb_expect {
   -re "Attempt to dereference pointer to member without an object\r\n$gdb_prompt $" {
      pass "attempt to print  ptr to method without object"
    }
    -re ".*$gdb_prompt $" { fail "attempt to print ptr to method without object" }
    timeout { fail "(timeout) attempt to print ptr to method without object" }
}

# Try to ptype a dereference of the pointer to method without any object

send_gdb "ptype *pmi\n"
gdb_expect {
   -re "Attempt to dereference pointer to member without an object\r\n$gdb_prompt $" {
      pass "attempt to ptype ptr to member without object"
    }
    -re ".*$gdb_prompt $" { fail "attempt to ptype ptr to member without object" }
    timeout { fail "(timeout) attempt to ptype ptr to member without object" }
}

# Check cast of pointer to member to integer
setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print (int) pmi\n"
gdb_expect {
   -re "\\$\[0-9\]* = 8\r\n$gdb_prompt $" {
      pass "casting pmi to int"
    }
    -re ".*$gdb_prompt $" { fail "casting pmi to int" }
    timeout { fail "(timeout) casting pmi to int" }
}

# Check cast of pointer to method to integer
setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print (int) pmf\n"
gdb_expect {
   -re "Pointers to methods not supported with HP aCC\r\n$gdb_prompt $" {
      pass "casting pmf to int (known aCC limitation)"
    }
    -re ".*$gdb_prompt $" { fail "casting pmf to int" }
    timeout { fail "(timeout) casting pmf to int" }
}

# Try to invoke a function through a pointer to data member
setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print (a.*pmi)(3)\n"
gdb_expect {
   -re "Not implemented: function invocation through pointer to method with HP aCC\r\n$gdb_prompt $" {
      pass "print (a.*pmi)(3) -- error message should be different"
    }
    -re ".*$gdb_prompt $" { fail "print (a.*pmi)(3)" }
    timeout { fail "(timeout) print (a.*pmi)(3)" }
}

# Try to invoke a function through a pointer to a method
setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print (a.*pmf)(3)\n"
gdb_expect {
   -re "Not implemented: function invocation through pointer to method with HP aCC\r\n$gdb_prompt $" {
      pass "print (a.*pmi)(3) -- known aCC limitation"
    }
    -re ".*$gdb_prompt $" { fail "print (a.*pmf)(3)" }
    timeout { fail "(timeout) print (a.*pmf)(3)" }
}


# Go past assignment of NULL to pmi
setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "next\n"
gdb_expect {
   -re "\r\n85\[ \t\]*k = \\(a.\\*pmf\\)\\(3\\);\r\n$gdb_prompt $" {
      pass "next past 83"
    }
    -re ".*$gdb_prompt $" { fail "next past 83" }
    timeout { fail "(timeout) next past 83" }
}

#send_gdb "print pmi\n"
#gdb_expect {
#   -re "Attempted dereference of null pointer-to-member\r\n$gdb_prompt $" {
#      pass ""
#    }
#    -re ".*$gdb_prompt $" { fail "" }
#    timeout { fail "(timeout) " }
#}

# Dereference the null pointer to member
setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print a.*pmi\n"
gdb_expect {
   -re "Attempted dereference of null pointer-to-member\r\n$gdb_prompt $" {
      pass "print a.*NULL"
    }
    -re ".*$gdb_prompt $" { fail "print a.*NULL" }
    timeout { fail "(timeout) print a.*NULL" }
}


# Go to another part of the program
send_gdb "break 91\n"
gdb_expect {
   -re "Breakpoint \[0-9\]*.*line 91\\.\r\n$gdb_prompt $" {
      pass "set break at 91"
    }
    -re ".*$gdb_prompt $" { fail "set break at 91" }
    timeout { fail "(timeout) set break at 91" }
}

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "continue\n"
gdb_expect {
   -re "Continuing\\.\r\n\r\nBreakpoint.*at.*member-ptr\\.cc:91\r\n91\[ \t]*k = \\(a.\\*pmf\\)\\(4\\);\r\n$gdb_prompt $" {
      pass "continue to 91"
    }
    -re ".*$gdb_prompt $" { fail "continue to 91" }
    timeout { fail "(timeout) continue to 91" }
}


# Now check again that pmi works even when not set to
# something that's at the beginning of the object

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print pmi\n"
gdb_expect {
   -re "\\$\[0-9\]* = \\(int \\( A::\\*\\)\\) &A::jj\r\n$gdb_prompt $" {
      pass "print pmi (2)"
    }
    -re ".*$gdb_prompt $" { fail "print pmi (2)" }
    timeout { fail "(timeout) print pmi (2)" }
}


# print dereferenced pointer to data member

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print a.*pmi\n"
gdb_expect {
   -re "\\$\[0-9\]* = 1331\r\n$gdb_prompt $" {
      pass "print a.*pmi (2)"
    }
    -re ".*$gdb_prompt $" { fail "print a.*pmi (2)" }
    timeout { fail "(timeout) print a.*pmi (2)" }
}

# print dereferenced pointer to data member
# this time, dereferenced through a pointer

setup_xfail "hppa*-*-*" CLLbs16901
send_gdb "print a_p->*pmi\n"
gdb_expect {
   -re "\\$\[0-9\]* = 1331\r\n$gdb_prompt $" {
      pass "print a->*pmi"
    }
    -re ".*$gdb_prompt $" { fail "print a->*pmi (2)" }
    timeout { fail "(timeout) print a->*pmi (2)" }
}


# p a.*pmf - fail

# p pmi

# p a.*pmi

@


1.2
log
@Update/correct copyright notices.
@
text
@@


1.2.26.1
log
@Merge drow-cplus-branch to:
  cvs rtag -D 2003-12-14 00:00:00 UTC drow-cplus-merge-20031214 gdb+dejagnu
@
text
@@


1.2.24.1
log
@2003-08-22  Michael Chastain  <mec@@shout.net>

	* gdb.cp: New directory.
	* gdb.cp/*: Copy from gdb.c++/*.
	* gdb.c++/*: Remove.
	* Makefile.in: Change gdb.c++ to gdb.cp.
	* configure.in:  Ditto.
	* carlton_runnamespace: Ditto.
	* carlton_runtest: Ditto.
	* configure: Regnerate.
@
text
@@


1.2.58.1
log
@2003-08-22  Michael Chastain  <mec@@shout.net>

	* gdb.cp: New directory.
	* gdb.cp/*: Copy from gdb.c++/*.
	* gdb.c++/*: Remove.
	* Makefile.in: Change gdb.c++ to gdb.cp.
	* configure.in:  Ditto.
	* configure: Regnerate.
@
text
@@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# Copyright (C) 1998 Free Software Foundation, Inc.
d29 2
d47 14
d108 1
d121 1
d134 1
d220 1
d253 1
d300 1
d312 1
d325 1
d337 1
d349 1
d355 1
a355 1
    -re ".*$gdb_prompt $" { fail "print a.*pmf -- ??" }
d361 1
d367 1
a367 1
    -re ".*$gdb_prompt $" { fail "print a_p->*pmf -- ??" }
d373 1
d379 1
a379 1
    -re ".*$gdb_prompt $" { fail "set var pmf -- ??" }
d385 1
d407 1
d418 1
d424 1
a424 1
    -re ".*$gdb_prompt $" { fail "casting pmf to int -- ??" }
d429 1
d435 1
a435 1
    -re ".*$gdb_prompt $" { fail "print (a.*pmi)(3) -- ???" }
d440 1
d446 1
a446 1
    -re ".*$gdb_prompt $" { fail "print (a.*pmf)(3) -- ???" }
d452 1
d472 1
d493 1
d507 1
d520 1
d533 1
@


1.1.1.1
log
@Initial creation of sourceware repository
@
text
@@


1.1.1.2
log
@import gdb-1999-06-28 snapshot
@
text
@a44 14
# Create and source the file that provides information about the compiler
# used to compile the test case.

if [get_compiler_info ${binfile} "c++"] {
    return -1
}

# Nearly all of these tests fail when compiled with G++, so just give up
# until GDB gets enhanced. -sts 1999-06-22

if {$gcc_compiled} {
    continue 
}

@


1.1.1.3
log
@import gdb-1999-08-02 snapshot
@
text
@a105 1
setup_xfail "hppa*-*-*" CLLbs16901
a117 1
setup_xfail "hppa*-*-*" CLLbs16901
a129 1
setup_xfail "hppa*-*-*" CLLbs16901
a214 1
setup_xfail "hppa*-*-*" CLLbs16901
a246 1
setup_xfail "hppa*-*-*" CLLbs16901
a292 1
setup_xfail "hppa*-*-*" CLLbs16901
a303 1
setup_xfail "hppa*-*-*" CLLbs16901
a315 1
setup_xfail "hppa*-*-*" CLLbs16901
a326 1
setup_xfail "hppa*-*-*" CLLbs16901
a337 1
setup_xfail "hppa*-*-*" CLLbs16901
d343 1
a343 1
    -re ".*$gdb_prompt $" { fail "print a.*pmf" }
a348 1
setup_xfail "hppa*-*-*" CLLbs16901
d354 1
a354 1
    -re ".*$gdb_prompt $" { fail "print a_p->*pmf" }
a359 1
setup_xfail "hppa*-*-*"
d365 1
a365 1
    -re ".*$gdb_prompt $" { fail "set var pmf" }
a370 1
setup_xfail "hppa*-*-*" CLLbs16901
a391 1
setup_xfail "hppa*-*-*" CLLbs16901
a401 1
setup_xfail "hppa*-*-*" CLLbs16901
d407 1
a407 1
    -re ".*$gdb_prompt $" { fail "casting pmf to int" }
a411 1
setup_xfail "hppa*-*-*" CLLbs16901
d417 1
a417 1
    -re ".*$gdb_prompt $" { fail "print (a.*pmi)(3)" }
a421 1
setup_xfail "hppa*-*-*" CLLbs16901
d427 1
a427 1
    -re ".*$gdb_prompt $" { fail "print (a.*pmf)(3)" }
a432 1
setup_xfail "hppa*-*-*" CLLbs16901
a451 1
setup_xfail "hppa*-*-*" CLLbs16901
a471 1
setup_xfail "hppa*-*-*" CLLbs16901
a484 1
setup_xfail "hppa*-*-*" CLLbs16901
a496 1
setup_xfail "hppa*-*-*" CLLbs16901
a508 1
setup_xfail "hppa*-*-*" CLLbs16901
@


1.1.1.4
log
@import gdb-1999-09-08 snapshot
@
text
@d1 1
a1 1
# Copyright (C) 1998, 1999 Free Software Foundation, Inc.
a27 2

if { [skip_cplus_tests] } { continue }
@


