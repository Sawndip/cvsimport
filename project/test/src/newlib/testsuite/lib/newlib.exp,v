head	1.7;
access;
symbols
	cygwin-1_7_35-release:1.7
	cygwin-1_7_34-release:1.7
	newlib-2_2_0:1.7.0.16
	cygwin-1_7_33-release:1.7
	cygwin-1_7_32-release:1.7
	cygwin-1_7_31-release:1.7
	cygwin-1_7_30-release:1.7
	cygwin-1_7_29-release:1.7
	cygwin-1_7_28-release:1.7
	newlib-2_1_0:1.7
	cygwin-1_7_27-release:1.7
	cygwin-1_7_26-release:1.7
	cygwin-1_7_25-release:1.7
	cygwin-1_7_24-release:1.7
	cygwin-1_7_23-release:1.7
	cygwin-1_7_22-release:1.7
	cygwin-1_7_21-release:1.7
	cygwin-1_7_20-release:1.7
	cygwin-1_7_19-release:1.7
	cygwin-64bit-postmerge:1.7
	cygwin-64bit-premerge-branch:1.7.0.14
	cygwin-64bit-premerge:1.7
	cygwin-1_7_18-release:1.7
	newlib-2_0_0:1.7
	cygwin-1_7_17-release:1.7
	cygwin-64bit-branch:1.7.0.12
	cygwin-1_7_16-release:1.7
	cygwin-1_7_15-release:1.7
	cygwin-1_7_14_2-release:1.7
	cygwin-1_7_14-release:1.7
	cygwin-1_7_12-release:1.7
	cygwin-1_7_11-release:1.7
	cygwin-1_7_10-release:1.7
	newlib-1_20_0:1.7
	cygwin-1_7_9-release:1.7
	cygwin-1_7_8-release:1.7
	newlib-1_19_0:1.7
	cygwin-1_7_7-release:1.7
	cygwin-1_7_5-release:1.7
	cygwin-1_7_4-release:1.7
	cygwin-1_7_3-release:1.7
	cygwin-1_7_2-release:1.7
	newlib-1_18_0:1.7
	cygwin-1_7_1-release:1.7
	newlib-1_17_0-arc:1.7.0.10
	binutils-arc-20080908-branch:1.7.0.8
	binutils-arc-20080908-branchpoint:1.7
	newlib-1_17_0:1.7
	newlib-1_16_0:1.7
	newlib-1_15_0:1.7
	newlib-csl-coldfire-4_1-32:1.7
	newlib-csl-sourcerygxx-4_1-32:1.7
	newlib-csl-innovasic-fido-3_4_4-33:1.7
	newlib-csl-coldfire-4_1-30:1.7
	newlib-csl-sourcerygxx-4_1-30:1.7
	newlib-csl-coldfire-4_1-28:1.7
	newlib-csl-sourcerygxx-4_1-28:1.7
	newlib-csl-arm-2006q3-27:1.7
	newlib-csl-sourcerygxx-4_1-27:1.7
	newlib-csl-arm-2006q3-26:1.7
	newlib-csl-sourcerygxx-4_1-26:1.7
	newlib-csl-sourcerygxx-4_1-24:1.7
	newlib-csl-sourcerygxx-4_1-23:1.7
	newlib-csl-sourcerygxx-4_1-21:1.7
	newlib-csl-arm-2006q3-21:1.7
	newlib-csl-arm-2006q3-19:1.7
	newlib-csl-sourcerygxx-4_1-19:1.7
	newlib-csl-sourcerygxx-4_1-18:1.7
	newlib-csl-sourcerygxx-3_4_4-25:1.7
	newlib-csl-sourcerygxx-4_1-17:1.7
	cr-0x5f1:1.7.0.6
	newlib-csl-sourcerygxx-4_1-14:1.7
	newlib-csl-sourcerygxx-4_1-13:1.7
	newlib-csl-sourcerygxx-4_1-12:1.7
	newlib-csl-sourcerygxx-4_1-9:1.7
	newlib-csl-sourcerygxx-4_1-8:1.7
	newlib-csl-sourcerygxx-4_1-7:1.7
	newlib-csl-arm-2006q1-6:1.7
	newlib-csl-sourcerygxx-4_1-6:1.7
	newlib-csl-sourcerygxx-4_1-5:1.7
	newlib-csl-sourcerygxx-4_1-4:1.7
	newlib-autotools-branch:1.7.0.4
	newlib-csl-20060320-branch:1.7.0.2
	newlib-csl-20060320-branchpoint:1.7
	newlib-1_14_0:1.7
	newlib-csl-arm-2005-q1b:1.6
	newlib-csl-arm-2005-q1a:1.6
	newlib-1_13_0:1.6
	csl-arm-2004-q3:1.6
	csl-arm-2004-q1a:1.6
	csl-arm-2004-q1:1.6
	newlib-1_12_0:1.6
	csl-arm-2003-q4:1.6
	w32api-2_2:1.6
	mingw-runtime-2_4:1.6
	newlib-1_11_0:1.6;
locks; strict;
comment	@# @;


1.7
date	2005.07.05.00.10.08;	author jjohnstn;	state Exp;
branches;
next	1.6;

1.6
date	2002.10.18.18.18.49;	author jjohnstn;	state Exp;
branches;
next	1.5;

1.5
date	2002.05.16.00.17.50;	author fitzsim;	state Exp;
branches;
next	1.4;

1.4
date	2002.05.01.17.05.44;	author fitzsim;	state Exp;
branches;
next	1.3;

1.3
date	2002.04.30.23.10.21;	author fitzsim;	state Exp;
branches;
next	1.2;

1.2
date	2002.04.30.22.38.07;	author fitzsim;	state Exp;
branches;
next	1.1;

1.1
date	2002.04.24.20.53.28;	author fitzsim;	state Exp;
branches;
next	;


desc
@@


1.7
log
@
2005-07-04  Mark Mitchell  <mark@@codesourcery.com>

        * Makefile.am (site.exp): Set tmpdir.
        * Makefile.in: Regenerated.
        * testsuite/lib/checkoutput.exp (newlib_check_output): Put
        executables in $tmpdir.
        * testsuite/lib/flags.exp (libgloss_link_flags): Use the original
        libgloss version if not running in the build directory.
        * testsuite/lib/newlib.exp (newlib_init): Put testglue.o in
        $tmpdir.
        * testsuite/lib/passfail.exp (newlib_pass_fail): Put executables
        in $tmpdir.
@
text
@# Copyright (C) 2002 by Red Hat, Incorporated. All rights reserved.
#
# Permission to use, copy, modify, and distribute this software
# is freely granted, provided that this notice is preserved.
#

# flags.exp overrides the dejagnu versions of libgloss_link_flags,
# newlib_link_flags, and newlib_include_flags.
load_lib flags.exp

proc newlib_version { } {
    global tool_version

    verbose "In newlib version...\n"

    return $tool_version
}

set newlib_initialized 0

proc newlib_init { args } {
    global gluefile wrap_flags
    global newlib_initialized
    global target_info
    # These values are initialized in the local site.exp file.
    global srcdir objdir tmpdir
    global host_triplet target_triplet
    global old_ld_library_path

    verbose "In newlib_init...\n"

    if { $newlib_initialized == 1 } { return; }

    if {[target_info needs_status_wrapper] != "" && \
	    [target_info needs_status_wrapper] != "0" && \
	    ![info exists gluefile]} {
	set gluefile ${tmpdir}/testglue.o;
	set result [build_wrapper $gluefile];
	if { $result != "" } {
	    set gluefile [lindex $result 0];
	    set wrap_flags [lindex $result 1];
	} else {
	    unset gluefile
	}
    }

    if [string match $host_triplet $target_triplet] then {
	if [string match "i686-pc-linux-gnu" $host_triplet] then {
	    set old_ld_library_path [getenv LD_LIBRARY_PATH]
	    setenv LD_LIBRARY_PATH "$objdir/.libs"
	}
    }
}

proc newlib_target_compile { source dest type options } {
    global gluefile wrap_flags
    global srcdir objdir
    global host_triplet target_triplet

    verbose "In newlib_target_compile...\n"

    lappend options "libs=-I$srcdir/include"
    verbose "srcdir is $srcdir"
	
    if {[target_info needs_status_wrapper] != "" && \
	    [target_info needs_status_wrapper] != "0" && \
	    [info exists gluefile] } {
	lappend options "libs=$gluefile"
	lappend options "ldflags=$wrap_flags"
    }

    if [string match $host_triplet $target_triplet] then {
	if [string match "i686-pc-linux-gnu" $host_triplet] then {
	    lappend options "libs=$objdir/crt0.o -lc -lgcc"
	    lappend options "ldflags=-nostdlib -L$objdir/.libs [newlib_include_flags]"
	}
    }

    return [target_compile $source $dest $type $options]
}

proc newlib_finish { } {
    global old_ld_library_path
    global host_triplet target_triplet

    verbose "In newlib_finish...\n"

    if [string match $host_triplet $target_triplet] then {
	if [string match "i686-pc-linux-gnu" $host_triplet] then {
	    setenv LD_LIBRARY_PATH "$old_ld_library_path"
	}
    }
}

proc newlib_exit { } {
    global gluefile;
    
    verbose "In newlib_exit...\n"

    if [info exists gluefile] {
	file_on_build delete $gluefile;
	unset gluefile;
    }
}
@


1.6
log
@
2002-10-18  Jeff Johnston  <jjohnstn@@redhat.com>

        * testsuite/include/check.h: New header file to use with
        test cases.
        * testsuite/lib/newlib.exp: Add testsuite/include directory
        to list of header files to use.
        * testsuite/newlib.wctype/twctype.c: New test case for iswctype fns.
        * testsuite/newlib.wctype/wctype.exp: New file.
@
text
@d26 1
a26 1
    global srcdir objdir
d37 1
a37 1
	set gluefile ${objdir}/testsuite/testglue.o;
@


1.5
log
@	* testsuite/lib/newlib.exp: Add newlib_include_flags to compile
	options when testing natively on i[3456]86-*-linux.
@
text
@d61 3
@


1.4
log
@	* Makefile.am (site.exp): Remove newlib_cflags.  Add
	multibuildtop.
	* testsuite/newlib.locale/UTF-8.c: Change fprintf's to printf's.
	* testsuite/lib/flags.exp: New file.
	* testsuite/lib/newlib.exp: Load flags.exp.
	(newlib_target_compile): Remove libgloss directory references.
	(newlib_init): Remove newlib_cflags references.
@
text
@d72 1
a72 1
	    lappend options "ldflags=-nostdlib -L$objdir/.libs"
@


1.3
log
@	* testsuite/lib/newlib.exp (newlib_target_compile): Change
	method of finding libgloss_target_dir.
@
text
@d7 4
a24 1
    global CFLAGS_FOR_TARGET
a27 2
    # newlib_cflags comes from acinclude.m4, through the site.exp file.
    global newlib_cflags
a33 4
    set CFLAGS_FOR_TARGET $newlib_cflags

    set_currtarget_info "wrap_compile_flags" "$newlib_cflags"

d37 1
a37 1
	set gluefile ${objdir}/testglue.o;
d66 1
a66 6
	# This method of finding libgloss_target_dir may not work for some targets
	set libgloss_target_dir [lindex [split $target_triplet "-"] 0]
	lappend options "ldflags=$wrap_flags -B$objdir/../libgloss/$libgloss_target_dir \
                                             -L$objdir/../libgloss/$libgloss_target_dir \
                                             -L$srcdir/../../libgloss/$libgloss_target_dir \
                                             -L$objdir"
d71 2
a72 2
	    lappend options "libs=$objdir/crt0.o -lc"
	    lappend options "ldflags=-nostdlib -L$objdir/.libs -lgcc"
@


1.2
log
@	* Makefile.am (site.exp): Change host_alias, host_triplet,
	target_alias, target_triplet to refer to gcc's host and target
	variables (newlib's build and host variables).
	* testsuite/lib/newlib.exp (newlib_init): Change build
	references to host references, host references to target
	references to reflect Makefile.am changes.
	(newlib_target_compile): Likewise.
	(newlib_finish): Likewise.
@
text
@d70 1
a70 1
	set libgloss_target_dir [lindex [split $host_triplet "-"] 0]
@


1.1
log
@	* Makefile.am (check-DEJAGNU): New target.
	(site.exp): Likewise.
	* acinclude.m4 (NEWLIB_CONFIGURE): Replace AC_CANONICAL_HOST
	with AC_CANONICAL_SYSTEM.  Remove AC_CANONICAL_BUILD.
	* libc/locale/locale.c (_setlocale_r): Add UTF-8 support.
	* libc/stdlib/mbtowc_r.c (_mbtowc_r): Likewise.
	* libc/stdlib/wctomb_r.c (_wctomb_r): Likewise.
	* testsuite: New directory.
	* testsuite/config: Likewise.
	* testsuite/lib: Likewise.
	* testsuite/newlib.locale: Likewise.
	* testsuite/newlib.string: Likewise.
	* testsuite/config/default.exp: New file.
	* testsuite/lib/checkoutput.exp: New file.
	* testsuite/lib/newlib.exp: New file.
	* testsuite/lib/passfail.exp: New file.
	* testsuite/newlib.locale/UTF-8.c: New file.
	* testsuite/newlib.locale/UTF-8.exp: New file.
	* testsuite/newlib.locale/locale.exp: New file.
	* testsuite/newlib.string/string.exp: New file.
	* testsuite/newlib.string/tstring.c: New file.
@
text
@d22 1
a22 1
    # These values are initialized in the local site.exp file
d24 2
a25 2
    global build_triplet host_triplet
    # newlib_cflags comes from acinclude.m4, through the site.exp file
d50 2
a51 2
    if [string match $build_triplet $host_triplet] then {
	if [string match "i686-pc-linux-gnu" $build_triplet] then {
d61 1
a61 2
    global build_triplet
    global host_triplet
d77 2
a78 2
    if [string match $build_triplet $host_triplet] then {
	if [string match "i686-pc-linux-gnu" $build_triplet] then {
d89 1
a89 1
    global build_triplet host_triplet
d93 2
a94 2
    if [string match $build_triplet $host_triplet] then {
	if [string match "i686-pc-linux-gnu" $build_triplet] then {
@

