head	1.3;
access;
symbols
	cygwin-1_7_35-release:1.3
	cygwin-1_7_34-release:1.3
	newlib-2_2_0:1.3.0.16
	cygwin-1_7_33-release:1.3
	cygwin-1_7_32-release:1.3
	cygwin-1_7_31-release:1.3
	cygwin-1_7_30-release:1.3
	cygwin-1_7_29-release:1.3
	cygwin-1_7_28-release:1.3
	newlib-2_1_0:1.3
	cygwin-1_7_27-release:1.3
	cygwin-1_7_26-release:1.3
	cygwin-1_7_25-release:1.3
	cygwin-1_7_24-release:1.3
	cygwin-1_7_23-release:1.3
	cygwin-1_7_22-release:1.3
	cygwin-1_7_21-release:1.3
	cygwin-1_7_20-release:1.3
	cygwin-1_7_19-release:1.3
	cygwin-64bit-postmerge:1.3
	cygwin-64bit-premerge-branch:1.3.0.14
	cygwin-64bit-premerge:1.3
	cygwin-1_7_18-release:1.3
	newlib-2_0_0:1.3
	cygwin-1_7_17-release:1.3
	cygwin-64bit-branch:1.3.0.12
	cygwin-1_7_16-release:1.3
	cygwin-1_7_15-release:1.3
	cygwin-1_7_14_2-release:1.3
	cygwin-1_7_14-release:1.3
	cygwin-1_7_12-release:1.3
	cygwin-1_7_11-release:1.3
	cygwin-1_7_10-release:1.3
	newlib-1_20_0:1.3
	cygwin-1_7_9-release:1.3
	cygwin-1_7_8-release:1.3
	newlib-1_19_0:1.3
	cygwin-1_7_7-release:1.3
	cygwin-1_7_5-release:1.3
	cygwin-1_7_4-release:1.3
	cygwin-1_7_3-release:1.3
	cygwin-1_7_2-release:1.3
	newlib-1_18_0:1.3
	cygwin-1_7_1-release:1.3
	newlib-1_17_0-arc:1.3.0.10
	binutils-arc-20080908-branch:1.3.0.8
	binutils-arc-20080908-branchpoint:1.3
	newlib-1_17_0:1.3
	newlib-1_16_0:1.3
	newlib-1_15_0:1.3
	newlib-csl-coldfire-4_1-32:1.3
	newlib-csl-sourcerygxx-4_1-32:1.3
	newlib-csl-innovasic-fido-3_4_4-33:1.3
	newlib-csl-coldfire-4_1-30:1.3
	newlib-csl-sourcerygxx-4_1-30:1.3
	newlib-csl-coldfire-4_1-28:1.3
	newlib-csl-sourcerygxx-4_1-28:1.3
	newlib-csl-arm-2006q3-27:1.3
	newlib-csl-sourcerygxx-4_1-27:1.3
	newlib-csl-arm-2006q3-26:1.3
	newlib-csl-sourcerygxx-4_1-26:1.3
	newlib-csl-sourcerygxx-4_1-24:1.3
	newlib-csl-sourcerygxx-4_1-23:1.3
	newlib-csl-sourcerygxx-4_1-21:1.3
	newlib-csl-arm-2006q3-21:1.3
	newlib-csl-arm-2006q3-19:1.3
	newlib-csl-sourcerygxx-4_1-19:1.3
	newlib-csl-sourcerygxx-4_1-18:1.3
	newlib-csl-sourcerygxx-3_4_4-25:1.3
	newlib-csl-sourcerygxx-4_1-17:1.3
	cr-0x5f1:1.3.0.6
	newlib-csl-sourcerygxx-4_1-14:1.3
	newlib-csl-sourcerygxx-4_1-13:1.3
	newlib-csl-sourcerygxx-4_1-12:1.3
	newlib-csl-sourcerygxx-4_1-9:1.3
	newlib-csl-sourcerygxx-4_1-8:1.3
	newlib-csl-sourcerygxx-4_1-7:1.3
	newlib-csl-arm-2006q1-6:1.3
	newlib-csl-sourcerygxx-4_1-6:1.3
	newlib-csl-sourcerygxx-4_1-5:1.3
	newlib-csl-sourcerygxx-4_1-4:1.3
	newlib-autotools-branch:1.3.0.4
	newlib-csl-20060320-branch:1.3.0.2
	newlib-csl-20060320-branchpoint:1.3
	newlib-1_14_0:1.3
	newlib-csl-arm-2005-q1b:1.3
	newlib-csl-arm-2005-q1a:1.3
	newlib-1_13_0:1.3
	csl-arm-2004-q3:1.3
	csl-arm-2004-q1a:1.3
	csl-arm-2004-q1:1.3
	newlib-1_12_0:1.3
	csl-arm-2003-q4:1.3
	w32api-2_2:1.3
	mingw-runtime-2_4:1.3
	newlib-1_11_0:1.3;
locks; strict;
comment	@# @;


1.3
date	2002.08.23.01.56.05;	author fitzsim;	state Exp;
branches;
next	1.2;

1.2
date	2002.05.15.23.48.47;	author fitzsim;	state Exp;
branches;
next	1.1;

1.1
date	2002.04.24.20.53.29;	author fitzsim;	state Exp;
branches;
next	;


desc
@@


1.3
log
@	* libc/include/langinfo.h: New file.
	* libc/include/wchar.h: Likewise.
	* libc/include/sys/syslimits.h: Likewise.
	* libc/locale/fix_grouping.c: Likewise.
	* libc/locale/ldpart.c: Likewise.
	* libc/locale/ldpart.h: Likewise.
	* libc/locale/lmessages.c: Likewise.
	* libc/locale/lmessages.h: Likewise.
	* libc/locale/lmonetary.c: Likewise.
	* libc/locale/lmonetary.h: Likewise.
	* libc/locale/lnumeric.c: Likewise.
	* libc/locale/lnumeric.h: Likewise.
	* libc/locale/nl_langinfo.3: Likewise.
	* libc/locale/nl_langinfo.c: Likewise.
	* libc/locale/timelocal.c: Likewise.
	* libc/locale/timelocal.h: Likewise.
	* libc/stdlib/btowc.c: Likewise.
	* libc/stdlib/mbrlen.c: Likewise.
	* libc/stdlib/mbrtowc.c: Likewise.
	* libc/stdlib/mbsinit.c: Likewise.
	* libc/stdlib/mbsrtowcs.c: Likewise.
	* libc/stdlib/wcrtomb.c: Likewise.
	* libc/stdlib/wcsrtombs.c: Likewise.
	* libc/stdlib/wctob.c: Likewise.
	* libc/sys/linux/prof-freq.c: Likewise.
	* libc/sys/linux/profile.c: Likewise.
	* libc/sys/linux/machine/i386/dl-procinfo.c: Likewise.
	* libc/sys/linux/machine/i386/dl-procinfo.h: Likewise.
	* libc/include/stdlib.h: Change re-entrant functions to take
	mbstate_t pointers.
	* libc/include/sys/_types.h: Define _mbstate_t.
	* libc/include/sys/config.h (MB_LEN_MAX): New macro.
	* libc/include/sys/errno.h (EILSEQ): New error code.
	* libc/include/sys/reent.h: Include wchar.h.  Change reentrant
	structure to use mbstate_t.
	* libc/locale/Makefile.am (LIB_SOURCES): Add new files.
	* libc/machine/powerpc/vfprintf.c: Use mbstate_t.
	* libc/machine/powerpc/vfscanf.c: Likewise.
	* libc/stdio/getdelim.c: Reallocate buffer only when necessary.
	* libc/stdio/vfprintf.c: Likewise.
	* libc/stdio/vfscanf.c: Likewise.
	* libc/stdlib/Makefile.am (LIB_SOURCES): Add new files.
	* libc/stdlib/mblen.c: Use mbstate_t.
	* libc/stdlib/mblen_r.c: Likewise.
	* libc/stdlib/mbstowcs.c: Likewise.
	* libc/stdlib/mbstowcs_r.c: Likewise.
	* libc/stdlib/mbtowc.c: Likewise.
	* libc/stdlib/mbtowc_r.c: Likewise.
	* libc/stdlib/wcstombs.c: Likewise.
	* libc/stdlib/wcstombs_r.c: Likewise.
	* libc/stdlib/wctomb_r.c: Likewise.
	* libc/sys/linux/Makefile.am (LIB_SOURCES): Add prof-freq.c and
	profile.c.
	* libc/sys/linux/machine/i386/Makefile.am (LIB_SOURCES): Add
	dl-procinfo.c.
	* libc/sys/linux/sys/errno.h (EILSEQ): New error code.
	* libc/sys/linux/sys/types.h (off_t): Define type.
	* testsuite/newlib.locale/UTF-8.c: Change locale name from UTF-8
	to C-UTF-8.
	* testsuite/newlib.locale/UTF-8.exp: Likewise.
@
text
@# Copyright (C) 2002 by Red Hat, Incorporated. All rights reserved.
#
# Permission to use, copy, modify, and distribute this software
# is freely granted, provided that this notice is preserved.
#

load_lib checkoutput.exp

set expected_output {
"Set C-UTF-8 locale."
"* U-00000000"
"* U-00000080"
"* U-00000800"
"* U-00010000"
"* U-00200000"
"* U-04000000"
"* U-0000007f"
"* U-000007ff"
"* U-0000ffff"
"* U-001fffff"
"* U-03ffffff"
"* U-7fffffff"
"* U-0000d7ff"
"* U-0000e000"
"* U-0000fffd"
"* U-0010ffff"
"* U-00110000"
"* 1 Invalid"
"* 1 Invalid"
"* 2 Invalid"
"* 3 Invalid"
"* 4 Invalid"
"* 5 Invalid"
"* 6 Invalid"
"* 7 Invalid"
"* 64 Invalid"
"* 32 Invalid"
"* 16 Invalid"
"* 8 Invalid"
"* 4 Invalid"
"* 2 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
"* 1 Invalid"
}

newlib_check_output UTF-8.c $expected_output
@


1.2
log
@	* testsuite/lib/checkoutput.exp (newlib_check_output): Output
	only one pass or fail per test file.  Trim \r's from output
	values received from test programs.  Remove support for named
	tests.
	* testsuite/newlib.locale/UTF-8.exp: Update to support new
	newlib_check_output behaviour.
	* testsuite/newlib.locale/UTF-8.c: Likewise.
@
text
@d10 1
a10 1
"Set UTF-8 locale."
@


1.1
log
@	* Makefile.am (check-DEJAGNU): New target.
	(site.exp): Likewise.
	* acinclude.m4 (NEWLIB_CONFIGURE): Replace AC_CANONICAL_HOST
	with AC_CANONICAL_SYSTEM.  Remove AC_CANONICAL_BUILD.
	* libc/locale/locale.c (_setlocale_r): Add UTF-8 support.
	* libc/stdlib/mbtowc_r.c (_mbtowc_r): Likewise.
	* libc/stdlib/wctomb_r.c (_wctomb_r): Likewise.
	* testsuite: New directory.
	* testsuite/config: Likewise.
	* testsuite/lib: Likewise.
	* testsuite/newlib.locale: Likewise.
	* testsuite/newlib.string: Likewise.
	* testsuite/config/default.exp: New file.
	* testsuite/lib/checkoutput.exp: New file.
	* testsuite/lib/newlib.exp: New file.
	* testsuite/lib/passfail.exp: New file.
	* testsuite/newlib.locale/UTF-8.c: New file.
	* testsuite/newlib.locale/UTF-8.exp: New file.
	* testsuite/newlib.locale/locale.exp: New file.
	* testsuite/newlib.string/string.exp: New file.
	* testsuite/newlib.string/tstring.c: New file.
@
text
@d9 77
a85 77
set tests {
"Setting UTF-8 locale" "*Set UTF-8 locale*"
"2.1.1" "* U-00000000 *"
"2.1.2" "* U-00000080 *"
"2.1.3" "* U-00000800 *"
"2.1.4" "* U-00010000 *"
"2.1.5" "* U-00200000 *"
"2.1.6" "* U-04000000 *"
"2.2.1" "* U-0000007f *"
"2.2.2" "* U-000007ff *"
"2.2.3" "* U-0000ffff *"
"2.2.4" "* U-001fffff *"
"2.2.5" "* U-03ffffff *"
"2.2.6" "* U-7fffffff *"
"2.3.1" "* U-0000d7ff *"
"2.3.2" "* U-0000e000 *"
"2.3.3" "* U-0000fffd *"
"2.3.4" "* U-0010ffff *"
"2.3.5" "* U-00110000 *"
"3.1.1" "* 1 Invalid *"
"3.1.2" "* 1 Invalid *"
"3.1.3" "* 2 Invalid *"
"3.1.4" "* 3 Invalid *"
"3.1.5" "* 4 Invalid *"
"3.1.6" "* 5 Invalid *"
"3.1.7" "* 6 Invalid *"
"3.1.8" "* 7 Invalid *"
"3.1.9" "* 64 Invalid *"
"3.2.1" "* 32 Invalid *"
"3.2.2" "* 16 Invalid *"
"3.2.3" "* 8 Invalid *"
"3.2.4" "* 4 Invalid *"
"3.2.5" "* 2 Invalid *"
"3.3.1" "* 1 Invalid *"
"3.3.2" "* 1 Invalid *"
"3.3.3" "* 1 Invalid *"
"3.3.4" "* 1 Invalid *"
"3.3.5" "* 1 Invalid *"
"3.3.6" "* 1 Invalid *"
"3.3.7" "* 1 Invalid *"
"3.3.8" "* 1 Invalid *"
"3.3.9" "* 1 Invalid *"
"3.3.10" "* 1 Invalid *"
"3.5.1" "* 1 Invalid *"
"3.5.2" "* 1 Invalid *"
"3.5.3" "* 1 Invalid *"
"4.1.1" "* 1 Invalid *"
"4.1.2" "* 1 Invalid *"
"4.1.3" "* 1 Invalid *"
"4.1.4" "* 1 Invalid *"
"4.1.5" "* 1 Invalid *"
"4.2.1" "* 1 Invalid *"
"4.2.2" "* 1 Invalid *"
"4.2.3" "* 1 Invalid *"
"4.2.4" "* 1 Invalid *"
"4.2.5" "* 1 Invalid *"
"4.3.1" "* 1 Invalid *"
"4.3.2" "* 1 Invalid *"
"4.3.3" "* 1 Invalid *"
"4.3.4" "* 1 Invalid *"
"4.3.5" "* 1 Invalid *"
"5.1.1" "* 1 Invalid *"
"5.1.2" "* 1 Invalid *"
"5.1.3" "* 1 Invalid *"
"5.1.4" "* 1 Invalid *"
"5.1.5" "* 1 Invalid *"
"5.1.6" "* 1 Invalid *"
"5.1.7" "* 1 Invalid *"
"5.2.1" "* 1 Invalid *"
"5.2.2" "* 1 Invalid *"
"5.2.3" "* 1 Invalid *"
"5.2.4" "* 1 Invalid *"
"5.2.5" "* 1 Invalid *"
"5.2.6" "* 1 Invalid *"
"5.2.7" "* 1 Invalid *"
"5.3.1" "* 1 Invalid *"
"5.3.2" "* 1 Invalid *"
d88 1
a88 1
newlib_check_output "UTF-8.c" "$tests"
@

