head	1.8;
access;
symbols
	cygwin-1_7_35-release:1.8
	cygwin-1_7_34-release:1.8
	newlib-2_2_0:1.8.0.6
	cygwin-1_7_33-release:1.8
	cygwin-1_7_32-release:1.8
	cygwin-1_7_31-release:1.8
	cygwin-1_7_30-release:1.8
	cygwin-1_7_29-release:1.8
	cygwin-1_7_28-release:1.8
	newlib-2_1_0:1.8
	cygwin-1_7_27-release:1.8
	cygwin-1_7_26-release:1.8
	cygwin-1_7_25-release:1.8
	cygwin-1_7_24-release:1.8
	cygwin-1_7_23-release:1.8
	cygwin-1_7_22-release:1.8
	cygwin-1_7_21-release:1.8
	cygwin-1_7_20-release:1.8
	cygwin-1_7_19-release:1.8
	cygwin-64bit-postmerge:1.8
	cygwin-64bit-premerge-branch:1.8.0.4
	cygwin-64bit-premerge:1.8
	cygwin-1_7_18-release:1.8
	newlib-2_0_0:1.8
	cygwin-1_7_17-release:1.8
	cygwin-64bit-branch:1.8.0.2
	cygwin-1_7_16-release:1.8
	cygwin-1_7_15-release:1.8
	cygwin-1_7_14_2-release:1.8
	cygwin-1_7_14-release:1.8
	cygwin-1_7_12-release:1.8
	cygwin-1_7_11-release:1.8
	cygwin-1_7_10-release:1.8
	newlib-1_20_0:1.8
	cygwin-1_7_9-release:1.8
	cygwin-1_7_8-release:1.8
	newlib-1_19_0:1.8
	cygwin-1_7_7-release:1.8
	cygwin-1_7_5-release:1.8
	cygwin-1_7_4-release:1.8
	cygwin-1_7_3-release:1.8
	cygwin-1_7_2-release:1.8
	newlib-1_18_0:1.7
	cygwin-1_7_1-release:1.7
	newlib-1_17_0-arc:1.4.0.10
	binutils-arc-20080908-branch:1.4.0.8
	binutils-arc-20080908-branchpoint:1.4
	newlib-1_17_0:1.4
	newlib-1_16_0:1.4
	newlib-1_15_0:1.4
	newlib-csl-coldfire-4_1-32:1.4
	newlib-csl-sourcerygxx-4_1-32:1.4
	newlib-csl-innovasic-fido-3_4_4-33:1.4
	newlib-csl-coldfire-4_1-30:1.4
	newlib-csl-sourcerygxx-4_1-30:1.4
	newlib-csl-coldfire-4_1-28:1.4
	newlib-csl-sourcerygxx-4_1-28:1.4
	newlib-csl-arm-2006q3-27:1.4
	newlib-csl-sourcerygxx-4_1-27:1.4
	newlib-csl-arm-2006q3-26:1.4
	newlib-csl-sourcerygxx-4_1-26:1.4
	newlib-csl-sourcerygxx-4_1-24:1.4
	newlib-csl-sourcerygxx-4_1-23:1.4
	newlib-csl-sourcerygxx-4_1-21:1.4
	newlib-csl-arm-2006q3-21:1.4
	newlib-csl-arm-2006q3-19:1.4
	newlib-csl-sourcerygxx-4_1-19:1.4
	newlib-csl-sourcerygxx-4_1-18:1.4
	newlib-csl-sourcerygxx-3_4_4-25:1.4
	newlib-csl-sourcerygxx-4_1-17:1.4
	cr-0x5f1:1.4.0.6
	newlib-csl-sourcerygxx-4_1-14:1.4
	newlib-csl-sourcerygxx-4_1-13:1.4
	newlib-csl-sourcerygxx-4_1-12:1.4
	newlib-csl-sourcerygxx-4_1-9:1.4
	newlib-csl-sourcerygxx-4_1-8:1.4
	newlib-csl-sourcerygxx-4_1-7:1.4
	newlib-csl-arm-2006q1-6:1.4
	newlib-csl-sourcerygxx-4_1-6:1.4
	newlib-csl-sourcerygxx-4_1-5:1.4
	newlib-csl-sourcerygxx-4_1-4:1.4
	newlib-autotools-branch:1.4.0.4
	newlib-csl-20060320-branch:1.4.0.2
	newlib-csl-20060320-branchpoint:1.4
	newlib-1_14_0:1.4
	newlib-csl-arm-2005-q1b:1.3
	newlib-csl-arm-2005-q1a:1.3
	newlib-1_13_0:1.3
	csl-arm-2004-q3:1.3
	csl-arm-2004-q1a:1.3
	csl-arm-2004-q1:1.2
	newlib-1_12_0:1.2
	csl-arm-2003-q4:1.2
	w32api-2_2:1.1
	mingw-runtime-2_4:1.1
	newlib-1_11_0:1.1;
locks; strict;
comment	@ * @;


1.8
date	2010.02.18.20.37.19;	author corinna;	state Exp;
branches;
next	1.7;

1.7
date	2009.05.14.20.16.21;	author corinna;	state Exp;
branches;
next	1.6;

1.6
date	2009.03.24.10.13.27;	author corinna;	state Exp;
branches;
next	1.5;

1.5
date	2009.03.03.09.28.45;	author corinna;	state Exp;
branches;
next	1.4;

1.4
date	2005.10.28.21.33.22;	author jjohnstn;	state Exp;
branches;
next	1.3;

1.3
date	2004.04.23.21.44.21;	author jjohnstn;	state Exp;
branches;
next	1.2;

1.2
date	2003.07.31.22.24.20;	author jjohnstn;	state Exp;
branches;
next	1.1;

1.1
date	2002.09.20.20.13.10;	author jjohnstn;	state Exp;
branches;
next	;


desc
@@


1.8
log
@	* libc/ctype/iswalpha.c (iswalpha): Update to Unicode 5.2.
	* libc/ctype/iswprint.c (iswprint): Ditto.
	* libc/ctype/iswpunct.c (iswpunct): Drop standalone implementation.
	Define in terms of other wctype functions instead.
	* libc/ctype/towlower.c (towlower): Update to Unicode 5.2.  Add comment
	to explain how to fetch the data from the Unicode database.
	* libc/ctype/towupper.c (towupper): Ditto.
	* libc/ctype/utf8alpha.h: Ditto.
	* libc/ctype/utf8print.h: Ditto.
	* libc/ctype/utf8punct.h: Remove.
	* libc/ctype/iswcntrl.c (iswcntrl): Add comment to explain how to
	fetch the data from the Unicode database.
@
text
@/* Copyright (c) 2002 Red Hat Incorporated.
   All rights reserved.

   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions are met:

     Redistributions of source code must retain the above copyright
     notice, this list of conditions and the following disclaimer.

     Redistributions in binary form must reproduce the above copyright
     notice, this list of conditions and the following disclaimer in the
     documentation and/or other materials provided with the distribution.

     The name of Red Hat Incorporated may not be used to endorse
     or promote products derived from this software without specific
     prior written permission.

   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
   AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
   ARE DISCLAIMED.  IN NO EVENT SHALL RED HAT INCORPORATED BE LIABLE FOR ANY
   DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
   (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
   LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
   ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS   
   SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

/*
FUNCTION
	<<towlower>>---translate wide characters to lowercase

INDEX
	towlower

ANSI_SYNOPSIS
	#include <wctype.h>
	wint_t towlower(wint_t <[c]>);

TRAD_SYNOPSIS
	#include <wctype.h>
	wint_t towlower(<[c]>)
	wint_t <[c]>;


DESCRIPTION
<<towlower>> is a function which converts uppercase wide characters to
lowercase, leaving all other characters unchanged.

RETURNS
<<towlower>> returns the lowercase equivalent of <[c]> when it is a
uppercase wide character; otherwise, it returns the input character.

PORTABILITY
<<towlower>> is C99.

No supporting OS subroutines are required.
*/

#include <_ansi.h>
#include <newlib.h>
#include <string.h>
#include <reent.h>
#include <ctype.h>
#include <wctype.h>
#include "local.h"

wint_t
_DEFUN(towlower,(c), wint_t c)
{
#ifdef _MB_CAPABLE
  c = _jp2uc (c);
  /* Based on and tested against Unicode 5.2 */

  /* Expression used to filter out the characters for the below code:

     awk -F\; '{ if ( $14 != "" ) print $1; }' UnicodeData.txt
  */
  if (c < 0x100)
    {
      if ((c >= 0x0041 && c <= 0x005a) ||
	  (c >= 0x00c0 && c <= 0x00d6) ||
	  (c >= 0x00d8 && c <= 0x00de))
	return (c + 0x20);

      return c;
    }
  else if (c < 0x300)
    {
      if ((c >= 0x0100 && c <= 0x012e) ||
	  (c >= 0x0132 && c <= 0x0136) ||
	  (c >= 0x014a && c <= 0x0176) ||
	  (c >= 0x01de && c <= 0x01ee) ||
	  (c >= 0x01f8 && c <= 0x021e) ||
	  (c >= 0x0222 && c <= 0x0232))
	{
	  if (!(c & 0x01))
	    return (c + 1);
	  return c;
	}

      if (c == 0x0130)
	return 0x0069;

      if ((c >= 0x0139 && c <= 0x0147) ||
	  (c >= 0x01cd && c <= 0x01db))
	{
	  if (c & 0x01)
	    return (c + 1);
	  return c;
	}
      
      if (c >= 0x178 && c <= 0x01f7)
	{
	  wint_t k;
	  switch (c)
	    {
	    case 0x0178:
	      k = 0x00ff;
	      break;
	    case 0x0179:
	    case 0x017b:
	    case 0x017d:
	    case 0x0182:
	    case 0x0184:
	    case 0x0187:
	    case 0x018b:
	    case 0x0191:
	    case 0x0198:
	    case 0x01a0:
	    case 0x01a2:
	    case 0x01a4:
	    case 0x01a7:
	    case 0x01ac:
	    case 0x01af:
	    case 0x01b3:
	    case 0x01b5:
	    case 0x01b8:
	    case 0x01bc:
	    case 0x01c5:
	    case 0x01c8:
	    case 0x01cb:
	    case 0x01cd:
	    case 0x01cf:
	    case 0x01d1:
	    case 0x01d3:
	    case 0x01d5:
	    case 0x01d7:
	    case 0x01d9:
	    case 0x01db:
	    case 0x01f2:
	    case 0x01f4:
	      k = c + 1;
	      break;
	    case 0x0181:
	      k = 0x0253;
	      break;
	    case 0x0186:
	      k = 0x0254;
	      break;
	    case 0x0189:
	      k = 0x0256;
	      break;
	    case 0x018a:
	      k = 0x0257;
	      break;
	    case 0x018e:
	      k = 0x01dd;
	      break;
	    case 0x018f:
	      k = 0x0259;
	      break;
	    case 0x0190:
	      k = 0x025b;
	      break;
	    case 0x0193:
	      k = 0x0260;
	      break;
	    case 0x0194:
	      k = 0x0263;
	      break;
	    case 0x0196:
	      k = 0x0269;
	      break;
	    case 0x0197:
	      k = 0x0268;
	      break;
	    case 0x019c:
	      k = 0x026f;
	      break;
	    case 0x019d:
	      k = 0x0272;
	      break;
	    case 0x019f:
	      k = 0x0275;
	      break;
	    case 0x01a6:
	      k = 0x0280;
	      break;
	    case 0x01a9:
	      k = 0x0283;
	      break;
	    case 0x01ae:
	      k = 0x0288;
	      break;
	    case 0x01b1:
	      k = 0x028a;
	      break;
	    case 0x01b2:
	      k = 0x028b;
	      break;
	    case 0x01b7:
	      k = 0x0292;
	      break;
	    case 0x01c4:
	    case 0x01c7:
	    case 0x01ca:
	    case 0x01f1:
	      k = c + 2;
	      break;
	    case 0x01f6:
	      k = 0x0195;
	      break;
	    case 0x01f7:
	      k = 0x01bf;
	      break;
	    default:
	      k = 0;
	    }
	  if (k != 0)
	    return k;
	}
      else if (c == 0x0220)
      	return 0x019e;
      else if (c >= 0x023a && c <= 0x024e)
      	{
	  wint_t k;
	  switch (c)
	    {
	    case 0x023a:
	      k = 0x2c65;
	      break;
	    case 0x023b:
	    case 0x0241:
	    case 0x0246:
	    case 0x0248:
	    case 0x024a:
	    case 0x024c:
	    case 0x024e:
	      k = c + 1;
	      break;
	    case 0x023d:
	      k = 0x019a;
	      break;
	    case 0x023e:
	      k = 0x2c66;
	      break;
	    case 0x0243:
	      k = 0x0180;
	      break;
	    case 0x0244:
	      k = 0x0289;
	      break;
	    case 0x0245:
	      k = 0x028c;
	      break;
	    default:
	      k = 0;
	    }
	  if (k != 0)
	    return k;
	}
    }
  else if (c < 0x0400)
    {
      if (c == 0x0370 || c == 0x0372 || c == 0x0376)
      	return (c + 1);
      if (c >= 0x0391 && c <= 0x03ab && c != 0x03a2)
	return (c + 0x20);
      if (c >= 0x03d8 && c <= 0x03ee && !(c & 0x01))
	return (c + 1);
      if (c >= 0x0386 && c <= 0x03ff)
	{
	  wint_t k;
	  switch (c)
	    {
	    case 0x0386:
	      k = 0x03ac;
	      break;
	    case 0x0388:
	      k = 0x03ad;
	      break;
	    case 0x0389:
	      k = 0x03ae;
	      break;
	    case 0x038a:
	      k = 0x03af;
	      break;
	    case 0x038c:
	      k = 0x03cc;
	      break;
	    case 0x038e:
	      k = 0x03cd;
	      break;
	    case 0x038f:
	      k = 0x03ce;
	      break;
	    case 0x03cf:
	      k = 0x03d7;
	      break;
	    case 0x03f4:
	      k = 0x03b8;
	      break;
	    case 0x03f7:
	      k = 0x03f8;
	      break;
	    case 0x03f9:
	      k = 0x03f2;
	      break;
	    case 0x03fa:
	      k = 0x03fb;
	      break;
	    case 0x03fd:
	      k = 0x037b;
	      break;
	    case 0x03fe:
	      k = 0x037c;
	      break;
	    case 0x03ff:
	      k = 0x037d;
	      break;
	    default:
	      k = 0;
	    }
	  if (k != 0)
	    return k;
	}
    }
  else if (c < 0x500)
    {
      if (c >= 0x0400 && c <= 0x040f)
	return (c + 0x50);
      
      if (c >= 0x0410 && c <= 0x042f)
	return (c + 0x20);
      
      if ((c >= 0x0460 && c <= 0x0480) ||
	  (c >= 0x048a && c <= 0x04be) ||
	  (c >= 0x04d0 && c <= 0x04fe))
	{
	  if (!(c & 0x01))
	    return (c + 1);
	  return c;
	}
      
      if (c == 0x04c0)
	return 0x04cf;

      if (c >= 0x04c1 && c <= 0x04cd)
	{
	  if (c & 0x01)
	    return (c + 1);
	  return c;
	}
    }
  else if (c < 0x1f00)
    {
      if ((c >= 0x0500 && c <= 0x050e) ||
	  (c >= 0x0510 && c <= 0x0524) ||
	  (c >= 0x1e00 && c <= 0x1e94) ||
	  (c >= 0x1ea0 && c <= 0x1ef8))
	{
	  if (!(c & 0x01))
	    return (c + 1);
	  return c;
	}
      
      if (c >= 0x0531 && c <= 0x0556)
	return (c + 0x30);

      if (c >= 0x10a0 && c <= 0x10c5)
	return (c + 0x1c60);

      if (c == 0x1e9e)
	return 0x00df;

      if (c >= 0x1efa && c <= 0x1efe && !(c & 0x01))
	return (c + 1);
    }
  else if (c < 0x2000)
    {
      if ((c >= 0x1f08 && c <= 0x1f0f) ||
	  (c >= 0x1f18 && c <= 0x1f1d) ||
	  (c >= 0x1f28 && c <= 0x1f2f) ||
	  (c >= 0x1f38 && c <= 0x1f3f) ||
	  (c >= 0x1f48 && c <= 0x1f4d) ||
	  (c >= 0x1f68 && c <= 0x1f6f) ||
	  (c >= 0x1f88 && c <= 0x1f8f) ||
	  (c >= 0x1f98 && c <= 0x1f9f) ||
	  (c >= 0x1fa8 && c <= 0x1faf))
	return (c - 0x08);

      if (c >= 0x1f59 && c <= 0x1f5f)
	{
	  if (c & 0x01)
	    return (c - 0x08);
	  return c;
	}
    
      if (c >= 0x1fb8 && c <= 0x1ffc)
	{
	  wint_t k;
	  switch (c)
	    {
	    case 0x1fb8:
	    case 0x1fb9:
	    case 0x1fd8:
	    case 0x1fd9:
	    case 0x1fe8:
	    case 0x1fe9:
	      k = c - 0x08;
	      break;
	    case 0x1fba:
	    case 0x1fbb:
	      k = c - 0x4a;
	      break;
	    case 0x1fbc:
	      k = 0x1fb3;
	      break;
	    case 0x1fc8:
	    case 0x1fc9:
	    case 0x1fca:
	    case 0x1fcb:
	      k = c - 0x56;
	      break;
	    case 0x1fcc:
	      k = 0x1fc3;
	      break;
	    case 0x1fda:
	    case 0x1fdb:
	      k = c - 0x64;
	      break;
	    case 0x1fea:
	    case 0x1feb:
	      k = c - 0x70;
	      break;
	    case 0x1fec:
	      k = 0x1fe5;
	      break;
	    case 0x1ff8:
	    case 0x1ff9:
	      k = c - 0x80;
	      break;
	    case 0x1ffa:
	    case 0x1ffb:
	      k = c - 0x7e;
	      break;
	    case 0x1ffc:
	      k = 0x1ff3;
	      break;
	    default:
	      k = 0;
	    }
	  if (k != 0)
	    return k;
	}
    }
  else if (c < 0x2c00)
    {
      if (c >= 0x2160 && c <= 0x216f)
	return (c + 0x10);

      if (c >= 0x24b6 && c <= 0x24cf)
	return (c + 0x1a);
      
      switch (c)
      	{
	case 0x2126:
	  return 0x03c9;
	case 0x212a:
	  return 0x006b;
	case 0x212b:
	  return 0x00e5;
	case 0x2132:
	  return 0x214e;
	case 0x2183:
	  return 0x2184;
	}
    }
  else if (c < 0x2d00)
    {
      if (c >= 0x2c00 && c <= 0x2c2e)
	return (c + 0x30);

      if (c >= 0x2c80 && c <= 0x2ce2 && !(c & 0x01))
	return (c + 1);

      switch (c)
      	{
	case 0x2c60:
	  return 0x2c61;
	case 0x2c62:
	  return 0x026b;
	case 0x2c63:
	  return 0x1d7d;
	case 0x2c64:
	  return 0x027d;
	case 0x2c67:
	case 0x2c69:
	case 0x2c6b:
	case 0x2c72:
	case 0x2c75:
	case 0x2ceb:
	case 0x2ced:
	  return c + 1;
	case 0x2c6d:
	  return 0x0251;
	case 0x2c6e:
	  return 0x0271;
	case 0x2c6f:
	  return 0x0250;
	case 0x2c70:
	  return 0x0252;
	case 0x2c7e:
	  return 0x023f;
	case 0x2c7f:
	  return 0x0240;
	}
    }
  else if (c >= 0xa600 && c < 0xa800)
    {
      if ((c >= 0xa640 && c <= 0xa65e) ||
	  (c >= 0xa662 && c <= 0xa66c) ||
	  (c >= 0xa680 && c <= 0xa696) ||
	  (c >= 0xa722 && c <= 0xa72e) ||
	  (c >= 0xa732 && c <= 0xa76e) ||
	  (c >= 0xa77f && c <= 0xa786))
	{
	  if (!(c & 1))
	    return (c + 1);
	  return c;
	}

      switch (c)
      	{
	case 0xa779:
	case 0xa77b:
	case 0xa77e:
	case 0xa78b:
	  return (c + 1);
	case 0xa77d:
	  return 0x1d79;
	}
    }
  else
    {
      if (c >= 0xff21 && c <= 0xff3a)
	return (c + 0x20);
      
      if (c >= 0x10400 && c <= 0x10427)
	return (c + 0x28);
    }
  return c;
#else
  return (c < 0x00ff ? (wint_t)(tolower ((int)c)) : c);
#endif /* _MB_CAPABLE */
}

@


1.7
log
@	* libc/ctype/local.h (JP_JIS, JP_SJIS, JP_EUCJP): Move definition
	to jp2uc.c.
	(__jp2uc): Remove declaration.
	(_jp2uc): Declare.
	* libc/ctype/jp2uc.c (JP_JIS, JP_SJIS, JP_EUCJP): Define.
	(__jp2uc): Remove Cygwin special case.
	(_jp2uc): New function.  On Cygwin, just return c.
	* libc/ctype/iswalpha.c (iswalpha): Just call _jp2uc.
	* libc/ctype/iswblank.c (iswblank): Ditto.
	* libc/ctype/iswcntrl.c (iswcntrl): Ditto.
	* libc/ctype/iswprint.c (iswprint): Ditto.
	* libc/ctype/iswpunct.c (iswpunt): Ditto.
	* libc/ctype/iswspace.c (iswspace): Ditto.
	* libc/ctype/towlower.c (towlower): Ditto.
	* libc/ctype/towupper.c (towupper): Ditto.
@
text
@d74 6
d83 2
a84 1
	  (c >= 0x00c0 && c <= 0x00de))
a86 3
      if (c == 0x00b5)
	return 0x03bc;
      
d103 3
d107 1
a107 1
	  (c >= 0x01cd && c <= 0x91db))
a155 3
	    case 0x017f:
	      k = 0x0073;
	      break;
d234 40
a273 3

      if (c == 0x0220)
	return 0x019e;
d277 2
d283 1
a283 1
      if (c >= 0x0386 && c <= 0x03f5)
d307 1
a307 1
	      k = 0x038f;
d309 2
a310 2
	    case 0x03c2:
	      k = 0x03c3;
d312 1
a312 4
	    case 0x03d0:
	      k = 0x03b2;
	      break;
	    case 0x03d1:
d315 2
a316 2
	    case 0x03d5:
	      k = 0x03c6;
d318 2
a319 2
	    case 0x03d6:
	      k = 0x03c0;
d321 2
a322 2
	    case 0x03f0:
	      k = 0x03ba;
d324 2
a325 2
	    case 0x03f1:
	      k = 0x03c1;
d327 2
a328 5
	    case 0x03f2:
	      k = 0x03c3;
	      break;
	    case 0x03f4:
	      k = 0x03b8;
d330 2
a331 2
	    case 0x03f5:
	      k = 0x03b5;
a338 3

      if (c == 0x0345)
	return 0x03b9;
d350 1
a350 2
	  (c >= 0x04d0 && c <= 0x04f4) ||
	  (c == 0x04f8))
d357 3
d370 1
d382 8
a389 2
      if (c == 0x1e9b)
	return 0x1e61;
a430 3
	    case 0x1fbe:
	      k = 0x03b9;
	      break;
d451 4
d469 1
a469 1
  else 
d473 1
a473 1
      
d477 81
d561 1
a561 1
      if (c >= 0x10400 && c <= 0x10425)
a562 7

      if (c == 0x2126)
	return 0x03c9;
      if (c == 0x212a)
	return 0x006b;
      if (c == 0x212b)
	return 0x00e5;
@


1.6
log
@	* libc/ctype/iswalpha.c: Handle all wchar_t as unicode on
	_MB_CAPABLE systems.
	* libc/ctype/iswblank.c: Ditto.
	* libc/ctype/iswcntrl.c: Ditto.
	* libc/ctype/iswprint.c: Ditto.
	* libc/ctype/iswpunct.c: Ditto.
	* libc/ctype/iswspace.c: Ditto.
	* libc/ctype/jp2uc.c (__jp2uc): On Cygwin, just return c.
	Explain why.
	* libc/ctype/towlower.c: Ditto.
	* libc/ctype/towupper.c: Ditto.
	* libc/include/sys/config.h: Define _MB_EXTENDED_CHARSETS_ISO
	and _MB_EXTENDED_CHARSETS_WINDOWS if _MB_EXTENDED_CHARSETS_ALL is
	defined.  Define _MB_EXTENDED_CHARSETS_ALL on Cygwin only for now.
	* libc/include/sys/reent.h (struct _reent): Mark _current_category
	and _current_locale as unused.
	* libc/locale/locale.c: Add new charset support to documentation.
	Include ../stdio/local.h from here.
	(lc_ctype_charset): Set to "ASCII" by default.
	(lc_message_charset): Ditto.
	(_setlocale_r): Don't set _current_category and _current_locale.
	(loadlocale): Add Cygwin codepage support.  On _MB_CAPABLE
	systems, set __mbtowc and __wctomb function pointers to function
	corresponding with current charset.  Don't allow non-existant
	ISO-8859-12 charset.  Add support for Windows singlebyte codepages.
	On Cygwin, add support for GBK, CP949, and BIG5.  On Cygwin,
	call __set_ctype() in case the catorgy is LC_CTYPE.  Don't set
	_current_category and _current_locale.
	* libc/stdlib/Makefile.am (GENERAL_SOURCES): Add sb_charsets.c.
	* libc/stdlib/Makefile.in: Regenerate.
	* libc/stdlib/local.h: Add prototype for __locale_charset.
	Add prototypes for __mbtowc and __wctomb pointers.
	Add prototypes for charset-specific _wctomb_r and _mbtowc_r
	functions.
	Declare tables and functions from sb_charsets.c.
	* libc/stdlib/mbtowc_r.c (__mbtowc): Define.  Set to __ascii_mbtowc
	by default.
	(_mbtowc_r): Just call __mbtowc from here.
	(__ascii_mbtowc): New function.
	(__iso_mbtowc): New function.
	(__cp_mbtowc): New function.
	(__utf8_mbtowc): New function.
	(__sjis_mbtowc): New function.  Disable on Cygwin.
	(__eucjp_mbtowc): New function.  Disable on Cygwin.
	(__jis_mbtowc): New function.  Disable on Cygwin.
	* libc/stdlib/sb_charsets.c: New file, adding singlebyte to UTF
	conversion tables for all ISO and CP charsets.
	(__iso_8859_index): New function.
	(__cp_index): New function.
	* libc/stdlib/wctomb_r.c (__wctomb): Define.  Set to __ascii_wctomb
	by default.
	(_wctomb_r): Just call __wctomb from here.
	(__ascii_wctomb): New function.
	(__utf8_wctomb): New function.
	(__sjis_wctomb): New function.  Disable on Cygwin.
	(__eucjp_wctomb): New function.  Disable on Cygwin.
	(__jis_wctomb): New function.  Disable on Cygwin.
	(__iso_wctomb): New function.
	(__cp_wctomb): New function.
@
text
@d73 1
a73 7
  if (!strcmp (__locale_charset (), "JIS"))
    c = __jp2uc (c, JP_JIS);
  else if (!strcmp (__locale_charset (), "SJIS"))
    c = __jp2uc (c, JP_SJIS);
  else if (!strcmp (__locale_charset (), "EUCJP"))
    c = __jp2uc (c, JP_EUCJP);

@


1.5
log
@	* libc/locale/locale.c (_setlocale_r): New implementation based on
	FreeBSD's setlocale.
	(currentlocale): New helper function.
	(loadlocale): Ditto.
	(__locale_charset): New function.
	(__locale_msgcharset): Rename from __locale_charset.
	* libc/ctype/local.h (__lc_ctype): Remove declaration.
	(__locale_charset): Declare.
	* libc/ctype/iswalpha.c (iswalpha): Call __locale_charset instead of
	using __lc_ctype directly.  Only compare against the charset alone.
	* libc/ctype/iswblank.c (iswblank): Ditto.
	* libc/ctype/iswcntrl.c (iswcntrl): Ditto.
	* libc/ctype/iswprint.c (iswprint): Ditto.
	* libc/ctype/iswpunct.c (iswpunct): Ditto.
	* libc/ctype/iswspace.c (iswspace): Ditto.
	* libc/ctype/towlower.c (towlower): Ditto.
	* libc/ctype/towupper.c (towupper): Ditto.
	* libc/stdlib/mbtowc_r.c (_mbtowc_r): Ditto.
	* libc/stdlib/wctomb_r.c (_wctomb_r): Ditto.
	* libc/sys/linux/intl/loadmsgcat.c (_nl_init_domain_conv): Call
	__locale_msgcharset instead of __locale_charset.
@
text
@a72 2
  int unicode = 0;

d74 1
a74 4
    {
      c = __jp2uc (c, JP_JIS);
      unicode = 1;
    }
d76 1
a76 4
    {
      c = __jp2uc (c, JP_SJIS);
      unicode = 1;
    }
d78 3
d82 8
a89 2
      c = __jp2uc (c, JP_EUCJP);
      unicode = 1;
d91 1
a91 1
  else if (!strcmp (__locale_charset (), "UTF-8"))
d93 11
a103 2
      unicode = 1;
    }
d105 2
a106 3
  if (unicode)
    {
      if (c < 0x100)
d108 2
a109 7
	  if ((c >= 0x0041 && c <= 0x005a) ||
	      (c >= 0x00c0 && c <= 0x00de))
	    return (c + 0x20);

	  if (c == 0x00b5)
	    return 0x03bc;
	  
d112 2
a113 1
      else if (c < 0x300)
d115 2
a116 6
	  if ((c >= 0x0100 && c <= 0x012e) ||
	      (c >= 0x0132 && c <= 0x0136) ||
	      (c >= 0x014a && c <= 0x0176) ||
	      (c >= 0x01de && c <= 0x01ee) ||
	      (c >= 0x01f8 && c <= 0x021e) ||
	      (c >= 0x0222 && c <= 0x0232))
d118 114
a231 3
	      if (!(c & 0x01))
		return (c + 1);
	      return c;
d233 3
d237 13
a249 2
	  if ((c >= 0x0139 && c <= 0x0147) ||
	      (c >= 0x01cd && c <= 0x91db))
d251 53
a303 127
	      if (c & 0x01)
		return (c + 1);
	      return c;
	    }
	  
	  if (c >= 0x178 && c <= 0x01f7)
	    {
	      wint_t k;
	      switch (c)
		{
		case 0x0178:
		  k = 0x00ff;
		  break;
		case 0x0179:
		case 0x017b:
		case 0x017d:
		case 0x0182:
		case 0x0184:
		case 0x0187:
		case 0x018b:
		case 0x0191:
		case 0x0198:
		case 0x01a0:
		case 0x01a2:
		case 0x01a4:
		case 0x01a7:
		case 0x01ac:
		case 0x01af:
		case 0x01b3:
		case 0x01b5:
		case 0x01b8:
		case 0x01bc:
		case 0x01c5:
		case 0x01c8:
		case 0x01cb:
		case 0x01cd:
		case 0x01cf:
		case 0x01d1:
		case 0x01d3:
		case 0x01d5:
		case 0x01d7:
		case 0x01d9:
		case 0x01db:
		case 0x01f2:
		case 0x01f4:
		  k = c + 1;
		  break;
		case 0x017f:
		  k = 0x0073;
		  break;
		case 0x0181:
		  k = 0x0253;
		  break;
		case 0x0186:
		  k = 0x0254;
		  break;
		case 0x0189:
		  k = 0x0256;
		  break;
		case 0x018a:
		  k = 0x0257;
		  break;
		case 0x018e:
		  k = 0x01dd;
		  break;
		case 0x018f:
		  k = 0x0259;
		  break;
		case 0x0190:
		  k = 0x025b;
		  break;
		case 0x0193:
		  k = 0x0260;
		  break;
		case 0x0194:
		  k = 0x0263;
		  break;
		case 0x0196:
		  k = 0x0269;
		  break;
		case 0x0197:
		  k = 0x0268;
		  break;
		case 0x019c:
		  k = 0x026f;
		  break;
		case 0x019d:
		  k = 0x0272;
		  break;
		case 0x019f:
		  k = 0x0275;
		  break;
		case 0x01a6:
		  k = 0x0280;
		  break;
		case 0x01a9:
		  k = 0x0283;
		  break;
		case 0x01ae:
		  k = 0x0288;
		  break;
		case 0x01b1:
		  k = 0x028a;
		  break;
		case 0x01b2:
		  k = 0x028b;
		  break;
		case 0x01b7:
		  k = 0x0292;
		  break;
		case 0x01c4:
		case 0x01c7:
		case 0x01ca:
		case 0x01f1:
		  k = c + 2;
		  break;
		case 0x01f6:
		  k = 0x0195;
		  break;
		case 0x01f7:
		  k = 0x01bf;
		  break;
		default:
		  k = 0;
		}
	      if (k != 0)
		return k;
d305 3
d309 19
a327 2
	  if (c == 0x0220)
	    return 0x019e;
d329 2
a330 1
      else if (c < 0x0400)
d332 1
a332 3
	  if (c >= 0x0391 && c <= 0x03ab && c != 0x03a2)
	    return (c + 0x20);
	  if (c >= 0x03d8 && c <= 0x03ee && !(c & 0x01))
d334 1
a334 65
	  if (c >= 0x0386 && c <= 0x03f5)
	    {
	      wint_t k;
	      switch (c)
		{
		case 0x0386:
		  k = 0x03ac;
		  break;
		case 0x0388:
		  k = 0x03ad;
		  break;
		case 0x0389:
		  k = 0x03ae;
		  break;
		case 0x038a:
		  k = 0x03af;
		  break;
		case 0x038c:
		  k = 0x03cc;
		  break;
		case 0x038e:
		  k = 0x03cd;
		  break;
		case 0x038f:
		  k = 0x038f;
		  break;
		case 0x03c2:
		  k = 0x03c3;
		  break;
		case 0x03d0:
		  k = 0x03b2;
		  break;
		case 0x03d1:
		  k = 0x03b8;
		  break;
		case 0x03d5:
		  k = 0x03c6;
		  break;
		case 0x03d6:
		  k = 0x03c0;
		  break;
		case 0x03f0:
		  k = 0x03ba;
		  break;
		case 0x03f1:
		  k = 0x03c1;
		  break;
		case 0x03f2:
		  k = 0x03c3;
		  break;
		case 0x03f4:
		  k = 0x03b8;
		  break;
		case 0x03f5:
		  k = 0x03b5;
		  break;
		default:
		  k = 0;
		}
	      if (k != 0)
		return k;
	    }

	  if (c == 0x0345)
	    return 0x03b9;
d336 6
a341 1
      else if (c < 0x500)
d343 3
a345 22
	  if (c >= 0x0400 && c <= 0x040f)
	    return (c + 0x50);
	  
	  if (c >= 0x0410 && c <= 0x042f)
	    return (c + 0x20);
	  
	  if ((c >= 0x0460 && c <= 0x0480) ||
	      (c >= 0x048a && c <= 0x04be) ||
	      (c >= 0x04d0 && c <= 0x04f4) ||
	      (c == 0x04f8))
	    {
	      if (!(c & 0x01))
		return (c + 1);
	      return c;
	    }
	  
	  if (c >= 0x04c1 && c <= 0x04cd)
	    {
	      if (c & 0x01)
		return (c + 1);
	      return c;
	    }
d347 21
a367 1
      else if (c < 0x1f00)
d369 3
a371 14
	  if ((c >= 0x0500 && c <= 0x050e) ||
	      (c >= 0x1e00 && c <= 0x1e94) ||
	      (c >= 0x1ea0 && c <= 0x1ef8))
	    {
	      if (!(c & 0x01))
		return (c + 1);
	      return c;
	    }
	  
	  if (c >= 0x0531 && c <= 0x0556)
	    return (c + 0x30);

	  if (c == 0x1e9b)
	    return 0x1e61;
d373 2
a374 1
      else if (c < 0x2000)
d376 2
a377 19
	  if ((c >= 0x1f08 && c <= 0x1f0f) ||
	      (c >= 0x1f18 && c <= 0x1f1d) ||
	      (c >= 0x1f28 && c <= 0x1f2f) ||
	      (c >= 0x1f38 && c <= 0x1f3f) ||
	      (c >= 0x1f48 && c <= 0x1f4d) ||
	      (c >= 0x1f68 && c <= 0x1f6f) ||
	      (c >= 0x1f88 && c <= 0x1f8f) ||
	      (c >= 0x1f98 && c <= 0x1f9f) ||
	      (c >= 0x1fa8 && c <= 0x1faf))
	    return (c - 0x08);

	  if (c >= 0x1f59 && c <= 0x1f5f)
	    {
	      if (c & 0x01)
		return (c - 0x08);
	      return c;
	    }
	
	  if (c >= 0x1fb8 && c <= 0x1ffc)
d379 47
a425 53
	      wint_t k;
	      switch (c)
		{
		case 0x1fb8:
		case 0x1fb9:
		case 0x1fd8:
		case 0x1fd9:
		case 0x1fe8:
		case 0x1fe9:
		  k = c - 0x08;
		  break;
		case 0x1fba:
		case 0x1fbb:
		  k = c - 0x4a;
		  break;
		case 0x1fbc:
		  k = 0x1fb3;
		  break;
		case 0x1fbe:
		  k = 0x03b9;
		  break;
		case 0x1fc8:
		case 0x1fc9:
		case 0x1fca:
		case 0x1fcb:
		  k = c - 0x56;
		  break;
		case 0x1fcc:
		  k = 0x1fc3;
		  break;
		case 0x1fda:
		case 0x1fdb:
		  k = c - 0x64;
		  break;
		case 0x1fea:
		case 0x1feb:
		  k = c - 0x70;
		  break;
		case 0x1fec:
		  k = 0x1fe5;
		  break;
		case 0x1ffa:
		case 0x1ffb:
		  k = c - 0x7e;
		  break;
		case 0x1ffc:
		  k = 0x1ff3;
		  break;
		default:
		  k = 0;
		}
	      if (k != 0)
		return k;
d427 2
d430 14
a443 13
      else 
	{
	  if (c >= 0x2160 && c <= 0x216f)
	    return (c + 0x10);
	  
	  if (c >= 0x24b6 && c <= 0x24cf)
	    return (c + 0x1a);
	  
	  if (c >= 0xff21 && c <= 0xff3a)
	    return (c + 0x20);
	  
	  if (c >= 0x10400 && c <= 0x10425)
	    return (c + 0x28);
d445 10
a454 8
	  if (c == 0x2126)
	    return 0x03c9;
	  if (c == 0x212a)
	    return 0x006b;
	  if (c == 0x212b)
	    return 0x00e5;
	}
    }     
a455 2
  
  return (c < 0x00ff ? (wint_t)(tolower ((int)c)) : c);
@


1.4
log
@
2005-10-28  Bob Wilson  <bob.wilson@@acm.org>

        * libc/ctype/ctype.tex: Use hyphens as appropriate, but not  otherwise.
        * libc/ctype/islower.c: Likewise.
        * libc/ctype/isupper.c: Likewise.
        * libc/ctype/iswalnum.c: Likewise.
        * libc/ctype/iswalpha.c: Likewise.
        * libc/ctype/iswblank.c: Likewise.
        * libc/ctype/iswcntrl.c: Likewise.
        * libc/ctype/iswdigit.c: Likewise.
        * libc/ctype/iswgraph.c: Likewise.
        * libc/ctype/iswlower.c: Likewise.
        * libc/ctype/iswprint.c: Likewise.
        * libc/ctype/iswpunct.c: Likewise.
        * libc/ctype/iswspace.c: Likewise.
        * libc/ctype/iswupper.c: Likewise.
        * libc/ctype/iswxdigit.c: Likewise.
        * libc/ctype/tolower.c: Likewise.
        * libc/ctype/toupper.c: Likewise.
        * libc/ctype/towctrans.c: Likewise.
        * libc/ctype/towlower.c: Likewise.
        * libc/ctype/towupper.c: Likewise.
        * libc/string/strcasecmp.c: Likewise.
        * libc/string/strcoll.c: Likewise.
        * libc/string/strings.tex: Likewise.
        * libc/string/strlwr.c: Likewise.
        * libc/string/strncasecmp.c: Likewise.
        * libc/string/strupr.c: Likewise.
        * libc/string/wcscoll.c: Likewise.
        * libc/string/wcslcat.c: Likewise.
        * libc/string/wcslcpy.c: Likewise.
        * libc/string/wcsnlen.c: Likewise.
        * libc/string/wcsstr.c: Likewise.
        * libc/string/wcstrings.tex: Likewise.
        * libc/string/wmemchr.c: Likewise.
        * libc/string/wmemcmp.c: Likewise.
        * libc/string/wmemcpy.c: Likewise.
        * libc/string/wmemmove.c: Likewise.
        * libc/string/wmemset.c: Likewise.
@
text
@d72 1
d75 1
a75 7
  if (__lc_ctype[0] == 'C' && __lc_ctype[1] == '\0')
    {
      unicode = 0;
      /* fall-through */ 
    }
#ifdef _MB_CAPABLE
  else if (!strcmp (__lc_ctype, "C-JIS"))
d80 1
a80 1
  else if (!strcmp (__lc_ctype, "C-SJIS"))
d85 1
a85 1
  else if (!strcmp (__lc_ctype, "C-EUCJP"))
d90 1
a90 1
  else if (!strcmp (__lc_ctype, "C-UTF-8"))
@


1.3
log
@
2004-04-23  Artem B. Bityuckiy  <abitytsky@@softminecorp.com>

        * configure.in: Define _MB_CAPABLE if mb supported.
        * configure: Regenerated.
        * configure.host: Remove manual setting of MB_CAPABLE compiler
        flag.
        * newlib.hin: Add _MB_CAPABLE flag.
        * libc/ctype/iswalpha.c, libc/ctype/iswblank.c: Include <newlib.h>
        and check for _MB_CAPABLE flag instead of MB_CAPABLE.
        * libc/ctype/iswcntrl.c, libc/ctype/iswprint.c: Ditto.
        * libc/ctype/iswpunct.c, libc/ctype/iswspace.c: Ditto.
        * libc/ctype/jp2uc.c: Ditto.
        * libc/ctype/towlower.c, libc/ctype/towupper.c: Ditto.
        * libc/locale/locale.c: Ditto
        * libc/machine/powerpc/vfscanf.c: Ditto
        * libc/stdio/vfprintf.c, libc/stdio/vfscanf.c: Ditto
        * libc/stdlib/mblen.c: Ditto
        * libc/stdlib/mblen_r.c, libc/stdlib/mbrlen.c: Ditto
        * libc/stdlib/mbrtowc.c, libc/stdlib/mbsrtowcs.c: Ditto
        * libc/stdlib/mbstowcs.c, libc/stdlib/mbtowc.c: Ditto
        * libc/stdlib/mbtowc_r.c, libc/stdlib/wcrtomb.c: Ditto
        * libc/stdlib/wcsrtombs.c, libc/stdlib/wcstombs.c: Ditto
        * libc/stdlib/wctomb.c, libc/sys/linux/intl/dcigettext.c: Ditto
        * libc/sys/linux/intl/explodename.c: Ditto
        * libc/sys/linux/intl/finddomain.c: Ditto
        * libc/sys/linux/intl/l10nflist.c: Ditto
        * libc/sys/linux/intl/loadmsgcat.c: Ditto
        * libc/sys/linux/intl/localealias.c: Ditto
@
text
@d32 1
a32 1
	<<towlower>>---translate wide-characters to lower case
d48 2
a49 2
<<towlower>> is a function which converts upper-case wide-characters to lower
case, leaving all other characters unchanged.
d52 2
a53 2
<<towlower>> returns the lower-case equivalent of <[c]> when it is a
upper-case wide-character, otherwise, it returns the input character.
@


1.2
log
@
2003-07-31  Jeff Johnston  <jjohnstn@@redhat.com>

        * libc/ctype/iswalpha.c: Fix calls to __jp2uc to pass the
        correct type of conversion when dealing with EUCJP or SJIS.
        * libc/ctype/iswblank.c: Ditto.
        * libc/ctype/iswcntrl.c: Ditto.
        * libc/ctype/iswprint.c: Ditto.
        * libc/ctype/iswpunct.c: Ditto.
        * libc/ctype/iswspace.c: Ditto.
        * libc/ctype/towlower.c: Ditto.
        * libc/ctype/towupper.c: Ditto.
@
text
@d62 1
d79 1
a79 1
#ifdef MB_CAPABLE
d475 1
a475 1
#endif /* MB_CAPABLE */
@


1.1
log
@
2002-09-20  Jeff Johnston  <jjohnstn@@redhat.com>

        * libc/ctype/Makefile.am: Add new files.
        * libc/ctype/Makefile.in: Regenerated.
        * libc/ctype/ctype.tex: Add new iswxxxx, towxxxx, wctype,
        and wctrans functions to documentation index.
        * libc/ctype/iswalnum.c: New file.
        * libc/ctype/iswalpha.c: Ditto.
        * libc/ctype/iswblank.c: Ditto.
        * libc/ctype/iswcntrl.c: Ditto.
        * libc/ctype/iswctype.c: Ditto.
        * libc/ctype/iswdigit.c: Ditto.
        * libc/ctype/iswgraph.c: Ditto.
        * libc/ctype/iswlower.c: Ditto.
        * libc/ctype/iswprint.c: Ditto.
        * libc/ctype/iswpunct.c: Ditto.
        * libc/ctype/iswspace.c: Ditto.
        * libc/ctype/iswupper.c: Ditto.
        * libc/ctype/iswxdigit.c: Ditto.
        * libc/ctype/jp2uc.c: Ditto.
        * libc/ctype/jp2uc.h: Ditto.
        * libc/ctype/local.h: Ditto.
        * libc/ctype/towctrans.c: Ditto.
        * libc/ctype/towlower.c: Ditto.
        * libc/ctype/towupper.c: Ditto.
        * libc/ctype/utf8alpha.h: Ditto.
        * libc/ctype/utf8print.h: Ditto.
        * libc/ctype/utf8punct.h: Ditto.
        * libc/ctype/wctrans.c: Ditto.
        * libc/ctype/wctype.c: Ditto.
        * libc/locale/locale.c (__lc_ctype): New external array to
        replace static lc_ctype array.
        * libc/stdlib/mbtowc_r.c: Use __lc_ctype to check current lc_ctype
        rather than reentrancy structure's _current_locale field.
        * libc/stdlib/wctomb_r.c: Ditto.
@
text
@d86 1
a86 1
      c = __jp2uc (c, JP_JIS);
d91 1
a91 1
      c = __jp2uc (c, JP_JIS);
@

