head	1.2;
access;
symbols
	cygwin-1_7_35-release:1.2
	cygwin-1_7_34-release:1.2
	newlib-2_2_0:1.2.0.10
	cygwin-1_7_33-release:1.2
	cygwin-1_7_32-release:1.2
	cygwin-1_7_31-release:1.2
	cygwin-1_7_30-release:1.2
	cygwin-1_7_29-release:1.2
	cygwin-1_7_28-release:1.2
	newlib-2_1_0:1.2
	cygwin-1_7_27-release:1.2
	cygwin-1_7_26-release:1.2
	cygwin-1_7_25-release:1.2
	cygwin-1_7_24-release:1.2
	cygwin-1_7_23-release:1.2
	cygwin-1_7_22-release:1.2
	cygwin-1_7_21-release:1.2
	cygwin-1_7_20-release:1.2
	cygwin-1_7_19-release:1.2
	cygwin-64bit-postmerge:1.2
	cygwin-64bit-premerge-branch:1.2.0.8
	cygwin-64bit-premerge:1.2
	cygwin-1_7_18-release:1.2
	newlib-2_0_0:1.2
	cygwin-1_7_17-release:1.2
	cygwin-64bit-branch:1.2.0.6
	cygwin-1_7_16-release:1.2
	cygwin-1_7_15-release:1.2
	cygwin-1_7_14_2-release:1.2
	cygwin-1_7_14-release:1.2
	cygwin-1_7_12-release:1.2
	cygwin-1_7_11-release:1.2
	cygwin-1_7_10-release:1.2
	newlib-1_20_0:1.2
	cygwin-1_7_9-release:1.2
	cygwin-1_7_8-release:1.2
	newlib-1_19_0:1.2
	cygwin-1_7_7-release:1.2
	cygwin-1_7_5-release:1.2
	cygwin-1_7_4-release:1.2
	cygwin-1_7_3-release:1.2
	cygwin-1_7_2-release:1.2
	newlib-1_18_0:1.2
	cygwin-1_7_1-release:1.2
	newlib-1_17_0-arc:1.2.0.4
	binutils-arc-20080908-branch:1.2.0.2
	binutils-arc-20080908-branchpoint:1.2
	newlib-1_17_0:1.2
	newlib-1_16_0:1.1.1.1
	newlib-1_15_0:1.1.1.1
	newlib-csl-coldfire-4_1-32:1.1.1.1
	newlib-csl-sourcerygxx-4_1-32:1.1.1.1
	newlib-csl-innovasic-fido-3_4_4-33:1.1.1.1
	newlib-csl-coldfire-4_1-30:1.1.1.1
	newlib-csl-sourcerygxx-4_1-30:1.1.1.1
	newlib-csl-coldfire-4_1-28:1.1.1.1
	newlib-csl-sourcerygxx-4_1-28:1.1.1.1
	newlib-csl-arm-2006q3-27:1.1.1.1
	newlib-csl-sourcerygxx-4_1-27:1.1.1.1
	newlib-csl-arm-2006q3-26:1.1.1.1
	newlib-csl-sourcerygxx-4_1-26:1.1.1.1
	newlib-csl-sourcerygxx-4_1-24:1.1.1.1
	newlib-csl-sourcerygxx-4_1-23:1.1.1.1
	newlib-csl-sourcerygxx-4_1-21:1.1.1.1
	newlib-csl-arm-2006q3-21:1.1.1.1
	newlib-csl-arm-2006q3-19:1.1.1.1
	newlib-csl-sourcerygxx-4_1-19:1.1.1.1
	newlib-csl-sourcerygxx-4_1-18:1.1.1.1
	newlib-csl-sourcerygxx-3_4_4-25:1.1.1.1
	newlib-csl-sourcerygxx-4_1-17:1.1.1.1
	cr-0x5f1:1.1.1.1.0.6
	newlib-csl-sourcerygxx-4_1-14:1.1.1.1
	newlib-csl-sourcerygxx-4_1-13:1.1.1.1
	newlib-csl-sourcerygxx-4_1-12:1.1.1.1
	newlib-csl-sourcerygxx-4_1-9:1.1.1.1
	newlib-csl-sourcerygxx-4_1-8:1.1.1.1
	newlib-csl-sourcerygxx-4_1-7:1.1.1.1
	newlib-csl-arm-2006q1-6:1.1.1.1
	newlib-csl-sourcerygxx-4_1-6:1.1.1.1
	newlib-csl-sourcerygxx-4_1-5:1.1.1.1
	newlib-csl-sourcerygxx-4_1-4:1.1.1.1
	newlib-autotools-branch:1.1.1.1.0.4
	newlib-csl-20060320-branch:1.1.1.1.0.2
	newlib-csl-20060320-branchpoint:1.1.1.1
	newlib-1_14_0:1.1.1.1
	newlib-csl-arm-2005-q1b:1.1.1.1
	newlib-csl-arm-2005-q1a:1.1.1.1
	newlib-1_13_0:1.1.1.1
	csl-arm-2004-q3:1.1.1.1
	csl-arm-2004-q1a:1.1.1.1
	csl-arm-2004-q1:1.1.1.1
	newlib-1_12_0:1.1.1.1
	csl-arm-2003-q4:1.1.1.1
	w32api-2_2:1.1.1.1
	mingw-runtime-2_4:1.1.1.1
	newlib-1_11_0:1.1.1.1
	cygnus_cvs_20020108_pre:1.1.1.1
	newlib-1_10_0:1.1.1.1
	newlib-1_9_0:1.1.1.1
	newlib-2000-02-17:1.1.1.1
	SNAPSHOT:1.1.1;
locks; strict;
comment	@ * @;
expand	@o@;


1.2
date	2008.01.03.22.33.37;	author jjohnstn;	state Exp;
branches;
next	1.1;

1.1
date	2000.02.17.19.39.49;	author cgf;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2000.02.17.19.39.49;	author cgf;	state Exp;
branches;
next	;


desc
@@


1.2
log
@
2008-01-03  Jeff Johnston  <jjohnstn@@redhat.com>

        Make isatty syscall handling consistent with other newlib syscalls.

        * libc/include/_syslist.h: Add _isatty.
        * libc/include/reent.h: Add _isatty_r.
        * libc/include/sys/unistd.h: Add _isatty.
        * libc/posix/Makefile.am: Add new _isatty.c file.
        * libc/posix/Makefile.in: Regenerated.
        * libc/posix/_isatty.c: New file.
        * libc/posix/isatty.c: Changed to call _isatty().
        * libc/reent/Makefile.am: Add new isattyr.c file.
        * libc/reent/Makefile.in: Regenerated.
        * libc/reent/isattyr.c: New file.
        * libc/stdio/freopen.c: Changed to call _isatty_r().
        * libc/stdio/makebuf.c: Ditto.
        * libc/sys/a29khif/_isatty.S: Change isatty to _isatty.
        * libc/sys/arc/isatty.c: Ditto.
        * libc/sys/arm/syscalls.c: Ditto.
        * libc/sys/d10v/syscalls.c: Ditto.
        * libc/sys/h8300hms/syscalls.c: Ditto.
        * libc/sys/h8500hms/syscalls.c: Ditto.
        * libc/sys/linux/Makefile.am: Add new isatty.c file.
        * libc/sys/linux/Makefile.in: Regenerated.
        * libc/sys/linux/isatty.c: New file.
        * libc/syscalls/Makefile.am: Add new sysisatty.c file.
        * libc/syscalls/Makefile.in: Regenerated.
        * libc/syscalls/sysisatty.c: New file.
@
text
@/* syscalls.c - non-trap system calls for D10V
 *
 * This file contains system calls that cannot be implemented with
 * a simple "trap 15" instruction.  The ones that can are in trap.S.
 */

#include <_ansi.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <errno.h>
#undef	errno

void _exit (int n);	/* in trap.S */

extern int _write (int fd, const void *ptr, size_t len);

int errno;

register char *stack_ptr asm ("sp");

caddr_t
_sbrk (int incr)
{
  extern char end;		/* Defined by the linker */
  static char *heap_end;
  char *prev_heap_end;
  char *sp = (char *)stack_ptr;

  if (heap_end == 0)
    {
      heap_end = (char *)((((unsigned short) &end) + 7) & ~7);
    }
  prev_heap_end = heap_end;
  if (heap_end + incr > sp)
    {
      _write (2, "Heap and stack collision\n", sizeof ("Heap and stack collision\n")-1);
      abort ();
    }
  heap_end += incr;
  if ((unsigned short)heap_end > 0xbfff
      || (heap_end < prev_heap_end && incr > 0)
      || (heap_end < (char *)((((unsigned short) &end) + 7) & ~7)))
    {
      _write (2, "Too much memory was allocated\n", sizeof ("Too much memory was allocated\n")-1);
      abort ();
    }

  return (caddr_t) prev_heap_end;
}

int
_fstat (int file,
	struct stat *st)
{
  st->st_mode = S_IFCHR;
  return 0;
}

int
_unlink ()
{
  errno = ENOSYS;
  return -1;
}

int
_isatty (int fd)
{
  return 1;
}

void
_raise ()
{
}

/* If this library is compiled with -mint32, provide conversion functions for
   the system call traps.  */

#if __INT__==32
extern short _read16 (short fd, void *ptr, short len);
int
_read (int fd, void *ptr, size_t len)
{
  return _read16 ((short)fd, ptr, (short)len);
}

extern short _write16 (short fd, const void *ptr, short len);
int
_write (int fd, const void *ptr, size_t len)
{
  return _write16 ((short)fd, ptr, (short)len);
}

extern short _lseek16 (short fd, long offset, short whence);
int
_lseek (int fd, off_t offset, int whence)
{
  return _lseek16 ((short)fd, offset, (short)whence);
}

extern short _close16 (short fd);
int
_close (int fd)
{
  return _close16 ((short)fd);
}

extern short _open16 (const char *name, short flags, short mode);
int
_open (const char *name, int flags, mode_t mode)
{
  return _open16 (name, (short)flags, (short)mode);
}

extern short _creat16 (const char *name, mode_t mode);
int
_creat (const char *name, mode_t mode)
{
  return _creat16 (name, mode);
}

extern void _exit16 (short status);
void
_exit (int status)
{
  _exit16 ((short)status);
}

extern short _stat16 (const char *name, struct stat *stat_pkt);
int
_stat (const char *name, struct stat *stat_pkt)
{
  return _stat16 (name, stat_pkt);
}

extern short _chmod16 (const char *name, short mode);
int
_chmod (const char *name, mode_t mode)
{
  return _chmod16 (name, (short)mode);
}

extern short _chown16 (const char *name, short uid, short gid);
int
_chown (const char *name, uid_t uid, gid_t gid)
{
  return _chown16 (name, (short)uid, (short)gid);
}

extern short _fork16 (void);
int
_fork (void)
{
  return _fork16 ();
}

extern short _wait16 (short *status);
int
_wait (int *status)
{
  if (status)
    {
      short status16;
      short ret = _wait16 (&status16);
      if (ret >= 0)
	*status = status16;
      return ret;
    }
  else
    return _wait16 ((short *)0);
}

extern short _execve16 (const char *filename, const char *argv [], const char *envp[]);
int
_execve (const char *filename, const char *argv [], const char *envp[])
{
  return _execve16 (filename, argv, envp);
}

extern short _execv16 (const char *filename, const char *argv []);
int
_execv (const char *filename, const char *argv [])
{
  return _execv16 (filename, argv);
}

extern short _pipe16 (short fds[]);
int
_pipe (int fds[])
{
  short fds16[2];
  short ret = _pipe16 (fds16);
  if (ret >= 0)
    {
      fds[0] = fds16[0];
      fds[1] = fds16[1];
    }

  return ret;
}

extern short _getpid16 (void);
int
_getpid (void)
{
  return _getpid16 ();
}

extern short _kill16 (short pid, short sig);
int
_kill (int pid, int sig)
{
  return _kill16 ((short)pid, (short)sig);
}
#endif
@


1.1
log
@Initial revision
@
text
@d67 1
a67 1
isatty (int fd)
@


1.1.1.1
log
@import newlib-2000-02-17 snapshot
@
text
@@
