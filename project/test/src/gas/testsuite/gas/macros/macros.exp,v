head	1.32;
access;
symbols
	binutils-2_24-branch:1.32.0.2
	binutils-2_24-branchpoint:1.32
	binutils-2_21_1:1.31
	binutils-2_23_2:1.31
	binutils-2_23_1:1.31
	binutils-2_23:1.31
	binutils-2_23-branch:1.31.0.8
	binutils-2_23-branchpoint:1.31
	binutils-2_22_branch:1.31.0.6
	binutils-2_22:1.31
	binutils-2_22-branch:1.31.0.4
	binutils-2_22-branchpoint:1.31
	binutils-2_21:1.31
	binutils-2_21-branch:1.31.0.2
	binutils-2_21-branchpoint:1.31
	binutils-2_20_1:1.29
	binutils-2_20:1.29
	binutils-arc-20081103-branch:1.29.0.10
	binutils-arc-20081103-branchpoint:1.29
	binutils-2_20-branch:1.29.0.8
	binutils-2_20-branchpoint:1.29
	dje-cgen-play1-branch:1.29.0.6
	dje-cgen-play1-branchpoint:1.29
	arc-20081103-branch:1.29.0.4
	arc-20081103-branchpoint:1.29
	binutils-2_19_1:1.29
	binutils-2_19:1.29
	binutils-2_19-branch:1.29.0.2
	binutils-2_19-branchpoint:1.29
	binutils-2_18:1.27
	binutils-2_18-branch:1.27.0.2
	binutils-2_18-branchpoint:1.27
	binutils-csl-coldfire-4_1-32:1.26
	binutils-csl-sourcerygxx-4_1-32:1.26
	binutils-csl-innovasic-fido-3_4_4-33:1.26
	binutils-csl-sourcerygxx-3_4_4-32:1.21
	binutils-csl-coldfire-4_1-30:1.26
	binutils-csl-sourcerygxx-4_1-30:1.26
	binutils-csl-coldfire-4_1-28:1.26
	binutils-csl-sourcerygxx-4_1-29:1.26
	binutils-csl-sourcerygxx-4_1-28:1.26
	binutils-csl-arm-2006q3-27:1.26
	binutils-csl-sourcerygxx-4_1-27:1.26
	binutils-csl-arm-2006q3-26:1.26
	binutils-csl-sourcerygxx-4_1-26:1.26
	binutils-csl-sourcerygxx-4_1-25:1.26
	binutils-csl-sourcerygxx-4_1-24:1.26
	binutils-csl-sourcerygxx-4_1-23:1.26
	binutils-csl-sourcerygxx-4_1-21:1.26
	binutils-csl-arm-2006q3-21:1.26
	binutils-csl-sourcerygxx-4_1-22:1.26
	binutils-csl-palmsource-arm-prelinker-1_0-1:1.26
	binutils-csl-sourcerygxx-4_1-20:1.26
	binutils-csl-arm-2006q3-19:1.26
	binutils-csl-sourcerygxx-4_1-19:1.26
	binutils-csl-sourcerygxx-4_1-18:1.26
	binutils-csl-renesas-4_1-9:1.26
	binutils-csl-sourcerygxx-3_4_4-25:1.21
	binutils-csl-renesas-4_1-8:1.26
	binutils-csl-renesas-4_1-7:1.26
	binutils-csl-renesas-4_1-6:1.26
	binutils-csl-sourcerygxx-4_1-17:1.26
	binutils-csl-sourcerygxx-4_1-14:1.26
	binutils-csl-sourcerygxx-4_1-15:1.26
	binutils-csl-sourcerygxx-4_1-13:1.26
	binutils-2_17:1.26
	binutils-csl-sourcerygxx-4_1-12:1.26
	binutils-csl-sourcerygxx-3_4_4-21:1.26
	binutils-csl-wrs-linux-3_4_4-24:1.21
	binutils-csl-wrs-linux-3_4_4-23:1.21
	binutils-csl-sourcerygxx-4_1-9:1.26
	binutils-csl-sourcerygxx-4_1-8:1.26
	binutils-csl-sourcerygxx-4_1-7:1.26
	binutils-csl-arm-2006q1-6:1.26
	binutils-csl-sourcerygxx-4_1-6:1.26
	binutils-csl-wrs-linux-3_4_4-22:1.21
	binutils-csl-coldfire-4_1-11:1.26
	binutils-csl-sourcerygxx-3_4_4-19:1.26
	binutils-csl-coldfire-4_1-10:1.26
	binutils-csl-sourcerygxx-4_1-5:1.26
	binutils-csl-sourcerygxx-4_1-4:1.26
	binutils-csl-wrs-linux-3_4_4-21:1.21
	binutils-csl-morpho-4_1-4:1.26
	binutils-csl-sourcerygxx-3_4_4-17:1.26
	binutils-csl-wrs-linux-3_4_4-20:1.21
	binutils-2_17-branch:1.26.0.4
	binutils-2_17-branchpoint:1.26
	binutils-csl-2_17-branch:1.26.0.2
	binutils-csl-2_17-branchpoint:1.26
	binutils-csl-gxxpro-3_4-branch:1.21.0.6
	binutils-csl-gxxpro-3_4-branchpoint:1.21
	binutils-2_16_1:1.21
	binutils-csl-arm-2005q1b:1.21
	binutils-2_16:1.21
	binutils-csl-arm-2005q1a:1.21
	binutils-csl-arm-2005q1-branch:1.21.0.4
	binutils-csl-arm-2005q1-branchpoint:1.21
	binutils-2_16-branch:1.21.0.2
	binutils-2_16-branchpoint:1.21
	csl-arm-2004-q3d:1.17
	csl-arm-2004-q3:1.16
	binutils-2_15:1.15
	binutils-2_15-branchpoint:1.15
	csl-arm-2004-q1a:1.16
	csl-arm-2004-q1:1.16
	binutils-2_15-branch:1.15.0.6
	cagney_bfdfile-20040213-branch:1.15.0.4
	cagney_bfdfile-20040213-branchpoint:1.15
	cagney_bigcore-20040122-branch:1.15.0.2
	cagney_bigcore-20040122-branchpoint:1.15
	csl-arm-2003-q4:1.15
	binutils-2_14:1.13.2.1
	binutils-2_14-branch:1.13.0.2
	binutils-2_14-branchpoint:1.13
	binutils-2_13_2_1:1.10
	binutils-2_13_2:1.10
	binutils-2_13_1:1.10
	binutils-2_13:1.10
	binutils-2_13-branchpoint:1.10
	binutils-2_13-branch:1.10.0.4
	binutils-2_12_1:1.10
	binutils-2_12:1.10
	binutils-2_12-branch:1.10.0.2
	binutils-2_12-branchpoint:1.10
	cygnus_cvs_20020108_pre:1.10
	binutils-2_11_2:1.6.2.1
	binutils-2_11_1:1.6.2.1
	binutils-2_11:1.6.2.1
	x86_64versiong3:1.6
	binutils-2_11-branch:1.6.0.2
	binutils-2_10_1:1.1.1.1
	binutils-2_10:1.1.1.1
	binutils-2_10-branch:1.1.1.1.0.2
	binutils-2_10-branchpoint:1.1.1.1
	binutils_latest_snapshot:1.32
	repo-unification-2000-02-06:1.1.1.1
	binu_ss_19990721:1.1.1.1
	binu_ss_19990602:1.1.1.1
	binu_ss_19990502:1.1.1.1
	cygnus:1.1.1;
locks; strict;
comment	@# @;


1.32
date	2012.12.17.16.55.55;	author nickc;	state Exp;
branches;
next	1.31;

1.31
date	2009.10.15.10.58.34;	author amodra;	state Exp;
branches;
next	1.30;

1.30
date	2009.09.29.14.17.10;	author nickc;	state Exp;
branches;
next	1.29;

1.29
date	2008.03.13.10.51.33;	author nickc;	state Exp;
branches;
next	1.28;

1.28
date	2007.08.28.13.21.54;	author jsm28;	state Exp;
branches;
next	1.27;

1.27
date	2007.06.05.17.00.32;	author nickc;	state Exp;
branches;
next	1.26;

1.26
date	2006.02.28.07.55.36;	author jbeulich;	state Exp;
branches;
next	1.25;

1.25
date	2005.10.25.17.40.18;	author nickc;	state Exp;
branches;
next	1.24;

1.24
date	2005.05.06.06.50.31;	author jbeulich;	state Exp;
branches;
next	1.23;

1.23
date	2005.04.18.13.35.46;	author jbeulich;	state Exp;
branches;
next	1.22;

1.22
date	2005.04.11.12.46.38;	author jbeulich;	state Exp;
branches;
next	1.21;

1.21
date	2005.03.03.17.25.36;	author nickc;	state Exp;
branches;
next	1.20;

1.20
date	2005.03.03.15.13.39;	author nickc;	state Exp;
branches;
next	1.19;

1.19
date	2005.01.31.14.30.34;	author jbeulich;	state Exp;
branches;
next	1.18;

1.18
date	2005.01.31.14.26.13;	author jbeulich;	state Exp;
branches;
next	1.17;

1.17
date	2004.11.04.15.03.05;	author hp;	state Exp;
branches;
next	1.16;

1.16
date	2004.03.30.18.43.17;	author shebs;	state Exp;
branches;
next	1.15;

1.15
date	2003.06.10.09.23.47;	author amodra;	state Exp;
branches;
next	1.14;

1.14
date	2003.05.13.01.57.10;	author hp;	state Exp;
branches;
next	1.13;

1.13
date	2002.11.18.08.28.40;	author sveinse;	state Exp;
branches
	1.13.2.1;
next	1.12;

1.12
date	2002.09.05.00.05.43;	author amodra;	state Exp;
branches;
next	1.11;

1.11
date	2002.08.27.23.35.19;	author amodra;	state Exp;
branches;
next	1.10;

1.10
date	2001.11.13.14.22.44;	author twall;	state Exp;
branches;
next	1.9;

1.9
date	2001.09.05.02.05.06;	author law;	state Exp;
branches;
next	1.8;

1.8
date	2001.08.27.10.51.18;	author amodra;	state Exp;
branches;
next	1.7;

1.7
date	2001.06.06.17.01.34;	author nickc;	state Exp;
branches;
next	1.6;

1.6
date	2000.11.11.16.02.33;	author hp;	state Exp;
branches
	1.6.2.1;
next	1.5;

1.5
date	2000.07.20.17.53.38;	author hp;	state Exp;
branches;
next	1.4;

1.4
date	2000.07.19.04.55.14;	author amodra;	state Exp;
branches;
next	1.3;

1.3
date	2000.06.20.13.52.30;	author twall;	state Exp;
branches;
next	1.2;

1.2
date	2000.06.13.21.23.28;	author nickc;	state Exp;
branches;
next	1.1;

1.1
date	99.05.03.07.28.51;	author rth;	state Exp;
branches
	1.1.1.1;
next	;

1.13.2.1
date	2003.05.13.03.03.44;	author hp;	state Exp;
branches;
next	;

1.6.2.1
date	2001.03.17.22.38.21;	author pb;	state Exp;
branches;
next	;

1.1.1.1
date	99.05.03.07.28.51;	author rth;	state Exp;
branches;
next	;


desc
@@


1.32
log
@Add copyright notices
@
text
@# Copyright 2012
# Free Software Foundation, Inc.

# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA 02110-1301, USA.  

# Run some tests of gas macros.

if { ![istarget hppa*-*-*] || [istarget *-*-linux*] } {
    run_dump_test test1
}

if { ![istarget *c54x*-*-*] && ![istarget *c4x*-*-*] } {
    run_dump_test test2
}

run_dump_test test3

if { ![istarget *c54x*-*-*] && ![istarget *c4x*-*-*] } {
    run_dump_test irp
    run_dump_test rept
    run_dump_test repeat
    run_dump_test vararg
}

gas_test_error "err.s" "" "macro infinite recursion"

# The tic4x-coff target fails the next test because it defines '&'
# as its line separator character, so the expression "(0 & TFLAG_C)"
# becomes divided up into two lines and the parser complains about
# a missing closing parenthesis for the first line.
setup_xfail "tic4x*-*"
gas_test "and.s" "" "" "logical and in macro definition"

case $target_triplet in {
    { hppa*-*-* } { if [istarget *-*-linux*] { run_dump_test semi } }
    { *c4x*-*-* } { }
    { *c54x*-*-* } { }
    default {
	run_dump_test semi
    }
}

if { ![istarget hppa*-*-*] || [istarget *-*-linux*] } {
    # FIXME: Due to macro mishandling of ONLY_STANDARD_ESCAPES.
    setup_xfail "avr-*" "cris-*" "crisv32-*" "msp430-*"

    # These fail due to NO_STRING_ESCAPES
    setup_xfail "powerpc*-*-aix*" "powerpc*-*-beos*" "powerpc*-*-macos*"
    setup_xfail "powerpc*-*-pe" "powerpc*-*-*win*"
    setup_xfail "rs6000-*-*"
    setup_xfail "z80-*-*"

    # FIXME: Due to difference in what "consecutive octets" means.
    setup_xfail "*c4x*-*-*" "*c54x*-*"
    run_dump_test strings
}

run_dump_test app1
run_dump_test app2
run_dump_test app3
remote_download host "$srcdir/$subdir/app4b.s"
run_dump_test app4

run_list_test badarg ""

case $target_triplet in {
    { *c54x*-*-* } { }
    { *c4x*-*-* } { }
    { mmix-* } { }
    { rx-*-* } { }
    default { run_list_test dot "-alm" }
}
run_list_test end ""
run_list_test purge "--hash-size=8000"
run_list_test redef ""

# This test is valid only when '!' is not a comment character
# (it is allowed to be a line comment character).
if [string match "" [lindex [gas_run ../all/excl.s "-o /dev/null" ""] 0]] {
    run_dump_test paren
}

# PR 58925: A .exitm pseudo-op outside of a macro definition
#  prevented the assembler from parsing the rest of the file,
#  and hence catching an erroroneous instruction.
gas_test_error "exit.s" "" ".exitm outside of a macro"
@


1.31
log
@	PR gas/1491
gas/
	* macro.c: Delete unnecessary function declarations.
	(buffer_and_nest): Support multiple labels per line for
	LABELS_WITHOUT_COLONS targets if the labels do have colons.
	(free_macro): Move so that we don't need forward declaration.
	* read.c (read_a_source_file): Take a copy of macro expansion line
	before we trim labels.
	* listing.c (listing_newline): Adjust stdin line save for
	input_line_pointer still at start of line.
gas/testsuite/
	* gas/macros/dot.s: Don't start macro invocations is first column.
	* gas/macros/dot.l: Update.
	* gas/macros/macros.exp: Run dot test on more targets.
@
text
@d1 17
@


1.30
log
@bfd
        * Makefile.am (ALL_MACHINES): Add cpu-rx.lo.
        (ALL_MACHINES_CFILES): Add cpu-rx.c.
        (BFD32_BACKENDS): Add elf32-rx.lo.
        (BFD32_BACKENDS_CFILES): Add elf32-rx.c.
        * archures.c (bfd_architecture): Add bfd_arch_rx and bfd_mach_rx.
        Export bfd_rx_arch.
        (bfd_archures_list): Add bfd_rx_arch.
        * config.bfd: Add entry for rx-*-elf.
        * configure.in: Add entries for bfd_elf32_rx_le_vec and
        bfd_elf32_rx_be_vec.
        * reloc.c: Add RX relocations.
        * targets.c: Add RX target vectors.
        * Makefile.in: Regenerate.
        * bfd-in2.h: Regenerate.
        * configure: Regenerate.
        * libbfd.h: Regenerate.
        * cpu-rx.c: New file.
        * elf32-rx.c: New file.

binutils
        * readelf.c: Add support for RX target.
        * MAINTAINERS: Add DJ and NickC as maintainers for RX.

gas
        * Makefile.am: Add RX target.
        * configure.in: Likewise.
        * configure.tgt: Likewise.
        * read.c (do_repeat_with_expander): New function.
        * read.h: Provide a prototype for do_repeat_with_expander.
        * doc/Makefile.am: Add RX target documentation.
        * doc/all.texi: Likewise.
        * doc/as.texinfo: Likewise.
        * Makefile.in: Regenerate.
        * NEWS: Mention support for RX architecture.
        * configure: Regenerate.
        * doc/Makefile.in: Regenerate.
        * config/rx-defs.h: New file.
        * config/rx-parse.y: New file.
        * config/tc-rx.h: New file.
        * config/tc-rx.c: New file.
        * doc/c-rx.texi: New file.

gas/testsuite
        * gas/rx: New directory.
        * gas/rx/*: New set of test cases.
        * gas/elf/section2.e-rx: New expected output file.
        * gas/all/gas.exp: Add support for RX target.
        * gas/elf/elf.exp: Likewise.
        * gas/lns/lns.exp: Likewise.
        * gas/macros/macros.exp: Likewise.

include
        * dis-asm.h: Add prototype for print_insn_rx.

include/elf
        * rx.h: New file.

include/opcode
        * rx.h: New file.

ld
        * Makefile.am: Add rules to build RX emulation.
        * configure.tgt: Likewise.
        * NEWS: Mention support for RX architecture.
        * Makefile.in: Regenerate.
        * emulparams/elf32rx.sh: New file.
        * emultempl/rxelf.em: New file.

opcodes
        * Makefile.am: Add RX files.
        * configure.in: Add support for RX target.
        * disassemble.c: Likewise.
        * Makefile.in: Regenerate.
        * configure: Regenerate.
        * opc2c.c: New file.
        * rx-decode.c: New file.
        * rx-decode.opc: New file.
        * rx-dis.c: New file.
@
text
@a63 3
    { h8500-*-* } { }
    { m68*-*-* } { }
    { m88*-*-* } { }
a65 1
    { z80-* } { }
@


1.29
log
@PR gas/5895
   * read.c (s_mexit): Warn if attempting to exit a macro when not
   inside a macro definition.

   * gas/macros/exit.s: New test case.
   * gas/macros/macros.exp: Run the new test, expect it to produce an
   error result.
@
text
@d68 1
@


1.28
log
@bfd:
2007-08-28  Mark Shinwell  <shinwell@@codesourcery.com>
            Joseph Myers  <joseph@@codesourcery.com>

	* elf32-arm.c (elf32_arm_compare_mapping): Compare first on vma,
	then on type.

binutils/testsuite:
2007-08-28  Mark Shinwell  <shinwell@@codesourcery.com>
            Joseph Myers  <joseph@@codesourcery.com>

	* binutils-all/ar.exp (long_filenames): Delete temporary files on
	the host.
	* binutils-all/arm/objdump.exp: Only check "which $OBJDUMP" if
	host is local.
	* binutils-all/objcopy.exp: Use ${srecfile} to get the name of the
	srec file to be passed to binutils_run.
	(objcopy_test_readelf): Use remote_exec.
	* binutils-all/readelf.exp (readelf_find_size): Use remote_exec.
	(readelf_test): Likewise.
	(readelf_wi_test): Likewise.
	* lib/utils-lib.exp (run_dump_test): Only check "which $binary" if
	host is local.  Use remote_exec.  Use $tempfile not
	tmpdir/bintest.o.

gas:
2007-08-28  Mark Shinwell  <shinwell@@codesourcery.com>
            Joseph Myers  <joseph@@codesourcery.com>

	* as.c (main): Flush stderr before printing listings to ensure
	consistent output order across platforms.

gas/testsuite:
2007-08-28  Mark Shinwell  <shinwell@@codesourcery.com>
            Joseph Myers  <joseph@@codesourcery.com>

	* lib/gas-defs.exp (gas_version): Use remote_* functions instead
	of exec.
	(gas_host_run): New.
	(gas_run): Use gas_host_run.
	(gas_start): Likewise.
	(run_dump_test): Likewise.
	(objdump): Use gas_host_run.
	(objdump_start_no_subdir): Likewise.
	* lib/gas-dg.exp (gas-dg-test): Use "remote_file host delete".
	* lib/run: Remove.
	* gas/macros/macros.exp: Download app4b.s to host.
	* gas/i386/i386.exp (gas_64_check): Use gas_host_run.
	(gas_32_check): Likewise.
	* gas/maxq10/maxq10.exp (gas_64_check): Likewise
	(gas_32_check): Likewise.
	* gas/maxq20/maxq20.exp (gas_64_check): Likewise
	(gas_32_check): Likewise.
	* gas/sparc/sparc.exp (gas_64_check): Likewise.
	* gas/cfi/cfi.exp: Likewise.
	* gas/elf/elf.exp (run_list_test): Likewise.  Use temporary file
	for readelf output in place of pipe.
	* gas/all/gas.exp: Download incbin.dat to host.
	(do_comment): Allow \r\r\n.

ld:
2007-08-28  Mark Shinwell  <shinwell@@codesourcery.com>
            Joseph Myers  <joseph@@codesourcery.com>

	* ldlang.c (sort_sections_by_lma): Sort by internal id after lma
	for stable sort.

ld/testsuite:
2007-08-28  Mark Shinwell  <shinwell@@codesourcery.com>
            Joseph Myers  <joseph@@codesourcery.com>

	* ld-elfcomm/elfcomm.exp: Use run_host_cmd.  Only check "which
	$CC" if host is local.
	* ld-checks/checks.exp: Use run_host_cmd.
	* ld-elf/exclude.exp: Likewise.
	* ld-elf/elf.exp: Download merge.ld if host is remote.
	* ld-elf/binutils.exp (binutils_test): Use remote_exec.
	* ld-elf/tls_common.exp: Use run_host_cmd.
	* lib/ld-lib.exp (ld_version): Only check "which $ld" if host is
	local.  Use remote_exec.
	(run_host_cmd): New.
	(run_host_cmd_yesno): New.
	(default_ld_relocate): Use run_host_cmd_yesno.
	(default_ld_link): Likewise.
	(default_ld_simple_link): Use run_host_cmd.
	(default_ld_compile): Only check "which $ccprog" if host is local.
	Use remote_file and remote_exec.
	(default_ld_assemble): Only check "which $as" if host is local.
	Use run_host_cmd.
	(default_ld_nm): Use remote_exec, remote_upload and remote_file.
	(run_dump_test): Use remote_exec, remote_upload and remote_file.
	Only check "which $binary" if host is local.
	(run_ld_link_tests): Use remote_exec, remote_upload and
	remote_file.
	* ld-selective/selective.exp: Only check "which $CXX" if host is
	local.  Use remote_exec.
	* ld-scripts/phdrs.exp: Only check "which $objdump" if host is
	local.  Use run_host_cmd.
	* ld-scripts/phdrs2.exp: Likewise.
	* ld-scripts/weak.exp: Likewise.
	* ld-undefined/weak-undef.exp: Likewise.
	* ld-scripts/crossref.exp: Only check "which $CC" if host is local.
	Use run_host_cmd.
	* ld-scripts/map-address.exp: Upload map_address.map if host is
	remote.
	* ld-srec/srec.exp (run_srec_tests): Use run_host_cmd.  Only check
	"which $CC" and "which $CXX" if host is local.
	* ld-undefined/undefined.exp: Only check "which $CC" if host is
	local.  Use remote_file and run_host_cmd.
	* config/default.exp: Use remote_exec to create tmpdir.
@
text
@d80 5
@


1.27
log
@Patch for PR4587 + move proc run_list_test into gas-defs.exp
@
text
@d56 1
@


1.26
log
@gas/
2006-02-28  Jan Beulich  <jbeulich@@novell.com>

	PR/1070
	* macro.c (getstring): Don't treat parentheses special anymore.
	(get_any_string): Don't consider '(' and ')' as quoting anymore.
	Special-case '(', ')', '[', and ']' when dealing with non-quoting
	characters.

gas/testsuite/
2006-02-28  Jan Beulich  <jbeulich@@novell.com>

	* gas/macros/paren[sd]: New.
	* gas/macros/macros.exp: Run new test.
@
text
@a2 13
proc run_list_test { name opts } {
    global srcdir subdir
    set testname "macros $name"
    set file $srcdir/$subdir/$name
    gas_run ${name}.s $opts ">&dump.out"
    if { [regexp_diff "dump.out" "${file}.l"] } then {
	fail $testname
	verbose "output is [file_contents "dump.out"]" 2
	return
    }
    pass $testname
}

d59 1
@


1.25
log
@Add support for the Z80 processor family
@
text
@d85 6
@


1.24
log
@gas/
2005-05-06  Jan Beulich  <jbeulich@@novell.com>

	* macro.c (new_formal, del_formal): New.
	(do_formals): Use new_formal. Check for and parse qualifier. Warn if
	required argument has default value. Stop looking for more formal
	when there was a vararg one.
	(macro_expand_body): Use new_formal and del_formal.
	(macro_expand): Likewise. Initialize local variable err. Don't
	return immediately when encountering an error. Warn when keyword
	argument already had a value assigned. Eliminate duplicate clearing
	of argument value. When current positional argument matches parameter
	of vararg type, assign to it all the remaining arguments. Issue error
	when required parameter does not have value.
	(free_macro): Use del_formal.
	(expand_irp): Initialize formal type. Free buffers associated with
	formal prior to returning.
	* macro.h (struct formal_struct): Add new field 'type' with new
	enumeration type 'formal_type'.
	* doc/as.texinfo: Document macro parameter qualifiers.
	* NEWS: Mention new functionality.

gas/testsuite/
2005-05-06  Jan Beulich  <jbeulich@@novell.com>

	* gas/macros/badarg.s: Add check for bad qualifier specification.
	* gas/macros/badarg.l: Adjust.
	* gas/macros/vararg.[sd]: New.
	* gas/macros/macros.exp: Run new test.
@
text
@d59 1
d79 1
@


1.23
log
@gas/
2005-04-18  Jan Beulich  <jbeulich@@novell.com>

	* macro.c (free_token): New, freeing all the memory associated with a
	macro.
	(do_formals): Move initializers to ...
	(define_macro): ... here.
	(delete_macro): Convert passed in name to lower case. Warn when
	purging macro that doesn't exist. Use hash_jam instead of hash_delete.

gas/testsuite/
2005-04-18  Jan Beulich  <jbeulich@@novell.com>

	* gas/macros/purge.[ls]: New.
	* gas/macros/macros.exp: Run new test.
@
text
@d30 1
a32 1

@


1.22
log
@gas/
2005-04-11  Jan Beulich  <jbeulich@@novell.com>

	* NEWS: Mention these changes and their effects.
	* macro.c (get_token): Use is_name_beginner/is_part_of_name/
	is_name_ender.
	(check_macro): Likewise.
	(buffer_and_nest): Likewise. Permit multiple labels. Don't discard
	labels together with the closing pseudo-op.
	(macro_expand_body): Adjust comment. Range-check input before use.
	Adjust mis-spelled diagnostic. Use is_name_beginner.
	* read.c (try_macro): New.
	(read_a_source_file): New static variable last_eol. Don't list
	macro expansion lines more than once. Call try_macro.
	(s_macro): Set section of line_label to absolute instead of undefined.
	* doc/as.texinfo: Add information on the caveats of these changes.

gas/testsuite/
2005-04-11  Jan Beulich  <jbeulich@@novell.com>

	* gas/macros/dot.[ls]: New.
	* gas/macros/macros.exp: Run new test.
@
text
@d81 1
@


1.21
log
@(and.s): Expect this test to fail for the tic4x-coff target because it uses
the '&' character as a line separator.
@
text
@d71 9
@


1.20
log
@Also expect the msp430 port to fail the strings test because it defines
ONLY_STANDARD_ESCAPES.
@
text
@d35 5
@


1.19
log
@gas/
2005-01-31  Jan Beulich  <jbeulich@@novell.com>

	* macro.c (buffer_and_nest): Allow 'from' being NULL; handle anything
	that can end with .endr in that case. Make requiring/permitting
	pseudo-ops without leading dot closer to the logic in read.c serving
	the same purpose.
	(expand_irp): Don't pass a mnemonic to buffer_and_nest as it will be
	ignored.

gas/testsuite/
2005-01-31  Jan Beulich  <jbeulich@@novell.com>

	* gas/macros/repeat.[ds]: New.
	* gas/macros/macros.exp: Run new test.
@
text
@d48 1
a48 1
    setup_xfail "avr-*" "cris-*" "crisv32-*"
@


1.18
log
@gas/
2005-01-31  Jan Beulich  <jbeulich@@novell.com>

	* macro.c (do_formals): Adjust to no longer accept empty parameter
	names.
	(define_macro): Adjust to no longer accept empty macro name, garbage
	following the parameters, or macros that were previously defined.
	* read.c (s_bad_end): Declare.
	(potable): Add endm. Handler for endr and endm is s_bad_end.
	(s_bad_end): Rename from s_bad_endr. Adjust to handle both .endm
	and .endr.
	* read.h (s_bad_endr): Remove.

gas/testsuite/
2005-01-31  Jan Beulich  <jbeulich@@novell.com>

	* gas/macros/badarg.[ls]: New.
	* gas/macros/end.[ls]: New.
	* gas/macros/redef.[ls]: New.
	* gas/macros/macros.exp (run_list_test): Copy from elsewhere.
	Run new tests.
@
text
@d29 1
@


1.17
log
@	* gas/all/gas.exp: Exclude float.s for crisv32-*-*.
	* gas/cris/operand-err-1.s (test.m constant): Remove xfail marker
	and update rationale.  Mark "ba [external_symbol]" and "ba [r3]"
	as invalid.
	* gas/ieee-fp/x930509a.exp: setup_xfail for crisv32-*-*.
	* gas/macros/macros.exp: setup_xfail strings for crisv32-*-*.
	* gas/cris/abs32-1.s, gas/cris/arch-err-1.s,
	gas/cris/arch-err-2.s, gas/cris/arch-err-3.s,
	gas/cris/arch-err-4.s, gas/cris/arch-err-5.s,
	gas/cris/bound-err-1.s, gas/cris/brokw-3b.s,
	gas/cris/march-err-1.s, gas/cris/march-err-2.s,
	gas/cris/push-err-1.s, gas/cris/push-err-2.s,
	gas/cris/pushpopv32.s, gas/cris/rd-abs32-1.d,
	gas/cris/rd-abs32-2.d, gas/cris/rd-arch-1.d, gas/cris/rd-arch-2.d,
	gas/cris/rd-arch-3.d, gas/cris/rd-bkw1b.d, gas/cris/rd-bkw2b.d,
	gas/cris/rd-bkw3b.d, gas/cris/rd-bound1.d, gas/cris/rd-bound1.s,
	gas/cris/rd-bound2.d, gas/cris/rd-bound3.d, gas/cris/rd-bound4.d,
	gas/cris/rd-break32.d, gas/cris/rd-ppv1032.d, gas/cris/rd-ppv32.d,
	gas/cris/rd-spr-1.d, gas/cris/rd-spr-1.s, gas/cris/rd-usp-1.d,
	gas/cris/rd-usp-1b.d, gas/cris/rd-v10_32o-1.d,
	gas/cris/rd-v10_32o-2.d, gas/cris/rd-v10_32o-2.s,
	gas/cris/rd-v32-b1.d, gas/cris/rd-v32-b1.s, gas/cris/rd-v32-b2.d,
	gas/cris/rd-v32-b2.s, gas/cris/rd-v32-b3.d, gas/cris/rd-v32-b3.s,
	gas/cris/rd-v32-f1.d, gas/cris/rd-v32-f1.s, gas/cris/rd-v32-i1.d,
	gas/cris/rd-v32-i1.s, gas/cris/rd-v32-l1.d, gas/cris/rd-v32-l1.s,
	gas/cris/rd-v32-l3.d, gas/cris/rd-v32-l3.s, gas/cris/rd-v32-l4.d,
	gas/cris/rd-v32-l4.s, gas/cris/rd-v32o-1.d, gas/cris/rd-v32s-1.d,
	gas/cris/rd-v32s-2.d, gas/cris/rd-v32s-2.s, gas/cris/rd-v32s-3.d,
	gas/cris/rd-v32s-3.s, gas/cris/rd-v32s-4.d, gas/cris/rd-v32s-4.s,
	gas/cris/rd-vao-1.d, gas/cris/v32-err-1.s, gas/cris/v32-err-10.s,
	gas/cris/v32-err-11.s, gas/cris/v32-err-2.s, gas/cris/v32-err-3.s,
	gas/cris/v32-err-4.s, gas/cris/v32-err-5.s, gas/cris/v32-err-6.s,
	gas/cris/v32-err-7.s, gas/cris/v32-err-8.s, gas/cris/v32-err-9.s:
	New tests.
@
text
@d3 13
d63 4
@


1.16
log
@        Remove long-obsolete MPW support.
        * mpw-config.in, mpw-make.sed, mac-as.r: Remove files.
        * configure.in: Remove mention of ppc-*-mpw* config.
        * configure.in: Likewise.

[testsuite/ChangeLog]
        * gas/macros/macros.exp: Remove mention of MPW config.
@
text
@d34 1
a34 1
    setup_xfail "avr-*" "cris-*"
@


1.15
log
@	* gas/macros/and.s: New.
	* gas/macros/macros.exp: Assemble it.
@
text
@d38 1
a38 1
    setup_xfail "powerpc*-*-mpw*" "powerpc*-*-pe" "powerpc*-*-*win*"
@


1.14
log
@	* gas/macros/app1.s, gas/macros/app1.d, gas/macros/app2.s,
	gas/macros/app2.d, gas/macros/app3.s, gas/macros/app3.d,
	gas/macros/app4.s, gas/macros/app4b.s, gas/macros/app4.d: New
	tests.
	* gas/macros/macros.exp: Run them.
@
text
@d21 2
@


1.13
log
@
TIC4X testcase commit

	* binutils/testsuite/binutils-all/objcopy.exp: Disable tic4x
	from test
	* binutils/testsuite/binutils-all/objdump.exp: Setup proper
	values for tic4x testcase
	* gas/testsuite/gas/all/gas.exp: Setup for tic4x testcase
	* gas/testsuite/gas/macros/macros.exp: Ditto
	* gas/testsuite/gas/all/gas.exp: Setup for tic4x testcase
	* gas/testsuite/gas/macros/macros.exp: Ditto
	* gas/testsuite/gas/tic4x: New tic4x gas testsuite directory
	* ld/testsuite/ld-scripts/script.exp: Setup for tic4x testcase
@
text
@d43 5
@


1.13.2.1
log
@	* gas/macros/app1.s, gas/macros/app1.d, gas/macros/app2.s,
	gas/macros/app2.d, gas/macros/app3.s, gas/macros/app3.d,
	gas/macros/app4.s, gas/macros/app4b.s, gas/macros/app4.d: New
	tests.
	* gas/macros/macros.exp: Run them.
@
text
@a42 5

run_dump_test app1
run_dump_test app2
run_dump_test app3
run_dump_test app4
@


1.12
log
@	* gas/i386/absrel.s: New.
	* gas/i386/absrel.d: New.
	* gas/i386/pcrel.s: New.
	* gas/i386/pcrel.d: New.
	* gas/i386/i386.exp: Run them.
	* gas/testsuite/gas/mmix/comment-1.d: Don't test the symbol
	index, the name will do.
	* gas/mri/moveml.d: Escape dots.
	* gas/macros/macros.exp (strings): Add rs6000-*-* to xfails.
	* gas/mips/beq.s: Don't make text_label global.
	* gas/mips/mips32.s: Likewise.
	* gas/mips/mips64-mips3d.s: Likewise.
@
text
@d7 1
a7 1
if ![istarget *c54x*-*-*] {
d13 1
a13 1
if ![istarget *c54x*-*-*] {
d23 1
d30 1
a30 1
if { ![istarget hppa*-*-*] || [istarget *-*-linux*]} {
d40 1
a40 1
    setup_xfail "*c54x*-*"
@


1.11
log
@	* gas/macros/macros.exp (strings): Update xfails.
@
text
@d36 1
@


1.10
log
@Fix tic54x testsuite failures and Lmem disassembly bugs.
@
text
@d31 6
a36 5
    setup_xfail cris-*-*
    setup_xfail powerpc-*-aix*
    setup_xfail sh*-*-*
    setup_xfail z8k*-*-*
    setup_xfail h8300*-*-*
d38 1
a38 1
    setup_xfail *c54x*-*-*
@


1.9
log
@Tue Sep  4 20:06:09 2001  Jeffrey A Law  (law@@cygnus.com)

        * gas/all/gas.exp (930509a): Expect failure on the H8/300 ELF port.

        * gas/h8300/ffxx1-elf.d: Update due to recent changes to H8/300
        ELF toolchain.
        * gas/h8300/h8300-elf.exp: Likewise.

        * gas/macros/macros.exp: Expect failure on all H8/300 ports.

        * gas/vtable/vtable.exp: Do not run tests on H8/300 ELF ports.
@
text
@d36 2
@


1.8
log
@	* gas/macros/macros.exp: xfail powerpc-*-aix.
	* gas/ppc/astest64.s: New.
	* gas/ppc/astest64.d: New.
	* gas/ppc/astest2_64.s: New.
	* gas/ppc/astest2_64.d: New.
	* gas/ppc/test1elf.asm: New.
	* gas/ppc/test1xcoff.asm: New.
	* gas/ppc/generate.sh: New. Generate new files below from above .asm
	* gas/ppc/test1elf32.s: New.
	* gas/ppc/test1elf32.d: New.
	* gas/ppc/test1elf64.s: New.
	* gas/ppc/test1elf64.d: New.
	* gas/ppc/test1xcoff32.s: New.
	* gas/ppc/test1xcoff32.d: New.
	* gas/ppc/ppc.exp: Run new tests.
	* gas/ppc/simpshft.s: Tweak align now that we get nops.
@
text
@d35 1
@


1.7
log
@Remove warnings building z8k port.
Fix ld -r behaviour
@
text
@d29 1
a29 1
if { ![istarget hppa*-*-*] || [istarget *-*-linux*] } {
d32 1
@


1.6
log
@	* gas/macros/macros.exp: Mark strings test xfail for sh.
@
text
@d33 1
@


1.6.2.1
log
@2001-03-17  Philip Blundell  <philb@@gnu.org>

	* gas/vtable/vtable.exp: Don't run tests on AVR.
	* gas/macros/macros.exp: Mark strings test xfail for AVR.
@
text
@a31 1
    setup_xfail avr-*-*
@


1.5
log
@	* gas/all/gas.exp: Don't run floating-point tests on CRIS.
	* gas/ieee-fp/x930509a.exp: Ditto.
	* gas/macros/macros.exp: Mark strings test xfail for CRIS.
@
text
@d32 1
@


1.4
log
@Fix a couple of HPPA SOM test failures.
Re-enable some tests for hppa-linux.
@
text
@d30 2
@


1.3
log
@TI C54x target.
@
text
@d3 1
a3 1
if ![istarget hppa*-*-*] {
d22 1
a22 1
    { hppa*-*-* } { }
d29 3
a31 1
run_dump_test strings
@


1.2
log
@Add test of macro expansion of string arguments.
@
text
@d7 3
a9 1
run_dump_test test2
d13 4
a16 1
run_dump_test irp
a17 1
run_dump_test rept
d23 1
@


1.1
log
@Initial revision
@
text
@d23 2
@


1.1.1.1
log
@19990502 sourceware import
@
text
@@

