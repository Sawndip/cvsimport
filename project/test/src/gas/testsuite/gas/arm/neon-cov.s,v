head	1.6;
access;
symbols
	binutils-2_24-branch:1.6.0.22
	binutils-2_24-branchpoint:1.6
	binutils-2_21_1:1.6
	binutils-2_23_2:1.6
	binutils-2_23_1:1.6
	binutils-2_23:1.6
	binutils-2_23-branch:1.6.0.20
	binutils-2_23-branchpoint:1.6
	binutils-2_22_branch:1.6.0.18
	binutils-2_22:1.6
	binutils-2_22-branch:1.6.0.16
	binutils-2_22-branchpoint:1.6
	binutils-2_21:1.6
	binutils-2_21-branch:1.6.0.14
	binutils-2_21-branchpoint:1.6
	binutils-2_20_1:1.6
	binutils-2_20:1.6
	binutils-arc-20081103-branch:1.6.0.12
	binutils-arc-20081103-branchpoint:1.6
	binutils-2_20-branch:1.6.0.10
	binutils-2_20-branchpoint:1.6
	dje-cgen-play1-branch:1.6.0.8
	dje-cgen-play1-branchpoint:1.6
	arc-20081103-branch:1.6.0.6
	arc-20081103-branchpoint:1.6
	binutils-2_19_1:1.6
	binutils-2_19:1.6
	binutils-2_19-branch:1.6.0.4
	binutils-2_19-branchpoint:1.6
	binutils-2_18:1.6
	binutils-2_18-branch:1.6.0.2
	binutils-2_18-branchpoint:1.6
	binutils-csl-coldfire-4_1-32:1.1.2.4
	binutils-csl-sourcerygxx-4_1-32:1.1.2.4
	binutils-csl-innovasic-fido-3_4_4-33:1.1.2.4
	binutils-csl-coldfire-4_1-30:1.1.2.4
	binutils-csl-sourcerygxx-4_1-30:1.1.2.4
	binutils-csl-coldfire-4_1-28:1.1.2.4
	binutils-csl-sourcerygxx-4_1-29:1.1.2.4
	binutils-csl-sourcerygxx-4_1-28:1.1.2.4
	binutils-csl-arm-2006q3-27:1.1.2.4
	binutils-csl-sourcerygxx-4_1-27:1.1.2.4
	binutils-csl-arm-2006q3-26:1.1.2.4
	binutils-csl-sourcerygxx-4_1-26:1.1.2.4
	binutils-csl-sourcerygxx-4_1-25:1.1.2.4
	binutils-csl-sourcerygxx-4_1-24:1.1.2.3
	binutils-csl-sourcerygxx-4_1-23:1.1.2.3
	binutils-csl-sourcerygxx-4_1-21:1.1.2.3
	binutils-csl-arm-2006q3-21:1.1.2.3
	binutils-csl-sourcerygxx-4_1-22:1.1.2.3
	binutils-csl-palmsource-arm-prelinker-1_0-1:1.1.2.3
	binutils-csl-sourcerygxx-4_1-20:1.1.2.2
	binutils-csl-arm-2006q3-19:1.1.2.2
	binutils-csl-sourcerygxx-4_1-19:1.1.2.2
	binutils-csl-sourcerygxx-4_1-18:1.1.2.2
	binutils-csl-renesas-4_1-9:1.1.2.1
	binutils-csl-renesas-4_1-8:1.1.2.1
	binutils-csl-renesas-4_1-7:1.1.2.1
	binutils-csl-renesas-4_1-6:1.1.2.1
	binutils-csl-sourcerygxx-4_1-17:1.1.2.1
	binutils-csl-sourcerygxx-4_1-14:1.1.2.1
	binutils-csl-sourcerygxx-4_1-15:1.1.2.1
	binutils-csl-sourcerygxx-4_1-13:1.1.2.1
	binutils-csl-sourcerygxx-4_1-12:1.1.2.1
	binutils-csl-sourcerygxx-3_4_4-21:1.1.2.1
	binutils-csl-sourcerygxx-4_1-9:1.1.2.1
	binutils-csl-sourcerygxx-4_1-8:1.1.2.1
	binutils-csl-sourcerygxx-4_1-7:1.1.2.1
	binutils-csl-arm-2006q1-6:1.1.2.1
	binutils-csl-sourcerygxx-4_1-6:1.1.2.1
	binutils-csl-coldfire-4_1-11:1.1.2.1
	binutils-csl-sourcerygxx-3_4_4-19:1.1.2.1
	binutils-csl-coldfire-4_1-10:1.1.2.1
	binutils-csl-sourcerygxx-4_1-5:1.1.2.1
	binutils-csl-sourcerygxx-4_1-4:1.1.2.1
	binutils-csl-morpho-4_1-4:1.1.2.1
	binutils-csl-sourcerygxx-3_4_4-17:1.1.2.1
	binutils_latest_snapshot:1.6
	binutils-csl-2_17-branch:1.1.0.2;
locks; strict;
comment	@# @;


1.6
date	2007.04.04.19.21.24;	author pbrook;	state Exp;
branches;
next	1.5;

1.5
date	2007.03.26.14.43.08;	author jules;	state Exp;
branches;
next	1.4;

1.4
date	2006.10.08.18.44.07;	author pbrook;	state Exp;
branches;
next	1.3;

1.3
date	2006.09.05.14.07.22;	author pbrook;	state Exp;
branches;
next	1.2;

1.2
date	2006.04.26.15.42.17;	author jules;	state Exp;
branches;
next	1.1;

1.1
date	2006.04.03.00.03.34;	author jules;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2006.04.03.00.03.34;	author jules;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2006.09.04.15.55.36;	author pbrook;	state Exp;
branches;
next	1.1.2.3;

1.1.2.3
date	2006.09.18.18.29.57;	author pbrook;	state Exp;
branches;
next	1.1.2.4;

1.1.2.4
date	2006.10.26.19.31.11;	author pbrook;	state Exp;
branches;
next	;


desc
@@


1.6
log
@2007-04-04  Paul Brook  <paul@@codesourcery.com>

	gas/
	* config/tc-arm.c (do_neon_ext): Enforce immediate range.
	(insns): Use I15 for vext.

	gas/testsute/
	* gas/arm/neon-cov.s: Add new vext test.
	* gas/arm/neon-cov.d: Ditto.
@
text
@@@ Neon tests. Basic bitfield tests, using zero for as many registers/fields as
@@ possible, but without causing instructions to be badly-formed.

	.arm
	.syntax unified
	.text

	.macro regs3_1 op opq vtype
	\op\vtype q0,q0,q0
	\opq\vtype q0,q0,q0
	\op\vtype d0,d0,d0
	.endm

	.macro dregs3_1 op vtype
	\op\vtype d0,d0,d0
	.endm

	.macro regn3_1 op operand2 vtype
	\op\vtype d0,q0,\operand2
	.endm

	.macro regl3_1 op operand2 vtype
	\op\vtype q0,d0,\operand2
	.endm

	.macro regw3_1 op operand2 vtype
	\op\vtype q0,q0,\operand2
	.endm

	.macro regs2_1 op opq vtype
	\op\vtype q0,q0
	\opq\vtype q0,q0
	\op\vtype d0,d0
	.endm

	.macro regs3_su_32 op opq
	regs3_1 \op \opq .s8
	regs3_1 \op \opq .s16
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .u8
	regs3_1 \op \opq .u16
	regs3_1 \op \opq .u32
	.endm

	regs3_su_32 vaba vabaq
	regs3_su_32 vhadd vhaddq
	regs3_su_32 vrhadd vrhaddq
	regs3_su_32 vhsub vhsubq

	.macro regs3_su_64 op opq
	regs3_1 \op \opq .s8
	regs3_1 \op \opq .s16
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .s64
	regs3_1 \op \opq .u8
	regs3_1 \op \opq .u16
	regs3_1 \op \opq .u32
	regs3_1 \op \opq .u64
	.endm

	regs3_su_64 vqadd vqaddq
	regs3_su_64 vqsub vqsubq
	regs3_su_64 vrshl vrshlq
	regs3_su_64 vqrshl vqrshlq

	regs3_su_64 vshl vshlq
	regs3_su_64 vqshl vqshlq

	.macro regs2i_1 op opq imm vtype
	\op\vtype q0,q0,\imm
	\opq\vtype q0,q0,\imm
	\op\vtype d0,d0,\imm
	.endm

	.macro regs2i_su_64 op opq imm
	regs2i_1 \op \opq \imm .s8
	regs2i_1 \op \opq \imm .s16
	regs2i_1 \op \opq \imm .s32
	regs2i_1 \op \opq \imm .s64
	regs2i_1 \op \opq \imm .u8
	regs2i_1 \op \opq \imm .u16
	regs2i_1 \op \opq \imm .u32
	regs2i_1 \op \opq \imm .u64
	.endm

	.macro regs2i_i_64 op opq imm
	regs2i_1 \op \opq \imm .i8
	regs2i_1 \op \opq \imm .i16
	regs2i_1 \op \opq \imm .i32
	regs2i_1 \op \opq \imm .s32
	regs2i_1 \op \opq \imm .u32
	regs2i_1 \op \opq \imm .i64
	.endm

	regs2i_i_64 vshl vshlq 0
	regs2i_su_64 vqshl vqshlq 0

	.macro regs3_ntyp op opq
	regs3_1 \op \opq .8
	.endm

	regs3_ntyp vand vandq
	regs3_ntyp vbic vbicq
	regs3_ntyp vorr vorrq
	regs3_ntyp vorn vornq
	regs3_ntyp veor veorq

	.macro logic_imm_1 op opq imm vtype
	\op\vtype q0,\imm
	\opq\vtype q0,\imm
	\op\vtype d0,\imm
	.endm

	.macro logic_imm op opq
	logic_imm_1 \op \opq 0x000000a5000000a5 .i64
	logic_imm_1 \op \opq 0x0000a5000000a500 .i64
	logic_imm_1 \op \opq 0x00a5000000a50000 .i64
	logic_imm_1 \op \opq 0xa5000000a5000000 .i64
	logic_imm_1 \op \opq 0x00a500a500a500a5 .i64
	logic_imm_1 \op \opq 0xa500a500a500a500 .i64
	logic_imm_1 \op \opq 0x000000ff .i32
	logic_imm_1 \op \opq 0x000000ff .s32
	logic_imm_1 \op \opq 0x000000ff .u32
	logic_imm_1 \op \opq 0x0000ff00 .i32
	logic_imm_1 \op \opq 0x00ff0000 .i32
	logic_imm_1 \op \opq 0xff000000 .i32
	logic_imm_1 \op \opq 0x00a500a5 .i32
	logic_imm_1 \op \opq 0xa500a500 .i32
	logic_imm_1 \op \opq 0x00ff .i16
	logic_imm_1 \op \opq 0xff00 .i16
	logic_imm_1 \op \opq 0x00 .i8
	.endm

	logic_imm vbic vbicq
	logic_imm vorr vorrq

	.macro logic_inv_imm op opq
	logic_imm_1 \op \opq 0xffffff5affffff5a .i64
	logic_imm_1 \op \opq 0xffff5affffff5aff .i64
	logic_imm_1 \op \opq 0xff5affffff5affff .i64
	logic_imm_1 \op \opq 0x5affffff5affffff .i64
	logic_imm_1 \op \opq 0xff5aff5aff5aff5a .i64
	logic_imm_1 \op \opq 0x5aff5aff5aff5aff .i64
	logic_imm_1 \op \opq 0xffffff00 .i32
	logic_imm_1 \op \opq 0xffffff00 .s32
	logic_imm_1 \op \opq 0xffffff00 .u32
	logic_imm_1 \op \opq 0xffff00ff .i32
	logic_imm_1 \op \opq 0xff00ffff .i32
	logic_imm_1 \op \opq 0x00ffffff .i32
	logic_imm_1 \op \opq 0xff5aff5a .i32
	logic_imm_1 \op \opq 0x5aff5aff .i32
	logic_imm_1 \op \opq 0xff00 .i16
	logic_imm_1 \op \opq 0x00ff .i16
	logic_imm_1 \op \opq 0xff .i8
	.endm

	logic_inv_imm vand vandq
	logic_inv_imm vorn vornq

	regs3_ntyp vbsl vbslq
	regs3_ntyp vbit vbitq
	regs3_ntyp vbif vbifq

	.macro regs3_suf_32 op opq
	regs3_1 \op \opq .s8
	regs3_1 \op \opq .s16
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .u8
	regs3_1 \op \opq .u16
	regs3_1 \op \opq .u32
	regs3_1 \op \opq .f32
	.endm

	.macro regs3_if_32 op opq
	regs3_1 \op \opq .i8
	regs3_1 \op \opq .i16
	regs3_1 \op \opq .i32
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .u32
	regs3_1 \op \opq .f32
	.endm

	regs3_suf_32 vabd vabdq
	regs3_suf_32 vmax vmaxq
	regs3_suf_32 vmin vminq

	regs3_suf_32 vcge vcgeq
	regs3_suf_32 vcgt vcgtq
	regs3_suf_32 vcle vcleq
	regs3_suf_32 vclt vcltq

	regs3_if_32 vceq vceqq

	.macro regs2i_sf_0 op opq
	regs2i_1 \op \opq 0 .s8
	regs2i_1 \op \opq 0 .s16
	regs2i_1 \op \opq 0 .s32
	regs2i_1 \op \opq 0 .f32
	.endm

	regs2i_sf_0 vcge vcgeq
	regs2i_sf_0 vcgt vcgtq
	regs2i_sf_0 vcle vcleq
	regs2i_sf_0 vclt vcltq

	.macro regs2i_if_0 op opq
	regs2i_1 \op \opq 0 .i8
	regs2i_1 \op \opq 0 .i16
	regs2i_1 \op \opq 0 .i32
	regs2i_1 \op \opq 0 .s32
	regs2i_1 \op \opq 0 .u32
	regs2i_1 \op \opq 0 .f32
	.endm

	regs2i_if_0 vceq vceqq

	.macro dregs3_suf_32 op
	dregs3_1 \op .s8
	dregs3_1 \op .s16
	dregs3_1 \op .s32
	dregs3_1 \op .u8
	dregs3_1 \op .u16
	dregs3_1 \op .u32
	dregs3_1 \op .f32
	.endm

	dregs3_suf_32 vpmax
	dregs3_suf_32 vpmin

	.macro sregs3_1 op opq vtype
	\op\vtype q0,q0,q0
	\opq\vtype q0,q0,q0
	\op\vtype d0,d0,d0
	.endm

	.macro sclr21_1 op opq vtype
	\op\vtype q0,q0,d0[0]
	\opq\vtype q0,q0,d0[0]
	\op\vtype d0,d0,d0[0]
	.endm

	.macro mul_incl_scalar op opq
	regs3_1 \op \opq .i8
	regs3_1 \op \opq .i16
	regs3_1 \op \opq .i32
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .u32
	regs3_1 \op \opq .f32
	sclr21_1 \op \opq .i16
	sclr21_1 \op \opq .i32
	sclr21_1 \op \opq .s32
	sclr21_1 \op \opq .u32
	sclr21_1 \op \opq .f32
	.endm

	mul_incl_scalar vmla vmlaq
	mul_incl_scalar vmls vmlsq

	.macro dregs3_if_32 op
	dregs3_1 \op .i8
	dregs3_1 \op .i16
	dregs3_1 \op .i32
	dregs3_1 \op .s32
	dregs3_1 \op .u32
	dregs3_1 \op .f32
	.endm

	dregs3_if_32 vpadd

	.macro regs3_if_64 op opq
	regs3_1 \op \opq .i8
	regs3_1 \op \opq .i16
	regs3_1 \op \opq .i32
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .u32
	regs3_1 \op \opq .i64
	regs3_1 \op \opq .f32
	.endm

	regs3_if_64 vadd vaddq
	regs3_if_64 vsub vsubq

	.macro regs3_sz_32 op opq
	regs3_1 \op \opq .8
	regs3_1 \op \opq .16
	regs3_1 \op \opq .32
	.endm

	regs3_sz_32 vtst vtstq

	.macro regs3_ifp_32 op opq
        regs3_1 \op \opq .i8
	regs3_1 \op \opq .i16
	regs3_1 \op \opq .i32
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .u32
	regs3_1 \op \opq .f32
	regs3_1 \op \opq .p8
	.endm

	regs3_ifp_32 vmul vmulq

	.macro dqmulhs op opq
	regs3_1 \op \opq .s16
	regs3_1 \op \opq .s32
	sclr21_1 \op \opq .s16
	sclr21_1 \op \opq .s32
	.endm

	dqmulhs vqdmulh vqdmulhq
	dqmulhs vqrdmulh vqrdmulhq

	regs3_1 vacge vacgeq .f32
	regs3_1 vacgt vacgtq .f32
	regs3_1 vacle vacleq .f32
	regs3_1 vaclt vacltq .f32
	regs3_1 vrecps vrecpsq .f32
	regs3_1 vrsqrts vrsqrtsq .f32

	.macro regs2_sf_32 op opq
	regs2_1 \op \opq .s8
	regs2_1 \op \opq .s16
	regs2_1 \op \opq .s32
	regs2_1 \op \opq .f32
	.endm

	regs2_sf_32 vabs vabsq
	regs2_sf_32 vneg vnegq

	.macro rshift_imm op opq
	regs2i_1 \op \opq 7 .s8
	regs2i_1 \op \opq 15 .s16
	regs2i_1 \op \opq 31 .s32
	regs2i_1 \op \opq 63 .s64
	regs2i_1 \op \opq 7 .u8
	regs2i_1 \op \opq 15 .u16
	regs2i_1 \op \opq 31 .u32
	regs2i_1 \op \opq 63 .u64
	.endm

	rshift_imm vshr vshrq
	rshift_imm vrshr vrshrq
	rshift_imm vsra vsraq
	rshift_imm vrsra vrsraq

	regs2i_1 vsli vsliq 0 .8
	regs2i_1 vsli vsliq 0 .16
	regs2i_1 vsli vsliq 0 .32
	regs2i_1 vsli vsliq 0 .64

	regs2i_1 vsri vsriq 7 .8
	regs2i_1 vsri vsriq 15 .16
	regs2i_1 vsri vsriq 31 .32
	regs2i_1 vsri vsriq 63 .64

	regs2i_1 vqshlu vqshluq 0 .s8
	regs2i_1 vqshlu vqshluq 0 .s16
	regs2i_1 vqshlu vqshluq 0 .s32
	regs2i_1 vqshlu vqshluq 0 .s64

	.macro qrshift_imm op
	regn3_1 \op 7 .s16
	regn3_1 \op 15 .s32
	regn3_1 \op 31 .s64
	regn3_1 \op 7 .u16
	regn3_1 \op 15 .u32
	regn3_1 \op 31 .u64
	.endm

	.macro qrshiftu_imm op
	regn3_1 \op 7 .s16
	regn3_1 \op 15 .s32
	regn3_1 \op 31 .s64
	.endm

	.macro qrshifti_imm op
	regn3_1 \op 7 .i16
	regn3_1 \op 15 .i32
	regn3_1 \op 15 .s32
	regn3_1 \op 15 .u32
	regn3_1 \op 31 .i64
	.endm

	qrshift_imm vqshrn
	qrshift_imm vqrshrn
	qrshiftu_imm vqshrun
	qrshiftu_imm vqrshrun

	qrshifti_imm vshrn
	qrshifti_imm vrshrn

	regl3_1 vshll 1 .s8
	regl3_1 vshll 1 .s16
	regl3_1 vshll 1 .s32
	regl3_1 vshll 1 .u8
	regl3_1 vshll 1 .u16
	regl3_1 vshll 1 .u32

	regl3_1 vshll 8 .i8
	regl3_1 vshll 16 .i16
	regl3_1 vshll 32 .i32
	regl3_1 vshll 32 .s32
	regl3_1 vshll 32 .u32

	.macro convert op opr arg="" t1=".s32.f32" t2=".u32.f32" t3=".f32.s32" t4=".f32.u32"
	\op\t1 \opr,\opr\arg
	\op\t2 \opr,\opr\arg
	\op\t3 \opr,\opr\arg
	\op\t4 \opr,\opr\arg
	.endm

	convert vcvt q0
	convert vcvtq q0
	convert vcvt d0
	convert vcvt q0 ",1"
	convert vcvtq q0 ",1"
	convert vcvt d0 ",1"

	vmov q0,q0
	vmov d0,d0
	vmov.8 d0[0],r0
	vmov.16 d0[0],r0
	vmov.32 d0[0],r0
	vmov d0,r0,r0
	vmov.s8 r0,d0[0]
	vmov.s16 r0,d0[0]
	vmov.u8 r0,d0[0]
	vmov.u16 r0,d0[0]
	vmov.32 r0,d0[0]
	vmov r0,r1,d0

	.macro mov_imm op imm vtype
	\op\vtype q0,\imm
	\op\vtype d0,\imm
	.endm

	mov_imm vmov 0x00000077 .i32
	mov_imm vmov 0x00000077 .s32
	mov_imm vmov 0x00000077 .u32
	mov_imm vmvn 0x00000077 .i32
	mov_imm vmvn 0x00000077 .s32
	mov_imm vmvn 0x00000077 .u32
	mov_imm vmov 0x00007700 .i32
	mov_imm vmvn 0x00007700 .i32
	mov_imm vmov 0x00770000 .i32
	mov_imm vmvn 0x00770000 .i32
	mov_imm vmov 0x77000000 .i32
	mov_imm vmvn 0x77000000 .i32
	mov_imm vmov 0x0077 .i16
	mov_imm vmvn 0x0077 .i16
	mov_imm vmov 0x7700 .i16
	mov_imm vmvn 0x7700 .i16
	mov_imm vmov 0x000077ff .i32
	mov_imm vmvn 0x000077ff .i32
	mov_imm vmov 0x0077ffff .i32
	mov_imm vmvn 0x0077ffff .i32
	mov_imm vmov 0x77 .i8
	mov_imm vmov 0xff0000ff000000ff .i64
	mov_imm vmov 4.25 .f32

	mov_imm vmov 0xa5a5 .i16
	mov_imm vmvn 0xa5a5 .i16
	mov_imm vmov 0xa5a5a5a5 .i32
	mov_imm vmvn 0xa5a5a5a5 .i32
	mov_imm vmov 0x00a500a5 .i32
	mov_imm vmov 0xa500a500 .i32
	mov_imm vmov 0xa5a5a5a5a5a5a5a5 .i64
	mov_imm vmvn 0xa5a5a5a5a5a5a5a5 .i64
	mov_imm vmov 0x00a500a500a500a5 .i64
	mov_imm vmov 0xa500a500a500a500 .i64
	mov_imm vmov 0x000000a5000000a5 .i64
	mov_imm vmov 0x0000a5000000a500 .i64
	mov_imm vmov 0x00a5000000a50000 .i64
	mov_imm vmov 0xa5000000a5000000 .i64
	mov_imm vmov 0x0000a5ff0000a5ff .i64
	mov_imm vmov 0x00a5ffff00a5ffff .i64
	mov_imm vmov 0xa5ffffffa5ffffff .i64

	vmvn q0,q0
	vmvnq q0,q0
	vmvn d0,d0

	.macro long_ops op
	regl3_1 \op d0 .s8
	regl3_1 \op d0 .s16
	regl3_1 \op d0 .s32
	regl3_1 \op d0 .u8
	regl3_1 \op d0 .u16
	regl3_1 \op d0 .u32
	.endm

	long_ops vabal
	long_ops vabdl
	long_ops vaddl
	long_ops vsubl

	.macro long_mac op
	regl3_1 \op d0 .s8
	regl3_1 \op d0 .s16
	regl3_1 \op d0 .s32
	regl3_1 \op d0 .u8
	regl3_1 \op d0 .u16
	regl3_1 \op d0 .u32
	regl3_1 \op "d0[0]" .s16
	regl3_1 \op "d0[0]" .s32
	regl3_1 \op "d0[0]" .u16
	regl3_1 \op "d0[0]" .u32
	.endm

	long_mac vmlal
	long_mac vmlsl

	.macro wide_ops op
	regw3_1 \op d0 .s8
	regw3_1 \op d0 .s16
	regw3_1 \op d0 .s32
	regw3_1 \op d0 .u8
	regw3_1 \op d0 .u16
	regw3_1 \op d0 .u32
	.endm

	wide_ops vaddw
	wide_ops vsubw

	.macro narr_ops op
	regn3_1 \op q0 .i16
	regn3_1 \op q0 .i32
	regn3_1 \op q0 .s32
	regn3_1 \op q0 .u32
	regn3_1 \op q0 .i64
	.endm

	narr_ops vaddhn
	narr_ops vraddhn
	narr_ops vsubhn
	narr_ops vrsubhn

	.macro long_dmac op
	regl3_1 \op d0 .s16
	regl3_1 \op d0 .s32
	regl3_1 \op "d0[0]" .s16
	regl3_1 \op "d0[0]" .s32
	.endm

	long_dmac vqdmlal
	long_dmac vqdmlsl
	long_dmac vqdmull

	regl3_1 vmull d0 .s8
	regl3_1 vmull d0 .s16
	regl3_1 vmull d0 .s32
	regl3_1 vmull d0 .u8
	regl3_1 vmull d0 .u16
	regl3_1 vmull d0 .u32
	regl3_1 vmull d0 .p8
	regl3_1 vmull "d0[0]" .s16
	regl3_1 vmull "d0[0]" .s32
	regl3_1 vmull "d0[0]" .u16
	regl3_1 vmull "d0[0]" .u32

	vext.8 q0,q0,q0,0
	vextq.8 q0,q0,q0,0
	vext.8 d0,d0,d0,0
	vext.8 q0,q0,q0,8

	.macro revs op opq vtype
	\op\vtype q0,q0
	\opq\vtype q0,q0
	\op\vtype d0,d0
	.endm

	revs vrev64 vrev64q .8
	revs vrev64 vrev64q .16
	revs vrev64 vrev64q .32
	revs vrev32 vrev32q .8
	revs vrev32 vrev32q .16
	revs vrev16 vrev16q .8

	.macro dups op opq vtype
	\op\vtype q0,r0
	\opq\vtype q0,r0
	\op\vtype d0,r0
	\op\vtype q0,d0[0]
	\opq\vtype q0,d0[0]
	\op\vtype d0,d0[0]
	.endm

	dups vdup vdupq .8
	dups vdup vdupq .16
	dups vdup vdupq .32

	.macro binop_3typ op op1 op2 t1 t2 t3
	\op\t1 \op1,\op2
	\op\t2 \op1,\op2
	\op\t3 \op1,\op2
	.endm

	binop_3typ vmovl q0 d0 .s8 .s16 .s32
	binop_3typ vmovl q0 d0 .u8 .u16 .u32
	binop_3typ vmovn d0 q0 .i16 .i32 .i64
	vmovn.s32 d0, q0
	vmovn.u32 d0, q0
	binop_3typ vqmovn d0 q0 .s16 .s32 .s64
	binop_3typ vqmovn d0 q0 .u16 .u32 .u64
	binop_3typ vqmovun d0 q0 .s16 .s32 .s64

	.macro binops op opq vtype="" rhs="0"
	\op\vtype q0,q\rhs
	\opq\vtype q0,q\rhs
	\op\vtype d0,d\rhs
	.endm

	.macro regs2_sz_32 op opq
	binops \op \opq .8 1
	binops \op \opq .16 1
	binops \op \opq .32 1
	.endm

	regs2_sz_32 vzip vzipq
	regs2_sz_32 vuzp vuzpq

	.macro regs2_s_32 op opq
	binops \op \opq .s8
	binops \op \opq .s16
	binops \op \opq .s32
	.endm

	regs2_s_32 vqabs vqabsq
	regs2_s_32 vqneg vqnegq

	.macro regs2_su_32 op opq
	regs2_s_32 \op \opq
	binops \op \opq .u8
	binops \op \opq .u16
	binops \op \opq .u32
	.endm

	regs2_su_32 vpadal vpadalq
	regs2_su_32 vpaddl vpaddlq

	binops vrecpe vrecpeq .u32
	binops vrecpe vrecpeq .f32
	binops vrsqrte vrsqrteq .u32
	binops vrsqrte vrsqrteq .f32

	regs2_s_32 vcls vclsq

	.macro regs2_i_32 op opq
	binops \op \opq .i8
	binops \op \opq .i16
	binops \op \opq .i32
	binops \op \opq .s32
	binops \op \opq .u32
	.endm

	regs2_i_32 vclz vclzq

	binops vcnt vcntq .8

	binops vswp vswpq "" 1

	regs2_sz_32 vtrn vtrnq

	vtbl.8 d0,{d0},d0
	vtbx.8 d0,{d0},d0
	
@


1.5
log
@	* gas/arm/neon-const.s: Use FP syntax for 0/-0.
	* gas/arm/vfp-neon-syntax-inc.s: Likewise, for 1.
	* gas/arm/neon-cov.s: Use float syntax for FP immediate.
@
text
@d564 1
@


1.4
log
@2006-10-08  Paul Brook  <paul@@codesourcery.com>

	gas/
	* config/tc-arm.c (parse_big_immediate): 64-bit host fix.
	(parse_operands): Use parse_big_immediate for OP_NILO.
	(neon_cmode_for_logic_imm): Try smaller element sizes.
	(neon_cmode_for_move_imm): Ditto.
	(do_neon_logic): Handle .i64 pseudo-op.

	gas/testsuite/
	* testsuite/gas/arm/neon-cov.s: Test pseudo-instruction forms of
	vmov, vmvn and logic immediate instructions.
	* testsuite/gas/arm/neon-cov.d: ditto.
@
text
@d459 1
a459 1
	mov_imm vmov 0x40880000 .f32
@


1.3
log
@2006-09-04  Paul Brook  <paul@@codesourcery.com>

	gas/
	* config/tc-arm.c (do_neon_dyadic_if_i): Remove.
	(do_neon_dyadic_if_i_d): Avoid setting U bit.
	(do_neon_mac_maybe_scalar): Ditto.
	(do_neon_dyadic_narrow): Force operand type to NT_integer.
	(insns): Remove out of date comments.

	gas/testsuite/
	* gas/arm/neon-cov.s: Test .u and .s aliases for .i suffixes.
	* gas/arm/neon-cov.d: Adjust expected output.

	opcodes/
	* arm-dis.c (neon_opcode): Fix suffix on VMOVN.
@
text
@d115 6
d127 2
d131 1
d138 6
d150 2
d154 1
d461 18
@


1.2
log
@	* gas/arm/copro.s: Avoid ldcl which encodes as a bad Neon instruction.
	* gas/arm/copro.d: Update accordingly.
	* gas/arm/neon-cond.s: New test. Conditional Neon opcodes in ARM mode.
	* gas/arm/neon-cond.d: Expected results of above.
	* gas/arm/neon-cov.s: New test. Coverage of Neon instructions.
	* gas/arm/neon-cov.d: Expected results of above.
	* gas/arm/neon-ldst-es.s: New test. Element and structure loads and
	stores.
	* gas/arm/neon-ldst-es.d: Expected results of above.
	* gas/arm/neon-ldst-rm.s: New test. Single and multiple register loads
	and stores.
	* gas/arm/neon-ldst-rm.d: Expected results of above.
	* gas/arm/neon-omit.s: New test. Omission of optional operands.
	* gas/arm/neon-omit.d: Expected results of above.
	* gas/arm/vfp1.d: Expect Neon syntax for some VFP instructions.
	* gas/arm/vfp1_t2.d: Likewise.
	* gas/arm/vfp1xD.d: Likewise.
	* gas/arm/vfp1xD_t2.d: Likewise.
	* gas/arm/vfp2.d: Likewise.
	* gas/arm/vfp2_t2.d: Likewise.
	* gas/arm/vfp3-32drs.s: New test. Extended D register range for VFP
	instructions.
	* gas/arm/vfp3-32drs.d: Expected results of above.
	* gas/arm/vfp3-const-conv.s: New test. VFPv3 constant-load and
	conversion instructions.
	* gas/arm/vfp3-const-conv.d: Expected results of above.
@
text
@d90 2
d116 2
d130 2
d160 2
d192 2
d228 2
d233 2
d245 2
d256 2
d277 2
d361 2
d384 2
d420 2
d423 2
d492 2
d564 2
d615 2
@


1.1
log
@file neon-cov.s was initially added on branch binutils-csl-2_17-branch.
@
text
@d1 595
@


1.1.2.1
log
@	* binutils/readelf.c (arm_attr_tag_VFP_arch): Add VFPv3.

	* gas/config/tc-arm.c (limits.h): Include.
	(fpu_arch_vfp_v3, fpu_vfp_ext_v3, fpu_neon_ext_v1)
	(fpu_vfp_v3_or_neon_ext): Declare constants.
	(neon_el_type): New enumeration of types for Neon vector elements.
	(neon_type_el): New struct. Define type and size of a vector element.
   	(NEON_MAX_TYPE_ELS): Define constant. The maximum number of types per
	instruction.
	(neon_type): Define struct. The type of an instruction.
	(arm_it): Add 'vectype' for the current instruction.
	(isscalar, immisalign, regisimm, isquad): New predicates for operands.
	(vfp_sp_reg_pos): Rename to...
	(vfp_reg_pos): ...this, and add VFP_REG_Dd, VFP_REG_Dm, VFP_REG_Dn
	tags.
	(arm_reg_type): Add REG_TYPE_NQ (Neon Q register) and REG_TYPE_NDQ
	(Neon D or Q register).
	(reg_expected_msgs): Sync with above. Allow VFD to mean VFP or Neon
	D register.
	(GE_OPT_PREFIX_BIG): Define constant, for use in...
	(my_get_expression): Allow above constant as argument to accept
	64-bit constants with optional prefix.
	(arm_reg_parse): Add extra argument to return the specific type of
	register in when either a D or Q register (REG_TYPE_NDQ) is requested.
	Can be NULL.
	(parse_scalar): New function. Parse Neon scalar (vector reg and index).
	(parse_reg_list): Update for new arm_reg_parse args.
	(parse_vfp_reg_list): Allow parsing of Neon D/Q register lists.
	(parse_neon_el_struct_list): New function. Parse element/structure
	register lists for VLD<n>/VST<n> instructions.
	(s_arm_unwind_save_vfp): Update for new parse_vfp_reg_list args.
	(s_arm_unwind_save_mmxwr): Likewise.
	(s_arm_unwind_save_mmxwcg): Likewise.
	(s_arm_unwind_movsp): Likewise.
	(s_arm_unwind_setfp): Likewise.
	(parse_big_immediate): New function. Parse an immediate, which may
	be 64 bits wide. Put results in inst.operands[i].
	(parse_shift): Update for new arm_reg_parse args.
	(parse_address): Likewise. Add parsing of alignment specifiers.
	(parse_neon_mov): Parse the operands of a VMOV instruction.
	(operand_parse_code): Add OP_RND, OP_RNQ, OP_RNDQ, OP_RNSC,
	OP_NRDLST, OP_NSTRLST, OP_NILO, OP_RNDQ_I0, OP_RR_RNSC,
	OP_RNDQ_RNSC, OP_RND_RNSC, OP_VMOV, OP_RNDQ_IMVNb, OP_RNDQ_I63b,
	OP_I0, OP_I16z, OP_I32z, OP_I64, OP_I64z, OP_oI32b, OP_oRND,
	OP_oRNQ, OP_oRNDQ.
	(parse_operands): Handle new codes above.
	(encode_arm_vfp_sp_reg): Rename to...
	(encode_arm_vfp_reg): ...this. Handle D regs (0-31) too. Complain if
	selected VFP version only supports D0-D15.
	(do_vfp_sp_monadic, do_vfp_sp_dyadic, do_vfp_sp_compare_z)
	(do_vfp_dp_sp_cvt, do_vfp_reg_from_sp, do_vfp_reg2_from_sp2)
	(do_vfp_sp_from_reg, do_vfp_sp2_from_reg2, do_vfp_sp_ldst)
	(do_vfp_dp_ldst, vfp_sp_ldstm, vfp_dp_ldstm): Update for new
	encode_arm_vfp_reg name, and allow 32 D regs.
	(do_vfp_dp_rd_rm, do_vfp_dp_rn_rd, do_vfp_dp_rd_rn)
	(do_vfp_dp_rd_rn_rm, do_vfp_rm_rd_rn): New functions to encode VFP
	insns allowing 32 D regs.
	(do_vfp_sp_const, do_vfp_dp_const, vfp_conv, do_vfp_sp_conv_16)
	(do_vfp_dp_conv_16, do_vfp_sp_conv_32, do_vfp_dp_conv_32): Handle
	constant-load and conversion insns introduced with VFPv3.
	(neon_tab_entry): New struct.
	(NEON_ENC_TAB): Bit patterns for overloaded Neon instructions, and
	those which are the targets of pseudo-instructions.
	(neon_opc): Enumerate opcodes, use as indices into...
	(neon_enc_tab): ...this. Hold data from NEON_ENC_TAB.
	(NEON_ENC_INTEGER, NEON_ENC_ARMREG, NEON_ENC_POLY, NEON_ENC_FLOAT)
	(NEON_ENC_SCALAR, NEON_ENC_IMMED, NEON_ENC_INTERLV, NEON_ENC_LANE)
	(NEON_ENC_DUP): Define meaningful helper macros to look up values in
	neon_enc_tab.
	(neon_shape): Enumerate shapes (permitted register widths, etc.) for
	Neon instructions.
	(neon_type_mask): New. Compact type representation for type
	checking.
	(N_SU_ALL, N_SU_32, N_SU_16_64, N_SUF_32, N_I_ALL, N_IF_32): Common
	permitted type combinations.
	(N_IGNORE_TYPE): New macro.
	(neon_check_shape): New function. Check an instruction shape for
	multiple alternatives. Return the specific shape for the current
	instruction.
	(neon_modify_type_size): New function. Modify a vector type and
	size, depending on the bit mask in argument 1.
	(neon_type_promote): New function. Convert a given "key" type (of an
	operand) into the correct type for a different operand, based on a bit
	mask.
	(type_chk_of_el_type): New function. Convert a type and size into the
	compact representation used for type checking.
	(el_type_of_type_ckh): New function. Reverse of above (only when a
	single bit is set in the bit mask).
	(modify_types_allowed): New function. Alter a mask of allowed types
	based on a bit mask of modifications.
	(neon_check_type): New function. Check the type of the current
	instruction against the variable argument list. The "key" type of the
	instruction is returned.
	(neon_dp_fixup): New function. Fill in and modify instruction bits for
	a Neon data-processing instruction depending on whether we're in ARM
	mode or Thumb-2 mode.
	(neon_logbits): New function.
	(neon_three_same, neon_two_same, do_neon_dyadic_i_su)
	(do_neon_dyadic_i64_su, neon_imm_shift, do_neon_shl_imm)
	(do_neon_qshl_imm, neon_cmode_for_logic_imm)
	(neon_bits_same_in_bytes, neon_squash_bits, neon_is_quarter_float)
	(neon_qfloat_bits, neon_cmode_for_move_imm, neon_write_immbits)
	(neon_invert_size, do_neon_logic, do_neon_bitfield, neon_dyadic)
	(do_neon_dyadic_if_su, do_neon_dyadic_if_su_d, do_neon_dyadic_if_i)
	(do_neon_dyadic_if_i_d, do_neon_addsub_if_i, neon_exchange_operands)
	(neon_compare, do_neon_cmp, do_neon_cmp_inv, do_neon_ceq)
	(neon_scalar_for_mul, neon_mul_mac, do_neon_mac_maybe_scalar)
	(do_neon_tst, do_neon_mul, do_neon_qdmulh, do_neon_fcmp_absolute)
	(do_neon_fcmp_absolute_inv, do_neon_step, do_neon_abs_neg)
	(do_neon_sli, do_neon_sri, do_neon_qshlu_imm, do_neon_qmovn)
	(do_neon_qmovun, do_neon_rshift_sat_narrow)
	(do_neon_rshift_sat_narrow_u, do_neon_movn, do_neon_rshift_narrow)
	(do_neon_shll, neon_cvt_flavour, do_neon_cvt, neon_move_immediate)
	(do_neon_mvn, neon_mixed_length, do_neon_dyadic_long, do_neon_abal)
	(neon_mac_reg_scalar_long, do_neon_mac_maybe_scalar_long)
	(do_neon_dyadic_wide, do_neon_vmull, do_neon_ext, do_neon_rev)
	(do_neon_dup, do_neon_mov, do_neon_rshift_round_imm, do_neon_movl)
	(do_neon_trn, do_neon_zip_uzp, do_neon_sat_abs_neg)
	(do_neon_pair_long, do_neon_recip_est, do_neon_cls, do_neon_clz)
	(do_neon_cnt, do_neon_swp, do_neon_tbl_tbx, do_neon_ldm_stm)
	(do_neon_ldr_str, do_neon_ld_st_interleave, neon_alignment_bit)
	(do_neon_ld_st_lane, do_neon_ld_dup, do_neon_ldx_stx): New
	functions. Neon bit encoding and encoding helpers.
	(parse_neon_type): New function. Parse Neon type specifier.
	(opcode_lookup): Allow parsing of Neon type specifiers.
	(REGNUM2, REGSETH, REGSET2): New macros.
	(reg_names): Add new VFPv3 and Neon registers.
	(NUF, nUF, NCE, nCE): New macros for opcode table.
	(insns): More VFP registers allowed in fcpyd, fmdhr, fmdlr, fmrdh,
	fmrdl, fabsd, fnegd, fsqrtd, faddd, fsubd, fmuld, fdivd, fmacd,
	fmscd, fnmuld, fnmacd, fnmscd, fcmpd, fcmpzd, fcmped, fcmpezd,
	fmdrr, fmrrd. Add Neon instructions vaba, vhadd, vrhadd, vhsub,
	vqadd, vqsub, vrshl, vqrshl, vshl, vqshl{u}, vand, vbic, vorr, vorn,
	veor, vbsl, vbit, vbif, vabd, vmax, vmin, vcge, vcgt, vclt, vcle,
	vceq, vpmax, vpmin, vmla, vmls, vpadd, vadd, vsub, vtst, vmul,
	vqdmulh, vqrdmulh, vacge, vacgt, vaclt, vacle, vrecps, vrsqrts,
	vabs, vneg, v{r}shr,  v{r}sra, vsli, vsri, vqshrn, vq{r}shr{u}n,
	v{r}shrn, vshll, vcvt, vmov, vmvn, vabal, vabdl, vaddl, vsubl,
	vmlal, vmlsl, vaddw, vsubw, v{r}addhn, v{r}subhn, vqdmlal, vqdmlsl,
	vqdmull, vmull, vext, vrev64, vrev32, vrev16, vdup, vmovl, v{q}movn,
	vzip, vuzp, vqabs, vqneg, vpadal, vpaddl, vrecpe, vrsqrte, vcls,
	vclz, vcnt, vswp, vtrn, vtbl, vtbx, vldm, vstm, vldr, vstr,
	vld[1234], vst[1234], fconst[sd], f[us][lh]to[sd], fto[us][lh][sd].
	(tc_arm_regname_to_dw2regnum): Update for arm_reg_parse args.
	(arm_cpu_option_table): Add Neon and VFPv3 to Cortex-A8.
	(arm_option_cpu_value): Add vfp3 and neon.
	(aeabi_set_public_attributes): Support VFPv3 and NEON attributes.
	Fix VFPv1 attribute.

	* gas/testsuite/gas/arm/copro.s: Avoid ldcl which encodes as a bad Neon
	instruction.
	* gas/testsuite/gas/arm/copro.d: Update accordingly.
	* gas/testsuite/gas/arm/neon-cond.s: New test. Conditional Neon opcodes
	in ARM mode.
	* gas/testsuite/gas/arm/neon-cond.d: Expected results of above.
	* gas/testsuite/gas/arm/neon-cov.s: New test. Coverage of Neon
	instructions.
	* gas/testsuite/gas/arm/neon-cov.d: Expected results of above.
	* gas/testsuite/gas/arm/neon-ldst-es.s: New test. Element and structure
	loads and stores.
	* gas/testsuite/gas/arm/neon-ldst-es.d: Expected results of above.
	* gas/testsuite/gas/arm/neon-ldst-rm.s: New test. Single and multiple
	register loads and stores.
	* gas/testsuite/gas/arm/neon-ldst-rm.d: Expected results of above.
	* gas/testsuite/gas/arm/neon-omit.s: New test. Omission of optional
	operands.
	* gas/testsuite/gas/arm/neon-omit.d: Expected results of above.
	* gas/testsuite/gas/arm/vfp1.d: Expect Neon syntax for some VFP
	instructions.
	* gas/testsuite/gas/arm/vfp1_t2.d: Likewise.
	* gas/testsuite/gas/arm/vfp1xD.d: Likewise.
	* gas/testsuite/gas/arm/vfp1xD_t2.d: Likewise.
	* gas/testsuite/gas/arm/vfp2.d: Likewise.
	* gas/testsuite/gas/arm/vfp2_t2.d: Likewise.
	* gas/testsuite/gas/arm/vfp3-32drs.s: New test. Extended D register
	range for VFP instructions.
	* gas/testsuite/gas/arm/vfp3-32drs.d: Expected results of above.
	* gas/testsuite/gas/arm/vfp3-const-conv.s: New test. VFPv3
	constant-load and conversion instructions.
	* gas/testsuite/gas/arm/vfp3-const-conv.d: Expected results of above.

	* include/opcode/arm.h (FPU_VFP_EXT_V3): Define constant.
	(FPU_NEON_EXT_V1): Likewise.
	(FPU_VFP_HARD): Update.
	(FPU_VFP_V3): Define macro.
	(FPU_ARCH_VFP_V3, FPU_ARCH_VFP_V3_PLUS_NEON_V1): Define macros.

	* opcodes/arm-dis.c (coprocessor_opcodes): Add %A, %B, %k,
	convert %<code>[zy] into %[zy]<code>.  Expand meaning of
	%<bitfield>['`?].
	Add unified load/store instruction names.
	(neon_opcode_table): New.
	(arm_opcodes): Expand meaning of %<bitfield>['`?].
	(arm_decode_bitfield): New.
	(print_insn_coprocessor): Add pc argument. Add %A & %B specifiers.
	Use arm_decode_bitfield and adjust numeric specifiers.
	Adjust %z & %y.
	(print_insn_neon): New.
	(print_insn_arm): Adjust print_insn_coprocessor call. Call
	print_insn_neon. Use arm_decode_bitfield and adjust numeric specifiers.
	(print_insn_thumb32): Likewise.
@
text
@a0 595
@@ Neon tests. Basic bitfield tests, using zero for as many registers/fields as
@@ possible, but without causing instructions to be badly-formed.

	.arm
	.syntax unified
	.text

	.macro regs3_1 op opq vtype
	\op\vtype q0,q0,q0
	\opq\vtype q0,q0,q0
	\op\vtype d0,d0,d0
	.endm

	.macro dregs3_1 op vtype
	\op\vtype d0,d0,d0
	.endm

	.macro regn3_1 op operand2 vtype
	\op\vtype d0,q0,\operand2
	.endm

	.macro regl3_1 op operand2 vtype
	\op\vtype q0,d0,\operand2
	.endm

	.macro regw3_1 op operand2 vtype
	\op\vtype q0,q0,\operand2
	.endm

	.macro regs2_1 op opq vtype
	\op\vtype q0,q0
	\opq\vtype q0,q0
	\op\vtype d0,d0
	.endm

	.macro regs3_su_32 op opq
	regs3_1 \op \opq .s8
	regs3_1 \op \opq .s16
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .u8
	regs3_1 \op \opq .u16
	regs3_1 \op \opq .u32
	.endm

	regs3_su_32 vaba vabaq
	regs3_su_32 vhadd vhaddq
	regs3_su_32 vrhadd vrhaddq
	regs3_su_32 vhsub vhsubq

	.macro regs3_su_64 op opq
	regs3_1 \op \opq .s8
	regs3_1 \op \opq .s16
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .s64
	regs3_1 \op \opq .u8
	regs3_1 \op \opq .u16
	regs3_1 \op \opq .u32
	regs3_1 \op \opq .u64
	.endm

	regs3_su_64 vqadd vqaddq
	regs3_su_64 vqsub vqsubq
	regs3_su_64 vrshl vrshlq
	regs3_su_64 vqrshl vqrshlq

	regs3_su_64 vshl vshlq
	regs3_su_64 vqshl vqshlq

	.macro regs2i_1 op opq imm vtype
	\op\vtype q0,q0,\imm
	\opq\vtype q0,q0,\imm
	\op\vtype d0,d0,\imm
	.endm

	.macro regs2i_su_64 op opq imm
	regs2i_1 \op \opq \imm .s8
	regs2i_1 \op \opq \imm .s16
	regs2i_1 \op \opq \imm .s32
	regs2i_1 \op \opq \imm .s64
	regs2i_1 \op \opq \imm .u8
	regs2i_1 \op \opq \imm .u16
	regs2i_1 \op \opq \imm .u32
	regs2i_1 \op \opq \imm .u64
	.endm

	.macro regs2i_i_64 op opq imm
	regs2i_1 \op \opq \imm .i8
	regs2i_1 \op \opq \imm .i16
	regs2i_1 \op \opq \imm .i32
	regs2i_1 \op \opq \imm .i64
	.endm

	regs2i_i_64 vshl vshlq 0
	regs2i_su_64 vqshl vqshlq 0

	.macro regs3_ntyp op opq
	regs3_1 \op \opq .8
	.endm

	regs3_ntyp vand vandq
	regs3_ntyp vbic vbicq
	regs3_ntyp vorr vorrq
	regs3_ntyp vorn vornq
	regs3_ntyp veor veorq

	.macro logic_imm_1 op opq imm vtype
	\op\vtype q0,\imm
	\opq\vtype q0,\imm
	\op\vtype d0,\imm
	.endm

	.macro logic_imm op opq
	logic_imm_1 \op \opq 0x000000ff .i32
	logic_imm_1 \op \opq 0x0000ff00 .i32
	logic_imm_1 \op \opq 0x00ff0000 .i32
	logic_imm_1 \op \opq 0xff000000 .i32
	logic_imm_1 \op \opq 0x00ff .i16
	logic_imm_1 \op \opq 0xff00 .i16
	.endm

	logic_imm vbic vbicq
	logic_imm vorr vorrq

	.macro logic_inv_imm op opq
	logic_imm_1 \op \opq 0xffffff00 .i32
	logic_imm_1 \op \opq 0xffff00ff .i32
	logic_imm_1 \op \opq 0xff00ffff .i32
	logic_imm_1 \op \opq 0x00ffffff .i32
	logic_imm_1 \op \opq 0xff00 .i16
	logic_imm_1 \op \opq 0x00ff .i16
	.endm

	logic_inv_imm vand vandq
	logic_inv_imm vorn vornq

	regs3_ntyp vbsl vbslq
	regs3_ntyp vbit vbitq
	regs3_ntyp vbif vbifq

	.macro regs3_suf_32 op opq
	regs3_1 \op \opq .s8
	regs3_1 \op \opq .s16
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .u8
	regs3_1 \op \opq .u16
	regs3_1 \op \opq .u32
	regs3_1 \op \opq .f32
	.endm

	.macro regs3_if_32 op opq
	regs3_1 \op \opq .i8
	regs3_1 \op \opq .i16
	regs3_1 \op \opq .i32
	regs3_1 \op \opq .f32
	.endm

	regs3_suf_32 vabd vabdq
	regs3_suf_32 vmax vmaxq
	regs3_suf_32 vmin vminq

	regs3_suf_32 vcge vcgeq
	regs3_suf_32 vcgt vcgtq
	regs3_suf_32 vcle vcleq
	regs3_suf_32 vclt vcltq

	regs3_if_32 vceq vceqq

	.macro regs2i_sf_0 op opq
	regs2i_1 \op \opq 0 .s8
	regs2i_1 \op \opq 0 .s16
	regs2i_1 \op \opq 0 .s32
	regs2i_1 \op \opq 0 .f32
	.endm

	regs2i_sf_0 vcge vcgeq
	regs2i_sf_0 vcgt vcgtq
	regs2i_sf_0 vcle vcleq
	regs2i_sf_0 vclt vcltq

	.macro regs2i_if_0 op opq
	regs2i_1 \op \opq 0 .i8
	regs2i_1 \op \opq 0 .i16
	regs2i_1 \op \opq 0 .i32
	regs2i_1 \op \opq 0 .f32
	.endm

	regs2i_if_0 vceq vceqq

	.macro dregs3_suf_32 op
	dregs3_1 \op .s8
	dregs3_1 \op .s16
	dregs3_1 \op .s32
	dregs3_1 \op .u8
	dregs3_1 \op .u16
	dregs3_1 \op .u32
	dregs3_1 \op .f32
	.endm

	dregs3_suf_32 vpmax
	dregs3_suf_32 vpmin

	.macro sregs3_1 op opq vtype
	\op\vtype q0,q0,q0
	\opq\vtype q0,q0,q0
	\op\vtype d0,d0,d0
	.endm

	.macro sclr21_1 op opq vtype
	\op\vtype q0,q0,d0[0]
	\opq\vtype q0,q0,d0[0]
	\op\vtype d0,d0,d0[0]
	.endm

	.macro mul_incl_scalar op opq
	regs3_1 \op \opq .i8
	regs3_1 \op \opq .i16
	regs3_1 \op \opq .i32
	regs3_1 \op \opq .f32
	sclr21_1 \op \opq .i16
	sclr21_1 \op \opq .i32
	sclr21_1 \op \opq .f32
	.endm

	mul_incl_scalar vmla vmlaq
	mul_incl_scalar vmls vmlsq

	.macro dregs3_if_32 op
	dregs3_1 \op .i8
	dregs3_1 \op .i16
	dregs3_1 \op .i32
	dregs3_1 \op .f32
	.endm

	dregs3_if_32 vpadd

	.macro regs3_if_64 op opq
	regs3_1 \op \opq .i8
	regs3_1 \op \opq .i16
	regs3_1 \op \opq .i32
	regs3_1 \op \opq .i64
	regs3_1 \op \opq .f32
	.endm

	regs3_if_64 vadd vaddq
	regs3_if_64 vsub vsubq

	.macro regs3_sz_32 op opq
	regs3_1 \op \opq .8
	regs3_1 \op \opq .16
	regs3_1 \op \opq .32
	.endm

	regs3_sz_32 vtst vtstq

	.macro regs3_ifp_32 op opq
        regs3_1 \op \opq .i8
	regs3_1 \op \opq .i16
	regs3_1 \op \opq .i32
	regs3_1 \op \opq .f32
	regs3_1 \op \opq .p8
	.endm

	regs3_ifp_32 vmul vmulq

	.macro dqmulhs op opq
	regs3_1 \op \opq .s16
	regs3_1 \op \opq .s32
	sclr21_1 \op \opq .s16
	sclr21_1 \op \opq .s32
	.endm

	dqmulhs vqdmulh vqdmulhq
	dqmulhs vqrdmulh vqrdmulhq

	regs3_1 vacge vacgeq .f32
	regs3_1 vacgt vacgtq .f32
	regs3_1 vacle vacleq .f32
	regs3_1 vaclt vacltq .f32
	regs3_1 vrecps vrecpsq .f32
	regs3_1 vrsqrts vrsqrtsq .f32

	.macro regs2_sf_32 op opq
	regs2_1 \op \opq .s8
	regs2_1 \op \opq .s16
	regs2_1 \op \opq .s32
	regs2_1 \op \opq .f32
	.endm

	regs2_sf_32 vabs vabsq
	regs2_sf_32 vneg vnegq

	.macro rshift_imm op opq
	regs2i_1 \op \opq 7 .s8
	regs2i_1 \op \opq 15 .s16
	regs2i_1 \op \opq 31 .s32
	regs2i_1 \op \opq 63 .s64
	regs2i_1 \op \opq 7 .u8
	regs2i_1 \op \opq 15 .u16
	regs2i_1 \op \opq 31 .u32
	regs2i_1 \op \opq 63 .u64
	.endm

	rshift_imm vshr vshrq
	rshift_imm vrshr vrshrq
	rshift_imm vsra vsraq
	rshift_imm vrsra vrsraq

	regs2i_1 vsli vsliq 0 .8
	regs2i_1 vsli vsliq 0 .16
	regs2i_1 vsli vsliq 0 .32
	regs2i_1 vsli vsliq 0 .64

	regs2i_1 vsri vsriq 7 .8
	regs2i_1 vsri vsriq 15 .16
	regs2i_1 vsri vsriq 31 .32
	regs2i_1 vsri vsriq 63 .64

	regs2i_1 vqshlu vqshluq 0 .s8
	regs2i_1 vqshlu vqshluq 0 .s16
	regs2i_1 vqshlu vqshluq 0 .s32
	regs2i_1 vqshlu vqshluq 0 .s64

	.macro qrshift_imm op
	regn3_1 \op 7 .s16
	regn3_1 \op 15 .s32
	regn3_1 \op 31 .s64
	regn3_1 \op 7 .u16
	regn3_1 \op 15 .u32
	regn3_1 \op 31 .u64
	.endm

	.macro qrshiftu_imm op
	regn3_1 \op 7 .s16
	regn3_1 \op 15 .s32
	regn3_1 \op 31 .s64
	.endm

	.macro qrshifti_imm op
	regn3_1 \op 7 .i16
	regn3_1 \op 15 .i32
	regn3_1 \op 31 .i64
	.endm

	qrshift_imm vqshrn
	qrshift_imm vqrshrn
	qrshiftu_imm vqshrun
	qrshiftu_imm vqrshrun

	qrshifti_imm vshrn
	qrshifti_imm vrshrn

	regl3_1 vshll 1 .s8
	regl3_1 vshll 1 .s16
	regl3_1 vshll 1 .s32
	regl3_1 vshll 1 .u8
	regl3_1 vshll 1 .u16
	regl3_1 vshll 1 .u32

	regl3_1 vshll 8 .i8
	regl3_1 vshll 16 .i16
	regl3_1 vshll 32 .i32

	.macro convert op opr arg="" t1=".s32.f32" t2=".u32.f32" t3=".f32.s32" t4=".f32.u32"
	\op\t1 \opr,\opr\arg
	\op\t2 \opr,\opr\arg
	\op\t3 \opr,\opr\arg
	\op\t4 \opr,\opr\arg
	.endm

	convert vcvt q0
	convert vcvtq q0
	convert vcvt d0
	convert vcvt q0 ",1"
	convert vcvtq q0 ",1"
	convert vcvt d0 ",1"

	vmov q0,q0
	vmov d0,d0
	vmov.8 d0[0],r0
	vmov.16 d0[0],r0
	vmov.32 d0[0],r0
	vmov d0,r0,r0
	vmov.s8 r0,d0[0]
	vmov.s16 r0,d0[0]
	vmov.u8 r0,d0[0]
	vmov.u16 r0,d0[0]
	vmov.32 r0,d0[0]
	vmov r0,r1,d0

	.macro mov_imm op imm vtype
	\op\vtype q0,\imm
	\op\vtype d0,\imm
	.endm

	mov_imm vmov 0x00000077 .i32
	mov_imm vmvn 0x00000077 .i32
	mov_imm vmov 0x00007700 .i32
	mov_imm vmvn 0x00007700 .i32
	mov_imm vmov 0x00770000 .i32
	mov_imm vmvn 0x00770000 .i32
	mov_imm vmov 0x77000000 .i32
	mov_imm vmvn 0x77000000 .i32
	mov_imm vmov 0x0077 .i16
	mov_imm vmvn 0x0077 .i16
	mov_imm vmov 0x7700 .i16
	mov_imm vmvn 0x7700 .i16
	mov_imm vmov 0x000077ff .i32
	mov_imm vmvn 0x000077ff .i32
	mov_imm vmov 0x0077ffff .i32
	mov_imm vmvn 0x0077ffff .i32
	mov_imm vmov 0x77 .i8
	mov_imm vmov 0xff0000ff000000ff .i64
	mov_imm vmov 0x40880000 .f32

	vmvn q0,q0
	vmvnq q0,q0
	vmvn d0,d0

	.macro long_ops op
	regl3_1 \op d0 .s8
	regl3_1 \op d0 .s16
	regl3_1 \op d0 .s32
	regl3_1 \op d0 .u8
	regl3_1 \op d0 .u16
	regl3_1 \op d0 .u32
	.endm

	long_ops vabal
	long_ops vabdl
	long_ops vaddl
	long_ops vsubl

	.macro long_mac op
	regl3_1 \op d0 .s8
	regl3_1 \op d0 .s16
	regl3_1 \op d0 .s32
	regl3_1 \op d0 .u8
	regl3_1 \op d0 .u16
	regl3_1 \op d0 .u32
	regl3_1 \op "d0[0]" .s16
	regl3_1 \op "d0[0]" .s32
	regl3_1 \op "d0[0]" .u16
	regl3_1 \op "d0[0]" .u32
	.endm

	long_mac vmlal
	long_mac vmlsl

	.macro wide_ops op
	regw3_1 \op d0 .s8
	regw3_1 \op d0 .s16
	regw3_1 \op d0 .s32
	regw3_1 \op d0 .u8
	regw3_1 \op d0 .u16
	regw3_1 \op d0 .u32
	.endm

	wide_ops vaddw
	wide_ops vsubw

	.macro narr_ops op
	regn3_1 \op q0 .i16
	regn3_1 \op q0 .i32
	regn3_1 \op q0 .i64
	.endm

	narr_ops vaddhn
	narr_ops vraddhn
	narr_ops vsubhn
	narr_ops vrsubhn

	.macro long_dmac op
	regl3_1 \op d0 .s16
	regl3_1 \op d0 .s32
	regl3_1 \op "d0[0]" .s16
	regl3_1 \op "d0[0]" .s32
	.endm

	long_dmac vqdmlal
	long_dmac vqdmlsl
	long_dmac vqdmull

	regl3_1 vmull d0 .s8
	regl3_1 vmull d0 .s16
	regl3_1 vmull d0 .s32
	regl3_1 vmull d0 .u8
	regl3_1 vmull d0 .u16
	regl3_1 vmull d0 .u32
	regl3_1 vmull d0 .p8
	regl3_1 vmull "d0[0]" .s16
	regl3_1 vmull "d0[0]" .s32
	regl3_1 vmull "d0[0]" .u16
	regl3_1 vmull "d0[0]" .u32

	vext.8 q0,q0,q0,0
	vextq.8 q0,q0,q0,0
	vext.8 d0,d0,d0,0

	.macro revs op opq vtype
	\op\vtype q0,q0
	\opq\vtype q0,q0
	\op\vtype d0,d0
	.endm

	revs vrev64 vrev64q .8
	revs vrev64 vrev64q .16
	revs vrev64 vrev64q .32
	revs vrev32 vrev32q .8
	revs vrev32 vrev32q .16
	revs vrev16 vrev16q .8

	.macro dups op opq vtype
	\op\vtype q0,r0
	\opq\vtype q0,r0
	\op\vtype d0,r0
	\op\vtype q0,d0[0]
	\opq\vtype q0,d0[0]
	\op\vtype d0,d0[0]
	.endm

	dups vdup vdupq .8
	dups vdup vdupq .16
	dups vdup vdupq .32

	.macro binop_3typ op op1 op2 t1 t2 t3
	\op\t1 \op1,\op2
	\op\t2 \op1,\op2
	\op\t3 \op1,\op2
	.endm

	binop_3typ vmovl q0 d0 .s8 .s16 .s32
	binop_3typ vmovl q0 d0 .u8 .u16 .u32
	binop_3typ vmovn d0 q0 .i16 .i32 .i64
	binop_3typ vqmovn d0 q0 .s16 .s32 .s64
	binop_3typ vqmovn d0 q0 .u16 .u32 .u64
	binop_3typ vqmovun d0 q0 .s16 .s32 .s64

	.macro binops op opq vtype="" rhs="0"
	\op\vtype q0,q\rhs
	\opq\vtype q0,q\rhs
	\op\vtype d0,d\rhs
	.endm

	.macro regs2_sz_32 op opq
	binops \op \opq .8 1
	binops \op \opq .16 1
	binops \op \opq .32 1
	.endm

	regs2_sz_32 vzip vzipq
	regs2_sz_32 vuzp vuzpq

	.macro regs2_s_32 op opq
	binops \op \opq .s8
	binops \op \opq .s16
	binops \op \opq .s32
	.endm

	regs2_s_32 vqabs vqabsq
	regs2_s_32 vqneg vqnegq

	.macro regs2_su_32 op opq
	regs2_s_32 \op \opq
	binops \op \opq .u8
	binops \op \opq .u16
	binops \op \opq .u32
	.endm

	regs2_su_32 vpadal vpadalq
	regs2_su_32 vpaddl vpaddlq

	binops vrecpe vrecpeq .u32
	binops vrecpe vrecpeq .f32
	binops vrsqrte vrsqrteq .u32
	binops vrsqrte vrsqrteq .f32

	regs2_s_32 vcls vclsq

	.macro regs2_i_32 op opq
	binops \op \opq .i8
	binops \op \opq .i16
	binops \op \opq .i32
	.endm

	regs2_i_32 vclz vclzq

	binops vcnt vcntq .8

	binops vswp vswpq "" 1

	regs2_sz_32 vtrn vtrnq

	vtbl.8 d0,{d0},d0
	vtbx.8 d0,{d0},d0
	
@


1.1.2.2
log
@2006-09-04  Paul Brook  <paul@@codesourcery.com>

	gas/
	* config/tc-arm.c (do_neon_dyadic_if_i): Remove.
	(do_neon_dyadic_if_i_d): Avoid setting U bit.
	(do_neon_mac_maybe_scalar): Ditto.
	(do_neon_dyadic_narrow): Force operand type to NT_integer.
	(insns): Remove out of date comments.

	gas/testsuite/
	* gas/arm/neon-cov.s: Test .u and .s aliases for .i suffixes.
	* gas/arm/neon-cov.d: Adjust expected output.

	opcodes/
	* arm-dis.c (neon_opcode): Fix suffix on VMOVN.
@
text
@a89 2
	regs2i_1 \op \opq \imm .s32
	regs2i_1 \op \opq \imm .u32
a113 2
	logic_imm_1 \op \opq 0x000000ff .s32
	logic_imm_1 \op \opq 0x000000ff .u32
a125 2
	logic_imm_1 \op \opq 0xffffff00 .s32
	logic_imm_1 \op \opq 0xffffff00 .u32
a153 2
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .u32
a183 2
	regs2i_1 \op \opq 0 .s32
	regs2i_1 \op \opq 0 .u32
a217 2
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .u32
a220 2
	sclr21_1 \op \opq .s32
	sclr21_1 \op \opq .u32
a230 2
	dregs3_1 \op .s32
	dregs3_1 \op .u32
a239 2
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .u32
a258 2
	regs3_1 \op \opq .s32
	regs3_1 \op \opq .u32
a340 2
	regn3_1 \op 15 .s32
	regn3_1 \op 15 .u32
a361 2
	regl3_1 vshll 32 .s32
	regl3_1 vshll 32 .u32
a395 2
	mov_imm vmov 0x00000077 .s32
	mov_imm vmov 0x00000077 .u32
a396 2
	mov_imm vmvn 0x00000077 .s32
	mov_imm vmvn 0x00000077 .u32
a463 2
	regn3_1 \op q0 .s32
	regn3_1 \op q0 .u32
a533 2
	vmovn.s32 d0, q0
	vmovn.u32 d0, q0
a582 2
	binops \op \opq .s32
	binops \op \opq .u32
@


1.1.2.3
log
@2006-09-18  Paul Brook  <paul@@codesourcery.com>

	gas/
	* config/tc-arm.c (parse_immediate_maybe_bounded): Rename back...
	(parse_immediate): ... to this.  Revert earlier changes.
	(parse_immediate_bounded): Remove.
	(parse_immediate_unbounded): Remove.
	(parse_address_main): Revert earlier changes.
	(parse_ror): Ditto.
	(po_imm_unb_or_fail): Remove.
	(neon_cmode_for_logic_imm): Try smaller element sizes.
	(neon_cmode_for_move_imm): Ditto.
	(do_neon_logic): Handle .i64 pseudo-op.

	gas/testsuite/
	* testsuite/gas/arm/neon-cov.s: Test pseudo-instruction forms of
	vmov, vmvn and logic immediate instructions.
	* testsuite/gas/arm/neon-cov.d: ditto.
@
text
@a114 6
	logic_imm_1 \op \opq 0x000000a5000000a5 .i64
	logic_imm_1 \op \opq 0x0000a5000000a500 .i64
	logic_imm_1 \op \opq 0x00a5000000a50000 .i64
	logic_imm_1 \op \opq 0xa5000000a5000000 .i64
	logic_imm_1 \op \opq 0x00a500a500a500a5 .i64
	logic_imm_1 \op \opq 0xa500a500a500a500 .i64
a120 2
	logic_imm_1 \op \opq 0x00a500a5 .i32
	logic_imm_1 \op \opq 0xa500a500 .i32
a122 1
	logic_imm_1 \op \opq 0x00 .i8
a128 6
	logic_imm_1 \op \opq 0xffffff5affffff5a .i64
	logic_imm_1 \op \opq 0xffff5affffff5aff .i64
	logic_imm_1 \op \opq 0xff5affffff5affff .i64
	logic_imm_1 \op \opq 0x5affffff5affffff .i64
	logic_imm_1 \op \opq 0xff5aff5aff5aff5a .i64
	logic_imm_1 \op \opq 0x5aff5aff5aff5aff .i64
a134 2
	logic_imm_1 \op \opq 0xff5aff5a .i32
	logic_imm_1 \op \opq 0x5aff5aff .i32
a136 1
	logic_imm_1 \op \opq 0xff .i8
a442 18
	mov_imm vmov 0xa5a5 .i16
	mov_imm vmvn 0xa5a5 .i16
	mov_imm vmov 0xa5a5a5a5 .i32
	mov_imm vmvn 0xa5a5a5a5 .i32
	mov_imm vmov 0x00a500a5 .i32
	mov_imm vmov 0xa500a500 .i32
	mov_imm vmov 0xa5a5a5a5a5a5a5a5 .i64
	mov_imm vmvn 0xa5a5a5a5a5a5a5a5 .i64
	mov_imm vmov 0x00a500a500a500a5 .i64
	mov_imm vmov 0xa500a500a500a500 .i64
	mov_imm vmov 0x000000a5000000a5 .i64
	mov_imm vmov 0x0000a5000000a500 .i64
	mov_imm vmov 0x00a5000000a50000 .i64
	mov_imm vmov 0xa5000000a5000000 .i64
	mov_imm vmov 0x0000a5ff0000a5ff .i64
	mov_imm vmov 0x00a5ffff00a5ffff .i64
	mov_imm vmov 0xa5ffffffa5ffffff .i64

@


1.1.2.4
log
@2006-10-26  Paul Brook  <paul@@codesourcery.com>

	gas/
	* config/tc-arm.c (do_neon_ext): Enforce immediate range.
	(insns): Use I15 for vext.

	gas/testsute/
	* gas/arm/neon-cov.s: Add new vext test.
	* gas/arm/neon-cov.d: Ditto.
@
text
@a563 1
	vext.8 q0,q0,q0,8
@


