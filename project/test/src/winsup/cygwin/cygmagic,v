head	1.13;
access;
symbols
	cygwin-1_7_35-release:1.13
	cygwin-1_7_34-release:1.13
	cygwin-1_7_33-release:1.13
	cygwin-1_7_32-release:1.13
	cygwin-1_7_31-release:1.13
	cygwin-1_7_30-release:1.13
	cygwin-1_7_29-release:1.13
	cygwin-1_7_29-release-branchpoint:1.13.0.2
	cygwin-pre-user-db:1.13
	cygwin-1_7_28-release:1.13
	cygwin-1_7_27-release:1.13
	cygwin-1_7_26-release:1.13
	cygwin-1_7_25-release:1.13
	cygwin-1_7_24-release:1.13
	cygwin-1_7_23-release:1.13
	cygwin-1_7_22-release:1.13
	cygwin-1_7_21-release:1.13
	cygwin-1_7_20-release:1.13
	cygwin-1_7_19-release:1.13
	cygwin-64bit-postmerge:1.13
	cygwin-64bit-premerge-branch:1.12.0.2
	cygwin-64bit-premerge:1.12
	cygwin-1_7_18-release:1.12
	post-ptmalloc3:1.11.18.2
	pre-ptmalloc3:1.11.18.2
	cygwin-1_7_17-release:1.11
	cygwin-64bit-branch:1.11.0.18
	cygwin-1_7_16-release:1.11
	cygwin-1_7_15-release:1.11
	cygwin-1_7_14_2-release:1.11
	cygwin-1_7_14-release:1.11
	cygwin-1_7_12-release:1.11
	cygwin-1_7_11-release:1.11
	cygwin-1_7_10-release:1.11
	signal-rewrite:1.11.0.16
	pre-notty:1.11
	cygwin-1_7_9-release:1.11
	cv-post-1_7_9:1.11.0.14
	cygwin-1_7_8-release:1.11
	cygwin-1_7_7-release:1.11
	cygwin-1_7_5-release:1.11
	cygwin-1_7_4-release:1.11
	cygwin-1_7_3-release:1.11
	cygwin-1_7_2-release:1.11
	fifo_doover3:1.11.0.12
	cygwin-1_7_1-release:1.11
	prefifo:1.11
	cv-branch-2:1.11.0.10
	pre-ripout-set_console_state_for_spawn:1.11
	EOL_registry_mounts:1.11
	preoverlapped:1.11
	drop_9x_support_start:1.11
	cr-0x5f1:1.11.0.8
	cv-branch:1.11.0.6
	pre-ptymaster-archetype:1.11
	cr-0x3b58:1.11.0.4
	cr-0x5ef:1.11.0.2
	after-mmap-privanon-noreserve:1.11
	after-mmap-revamp:1.11
	before-mmap-revamp:1.11
	cgf-more-exit-sync:1.11
	post_wait_sig_exit:1.11
	pre_wait_sig_exit:1.11
	reparent-point:1.8
	noreparent:1.8.0.18
	cr-0x5e6:1.8.0.14
	cr-0x9e:1.8.0.12
	cr-0x9d:1.8.0.10
	cgf-deleteme:1.8.0.8
	pre-sigrewrite:1.8
	corinna-01:1.8
	cr-0x9c:1.8.0.6
	cr-0x9b:1.8.0.4
	cr-0x99:1.8
	Z-emcb-cygwin_daemon:1.8.0.2
	w32api-2_2:1.8
	mingw-runtime-2_4:1.8
	pre-cgf-merge:1.8
	cgf-dev-branch:1.8.0.16
	predaemon:1.7
	cygwin_daemon_merge_HEAD:1.7
	pregp02r1:1.7.0.2
	cygnus_cvs_20020108_pre:1.4
	Z-cygwin_daemon_merge_HEAD:1.8
	cygwin_daemon:1.3.0.2
	Z-cygwin_daemon_merge-new_HEAD:1.8;
locks; strict;
comment	@# @;


1.13
date	2013.04.23.09.44.31;	author corinna;	state Exp;
branches;
next	1.12;

1.12
date	2013.01.21.04.38.27;	author cgf;	state Exp;
branches;
next	1.11;

1.11
date	2005.05.30.00.54.01;	author cgf;	state Exp;
branches
	1.11.18.1;
next	1.10;

1.10
date	2005.05.22.03.54.29;	author cgf;	state Exp;
branches;
next	1.9;

1.9
date	2005.04.28.23.59.44;	author cgf;	state Exp;
branches;
next	1.8;

1.8
date	2002.08.27.04.10.54;	author cgf;	state Exp;
branches;
next	1.7;

1.7
date	2002.01.22.03.48.16;	author cgf;	state Exp;
branches;
next	1.6;

1.6
date	2002.01.22.03.02.00;	author cgf;	state Exp;
branches;
next	1.5;

1.5
date	2002.01.13.20.03.03;	author cgf;	state Exp;
branches;
next	1.4;

1.4
date	2002.01.04.23.29.58;	author cgf;	state Exp;
branches;
next	1.3;

1.3
date	2001.12.30.18.52.19;	author cgf;	state Exp;
branches
	1.3.2.1;
next	1.2;

1.2
date	2001.12.26.21.35.16;	author cgf;	state Exp;
branches;
next	1.1;

1.1
date	2001.12.26.04.53.34;	author cgf;	state Exp;
branches;
next	;

1.11.18.1
date	2013.01.21.13.52.04;	author corinna;	state Exp;
branches;
next	1.11.18.2;

1.11.18.2
date	2013.02.08.19.42.29;	author corinna;	state Exp;
branches;
next	;

1.3.2.1
date	2002.01.04.03.56.05;	author rbcollins;	state Exp;
branches;
next	1.3.2.2;

1.3.2.2
date	2002.01.15.12.52.49;	author rbcollins;	state Exp;
branches;
next	1.3.2.3;

1.3.2.3
date	2002.01.22.04.52.39;	author rbcollins;	state Exp;
branches;
next	1.3.2.4;

1.3.2.4
date	2002.08.27.12.28.37;	author scottc;	state Exp;
branches;
next	;


desc
@@


1.13
log
@	* Merge in cygwin-64bit-branch.
@
text
@#!/bin/sh
# cygmagic - Generate "magic numbers" from a structure.
#
#   Copyright 2001, 2002, 2005, 2013 Red Hat, Inc.
#
# This file is part of Cygwin.
#
# This software is a copyrighted work licensed under the terms of the
# Cygwin license.  Please consult the file "CYGWIN_LICENSE" for
# details.

file_magic=$1; shift
gcc=$1; shift
file=$1; shift
trap "rm -f /tmp/$$.magic" 0 1 2 15
cat <<EOF > $file_magic
/* autogenerated - do not edit */
#include "$file"
EOF
sumit() {
    cksum $*
}

while [ -n "$1" ]; do
    define=$1; shift
    struct=$1; shift
    sum=`$gcc -D__CYGMAGIC__ -E $file | sed -n "/^$struct/,/^};/p" | sed -e 's/[ 	]//g' -e '/^$/d' | sumit | awk '{printf "0x%xU", $1}'`
    echo "#define $define $sum"
    curr=`sed -n "s/^#[ 	]*define CURR_$define[ 	][ 	]*\([^ 	][^ 	]*\)/\1/p" $file`
    [ "$curr" != "$sum" ] && echo "*** WARNING WARNING WARNING WARNING WARNING ***
*** $file: magic number for $define changed old $curr != new $sum
*** WARNING WARNING WARNING WARNING WARNING ***" 1>&2
done >> $file_magic
exit 0
@


1.12
log
@Throughout, update copyrights to reflect dates which correspond to main-branch
checkins.  Regularize copyright format.
@
text
@d4 1
a4 1
#   Copyright 2001, 2002, 2005 Red Hat, Inc.
d27 1
a27 1
    sum=`$gcc -E $file | sed -n "/^$struct/,/^};/p" | sed -e 's/[ 	]//g' -e '/^$/d' | sumit | awk '{printf "0x%xU", $1}'`
@


1.11
log
@* cygmagic: Remove debugging cruft missed on 2005-05-21.
@
text
@d4 1
a4 1
#   Copyright 2001, 2002 Red Hat, Inc.
@


1.11.18.1
log
@Pull in changes from HEAD
@
text
@d4 1
a4 1
#   Copyright 2001, 2002, 2005 Red Hat, Inc.
@


1.11.18.2
log
@	* regparm.h: New file to define platform dependent regparm attributes.
	Define all of them empty if __CYGMAGIC__ is defined.
	* cygerrno.h: Include regparm.h instead of defining _reg[123] here.
	* winsup.h: Ditto.
	* cygmagic: Define __CYGMAGIC__ to help generate same result on all
	platforms.
	* child_info.h (CURR_CHILD_INFO_MAGIC): Update.
	(class child_info_fork): Drop extraneous semicolon.
@
text
@d4 1
a4 1
#   Copyright 2001, 2002, 2005, 2013 Red Hat, Inc.
d27 1
a27 1
    sum=`$gcc -D__CYGMAGIC__ -E $file | sed -n "/^$struct/,/^};/p" | sed -e 's/[ 	]//g' -e '/^$/d' | sumit | awk '{printf "0x%xU", $1}'`
@


1.10
log
@* spawn.cc (find_exec): Accept a PATH-like string in place of an environment
variable.
* dlfcn.cc (get_full_path_of_dll): Search /usr/bin (for windows compatibility)
and /usr/lib (for UNIX compatibility) when looking for shared libraries.
* environ.cc (conv_envvars): Put back LD_LIBRARY_PATH since it is used by
get_full_path_of_dll().
* errno.cc (errmap): Map MOD_NOT_FOUND to ENOENT.
* cygmagic: Remove debugging cruft.
@
text
@d27 1
a27 1
    sum=`$gcc -E $file | sed -n "/^$struct/,/^};/p" | sed -e 's/[ 	]//g' -e '/^$/d' | sumit | tee /tmp/3 | awk '{printf "0x%xU", $1}'`
@


1.9
log
@* shared_info.h (cygwin_shared_address): Bump to a higher value to avoid
collision with large data areas.
* fhandler_console.cc (fhandler_console::get_tty_stuff): Accommodate changes to
open_shared arguments.
* fhandler_tape.cc (mtinfo_init): Ditto.
* pinfo.cc (pinfo::init): Use open_shared rather than win32 mmap calls.
* shared.cc (user_shared_initialize): Ditto.
(memory_init): Ditto.
(open_shared): Change to allow use a smore general mmap handler.
* shared_info.h (shared_locations): Add SH_JUSTCREATE, SH_JUSTOPEN.
(open_shared): Change declaration to match new usage.
* autoload.cc (LoadDLLfuncEx2): Define in terms of LoadDLLfuncEx3.
(LoadDLLfuncEx3): New macro.
@
text
@d27 1
a27 1
    sum=`$gcc -E $file | tee /tmp/1 | sed -n "/^$struct/,/^};/p" | sed -e 's/[ 	]//g' -e '/^$/d' | tee /tmp/2 | sumit | tee /tmp/3 | awk '{printf "0x%xU", $1}'`
@


1.8
log
@* child_info.h: Add _PROC_WHOOPS enum value.
(CURR_CHILD_INFO_MAGIC): Update.
(child_info::magic): Make 'long'.
* cygheap.h: Export _cygheap_start.
* cygheap.cc: Don't declare _cygheap_start.
* cygmagic: Use cksum to produce checksums.  Append 'U' to end of checksum.
* dcrt0.cc (initial_env): Calculate sleep ms before reusing buffer.
(_dll_crt0): Detect cygheap mismatch as indicative of different cygwin version.
Set child_proc_info to NULL when _PROC_WHOOPS.
(multiple_cygwin_problem): If child_info specific problem, then set
child_proc_info type to _PROC_WHOOPS.
* shared_info.h (CURR_MOUNT_MAGIC): Update.
(CURR_SHARED_MAGIC): Ditto.
@
text
@d27 1
a27 1
    sum=`$gcc -E $file | sed -n "/^$struct/,/^};/p" | sed -e 's/[ 	]//g' -e '/^$/d' | sumit | awk '{printf "0x%xU", $1}'`
@


1.7
log
@* cygmagic: Suppress error output when figuring out if sum takes an option.
@
text
@d20 3
a22 5
if sum -r /dev/null >/dev/null 2>&1; then
  sumit(){ sum -r $*; }
else
  sumit(){ sum $*; }
fi
d27 1
a27 1
    sum=`$gcc -E $file | sed -n "/^$struct/,/^};/p" | sed -e 's/[ 	]//g' -e '/^$/d' | sumit | awk '{printf "0x%x", $1}'`
@


1.6
log
@* cygmagic: Attempt to figure out if sum takes an option.
@
text
@d20 1
a20 1
if sum -r /dev/null; then
@


1.5
log
@Add copyright stuff
@
text
@d20 6
d29 1
a29 1
    sum=`$gcc -E $file | sed -n "/^$struct/,/^};/p" | sed -e 's/[ 	]//g' -e '/^$/d' | sum | awk '{printf "0x%x", $1}'`
@


1.4
log
@* cygmagic: Change logic for equality test.
@
text
@d2 10
@


1.3
log
@* cygmagic: Eliminate unneeded use of 'tr' and 'bc'.
@
text
@d16 1
a16 1
    [ "$curr" == "$sum" ] || echo "*** WARNING WARNING WARNING WARNING WARNING ***
@


1.3.2.1
log
@Merged changes from HEAD
@
text
@@


1.3.2.2
log
@Merged changes from HEAD
@
text
@a1 10
# cygmagic - Generate "magic numbers" from a structure.
#
#   Copyright 2001, 2002 Red Hat, Inc.
#
# This file is part of Cygwin.
#
# This software is a copyrighted work licensed under the terms of the
# Cygwin license.  Please consult the file "CYGWIN_LICENSE" for
# details.

d16 1
a16 1
    [ "$curr" != "$sum" ] && echo "*** WARNING WARNING WARNING WARNING WARNING ***
@


1.3.2.3
log
@Merged changes from HEAD
@
text
@a19 6
if sum -r /dev/null >/dev/null 2>&1; then
  sumit(){ sum -r $*; }
else
  sumit(){ sum $*; }
fi

d23 1
a23 1
    sum=`$gcc -E $file | sed -n "/^$struct/,/^};/p" | sed -e 's/[ 	]//g' -e '/^$/d' | sumit | awk '{printf "0x%x", $1}'`
@


1.3.2.4
log
@Merged changes from HEAD
@
text
@d20 5
a24 3
sumit() {
    cksum $*
}
d29 1
a29 1
    sum=`$gcc -E $file | sed -n "/^$struct/,/^};/p" | sed -e 's/[ 	]//g' -e '/^$/d' | sumit | awk '{printf "0x%xU", $1}'`
@


1.2
log
@* cygmagic: Add define name to warning.
* dcrt0.cc (_dll_crt0): Check for changes in child_info size.
(multiple_cygwin_problem): Avoid "proc" errors when testing.  Just assume new
cygwin proc.
* shared_info.h (mount_info): Add 'cb' element for sanity checks.
(shared_info): Ditto.
* child_info.h (child_info): Add fhandler_union_size element for sanity
checking.
* shared.cc (open_shared): Detect shared region size mismatch between parent
and child.
(shared_info::initialize): Detect shared region size mismatch with expectation.
(memory_Init): Ditto.
* sigproc.cc (init_child_info): Correctly set cb in passed structure.
* shared.cc (open_shared):
@
text
@d13 1
a13 1
    sum=`$gcc -E $file | sed -n "/^$struct/,/^};/p" | sed -e 's/[ 	]//g' -e '/^$/d' | sum | awk '{print "obase=16;\"0x\";", $1}' | bc | tr '[A-Z]' '[a-z]'`
@


1.1
log
@* Makefile.in: Autogenerate some header files which provide magic numbers.
Force dependencies for files which depend on autogenerated headers to ensure
that they are always built.
* child_info.h (child_info): Add new fields to accommodate new magic number
header stuff.
* dcrt0.cc: Rely on "child_info_magic.h" to ensure that correct child_info
magic numbers are used.
(dll_crt0_1): Temporarily remove _cygwin_testing_magic test.
(_dll_crt0): Do more testing on magic numbers from fork_info structure.  Call
"multiple_cygwin_problem" where appropriate.
(multiple_cygwin_problem): Rename from multiple_cygwin_die.  Issue a warning or
die, as appropriate based on cygwin version/magic number mismatch.
* pinfo.cc (pinfo::exit): Don't attempt to dereference `this' if it doesn't
exist.  This can happen when a fatal error occurs early in process
initialization.
* shared.cc: Rely on "shared_info_magic.h" to accommodate that new magic number
header stuff.
(shared_info::initialize): Use new magic number stuff, for shared region.
(memory_init): Ditto, for mount table.
* shared_info.h: Accomodate new magic number stuff for shared region and mount
table.
* sigproc.cc: Rely on "child_info_magic.h" to accommodate new magic number
header stuff.
(init_child_info): Initialize new fields in child_info) to accomodate magic
numbers.
* winsup.h: Rename multiple_cygwin_die to multiple_cygwin_problem.
* include/cygwin/version.h: Define macros for manipulating version magic.
* cygmagic: New shell script for generating magic numbers.
@
text
@d17 1
a17 1
*** $file: magic number changed old $curr != new $sum
@

