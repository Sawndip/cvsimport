head	1.30;
access;
symbols
	cygwin-1_7_35-release:1.30
	cygwin-1_7_34-release:1.30
	cygwin-1_7_33-release:1.28
	cygwin-1_7_32-release:1.28
	cygwin-1_7_31-release:1.28
	cygwin-1_7_30-release:1.28
	cygwin-1_7_29-release:1.28
	cygwin-1_7_29-release-branchpoint:1.28.0.2
	cygwin-1_7_28-release:1.28
	cygwin-1_7_27-release:1.28
	cygwin-1_7_26-release:1.28
	cygwin-1_7_25-release:1.28
	cygwin-1_7_24-release:1.28
	cygwin-1_7_23-release:1.28
	cygwin-1_7_22-release:1.28
	cygwin-1_7_21-release:1.28
	cygwin-1_7_20-release:1.28
	cygwin-1_7_19-release:1.28
	cygwin-64bit-postmerge:1.28
	cygwin-64bit-premerge-branch:1.27.0.2
	cygwin-64bit-premerge:1.27
	cygwin-1_7_18-release:1.27
	cygwin-1_7_17-release:1.24
	cygwin-64bit-branch:1.24.0.2
	cygwin-1_7_16-release:1.24
	cygwin-1_7_15-release:1.24
	cygwin-1_7_14_2-release:1.24
	cygwin-1_7_14-release:1.24
	cygwin-1_7_12-release:1.24
	cygwin-1_7_11-release:1.24
	cygwin-1_7_10-release:1.24
	cygwin-1_7_9-release:1.24
	cygwin-1_7_8-release:1.24
	cygwin-1_7_7-release:1.24
	cygwin-1_7_5-release:1.24
	cygwin-1_7_4-release:1.24
	cygwin-1_7_3-release:1.24
	cygwin-1_7_2-release:1.24
	cygwin-1_7_1-release:1.24
	cv-branch-2:1.22.0.2
	cr-0x5f1:1.12.0.6
	cv-branch:1.12.0.4
	cr-0x3b58:1.12.0.2
	cr-0x9e:1.11.0.4
	cr-0x9d:1.11.0.2
	corinna-01:1.5
	cr-0x9c:1.4.0.4
	cr-0x9b:1.4.0.2
	cr-0x99:1.4
	Z-emcb-cygwin_daemon:1.3.0.2;
locks; strict;
comment	@# @;


1.30
date	2015.01.28.11.46.25;	author corinna;	state Exp;
branches;
next	1.29;

1.29
date	2014.03.12.17.37.04;	author corinna;	state Exp;
branches;
next	1.28;

1.28
date	2013.04.23.09.44.30;	author corinna;	state Exp;
branches;
next	1.27;

1.27
date	2012.11.28.03.23.41;	author cgf;	state Exp;
branches;
next	1.26;

1.26
date	2012.11.23.14.52.07;	author cgf;	state Exp;
branches;
next	1.25;

1.25
date	2012.11.23.13.22.43;	author cgf;	state Exp;
branches;
next	1.24;

1.24
date	2009.11.16.08.50.07;	author corinna;	state Exp;
branches
	1.24.2.1;
next	1.23;

1.23
date	2009.08.18.08.37.23;	author corinna;	state Exp;
branches;
next	1.22;

1.22
date	2009.02.24.02.11.13;	author cgf;	state Exp;
branches;
next	1.21;

1.21
date	2009.01.03.05.37.34;	author cgf;	state Exp;
branches;
next	1.20;

1.20
date	2008.11.26.10.18.53;	author corinna;	state Exp;
branches;
next	1.19;

1.19
date	2008.10.30.13.17.42;	author cgf;	state Exp;
branches;
next	1.18;

1.18
date	2008.02.06.22.01.30;	author corinna;	state Exp;
branches;
next	1.17;

1.17
date	2008.02.04.12.02.26;	author corinna;	state Exp;
branches;
next	1.16;

1.16
date	2007.08.02.14.23.22;	author cgf;	state Exp;
branches;
next	1.15;

1.15
date	2007.08.02.14.07.19;	author corinna;	state Exp;
branches;
next	1.14;

1.14
date	2007.02.23.11.43.48;	author corinna;	state Exp;
branches;
next	1.13;

1.13
date	2007.02.22.10.50.51;	author corinna;	state Exp;
branches;
next	1.12;

1.12
date	2006.01.12.16.59.15;	author corinna;	state Exp;
branches;
next	1.11;

1.11
date	2003.12.26.05.37.54;	author cgf;	state Exp;
branches;
next	1.10;

1.10
date	2003.11.26.20.05.09;	author corinna;	state Exp;
branches;
next	1.9;

1.9
date	2003.11.26.03.52.12;	author cgf;	state Exp;
branches;
next	1.8;

1.8
date	2003.11.21.18.10.49;	author corinna;	state Exp;
branches;
next	1.7;

1.7
date	2003.11.20.13.51.34;	author corinna;	state Exp;
branches;
next	1.6;

1.6
date	2003.11.19.18.49.40;	author corinna;	state Exp;
branches;
next	1.5;

1.5
date	2003.10.22.10.04.11;	author corinna;	state Exp;
branches;
next	1.4;

1.4
date	2003.08.30.16.34.56;	author cgf;	state Exp;
branches;
next	1.3;

1.3
date	2003.08.25.18.22.07;	author cgf;	state Exp;
branches;
next	1.2;

1.2
date	2003.07.02.02.31.32;	author cgf;	state Exp;
branches;
next	1.1;

1.1
date	2003.07.01.21.09.30;	author cgf;	state Exp;
branches;
next	;

1.24.2.1
date	2012.11.23.15.14.38;	author corinna;	state Exp;
branches;
next	1.24.2.2;

1.24.2.2
date	2012.11.29.17.28.45;	author corinna;	state Exp;
branches;
next	1.24.2.3;

1.24.2.3
date	2013.02.13.15.04.46;	author corinna;	state Exp;
branches;
next	;


desc
@@


1.30
log
@	* Makefile.in: Simplify rule to build dependencies from cygwin dir.
@
text
@# Makefile for Cygwin server
# Copyright 2003, 2006, 2007, 2008, 2009, 2014, 2015 Red Hat, Inc.

# This file is part of Cygwin.

# This software is a copyrighted work licensed under the terms of the
# Cygwin license.  Please consult the file "CYGWIN_LICENSE" for
# details.

srcdir:=@@srcdir@@
target_builddir:=@@target_builddir@@
winsup_srcdir:=@@winsup_srcdir@@
configure_args=@@configure_args@@

export CC:=@@CC@@
export CXX:=@@CXX@@

CFLAGS:=@@CFLAGS@@
override CXXFLAGS=@@CXXFLAGS@@
override CXXFLAGS+=-MMD -D__OUTSIDE_CYGWIN__ -DSYSCONFDIR="\"$(sysconfdir)\""

include ${srcdir}/../Makefile.common

cygwin_build:=${target_builddir}/winsup/cygwin

# environment variables used by ccwrap
export CCWRAP_HEADERS:=$(dir ${srcdir})/cygwin ${cygwin_build}
export CCWRAP_SYSTEM_HEADERS:=@@cygwin_headers@@ @@newlib_headers@@
export CCWRAP_DIRAFTER_HEADERS:=@@windows_headers@@

DESTDIR=
prefix:=${DESTDIR}@@prefix@@
exec_prefix:=${DESTDIR}@@exec_prefix@@
bindir:=${DESTDIR}@@bindir@@
sbindir:=${DESTDIR}@@sbindir@@
sysconfdir:=${DESTDIR}@@sysconfdir@@
program_transform_name:=@@program_transform_name@@

INSTALL:=@@INSTALL@@
INSTALL_PROGRAM:=@@INSTALL_PROGRAM@@
INSTALL_DATA:=@@INSTALL_DATA@@

AR:=@@AR@@


OBJS:=	cygserver.o client.o process.o msg.o sem.o shm.o threaded_queue.o \
	transport.o transport_pipes.o \
	bsd_helper.o bsd_log.o bsd_mutex.o \
	sysv_msg.o sysv_sem.o sysv_shm.o setpwd.o pwdgrp.o
LIBOBJS:=${patsubst %.o,lib%.o,$(OBJS)}

CYGWIN_OBJS:=$(cygwin_build)/version.o

CYGWIN_LIB:=$(cygwin_build)/libcygwin.a

all: cygserver.exe

install: all cygserver.conf cygserver-config README
	/bin/mkdir -p $(DESTDIR)$(sbindir) $(DESTDIR)$(bindir) $(DESTDIR)$(sysconfdir)/defaults/etc $(DESTDIR)$(prefix)/share/doc/Cygwin
	$(INSTALL_PROGRAM) cygserver.exe $(DESTDIR)$(sbindir)/cygserver.exe
	$(INSTALL_PROGRAM) $(srcdir)/cygserver-config $(DESTDIR)$(bindir)/cygserver-config
	$(INSTALL_DATA) $(srcdir)/cygserver.conf $(DESTDIR)$(sysconfdir)/defaults/etc/cygserver.conf
	$(INSTALL_DATA) $(srcdir)/README $(DESTDIR)$(prefix)/share/doc/Cygwin/cygserver.README

clean:
	rm -f $(OBJS) ${patsubst %.o,%.d,$(OBJS)} cygserver.exe

libclean:
	rm -f $(LIBOBJS) ${patsubst %.o,%.d,$(LIBOBJS)} libcygserver.a

fullclean: clean libclean

cygserver.exe: $(CYGWIN_LIB) $(OBJS) $(CYGWIN_OBJS)
	$(CXX) -o $@@ ${wordlist 2,999,$^} -static -static-libgcc -B$(cygwin_build) -lntdll

$(cygwin_build)/%.o:
	$(MAKE) -C $(@@D) $(@@F)

Makefile: Makefile.in configure
	./config.status

lib%.o: %.cc
	${filter-out -D__OUTSIDE_CYGWIN__, $(COMPILE.cc)} -c -o $(@@D)/${basename $(@@F)}.o $<

libcygserver.a: $(LIBOBJS)
	$(AR) crus $@@ $?

deps:=${wildcard *.d}
ifneq (,$(deps))
include $(deps)
endif
@


1.29
log
@	* Makefile.in (OBJS): Add pwdgrp.o.
	* client.cc (client_request::handle_request): Handle
	CYGSERVER_REQUEST_PWDGRP message.
	* pwdgrp.cc: New file implementing CYGSERVER_REQUEST_PWDGRP.
@
text
@d2 1
a2 1
# Copyright 2003, 2006, 2007, 2008, 2009, 2014 Red Hat, Inc.
d76 2
a77 5
$(cygwin_build)/%.o: $(cygwin_source)/%.cc
	@@$(MAKE) -C $(@@D) $(@@F)

$(cygwin_build)/%.o: $(cygwin_source)/%.c
	@@$(MAKE) -C $(@@D) $(@@F)
@


1.28
log
@	* Merge in cygwin-64bit-branch.
@
text
@d2 1
a2 1
# Copyright 2003, 2006, 2007, 2008, 2009 Red Hat, Inc.
d49 1
a49 1
	sysv_msg.o sysv_sem.o sysv_shm.o setpwd.o
@


1.27
log
@* Makefile.in: Remove old from CFLAGS and move C*FLAGS so that they can be
manipulated by Makefile.common.
@
text
@d74 1
a74 1
	$(CXX) -o $@@ ${wordlist 2,999,$^} -static -static-libgcc -L$(cygwin_build) -lntdll
@


1.26
log
@cygwin/ChangeLog:
2012-11-23  Christopher Faylor  <me.cygwin2012@@cgf.cx>

	* Makefile.in: Use explicit path to mkdir.

lsaauth/ChangeLog:
2012-11-23  Christopher Faylor  <me.cygwin2012@@cgf.cx>

	* Makefile.in: Use /bin/mkdir to make directories.

testsuite/ChangeLog:
2012-11-23  Christopher Faylor  <me.cygwin2012@@cgf.cx>

	* Makefile.in: Remove old Makefile.common'isms.  Don't rely on
	in-build tools.
@
text
@d18 4
a44 3
CFLAGS:=@@CFLAGS@@
override CXXFLAGS=@@CXXFLAGS@@
override CXXFLAGS+=-MMD -DHAVE_DECL_GETOPT=0 -D__OUTSIDE_CYGWIN__ -DSYSCONFDIR="\"$(sysconfdir)\""
@


1.25
log
@ChangeLog:
2012-11-12  Christopher Faylor  <me.cygwin2012@@cgf.cx>

	* Makefile.common: Revamp for new configury.  Add default compilation
	targets, include .E processing.  Add magic for allowing "CFLAGS" to
	control optimization options in "CXXFLAGS".
	* configure.cygwin: New include for Cygwin configure.in's.
	* acinclude.m4: Delete old definitions.  Implement AC_WINDOWS_HEADERS,
	AC_WINDOWS_LIBS, AC_CYGWIN_INCLUDES, target_builddir, winsup_srcdir.
	* aclocal.m4: Regenerate.
	* autogen.sh: New file.
	* ccwrap: New script.
	* c++wrap: New script.
	* config.guess: New script.
	* config.sub: New script.
	* configure: Regenerate.
	* configure.in: Eliminate LIB_AC_PROG_* calls in favor of standard.
	Delete ancient target test.
	* install-sh: New script.

cygserver/ChangeLog:
2012-11-12  Christopher Faylor  <me.cygwin2012@@cgf.cx>

	* Makefile.in: Revamp for new configury.
	* configure.in: Revamp for new configury.
	* aclocal.m4: Regenerate.
	* configure: Ditto.
	* autogen.sh: New script.

cygwin/ChangeLog:
2012-11-22  Christopher Faylor  <me.cygwin2012@@cgf.cx>

	* select.cc (select): Don't return -1 when we've timed out after
	looping.

2012-11-22  Christopher Faylor  <me.cygwin2012@@cgf.cx>

	* Makefile.in: Revamp for new configury.
	(datarootdir): Add variable setting.
	(winver_stamp): Accommodate changes to mkvers.sh setting.
	(libc.a): Fix race when libm.a might not have been built yet.
	* configure.in: Revamp for new configury.
	* aclocal.m4: Regenerate.
	* configure: Ditto.
	* autogen.sh: New script.
	* mkvers.sh: Find include directives via CFLAGS and friends rather than
	assuming that w32api lives nearby.

utils/ChangeLog:
2012-11-12  Christopher Faylor  <me.cygwin2012@@cgf.cx>

	* aclocal.m4: Regenerate.
	* configure: Ditto.
	* autogen.sh: New script.
	* configure.in: Revamp for new configury.
	* Makefile.in: Revamp for new configury.  Rename ALL_* to just *.
	Always use "VERBOSE" setting.
	(MINGW_CXX): Don't include CFLAGS in definition.
	(all): Define target first, before everything else so that it is the
	default.
	(ps.exe): Don't add useless -lcygwin.
	(ldh.exe): For consistency, add to existing MINGW_LDFLAGS rather than
	redefining them.
	(cygcheck.exe): Always include -lz for MINGW_LDFLAGS.  Don't try to
	figure out where to find it.
	(dumper.exe): Simplify check.  Assume libraries are installed rather
	than trying to retrieve from source tree.
	(install): Just use /bin/mkdir to create directories.
	(Makefile): Regenerate when standard dependencies change.
	* dump_setup.cc: Always include zlib.h.  Remove accommodations for it
	possibly not existing.
	* parse_pe.cc: Add define which allows building with installed
	binutils package.
	* dumper.cc: Ditto.
@
text
@d57 2
a58 5
install: all $(updir1)/mkinstalldirs cygserver.conf cygserver-config README
	$(updir1)/mkinstalldirs $(DESTDIR)$(sbindir)
	$(updir1)/mkinstalldirs $(DESTDIR)$(bindir)
	$(updir1)/mkinstalldirs $(DESTDIR)$(sysconfdir)/defaults/etc
	$(updir1)/mkinstalldirs $(DESTDIR)$(prefix)/share/doc/Cygwin
@


1.24
log
@	* Makefile.in (cygserver.exe): Link with -static to avoid linking
	against cygstdc++-6.dll due to references to __cxa_pure_virtual.
@
text
@d10 11
a20 1
SHELL:=@@SHELL@@
d22 4
a25 2
srcdir:=@@srcdir@@
VPATH:=@@srcdir@@
a38 4
CC:=@@CC@@
CC_FOR_TARGET:=$(CC)
CXX:=@@CXX@@
CXX_FOR_TARGET:=$(CXX)
a40 2
include $(srcdir)/../Makefile.common

a44 2
.SUFFIXES: .c .cc .a .o .d

d85 1
d88 1
a88 1
	${filter-out -D__OUTSIDE_CYGWIN__, $(COMPILE_CXX)} -c -I$(updir)/cygwin -I$(bupdir)/cygwin -o $(@@D)/${basename $(@@F)}$o $<
@


1.24.2.1
log
@Pull in changes from HEAD
@
text
@d10 2
d13 1
a13 15
target_builddir:=@@target_builddir@@
winsup_srcdir:=@@winsup_srcdir@@
configure_args=@@configure_args@@

export CC:=@@CC@@
export CXX:=@@CXX@@

include ${srcdir}/../Makefile.common

cygwin_build:=${target_builddir}/winsup/cygwin

# environment variables used by ccwrap
export CCWRAP_HEADERS:=$(dir ${srcdir})/cygwin ${cygwin_build}
export CCWRAP_SYSTEM_HEADERS:=@@cygwin_headers@@ @@newlib_headers@@
export CCWRAP_DIRAFTER_HEADERS:=@@windows_headers@@
d27 4
d33 2
d39 2
d53 5
a57 2
install: all cygserver.conf cygserver-config README
	/bin/mkdir -p $(DESTDIR)$(sbindir) $(DESTDIR)$(bindir) $(DESTDIR)$(sysconfdir)/defaults/etc $(DESTDIR)$(prefix)/share/doc/Cygwin
a80 1
	./config.status
d83 1
a83 1
	${filter-out -D__OUTSIDE_CYGWIN__, $(COMPILE.cc)} -c -o $(@@D)/${basename $(@@F)}.o $<
@


1.24.2.2
log
@Pull in changes from HEAD
Overwrite wrongly applied ChangeLog
@
text
@a17 4
CFLAGS:=@@CFLAGS@@
override CXXFLAGS=@@CXXFLAGS@@
override CXXFLAGS+=-MMD -D__OUTSIDE_CYGWIN__ -DSYSCONFDIR="\"$(sysconfdir)\""

d41 3
@


1.24.2.3
log
@	* Makefile.in (cygserver.exe): Make cygwin_build a tooldir (-B instead
	of -L) to support bootstrapping.
@
text
@d74 1
a74 1
	$(CXX) -o $@@ ${wordlist 2,999,$^} -static -static-libgcc -B$(cygwin_build) -lntdll
@


1.23
log
@	* Makefile.in (CXXFLAGS): Allow override.
@
text
@d72 1
a72 1
	$(CXX) -o $@@ ${wordlist 2,999,$^} -static-libgcc -L$(cygwin_build) -lntdll
@


1.22
log
@Add DESTDIR functionality to Makefile.in's.
@
text
@d36 1
a36 1
CXXFLAGS:=@@CXXFLAGS@@
@


1.21
log
@* Makefile.in (CFLAGS): Look in cygwin's build directory for header files.
@
text
@d54 8
a61 8
	$(updir1)/mkinstalldirs $(sbindir)
	$(updir1)/mkinstalldirs $(bindir)
	$(updir1)/mkinstalldirs $(sysconfdir)/defaults/etc
	$(updir1)/mkinstalldirs $(prefix)/share/doc/Cygwin
	$(INSTALL_PROGRAM) cygserver.exe $(sbindir)/cygserver.exe
	$(INSTALL_PROGRAM) $(srcdir)/cygserver-config $(bindir)/cygserver-config
	$(INSTALL_DATA) $(srcdir)/cygserver.conf $(sysconfdir)/defaults/etc/cygserver.conf
	$(INSTALL_DATA) $(srcdir)/README $(prefix)/share/doc/Cygwin/cygserver.README
@


1.20
log
@	* Makefile.in (OBJS): Add setpwd.o.
	* README: Explain new service to store passwords in the LSA registry
	area.
	* bsd_helper.cc (get_token_info): Make externally available.
	* bsd_helper.h (get_token_info): Declare.
	* client.cc (client_request::handle_request): Add case for
	CYGSERVER_REQUEST_SETPWD request.
	* setpwd.cc: New file implementing the CYGSERVER_REQUEST_SETPWD
	request.
@
text
@d2 1
a2 1
# Copyright 2003, 2006, 2007 Red Hat, Inc.
d83 1
a83 1
	${filter-out -D__OUTSIDE_CYGWIN__, $(COMPILE_CXX)} -c -I$(updir)/cygwin -o $(@@D)/${basename $(@@F)}$o $<
@


1.19
log
@* Makefile.in: Use -static-libgcc when creating cygserver.exe.
@
text
@d44 1
a44 1
	sysv_msg.o sysv_sem.o sysv_shm.o
@


1.18
log
@	Remove dependency from Cygwin internal code.
	* Makefile.in (CYGWIN_OBJS): Remove smallprint.o.
	(cygserver.exe): Remove strfuncs.o
	(strfuncs.o): Drop rule.
	* bsd_log.cc (_vlog): Use snprintf/vsnprintf instead of
	__small_sprintf/__small_vsprintf.
	* sysv_sem.cc (seminit): Use sys_malloc instead of malloc.  Use
	snprintf instead of __small_sprintf.
	(semunload): Free the above allocated sema_mtx names here.
@
text
@a13 2
prefix:=@@prefix@@
exec_prefix:=@@exec_prefix@@
d15 6
a20 3
bindir:=@@bindir@@
sbindir:=@@sbindir@@
sysconfdir:=@@sysconfdir@@
d72 1
a72 1
	$(CXX) -o $@@ ${wordlist 2,999,$^} -L$(cygwin_build) -lntdll
d83 1
a83 1
	${filter-out -D__OUTSIDE_CYGWIN__, $(COMPILE_CXX)} -I$(updir)/cygwin -o $(@@D)/${basename $(@@F)}$o $<
@


1.17
log
@	* Makefile.in: Don't link strfuncs.o from the Cygwin build dir.
	Build it again with __OUTSIDE_CYGWIN__ defined.
@
text
@d46 1
a46 1
CYGWIN_OBJS:=$(cygwin_build)/smallprint.o $(cygwin_build)/version.o
d70 1
a70 1
cygserver.exe: $(CYGWIN_LIB) $(OBJS) $(CYGWIN_OBJS) strfuncs.o
a83 3
strfuncs.o: $(cygwin_source)/strfuncs.cc
	$(COMPILE_CXX) -I$(updir)/cygwin -o $(@@D)/$(*F)$o $<

@


1.16
log
@* Makefile.in: Add -lntdll to link line.
(CYGWIN_OBJS): Include strfuncs.o.
@
text
@d46 1
a46 1
CYGWIN_OBJS:=$(cygwin_build)/smallprint.o $(cygwin_build)/strfuncs.o $(cygwin_build)/version.o
d70 1
a70 1
cygserver.exe: $(CYGWIN_LIB) $(OBJS) $(CYGWIN_OBJS)
d84 3
@


1.15
log
@	* smallprint.c: New file.
	* Makefile.in (OBJS): Add smallprint.o.
	(CYGWIN_OBJS): Remove smallprint.o from Cygwin dir.
@
text
@d41 1
a41 1
	transport.o transport_pipes.o smallprint.o \
d46 1
a46 1
CYGWIN_OBJS:=$(cygwin_build)/version.o
d71 1
a71 1
	$(CXX) -o $@@ ${wordlist 2,999,$^} -L$(cygwin_build)
@


1.14
log
@	Throughout remove using wincap.
	* Makefile.in (OBJS): Remove wincap.o.
	* README: Don't mention 9x.
	* bsd_mutex.cc (_mtx_unlock): Drop checking for 9x error codes.
	* cygserver.cc (server_submission_loop::request_loop): Add FIXME
	comment.
	* wincap.cc: Remove.
	* wincap.h: Remove.
	* woutsup.h: Don't include wincap.h.
@
text
@d41 1
a41 1
	transport.o transport_pipes.o \
d46 1
a46 1
CYGWIN_OBJS:=$(cygwin_build)/smallprint.o $(cygwin_build)/version.o
@


1.13
log
@	* Makefile.in (OBJS): Drop transport_sockets.o.
	* sysv_shm.cc (shmget_allocate_segment): Remove spurious cast.
	* transport.cc: Don't include transport_sockets.h.
	(create_server_transport): Always create transport_layer_pipes.
	* transport_sockets.cc: Remove.
	* transport_sockets.h: Remove.
@
text
@d43 1
a43 1
	sysv_msg.o sysv_sem.o sysv_shm.o wincap.o
@


1.12
log
@	* wincap.cc: New file.
	* wincap.h: New file.
	* Makefile.in: Accomodate having our own wincap implementation now.
@
text
@d2 1
a2 1
# Copyright 2003, 2006 Red Hat, Inc.
d41 1
a41 1
	transport.o transport_pipes.o transport_sockets.o \
@


1.11
log
@* Makefile.in (CFLAGS, CXXFLAGS): Remove unneeded include.
(CYGWIN_LIB): Delete.
(cygserver.exe target): Add -L$(cygwin_build) to the link line to force linker
to use build tree version of the library.  Remove specific inclusion of
libcygwin.a from the link line.
@
text
@d2 1
a2 1
# Copyright 2003 Red Hat, Inc.
d43 1
a43 1
	sysv_msg.o sysv_sem.o sysv_shm.o
d46 1
a46 2
CYGWIN_OBJS:=$(cygwin_build)/smallprint.o $(cygwin_build)/version.o \
	$(cygwin_build)/wincap.o
@


1.10
log
@	* Makefile.in (CYGWIN_LIB): Variable pointing to libcygwin.a in
	the parallel cygwin dir.
	(cygserver.exe): Depend on and link against $CYGWIN_LIB.
@
text
@d34 2
a35 2
CFLAGS:=@@CFLAGS@@ -I$(cygwin_source)
CXXFLAGS:=@@CXXFLAGS@@ -I$(cygwin_source)
d71 2
a72 2
cygserver.exe: $(OBJS) $(CYGWIN_OBJS) $(CYGWIN_LIB)
	$(CXX) -o $@@ $^
@


1.9
log
@* Makefile.in (CXXFLAGS): Remove duplicate options handled in Makefile.common.
@
text
@d49 2
d71 1
a71 1
cygserver.exe: $(OBJS) $(CYGWIN_OBJS)
@


1.8
log
@	* Makefile.in (install): Explicitely create directories.  Install
	README to $(prefix)/share/doc/Cygwin.
	* README: New file.
@
text
@d36 1
a36 1
override CXXFLAGS+=-MMD -fno-exceptions -fno-rtti -DHAVE_DECL_GETOPT=0 -D__OUTSIDE_CYGWIN__ -DSYSCONFDIR="\"$(sysconfdir)\""
@


1.7
log
@	* Makefile.in (install): Install cygserver-config script to bindir.
	* cygserver-config: New script.
@
text
@d51 5
a55 1
install: all cygserver.conf cygserver-config
d57 1
a57 1
	$(INSTALL_PROGRAM) cygserver-config $(bindir)/cygserver-config
d59 1
@


1.6
log
@	Don't use safe_new but new throughout.  Fix copyright dates
	throughout.
	* Makefile.in: Accomodate all new files and name changes.
	Add a *.d dependency.
	(sbindir): Add.
	(etcdir): Drop in favor of more appropriate sysconfdir definition.
	(sysconfdir): Add.
	(CXXFLAGS): Add -MMD flag. Add SYSCONFDIR definition.
	(.SUFFIXES): Add.
	(install): Add action items.
	(libclean): New target.
	(fullclean): Ditto.
	* bsd_helper.cc: New file.
	* bsd_helper.h: Ditto.
	* bsd_log.cc: Ditto.
	* bsd_log.h: Ditto.
	* bsd_mutex.cc: Ditto.
	* bsd_mutex.h: Ditto.
	* client.cc: Rearrange to build as less as possible if
	__INSIDE_CYGWIN__.
	(client_request::handle_request): Add Message Queue and Semaphore
	handling.
	* cygserver.cc: Rearrange to build as less as possible if
	__INSIDE_CYGWIN__. Use new debug/log/panic logging functions.
	(DEF_CONFIG_FILE): New definition for configuration file.  Use
	throughout.
	(getfunc): Remove.
	(__cygserver__printf): Remove.
	(client_request_attach_tty::serve): Return error if impersonation
	fails.
	(print_usage): Pump up help message.
	(print_version): Add output of default configuration file.
	(main): Accommodate new options.  Allow overwrite of threading options
	from config file.  Call several new initialization functions.  Drop
	printing dots.  Don't define SIGHANDLE inline.
	* cygserver.conf: New file.
	* cygserver_process.h: Rename to process.h.
	* cygserver_transport.h: Rename to transport.h.
	* cygserver_transport_pipes.h: Rename to transport_pipes.h.
	* cygserver_transport_sockets.h: Rename to transport_sockets.h.
	* msg.cc: Rewrite.
	* sem.cc: Rewrite.
	* shm.cc: Rewrite.
	* sysv_msg.cc: New file, derived from FreeBSD version 1.52.
	* sysv_sem.cc: New file, derived from FreeBSD version 1.66.
	* sysv_shm.cc: New file, derived from FreeBSD version 1.89.
	* threaded_queue.cc: Rearrange to build as less as possible if
	__INSIDE_CYGWIN__.
	* transport.cc (transport_layer_base::impersonate_client): Define bool.
	(transport_layer_base::revert_to_self): Ditto.
	* transport.h (transport_layer_base::impersonate_client): Declare bool.
	(transport_layer_base::revert_to_self): Ditto.
	* transport_pipes.cc (transport_layer_pipes::transport_layer_pipes):
	Don't call init_security.
	(init_security): Remove.
	(transport_layer_pipes::accept): Use global sec_all_nih.
	(transport_layer_pipes::connect): Ditto.
	(transport_layer_pipes::impersonate_client): Define bool.
	(transport_layer_pipes::revert_to_self): Ditt.
	* transport_pipes.h (transport_layer_pipes::impersonate_client): Declare
	bool.
	(transport_layer_pipes::revert_to_self): Ditto.
	* woutsup.h: Include bsd compatibility headers.
	(SIGHANDLE): Add definition.
	(__cygserver__printf): Remove definition.
	(__noop_printf): Ditto.
	(debug_printf): Define using debug.
	(syscall_printf): Define using log.
	(system_printf): Ditto.
	Drop all other _printf definitions.
@
text
@d51 1
a51 1
install: all cygserver.conf
d53 2
a54 1
	$(INSTALL_DATA) $(srcdir)/cygserver.conf $(sysconfdir)/cygserver.conf
@


1.5
log
@	Accomodate moving cygserver header files from cygwin/include/cygwin
	to here and cygwin dir.
	* Makefile.in (EXEEXT): Drop as unused.
	(EXEEXT_FOR_BUILD): Ditto.
	(all): Don't build libcygserver.a.
	* cygserver_process.h: Moved from cygwin/include/cygwin to here.
	* cygserver_transport.h: Ditto.
	* cygserver_transport_pipes.h: Ditto.
	* cygserver_transport_sockets.h: Ditto.
	* ipc.h: Moved to ../cygwin and renamed to cygserver_ipc.h.
	* shm.h: Moved to ../cygwin and renamed to cygserver_shm.h.
@
text
@d18 2
a19 1
etcdir:=$(exec_prefix)/etc
d32 2
d36 1
a36 1
override CXXFLAGS+=-fno-exceptions -fno-rtti -DHAVE_DECL_GETOPT=0 -D__OUTSIDE_CYGWIN__
d38 1
a38 1
include $(srcdir)/../Makefile.common
d41 3
a43 1
	transport.o transport_pipes.o transport_sockets.o
d51 3
a53 1
install: all
d56 6
a61 1
	rm -f $(OBJS)
d79 5
@


1.4
log
@* msg.cc: New file.
* sem.cc: Ditto.
@
text
@a24 3
EXEEXT:=@@EXEEXT@@
EXEEXT_FOR_BUILD:=@@EXEEXT_FOR_BUILD@@

d44 1
a44 1
all: cygserver.exe libcygserver.a
@


1.3
log
@* Makefile.in: Build libcygserver.a.
* client.cc: Rename allow_daemon to allow_server.
@
text
@d40 2
a41 2
OBJS:=	cygserver.o client.o process.o shm.o threaded_queue.o transport.o \
	transport_pipes.o transport_sockets.o
@


1.2
log
@* Makefile.in (OBJS): Move some more files from cygwin directory.
* woutsup.h: Define _MT_SAFE.
@
text
@d32 1
d42 1
d47 1
a47 1
all: cygserver.exe
d64 6
@


1.1
log
@First checkins.
@
text
@d35 1
a35 1
override CXXFLAGS+=-fno-exceptions -fno-rtti -DHAVE_DECL_GETOPT=0
d39 2
a40 2
OBJS:=	cygserver.o client.o process.o shm.o transport.o transport_pipes.o \
	transport_sockets.o
d49 3
d53 9
a61 1
	$(CXX) -o $@@ $^ -lstdc++
@

