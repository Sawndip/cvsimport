head	1.5;
access;
symbols
	sid-snapshot-20180601:1.5
	sid-snapshot-20180501:1.5
	sid-snapshot-20180401:1.5
	sid-snapshot-20180301:1.5
	sid-snapshot-20180201:1.5
	sid-snapshot-20180101:1.5
	sid-snapshot-20171201:1.5
	sid-snapshot-20171101:1.5
	sid-snapshot-20171001:1.5
	sid-snapshot-20170901:1.5
	sid-snapshot-20170801:1.5
	sid-snapshot-20170701:1.5
	sid-snapshot-20170601:1.5
	sid-snapshot-20170501:1.5
	sid-snapshot-20170401:1.5
	sid-snapshot-20170301:1.5
	sid-snapshot-20170201:1.5
	sid-snapshot-20170101:1.5
	sid-snapshot-20161201:1.5
	sid-snapshot-20161101:1.5
	sid-snapshot-20160901:1.5
	sid-snapshot-20160801:1.5
	sid-snapshot-20160701:1.5
	sid-snapshot-20160601:1.5
	sid-snapshot-20160501:1.5
	sid-snapshot-20160401:1.5
	sid-snapshot-20160301:1.5
	sid-snapshot-20160201:1.5
	sid-snapshot-20160101:1.5
	sid-snapshot-20151201:1.5
	sid-snapshot-20151101:1.5
	sid-snapshot-20151001:1.5
	sid-snapshot-20150901:1.5
	sid-snapshot-20150801:1.5
	sid-snapshot-20150701:1.5
	sid-snapshot-20150601:1.5
	sid-snapshot-20150501:1.5
	sid-snapshot-20150401:1.5
	sid-snapshot-20150301:1.5
	sid-snapshot-20150201:1.5
	sid-snapshot-20150101:1.5
	sid-snapshot-20141201:1.5
	sid-snapshot-20141101:1.5
	sid-snapshot-20141001:1.5
	sid-snapshot-20140901:1.5
	sid-snapshot-20140801:1.5
	sid-snapshot-20140701:1.5
	sid-snapshot-20140601:1.5
	sid-snapshot-20140501:1.5
	sid-snapshot-20140401:1.5
	sid-snapshot-20140301:1.5
	sid-snapshot-20140201:1.5
	sid-snapshot-20140101:1.5
	sid-snapshot-20131201:1.5
	sid-snapshot-20131101:1.5
	sid-snapshot-20131001:1.5
	sid-snapshot-20130901:1.5
	sid-snapshot-20130801:1.5
	sid-snapshot-20130701:1.5
	sid-snapshot-20130601:1.5
	insight_7_6-2013-04-10-branchpoint:1.5
	gdb_7_6-branch:1.5.0.28
	sid-snapshot-20130501:1.5
	sid-snapshot-20130401:1.5
	sid-snapshot-20130301:1.5
	sid-snapshot-20130201:1.5
	sid-snapshot-20130101:1.5
	sid-snapshot-20121201:1.5
	sid-snapshot-20121101:1.5
	sid-snapshot-20121001:1.5
	sid-snapshot-20120901:1.5
	gdb_7_5-branch:1.5.0.26
	sid-snapshot-20120801:1.5
	sid-snapshot-20120701:1.5
	sid-snapshot-20120601:1.5
	sid-snapshot-20120501:1.5
	sid-snapshot-20120401:1.5
	gdb_7_4-branch:1.5.0.24
	sid-snapshot-20120301:1.5
	sid-snapshot-20120201:1.5
	sid-snapshot-20120101:1.5
	sid-snapshot-20111201:1.5
	sid-snapshot-20111101:1.5
	sid-snapshot-20111001:1.5
	sid-snapshot-20110901:1.5
	gdb_7_3-branch:1.5.0.22
	sid-snapshot-20110801:1.5
	sid-snapshot-20110701:1.5
	sid-snapshot-20110601:1.5
	sid-snapshot-20110501:1.5
	sid-snapshot-20110401:1.5
	sid-snapshot-20110301:1.5
	sid-snapshot-20110201:1.5
	sid-snapshot-20110101:1.5
	sid-snapshot-20101201:1.5
	sid-snapshot-20101101:1.5
	sid-snapshot-20101001:1.5
	sid-snapshot-20100901:1.5
	sid-snapshot-20100801:1.5
	sid-snapshot-20100701:1.5
	sid-snapshot-20100601:1.5
	sid-snapshot-20100501:1.5
	sid-snapshot-20100401:1.5
	sid-snapshot-20100301:1.5
	gdb_7_1-branch:1.5.0.20
	gdb_7_0-branch:1.5.0.18
	sid-snapshot-20100201:1.5
	sid-snapshot-20100101:1.5
	sid-snapshot-20091201:1.5
	sid-snapshot-20091101:1.5
	sid-snapshot-20091001:1.5
	arc-sim-20090309:1.5
	sid-snapshot-20090901:1.5
	sid-snapshot-20090801:1.5
	sid-snapshot-20090701:1.5
	sid-snapshot-20090601:1.5
	sid-snapshot-20090501:1.5
	kevinb-pre-tk8_5_7_merge:1.5
	sid-snapshot-20090401:1.5
	arc-insight_6_8-branch:1.5.0.16
	arc-insight_6_8-branchpoint:1.5
	insight_6_8-branch:1.5.0.14
	insight_6_8-branchpoint:1.5
	sid-snapshot-20090301:1.5
	sid-snapshot-20090201:1.5
	sid-snapshot-20090101:1.5
	sid-snapshot-20081201:1.5
	sid-snapshot-20081101:1.5
	sid-snapshot-20081001:1.5
	sid-snapshot-20080901:1.5
	sid-snapshot-20080801:1.5
	sid-snapshot-20080701:1.5
	sid-snapshot-20080601:1.5
	sid-snapshot-20080501:1.5
	sid-snapshot-20080403:1.5
	sid-snapshot-20080401:1.5
	gdb_6_8-branch:1.5.0.12
	sid-snapshot-20080301:1.5
	sid-snapshot-20080201:1.5
	sid-snapshot-20080101:1.5
	sid-snapshot-20071201:1.5
	sid-snapshot-20071101:1.5
	sid-snapshot-20071001:1.5
	insight_6_6-20070208-release:1.5
	gdb_6_6-branch:1.5.0.10
	gdb_6_6-2006-11-15-branchpoint:1.5
	insight_6_5-20061003-release:1.5
	gdb_6_5-branch:1.5.0.8
	gdb_6_5-2006-05-14-branchpoint:1.5
	gdb_6_4-branch:1.5.0.6
	gdb_6_4-2005-11-01-branchpoint:1.5
	gdb_6_1-2004-04-05-release:1.5
	gdb_6_1-branch:1.5.0.4
	gdb_6_1-2004-03-01-gmt-branchpoint:1.5
	gdb_6_0-2003-10-04-release:1.5
	gdb_6_0-branch:1.5.0.2
	gdb_6_0-2003-06-23-branchpoint:1.5
	TK8_4_1:1.1.1.3
	gdb_5_3-2002-12-12-release:1.2
	tcltk840-20020924-branch:1.3.0.2
	tcltk840-20020924-branchpoint:1.3
	TK_8_4_0:1.1.1.3
	sid-20020905-branchpoint:1.2
	sid-20020905-branch:1.2.0.6
	gdb_5_3-branch:1.2.0.4
	gdb_5_3-2002-09-04-branchpoint:1.2
	gdb_5_2_1-2002-07-23-release:1.2
	gdb_5_2-2002-04-29-release:1.2
	gdb_5_2-branch:1.2.0.2
	gdb_5_2-2002-03-03-branchpoint:1.2
	gdb_5_1_1-2002-01-24-release:1.1.1.1
	cygnus_cvs_20020108_pre:1.2
	gdb_5_1_0_1-2002-01-03-branch:1.1.1.1.0.8
	gdb_5_1_0_1-2002-01-03-branchpoint:1.1.1.1
	gdb_5_1-2001-11-21-release:1.1.1.1
	gdb_s390-2001-09-26-branch:1.1.1.1.0.6
	gdb_s390-2001-09-26-branchpoint:1.1.1.1
	TK_8_3:1.1.1.2
	NET:1.1.1
	gdb_5_1-2001-07-29-branch:1.1.1.1.0.4
	gdb_5_1-2001-07-29-branchpoint:1.1.1.1
	insight-precleanup-2001-01-01:1.1.1.1
	gdb_5_0-2000-05-19-release:1.1.1.1
	gdb_4_18_2-2000-05-18-release:1.1.1.1
	gdb_4_95_1-2000-05-11-snapshot:1.1.1.1
	gdb_4_95_0-2000-04-27-snapshot:1.1.1.1
	gdb_5_0-2000-04-10-branch:1.1.1.1.0.2
	gdb_5_0-2000-04-10-branchpoint:1.1.1.1
	repo-unification-2000-02-06:1.1.1.1
	insight-2000-02-04:1.1.1.1
	SNAPSHOT:1.1.1;
locks; strict;
comment	@# @;
expand	@o@;


1.5
date	2003.01.21.20.24.50;	author hunt;	state Exp;
branches;
next	1.4;

1.4
date	2003.01.21.19.53.16;	author hunt;	state Exp;
branches;
next	1.3;

1.3
date	2002.09.24.18.39.28;	author kseitz;	state Exp;
branches;
next	1.2;

1.2
date	2001.09.10.01.16.53;	author irox;	state Exp;
branches;
next	1.1;

1.1
date	2000.02.07.00.19.30;	author jsm;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2000.02.07.00.19.30;	author jsm;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2001.09.10.00.22.36;	author irox;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2002.09.24.20.39.05;	author kseitz;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Updated to tk 8.4.1
@
text
@# This file is a Tcl script to test out the procedures in tkCanvas.c,
# which implements generic code for canvases.  It is organized in the
# standard fashion for Tcl tests.
#
# Copyright (c) 1995-1996 Sun Microsystems, Inc.
# Copyright (c) 1998-2000 Ajuba Solutions.
# All rights reserved.
#
# RCS: @@(#) $Id: canvas.test,v 1.15 2002/07/24 19:41:38 hobbs Exp $

package require tcltest 2.1
namespace import -force tcltest::configure
namespace import -force tcltest::testsDirectory
configure -testdir [file join [pwd] [file dirname [info script]]]
configure -loadfile [file join [testsDirectory] constraints.tcl]
tcltest::loadTestedCommands

# XXX - This test file is woefully incomplete.  At present, only a
# few of the features are tested.

canvas .c
pack .c
update
set i 1
foreach test {
    {-background #ff0000 #ff0000 non-existent
	    {unknown color name "non-existent"}}
    {-bg #ff0000 #ff0000 non-existent {unknown color name "non-existent"}}
    {-bd 4 4 badValue {bad screen distance "badValue"}}
    {-borderwidth 1.3 1 badValue {bad screen distance "badValue"}}
    {-closeenough 24 24.0 bogus {expected floating-point number but got "bogus"}}
    {-confine true 1 silly {expected boolean value but got "silly"}}
    {-cursor arrow arrow badValue {bad cursor spec "badValue"}}
    {-height 2.1 2 x42 {bad screen distance "x42"}}
    {-highlightbackground #112233 #112233 ugly {unknown color name "ugly"}}
    {-highlightcolor #110022 #110022 bogus {unknown color name "bogus"}}
    {-highlightthickness 18 18 badValue {bad screen distance "badValue"}}
    {-insertbackground #110022 #110022 bogus {unknown color name "bogus"}}
    {-insertborderwidth 1.3 1 2.6x {bad screen distance "2.6x"}}
    {-insertofftime 100 100 3.2 {expected integer but got "3.2"}}
    {-insertontime 100 100 3.2 {expected integer but got "3.2"}}
    {-insertwidth 1.3 1 6x {bad screen distance "6x"}}
    {-relief groove groove 1.5 {bad relief type "1.5": must be flat, groove, raised, ridge, solid, or sunken}}
    {-selectbackground #110022 #110022 bogus {unknown color name "bogus"}}
    {-selectborderwidth 1.3 1 badValue {bad screen distance "badValue"}}
    {-selectforeground #654321 #654321 bogus {unknown color name "bogus"}}
    {-takefocus "any string" "any string" {} {}}
    {-width 402 402 xyz {bad screen distance "xyz"}}
    {-xscrollcommand {Some command} {Some command} {} {}}
    {-yscrollcommand {Another command} {Another command} {} {}}
} {
    set name [lindex $test 0]
    test canvas-1.$i {configuration options} {
	.c configure $name [lindex $test 1]
	lindex [.c configure $name] 4
    } [lindex $test 2]
    incr i
    if {[lindex $test 3] != ""} {
	test canvas-1.$i {configuration options} {
	    list [catch {.c configure $name [lindex $test 3]} msg] $msg
	} [list 1 [lindex $test 4]]
    }
    .c configure $name [lindex [.c configure $name] 3]
    incr i
}

test canvas-1.40 {configure throws error on bad option} {
    set res [list [catch {.c configure -gorp foo}]]
    .c create rect 10 10 100 100
    lappend res [catch {.c configure -gorp foo}]
    set res
} [list 1 1]


catch {destroy .c}
canvas .c -width 60 -height 40 -scrollregion {0 0 200 150} -bd 0 \
	-highlightthickness 0
pack .c
update

test canvas-2.1 {CanvasWidgetCmd, bind option} {
    set i [.c create rect 10 10 100 100]
    list [catch {.c bind $i <a>} msg] $msg
} {0 {}}
test canvas-2.2 {CanvasWidgetCmd, bind option} {
    set i [.c create rect 10 10 100 100]
    list [catch {.c bind $i <} msg] $msg
} {1 {no event type or button # or keysym}}
test canvas-2.3 {CanvasWidgetCmd, xview option} {
    .c configure -xscrollincrement 40 -yscrollincrement 5
    .c xview moveto 0
    update
    set x [list [.c xview]]
    .c xview scroll 2 units
    update
    lappend x [.c xview]
} {{0 0.3} {0.4 0.7}}
test canvas-2.4 {CanvasWidgetCmd, xview option} {nonPortable} {
    # This test gives slightly different results on platforms such
    # as NetBSD.  I don't know why...
    .c configure -xscrollincrement 0 -yscrollincrement 5
    .c xview moveto 0.6
    update
    set x [list [.c xview]]
    .c xview scroll 2 units
    update
    lappend x [.c xview]
} {{0.6 0.9} {0.66 0.96}}

catch {destroy .c}
canvas .c -width 60 -height 40 -scrollregion {0 0 200 80} \
	-borderwidth 0 -highlightthickness 0
pack .c
update
test canvas-3.1 {CanvasWidgetCmd, yview option} {
    .c configure -xscrollincrement 40 -yscrollincrement 5
    .c yview moveto 0
    update
    set x [list [.c yview]]
    .c yview scroll 3 units
    update
    lappend x [.c yview]
} {{0 0.5} {0.1875 0.6875}}
test canvas-3.2 {CanvasWidgetCmd, yview option} {
    .c configure -xscrollincrement 40 -yscrollincrement 0
    .c yview moveto 0
    update
    set x [list [.c yview]]
    .c yview scroll 2 units
    update
    lappend x [.c yview]
} {{0 0.5} {0.1 0.6}}

test canvas-4.1 {ButtonEventProc procedure} {
    deleteWindows
    canvas .c1 -bg #543210
    rename .c1 .c2
    set x {}
    lappend x [winfo children .]
    lappend x [.c2 cget -bg]
    destroy .c1
    lappend x [info command .c*] [winfo children .]
} {.c1 #543210 {} {}}

test canvas-5.1 {ButtonCmdDeletedProc procedure} {
    deleteWindows
    canvas .c1
    rename .c1 {}
    list [info command .c*] [winfo children .]
} {{} {}}

catch {destroy .c}
canvas .c -width 100 -height 50 -scrollregion {-200 -100 305 102} \
	-borderwidth 2 -highlightthickness 3
pack .c
update
test canvas-6.1 {CanvasSetOrigin procedure} {
    .c configure -xscrollincrement 0 -yscrollincrement 0
    .c xview moveto 0
    .c yview moveto 0
    update
    list [.c canvasx 0] [.c canvasy 0]
} {-205.0 -105.0}
test canvas-6.2 {CanvasSetOrigin procedure} {
    .c configure -xscrollincrement 20 -yscrollincrement 10
    set x ""
    foreach i {.08 .10 .48 .50} {
	.c xview moveto $i
	update
	lappend x [.c canvasx 0]
    }
    set x
} {-165.0 -145.0 35.0 55.0}
test canvas-6.3 {CanvasSetOrigin procedure} {
    .c configure -xscrollincrement 20 -yscrollincrement 10
    set x ""
    foreach i {.06 .08 .70 .72} {
	.c yview moveto $i
	update
	lappend x [.c canvasy 0]
    }
    set x
} {-95.0 -85.0 35.0 45.0}
test canvas-6.4 {CanvasSetOrigin procedure} {
    .c configure -xscrollincrement 20 -yscrollincrement 10
    .c xview moveto 1.0
    .c canvasx 0
} {215.0}
test canvas-6.5 {CanvasSetOrigin procedure} {
    .c configure -xscrollincrement 20 -yscrollincrement 10
    .c yview moveto 1.0
    .c canvasy 0
} {55.0}

set l [interp hidden]
deleteWindows

test canvas-7.1 {canvas widget vs hidden commands} {
    catch {destroy .c}
    canvas .c
    interp hide {} .c
    destroy .c
    list [winfo children .] [interp hidden]
} [list {} $l]

test canvas-8.1 {canvas arc bbox} {
    catch {destroy .c}
    canvas .c
    .c create arc -100 10 100 210 -start 10 -extent 50 -style arc -tags arc1
    set arcBox [.c bbox arc1]
    .c create arc 100 10 300 210 -start 10 -extent 50 -style chord -tags arc2
    set coordBox [.c bbox arc2]
    .c create arc 300 10 500 210 -start 10 -extent 50 -style pieslice -tags arc3
    set pieBox [.c bbox arc3]
    list $arcBox $coordBox $pieBox
} {{48 21 100 94} {248 21 300 94} {398 21 500 112}}
test canvas-9.1 {canvas id creation and deletion} {
    # With Tk 8.0.4 the ids are now stored in a hash table.  You
    # can use this test as a performance test with older versions
    # by changing the value of size.
    set size 15

    catch {destroy .c}
    set c [canvas .c]
    for {set i 0} {$i < $size} {incr i} {
	set x [expr {-10 + 3*$i}]
	for {set j 0; set y -10} {$j < 10} {incr j; incr y 3} {
	    $c create rect ${x}c ${y}c [expr $x+2]c [expr $y+2]c \
		    -outline black -fill blue -tags rect
	    $c create text [expr $x+1]c [expr $y+1]c -text "$i,$j" \
		    -anchor center -tags text
	}
    }

    # The actual bench mark - this code also exercises all the hash
    # table changes.

    set time [lindex [time {
	foreach id [$c find withtag all] {
	    $c lower $id
	    $c raise $id
	    $c find withtag $id
	    $c bind <Return> $id {}
	    $c delete $id
	}
    }] 0]
	
    set x ""
} {}
test canvas-10.1 {find items using tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 60 40 80 -fill yellow -tag [list b a]
      .c create oval 20 100 40 120 -fill green -tag [list c b]
      .c create oval 20 140 40 160 -fill blue -tag [list b]
      .c create oval 20 180 40 200 -fill bisque -tag [list a d e]
      .c create oval 20 220 40 240 -fill bisque -tag b
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      set res {}
      lappend res [.c find withtag {!a}]
      lappend res [.c find withtag {b&&c}]
      lappend res [.c find withtag {b||c}]
      lappend res [.c find withtag {a&&!b}]
      lappend res [.c find withtag {!b&&!c}]
      lappend res [.c find withtag {d&&a&&c&&b}]
      lappend res [.c find withtag {b^a}]
      lappend res [.c find withtag {(a&&!b)||(!a&&b)}]
      lappend res [.c find withtag { ( a && ! b ) || ( ! a && b ) }]
      lappend res [.c find withtag {a&&!(c||d)}]
      lappend res [.c find withtag {d&&"tag with spaces"}]
      lappend res [.c find withtag "tag with spaces"]
} {{3 4 6 7} {1 3} {1 2 3 4 6} 5 {5 7} 1 {3 4 5 6} {3 4 5 6} {3 4 5 6} 2 7 7}
test canvas-10.2 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {&&c}} err
      set err
} {Unexpected operator in tag search expression}
test canvas-10.3 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {!!c}} err
      set err
} {Too many '!' in tag search expression}
test canvas-10.4 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {b||}} err
      set err
} {Missing tag in tag search expression}
test canvas-10.5 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {b&&(c||)}} err
      set err
} {Unexpected operator in tag search expression}
test canvas-10.6 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {d&&""}} err
      set err
} {Null quoted tag string in tag search expression}
test canvas-10.7 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag "d&&\"tag with spaces"} err
      set err
} {Missing endquote in tag search expression}
test canvas-10.8 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {a&&"tag with spaces"z}} err
      set err
} {Invalid boolean operator in tag search expression}
test canvas-10.9 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {a&&b&c}} err
      set err
} {Singleton '&' in tag search expression}
test canvas-10.10 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {a||b|c}} err
      set err
} {Singleton '|' in tag search expression}
test canvas-10.11 {backward compatility - strange tags that are not expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list { strange tag(xxx&yyy|zzz) " && \" || ! ^ " }]
      .c find withtag { strange tag(xxx&yyy|zzz) " && \" || ! ^ " }
} {1}
test canvas-10.12 {multple events bound to same tag expr} {
      catch {destroy .c}
      canvas .c
      .c bind {a && b} <Enter> {puts Enter}
      .c bind {a && b} <Leave> {puts Leave}
} {}

test canvas-11.1 {canvas poly fill check, bug 5783} {
    # This would crash in 8.3.0 and 8.3.1
    destroy .c
    pack [canvas .c]
    .c create polygon 0 0 100 100 200 50 \
	    -fill {} -stipple gray50 -outline black
} 1
test canvas-11.2 {canvas poly overlap fill check, bug 226357} {
    destroy .c
    pack [canvas .c]
    set result {}
    .c create poly 30 30 90 90 30 90 90 30
    lappend result [.c find over 40 40 45 45]; # rect region inc. edge
    lappend result [.c find over 60 40 60 40]; # top-center point
    lappend result [.c find over 0 0 0 0]; # not on poly
    lappend result [.c find over 60 60 60 60]; # center-point
    lappend result [.c find over 45 50 45 50]; # outside poly
    .c itemconfig 1 -fill "" -outline black
    lappend result [.c find over 40 40 45 45]; # rect region inc. edge
    lappend result [.c find over 60 40 60 40]; # top-center point
    lappend result [.c find over 0 0 0 0]; # not on poly
    lappend result [.c find over 60 60 60 60]; # center-point
    lappend result [.c find over 45 50 45 50]; # outside poly
    .c itemconfig 1 -width 8
    lappend result [.c find over 45 50 45 50]; # outside poly
} {1 1 {} 1 {} 1 1 {} 1 {} 1}

test canvas-12.1 {canvas mm obj, patch SF-403327, 102471} {
    destroy .c
    pack [canvas .c]
    set qx [expr {1.+1.}] 
    # qx has type double and no string representation 
    .c scale all $qx 0 1. 1.
    # qx has now type MMRep and no string representation 
    list $qx [string length $qx]
} {2.0 3}
test canvas-12.2 {canvas mm obj, patch SF-403327, 102471} {
    destroy .c
    pack [canvas .c]
    set val 10
    incr val
    # qx has type double and no string representation 
    .c scale all $val 0 1 1
    # qx has now type MMRep and no string representation 
    incr val
} {12}

proc kill_canvas {w} {
    destroy $w
    pack [canvas $w -height 200 -width 200] -fill both -expand yes
    update idle
    $w create rectangle 80 80 120 120 -fill blue -tags blue
    # bind a button press to re-build the canvas
    $w bind blue <ButtonRelease-1> [subst {
	[lindex [info level 0] 0] $w
	append ::x ok
    }
    ]
}

test canvas-13.1 {canvas delete during event, SF bug-228024} {
    kill_canvas .c
    set ::x {}
    # do this many times to improve chances of triggering the crash
    for {set i 0} {$i < 30} {incr i} {
	event generate .c <1> -x 100 -y 100
	event generate .c <ButtonRelease-1> -x 100 -y 100
    }
    set ::x
} okokokokokokokokokokokokokokokokokokokokokokokokokokokokokok

test canvas-14.1 {canvas scan SF bug 581560} {
    destroy .c; canvas .c
    list [catch {.c scan} msg] $msg
} {1 {wrong # args: should be ".c scan mark|dragto x y ?dragGain?"}}
test canvas-14.2 {canvas scan} {
    destroy .c; canvas .c
    list [catch {.c scan bogus} msg] $msg
} {1 {wrong # args: should be ".c scan mark|dragto x y ?dragGain?"}}
test canvas-14.3 {canvas scan} {
    destroy .c; canvas .c
    list [catch {.c scan mark} msg] $msg
} {1 {wrong # args: should be ".c scan mark|dragto x y ?dragGain?"}}
test canvas-14.4 {canvas scan} {
    destroy .c; canvas .c
    list [catch {.c scan mark 10 10} msg] $msg
} {0 {}}
test canvas-14.5 {canvas scan} {
    destroy .c; canvas .c
    list [catch {.c scan mark 10 10 5} msg] $msg
} {1 {wrong # args: should be ".c scan mark x y"}}
test canvas-14.6 {canvas scan} {
    destroy .c; canvas .c
    list [catch {.c scan dragto 10 10 5} msg] $msg
} {0 {}}

destroy .c

# cleanup
::tcltest::cleanupTests
return
@


1.4
log
@touched all sources to ease next import
@
text
@d9 1
a9 1
# RCS: @@(#) $Id: canvas.test,v 1.7.6.2 2000/09/26 16:09:09 spolk Exp $
d11 6
a16 9
if {[lsearch [namespace children] ::tcltest] == -1} {
    source [file join [pwd] [file dirname [info script]] defs.tcl]
}

foreach i [winfo children .] {
    destroy $i
}
wm geometry . {}
raise .
d135 1
a135 1
    eval destroy [winfo children .]
d146 1
a146 1
    eval destroy [winfo children .]
d196 1
a196 1
eval destroy [winfo children .]
d366 90
a459 1

@


1.3
log
@touched all sources to ease next import
@
text
@@


1.2
log
@touched all tk files to ease next import
@
text
@@


1.1
log
@Initial revision
@
text
@d6 2
a7 1
# Copyright (c) 1998 by Scriptics Corporation.
d9 1
a9 4
# See the file "license.terms" for information on usage and redistribution
# of this file, and for a DISCLAIMER OF ALL WARRANTIES.
#
# RCS: @@(#) $Id: canvas.test,v 1.9 1999/01/26 04:11:34 jingham Exp $
d11 2
a12 2
if {[info procs test] != "test"} {
    source defs
d70 7
d83 10
a92 1
test canvas-2.1 {CanvasWidgetCmd, xview option} {
d101 1
a101 1
test canvas-2.2 {CanvasWidgetCmd, xview option} {nonPortable} {
d253 121
@


1.1.1.1
log
@import insight-2000-02-04 snapshot (2nd try)
@
text
@@


1.1.1.2
log
@Tk 8.3 upgrade
@
text
@d6 1
a6 2
# Copyright (c) 1998-2000 Ajuba Solutions.
# All rights reserved.
d8 4
a11 1
# RCS: @@(#) $Id: canvas.test,v 1.7.6.2 2000/09/26 16:09:09 spolk Exp $
d13 2
a14 2
if {[lsearch [namespace children] ::tcltest] == -1} {
    source [file join [pwd] [file dirname [info script]] defs.tcl]
a71 7
test canvas-1.40 {configure throws error on bad option} {
    set res [list [catch {.c configure -gorp foo}]]
    .c create rect 10 10 100 100
    lappend res [catch {.c configure -gorp foo}]
    set res
} [list 1 1]

d78 1
a78 10

test canvas-2.1 {CanvasWidgetCmd, bind option} {
    set i [.c create rect 10 10 100 100]
    list [catch {.c bind $i <a>} msg] $msg
} {0 {}}
test canvas-2.2 {CanvasWidgetCmd, bind option} {
    set i [.c create rect 10 10 100 100]
    list [catch {.c bind $i <} msg] $msg
} {1 {no event type or button # or keysym}}
test canvas-2.3 {CanvasWidgetCmd, xview option} {
d87 1
a87 1
test canvas-2.4 {CanvasWidgetCmd, xview option} {nonPortable} {
a238 121
test canvas-10.1 {find items using tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 60 40 80 -fill yellow -tag [list b a]
      .c create oval 20 100 40 120 -fill green -tag [list c b]
      .c create oval 20 140 40 160 -fill blue -tag [list b]
      .c create oval 20 180 40 200 -fill bisque -tag [list a d e]
      .c create oval 20 220 40 240 -fill bisque -tag b
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      set res {}
      lappend res [.c find withtag {!a}]
      lappend res [.c find withtag {b&&c}]
      lappend res [.c find withtag {b||c}]
      lappend res [.c find withtag {a&&!b}]
      lappend res [.c find withtag {!b&&!c}]
      lappend res [.c find withtag {d&&a&&c&&b}]
      lappend res [.c find withtag {b^a}]
      lappend res [.c find withtag {(a&&!b)||(!a&&b)}]
      lappend res [.c find withtag { ( a && ! b ) || ( ! a && b ) }]
      lappend res [.c find withtag {a&&!(c||d)}]
      lappend res [.c find withtag {d&&"tag with spaces"}]
      lappend res [.c find withtag "tag with spaces"]
} {{3 4 6 7} {1 3} {1 2 3 4 6} 5 {5 7} 1 {3 4 5 6} {3 4 5 6} {3 4 5 6} 2 7 7}
test canvas-10.2 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {&&c}} err
      set err
} {Unexpected operator in tag search expression}
test canvas-10.3 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {!!c}} err
      set err
} {Too many '!' in tag search expression}
test canvas-10.4 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {b||}} err
      set err
} {Missing tag in tag search expression}
test canvas-10.5 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {b&&(c||)}} err
      set err
} {Unexpected operator in tag search expression}
test canvas-10.6 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {d&&""}} err
      set err
} {Null quoted tag string in tag search expression}
test canvas-10.7 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag "d&&\"tag with spaces"} err
      set err
} {Missing endquote in tag search expression}
test canvas-10.8 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {a&&"tag with spaces"z}} err
      set err
} {Invalid boolean operator in tag search expression}
test canvas-10.9 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {a&&b&c}} err
      set err
} {Singleton '&' in tag search expression}
test canvas-10.10 {check errors from tag expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list a b c d]
      .c create oval 20 260 40 280 -fill bisque -tag [list d "tag with spaces"]
      catch {.c find withtag {a||b|c}} err
      set err
} {Singleton '|' in tag search expression}
test canvas-10.11 {backward compatility - strange tags that are not expressions} {
      catch {destroy .c}
      canvas .c
      .c create oval 20 20 40 40 -fill red -tag [list { strange tag(xxx&yyy|zzz) " && \" || ! ^ " }]
      .c find withtag { strange tag(xxx&yyy|zzz) " && \" || ! ^ " }
} {1}
test canvas-10.12 {multple events bound to same tag expr} {
      catch {destroy .c}
      canvas .c
      .c bind {a && b} <Enter> {puts Enter}
      .c bind {a && b} <Leave> {puts Leave}
} {}

test canvas-11.1 {canvas poly fill check, bug 5783} {
    # This would crash in 8.3.0 and 8.3.1
    destroy .c
    pack [canvas .c]
    .c create polygon 0 0 100 100 200 50 \
	    -fill {} -stipple gray50 -outline black
} 1

# cleanup
::tcltest::cleanupTests
return

@


1.1.1.3
log
@import tk 8.4.0
@
text
@d9 1
a9 1
# RCS: @@(#) $Id: canvas.test,v 1.15 2002/07/24 19:41:38 hobbs Exp $
d11 9
a19 6
package require tcltest 2.1
namespace import -force tcltest::configure
namespace import -force tcltest::testsDirectory
configure -testdir [file join [pwd] [file dirname [info script]]]
configure -loadfile [file join [testsDirectory] constraints.tcl]
tcltest::loadTestedCommands
d138 1
a138 1
    deleteWindows
d149 1
a149 1
    deleteWindows
d199 1
a199 1
deleteWindows
a368 90
test canvas-11.2 {canvas poly overlap fill check, bug 226357} {
    destroy .c
    pack [canvas .c]
    set result {}
    .c create poly 30 30 90 90 30 90 90 30
    lappend result [.c find over 40 40 45 45]; # rect region inc. edge
    lappend result [.c find over 60 40 60 40]; # top-center point
    lappend result [.c find over 0 0 0 0]; # not on poly
    lappend result [.c find over 60 60 60 60]; # center-point
    lappend result [.c find over 45 50 45 50]; # outside poly
    .c itemconfig 1 -fill "" -outline black
    lappend result [.c find over 40 40 45 45]; # rect region inc. edge
    lappend result [.c find over 60 40 60 40]; # top-center point
    lappend result [.c find over 0 0 0 0]; # not on poly
    lappend result [.c find over 60 60 60 60]; # center-point
    lappend result [.c find over 45 50 45 50]; # outside poly
    .c itemconfig 1 -width 8
    lappend result [.c find over 45 50 45 50]; # outside poly
} {1 1 {} 1 {} 1 1 {} 1 {} 1}

test canvas-12.1 {canvas mm obj, patch SF-403327, 102471} {
    destroy .c
    pack [canvas .c]
    set qx [expr {1.+1.}] 
    # qx has type double and no string representation 
    .c scale all $qx 0 1. 1.
    # qx has now type MMRep and no string representation 
    list $qx [string length $qx]
} {2.0 3}
test canvas-12.2 {canvas mm obj, patch SF-403327, 102471} {
    destroy .c
    pack [canvas .c]
    set val 10
    incr val
    # qx has type double and no string representation 
    .c scale all $val 0 1 1
    # qx has now type MMRep and no string representation 
    incr val
} {12}

proc kill_canvas {w} {
    destroy $w
    pack [canvas $w -height 200 -width 200] -fill both -expand yes
    update idle
    $w create rectangle 80 80 120 120 -fill blue -tags blue
    # bind a button press to re-build the canvas
    $w bind blue <ButtonRelease-1> [subst {
	[lindex [info level 0] 0] $w
	append ::x ok
    }
    ]
}

test canvas-13.1 {canvas delete during event, SF bug-228024} {
    kill_canvas .c
    set ::x {}
    # do this many times to improve chances of triggering the crash
    for {set i 0} {$i < 30} {incr i} {
	event generate .c <1> -x 100 -y 100
	event generate .c <ButtonRelease-1> -x 100 -y 100
    }
    set ::x
} okokokokokokokokokokokokokokokokokokokokokokokokokokokokokok

test canvas-14.1 {canvas scan SF bug 581560} {
    destroy .c; canvas .c
    list [catch {.c scan} msg] $msg
} {1 {wrong # args: should be ".c scan mark|dragto x y ?dragGain?"}}
test canvas-14.2 {canvas scan} {
    destroy .c; canvas .c
    list [catch {.c scan bogus} msg] $msg
} {1 {wrong # args: should be ".c scan mark|dragto x y ?dragGain?"}}
test canvas-14.3 {canvas scan} {
    destroy .c; canvas .c
    list [catch {.c scan mark} msg] $msg
} {1 {wrong # args: should be ".c scan mark|dragto x y ?dragGain?"}}
test canvas-14.4 {canvas scan} {
    destroy .c; canvas .c
    list [catch {.c scan mark 10 10} msg] $msg
} {0 {}}
test canvas-14.5 {canvas scan} {
    destroy .c; canvas .c
    list [catch {.c scan mark 10 10 5} msg] $msg
} {1 {wrong # args: should be ".c scan mark x y"}}
test canvas-14.6 {canvas scan} {
    destroy .c; canvas .c
    list [catch {.c scan dragto 10 10 5} msg] $msg
} {0 {}}

destroy .c
d373 1
@


