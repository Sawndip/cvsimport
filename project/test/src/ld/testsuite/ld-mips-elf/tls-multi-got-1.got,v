head	1.14;
access;
symbols
	binutils-2_24-branch:1.13.0.2
	binutils-2_24-branchpoint:1.13
	binutils-2_21_1:1.10
	binutils-2_23_2:1.10.18.1
	binutils-2_23_1:1.10.18.1
	binutils-2_23:1.10.18.1
	binutils-2_23-branch:1.10.0.18
	binutils-2_23-branchpoint:1.10
	binutils-2_22_branch:1.10.0.16
	binutils-2_22:1.10
	binutils-2_22-branch:1.10.0.14
	binutils-2_22-branchpoint:1.10
	binutils-2_21:1.10
	binutils-2_21-branch:1.10.0.12
	binutils-2_21-branchpoint:1.10
	binutils-2_20_1:1.10
	binutils-2_20:1.10
	binutils-arc-20081103-branch:1.10.0.10
	binutils-arc-20081103-branchpoint:1.10
	binutils-2_20-branch:1.10.0.8
	binutils-2_20-branchpoint:1.10
	dje-cgen-play1-branch:1.10.0.6
	dje-cgen-play1-branchpoint:1.10
	arc-20081103-branch:1.10.0.4
	arc-20081103-branchpoint:1.10
	binutils-2_19_1:1.10
	binutils-2_19:1.10
	binutils-2_19-branch:1.10.0.2
	binutils-2_19-branchpoint:1.10
	binutils-2_18:1.8
	binutils-2_18-branch:1.8.0.2
	binutils-2_18-branchpoint:1.8
	binutils-csl-coldfire-4_1-32:1.2
	binutils-csl-sourcerygxx-4_1-32:1.2
	binutils-csl-innovasic-fido-3_4_4-33:1.2
	binutils-csl-sourcerygxx-3_4_4-32:1.1
	binutils-csl-coldfire-4_1-30:1.2
	binutils-csl-sourcerygxx-4_1-30:1.2
	binutils-csl-coldfire-4_1-28:1.2
	binutils-csl-sourcerygxx-4_1-29:1.2
	binutils-csl-sourcerygxx-4_1-28:1.2
	binutils-csl-arm-2006q3-27:1.2
	binutils-csl-sourcerygxx-4_1-27:1.2
	binutils-csl-arm-2006q3-26:1.2
	binutils-csl-sourcerygxx-4_1-26:1.2
	binutils-csl-sourcerygxx-4_1-25:1.2
	binutils-csl-sourcerygxx-4_1-24:1.2
	binutils-csl-sourcerygxx-4_1-23:1.2
	binutils-csl-sourcerygxx-4_1-21:1.2
	binutils-csl-arm-2006q3-21:1.2
	binutils-csl-sourcerygxx-4_1-22:1.2
	binutils-csl-palmsource-arm-prelinker-1_0-1:1.2
	binutils-csl-sourcerygxx-4_1-20:1.2
	binutils-csl-arm-2006q3-19:1.2
	binutils-csl-sourcerygxx-4_1-19:1.2
	binutils-csl-sourcerygxx-4_1-18:1.2
	binutils-csl-renesas-4_1-9:1.2
	binutils-csl-sourcerygxx-3_4_4-25:1.1
	binutils-csl-renesas-4_1-8:1.2
	binutils-csl-renesas-4_1-7:1.2
	binutils-csl-renesas-4_1-6:1.2
	binutils-csl-sourcerygxx-4_1-17:1.2
	binutils-csl-sourcerygxx-4_1-14:1.2
	binutils-csl-sourcerygxx-4_1-15:1.2
	binutils-csl-sourcerygxx-4_1-13:1.2
	binutils-2_17:1.2
	binutils-csl-sourcerygxx-4_1-12:1.2
	binutils-csl-sourcerygxx-3_4_4-21:1.2
	binutils-csl-wrs-linux-3_4_4-24:1.1
	binutils-csl-wrs-linux-3_4_4-23:1.1
	binutils-csl-sourcerygxx-4_1-9:1.2
	binutils-csl-sourcerygxx-4_1-8:1.2
	binutils-csl-sourcerygxx-4_1-7:1.2
	binutils-csl-arm-2006q1-6:1.2
	binutils-csl-sourcerygxx-4_1-6:1.2
	binutils-csl-wrs-linux-3_4_4-22:1.1
	binutils-csl-coldfire-4_1-11:1.2
	binutils-csl-sourcerygxx-3_4_4-19:1.2
	binutils-csl-coldfire-4_1-10:1.2
	binutils-csl-sourcerygxx-4_1-5:1.2
	binutils-csl-sourcerygxx-4_1-4:1.2
	binutils-csl-wrs-linux-3_4_4-21:1.1
	binutils-csl-morpho-4_1-4:1.2
	binutils-csl-sourcerygxx-3_4_4-17:1.2
	binutils-csl-wrs-linux-3_4_4-20:1.1
	binutils-2_17-branch:1.2.0.4
	binutils-2_17-branchpoint:1.2
	binutils-csl-2_17-branch:1.2.0.2
	binutils-csl-2_17-branchpoint:1.2
	binutils-csl-gxxpro-3_4-branch:1.1.0.6
	binutils-csl-gxxpro-3_4-branchpoint:1.1
	binutils-2_16_1:1.1
	binutils-csl-arm-2005q1b:1.1
	binutils-2_16:1.1
	binutils-csl-arm-2005q1a:1.1
	binutils-csl-arm-2005q1-branch:1.1.0.4
	binutils-csl-arm-2005q1-branchpoint:1.1
	binutils-2_16-branch:1.1.0.2
	binutils-2_16-branchpoint:1.1
	binutils_latest_snapshot:1.14;
locks; strict;
comment	@# @;


1.14
date	2013.09.24.22.15.38;	author rsandifo;	state Exp;
branches;
next	1.13;

1.13
date	2013.02.11.18.06.09;	author rsandifo;	state Exp;
branches
	1.13.2.1;
next	1.12;

1.12
date	2013.02.11.17.46.02;	author rsandifo;	state Exp;
branches;
next	1.11;

1.11
date	2012.08.06.22.50.07;	author macro;	state Exp;
branches;
next	1.10;

1.10
date	2008.08.06.19.49.06;	author rsandifo;	state Exp;
branches
	1.10.18.1;
next	1.9;

1.9
date	2007.11.14.20.46.15;	author rsandifo;	state Exp;
branches;
next	1.8;

1.8
date	2006.10.20.07.58.17;	author rsandifo;	state Exp;
branches;
next	1.7;

1.7
date	2006.10.20.07.57.03;	author rsandifo;	state Exp;
branches;
next	1.6;

1.6
date	2006.10.19.13.47.10;	author rsandifo;	state Exp;
branches;
next	1.5;

1.5
date	2006.10.19.13.42.17;	author rsandifo;	state Exp;
branches;
next	1.4;

1.4
date	2006.10.17.13.41.48;	author amodra;	state Exp;
branches;
next	1.3;

1.3
date	2006.07.05.16.01.38;	author ths;	state Exp;
branches;
next	1.2;

1.2
date	2006.02.04.08.28.29;	author rsandifo;	state Exp;
branches;
next	1.1;

1.1
date	2005.03.02.21.22.57;	author drow;	state Exp;
branches;
next	;

1.13.2.1
date	2013.10.05.09.13.26;	author rsandifo;	state Exp;
branches;
next	;

1.10.18.1
date	2012.09.04.14.38.03;	author gingold;	state Exp;
branches;
next	;


desc
@@


1.14
log
@bfd/
2013-09-24  Gregory Fong  <gregory.0xf0@@gmail.com>

	* elfxx-mips.c (mips_elf_create_got_section): Hide
	_GLOBAL_OFFSET_TABLE_.

ld/testsuite/
2013-09-24  Gregory Fong  <gregory.0xf0@@gmail.com>

	* ld-mips-elf/eh-frame5.d, ld-mips-elf/jalx-2.dd,
	ld-mips-elf/mips-elf.exp, ld-mips-elf/mips16-pic-2.ad,
	ld-mips-elf/mips16-pic-2.nd, ld-mips-elf/pic-and-nonpic-3a.dd,
	ld-mips-elf/pic-and-nonpic-3b.ad, ld-mips-elf/pic-and-nonpic-3b.dd,
	ld-mips-elf/pic-and-nonpic-3b.nd, ld-mips-elf/pic-and-nonpic-4b.ad,
	ld-mips-elf/pic-and-nonpic-4b.nd, ld-mips-elf/pic-and-nonpic-4b.rd,
	ld-mips-elf/pic-and-nonpic-5b.ad, ld-mips-elf/pic-and-nonpic-5b.nd,
	ld-mips-elf/pic-and-nonpic-6-n32.ad,
	ld-mips-elf/pic-and-nonpic-6-n32.dd,
	ld-mips-elf/pic-and-nonpic-6-n32.nd,
	ld-mips-elf/pic-and-nonpic-6-n64.ad,
	ld-mips-elf/pic-and-nonpic-6-n64.dd,
	ld-mips-elf/pic-and-nonpic-6-n64.nd,
	ld-mips-elf/pic-and-nonpic-6-o32.ad,
	ld-mips-elf/pic-and-nonpic-6-o32.dd,
	ld-mips-elf/pic-and-nonpic-6-o32.nd, ld-mips-elf/rel32-n32.d,
	ld-mips-elf/rel32-o32.d, ld-mips-elf/rel64.d,
	ld-mips-elf/tls-multi-got-1.got, ld-mips-elf/tls-multi-got-1.r,
	ld-mips-elf/tlsdyn-o32-1.d, ld-mips-elf/tlsdyn-o32-1.got,
	ld-mips-elf/tlsdyn-o32-2.d, ld-mips-elf/tlsdyn-o32-2.got,
	ld-mips-elf/tlsdyn-o32-3.d, ld-mips-elf/tlsdyn-o32-3.got,
	ld-mips-elf/tlsdyn-o32.d, ld-mips-elf/tlsdyn-o32.got,
	ld-mips-elf/tlslib-o32-ver.got, ld-mips-elf/tlslib-o32.got: Update
	for removal of _GLOBAL_OFFSET_TABLE_ from .dynsym.
@
text
@
.*:     file format elf32-tradbigmips

DYNAMIC RELOCATION RECORDS
OFFSET   TYPE              VALUE 
00000000 R_MIPS_NONE       \*ABS\*
0013f7f0 R_MIPS_TLS_DTPMOD32  \*ABS\*
0014944c R_MIPS_TLS_DTPMOD32  \*ABS\*
0013f7f8 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0013f7fc R_MIPS_TLS_DTPREL32  tlsvar_gd
00149458 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0014945c R_MIPS_TLS_DTPREL32  tlsvar_gd
0013f800 R_MIPS_TLS_TPREL32  tlsvar_ie
00149454 R_MIPS_TLS_TPREL32  tlsvar_ie
00143e78 R_MIPS_REL32      sym_1_9526
#...
00139a54 R_MIPS_REL32      sym_2_8654


Contents of section .got:
 122320 00000000 80000000 000d7f58 000d65b4  .*
 122330 000d1f64 000d5fd0 000d5a08 000d1980  .*
#...
 135ba0 000cf1c4 000e0e08 00000000 80000000  .*
 135bb0 00000000 00000000 00000000 00000000  .*
#...
 13f7e0 00000000 00000000 00000000 00000000  .*
 13f7f0 00000000 00000000 00000000 00000000  .*
 13f800 00000000 00000000 80000000 00000000  .*
#...
 149410 00000000 00000000 00000000 00000000  .*
 149420 00000000 00000000 00000000 00000000  .*
 149430 00000000 00000000 00000000 00000000  .*
 149440 00000000 00000000 00000000 00000000  .*
 149450 00000000 00000000 00000000 00000000  .*
#pass
@


1.13
log
@bfd/
	* elfxx-mips.c (mips_got_info): Remove bfd2got.
	(mips_elf_bfd2got_hash): Delete.
	(mips_elf_got_per_bfd_arg): Remove bfd2got.
	(mips_elf_replace_bfd_got, mips_elf_count_got_entries): New functions.
	(mips_elf_global_got_index, mips_elf_create_local_got_entry): Use
	g->next to test for the multigot case.  Use mips_elf_bfd_got rather
	than mips_elf_got_for_ibfd.
	(mips_elf_bfd2got_entry_hash, mips_elf_bfd2got_entry_eq)
	(mips_elf_got_for_ibfd, mips_elf_get_got_for_bfd): Delete.
	(mips_elf_make_got_per_bfd): Replace with...
	(mips_elf_add_got_entry): ...this new function.
	(mips_elf_make_got_pages_per_bfd): Replace with...
	(mips_elf_add_got_page_entry): ...this new function.
	(mips_elf_merge_got_with): Replace bfd2got argument with separate
	bfd and GOT arguments.  Use mips_elf_add_got_entry and
	mips_elf_add_got_page_entry instead of mips_elf_make_got_per_bfd
	and mips_elf_make_got_pages_per_bfd.  Use mips_elf_replace_bfd_got
	to set the BFD's GOT and free the old table.
	(mips_elf_merge_got): Replace bfd2got argument with separate
	bfd and GOT arguments.  Apply mips_elf_resolve_final_got_entries.
	Use mips_elf_count_got_entries to count the number of entries in
	each GOT.  Update the calls to mips_elf_merge_got_with.
	(mips_elf_adjust_gp): Use g->next to test for the multigot case.
	Use mips_elf_bfd_got rather than mips_elf_got_for_ibfd.
	(mips_elf_multi_got): Don't create the bfd2got hash table.
	Replace hash table traversal with a walk over the input bfds,
	updating the call to mips_elf_merge_got.  Use mips_elf_replace_bfd_got
	to set the output bfd's GOT.
	(mips_elf_lay_out_got): Rename "sub" to "ibfd".  Record that all
	bfds use the master GOT in the single-GOT case.
	(_bfd_mips_elf_finish_dynamic_sections): Use mips_elf_bfd_got
	rather than mips_elf_got_for_ibfd.

ld/testsuite/
	* ld-mips-elf/tls-hidden4.got, ld-mips-elf/tls-multi-got-1.d,
	ld-mips-elf/tls-multi-got-1.got: Update for changes in the order
	that symbols are added to per-bfd GOTs.
@
text
@d7 9
a15 9
0013f820 R_MIPS_TLS_DTPMOD32  \*ABS\*
0014947c R_MIPS_TLS_DTPMOD32  \*ABS\*
0013f828 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0013f82c R_MIPS_TLS_DTPREL32  tlsvar_gd
00149488 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0014948c R_MIPS_TLS_DTPREL32  tlsvar_gd
0013f830 R_MIPS_TLS_TPREL32  tlsvar_ie
00149484 R_MIPS_TLS_TPREL32  tlsvar_ie
00143ea8 R_MIPS_REL32      sym_1_9526
d17 1
a17 1
00139a84 R_MIPS_REL32      sym_2_8654
d21 2
a22 2
 122350 00000000 80000000 000d7f88 000d65e4  .*
 122360 000d1f94 000d6000 000d5a38 000d19b0  .*
d24 2
a25 2
 135bd0 000cf1f4 000e0e38 00000000 80000000  .*
 135be0 00000000 00000000 00000000 00000000  .*
d27 3
a29 3
 13f810 00000000 00000000 00000000 00000000  .*
 13f820 00000000 00000000 00000000 00000000  .*
 13f830 00000000 00000000 80000000 00000000  .*
d31 3
a35 3
 149460 00000000 00000000 00000000 00000000  .*
 149470 00000000 00000000 00000000 00000000  .*
 149480 00000000 00000000 00000000 00000000  .*
@


1.13.2.1
log
@bfd/
2013-10-05  Gregory Fong  <gregory.0xf0@@gmail.com>

	* elfxx-mips.c (mips_elf_create_got_section): Hide
	_GLOBAL_OFFSET_TABLE_.

ld/testsuite/
2013-10-05  Gregory Fong  <gregory.0xf0@@gmail.com>

	* ld-mips-elf/eh-frame5.d, ld-mips-elf/jalx-2.dd,
	ld-mips-elf/mips-elf.exp, ld-mips-elf/mips16-pic-2.ad,
	ld-mips-elf/mips16-pic-2.nd, ld-mips-elf/pic-and-nonpic-3a.dd,
	ld-mips-elf/pic-and-nonpic-3b.ad, ld-mips-elf/pic-and-nonpic-3b.dd,
	ld-mips-elf/pic-and-nonpic-3b.nd, ld-mips-elf/pic-and-nonpic-4b.ad,
	ld-mips-elf/pic-and-nonpic-4b.nd, ld-mips-elf/pic-and-nonpic-4b.rd,
	ld-mips-elf/pic-and-nonpic-5b.ad, ld-mips-elf/pic-and-nonpic-5b.nd,
	ld-mips-elf/pic-and-nonpic-6-n32.ad,
	ld-mips-elf/pic-and-nonpic-6-n32.dd,
	ld-mips-elf/pic-and-nonpic-6-n32.nd,
	ld-mips-elf/pic-and-nonpic-6-n64.ad,
	ld-mips-elf/pic-and-nonpic-6-n64.dd,
	ld-mips-elf/pic-and-nonpic-6-n64.nd,
	ld-mips-elf/pic-and-nonpic-6-o32.ad,
	ld-mips-elf/pic-and-nonpic-6-o32.dd,
	ld-mips-elf/pic-and-nonpic-6-o32.nd, ld-mips-elf/rel32-n32.d,
	ld-mips-elf/rel32-o32.d, ld-mips-elf/rel64.d,
	ld-mips-elf/tls-multi-got-1.got, ld-mips-elf/tls-multi-got-1.r,
	ld-mips-elf/tlsdyn-o32-1.d, ld-mips-elf/tlsdyn-o32-1.got,
	ld-mips-elf/tlsdyn-o32-2.d, ld-mips-elf/tlsdyn-o32-2.got,
	ld-mips-elf/tlsdyn-o32-3.d, ld-mips-elf/tlsdyn-o32-3.got,
	ld-mips-elf/tlsdyn-o32.d, ld-mips-elf/tlsdyn-o32.got,
	ld-mips-elf/tlslib-o32-ver.got, ld-mips-elf/tlslib-o32.got: Update
	for removal of _GLOBAL_OFFSET_TABLE_ from .dynsym.
@
text
@d7 9
a15 9
0013f7f0 R_MIPS_TLS_DTPMOD32  \*ABS\*
0014944c R_MIPS_TLS_DTPMOD32  \*ABS\*
0013f7f8 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0013f7fc R_MIPS_TLS_DTPREL32  tlsvar_gd
00149458 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0014945c R_MIPS_TLS_DTPREL32  tlsvar_gd
0013f800 R_MIPS_TLS_TPREL32  tlsvar_ie
00149454 R_MIPS_TLS_TPREL32  tlsvar_ie
00143e78 R_MIPS_REL32      sym_1_9526
d17 1
a17 1
00139a54 R_MIPS_REL32      sym_2_8654
d21 2
a22 2
 122320 00000000 80000000 000d7f58 000d65b4  .*
 122330 000d1f64 000d5fd0 000d5a08 000d1980  .*
d24 2
a25 2
 135ba0 000cf1c4 000e0e08 00000000 80000000  .*
 135bb0 00000000 00000000 00000000 00000000  .*
d27 3
a29 3
 13f7e0 00000000 00000000 00000000 00000000  .*
 13f7f0 00000000 00000000 00000000 00000000  .*
 13f800 00000000 00000000 80000000 00000000  .*
a30 3
 149410 00000000 00000000 00000000 00000000  .*
 149420 00000000 00000000 00000000 00000000  .*
 149430 00000000 00000000 00000000 00000000  .*
d33 3
@


1.12
log
@bfd/
	* elfxx-mips.c (mips_elf_multi_got_entry_hash): Rename to...
	(mips_elf_got_entry_hash): ...this, deleting the old version.
	(mips_elf_create_got_info): Use mips_elf_got_entry_hash for
	both types of GOT.

ld/testsuite/
	* ld-mips-elf/tls-hidden3.d, ld-mips-elf/tls-hidden3.got,
	ld-mips-elf/tls-multi-got-1.got, ld-mips-elf/tlsbin-o32.d,
	ld-mips-elf/tlsbin-o32.got, ld-mips-elf/tlsdyn-o32-1.d,
	ld-mips-elf/tlsdyn-o32-1.got, ld-mips-elf/tlsdyn-o32-2.d,
	ld-mips-elf/tlsdyn-o32-2.got, ld-mips-elf/tlsdyn-o32-3.d,
	ld-mips-elf/tlsdyn-o32-3.got, ld-mips-elf/tlsdyn-o32.d,
	ld-mips-elf/tlsdyn-o32.got, ld-mips-elf/tlslib-o32.d,
	ld-mips-elf/tlslib-o32.got, ld-mips-elf/tlslib-o32-hidden.got,
	ld-mips-elf/tlslib-o32-ver.got: Adjust GOT layout for new
	got_entry hash function.
@
text
@d9 2
a10 2
0013f82c R_MIPS_TLS_DTPMOD32  tlsvar_gd
0013f830 R_MIPS_TLS_DTPREL32  tlsvar_gd
d13 1
a13 1
0013f828 R_MIPS_TLS_TPREL32  tlsvar_ie
d15 1
a15 1
00143e3c R_MIPS_REL32      sym_1_9526
d17 1
a17 1
0013a8f8 R_MIPS_REL32      sym_2_8654
@


1.11
log
@	* ld-mips-elf/dyn-sec64.ld: Use HIDDEN to define _gp.
	* ld-mips-elf/eh-frame5.ld: Likewise.
	* ld-mips-elf/got-dump-1.ld: Likewise.
	* ld-mips-elf/got-dump-2.ld: Likewise.
	* ld-mips-elf/got-page-1.ld: Likewise.
	* ld-mips-elf/mips-dyn.ld: Likewise.
	* ld-mips-elf/mips-lib.ld: Likewise.
	* ld-mips-elf/mips16-pic-1.ld: Likewise.
	* ld-mips-elf/no-shared-1.ld: Likewise.
	* ld-mips-elf/pic-and-nonpic-1.ld: Likewise.
	* ld-mips-elf/pic-and-nonpic-3a.ld: Likewise.
	* ld-mips-elf/pic-and-nonpic-3b.ld: Likewise.
	* ld-mips-elf/pic-and-nonpic-4b.ld: Likewise.
	* ld-mips-elf/pic-and-nonpic-5b.ld: Likewise.
	* ld-mips-elf/pic-and-nonpic-6.ld: Likewise.
	* ld-mips-elf/reloc-2.ld: Likewise.
	* ld-mips-elf/reloc-estimate-1.ld: Likewise.
	* ld-mips-elf/stub-dynsym-1.ld: Likewise.
	* ld-mips-elf/tls-hidden3.ld: Likewise.
	* ld-mips-elf/mips16-pic-2.ad: Update accordingly.
	* ld-mips-elf/pic-and-nonpic-3b.ad: Likewise.
	* ld-mips-elf/pic-and-nonpic-4b.ad: Likewise.
	* ld-mips-elf/pic-and-nonpic-5b.ad: Likewise.
	* ld-mips-elf/pic-and-nonpic-6-n32.ad: Likewise.
	* ld-mips-elf/pic-and-nonpic-6-n64.ad: Likewise.
	* ld-mips-elf/pic-and-nonpic-6-o32.ad: Likewise.
	* ld-mips-elf/eh-frame5.d: Likewise.
	* ld-mips-elf/tlsdyn-o32-1.d: Likewise.
	* ld-mips-elf/tlsdyn-o32-2.d: Likewise.
	* ld-mips-elf/tlsdyn-o32-3.d: Likewise.
	* ld-mips-elf/tlsdyn-o32.d: Likewise.
	* ld-mips-elf/pic-and-nonpic-3a.dd: Likewise.
	* ld-mips-elf/pic-and-nonpic-3b.dd: Likewise.
	* ld-mips-elf/pic-and-nonpic-6-n32.dd: Likewise.
	* ld-mips-elf/pic-and-nonpic-6-n64.dd: Likewise.
	* ld-mips-elf/pic-and-nonpic-6-o32.dd: Likewise.
	* ld-mips-elf/tls-multi-got-1.got: Likewise.
	* ld-mips-elf/tlsdyn-o32-1.got: Likewise.
	* ld-mips-elf/tlsdyn-o32-2.got: Likewise.
	* ld-mips-elf/tlsdyn-o32-3.got: Likewise.
	* ld-mips-elf/tlsdyn-o32.got: Likewise.
	* ld-mips-elf/tlslib-o32-ver.got: Likewise.
	* ld-mips-elf/tlslib-o32.got: Likewise.
	* ld-mips-elf/mips16-pic-2.nd: Likewise.
	* ld-mips-elf/pic-and-nonpic-1.nd: Likewise.
	* ld-mips-elf/pic-and-nonpic-3b.nd: Likewise.
	* ld-mips-elf/pic-and-nonpic-4b.nd: Likewise.
	* ld-mips-elf/pic-and-nonpic-5b.nd: Likewise.
	* ld-mips-elf/pic-and-nonpic-6-n32.nd: Likewise.
	* ld-mips-elf/pic-and-nonpic-6-n64.nd: Likewise.
	* ld-mips-elf/pic-and-nonpic-6-o32.nd: Likewise.
	* ld-mips-elf/tls-multi-got-1.r: Likewise.
	* ld-mips-elf/pic-and-nonpic-3b.rd: Likewise.
	* ld-mips-elf/pic-and-nonpic-4b.rd: Likewise.
	* ld-mips-elf/mips-elf.exp: Likewise.
@
text
@d15 1
a15 1
00143e28 R_MIPS_REL32      sym_1_9526
d17 1
a17 1
00139aa8 R_MIPS_REL32      sym_2_8654
@


1.10
log
@bfd/
	* elfxx-mips.c (mips_elf_link_hash_table): Add an "sstubs" field.
	(_bfd_mips_elf_create_dynamic_sections): Use it to cache the stubs
	section.  Don't check whether the section already exists.
	(_bfd_mips_elf_adjust_dynamic_symbol): Use htab->sstubs.
	(_bfd_mips_elf_finish_dynamic_symbol): Likewise.
	(_bfd_mips_elf_finish_dynamic_sections): Likewise.
	(_bfd_mips_elf_size_dynamic_sections): Likewise.  Don't add the
	dummy stub to an empty section.
	(_bfd_mips_elf_link_hash_table_create): Initialize the "sstubs" field.

ld/testsuite/
	* ld-mips-elf/tls-hidden3.ld: Remove the unused .MIPS.stubs section.
	Keep the text start address the same.
	* ld-mips-elf/tls-multi-got-1.got: We have removed a .MIPS.stubs
	section that contained only a 16-byte dummy stub.  Subtract 16
	from addresses to account for the change.
	* ld-mips-elf/tls-multi-got-1.r: Likewise.  Adjust MIPS_UNREFEXTNO
	to account the removed section symbol.
	* ld-mips-elf/tlsdyn-o32-1.d: We have deleted a .MIPS.stubs
	section that contained only a 16-byte dummy stub.  Remove it
	from the disassembly.
	* ld-mips-elf/tlsdyn-o32-2.d: Likewise.
	* ld-mips-elf/tlsdyn-o32-3.d: Likewise.
	* ld-mips-elf/tlsdyn-o32.d: Likewise.
	* ld-mips-elf/relax-jalr-n32-shared.d: Likewise.
	* ld-mips-elf/relax-jalr-n64-shared.d: Likewise.
@
text
@d7 9
a15 9
0013f830 R_MIPS_TLS_DTPMOD32  \*ABS\*
0014948c R_MIPS_TLS_DTPMOD32  \*ABS\*
0013f83c R_MIPS_TLS_DTPMOD32  tlsvar_gd
0013f840 R_MIPS_TLS_DTPREL32  tlsvar_gd
00149498 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0014949c R_MIPS_TLS_DTPREL32  tlsvar_gd
0013f838 R_MIPS_TLS_TPREL32  tlsvar_ie
00149494 R_MIPS_TLS_TPREL32  tlsvar_ie
00143e38 R_MIPS_REL32      sym_1_9526
d17 1
a17 1
00139ab8 R_MIPS_REL32      sym_2_8654
d21 2
a22 2
 122360 00000000 80000000 000d7f98 000d65f4  .*
 122370 000d1fa4 000d6010 000d5a48 000d19c0  .*
d24 2
a25 2
 135be0 000cf204 000e0e48 00000000 80000000  .*
 135bf0 00000000 00000000 00000000 00000000  .*
d27 1
d29 1
a29 2
 13f830 00000000 00000000 00000000 00000000  .*
 13f840 00000000 00000000 80000000 00000000  .*
d31 1
a35 1
 149490 00000000 00000000 00000000 00000000  .*
@


1.10.18.1
log
@bfd/
2012-08-09  Maciej W. Rozycki  <macro@@codesourcery.com>

	* elfxx-mips.c (LA25_LUI_MICROMIPS_1, LA25_LUI_MICROMIPS_2):
	Remove macros, folding them into...
	(LA25_LUI_MICROMIPS): ... this new macro.
	(LA25_J_MICROMIPS_1, LA25_J_MICROMIPS_2): Likewise into...
	(LA25_J_MICROMIPS): ... this new macro.
	(LA25_ADDIU_MICROMIPS_1, LA25_ADDIU_MICROMIPS_2): Likewise
	into...
	(LA25_ADDIU_MICROMIPS): ... this new macro.
	(bfd_put_micromips_32, bfd_get_micromips_32): New functions.
	(mips_elf_create_la25_stub): Use them.
	(check_br32_dslot, check_br32, check_relocated_bzc): Likewise.
	(_bfd_mips_elf_relax_section): Likewise.

gas/
	* config/tc-mips.c (NO_ISA_COP, COP_INSN): Remove macros.
	(is_opcode_valid): Remove coprocessor instruction exclusions.
	Replace OPCODE_IS_MEMBER with opcode_is_member.
	(is_opcode_valid_16): Replace OPCODE_IS_MEMBER with
	opcode_is_member.
	(macro): Remove coprocessor instruction exclusions.

gas/
	* gas/mips/mips.exp: Set has_newabi for all Linux targets.
	* gas/mips/cfi-n64-1.d: Adjust for targets that do not infer the
	ISA from the ABI.
	* gas/mips/elf-rel-got-n32.d: Likewise.
	* gas/mips/elf-rel-got-n64.d: Likewise.
	* gas/mips/elf-rel-xgot-n32.d: Likewise.
	* gas/mips/elf-rel-xgot-n64.d: Likewise.
	* gas/mips/elf-rel18.d: Likewise.
	* gas/mips/elf-rel28-n32.d: Likewise.
	* gas/mips/elf-rel28-n64.d: Likewise.
	* gas/mips/jal-newabi.d: Likewise.
	* gas/mips/ldstla-n64-shared.d: Likewise.
	* gas/mips/ldstla-n64-sym32.d: Likewise.
	* gas/mips/ldstla-n64.d: Likewise.
	* gas/mips/macro-warn-1-n32.d: Likewise.
	* gas/mips/macro-warn-2-n32.d: Likewise.
	* gas/mips/n32-consec.d: Likewise.

include/
2012-08-13  Richard Sandiford  <rdsandiford@@googlemail.com>
            Maciej W. Rozycki  <macro@@codesourcery.com>

	* mips.h (mips_opcode): Add the exclusions field.
	(OPCODE_IS_MEMBER): Remove macro.
	(cpu_is_member): New inline function.
	(opcode_is_member): Likewise.

ld/
	* emulparams/elf32bmip.sh: Make _gp hidden.
	* emulparams/elf32bmipn32-defs.sh: Likewise.
	* emulparams/elf32mipswindiss.sh: Likewise.
	* scripttempl/mips.sc: Likewise.

ld/
2012-08-28  Maciej W. Rozycki  <macro@@codesourcery.com>

	* ld-elf/export-class.sd: New test.
	* ld-elf/export-class.vd: New test.
	* ld-elf/export-class-def.s: New test source.
	* ld-elf/export-class-dep.s: New test source.
	* ld-elf/export-class-lib.s: New test source.
	* ld-elf/export-class-ref.s: New test source.
	* ld-elf/export-class-lib.ver: New test version script.
	* ld-elf/export-class.exp: New test script.
	* ld-arm/arm-export-class.rd: New test.
	* ld-arm/arm-export-class.xd: New test.
	* ld-arm/export-class.exp: New test script.
	* ld-i386/i386-export-class.rd: New test.
	* ld-i386/i386-export-class.xd: New test.
	* ld-i386/export-class.exp: New test script.
	* ld-mips-elf/mips-32-export-class.rd: New test.
	* ld-mips-elf/mips-32-export-class.xd: New test.
	* ld-mips-elf/mips-64-export-class.rd: New test.
	* ld-mips-elf/mips-64-export-class.xd: New test.
	* ld-mips-elf/export-class.exp: New test script.
	* ld-powerpc/powerpc-32-export-class.rd: New test.
	* ld-powerpc/powerpc-32-export-class.xd: New test.
	* ld-powerpc/powerpc-64-export-class.rd: New test.
	* ld-powerpc/powerpc-64-export-class.xd: New test.
	* ld-powerpc/export-class.exp: New test script.
	* ld-x86-64/x86-64-64-export-class.rd: New test.
	* ld-x86-64/x86-64-x32-export-class.rd: New test.
	* ld-x86-64/export-class.exp: New test script.

opcodes/
2012-08-14  Maciej W. Rozycki  <macro@@codesourcery.com>

	* mips-dis.c (print_insn_args): Add GET_OP and GET_OP_S local
	macros, use local variables for info struct member accesses,
	update the type of the variable used to hold the instruction
	word.
	(print_insn_mips, print_mips16_insn_arg): Likewise.
	(print_insn_mips16): Add GET_OP and GET_OP_S local macros, use
	local variables for info struct member accesses.
	(print_insn_micromips): Add GET_OP_S local macro.
	(_print_insn_mips): Update the type of the variable used to hold
	the instruction word.
@
text
@d7 9
a15 9
0013f820 R_MIPS_TLS_DTPMOD32  \*ABS\*
0014947c R_MIPS_TLS_DTPMOD32  \*ABS\*
0013f82c R_MIPS_TLS_DTPMOD32  tlsvar_gd
0013f830 R_MIPS_TLS_DTPREL32  tlsvar_gd
00149488 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0014948c R_MIPS_TLS_DTPREL32  tlsvar_gd
0013f828 R_MIPS_TLS_TPREL32  tlsvar_ie
00149484 R_MIPS_TLS_TPREL32  tlsvar_ie
00143e28 R_MIPS_REL32      sym_1_9526
d17 1
a17 1
00139aa8 R_MIPS_REL32      sym_2_8654
d21 2
a22 2
 122350 00000000 80000000 000d7f88 000d65e4  .*
 122360 000d1f94 000d6000 000d5a38 000d19b0  .*
d24 2
a25 2
 135bd0 000cf1f4 000e0e38 00000000 80000000  .*
 135be0 00000000 00000000 00000000 00000000  .*
a26 1
 13f810 00000000 00000000 00000000 00000000  .*
d28 2
a29 1
 13f830 00000000 00000000 80000000 00000000  .*
a30 1
 149440 00000000 00000000 00000000 00000000  .*
d35 1
@


1.9
log
@bfd/
2007-09-18  Richard Sandiford  <richard@@codesourcery.com>

	* elfxx-mips.c (mips_got_page_range): New structure.
	(mips_got_page_entry): Likewise.
	(mips_got_info): Add page_gotno and got_page_entries fields.
	(mips_elf_got_per_bfd_arg): Add max_pages field.  Delete
	primary_count and current_count fields.
	(mips_got_page_entry_hash, mips_got_page_entry_eq): New functions.
	(mips_elf_pages_for_range, mips_elf_record_got_page_entry): Likewise.
	(mips_elf_get_got_for_bfd): New function, split out from
	mips_elf_make_got_per_bfd.  Initialize the page_gotno and
	got_page_entries fields when creating a new GOT structure.
	(mips_elf_make_got_pages_per_bfd): New function.
	(mips_elf_merge_got_with): New function, split out from
	mips_elf_make_got_per_bfd.  Merge page entries as well as
	non-page entries.  Use the minimum of max_pages and the sum
	of the page_gotnos to estimate the number of page entries.
	(mips_elf_merge_gots): Use the minimum of max_pages and the
	bfd's page_gotno to estimate the number of page entries.
	Use the above functions.
	(mips_elf_multi_got): Add page entries as well as non-page entries
	to the individual per-bfd GOTs.  Initialize got_per_bfd_arg.max_pages.
	Initialize the page_gotno and got_page_entries fields when creating
	a new primary GOT.  Use the minimum of pages and page_gotno when
	adding the number of pages entries to local_gotno.
	(mips_elf_create_got_section): Initialize the page_gotno and
	got_page_entries fields of the GOT structure.
	(mips_elf_rel_relocation_p, mips_elf_read_rel_addend)
	(mips_elf_add_lo16_rel_addend, mips_elf_get_section_contents): New
	functions, split out from...
	(_bfd_mips_elf_relocate_section): ...here.
	(_bfd_mips_elf_check_relocs): Record GOT page entries too.
	(_bfd_mips_relax_section): Use mips_elf_get_section_contents.
	(_bfd_mips_elf_always_size_sections): Use the smaller of the
	loadable_size- and page_gotno-derived estimates.

ld/testsuite/
2007-09-18  Richard Sandiford  <richard@@codesourcery.com>
            Joseph Myers  <joseph@@codesourcery.com>

	* ld-mips-elf/got-page-1.d, ld-mips-elf/got-page-1.s,
	* ld-mips-elf/got-page-2.d, ld-mips-elf/got-page-2.s,
	* ld-mips-elf/got-page-3.d, ld-mips-elf/got-page-3a.s,
	* ld-mips-elf/got-page-3b.s, ld-mips-elf/got-page-3c.s,
	* ld-mips-elf/got-page-1.ld: New tests.
	* ld-mips-elf/mips-elf.exp: Run them.
	* ld-mips-elf/multi-got-1.d, ld-mips-elf/multi-got-no-shared.d,
	* ld-mips-elf/tls-hidden2-got.d, ld-mips-elf/tls-hidden2.d,
	* ld-mips-elf/tls-hidden3.d, ld-mips-elf/tls-hidden3.got,
	* ld-mips-elf/tls-hidden3.r, ld-mips-elf/tls-hidden4.got,
	* ld-mips-elf/tls-hidden4.r, ld-mips-elf/tls-multi-got-1.d,
	* ld-mips-elf/tls-multi-got-1.got, ld-mips-elf/tls-multi-got-1.r,
	* ld-mips-elf/tlsbin-o32.d, ld-mips-elf/tlsbin-o32.got,
	* ld-mips-elf/tlsdyn-o32-1.d, ld-mips-elf/tlsdyn-o32-1.got,
	* ld-mips-elf/tlsdyn-o32-2.d, ld-mips-elf/tlsdyn-o32-2.got,
	* ld-mips-elf/tlsdyn-o32-3.d, ld-mips-elf/tlsdyn-o32-3.got,
	* ld-mips-elf/tlsdyn-o32.d, ld-mips-elf/tlsdyn-o32.got,
	* ld-mips-elf/tlslib-o32-hidden.got, ld-mips-elf/tlslib-o32-ver.got,
	* ld-mips-elf/tlslib-o32.d, ld-mips-elf/tlslib-o32.got: Update for
	GOT allocation changes.
@
text
@d7 9
a15 9
0013f840 R_MIPS_TLS_DTPMOD32  \*ABS\*
0014949c R_MIPS_TLS_DTPMOD32  \*ABS\*
0013f84c R_MIPS_TLS_DTPMOD32  tlsvar_gd
0013f850 R_MIPS_TLS_DTPREL32  tlsvar_gd
001494a8 R_MIPS_TLS_DTPMOD32  tlsvar_gd
001494ac R_MIPS_TLS_DTPREL32  tlsvar_gd
0013f848 R_MIPS_TLS_TPREL32  tlsvar_ie
001494a4 R_MIPS_TLS_TPREL32  tlsvar_ie
00143e48 R_MIPS_REL32      sym_1_9526
d17 1
a17 1
00139ac8 R_MIPS_REL32      sym_2_8654
d21 2
a22 2
 122370 00000000 80000000 000d7f98 000d65f4  .*
 122380 000d1fa4 000d6010 000d5a48 000d19c0  .*
d24 2
a25 2
 135bf0 000cf204 000e0e48 00000000 80000000  .*
 135c00 00000000 00000000 00000000 00000000  .*
d27 1
d29 1
a29 2
 13f840 00000000 00000000 00000000 00000000  .*
 13f850 00000000 00000000 80000000 00000000  .*
d31 1
a35 1
 1494a0 00000000 00000000 00000000 00000000  .*
@


1.8
log
@bfd/
	* elfxx-mips.c (_bfd_mips_elf_finish_dynamic_sections): Make the
	size of .rel.dyn reflect the value of DT_RELSZ.

ld/testsuite/
	* ld-mips-elf/multi-got-1.d: Remove trailing R_MIPS_NONE entries.
	* ld-mips-elf/tls-multi-got-1.got: Likewise.
	* ld-mips-elf/tls-multi-got-1.r: Likewise.
@
text
@d7 9
a15 9
0013f948 R_MIPS_TLS_DTPMOD32  \*ABS\*
001495d0 R_MIPS_TLS_DTPMOD32  \*ABS\*
0013f954 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0013f958 R_MIPS_TLS_DTPREL32  tlsvar_gd
001495dc R_MIPS_TLS_DTPMOD32  tlsvar_gd
001495e0 R_MIPS_TLS_DTPREL32  tlsvar_gd
0013f950 R_MIPS_TLS_TPREL32  tlsvar_ie
001495d8 R_MIPS_TLS_TPREL32  tlsvar_ie
00143f7c R_MIPS_REL32      sym_1_9526
d17 1
a17 1
00139bd0 R_MIPS_REL32      sym_2_8654
d21 2
a22 4
 122420 00000000 80000000 00000000 00000000  .*
 122430 00000000 00000000 00000000 00000000  .*
 122440 00000000 00000000 00000000 00000000  .*
 122450 00000000 000d8048 000d66a4 000d2054  .*
d24 2
a25 4
 13f930 00000000 00000000 00000000 00000000  .*
 13f940 00000000 00000000 00000000 00000000  .*
 13f950 00000000 00000000 00000000 00000000  .*
 13f960 80000000 00000000 00000000 00000000  .*
d27 9
a35 5
 1495a0 00000000 00000000 00000000 00000000  .*
 1495b0 00000000 00000000 00000000 00000000  .*
 1495c0 00000000 00000000 00000000 00000000  .*
 1495d0 00000000 00000000 00000000 00000000  .*
 1495e0 00000000                             .*
@


1.7
log
@bfd/
	* elfxx-mips.c (_bfd_mips_elf_additional_program_headers): Allocate
	a PT_NULL header for dynamic objects.
	(_bfd_mips_elf_modify_segment_map): Add it.

ld/testsuite/
	* ld-mips-elf/multi-got-1.d: Do not expect a particular address
	for DT_HASH.
	* ld-mips-elf/rel32-o32.d: Bump addresses by 0x20 to account for
	the extra program header.
	* ld-mips-elf/rel32-n32.d: Likewise.
	* ld-mips-elf/tlslib-o32.got: Likewise.
	* ld-mips-elf/tlslib-o32-hidden.got: Likewise.
	* ld-mips-elf/tlslib-o32-ver.got: Likewise.
	* ld-mips-elf/tls-multi-got-1.got: Likewise.
	* ld-mips-elf/tls-multi-got-1.r: Likewise.
	* ld-mips-elf/rel64.d: Bump addresses by 0x30 to account for the
	extra program header.
	* ld-mips-elf/tlsdyn-o32.d: Reduce the GOT offset by 32 to account
	for the extra program header, and thus the shorter gap between the
	text and data segments.
	* ld-mips-elf/tlsdyn-o32-1.d: Likewise.
	* ld-mips-elf/tlsdyn-o32-2.d: Likewise.
	* ld-mips-elf/tlsdyn-o32-3.d: Likewise.
	* ld-mips-elf/tlsdyn-o32.got: Bump GOT text addresses by 0x20
	to account for the extra program header.
	* ld-mips-elf/tlsdyn-o32-1.got: Likewise.
	* ld-mips-elf/tlsdyn-o32-2.got: Likewise.
	* ld-mips-elf/tlsdyn-o32-3.got: Likewise.
@
text
@a17 22
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
00000000 R_MIPS_NONE       \*ABS\*
@


1.6
log
@bfd/
	* elfxx-mips.c (sort_dynamic_relocs): Sort relocations against the
	same symbol by increasing r_offset.
	(sort_dynamic_relocs_64): Likewise.  Fix comparisons between very
	large and very small symbol indexes.

ld/testsuite/
	* ld-mips-elf/tlslib-o32-hidden.got: Sort relocations against the
	same symbol in order of increasing r_offset.
	* ld-mips-elf/tls-multi-got-1.got: Likewise.
	* ld-mips-elf/tls-hidden3.r: Likewise.
	* ld-mips-elf/tls-hidden4.r: Likewise.
@
text
@d7 9
a15 9
0013f928 R_MIPS_TLS_DTPMOD32  \*ABS\*
001495b0 R_MIPS_TLS_DTPMOD32  \*ABS\*
0013f934 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0013f938 R_MIPS_TLS_DTPREL32  tlsvar_gd
001495bc R_MIPS_TLS_DTPMOD32  tlsvar_gd
001495c0 R_MIPS_TLS_DTPREL32  tlsvar_gd
0013f930 R_MIPS_TLS_TPREL32  tlsvar_ie
001495b8 R_MIPS_TLS_TPREL32  tlsvar_ie
00143f5c R_MIPS_REL32      sym_1_9526
d17 1
a17 1
00139bb0 R_MIPS_REL32      sym_2_8654
d43 4
a46 4
 122400 00000000 80000000 00000000 00000000  .*
 122410 00000000 00000000 00000000 00000000  .*
 122420 00000000 00000000 00000000 00000000  .*
 122430 00000000 000d8028 000d6684 000d2034  .*
a47 2
 13f910 00000000 00000000 00000000 00000000  .*
 13f920 00000000 00000000 00000000 00000000  .*
d49 3
a51 1
 13f940 80000000 00000000 00000000 00000000  .*
a52 2
 149580 00000000 00000000 00000000 00000000  .*
 149590 00000000 00000000 00000000 00000000  .*
d55 3
a57 1
 1495c0 00000000                             .*
@


1.5
log
@bfd/
	* elfxx-mips.c (_bfd_mips_elf_size_dynamic_sections): Add DT_DEBUG
	and DT_MIPS_RLD_MAP tags for position-independent executables.
	Do not add DT_DEBUG to shared libraries for any MIPS target.

ld/testsuite/
	* ld-mips-elf/multi-got-1.d: Remove DT_DEBUG tag.  Do not require
	a specific file offset for .dynamic.  Reduce DT_HASH by 8 to account
	for removed tag.
	* ld-mips-elf/tls-multi-got-1.r: Likewise.  Also reduce DT_REL by 8.
	Reduce PLTGOT and symbol values by 16 to account for the removed tag.
	* ld-mips-elf/textrel-1.d: Remove DT_DEBUG tag.
	* ld-mips-elf/rel32-n32.d: Reduce addresses by 16 to account for
	removed DT_DEBUG tag.
	* ld-mips-elf/rel64.d: Likewise.
	* ld-mips-elf/tls-multi-got-1.got: Likewise.
	* ld-mips-elf/tlslib-o32-hidden.got: Likewise.
@
text
@d7 1
d9 2
a10 1
0013f928 R_MIPS_TLS_DTPMOD32  \*ABS\*
d13 1
a13 2
0013f934 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0013f938 R_MIPS_TLS_DTPREL32  tlsvar_gd
a14 1
0013f930 R_MIPS_TLS_TPREL32  tlsvar_ie
@


1.4
log
@bfd/
	* elf-bfd.h (struct elf_link_hash_table): Reorder.  Add
	text_index_section and data_index_section.
	(struct elf_backend_data): Add elf_backend_init_index_section.
	(_bfd_elf_init_1_index_section): Declare.
	(_bfd_elf_init_2_index_sections): Declare.
	* elfxx-target.h (elf_backend_init_index_section): Define.
	(elfNN_bed): Init new field.
	* elflink.c (_bfd_elf_link_omit_section_dynsym): Keep first tls
	section and text_index_section plus data_index_section.
	(_bfd_elf_link_renumber_dynsyms): Clear dynindx on omitted sections.
	(_bfd_elf_init_1_index_section): New function.
	(_bfd_elf_init_2_index_sections): New function.
	(bfd_elf_size_dynsym_hash_dynstr): Call elf_backend_init_index_section.
	(elf_link_input_bfd): When emitting relocs, use text_index_section
	and data_index_section for removed sections.
	* elf-m10300.c (elf_backend_omit_section_dynsym): Define.
	* elf32-i386.c: Likewise.
	* elf32-m32r.c: Likewise.
	* elf32-sh.c: Likewise.
	* elf32-xstormy16.c: Likewise.
	* elf32-xtensa.c: Likewise.
	* elf64-alpha.c: Likewise.
	* elf64-hppa.c: Likewise.
	* elf64-mmix.c: Likewise.
	* elf64-sh64.c: Likewise.
	* elfxx-ia64.c: Likewise.
	* elf32-arm.c (elf32_arm_final_link_relocate): Use text_index_section
	and data_index_section sym for relocs against sections with no dynamic
	section sym.
	(elf_backend_init_index_section): Define.
	* elf32-cris.c: Similarly.
	* elf32-hppa.c: Similarly.
	* elf32-i370.c: Similarly.
	* elf32-m68k.c: Similarly.
	* elf32-mips.c: Similarly.
	* elf32-ppc.c: Similarly.
	* elf32-s390.c: Similarly.
	* elf32-sparc.c: Similarly.
	* elf32-vax.c: Similarly.
	* elf64-mips.c: Similarly.
	* elf64-ppc.c: Similarly.
	* elf64-s390.c: Similarly.
	* elf64-sparc.c: Similarly.
	* elf64-x86-64.c: Similarly.
	* elfn32-mips.c: Similarly.
	* elfxx-mips.c: Similarly.
	* elfxx-sparc.c: Similarly.
	* linker.c (fix_syms): Base symbols in removed sections on
	previous section in preference to using absolute section.

ld/
	* ldlang.c (strip_excluded_output_sections): Do strip sections
	that define syms, but don't ignore them.
	* ld.texinfo (Output Section Discarding): Revise.
	* emultempl/armcoff.em (gld${EMULATION_NAME}_finish): Always call
	finish_default.

ld/testsuite/
	Update for section sym changes.
@
text
@d7 9
a15 9
001495c0 R_MIPS_TLS_DTPMOD32  \*ABS\*
0013f938 R_MIPS_TLS_DTPMOD32  \*ABS\*
001495cc R_MIPS_TLS_DTPMOD32  tlsvar_gd
001495d0 R_MIPS_TLS_DTPREL32  tlsvar_gd
0013f944 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0013f948 R_MIPS_TLS_DTPREL32  tlsvar_gd
001495c8 R_MIPS_TLS_TPREL32  tlsvar_ie
0013f940 R_MIPS_TLS_TPREL32  tlsvar_ie
00143f6c R_MIPS_REL32      sym_1_9526
d17 1
a17 1
00139bc0 R_MIPS_REL32      sym_2_8654
d43 2
a44 1
 122410 00000000 80000000 00000000 00000000  .*
d46 1
a46 2
 122430 00000000 00000000 00000000 00000000  .*
 122440 00000000 000d8038 000d6694 000d2044  .*
d48 1
d51 1
a51 2
 13f940 00000000 00000000 00000000 00000000  .*
 13f950 80000000 00000000 00000000 00000000  .*
d53 1
d57 1
a57 2
 1495c0 00000000 00000000 00000000 00000000  .*
 1495d0 00000000                             .*
@


1.3
log
@	* ld-mips-elf/multi-got-1.d, ld-mips-elf/tls-multi-got-1.got,
	ld-mips-elf/tls-multi-got-1.r: Update multigot testcases.
@
text
@d7 9
a15 9
001495d0 R_MIPS_TLS_DTPMOD32  \*ABS\*
0013f948 R_MIPS_TLS_DTPMOD32  \*ABS\*
001495dc R_MIPS_TLS_DTPMOD32  tlsvar_gd
001495e0 R_MIPS_TLS_DTPREL32  tlsvar_gd
0013f954 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0013f958 R_MIPS_TLS_DTPREL32  tlsvar_gd
001495d8 R_MIPS_TLS_TPREL32  tlsvar_ie
0013f950 R_MIPS_TLS_TPREL32  tlsvar_ie
00143f7c R_MIPS_REL32      sym_1_9526
d17 1
a17 1
00139bd0 R_MIPS_REL32      sym_2_8654
d43 4
a46 4
 122420 00000000 80000000 00000000 00000000  ................
 122430 00000000 00000000 00000000 00000000  ................
 122440 00000000 00000000 00000000 00000000  ................
 122450 00000000 000d8048 000d66a4 000d2054  .......H..f... T
d48 4
a51 4
 13f930 00000000 00000000 00000000 00000000  ................
 13f940 00000000 00000000 00000000 00000000  ................
 13f950 00000000 00000000 00000000 00000000  ................
 13f960 80000000 00000000 00000000 00000000  ................
d53 5
a57 5
 1495a0 00000000 00000000 00000000 00000000  ................
 1495b0 00000000 00000000 00000000 00000000  ................
 1495c0 00000000 00000000 00000000 00000000  ................
 1495d0 00000000 00000000 00000000 00000000  ................
 1495e0 00000000                             ....            
@


1.2
log
@	* ld-mips-elf/rel32-n32.d: Adjust for changes in linker behaviour.
	* ld-mips-elf/rel32-o32.d: Likewise.
	* ld-mips-elf/rel64.d: Likewise.
	* ld-mips-elf/tls-multi-got-1.got: Likewise.
	* ld-mips-elf/tls-multi-got-1.r: Likewise.
	* ld-mips-elf/tlsdyn-o32-1.d: Likewise.
	* ld-mips-elf/tlsdyn-o32-1.got: Likewise.
	* ld-mips-elf/tlsdyn-o32-2.d: Likewise.
	* ld-mips-elf/tlsdyn-o32-2.got: Likewise.
	* ld-mips-elf/tlsdyn-o32-3.d: Likewise.
	* ld-mips-elf/tlsdyn-o32-3.got: Likewise.
	* ld-mips-elf/tlsdyn-o32.d: Likewise.
	* ld-mips-elf/tlsdyn-o32.got: Likewise.
	* ld-mips-elf/tlslib-o32-hidden.got: Likewise.
	* ld-mips-elf/tlslib-o32-ver.got: Likewise.
	* ld-mips-elf/tlslib-o32.got: Likewise.
@
text
@d15 1
a15 1
00135fcc R_MIPS_REL32      sym_2_8355
d17 1
a17 1
00142cec R_MIPS_REL32      sym_1_0945
d46 1
a46 1
 122450 00000000 000e0a4c 000d3594 000d3584  ..........5...5.
@


1.1
log
@	* ld-mips-elf/tlsbin-o32.s, ld-mips-elf/mips-dyn.ld,
	ld-mips-elf/tlslib-o32.got, ld-mips-elf/tlslib-o32.d,
	ld-mips-elf/tlslib-o32.s, ld-mips-elf/mips-lib.ld,
	ld-mips-elf/tlsbin-o32.got, ld-mips-elf/tlsdyn-o32.d,
	ld-mips-elf/tlsdyn-o32.got, ld-mips-elf/tlsbin-o32.d,
	ld-mips-elf/tlsdyn-o32.s, ld-mips-elf/tls-multi-got-1.got,
	ld-mips-elf/tls-multi-got-1-1.s, ld-mips-elf/tls-multi-got-1.d,
	ld-mips-elf/tls-multi-got-1.r, ld-mips-elf/tls-multi-got-1-2.s,
	ld-mips-elf/tlslib-o32-ver.got, ld-mips-elf/tlslib.ver,
	ld-mips-elf/tlslib-o32-hidden.got, ld-mips-elf/tlslib-hidden.ver,
	ld-mips-elf/tlsdyn-o32-1.d, ld-mips-elf/tlsdyn-o32-3.got,
	ld-mips-elf/tlsdyn-o32-2.d, ld-mips-elf/tlsdyn-o32-2.s,
	ld-mips-elf/tlsdyn-o32-3.d, ld-mips-elf/tlsdyn-o32-1.got,
	ld-mips-elf/tlsdyn-o32-2.got: New files.
	* ld-mips-elf/mips-elf.exp: Run the new tests.
@
text
@d7 9
a15 9
00149630 R_MIPS_TLS_DTPMOD32  \*ABS\*
0013f9a8 R_MIPS_TLS_DTPMOD32  \*ABS\*
0014963c R_MIPS_TLS_DTPMOD32  tlsvar_gd
00149640 R_MIPS_TLS_DTPREL32  tlsvar_gd
0013f9b4 R_MIPS_TLS_DTPMOD32  tlsvar_gd
0013f9b8 R_MIPS_TLS_DTPREL32  tlsvar_gd
00149638 R_MIPS_TLS_TPREL32  tlsvar_ie
0013f9b0 R_MIPS_TLS_TPREL32  tlsvar_ie
0013602c R_MIPS_REL32      sym_2_8355
d17 1
a17 1
00142d4c R_MIPS_REL32      sym_1_0945
d43 4
a46 4
 122480 00000000 80000000 00000000 00000000  ................
 122490 00000000 00000000 00000000 00000000  ................
 1224a0 00000000 00000000 00000000 00000000  ................
 1224b0 00000000 000e0aac 000d35f4 000d35e4  ..........5...5.
d48 4
a51 4
 13f990 00000000 00000000 00000000 00000000  ................
 13f9a0 00000000 00000000 00000000 00000000  ................
 13f9b0 00000000 00000000 00000000 00000000  ................
 13f9c0 80000000 00000000 00000000 00000000  ................
d53 5
a57 5
 149600 00000000 00000000 00000000 00000000  ................
 149610 00000000 00000000 00000000 00000000  ................
 149620 00000000 00000000 00000000 00000000  ................
 149630 00000000 00000000 00000000 00000000  ................
 149640 00000000                             ....            
@

