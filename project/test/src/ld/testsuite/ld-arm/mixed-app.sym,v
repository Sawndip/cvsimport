head	1.9;
access;
symbols
	binutils-2_24-branch:1.9.0.4
	binutils-2_24-branchpoint:1.9
	binutils-2_21_1:1.8
	binutils-2_23_2:1.9
	binutils-2_23_1:1.9
	binutils-2_23:1.9
	binutils-2_23-branch:1.9.0.2
	binutils-2_23-branchpoint:1.9
	binutils-2_22_branch:1.8.0.6
	binutils-2_22:1.8
	binutils-2_22-branch:1.8.0.4
	binutils-2_22-branchpoint:1.8
	binutils-2_21:1.8
	binutils-2_21-branch:1.8.0.2
	binutils-2_21-branchpoint:1.8
	binutils-2_20_1:1.6
	binutils-2_20:1.6
	binutils-arc-20081103-branch:1.6.0.10
	binutils-arc-20081103-branchpoint:1.6
	binutils-2_20-branch:1.6.0.8
	binutils-2_20-branchpoint:1.6
	dje-cgen-play1-branch:1.6.0.6
	dje-cgen-play1-branchpoint:1.6
	arc-20081103-branch:1.6.0.4
	arc-20081103-branchpoint:1.6
	binutils-2_19_1:1.6
	binutils-2_19:1.6
	binutils-2_19-branch:1.6.0.2
	binutils-2_19-branchpoint:1.6
	binutils-2_18:1.5
	binutils-2_18-branch:1.5.0.2
	binutils-2_18-branchpoint:1.5
	binutils-csl-coldfire-4_1-32:1.3
	binutils-csl-sourcerygxx-4_1-32:1.3
	binutils-csl-innovasic-fido-3_4_4-33:1.3
	binutils-csl-sourcerygxx-3_4_4-32:1.1
	binutils-csl-coldfire-4_1-30:1.3
	binutils-csl-sourcerygxx-4_1-30:1.3
	binutils-csl-coldfire-4_1-28:1.3
	binutils-csl-sourcerygxx-4_1-29:1.3
	binutils-csl-sourcerygxx-4_1-28:1.3
	binutils-csl-arm-2006q3-27:1.3
	binutils-csl-sourcerygxx-4_1-27:1.3
	binutils-csl-arm-2006q3-26:1.3
	binutils-csl-sourcerygxx-4_1-26:1.3
	binutils-csl-sourcerygxx-4_1-25:1.3
	binutils-csl-sourcerygxx-4_1-24:1.3
	binutils-csl-sourcerygxx-4_1-23:1.3
	binutils-csl-sourcerygxx-4_1-21:1.3
	binutils-csl-arm-2006q3-21:1.3
	binutils-csl-sourcerygxx-4_1-22:1.3
	binutils-csl-palmsource-arm-prelinker-1_0-1:1.3
	binutils-csl-sourcerygxx-4_1-20:1.3
	binutils-csl-arm-2006q3-19:1.3
	binutils-csl-sourcerygxx-4_1-19:1.3
	binutils-csl-sourcerygxx-4_1-18:1.3
	binutils-csl-renesas-4_1-9:1.3
	binutils-csl-sourcerygxx-3_4_4-25:1.1
	binutils-csl-renesas-4_1-8:1.3
	binutils-csl-renesas-4_1-7:1.3
	binutils-csl-renesas-4_1-6:1.3
	binutils-csl-sourcerygxx-4_1-17:1.3
	binutils-csl-sourcerygxx-4_1-14:1.3
	binutils-csl-sourcerygxx-4_1-15:1.3
	binutils-csl-sourcerygxx-4_1-13:1.3
	binutils-2_17:1.3
	binutils-csl-sourcerygxx-4_1-12:1.3
	binutils-csl-sourcerygxx-3_4_4-21:1.3
	binutils-csl-wrs-linux-3_4_4-24:1.1
	binutils-csl-wrs-linux-3_4_4-23:1.1
	binutils-csl-sourcerygxx-4_1-9:1.3
	binutils-csl-sourcerygxx-4_1-8:1.3
	binutils-csl-sourcerygxx-4_1-7:1.3
	binutils-csl-arm-2006q1-6:1.3
	binutils-csl-sourcerygxx-4_1-6:1.3
	binutils-csl-wrs-linux-3_4_4-22:1.1
	binutils-csl-coldfire-4_1-11:1.3
	binutils-csl-sourcerygxx-3_4_4-19:1.3
	binutils-csl-coldfire-4_1-10:1.3
	binutils-csl-sourcerygxx-4_1-5:1.3
	binutils-csl-sourcerygxx-4_1-4:1.3
	binutils-csl-wrs-linux-3_4_4-21:1.1
	binutils-csl-morpho-4_1-4:1.3
	binutils-csl-sourcerygxx-3_4_4-17:1.3
	binutils-csl-wrs-linux-3_4_4-20:1.1
	binutils-2_17-branch:1.3.0.4
	binutils-2_17-branchpoint:1.3
	binutils-csl-2_17-branch:1.3.0.2
	binutils-csl-2_17-branchpoint:1.3
	binutils-csl-gxxpro-3_4-branch:1.1.0.6
	binutils-csl-gxxpro-3_4-branchpoint:1.1
	binutils-2_16_1:1.1
	binutils-csl-arm-2005q1b:1.1
	binutils-2_16:1.1
	binutils-csl-arm-2005q1a:1.1
	binutils-csl-arm-2005q1-branch:1.1.0.4
	binutils-csl-arm-2005q1-branchpoint:1.1
	binutils-2_16-branch:1.1.0.2
	binutils-2_16-branchpoint:1.1
	binutils_latest_snapshot:1.9;
locks; strict;
comment	@# @;


1.9
date	2012.06.15.15.13.35;	author amodra;	state Exp;
branches;
next	1.8;

1.8
date	2009.11.20.15.04.51;	author tschwinge;	state Exp;
branches;
next	1.7;

1.7
date	2009.09.23.03.12.25;	author amodra;	state Exp;
branches;
next	1.6;

1.6
date	2008.07.22.14.15.32;	author amodra;	state Exp;
branches;
next	1.5;

1.5
date	2006.11.13.21.18.36;	author drow;	state Exp;
branches;
next	1.4;

1.4
date	2006.10.17.13.41.48;	author amodra;	state Exp;
branches;
next	1.3;

1.3
date	2005.08.15.15.39.44;	author amodra;	state Exp;
branches;
next	1.2;

1.2
date	2005.08.08.15.52.54;	author rearnsha;	state Exp;
branches;
next	1.1;

1.1
date	2004.11.17.17.50.27;	author drow;	state Exp;
branches;
next	;


desc
@@


1.9
log
@ld/
	* ldlang.h (lang_output_section_statement_type): Add after_end field.
	(lang_abs_symbol_at_beginning_of, lang_abs_symbol_at_end_of): Delete.
	(section_for_dot): Declare.
	* ldlang.c (lang_size_sections_1): Correct comment.
	(current_section): Move earlier.
	(current_assign, prefer_next_section): New static vars.
	(lang_do_assignments_1): Add found_end param.  Detect _end
	assignment to set found_end.  Set os->after_end.  Set above statics.
	(lang_do_assignments): Adjust lang_do_assignments_1 call.  Init
	vars.
	(section_for_dot): New function.
	(lang_set_startof): Don't make an absolute symbol.
	(lang_abs_symbol_at_beginning_of, lang_abs_symbol_at_end_of): Delete.
	* ldexp.c (new_rel_from_abs): Use section_for_dot.
	* emultempl/lnk960.em (symbol_at_beginning_of): New function.
	(symbol_at_end_of): Likewise.
	(lnk960_after_allocation): Use them.
	* scripttempl/elf.sc: Precede OTHER_GOT_SYMBOLS with . = .; and
	likewise before __bss_start.

ld/testsuite/
Update far too many tests.
@
text
@
Symbol table for image:
 +Num +Buc: +Value +Size +Type +Bind +Vis +Ndx +Name
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +11 _edata
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +12 __bss_start__
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +12 _end
 +.. +..: ........ +4 +OBJECT +GLOBAL +DEFAULT +12 data_obj
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +12 __bss_end__
 +.. +..: 0*[^0]*.* +0 +FUNC +GLOBAL +DEFAULT +UND lib_func1
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +11 __data_start
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +12 __end__
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +12 __bss_start
 +.. +..: .......0 +0 +FUNC +GLOBAL +DEFAULT +8 app_func2
 +.. +..: 0*[^0]*.* +0 +FUNC +GLOBAL +DEFAULT +UND lib_func2
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +12 _bss_end__
@


1.8
log
@ld/
2009-11-20  Thomas Schwinge  <thomas@@codesourcery.com>

	* emulparams/armelf.sh (OTHER_READONLY_SECTIONS)
	<__exidx_start, __exidx_end>: Use PROVIDE_HIDDEN.
	* emulparams/armelf_linux_eabi.sh (OTHER_READONLY_SECTIONS)
	<__exidx_start, __exidx_end>: Likewise.
	* emulparams/armsymbian.sh (OTHER_READONLY_SECTIONS)
	<.ARM.exidx$$Base, __exidx_start, __exidx_end, .ARM.exidx$$Limit>:
	Likewise.

ld/testsuite/
2009-11-20  Thomas Schwinge  <thomas@@codesourcery.com>

	* ld-arm/arm-dyn.ld: Adapt to main linker script changes.
	* ld-arm/arm-lib.ld: Likewise.
	* ld-arm/armthumb-lib.sym: : Adjust expected results.
	* ld-arm/farcall-mixed-app-v5.d: Likewise.
	* ld-arm/farcall-mixed-app.d: Likewise.
	* ld-arm/farcall-mixed-app.sym: Likewise.
	* ld-arm/farcall-mixed-lib.d: Likewise.
	* ld-arm/mixed-app-v5.d: Likewise.
	* ld-arm/mixed-app.d: Likewise.
	* ld-arm/mixed-app.sym: Likewise.
	* ld-arm/mixed-lib.sym: Likewise.
	* ld-arm/preempt-app.sym: Likewise.
	* ld-arm/tls-app.d: Likewise.
@
text
@d4 3
a6 3
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +ABS _edata
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +ABS __bss_start__
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +ABS _end
d8 1
a8 1
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +ABS __bss_end__
d11 2
a12 2
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +ABS __end__
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +ABS __bss_start
d15 1
a15 1
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +ABS _bss_end__
@


1.7
log
@Tolerate some whitespace differences in readelf output.
@
text
@a9 1
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +ABS __exidx_start
a15 1
 +.. +..: ........ +0 +NOTYPE +GLOBAL +DEFAULT +ABS __exidx_end
@


1.6
log
@Update for elf_link_output_extsym change
@
text
@d3 15
a17 15
  Num Buc:    Value  Size   Type   Bind Vis      Ndx Name
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS _edata
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS __bss_start__
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS _end
   ..  ..: ........     4  OBJECT GLOBAL DEFAULT  12 data_obj
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS __bss_end__
   ..  ..: 0*[^0]*.*    0    FUNC GLOBAL DEFAULT UND lib_func1
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS __exidx_start
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT  11 __data_start
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS __end__
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS __bss_start
   ..  ..: .......0     0    FUNC GLOBAL DEFAULT   8 app_func2
   ..  ..: 0*[^0]*.*    0    FUNC GLOBAL DEFAULT UND lib_func2
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS _bss_end__
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS __exidx_end
@


1.5
log
@	* ld-arm/arm-dyn.ld, ld-arm/arm-lib.ld: Remove .stack.
	* ld-arm/armthumb-lib.d, ld-arm/mixed-app.d, ld-arm/mixed-lib.d:
	Allow smaller section gap.
	* ld-arm/armthumb-lib.sym, ld-arm/mixed-lib.sym: Reorder.  Remove
	_stack.
	* ld-arm/mixed-app.sym: Remove _stack.
	* ld-arm/tls-app.d: Update start address.
@
text
@d9 1
a9 1
   ..  ..: 0*[^0]*.*   20    FUNC GLOBAL DEFAULT UND lib_func1
d15 1
a15 1
   ..  ..: 0*[^0]*.*    2    FUNC GLOBAL DEFAULT UND lib_func2
@


1.4
log
@bfd/
	* elf-bfd.h (struct elf_link_hash_table): Reorder.  Add
	text_index_section and data_index_section.
	(struct elf_backend_data): Add elf_backend_init_index_section.
	(_bfd_elf_init_1_index_section): Declare.
	(_bfd_elf_init_2_index_sections): Declare.
	* elfxx-target.h (elf_backend_init_index_section): Define.
	(elfNN_bed): Init new field.
	* elflink.c (_bfd_elf_link_omit_section_dynsym): Keep first tls
	section and text_index_section plus data_index_section.
	(_bfd_elf_link_renumber_dynsyms): Clear dynindx on omitted sections.
	(_bfd_elf_init_1_index_section): New function.
	(_bfd_elf_init_2_index_sections): New function.
	(bfd_elf_size_dynsym_hash_dynstr): Call elf_backend_init_index_section.
	(elf_link_input_bfd): When emitting relocs, use text_index_section
	and data_index_section for removed sections.
	* elf-m10300.c (elf_backend_omit_section_dynsym): Define.
	* elf32-i386.c: Likewise.
	* elf32-m32r.c: Likewise.
	* elf32-sh.c: Likewise.
	* elf32-xstormy16.c: Likewise.
	* elf32-xtensa.c: Likewise.
	* elf64-alpha.c: Likewise.
	* elf64-hppa.c: Likewise.
	* elf64-mmix.c: Likewise.
	* elf64-sh64.c: Likewise.
	* elfxx-ia64.c: Likewise.
	* elf32-arm.c (elf32_arm_final_link_relocate): Use text_index_section
	and data_index_section sym for relocs against sections with no dynamic
	section sym.
	(elf_backend_init_index_section): Define.
	* elf32-cris.c: Similarly.
	* elf32-hppa.c: Similarly.
	* elf32-i370.c: Similarly.
	* elf32-m68k.c: Similarly.
	* elf32-mips.c: Similarly.
	* elf32-ppc.c: Similarly.
	* elf32-s390.c: Similarly.
	* elf32-sparc.c: Similarly.
	* elf32-vax.c: Similarly.
	* elf64-mips.c: Similarly.
	* elf64-ppc.c: Similarly.
	* elf64-s390.c: Similarly.
	* elf64-sparc.c: Similarly.
	* elf64-x86-64.c: Similarly.
	* elfn32-mips.c: Similarly.
	* elfxx-mips.c: Similarly.
	* elfxx-sparc.c: Similarly.
	* linker.c (fix_syms): Base symbols in removed sections on
	previous section in preference to using absolute section.

ld/
	* ldlang.c (strip_excluded_output_sections): Do strip sections
	that define syms, but don't ignore them.
	* ld.texinfo (Output Section Discarding): Revise.
	* emultempl/armcoff.em (gld${EMULATION_NAME}_finish): Always call
	finish_default.

ld/testsuite/
	Update for section sym changes.
@
text
@a11 1
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT  12 _stack
@


1.3
log
@Adjust for dynamic sym changes.
@
text
@d12 1
a12 1
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS _stack
@


1.2
log
@	* ld-arm/mixed-app.sym: Expact _stack to be in the ABS section.
	* ld-arm/mixed-lib.sym: Likewise.
	* tls-lib.d: Use a regexp for the address locations.
	* tls-lib.r: Likewise.
@
text
@d5 4
d10 2
a11 4
   ..  ..: 0*[^0]*.*    2    FUNC GLOBAL DEFAULT UND lib_func2
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS _bss_end__
   ..  ..: ........     0  OBJECT GLOBAL DEFAULT ABS _DYNAMIC
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS __bss_end__
d13 1
a13 2
   ..  ..: ........     4  OBJECT GLOBAL DEFAULT  12 data_obj
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS __bss_start__
a14 1
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS _end
d16 2
a18 3
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT  11 __data_start
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS __end__
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT ABS __exidx_start
@


1.1
log
@bfd/
	* elf32-arm.c (PLT_THUMB_STUB_SIZE): Define.
	(elf32_arm_plt_thumb_stub): New.
	(struct elf32_arm_link_hash_entry): Add plt_thumb_refcount
	and plt_got_offset.
	(elf32_arm_link_hash_traverse): Fix typo.
	(elf32_arm_link_hash_table): Add obfd.
	(elf32_arm_link_hash_newfunc): Initialize new fields.
	(elf32_arm_copy_indirect_symbol): Copy plt_thumb_refcount.
	(elf32_arm_link_hash_table_create): Initialize obfd.
	(record_arm_to_thumb_glue): Mark the glue as a local ARM function.
	(record_thumb_to_arm_glue): Mark the glue as a local Thumb function.
	(bfd_elf32_arm_get_bfd_for_interworking): Verify that the
	interworking BFD is not dynamic.
	(bfd_elf32_arm_process_before_allocation): Handle R_ARM_PLT32.  Do
	not emit glue for PLT references.
	(elf32_arm_final_link_relocate): Handle Thumb functions.  Do not
	emit glue for PLT references.  Support the Thumb PLT prefix.
	(elf32_arm_gc_sweep_hook): Handle R_ARM_THM_PC22 and
	plt_thumb_refcount.
	(elf32_arm_check_relocs): Likewise.
	(elf32_arm_adjust_dynamic_symbol): Handle Thumb functions and
	plt_thumb_refcount.
	(allocate_dynrelocs): Handle Thumb PLT references.
	(elf32_arm_finish_dynamic_symbol): Likewise.
	(elf32_arm_symbol_processing): New function.
	(elf_backend_symbol_processing): Define.
opcodes/
	* arm-dis.c (WORD_ADDRESS): Define.
	(print_insn): Use it.  Correct big-endian end-of-section handling.
gas/testsuite/
	* gas/arm/mapping.d: Expect F markers for Thumb code.
	* gas/arm/unwind.d: Update big-endian pattern.
ld/
	* emultempl/armelf.em (arm_elf_set_bfd_for_interworking): Don't use
	a dynamic object for stubs.
ld/testsuite/
	* ld-arm/mixed-app.d, ld-arm/mixed-app.r, ld-arm/mixed-app.s,
	ld-arm/mixed-app.sym, ld-arm/mixed-lib.d, ld-arm/mixed-lib.r,
	ld-arm/mixed-lib.s, ld-arm/mixed-lib.sym, ld-arm/arm-dyn.ld,
	ld-arm/arm-lib.ld: New files.
	* ld-arm/arm-app-abs32.d, ld-arm/arm-app-abs32.r, ld-arm/arm-app.d,
	ld-arm/arm-app.r, ld-arm/arm-lib-plt32.d, ld-arm/arm-lib-plt32.r,
	ld-arm/arm-lib.d, ld-arm/arm-lib.r, ld-arm/arm-static-app.d,
	ld-arm/arm-static-app.r: Update for big-endian.
	* ld-arm/arm-elf.exp: Run the new tests.
@
text
@d10 1
a10 1
   ..  ..: ........     0  NOTYPE GLOBAL DEFAULT  13 _stack
@

