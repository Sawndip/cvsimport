head	1.1;
access;
symbols
	binutils-2_24-branch:1.1.0.40
	binutils-2_24-branchpoint:1.1
	binutils-2_21_1:1.1
	binutils-2_23_2:1.1
	binutils-2_23_1:1.1
	binutils-2_23:1.1
	binutils-2_23-branch:1.1.0.38
	binutils-2_23-branchpoint:1.1
	binutils-2_22_branch:1.1.0.36
	binutils-2_22:1.1
	binutils-2_22-branch:1.1.0.34
	binutils-2_22-branchpoint:1.1
	binutils-2_21:1.1
	binutils-2_21-branch:1.1.0.32
	binutils-2_21-branchpoint:1.1
	binutils-2_20_1:1.1
	binutils-2_20:1.1
	binutils-arc-20081103-branch:1.1.0.30
	binutils-arc-20081103-branchpoint:1.1
	binutils-2_20-branch:1.1.0.28
	binutils-2_20-branchpoint:1.1
	dje-cgen-play1-branch:1.1.0.26
	dje-cgen-play1-branchpoint:1.1
	arc-20081103-branch:1.1.0.24
	arc-20081103-branchpoint:1.1
	binutils-2_19_1:1.1
	binutils-2_19:1.1
	binutils-2_19-branch:1.1.0.22
	binutils-2_19-branchpoint:1.1
	binutils-2_18:1.1
	binutils-2_18-branch:1.1.0.20
	binutils-2_18-branchpoint:1.1
	binutils-csl-coldfire-4_1-32:1.1
	binutils-csl-sourcerygxx-4_1-32:1.1
	binutils-csl-innovasic-fido-3_4_4-33:1.1
	binutils-csl-sourcerygxx-3_4_4-32:1.1
	binutils-csl-coldfire-4_1-30:1.1
	binutils-csl-sourcerygxx-4_1-30:1.1
	binutils-csl-coldfire-4_1-28:1.1
	binutils-csl-sourcerygxx-4_1-29:1.1
	binutils-csl-sourcerygxx-4_1-28:1.1
	binutils-csl-arm-2006q3-27:1.1
	binutils-csl-sourcerygxx-4_1-27:1.1
	binutils-csl-arm-2006q3-26:1.1
	binutils-csl-sourcerygxx-4_1-26:1.1
	binutils-csl-sourcerygxx-4_1-25:1.1
	binutils-csl-sourcerygxx-4_1-24:1.1
	binutils-csl-sourcerygxx-4_1-23:1.1
	binutils-csl-sourcerygxx-4_1-21:1.1
	binutils-csl-arm-2006q3-21:1.1
	binutils-csl-sourcerygxx-4_1-22:1.1
	binutils-csl-palmsource-arm-prelinker-1_0-1:1.1
	binutils-csl-sourcerygxx-4_1-20:1.1
	binutils-csl-arm-2006q3-19:1.1
	binutils-csl-sourcerygxx-4_1-19:1.1
	binutils-csl-sourcerygxx-4_1-18:1.1
	binutils-csl-renesas-4_1-9:1.1
	binutils-csl-sourcerygxx-3_4_4-25:1.1
	binutils-csl-renesas-4_1-8:1.1
	binutils-csl-renesas-4_1-7:1.1
	binutils-csl-renesas-4_1-6:1.1
	binutils-csl-sourcerygxx-4_1-17:1.1
	binutils-csl-sourcerygxx-4_1-14:1.1
	binutils-csl-sourcerygxx-4_1-15:1.1
	binutils-csl-sourcerygxx-4_1-13:1.1
	binutils-2_17:1.1
	binutils-csl-sourcerygxx-4_1-12:1.1
	binutils-csl-sourcerygxx-3_4_4-21:1.1
	binutils-csl-wrs-linux-3_4_4-24:1.1
	binutils-csl-wrs-linux-3_4_4-23:1.1
	binutils-csl-sourcerygxx-4_1-9:1.1
	binutils-csl-sourcerygxx-4_1-8:1.1
	binutils-csl-sourcerygxx-4_1-7:1.1
	binutils-csl-arm-2006q1-6:1.1
	binutils-csl-sourcerygxx-4_1-6:1.1
	binutils-csl-wrs-linux-3_4_4-22:1.1
	binutils-csl-coldfire-4_1-11:1.1
	binutils-csl-sourcerygxx-3_4_4-19:1.1
	binutils-csl-coldfire-4_1-10:1.1
	binutils-csl-sourcerygxx-4_1-5:1.1
	binutils-csl-sourcerygxx-4_1-4:1.1
	binutils-csl-wrs-linux-3_4_4-21:1.1
	binutils-csl-morpho-4_1-4:1.1
	binutils-csl-sourcerygxx-3_4_4-17:1.1
	binutils-csl-wrs-linux-3_4_4-20:1.1
	binutils-2_17-branch:1.1.0.18
	binutils-2_17-branchpoint:1.1
	binutils-csl-2_17-branch:1.1.0.16
	binutils-csl-2_17-branchpoint:1.1
	binutils-csl-gxxpro-3_4-branch:1.1.0.14
	binutils-csl-gxxpro-3_4-branchpoint:1.1
	binutils-2_16_1:1.1
	binutils-csl-arm-2005q1b:1.1
	binutils-2_16:1.1
	binutils-csl-arm-2005q1a:1.1
	binutils-csl-arm-2005q1-branch:1.1.0.12
	binutils-csl-arm-2005q1-branchpoint:1.1
	binutils-2_16-branch:1.1.0.10
	binutils-2_16-branchpoint:1.1
	csl-arm-2004-q3d:1.1
	csl-arm-2004-q3:1.1
	binutils-2_15:1.1
	binutils-2_15-branchpoint:1.1
	csl-arm-2004-q1a:1.1
	csl-arm-2004-q1:1.1
	binutils-2_15-branch:1.1.0.8
	cagney_bfdfile-20040213-branch:1.1.0.6
	cagney_bfdfile-20040213-branchpoint:1.1
	cagney_bigcore-20040122-branch:1.1.0.4
	cagney_bigcore-20040122-branchpoint:1.1
	csl-arm-2003-q4:1.1
	binutils-2_14:1.1
	binutils-2_14-branch:1.1.0.2
	binutils-2_14-branchpoint:1.1
	binutils_latest_snapshot:1.1;
locks; strict;
comment	@# @;


1.1
date	2002.10.14.21.20.16;	author ciceron;	state Exp;
branches;
next	;


desc
@@


1.1
log
@	* ld-m68hc11/m68hc11.exp: Specific tests for 68HC11/68HC12.
	* ld-m68hc11/adj-jump.d: New test for linker relaxation.
	* ld-m68hc11/adj-jump.s: Likewise.
	* ld-m68hc11/adj-brset.s: Likewise.
	* ld-m68hc11/adj-brset.d: Likewise.
	* ld-m68hc11/relax-direct.s: Likewise.
	* ld-m68hc11/relax-direct.d: Likewise.
	* ld-m68hc11/relax-group.s: Likewise.
	* ld-m68hc11/relax-group.d: Likewise.
	* ld-m68hc11/bug-1403.d: Likewise.
	* ld-m68hc11/bug-1403.s: Likewise.
@
text
@;;; Test 68HC11 linker relaxation (group relax)
;;; 
	.sect .text
	.globl _start
_start:
;;;
;;; The following group of instructions are adjusted.
;;;
	.relax	L1x
	ldx	#table
	bset	0,x #4
L1x:
	.relax	L1y
	ldy	#table
	bset	0,y #4
L1y:
	.relax	L2x
	ldx	#table+3
	bset	0,x #4
	bset	1,x #8
L2x:
	.relax	L2y
	ldy	#table+3
	bset	0,y #4
	bset	1,y #8
L2y:
	.relax	L3x
	ldx	#table+6
	bset	0,x #4
	bset	1,x #8
	bset	2,x #12
	bset	3,x #12
	bset	4,x #12
	bset	5,x #12
L3x:
	.relax	L3y
	ldy	#table+6
	bset	0,y #4
	bset	1,y #8
	bset	2,y #12
	bset	3,y #12
	bset	4,y #12
	bset	5,y #12
L3y:
	;; Next branch is always relative.  It must be adjusted while
	;; above instructions are relaxed.
	bra	_start
;;;
;;; This group has the first two bset insn relaxable while the
;;; others are not.  The ldx/ldy must not be removed.
;;; 
	.relax	L4x
	ldx	#table+0xfe
	bset	0,x #4
	bset	1,x #8
	bset	2,x #12
	bset	3,x #12
	bset	4,x #12
	bset	5,x #12
L4x:
	.relax	L4y
	ldy	#table+0xfe
	bset	0,y #4
	bset	1,y #8
	bset	2,y #12
	bset	3,y #12
	bset	4,y #12
	bset	5,y #12
L4y:
;;;
;;; Relax group for bclr
;;; 
	.relax	L5x
	ldx	#table+10
	bclr	0,x #4
	bclr	1,x #8
L5x:
	.relax	L5y
	ldy	#table+16
	bclr	10,y #4
	bclr	11,y #8
L5y:
;;;
;;; Relax group for brset (with backward branch)
;;; 
	.relax	L6x
	ldx	#table+8
	brset	0,x #4 L5y
L6x:
	.relax	L7x
	ldy	#table+8
	brset	0,y #4 L6x
L7x:
;;;
;;; Relax group for brset (with forward branch)
;;; 
	.relax	L8x
	ldx	#table+8
	brset	0,x #4 brend
L8x:
	.relax	L8y
	ldy	#table+8
	brset	0,y #4 brend
L8y:
;;;
;;; Relax group for brclr (with backward branch)
;;; 
	.relax	L9x
	ldx	#table+8
	brclr	0,x #4 L8y
L9x:
	.relax	L9y
	ldy	#table+8
	brclr	0,y #4 L9x
L9y:
;;;
;;; Relax group for brclr (with forward branch)
;;; 
	.relax	L10x
	ldx	#table+8
	brclr	0,x #4 brend
L10x:
	.relax	L10y
	ldy	#table+8
	brclr	0,y #4 brend
L10y:
	nop
brend:
;;;
;;; The following are wrong use of .relax groups.
;;;
	.relax	w1
w1:
	.relax	w2
	bset	0,x #4
w2:
	.relax w3
	ldx	#table
w3:
	.relax w4
	ldy	#table+8
w4:
	.relax w5
	rts
w5:
;;;
;;; Next insn is not in a .relax group
	ldx	#table
	bset	0,x #5
	bra	_start
	rts

	.sect .page0
	.globl table
table:	.long 0
table4:	.long 0
table8:	.long 0
	.skip	10
end_table:
	.long 0

@
