head	1.7;
access;
symbols
	binutils-2_24-branch:1.7.0.22
	binutils-2_24-branchpoint:1.7
	binutils-2_21_1:1.7
	binutils-2_23_2:1.7
	binutils-2_23_1:1.7
	binutils-2_23:1.7
	binutils-2_23-branch:1.7.0.20
	binutils-2_23-branchpoint:1.7
	binutils-2_22_branch:1.7.0.18
	binutils-2_22:1.7
	binutils-2_22-branch:1.7.0.16
	binutils-2_22-branchpoint:1.7
	binutils-2_21:1.7
	binutils-2_21-branch:1.7.0.14
	binutils-2_21-branchpoint:1.7
	binutils-2_20_1:1.7
	binutils-2_20:1.7
	binutils-arc-20081103-branch:1.7.0.12
	binutils-arc-20081103-branchpoint:1.7
	binutils-2_20-branch:1.7.0.10
	binutils-2_20-branchpoint:1.7
	dje-cgen-play1-branch:1.7.0.8
	dje-cgen-play1-branchpoint:1.7
	arc-20081103-branch:1.7.0.6
	arc-20081103-branchpoint:1.7
	binutils-2_19_1:1.7
	binutils-2_19:1.7
	binutils-2_19-branch:1.7.0.4
	binutils-2_19-branchpoint:1.7
	binutils-2_18:1.7
	binutils-2_18-branch:1.7.0.2
	binutils-2_18-branchpoint:1.7
	binutils-csl-coldfire-4_1-32:1.6
	binutils-csl-sourcerygxx-4_1-32:1.6
	binutils-csl-innovasic-fido-3_4_4-33:1.6
	binutils-csl-sourcerygxx-3_4_4-32:1.2
	binutils-csl-coldfire-4_1-30:1.6
	binutils-csl-sourcerygxx-4_1-30:1.6
	binutils-csl-coldfire-4_1-28:1.6
	binutils-csl-sourcerygxx-4_1-29:1.6
	binutils-csl-sourcerygxx-4_1-28:1.6
	binutils-csl-arm-2006q3-27:1.6
	binutils-csl-sourcerygxx-4_1-27:1.6
	binutils-csl-arm-2006q3-26:1.6
	binutils-csl-sourcerygxx-4_1-26:1.6
	binutils-csl-sourcerygxx-4_1-25:1.6
	binutils-csl-sourcerygxx-4_1-24:1.6
	binutils-csl-sourcerygxx-4_1-23:1.6
	binutils-csl-sourcerygxx-4_1-21:1.6
	binutils-csl-arm-2006q3-21:1.6
	binutils-csl-sourcerygxx-4_1-22:1.6
	binutils-csl-palmsource-arm-prelinker-1_0-1:1.6
	binutils-csl-sourcerygxx-4_1-20:1.6
	binutils-csl-arm-2006q3-19:1.6
	binutils-csl-sourcerygxx-4_1-19:1.6
	binutils-csl-sourcerygxx-4_1-18:1.6
	binutils-csl-renesas-4_1-9:1.6
	binutils-csl-sourcerygxx-3_4_4-25:1.2
	binutils-csl-renesas-4_1-8:1.6
	binutils-csl-renesas-4_1-7:1.6
	binutils-csl-renesas-4_1-6:1.6
	binutils-csl-sourcerygxx-4_1-17:1.6
	binutils-csl-sourcerygxx-4_1-14:1.6
	binutils-csl-sourcerygxx-4_1-15:1.6
	binutils-csl-sourcerygxx-4_1-13:1.6
	binutils-2_17:1.6
	binutils-csl-sourcerygxx-4_1-12:1.6
	binutils-csl-sourcerygxx-3_4_4-21:1.6
	binutils-csl-wrs-linux-3_4_4-24:1.2
	binutils-csl-wrs-linux-3_4_4-23:1.2
	binutils-csl-sourcerygxx-4_1-9:1.6
	binutils-csl-sourcerygxx-4_1-8:1.6
	binutils-csl-sourcerygxx-4_1-7:1.6
	binutils-csl-arm-2006q1-6:1.6
	binutils-csl-sourcerygxx-4_1-6:1.6
	binutils-csl-wrs-linux-3_4_4-22:1.2
	binutils-csl-coldfire-4_1-11:1.6
	binutils-csl-sourcerygxx-3_4_4-19:1.6
	binutils-csl-coldfire-4_1-10:1.6
	binutils-csl-sourcerygxx-4_1-5:1.6
	binutils-csl-sourcerygxx-4_1-4:1.6
	binutils-csl-wrs-linux-3_4_4-21:1.2
	binutils-csl-morpho-4_1-4:1.6
	binutils-csl-sourcerygxx-3_4_4-17:1.6
	binutils-csl-wrs-linux-3_4_4-20:1.2
	binutils-2_17-branch:1.6.0.4
	binutils-2_17-branchpoint:1.6
	binutils-csl-2_17-branch:1.6.0.2
	binutils-csl-2_17-branchpoint:1.6
	binutils-csl-gxxpro-3_4-branch:1.2.0.6
	binutils-csl-gxxpro-3_4-branchpoint:1.2
	binutils-2_16_1:1.2
	binutils-csl-arm-2005q1b:1.2
	binutils-2_16:1.2
	binutils-csl-arm-2005q1a:1.2
	binutils-csl-arm-2005q1-branch:1.2.0.4
	binutils-csl-arm-2005q1-branchpoint:1.2
	binutils-2_16-branch:1.2.0.2
	binutils-2_16-branchpoint:1.2
	csl-arm-2004-q3d:1.1
	binutils_latest_snapshot:1.7;
locks; strict;
comment	@# @;


1.7
date	2006.10.17.13.41.48;	author amodra;	state Exp;
branches;
next	1.6;

1.6
date	2005.08.15.15.39.45;	author amodra;	state Exp;
branches;
next	1.5;

1.5
date	2005.08.12.00.23.48;	author hp;	state Exp;
branches;
next	1.4;

1.4
date	2005.07.08.06.22.01;	author amodra;	state Exp;
branches;
next	1.3;

1.3
date	2005.03.23.19.04.33;	author hjl;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.08.02.31.40;	author hp;	state Exp;
branches;
next	1.1;

1.1
date	2004.11.04.15.04.05;	author hp;	state Exp;
branches;
next	;


desc
@@


1.7
log
@bfd/
	* elf-bfd.h (struct elf_link_hash_table): Reorder.  Add
	text_index_section and data_index_section.
	(struct elf_backend_data): Add elf_backend_init_index_section.
	(_bfd_elf_init_1_index_section): Declare.
	(_bfd_elf_init_2_index_sections): Declare.
	* elfxx-target.h (elf_backend_init_index_section): Define.
	(elfNN_bed): Init new field.
	* elflink.c (_bfd_elf_link_omit_section_dynsym): Keep first tls
	section and text_index_section plus data_index_section.
	(_bfd_elf_link_renumber_dynsyms): Clear dynindx on omitted sections.
	(_bfd_elf_init_1_index_section): New function.
	(_bfd_elf_init_2_index_sections): New function.
	(bfd_elf_size_dynsym_hash_dynstr): Call elf_backend_init_index_section.
	(elf_link_input_bfd): When emitting relocs, use text_index_section
	and data_index_section for removed sections.
	* elf-m10300.c (elf_backend_omit_section_dynsym): Define.
	* elf32-i386.c: Likewise.
	* elf32-m32r.c: Likewise.
	* elf32-sh.c: Likewise.
	* elf32-xstormy16.c: Likewise.
	* elf32-xtensa.c: Likewise.
	* elf64-alpha.c: Likewise.
	* elf64-hppa.c: Likewise.
	* elf64-mmix.c: Likewise.
	* elf64-sh64.c: Likewise.
	* elfxx-ia64.c: Likewise.
	* elf32-arm.c (elf32_arm_final_link_relocate): Use text_index_section
	and data_index_section sym for relocs against sections with no dynamic
	section sym.
	(elf_backend_init_index_section): Define.
	* elf32-cris.c: Similarly.
	* elf32-hppa.c: Similarly.
	* elf32-i370.c: Similarly.
	* elf32-m68k.c: Similarly.
	* elf32-mips.c: Similarly.
	* elf32-ppc.c: Similarly.
	* elf32-s390.c: Similarly.
	* elf32-sparc.c: Similarly.
	* elf32-vax.c: Similarly.
	* elf64-mips.c: Similarly.
	* elf64-ppc.c: Similarly.
	* elf64-s390.c: Similarly.
	* elf64-sparc.c: Similarly.
	* elf64-x86-64.c: Similarly.
	* elfn32-mips.c: Similarly.
	* elfxx-mips.c: Similarly.
	* elfxx-sparc.c: Similarly.
	* linker.c (fix_syms): Base symbols in removed sections on
	previous section in preference to using absolute section.

ld/
	* ldlang.c (strip_excluded_output_sections): Do strip sections
	that define syms, but don't ignore them.
	* ld.texinfo (Output Section Discarding): Revise.
	* emultempl/armcoff.em (gld${EMULATION_NAME}_finish): Always call
	finish_default.

ld/testsuite/
	Update for section sym changes.
@
text
@#source: expdyn1.s
#source: dsov32-1.s
#source: dsov32-2.s
#as: --pic --no-underscore --march=v32 --em=criself
#ld: --shared -m crislinux -z nocombreloc
#objdump: -s -T

# Check for common DSO contents; load of GOT register, branch to
# function PLT, undefined symbol, GOT reloc.

.*:     file format elf32-cris

DYNAMIC SYMBOL TABLE:
#...
0+23e g    DF \.text	0+12 dsofn4
0+234 g    DF \.text	0+2 expfn
0+22fc g    DO \.data	0+4 expobj
#...
0+236 g    DF \.text	0+8 dsofn3
#...
0+      D  \*UND\*	0+ dsofn
#...
Contents of section \.rela\.got:
 01c0 f8220000 0a040000 00000000           .*
Contents of section \.rela\.plt:
 01cc f0220000 0b020000 00000000 f4220000  .*
 01dc 0b0a0000 00000000                    .*
Contents of section \.plt:
 01e4 84e20401 7e7a3f7a 04f26ffa bf09b005  .*
 01f4 00000000 00000000 00006f0d 0c000000  .*
 0204 6ffabf09 b0053f7e 00000000 bf0ed4ff  .*
 0214 ffffb005 6f0d1000 00006ffa bf09b005  .*
 0224 3f7e0c00 0000bf0e baffffff b005      .*
Contents of section \.text:
 0232 b005b005 bfbee2ff ffffb005 7f0da620  .*
 0242 00005f0d 1400bfbe b6ffffff b0050000  .*
Contents of section \.dynamic:
 2254 04000000 94000000 05000000 84010000  .*
 2264 06000000 d4000000 0a000000 3a000000  .*
 2274 0b000000 10000000 03000000 e4220000  .*
 2284 02000000 18000000 14000000 07000000  .*
 2294 17000000 cc010000 07000000 c0010000  .*
 22a4 08000000 0c000000 09000000 0c000000  .*
 22b4 00000000 00000000 00000000 00000000  .*
 22c4 00000000 00000000 00000000 00000000  .*
 22d4 00000000 00000000 00000000 00000000  .*
Contents of section \.got:
 22e4 54220000 00000000 00000000 0a020000  .*
 22f4 24020000 00000000                    .*
Contents of section \.data:
 22fc 00000000                             .*
@


1.6
log
@Adjust for dynamic sym changes.
@
text
@d15 3
a17 3
0+252 g    DF \.text	0+12 dsofn4
0+248 g    DF \.text	0+2 expfn
0+2310 g    DO \.data	0+4 expobj
d19 1
a19 1
0+24a g    DF \.text	0+8 dsofn3
d24 1
a24 1
 01d4 0c230000 0a050000 00000000           .*
d26 2
a27 2
 01e0 04230000 0b030000 00000000 08230000  .*
 01f0 0b0b0000 00000000                    .*
d29 5
a33 5
 01f8 84e20401 7e7a3f7a 04f26ffa bf09b005  .*
 0208 00000000 00000000 00006f0d 0c000000  .*
 0218 6ffabf09 b0053f7e 00000000 bf0ed4ff  .*
 0228 ffffb005 6f0d1000 00006ffa bf09b005  .*
 0238 3f7e0c00 0000bf0e baffffff b005      .*
d35 2
a36 2
 0246 b005b005 bfbee2ff ffffb005 7f0da620  .*
 0256 00005f0d 1400bfbe b6ffffff b0050000  .*
d38 9
a46 9
 2268 04000000 94000000 05000000 98010000  .*
 2278 06000000 d8000000 0a000000 3a000000  .*
 2288 0b000000 10000000 03000000 f8220000  .*
 2298 02000000 18000000 14000000 07000000  .*
 22a8 17000000 e0010000 07000000 d4010000  .*
 22b8 08000000 0c000000 09000000 0c000000  .*
 22c8 00000000 00000000 00000000 00000000  .*
 22d8 00000000 00000000 00000000 00000000  .*
 22e8 00000000 00000000 00000000 00000000  .*
d48 2
a49 2
 22f8 68220000 00000000 00000000 1e020000  .*
 2308 38020000 00000000                    .*
d51 1
a51 1
 2310 00000000                             .*
@


1.5
log
@	* ld-cris/expdyn1.s (expobj): Set size here, at definition...
	* ld-cris/pv32.s: ...not here.
	* ld-cris/expdyn1.d, ld-cris/libdso-12.d, ld-cris/locref1.d:
	Adjust for expobj size being set at definition.
@
text
@d15 3
a17 3
0+26e g    DF \.text	0+12 dsofn4
0+264 g    DF \.text	0+2 expfn
0+232c g    DO \.data	0+4 expobj
d19 1
a19 1
0+266 g    DF \.text	0+8 dsofn3
d24 1
a24 1
 01f0 28230000 0a060000 00000000           .*
d26 2
a27 2
 01fc 20230000 0b040000 00000000 24230000  .*
 020c 0b0c0000 00000000                    .*
d29 5
a33 5
 0214 84e20401 7e7a3f7a 04f26ffa bf09b005  .*
 0224 00000000 00000000 00006f0d 0c000000  .*
 0234 6ffabf09 b0053f7e 00000000 bf0ed4ff  .*
 0244 ffffb005 6f0d1000 00006ffa bf09b005  .*
 0254 3f7e0c00 0000bf0e baffffff b005      .*
d35 2
a36 2
 0262 b005b005 bfbee2ff ffffb005 7f0da620  .*
 0272 00005f0d 1400bfbe b6ffffff b0050000  .*
d38 9
a46 9
 2284 04000000 94000000 05000000 ac010000  .*
 2294 06000000 dc000000 0a000000 43000000  .*
 22a4 0b000000 10000000 03000000 14230000  .*
 22b4 02000000 18000000 14000000 07000000  .*
 22c4 17000000 fc010000 07000000 f0010000  .*
 22d4 08000000 0c000000 09000000 0c000000  .*
 22e4 00000000 00000000 00000000 00000000  .*
 22f4 00000000 00000000 00000000 00000000  .*
 2304 00000000 00000000 00000000 00000000  .*
d48 2
a49 2
 2314 84220000 00000000 00000000 3a020000  .*
 2324 54020000 00000000                    .*
d51 1
a51 1
 232c 00000000                             .*
@


1.4
log
@	* ld-cris/pv32.s: Give expobj a size.
	* ld-cris/pv32-1.d: Update.
	* ld-alpha/tlsbin.dd: Update for empty section removal change.
	* ld-alpha/tlsbin.sd: Likewise.
	* ld-alpha/tlsbin.td: Likewise.
	* ld-alpha/tlsbinr.dd: Likewise.
	* ld-alpha/tlsbinr.rd: Likewise.
	* ld-alpha/tlspic.dd: Likewise.
	* ld-alpha/tlspic.rd: Likewise.
	* ld-alpha/tlspic.sd: Likewise.
	* ld-alpha/tlspic.td: Likewise.
	* ld-arm/tls-lib.d: Likewise.
	* ld-arm/tls-lib.r: Likewise.
	* ld-cris/gotplt2.d: Likewise.
	* ld-cris/gotplt3.d: Likewise.
	* ld-cris/hiddef1.d: Likewise.
	* ld-cris/libdso-10.d: Likewise.
	* ld-cris/libdso-11.d: Likewise.
	* ld-cris/libdso-12.d: Likewise.
	* ld-cris/libdso-14.d: Likewise.
	* ld-cris/libdso-2.d: Likewise.
	* ld-i386/tlsnopic.dd: Likewise.
	* ld-i386/tlsnopic.rd: Likewise.
	* ld-i386/tlsnopic.sd: Likewise.
	* ld-i386/tlspic.rd: Likewise.
	* ld-mmix/bpo-10.d: Likewise.
	* ld-mmix/bpo-22.d: Likewise.
	* ld-mmix/sec-7m.d: Likewise.
	* ld-powerpc/tlsexe.r: Likewise.
	* ld-powerpc/tlsexetoc.r: Likewise.
	* ld-powerpc/tlsso.g: Likewise.
	* ld-powerpc/tlsso.r: Likewise.
	* ld-powerpc/tlsso32.d: Likewise.
	* ld-powerpc/tlsso32.g: Likewise.
	* ld-powerpc/tlsso32.r: Likewise.
	* ld-powerpc/tlstocso.g: Likewise.
	* ld-powerpc/tlstocso.r: Likewise.
@
text
@d17 1
a17 1
0+232c g    DO \.data	0+ expobj
@


1.3
log
@2005-03-23  H.J. Lu  <hongjiu.lu@@intel.com>

	* ld-cris/expdyn5.d: Updated for alignment change in elf.sc.
	* ld-cris/expdyn6.d: Likewise.
	* ld-cris/expdyn7.d: Likewise.
	* ld-cris/gotplt1.d: Likewise.
	* ld-cris/gotplt2.d: Likewise.
	* ld-cris/gotplt3.d: Likewise.
	* ld-cris/libdso-10.d: Likewise.
	* ld-cris/libdso-11.d: Likewise.
	* ld-cris/libdso-12.d: Likewise.
	* ld-cris/libdso-14.d: Likewise.
	* ld-cris/libdso-2.d: Likewise.
	* ld-cris/locref1.d: Likewise.
	* ld-cris/locref2.d: Likewise.
	* ld-cris/nodyn5.d: Likewise.
	* ld-cris/pv32-1.d: Likewise.
	* ld-cris/weakref2.d: Likewise.
@
text
@d15 3
a17 3
0+282 g    DF \.text	0+12 dsofn4
0+278 g    DF \.text	0+2 expfn
0+2340 g    DO \.data	0+ expobj
d19 1
a19 1
0+27a g    DF \.text	0+8 dsofn3
d24 1
a24 1
 0204 3c230000 0a070000 00000000           .*
d26 2
a27 2
 0210 34230000 0b050000 00000000 38230000  .*
 0220 0b0d0000 00000000                    .*
d29 5
a33 5
 0228 84e20401 7e7a3f7a 04f26ffa bf09b005  .*
 0238 00000000 00000000 00006f0d 0c000000  .*
 0248 6ffabf09 b0053f7e 00000000 bf0ed4ff  .*
 0258 ffffb005 6f0d1000 00006ffa bf09b005  .*
 0268 3f7e0c00 0000bf0e baffffff b005      .*
d35 2
a36 2
 0276 b005b005 bfbee2ff ffffb005 7f0da620  .*
 0286 00005f0d 1400bfbe b6ffffff b0050000  .*
d38 9
a46 9
 2298 04000000 94000000 05000000 c0010000  .*
 22a8 06000000 e0000000 0a000000 43000000  .*
 22b8 0b000000 10000000 03000000 28230000  .*
 22c8 02000000 18000000 14000000 07000000  .*
 22d8 17000000 10020000 07000000 04020000  .*
 22e8 08000000 0c000000 09000000 0c000000  .*
 22f8 00000000 00000000 00000000 00000000  .*
 2308 00000000 00000000 00000000 00000000  .*
 2318 00000000 00000000 00000000 00000000  .*
d48 2
a49 2
 2328 98220000 00000000 00000000 4e020000  .*
 2338 68020000 00000000                    .*
d51 1
a51 1
 2340 00000000                             .*
@


1.2
log
@	Adjust testsuite for cris-axis-aout.
	* ld-cris/noglob1.d: Adjust regexp for a.out output.
	* ld-cris/badgotr1.d, ld-cris/expdyn1.d, ld-cris/expdyn2.d,
	ld-cris/expdyn3.d, ld-cris/expdyn4.d, ld-cris/expdyn5.d,
	ld-cris/expdyn6.d, ld-cris/expdyn7.d, ld-cris/gotplt1.d,
	ld-cris/gotplt2.d, ld-cris/gotplt3.d, ld-cris/hiddef1.d,
	ld-cris/libdso-1.d, ld-cris/libdso-10.d, ld-cris/libdso-11.d,
	ld-cris/libdso-12.d, ld-cris/libdso-13.d, ld-cris/libdso-14.d,
	ld-cris/libdso-2.d, ld-cris/libdso-3.d, ld-cris/libdso-4.d,
	ld-cris/locref1.d, ld-cris/locref2.d, ld-cris/nodyn4.d,
	ld-cris/nodyn5.d, ld-cris/pv32-1.d, ld-cris/undef1.d,
	ld-cris/weakref1.d: ld-cris/weakref2.d: Pass --em=criself to gas.
	* ld-cris/v10-v32.d, ld-cris/v10-va.d, ld-cris/v32-ba-1.d,
	ld-cris/v32-v10.d, ld-cris/v32-va.d, ld-cris/va-v10.d,
	ld-cris/va-v32.d: Ditto.  Pass -m criself to gld.
	* ld-cris/v32-bin-1.d: Pass -m criself to gld.
@
text
@d17 1
a17 1
0+2348 g    DO \.data	0+ expobj
d24 1
a24 1
 0204 44230000 0a070000 00000000           .*
d26 1
a26 1
 0210 3c230000 0b050000 00000000 40230000  .*
d35 1
a35 1
 0276 b005b005 bfbee2ff ffffb005 7f0dae20  .*
d38 9
a46 9
 22a0 04000000 94000000 05000000 c0010000  .*
 22b0 06000000 e0000000 0a000000 43000000  .*
 22c0 0b000000 10000000 03000000 30230000  .*
 22d0 02000000 18000000 14000000 07000000  .*
 22e0 17000000 10020000 07000000 04020000  .*
 22f0 08000000 0c000000 09000000 0c000000  .*
 2300 00000000 00000000 00000000 00000000  .*
 2310 00000000 00000000 00000000 00000000  .*
 2320 00000000 00000000 00000000 00000000  .*
d48 2
a49 2
 2330 a0220000 00000000 00000000 4e020000  .*
 2340 68020000 00000000                    .*
d51 1
a51 1
 2348 00000000                             .*
@


1.1
log
@	* ld-elf/merge.d: xfail crisv32-*-*.
	* ld-cris/dsov32-1.s, ld-cris/dsov32-2.s, ld-cris/dsov32-3.s,
	ld-cris/dsov32-4.s, ld-cris/libdso-10.d, ld-cris/libdso-11.d,
	ld-cris/libdso-12.d, ld-cris/libdso-13.d, ld-cris/libdso-14.d,
	ld-cris/move-1.s, ld-cris/pv32-1.d, ld-cris/pv32.s,
	ld-cris/start1.s, ld-cris/v10-v32.d, ld-cris/v10-va.d,
	ld-cris/v32-ba-1.d, ld-cris/v32-ba-1.s, ld-cris/v32-bin-1.d,
	ld-cris/v32-bin-1.s, ld-cris/v32-v10.d, ld-cris/v32-va.d,
	ld-cris/va-v10.d, ld-cris/va-v32.d: New tests.
	* ld-cris/ldsym1.d: Adjust for change in linker script.
@
text
@d4 1
a4 1
#as: --pic --no-underscore --march=v32
@

