head	1.7;
access;
symbols
	binutils-2_24-branch:1.7.0.26
	binutils-2_24-branchpoint:1.7
	binutils-2_21_1:1.7
	binutils-2_23_2:1.7
	binutils-2_23_1:1.7
	binutils-2_23:1.7
	binutils-2_23-branch:1.7.0.24
	binutils-2_23-branchpoint:1.7
	binutils-2_22_branch:1.7.0.22
	binutils-2_22:1.7
	binutils-2_22-branch:1.7.0.20
	binutils-2_22-branchpoint:1.7
	binutils-2_21:1.7
	binutils-2_21-branch:1.7.0.18
	binutils-2_21-branchpoint:1.7
	binutils-2_20_1:1.7
	binutils-2_20:1.7
	binutils-arc-20081103-branch:1.7.0.16
	binutils-arc-20081103-branchpoint:1.7
	binutils-2_20-branch:1.7.0.14
	binutils-2_20-branchpoint:1.7
	dje-cgen-play1-branch:1.7.0.12
	dje-cgen-play1-branchpoint:1.7
	arc-20081103-branch:1.7.0.10
	arc-20081103-branchpoint:1.7
	binutils-2_19_1:1.7
	binutils-2_19:1.7
	binutils-2_19-branch:1.7.0.8
	binutils-2_19-branchpoint:1.7
	binutils-2_18:1.7
	binutils-2_18-branch:1.7.0.6
	binutils-2_18-branchpoint:1.7
	binutils-csl-coldfire-4_1-32:1.7
	binutils-csl-sourcerygxx-4_1-32:1.7
	binutils-csl-innovasic-fido-3_4_4-33:1.7
	binutils-csl-sourcerygxx-3_4_4-32:1.5
	binutils-csl-coldfire-4_1-30:1.7
	binutils-csl-sourcerygxx-4_1-30:1.7
	binutils-csl-coldfire-4_1-28:1.7
	binutils-csl-sourcerygxx-4_1-29:1.7
	binutils-csl-sourcerygxx-4_1-28:1.7
	binutils-csl-arm-2006q3-27:1.7
	binutils-csl-sourcerygxx-4_1-27:1.7
	binutils-csl-arm-2006q3-26:1.7
	binutils-csl-sourcerygxx-4_1-26:1.7
	binutils-csl-sourcerygxx-4_1-25:1.7
	binutils-csl-sourcerygxx-4_1-24:1.7
	binutils-csl-sourcerygxx-4_1-23:1.7
	binutils-csl-sourcerygxx-4_1-21:1.7
	binutils-csl-arm-2006q3-21:1.7
	binutils-csl-sourcerygxx-4_1-22:1.7
	binutils-csl-palmsource-arm-prelinker-1_0-1:1.7
	binutils-csl-sourcerygxx-4_1-20:1.7
	binutils-csl-arm-2006q3-19:1.7
	binutils-csl-sourcerygxx-4_1-19:1.7
	binutils-csl-sourcerygxx-4_1-18:1.7
	binutils-csl-renesas-4_1-9:1.7
	binutils-csl-sourcerygxx-3_4_4-25:1.5
	binutils-csl-renesas-4_1-8:1.7
	binutils-csl-renesas-4_1-7:1.7
	binutils-csl-renesas-4_1-6:1.7
	binutils-csl-sourcerygxx-4_1-17:1.7
	binutils-csl-sourcerygxx-4_1-14:1.7
	binutils-csl-sourcerygxx-4_1-15:1.7
	binutils-csl-sourcerygxx-4_1-13:1.7
	binutils-2_17:1.7
	binutils-csl-sourcerygxx-4_1-12:1.7
	binutils-csl-sourcerygxx-3_4_4-21:1.7
	binutils-csl-wrs-linux-3_4_4-24:1.5
	binutils-csl-wrs-linux-3_4_4-23:1.5
	binutils-csl-sourcerygxx-4_1-9:1.7
	binutils-csl-sourcerygxx-4_1-8:1.7
	binutils-csl-sourcerygxx-4_1-7:1.7
	binutils-csl-arm-2006q1-6:1.7
	binutils-csl-sourcerygxx-4_1-6:1.7
	binutils-csl-wrs-linux-3_4_4-22:1.5
	binutils-csl-coldfire-4_1-11:1.7
	binutils-csl-sourcerygxx-3_4_4-19:1.7
	binutils-csl-coldfire-4_1-10:1.7
	binutils-csl-sourcerygxx-4_1-5:1.7
	binutils-csl-sourcerygxx-4_1-4:1.7
	binutils-csl-wrs-linux-3_4_4-21:1.5
	binutils-csl-morpho-4_1-4:1.7
	binutils-csl-sourcerygxx-3_4_4-17:1.7
	binutils-csl-wrs-linux-3_4_4-20:1.5
	binutils-2_17-branch:1.7.0.4
	binutils-2_17-branchpoint:1.7
	binutils-csl-2_17-branch:1.7.0.2
	binutils-csl-2_17-branchpoint:1.7
	binutils-csl-gxxpro-3_4-branch:1.5.0.6
	binutils-csl-gxxpro-3_4-branchpoint:1.5
	binutils-2_16_1:1.5
	binutils-csl-arm-2005q1b:1.5
	binutils-2_16:1.5
	binutils-csl-arm-2005q1a:1.5
	binutils-csl-arm-2005q1-branch:1.5.0.4
	binutils-csl-arm-2005q1-branchpoint:1.5
	binutils-2_16-branch:1.5.0.2
	binutils-2_16-branchpoint:1.5
	csl-arm-2004-q3d:1.5
	csl-arm-2004-q3:1.4
	binutils-2_15:1.3
	binutils-2_15-branchpoint:1.3
	csl-arm-2004-q1a:1.3
	csl-arm-2004-q1:1.3
	binutils-2_15-branch:1.3.0.6
	cagney_bfdfile-20040213-branch:1.3.0.4
	cagney_bfdfile-20040213-branchpoint:1.3
	cagney_bigcore-20040122-branch:1.3.0.2
	cagney_bigcore-20040122-branchpoint:1.3
	csl-arm-2003-q4:1.3
	binutils-2_14:1.2
	binutils-2_14-branch:1.2.0.2
	binutils-2_14-branchpoint:1.2
	binutils_latest_snapshot:1.7;
locks; strict;
comment	@# @;


1.7
date	2005.08.15.15.39.47;	author amodra;	state Exp;
branches;
next	1.6;

1.6
date	2005.07.08.16.20.24;	author hjl;	state Exp;
branches;
next	1.5;

1.5
date	2004.11.02.05.40.04;	author hp;	state Exp;
branches;
next	1.4;

1.4
date	2004.05.11.17.08.36;	author jakub;	state Exp;
branches;
next	1.3;

1.3
date	2003.09.30.18.03.54;	author hjl;	state Exp;
branches;
next	1.2;

1.2
date	2003.01.17.23.27.57;	author jakub;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.16.21.31.18;	author jakub;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Adjust for dynamic sym changes.
@
text
@#source: tlspic1.s
#source: tlspic2.s
#as:
#ld:
#objdump: -drj.text
#target: ia64-*-*

.*: +file format elf..-ia64-.*

Disassembly of section .text:

0+1000 <fn1>:
 +1000:	10 10 15 06 80 05[ 	]+\[MIB\] +alloc r34=ar.pfs,5,3,0
 +1006:	10 02 00 62 00 00[ 	]+mov r33=b0
 +100c:	00 00 00 20[ 	]+nop.b 0x0
 +1010:	0d 70 60 02 00 24[ 	]+\[MFI\] +addl r14=24,r1
 +1016:	00 00 00 02 00 e0[ 	]+nop.f 0x0
 +101c:	01 0a 00 90[ 	]+addl r15=32,r1;;
 +1020:	19 18 01 1c 18 10[ 	]+\[MMB\] +ld8 r35=\[r14\]
 +1026:	40 02 3c 30 20 00[ 	]+ld8 r36=\[r15\]
 +102c:	[0-9a-f 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
 +1030:	0d 70 c0 02 00 24[ 	]+\[MFI\] +addl r14=48,r1
 +1036:	00 00 00 02 00 e0[ 	]+nop.f 0x0
 +103c:	01 0c 00 90[ 	]+addl r15=64,r1;;
 +1040:	19 18 01 1c 18 10[ 	]+\[MMB\] +ld8 r35=\[r14\]
 +1046:	40 02 3c 30 20 00[ 	]+ld8 r36=\[r15\]
 +104c:	[0-9a-f 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
 +1050:	0d 70 c0 02 00 24[ 	]+\[MFI\] +addl r14=48,r1
 +1056:	00 00 00 02 00 80[ 	]+nop.f 0x0
 +105c:	14 02 00 90[ 	]+mov r36=33;;
 +1060:	1d 18 01 1c 18 10[ 	]+\[MFB\] +ld8 r35=\[r14\]
 +1066:	00 00 00 02 00 00[ 	]+nop.f 0x0
 +106c:	[0-9a-f 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
 +1070:	0d 70 c0 02 00 24[ 	]+\[MFI\] +addl r14=48,r1
 +1076:	00 00 00 02 00 80[ 	]+nop.f 0x0
 +107c:	04 00 00 84[ 	]+mov r36=r0;;
 +1080:	1d 18 01 1c 18 10[ 	]+\[MFB\] +ld8 r35=\[r14\]
 +1086:	00 00 00 02 00 00[ 	]+nop.f 0x0
 +108c:	[0-9a-f 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
 +1090:	0b 10 00 10 00 21[ 	]+\[MMI\] +mov r2=r8;;
 +1096:	e0 00 0a 00 48 e0[ 	]+addl r14=64,r2
 +109c:	21 16 00 90[ 	]+addl r15=98,r2;;
 +10a0:	05 70 4c 11 00 21[ 	]+\[MLX\] +adds r14=83,r8
 +10a6:	00 00 00 00 00 e0[ 	]+movl r15=0x71;;
 +10ac:	11 07 00 60 
 +10b0:	0b 78 3c 10 00 20[ 	]+\[MMI\] +add r15=r15,r8;;
 +10b6:	e0 40 05 00 48 00[ 	]+addl r14=40,r1
 +10bc:	00 00 04 00[ 	]+nop.i 0x0;;
 +10c0:	0b 78 00 1c 18 10[ 	]+\[MMI\] +ld8 r15=\[r14\];;
 +10c6:	e0 78 34 00 40 00[ 	]+add r14=r15,r13
 +10cc:	00 00 04 00[ 	]+nop.i 0x0;;
 +10d0:	0d 70 20 03 00 24[ 	]+\[MFI\] +addl r14=72,r1
 +10d6:	00 00 00 02 00 e0[ 	]+nop.f 0x0
 +10dc:	81 0b 00 90[ 	]+addl r15=56,r1;;
 +10e0:	09 70 00 1c 18 10[ 	]+\[MMI\] +ld8 r14=\[r14\]
 +10e6:	f0 00 3c 30 20 00[ 	]+ld8 r15=\[r15\]
 +10ec:	00 00 04 00[ 	]+nop.i 0x0;;
 +10f0:	02 70 38 1a 00 20[ 	]+\[MII\] +add r14=r14,r13
 +10f6:	f0 78 34 00 40 00[ 	]+add r15=r15,r13;;
 +10fc:	20 02 aa 00[ 	]+mov.i ar.pfs=r34
 +1100:	11 00 00 00 01 00[ 	]+\[MIB\] +nop.m 0x0
 +1106:	00 08 05 80 03 80[ 	]+mov b0=r33
 +110c:	08 00 84 00[ 	]+br.ret.sptk.many b0;;
#pass
@


1.6
log
@2005-07-08  H.J. Lu  <hongjiu.lu@@intel.com>

	* ld-ia64/tlsbin.rd: Update for empty section removal change.
	* ld-ia64/tlsbin.sd: Likewise.
	* ld-ia64/tlspic.dd: Likewise.
	* ld-ia64/tlspic.rd: Likewise.
	* ld-ia64/tlspic.sd: Likewise.
	* ld-x86-64/tlspic.dd: Likewise.
	* ld-x86-64/tlspic.rd: Likewise.
@
text
@d21 1
a21 1
 +102c:	28 f5 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
d27 1
a27 1
 +104c:	08 f5 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
d33 1
a33 1
 +106c:	e8 f4 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
d39 1
a39 1
 +108c:	c8 f4 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
@


1.5
log
@	* ld-cris/expdyn1.d, ld-cris/expdyn5.d, ld-cris/expdyn6.d,
	ld-cris/expdyn7.d, ld-cris/gotplt1.d, ld-cris/gotplt2.d,
	ld-cris/gotplt3.d, ld-cris/hiddef1.d, ld-cris/libdso-2.d,
	ld-cris/locref1.d, ld-cris/locref2.d, ld-cris/weakref2.d,
	ld-i386/tlsbin.rd, ld-i386/tlsnopic.rd, ld-i386/tlspic.rd,
	ld-ia64/tlsbin.dd, ld-ia64/tlsbin.rd, ld-ia64/tlspic.dd,
	ld-ia64/tlspic.rd, ld-powerpc/tlsexe32.d, ld-powerpc/tlsexe32.g,
	ld-powerpc/tlsexe32.r, ld-powerpc/tlsexe32.t,
	ld-powerpc/tlsso32.d, ld-powerpc/tlsso32.g, ld-powerpc/tlsso32.r,
	ld-powerpc/tlsso32.t, ld-s390/tlsbin.dd, ld-s390/tlsbin.rd,
	ld-s390/tlspic.rd, ld-sparc/tlssunbin32.rd,
	ld-sparc/tlssunpic32.rd, ld-x86-64/tlsbin.rd, ld-x86-64/tlspic.dd,
	ld-x86-64/tlspic.rd: Adjust for _GLOBAL_OFFSET_TABLE_ now hidden.
@
text
@d21 1
a21 1
 +102c:	68 f5 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
d27 1
a27 1
 +104c:	48 f5 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
d33 1
a33 1
 +106c:	28 f5 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
d39 1
a39 1
 +108c:	08 f5 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
@


1.4
log
@bfd/
	* elflink.c (elf_bfd_final_link): Don't output STT_SECTION symbol
	into .dynsym if elf_section_data (sec)->dynindx <= 0.
	Adjust counting of last_local.
	(_bfd_elf_link_renumber_dynsyms): Don't assign dynindx to sections
	other than SHT_PROGBITS/SHT_NOBITS and neither for .got/.got.plt/.plt
	created by the linker nor !SHF_ALLOC.

	* elf32-i386.c (elf_i386_finish_dynamic_sections): Point
	DT_PLTGOT to the start of the .got.plt section instead of the
	.got output section.  Set sh_entsize for .got section in addition
	to .got.plt.
	(elf_i386_relocate_section): Don't assume _GLOBAL_OFFSET_TABLE_
	is at sgot->output_section->vma.
	* elf64-x86-64.c (elf64_x86_64_finish_dynamic_sections): Point
	DT_PLTGOT to the start of the .got.plt section instead of the
	.got output section.
	(elf64_x86_64_relocate_section): Don't assume _GLOBAL_OFFSET_TABLE_
	is at sgot->output_section->vma.  Set sh_entsize for .got section
	in addition to .got.plt.
	* elf.c (_bfd_elf_print_private_bfd_data): Handle PT_GNU_RELRO.
	(bfd_section_from_phdr): Likewise.
	(map_sections_to_segments): Likewise.
	(assign_file_positions_for_segments): Likewise.
	(get_program_header_size): Likewise.
	* elflink.c (bfd_elf_size_dynamic_sections): Set
	elf_tdata (output_bfd)->relro from info->relro.
	* elf-bfd.h (struct elf_obj_tdata): Add relro field.
include/
	* bfdlink.h (struct bfd_link_info): Add relro, relro_start and
	relro_end fields.
	* elf/common.h (PT_GNU_EH_FRAME, PT_GNU_STACK): Add comments.
	(PT_GNU_RELRO): Define.
binutils/
	* readelf.c (get_segment_type): Handle PT_GNU_RELRO.
ld/
	* genscripts.sh: Generate -z combreloc -z now -z relro scripts
	for binaries, -shared and -pie.
	* emulparams/elf_i386.sh (SEPARATE_GOTPLT): Set.
	* emulparams/elf_x86_64.sh (SEPARATE_GOTPLT): Set.
	* emulparams/elf32ppc.sh (OTHER_READWRITE_SECTIONS): Rename to...
	(OTHER_RELRO_SECTIONS): ... this.
	* ldlex.l (DATA_SEGMENT_RELRO_END): Add.
	* emultempl/elf32.em (gld${EMULATION_NAME}_handle_option): Handle
	-z relro and -z norelro.
	(gld${EMULATION_NAME}_list_options): Add it to usage.
	(gld${EMULATION_NAME}_get_script): Return -z combreloc -z now
	-z relro scripts when appropriate.
	* scripttempl/elf.sc: Unset SEPARATE_GOTPLT if RELRO_NOW is set.
	Create separate .got.plt section if SEPARATE_GOTPLT.
	Move sections which are only written during relocation handling
	to the beginning of RW segment.  If NO_SMALL_DATA, move .got
	before .data.  Add DATA_SEGMENT_RELRO_END directive.
	Include OTHER_RELRO_SECTIONS.
	* ldgram.y (DATA_SEGMENT_RELRO_END): Add.
	* ldexp.c (exp_print_token): Handle DATA_SEGMENT_RELRO_END.
	(fold_unary): Likewise.
	(fold_binary): Handle -z relro.
	* ldexp.h (struct exp_data_seg): Add exp_dataseg_relro_seen and
	exp_dataseg_relro_adjust phases.  Add relro_end field.
	* ldmain.c (main): Initialize link_info.relro to FALSE.
	* ldlang.c (lang_size_sections): Handle -z relro.
ld/testsuite/
	* ld-i386/tlspic.rd: Adjust for section reordering changes
	and removal of unneeded STT_SECTION symbols from .dynsym.
	* ld-i386/tlspic.dd: Likewise.
	* ld-i386/tlspic.sd: Likewise.
	* ld-i386/tlsbin.rd: Likewise.
	* ld-i386/tlsbinpic.s: Likewise.
	* ld-i386/tlsbin.dd: Likewise.
	* ld-i386/tlsbin.sd: Likewise.
	* ld-i386/tlsnopic.rd: Likewise.
	* ld-i386/tlsnopic1.s: Likewise.
	* ld-i386/combreloc.d: Likewise.
	* ld-i386/tlsnopic.dd: Likewise.
	* ld-i386/tlsnopic.sd: Likewise.
	* ld-x86-64/tlspic.rd: Likewise.
	* ld-x86-64/tlspic.dd: Likewise.
	* ld-x86-64/tlsbin.dd: Likewise.
	* ld-x86-64/tlspic.sd: Likewise.
	* ld-x86-64/tlsbin.sd: Likewise.
	* ld-x86-64/tlspic.td: Likewise.
	* ld-x86-64/tlsbin.td: Likewise.
	* ld-x86-64/tlsbin.rd: Likewise.
	* ld-s390/tlspic1.s: Likewise.
	* ld-s390/tlsbinpic.s: Likewise.
	* ld-s390/tlspic.rd: Likewise.
	* ld-s390/tlsbin.rd: Likewise.
	* ld-s390/tlspic.dd: Likewise.
	* ld-s390/tlsbin.dd: Likewise.
	* ld-s390/tlsbin.sd: Likewise.
	* ld-s390/tlsbin.td: Likewise.
	* ld-s390/tlspic.sd: Likewise.
	* ld-s390/tlspic.td: Likewise.
	* ld-s390/tlspic1_64.s: Likewise.
	* ld-s390/tlsbinpic_64.s: Likewise.
	* ld-s390/tlspic_64.rd: Likewise.
	* ld-s390/tlsbin_64.rd: Likewise.
	* ld-s390/tlspic_64.dd: Likewise.
	* ld-s390/tlsbin_64.dd: Likewise.
	* ld-s390/tlspic_64.sd: Likewise.
	* ld-s390/tlspic_64.td: Likewise.
	* ld-s390/tlsbin_64.td: Likewise.
	* ld-s390/tlsbin_64.sd: Likewise.
	* ld-powerpc/tlsexe32.r: Likewise.
	* ld-powerpc/tlsso32.r: Likewise.
	* ld-powerpc/tlsso32.d: Likewise.
	* ld-powerpc/tlsso32.g: Likewise.
	* ld-powerpc/tlsso32.t: Likewise.
	* ld-powerpc/tlsexe.r: Likewise.
	* ld-powerpc/tlsso.r: Likewise.
	* ld-powerpc/tlsso.g: Likewise.
	* ld-powerpc/tlsexetoc.r: Likewise.
	* ld-powerpc/tlstocso.r: Likewise.
	* ld-powerpc/tlstocso.g: Likewise.
	* ld-ia64/tlspic.rd: Likewise.
	* ld-ia64/tlspic.dd: Likewise.
	* ld-ia64/tlspic.sd: Likewise.
	* ld-ia64/tlspic.td: Likewise.
	* ld-ia64/tlsbin.rd: Likewise.
	* ld-ia64/tlsbin.sd: Likewise.
	* ld-ia64/tlsbin.td: Likewise.
	* ld-elfvsb/elfvsb.exp: XFAIL non-PIC load offset tests on s390x.
	* ld-shared/shared.exp: Likewise.
@
text
@d21 1
a21 1
 +102c:	88 f5 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
d27 1
a27 1
 +104c:	68 f5 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
d33 1
a33 1
 +106c:	48 f5 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
d39 1
a39 1
 +108c:	28 f5 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
@


1.3
log
@2003-09-30  H.J. Lu  <hongjiu.lu@@intel.com>

	* ld-ia64/ia64.exp: Remove -melf64_ia64.

	* ld-ia64/tlsbin.dd: Remove -melf64_ia64. Match elf..-ia64-.*
	instead of elf64-ia64-little.
	* ld-ia64/tlsbin.rd: Likewise.
	* ld-ia64/tlsbin.sd: Likewise.
	* ld-ia64/tlsbin.td: Likewise.
	* ld-ia64/tlsg.sd: Likewise.
	* ld-ia64/tlspic.dd: Likewise.
	* ld-ia64/tlspic.rd: Likewise.
	* ld-ia64/tlspic.sd: Likewise.
	* ld-ia64/tlspic.td: Likewise.
@
text
@d21 1
a21 1
 +102c:	88 f6 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
d27 1
a27 1
 +104c:	68 f6 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
d33 1
a33 1
 +106c:	48 f6 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
d39 1
a39 1
 +108c:	28 f6 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
@


1.2
log
@	* elfxx-ia64.c (elfNN_ia64_relocate_section): Handle
	R_IA64_TPREL64[LM]SB against non-global symbol properly.

	* ld-ia64/tlspic1.s: Add tests for IE in shared libraries.
	* ld-ia64/tlspic.rd: Adjust.
	* ld-ia64/tlspic.dd: Adjust.
	* ld-ia64/tlspic.sd: Adjust.
@
text
@d4 1
a4 1
#ld: -shared -melf64_ia64
d8 1
a8 1
.*: +file format elf64-ia64-little
@


1.1
log
@	* elfxx-ia64.c (struct elfNN_ia64_link_hash_table): Add
	self_dtpmod_done and self_dtpmod_offset.
	(allocate_global_data_got): Only use one got entry for all
	dtpmod relocs against local symbols.
	(allocate_dynrel_entries): Only need .rela.got entry for
	dtpmod against global symbol.
	(elfNN_ia64_size_dynamic_sections): Initialize self_dtpmod_offset.
	Reserve space in .rela.got for the local dtpmod entry.
	(set_got_entry): Initialize the common local dtpmod .got entry.
	(elfNN_ia64_relocate_section): Handle R_IA_64_DTPREL64LSB
	and R_IA_64_DTPREL64MSB.

	* config/tc-ia64.c (ia64_cons_fix_new): Handle @@dtprel() in data.

	* ld-ia64/ia64.exp: New.
	* ld-ia64/tlsbin.dd: New test.
	* ld-ia64/tlsbinpic.s: New test.
	* ld-ia64/tlsbin.rd: New test.
	* ld-ia64/tlsbin.s: New test.
	* ld-ia64/tlsbin.sd: New test.
	* ld-ia64/tlsbin.td: New test.
	* ld-ia64/tlsg.s: New test.
	* ld-ia64/tlsg.sd: New test.
	* ld-ia64/tlslib.s: New test.
	* ld-ia64/tlspic1.s: New test.
	* ld-ia64/tlspic2.s: New test.
	* ld-ia64/tlspic.dd: New test.
	* ld-ia64/tlspic.rd: New test.
	* ld-ia64/tlspic.sd: New test.
	* ld-ia64/tlspic.td: New test.
@
text
@d21 2
a22 2
 +102c:	48 f6 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
 +1030:	0d 70 a0 02 00 24[ 	]+\[MFI\] +addl r14=40,r1
d24 1
a24 1
 +103c:	01 0b 00 90[ 	]+addl r15=48,r1;;
d27 2
a28 2
 +104c:	28 f6 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
 +1050:	0d 70 a0 02 00 24[ 	]+\[MFI\] +addl r14=40,r1
d33 2
a34 2
 +106c:	08 f6 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
 +1070:	0d 70 a0 02 00 24[ 	]+\[MFI\] +addl r14=40,r1
d39 1
a39 1
 +108c:	e8 f5 ff 58[ 	]+br.call.sptk.many b0=[0-9a-f]+ <.*>;;
d46 18
a63 6
 +10b0:	0a 78 3c 10 00 20[ 	]+\[MMI\] +add r15=r15,r8;;
 +10b6:	00 00 00 02 00 00[ 	]+nop.m 0x0
 +10bc:	20 02 aa 00[ 	]+mov.i ar.pfs=r34
 +10c0:	11 00 00 00 01 00[ 	]+\[MIB\] +nop.m 0x0
 +10c6:	00 08 05 80 03 80[ 	]+mov b0=r33
 +10cc:	08 00 84 00[ 	]+br.ret.sptk.many b0;;
@

