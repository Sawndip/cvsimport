head	1.5;
access;
symbols
	binutils-2_24-branch:1.5.0.10
	binutils-2_24-branchpoint:1.5
	binutils-2_21_1:1.5
	binutils-2_23_2:1.5
	binutils-2_23_1:1.5
	binutils-2_23:1.5
	binutils-2_23-branch:1.5.0.8
	binutils-2_23-branchpoint:1.5
	binutils-2_22_branch:1.5.0.6
	binutils-2_22:1.5
	binutils-2_22-branch:1.5.0.4
	binutils-2_22-branchpoint:1.5
	binutils-2_21:1.5
	binutils-2_21-branch:1.5.0.2
	binutils-2_21-branchpoint:1.5
	binutils-2_20_1:1.3
	binutils-2_20:1.3
	binutils-arc-20081103-branch:1.3.0.22
	binutils-arc-20081103-branchpoint:1.3
	binutils-2_20-branch:1.3.0.20
	binutils-2_20-branchpoint:1.3
	dje-cgen-play1-branch:1.3.0.18
	dje-cgen-play1-branchpoint:1.3
	arc-20081103-branch:1.3.0.16
	arc-20081103-branchpoint:1.3
	binutils-2_19_1:1.3
	binutils-2_19:1.3
	binutils-2_19-branch:1.3.0.14
	binutils-2_19-branchpoint:1.3
	binutils-2_18:1.3
	binutils-2_18-branch:1.3.0.12
	binutils-2_18-branchpoint:1.3
	binutils-csl-coldfire-4_1-32:1.3
	binutils-csl-sourcerygxx-4_1-32:1.3
	binutils-csl-innovasic-fido-3_4_4-33:1.3
	binutils-csl-sourcerygxx-3_4_4-32:1.3
	binutils-csl-coldfire-4_1-30:1.3
	binutils-csl-sourcerygxx-4_1-30:1.3
	binutils-csl-coldfire-4_1-28:1.3
	binutils-csl-sourcerygxx-4_1-29:1.3
	binutils-csl-sourcerygxx-4_1-28:1.3
	binutils-csl-arm-2006q3-27:1.3
	binutils-csl-sourcerygxx-4_1-27:1.3
	binutils-csl-arm-2006q3-26:1.3
	binutils-csl-sourcerygxx-4_1-26:1.3
	binutils-csl-sourcerygxx-4_1-25:1.3
	binutils-csl-sourcerygxx-4_1-24:1.3
	binutils-csl-sourcerygxx-4_1-23:1.3
	binutils-csl-sourcerygxx-4_1-21:1.3
	binutils-csl-arm-2006q3-21:1.3
	binutils-csl-sourcerygxx-4_1-22:1.3
	binutils-csl-palmsource-arm-prelinker-1_0-1:1.3
	binutils-csl-sourcerygxx-4_1-20:1.3
	binutils-csl-arm-2006q3-19:1.3
	binutils-csl-sourcerygxx-4_1-19:1.3
	binutils-csl-sourcerygxx-4_1-18:1.3
	binutils-csl-renesas-4_1-9:1.3
	binutils-csl-sourcerygxx-3_4_4-25:1.3
	binutils-csl-renesas-4_1-8:1.3
	binutils-csl-renesas-4_1-7:1.3
	binutils-csl-renesas-4_1-6:1.3
	binutils-csl-sourcerygxx-4_1-17:1.3
	binutils-csl-sourcerygxx-4_1-14:1.3
	binutils-csl-sourcerygxx-4_1-15:1.3
	binutils-csl-sourcerygxx-4_1-13:1.3
	binutils-2_17:1.3
	binutils-csl-sourcerygxx-4_1-12:1.3
	binutils-csl-sourcerygxx-3_4_4-21:1.3
	binutils-csl-wrs-linux-3_4_4-24:1.3
	binutils-csl-wrs-linux-3_4_4-23:1.3
	binutils-csl-sourcerygxx-4_1-9:1.3
	binutils-csl-sourcerygxx-4_1-8:1.3
	binutils-csl-sourcerygxx-4_1-7:1.3
	binutils-csl-arm-2006q1-6:1.3
	binutils-csl-sourcerygxx-4_1-6:1.3
	binutils-csl-wrs-linux-3_4_4-22:1.3
	binutils-csl-coldfire-4_1-11:1.3
	binutils-csl-sourcerygxx-3_4_4-19:1.3
	binutils-csl-coldfire-4_1-10:1.3
	binutils-csl-sourcerygxx-4_1-5:1.3
	binutils-csl-sourcerygxx-4_1-4:1.3
	binutils-csl-wrs-linux-3_4_4-21:1.3
	binutils-csl-morpho-4_1-4:1.3
	binutils-csl-sourcerygxx-3_4_4-17:1.3
	binutils-csl-wrs-linux-3_4_4-20:1.3
	binutils-2_17-branch:1.3.0.10
	binutils-2_17-branchpoint:1.3
	binutils-csl-2_17-branch:1.3.0.8
	binutils-csl-2_17-branchpoint:1.3
	binutils-csl-gxxpro-3_4-branch:1.3.0.6
	binutils-csl-gxxpro-3_4-branchpoint:1.3
	binutils-2_16_1:1.3
	binutils-csl-arm-2005q1b:1.3
	binutils-2_16:1.3
	binutils-csl-arm-2005q1a:1.3
	binutils-csl-arm-2005q1-branch:1.3.0.4
	binutils-csl-arm-2005q1-branchpoint:1.3
	binutils-2_16-branch:1.3.0.2
	binutils-2_16-branchpoint:1.3
	csl-arm-2004-q3d:1.3
	csl-arm-2004-q3:1.2
	binutils-2_15:1.1
	binutils-2_15-branchpoint:1.1
	csl-arm-2004-q1a:1.1
	csl-arm-2004-q1:1.1
	binutils-2_15-branch:1.1.0.8
	cagney_bfdfile-20040213-branch:1.1.0.6
	cagney_bfdfile-20040213-branchpoint:1.1
	cagney_bigcore-20040122-branch:1.1.0.4
	cagney_bigcore-20040122-branchpoint:1.1
	csl-arm-2003-q4:1.1
	binutils-2_14:1.1
	binutils-2_14-branch:1.1.0.2
	binutils-2_14-branchpoint:1.1
	binutils_latest_snapshot:1.5;
locks; strict;
comment	@# @;
expand	@o@;


1.5
date	2010.10.27.15.02.52;	author krebbel;	state Exp;
branches;
next	1.4;

1.4
date	2010.09.27.13.32.59;	author krebbel;	state Exp;
branches;
next	1.3;

1.3
date	2004.11.02.05.40.05;	author hp;	state Exp;
branches;
next	1.2;

1.2
date	2004.05.11.17.08.35;	author jakub;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.24.17.18.12;	author sky;	state Exp;
branches;
next	;


desc
@@


1.5
log
@2010-10-27  Andreas Krebbel  <Andreas.Krebbel@@de.ibm.com>

	* ld-s390/tlsbin.dd: bc 0,0 -> nop 0 and bcr 0,%r0 -> nopr %r0.
@
text
@#source: tlsbinpic.s
#source: tlsbin.s
#as: -m31
#ld: -shared -melf_s390
#objdump: -dzrj.text
#target: s390-*-*

# PT_TLS layout is:
# Offset from   Offset from     Name
# TCB base      TCB end
# 0x00          -0xa0           sg1..sg2
# 0x20          -0x80           sl1..sl2
# 0x40          -0x60           sh1..sh2
# 0x60          -0x40           bg1..bg2
# 0x80          -0x20           bl1..bl2

.*: +file format elf32-s390

Disassembly of section .text:

0+[0-9a-f]+ <fn2>:
# function prolog
  +[0-9a-f]+:	90 6e f0 18       	stm	%r6,%r14,24\(%r15\)
  +[0-9a-f]+:	a7 d5 00 24       	bras	%r13,[0-9a-f]+ <fn2\+0x4c>
# _GLOBAL_OFFSET_TABLE_
  +[0-9a-f]+:	[0-9a-f ]+       	.long	0x[0-9a-f]+
# __tls_get_addr@@plt-.LT1
  +[0-9a-f]+:	[0-9a-f ]+       	.long	0x[0-9a-f]+
# sG1@@tlsgd
  +[0-9a-f]+:	00 00 00 28       	.long	0x00000028
# sG2@@tlsgd
  +[0-9a-f]+:	00 00 00 20       	.long	0x00000020
# sg1@@tlsgd
  +[0-9a-f]+:	ff ff ff 60       	.long	0xffffff60
# sl1@@tlsgd
  +[0-9a-f]+:	ff ff ff 80       	.long	0xffffff80
# sh1@@tlsgd
  +[0-9a-f]+:	ff ff ff a0       	.long	0xffffffa0
# sl1@@tlsldm
  +[0-9a-f]+:	00 00 00 00       	.long	0x00000000
# sl1@@dtpoff
  +[0-9a-f]+:	ff ff ff 80       	.long	0xffffff80
# sl2@@dtpoff
  +[0-9a-f]+:	ff ff ff 84       	.long	0xffffff84
# sh1@@tlsldm
  +[0-9a-f]+:	00 00 00 00       	.long	0x00000000
# sh1@@dtpoff
  +[0-9a-f]+:	ff ff ff a0       	.long	0xffffffa0
# sh2@@dtpoff
  +[0-9a-f]+:	ff ff ff a4       	.long	0xffffffa4
# sG2@@gotntpoff
  +[0-9a-f]+:	00 00 00 20       	.long	0x00000020
# sg1@@gotntpoff
  +[0-9a-f]+:	ff ff ff 60       	.long	0xffffff60
# sl1@@gotntpoff
  +[0-9a-f]+:	ff ff ff 80       	.long	0xffffff80
# sh1@@gotntpoff
  +[0-9a-f]+:	ff ff ff a0       	.long	0xffffffa0
# function prolog
  +[0-9a-f]+:	18 ef             	lr	%r14,%r15
  +[0-9a-f]+:	58 c0 d0 00       	l	%r12,0\(%r13\)
  +[0-9a-f]+:	a7 fa ff a0       	ahi	%r15,-96
  +[0-9a-f]+:	41 cc d0 00       	la	%r12,0\(%r12,%r13\)
  +[0-9a-f]+:	50 e0 e0 00       	st	%r14,0\(%r14\)
# Extract TCB and load branch offset
  +[0-9a-f]+:	b2 4f 00 90       	ear	%r9,%a0
  +[0-9a-f]+:	58 70 d0 04       	l	%r7,4\(%r13\)
# GD -> IE because variable is not defined in executable
  +[0-9a-f]+:	58 20 d0 08       	l	%r2,8\(%r13\)
  +[0-9a-f]+:	58 22 c0 00       	l	%r2,0\(%r2,%r12\)
  +[0-9a-f]+:	41 22 90 00       	la	%r2,0\(%r2,%r9\)
# GD -> IE because variable is not defined in executable where
# the variable is referenced through IE too
  +[0-9a-f]+:	58 20 d0 0c       	l	%r2,12\(%r13\)
  +[0-9a-f]+:	58 22 c0 00       	l	%r2,0\(%r2,%r12\)
  +[0-9a-f]+:	41 22 90 00       	la	%r2,0\(%r2,%r9\)
# GD -> LE with global variable defined in executable
  +[0-9a-f]+:	58 20 d0 10       	l	%r2,16\(%r13\)
  +[0-9a-f]+:	47 00 00 00       	nop	0
  +[0-9a-f]+:	41 22 90 00       	la	%r2,0\(%r2,%r9\)
# GD -> LE with local variable defined in executable
  +[0-9a-f]+:	58 20 d0 14       	l	%r2,20\(%r13\)
  +[0-9a-f]+:	47 00 00 00       	nop	0
  +[0-9a-f]+:	41 22 90 00       	la	%r2,0\(%r2,%r9\)
# GD -> LE with hidden variable defined in executable
  +[0-9a-f]+:	58 20 d0 18       	l	%r2,24\(%r13\)
  +[0-9a-f]+:	47 00 00 00       	nop	0
  +[0-9a-f]+:	41 22 90 00       	la	%r2,0\(%r2,%r9\)
# LD -> LE
  +[0-9a-f]+:	58 20 d0 1c       	l	%r2,28\(%r13\)
  +[0-9a-f]+:	47 00 00 00       	nop	0
  +[0-9a-f]+:	41 32 90 00       	la	%r3,0\(%r2,%r9\)
  +[0-9a-f]+:	58 40 d0 20       	l	%r4,32\(%r13\)
  +[0-9a-f]+:	41 54 30 00       	la	%r5,0\(%r4,%r3\)
  +[0-9a-f]+:	58 40 d0 24       	l	%r4,36\(%r13\)
  +[0-9a-f]+:	41 54 30 00       	la	%r5,0\(%r4,%r3\)
# LD -> LE against hidden variables
  +[0-9a-f]+:	58 20 d0 28       	l	%r2,40\(%r13\)
  +[0-9a-f]+:	47 00 00 00       	nop	0
  +[0-9a-f]+:	41 32 90 00       	la	%r3,0\(%r2,%r9\)
  +[0-9a-f]+:	58 40 d0 2c       	l	%r4,44\(%r13\)
  +[0-9a-f]+:	41 54 30 00       	la	%r5,0\(%r4,%r3\)
  +[0-9a-f]+:	58 40 d0 30       	l	%r4,48\(%r13\)
  +[0-9a-f]+:	41 54 30 00       	la	%r5,0\(%r4,%r3\)
# IE against global var
  +[0-9a-f]+:	58 30 d0 34       	l	%r3,52\(%r13\)
  +[0-9a-f]+:	58 33 c0 00       	l	%r3,0\(%r3,%r12\)
  +[0-9a-f]+:	58 33 90 00       	l	%r3,0\(%r3,%r9\)
# IE -> LE against global var defined in exec
  +[0-9a-f]+:	58 30 d0 38       	l	%r3,56\(%r13\)
  +[0-9a-f]+:	18 43             	lr	%r4,%r3
  +[0-9a-f]+:	07 00             	nopr	%r0
  +[0-9a-f]+:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
# IE -> LE against local var
  +[0-9a-f]+:	58 30 d0 3c       	l	%r3,60\(%r13\)
  +[0-9a-f]+:	18 43             	lr	%r4,%r3
  +[0-9a-f]+:	07 00             	nopr	%r0
  +[0-9a-f]+:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
# IE -> LE against hidden var
  +[0-9a-f]+:	58 30 d0 40       	l	%r3,64\(%r13\)
  +[0-9a-f]+:	18 43             	lr	%r4,%r3
  +[0-9a-f]+:	07 00             	nopr	%r0
  +[0-9a-f]+:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
# IE against global var with small got access (no optimization)
  +[0-9a-f]+:	58 30 c0 14       	l	%r3,20\(%r12\)
  +[0-9a-f]+:	41 33 90 00       	la	%r3,0\(%r3,%r9\)
# IE against global var defined in exec with small got access
# (no optimization)
  +[0-9a-f]+:	58 30 c0 18       	l	%r3,24\(%r12\)
  +[0-9a-f]+:	41 33 90 00       	la	%r3,0\(%r3,%r9\)
# IE against local var with small got access (no optimization)
  +[0-9a-f]+:	58 30 c0 10       	l	%r3,16\(%r12\)
  +[0-9a-f]+:	41 33 90 00       	la	%r3,0\(%r3,%r9\)
# IE against hidden var with small got access (no optimization)
  +[0-9a-f]+:	58 30 c0 1c       	l	%r3,28\(%r12\)
  +[0-9a-f]+:	41 33 90 00       	la	%r3,0\(%r3,%r9\)
# function epilog
  +[0-9a-f]+:	98 6e f0 78       	lm	%r6,%r14,120\(%r15\)
  +[0-9a-f]+:	07 fe             	br	%r14
  +[0-9a-f]+:	07 07             	nopr	%r7
  +[0-9a-f]+:	07 07             	nopr	%r7
  +[0-9a-f]+:	07 07             	nopr	%r7
  +[0-9a-f]+:	07 07             	nopr	%r7
  +[0-9a-f]+:	07 07             	nopr	%r7
  +[0-9a-f]+:	07 07             	nopr	%r7
  +[0-9a-f]+:	07 07             	nopr	%r7
  +[0-9a-f]+:	07 07             	nopr	%r7

0+[0-9a-f]+ <_start>:
# function prolog
  +[0-9a-f]+:	90 6e f0 18       	stm	%r6,%r14,24\(%r15\)
  +[0-9a-f]+:	a7 d5 00 0c       	bras	%r13,[0-9a-f]+ <_start\+0x1c>
# sG6@@indntpoff
  +[0-9a-f]+:	00 40 15 a4       	.long	0x004015a4
# bg6@@indntpoff
  +[0-9a-f]+:	ff ff ff d4       	.long	0xffffffd4
# bl6@@indntpoff
  +[0-9a-f]+:	ff ff ff f4       	.long	0xfffffff4
# sh6@@indntpoff
  +[0-9a-f]+:	ff ff ff b4       	.long	0xffffffb4
# sg3@@indntpoff
  +[0-9a-f]+:	ff ff ff 68       	.long	0xffffff68
# function prolog
  +[0-9a-f]+:	18 ef             	lr	%r14,%r15
  +[0-9a-f]+:	a7 fa ff a0       	ahi	%r15,-96
  +[0-9a-f]+:	50 e0 e0 00       	st	%r14,0\(%r14\)
# Extract TCB
  +[0-9a-f]+:	b2 4f 00 90       	ear	%r9,%a0
# IE against global var
  +[0-9a-f]+:	58 30 d0 00       	l	%r3,0\(%r13\)
  +[0-9a-f]+:	58 33 c0 00       	l	%r3,0\(%r3,%r12\)
  +[0-9a-f]+:	41 33 90 00       	la	%r3,0\(%r3,%r9\)
# IE -> LE against global var defined in exec
  +[0-9a-f]+:	58 30 d0 04       	l	%r3,4\(%r13\)
  +[0-9a-f]+:	18 43             	lr	%r4,%r3
  +[0-9a-f]+:	07 00             	nopr	%r0
  +[0-9a-f]+:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
# IE -> LE against local var
  +[0-9a-f]+:	58 30 d0 08       	l	%r3,8\(%r13\)
  +[0-9a-f]+:	18 43             	lr	%r4,%r3
  +[0-9a-f]+:	07 00             	nopr	%r0
  +[0-9a-f]+:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
# IE -> LE against hidden but not local var
  +[0-9a-f]+:	58 30 d0 0c       	l	%r3,12\(%r13\)
  +[0-9a-f]+:	18 43             	lr	%r4,%r3
  +[0-9a-f]+:	07 00             	nopr	%r0
  +[0-9a-f]+:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
# LE, global var defined in exec
  +[0-9a-f]+:	58 40 d0 10       	l	%r4,16\(%r13\)
  +[0-9a-f]+:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
# function epilog
  +[0-9a-f]+:	98 6e f0 78       	lm	%r6,%r14,120\(%r15\)
  +[0-9a-f]+:	07 fe             	br	%r14
@


1.4
log
@2010-09-27  Andreas Krebbel  <Andreas.Krebbel@@de.ibm.com>

	* s390-dis.c (print_insn_s390): Pick instruction with most
	specific mask.
	* s390-opc.c: Add unused bits to the insn mask.
	* s390-opc.txt: Reorder some instructions to prefer more recent
	versions.

2010-09-27  Andreas Krebbel  <Andreas.Krebbel@@de.ibm.com>

	* gas/s390/esa-g5.d: Adjust serveral instructions.
	* gas/s390/esa-reloc.d: Likewise.
	* gas/s390/esa-z990.d: Likewise.
	* gas/s390/zarch-reloc.d: Likewise.
	* gas/s390/zarch-z10.d: Likewise.
	* gas/s390/zarch-z9-ec.d: Likewise.
	* gas/s390/zarch-z900.d: Likewise.

2010-09-27  Andreas Krebbel  <Andreas.Krebbel@@de.ibm.com>

	* ld-s390/tlsbin.dd: bcr 0,%r7 -> nopr %r7.
	* ld-s390/tlsbin_64.dd: Likewise.
	* ld-s390/tlspic.dd: Likewise.
	* ld-s390/tlspic_64.dd: Likewise.
@
text
@d79 1
a79 1
  +[0-9a-f]+:	47 00 00 00       	bc	0,0
d83 1
a83 1
  +[0-9a-f]+:	47 00 00 00       	bc	0,0
d87 1
a87 1
  +[0-9a-f]+:	47 00 00 00       	bc	0,0
d91 1
a91 1
  +[0-9a-f]+:	47 00 00 00       	bc	0,0
d99 1
a99 1
  +[0-9a-f]+:	47 00 00 00       	bc	0,0
d112 1
a112 1
  +[0-9a-f]+:	07 00             	bcr	0,%r0
d117 1
a117 1
  +[0-9a-f]+:	07 00             	bcr	0,%r0
d122 1
a122 1
  +[0-9a-f]+:	07 00             	bcr	0,%r0
d176 1
a176 1
  +[0-9a-f]+:	07 00             	bcr	0,%r0
d181 1
a181 1
  +[0-9a-f]+:	07 00             	bcr	0,%r0
d186 1
a186 1
  +[0-9a-f]+:	07 00             	bcr	0,%r0
@


1.3
log
@	* ld-cris/expdyn1.d, ld-cris/expdyn5.d, ld-cris/expdyn6.d,
	ld-cris/expdyn7.d, ld-cris/gotplt1.d, ld-cris/gotplt2.d,
	ld-cris/gotplt3.d, ld-cris/hiddef1.d, ld-cris/libdso-2.d,
	ld-cris/locref1.d, ld-cris/locref2.d, ld-cris/weakref2.d,
	ld-i386/tlsbin.rd, ld-i386/tlsnopic.rd, ld-i386/tlspic.rd,
	ld-ia64/tlsbin.dd, ld-ia64/tlsbin.rd, ld-ia64/tlspic.dd,
	ld-ia64/tlspic.rd, ld-powerpc/tlsexe32.d, ld-powerpc/tlsexe32.g,
	ld-powerpc/tlsexe32.r, ld-powerpc/tlsexe32.t,
	ld-powerpc/tlsso32.d, ld-powerpc/tlsso32.g, ld-powerpc/tlsso32.r,
	ld-powerpc/tlsso32.t, ld-s390/tlsbin.dd, ld-s390/tlsbin.rd,
	ld-s390/tlspic.rd, ld-sparc/tlssunbin32.rd,
	ld-sparc/tlssunpic32.rd, ld-x86-64/tlsbin.rd, ld-x86-64/tlspic.dd,
	ld-x86-64/tlspic.rd: Adjust for _GLOBAL_OFFSET_TABLE_ now hidden.
@
text
@d140 8
a147 8
  +[0-9a-f]+:	07 07             	bcr	0,%r7
  +[0-9a-f]+:	07 07             	bcr	0,%r7
  +[0-9a-f]+:	07 07             	bcr	0,%r7
  +[0-9a-f]+:	07 07             	bcr	0,%r7
  +[0-9a-f]+:	07 07             	bcr	0,%r7
  +[0-9a-f]+:	07 07             	bcr	0,%r7
  +[0-9a-f]+:	07 07             	bcr	0,%r7
  +[0-9a-f]+:	07 07             	bcr	0,%r7
@


1.2
log
@bfd/
	* elflink.c (elf_bfd_final_link): Don't output STT_SECTION symbol
	into .dynsym if elf_section_data (sec)->dynindx <= 0.
	Adjust counting of last_local.
	(_bfd_elf_link_renumber_dynsyms): Don't assign dynindx to sections
	other than SHT_PROGBITS/SHT_NOBITS and neither for .got/.got.plt/.plt
	created by the linker nor !SHF_ALLOC.

	* elf32-i386.c (elf_i386_finish_dynamic_sections): Point
	DT_PLTGOT to the start of the .got.plt section instead of the
	.got output section.  Set sh_entsize for .got section in addition
	to .got.plt.
	(elf_i386_relocate_section): Don't assume _GLOBAL_OFFSET_TABLE_
	is at sgot->output_section->vma.
	* elf64-x86-64.c (elf64_x86_64_finish_dynamic_sections): Point
	DT_PLTGOT to the start of the .got.plt section instead of the
	.got output section.
	(elf64_x86_64_relocate_section): Don't assume _GLOBAL_OFFSET_TABLE_
	is at sgot->output_section->vma.  Set sh_entsize for .got section
	in addition to .got.plt.
	* elf.c (_bfd_elf_print_private_bfd_data): Handle PT_GNU_RELRO.
	(bfd_section_from_phdr): Likewise.
	(map_sections_to_segments): Likewise.
	(assign_file_positions_for_segments): Likewise.
	(get_program_header_size): Likewise.
	* elflink.c (bfd_elf_size_dynamic_sections): Set
	elf_tdata (output_bfd)->relro from info->relro.
	* elf-bfd.h (struct elf_obj_tdata): Add relro field.
include/
	* bfdlink.h (struct bfd_link_info): Add relro, relro_start and
	relro_end fields.
	* elf/common.h (PT_GNU_EH_FRAME, PT_GNU_STACK): Add comments.
	(PT_GNU_RELRO): Define.
binutils/
	* readelf.c (get_segment_type): Handle PT_GNU_RELRO.
ld/
	* genscripts.sh: Generate -z combreloc -z now -z relro scripts
	for binaries, -shared and -pie.
	* emulparams/elf_i386.sh (SEPARATE_GOTPLT): Set.
	* emulparams/elf_x86_64.sh (SEPARATE_GOTPLT): Set.
	* emulparams/elf32ppc.sh (OTHER_READWRITE_SECTIONS): Rename to...
	(OTHER_RELRO_SECTIONS): ... this.
	* ldlex.l (DATA_SEGMENT_RELRO_END): Add.
	* emultempl/elf32.em (gld${EMULATION_NAME}_handle_option): Handle
	-z relro and -z norelro.
	(gld${EMULATION_NAME}_list_options): Add it to usage.
	(gld${EMULATION_NAME}_get_script): Return -z combreloc -z now
	-z relro scripts when appropriate.
	* scripttempl/elf.sc: Unset SEPARATE_GOTPLT if RELRO_NOW is set.
	Create separate .got.plt section if SEPARATE_GOTPLT.
	Move sections which are only written during relocation handling
	to the beginning of RW segment.  If NO_SMALL_DATA, move .got
	before .data.  Add DATA_SEGMENT_RELRO_END directive.
	Include OTHER_RELRO_SECTIONS.
	* ldgram.y (DATA_SEGMENT_RELRO_END): Add.
	* ldexp.c (exp_print_token): Handle DATA_SEGMENT_RELRO_END.
	(fold_unary): Likewise.
	(fold_binary): Handle -z relro.
	* ldexp.h (struct exp_data_seg): Add exp_dataseg_relro_seen and
	exp_dataseg_relro_adjust phases.  Add relro_end field.
	* ldmain.c (main): Initialize link_info.relro to FALSE.
	* ldlang.c (lang_size_sections): Handle -z relro.
ld/testsuite/
	* ld-i386/tlspic.rd: Adjust for section reordering changes
	and removal of unneeded STT_SECTION symbols from .dynsym.
	* ld-i386/tlspic.dd: Likewise.
	* ld-i386/tlspic.sd: Likewise.
	* ld-i386/tlsbin.rd: Likewise.
	* ld-i386/tlsbinpic.s: Likewise.
	* ld-i386/tlsbin.dd: Likewise.
	* ld-i386/tlsbin.sd: Likewise.
	* ld-i386/tlsnopic.rd: Likewise.
	* ld-i386/tlsnopic1.s: Likewise.
	* ld-i386/combreloc.d: Likewise.
	* ld-i386/tlsnopic.dd: Likewise.
	* ld-i386/tlsnopic.sd: Likewise.
	* ld-x86-64/tlspic.rd: Likewise.
	* ld-x86-64/tlspic.dd: Likewise.
	* ld-x86-64/tlsbin.dd: Likewise.
	* ld-x86-64/tlspic.sd: Likewise.
	* ld-x86-64/tlsbin.sd: Likewise.
	* ld-x86-64/tlspic.td: Likewise.
	* ld-x86-64/tlsbin.td: Likewise.
	* ld-x86-64/tlsbin.rd: Likewise.
	* ld-s390/tlspic1.s: Likewise.
	* ld-s390/tlsbinpic.s: Likewise.
	* ld-s390/tlspic.rd: Likewise.
	* ld-s390/tlsbin.rd: Likewise.
	* ld-s390/tlspic.dd: Likewise.
	* ld-s390/tlsbin.dd: Likewise.
	* ld-s390/tlsbin.sd: Likewise.
	* ld-s390/tlsbin.td: Likewise.
	* ld-s390/tlspic.sd: Likewise.
	* ld-s390/tlspic.td: Likewise.
	* ld-s390/tlspic1_64.s: Likewise.
	* ld-s390/tlsbinpic_64.s: Likewise.
	* ld-s390/tlspic_64.rd: Likewise.
	* ld-s390/tlsbin_64.rd: Likewise.
	* ld-s390/tlspic_64.dd: Likewise.
	* ld-s390/tlsbin_64.dd: Likewise.
	* ld-s390/tlspic_64.sd: Likewise.
	* ld-s390/tlspic_64.td: Likewise.
	* ld-s390/tlsbin_64.td: Likewise.
	* ld-s390/tlsbin_64.sd: Likewise.
	* ld-powerpc/tlsexe32.r: Likewise.
	* ld-powerpc/tlsso32.r: Likewise.
	* ld-powerpc/tlsso32.d: Likewise.
	* ld-powerpc/tlsso32.g: Likewise.
	* ld-powerpc/tlsso32.t: Likewise.
	* ld-powerpc/tlsexe.r: Likewise.
	* ld-powerpc/tlsso.r: Likewise.
	* ld-powerpc/tlsso.g: Likewise.
	* ld-powerpc/tlsexetoc.r: Likewise.
	* ld-powerpc/tlstocso.r: Likewise.
	* ld-powerpc/tlstocso.g: Likewise.
	* ld-ia64/tlspic.rd: Likewise.
	* ld-ia64/tlspic.dd: Likewise.
	* ld-ia64/tlspic.sd: Likewise.
	* ld-ia64/tlspic.td: Likewise.
	* ld-ia64/tlsbin.rd: Likewise.
	* ld-ia64/tlsbin.sd: Likewise.
	* ld-ia64/tlsbin.td: Likewise.
	* ld-elfvsb/elfvsb.exp: XFAIL non-PIC load offset tests on s390x.
	* ld-shared/shared.exp: Likewise.
@
text
@d154 1
a154 1
  +[0-9a-f]+:	00 40 15 e4       	.long	0x004015e4
@


1.1
log
@	* ld-s390/s390.exp: New file.
	* ld-s390/tlsbin_64.dd: New file.
	* ld-s390/tlsbin_64.rd: New file.
	* ld-s390/tlsbin_64.s: New file.
	* ld-s390/tlsbin_64.sd: New file.
	* ld-s390/tlsbin_64.td: New file.
	* ld-s390/tlsbin.dd: New file.
	* ld-s390/tlsbinpic_64.s: New file.
	* ld-s390/tlsbinpic.s: New file.
	* ld-s390/tlsbin.rd: New file.
	* ld-s390/tlsbin.s: New file.
	* ld-s390/tlsbin.sd: New file.
	* ld-s390/tlsbin.td: New file.
	* ld-s390/tlslib_64.s: New file.
	* ld-s390/tlslib.s: New file.
	* ld-s390/tlspic1_64.s: New file.
	* ld-s390/tlspic1.s: New file.
	* ld-s390/tlspic2_64.s: New file.
	* ld-s390/tlspic2.s: New file.
	* ld-s390/tlspic_64.dd: New file.
	* ld-s390/tlspic_64.rd: New file.
	* ld-s390/tlspic_64.sd: New file.
	* ld-s390/tlspic_64.td: New file.
	* ld-s390/tlspic.dd: New file.
	* ld-s390/tlspic.rd: New file.
	* ld-s390/tlspic.sd: New file.
	* ld-s390/tlspic.td: New file.
@
text
@d21 1
a21 1
0+4002e4 <fn2>:
d23 2
a24 2
 +4002e4:	90 6e f0 18       	stm	%r6,%r14,24\(%r15\)
 +4002e8:	a7 d5 00 24       	bras	%r13,400330 <fn2\+0x4c>
d26 1
a26 1
 +4002ec:	00 00 12 90       	.long	0x00001290
d28 1
a28 1
 +4002f0:	ff ff ff d8       	.long	0xffffffd8
d30 1
a30 1
 +4002f4:	00 00 00 28       	.long	0x00000028
d32 1
a32 1
 +4002f8:	00 00 00 20       	.long	0x00000020
d34 1
a34 1
 +4002fc:	ff ff ff 60       	.long	0xffffff60
d36 1
a36 1
 +400300:	ff ff ff 80       	.long	0xffffff80
d38 1
a38 1
 +400304:	ff ff ff a0       	.long	0xffffffa0
d40 1
a40 1
 +400308:	00 00 00 00       	.long	0x00000000
d42 1
a42 1
 +40030c:	ff ff ff 80       	.long	0xffffff80
d44 1
a44 1
 +400310:	ff ff ff 84       	.long	0xffffff84
d46 1
a46 1
 +400314:	00 00 00 00       	.long	0x00000000
d48 1
a48 1
 +400318:	ff ff ff a0       	.long	0xffffffa0
d50 1
a50 1
 +40031c:	ff ff ff a4       	.long	0xffffffa4
d52 1
a52 1
 +400320:	00 00 00 20       	.long	0x00000020
d54 1
a54 1
 +400324:	ff ff ff 60       	.long	0xffffff60
d56 1
a56 1
 +400328:	ff ff ff 80       	.long	0xffffff80
d58 1
a58 1
 +40032c:	ff ff ff a0       	.long	0xffffffa0
d60 5
a64 5
 +400330:	18 ef             	lr	%r14,%r15
 +400332:	58 c0 d0 00       	l	%r12,0\(%r13\)
 +400336:	a7 fa ff a0       	ahi	%r15,-96
 +40033a:	41 cc d0 00       	la	%r12,0\(%r12,%r13\)
 +40033e:	50 e0 e0 00       	st	%r14,0\(%r14\)
d66 2
a67 2
 +400342:	b2 4f 00 90       	ear	%r9,%a0
 +400346:	58 70 d0 04       	l	%r7,4\(%r13\)
d69 3
a71 3
 +40034a:	58 20 d0 08       	l	%r2,8\(%r13\)
 +40034e:	58 22 c0 00       	l	%r2,0\(%r2,%r12\)
 +400352:	41 22 90 00       	la	%r2,0\(%r2,%r9\)
d74 3
a76 3
 +400356:	58 20 d0 0c       	l	%r2,12\(%r13\)
 +40035a:	58 22 c0 00       	l	%r2,0\(%r2,%r12\)
 +40035e:	41 22 90 00       	la	%r2,0\(%r2,%r9\)
d78 3
a80 3
 +400362:	58 20 d0 10       	l	%r2,16\(%r13\)
 +400366:	47 00 00 00       	bc	0,0
 +40036a:	41 22 90 00       	la	%r2,0\(%r2,%r9\)
d82 3
a84 3
 +40036e:	58 20 d0 14       	l	%r2,20\(%r13\)
 +400372:	47 00 00 00       	bc	0,0
 +400376:	41 22 90 00       	la	%r2,0\(%r2,%r9\)
d86 3
a88 3
 +40037a:	58 20 d0 18       	l	%r2,24\(%r13\)
 +40037e:	47 00 00 00       	bc	0,0
 +400382:	41 22 90 00       	la	%r2,0\(%r2,%r9\)
d90 7
a96 7
 +400386:	58 20 d0 1c       	l	%r2,28\(%r13\)
 +40038a:	47 00 00 00       	bc	0,0
 +40038e:	41 32 90 00       	la	%r3,0\(%r2,%r9\)
 +400392:	58 40 d0 20       	l	%r4,32\(%r13\)
 +400396:	41 54 30 00       	la	%r5,0\(%r4,%r3\)
 +40039a:	58 40 d0 24       	l	%r4,36\(%r13\)
 +40039e:	41 54 30 00       	la	%r5,0\(%r4,%r3\)
d98 7
a104 7
 +4003a2:	58 20 d0 28       	l	%r2,40\(%r13\)
 +4003a6:	47 00 00 00       	bc	0,0
 +4003aa:	41 32 90 00       	la	%r3,0\(%r2,%r9\)
 +4003ae:	58 40 d0 2c       	l	%r4,44\(%r13\)
 +4003b2:	41 54 30 00       	la	%r5,0\(%r4,%r3\)
 +4003b6:	58 40 d0 30       	l	%r4,48\(%r13\)
 +4003ba:	41 54 30 00       	la	%r5,0\(%r4,%r3\)
d106 3
a108 3
 +4003be:	58 30 d0 34       	l	%r3,52\(%r13\)
 +4003c2:	58 33 c0 00       	l	%r3,0\(%r3,%r12\)
 +4003c6:	58 33 90 00       	l	%r3,0\(%r3,%r9\)
d110 4
a113 4
 +4003ca:	58 30 d0 38       	l	%r3,56\(%r13\)
 +4003ce:	18 43             	lr	%r4,%r3
 +4003d0:	07 00             	bcr	0,%r0
 +4003d2:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
d115 4
a118 4
 +4003d6:	58 30 d0 3c       	l	%r3,60\(%r13\)
 +4003da:	18 43             	lr	%r4,%r3
 +4003dc:	07 00             	bcr	0,%r0
 +4003de:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
d120 4
a123 4
 +4003e2:	58 30 d0 40       	l	%r3,64\(%r13\)
 +4003e6:	18 43             	lr	%r4,%r3
 +4003e8:	07 00             	bcr	0,%r0
 +4003ea:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
d125 2
a126 2
 +4003ee:	58 30 c0 14       	l	%r3,20\(%r12\)
 +4003f2:	41 33 90 00       	la	%r3,0\(%r3,%r9\)
d129 2
a130 2
 +4003f6:	58 30 c0 18       	l	%r3,24\(%r12\)
 +4003fa:	41 33 90 00       	la	%r3,0\(%r3,%r9\)
d132 2
a133 2
 +4003fe:	58 30 c0 10       	l	%r3,16\(%r12\)
 +400402:	41 33 90 00       	la	%r3,0\(%r3,%r9\)
d135 2
a136 2
 +400406:	58 30 c0 1c       	l	%r3,28\(%r12\)
 +40040a:	41 33 90 00       	la	%r3,0\(%r3,%r9\)
d138 10
a147 2
 +40040e:	98 6e f0 78       	lm	%r6,%r14,120\(%r15\)
 +400412:	07 fe             	br	%r14
d149 1
a149 1
0+400414 <_start>:
d151 2
a152 2
 +400414:	90 6e f0 18       	stm	%r6,%r14,24\(%r15\)
 +400418:	a7 d5 00 0c       	bras	%r13,400430 <_start\+0x1c>
d154 1
a154 1
 +40041c:	00 40 15 a0       	.long	0x004015a0
d156 1
a156 1
 +400420:	ff ff ff d4       	.long	0xffffffd4
d158 1
a158 1
 +400424:	ff ff ff f4       	.long	0xfffffff4
d160 1
a160 1
 +400428:	ff ff ff b4       	.long	0xffffffb4
d162 1
a162 1
 +40042c:	ff ff ff 68       	.long	0xffffff68
d164 3
a166 3
 +400430:	18 ef             	lr	%r14,%r15
 +400432:	a7 fa ff a0       	ahi	%r15,-96
 +400436:	50 e0 e0 00       	st	%r14,0\(%r14\)
d168 1
a168 1
 +40043a:	b2 4f 00 90       	ear	%r9,%a0
d170 3
a172 3
 +40043e:	58 30 d0 00       	l	%r3,0\(%r13\)
 +400442:	58 33 c0 00       	l	%r3,0\(%r3,%r12\)
 +400446:	41 33 90 00       	la	%r3,0\(%r3,%r9\)
d174 4
a177 4
 +40044a:	58 30 d0 04       	l	%r3,4\(%r13\)
 +40044e:	18 43             	lr	%r4,%r3
 +400450:	07 00             	bcr	0,%r0
 +400452:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
d179 4
a182 4
 +400456:	58 30 d0 08       	l	%r3,8\(%r13\)
 +40045a:	18 43             	lr	%r4,%r3
 +40045c:	07 00             	bcr	0,%r0
 +40045e:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
d184 4
a187 4
 +400462:	58 30 d0 0c       	l	%r3,12\(%r13\)
 +400466:	18 43             	lr	%r4,%r3
 +400468:	07 00             	bcr	0,%r0
 +40046a:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
d189 2
a190 2
 +40046e:	58 40 d0 10       	l	%r4,16\(%r13\)
 +400472:	41 54 90 00       	la	%r5,0\(%r4,%r9\)
d192 2
a193 2
 +400476:	98 6e f0 78       	lm	%r6,%r14,120\(%r15\)
 +40047a:	07 fe             	br	%r14
@

