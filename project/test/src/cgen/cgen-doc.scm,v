head	1.5;
access;
symbols
	sid-snapshot-20180601:1.5
	cgen-snapshot-20180601:1.5
	sid-snapshot-20180501:1.5
	cgen-snapshot-20180501:1.5
	sid-snapshot-20180401:1.5
	cgen-snapshot-20180401:1.5
	sid-snapshot-20180301:1.5
	cgen-snapshot-20180301:1.5
	sid-snapshot-20180201:1.5
	cgen-snapshot-20180201:1.5
	sid-snapshot-20180101:1.5
	cgen-snapshot-20180101:1.5
	sid-snapshot-20171201:1.5
	cgen-snapshot-20171201:1.5
	sid-snapshot-20171101:1.5
	cgen-snapshot-20171101:1.5
	sid-snapshot-20171001:1.5
	cgen-snapshot-20171001:1.5
	sid-snapshot-20170901:1.5
	cgen-snapshot-20170901:1.5
	sid-snapshot-20170801:1.5
	cgen-snapshot-20170801:1.5
	sid-snapshot-20170701:1.5
	cgen-snapshot-20170701:1.5
	sid-snapshot-20170601:1.5
	cgen-snapshot-20170601:1.5
	sid-snapshot-20170501:1.5
	cgen-snapshot-20170501:1.5
	sid-snapshot-20170401:1.5
	cgen-snapshot-20170401:1.5
	sid-snapshot-20170301:1.5
	cgen-snapshot-20170301:1.5
	sid-snapshot-20170201:1.5
	cgen-snapshot-20170201:1.5
	sid-snapshot-20170101:1.5
	cgen-snapshot-20170101:1.5
	sid-snapshot-20161201:1.5
	cgen-snapshot-20161201:1.5
	sid-snapshot-20161101:1.5
	cgen-snapshot-20161101:1.5
	sid-snapshot-20160901:1.5
	cgen-snapshot-20160901:1.5
	sid-snapshot-20160801:1.5
	cgen-snapshot-20160801:1.5
	sid-snapshot-20160701:1.5
	cgen-snapshot-20160701:1.5
	sid-snapshot-20160601:1.5
	cgen-snapshot-20160601:1.5
	sid-snapshot-20160501:1.5
	cgen-snapshot-20160501:1.5
	sid-snapshot-20160401:1.5
	cgen-snapshot-20160401:1.5
	sid-snapshot-20160301:1.5
	cgen-snapshot-20160301:1.5
	sid-snapshot-20160201:1.5
	cgen-snapshot-20160201:1.5
	sid-snapshot-20160101:1.5
	cgen-snapshot-20160101:1.5
	sid-snapshot-20151201:1.5
	cgen-snapshot-20151201:1.5
	sid-snapshot-20151101:1.5
	cgen-snapshot-20151101:1.5
	sid-snapshot-20151001:1.5
	cgen-snapshot-20151001:1.5
	sid-snapshot-20150901:1.5
	cgen-snapshot-20150901:1.5
	sid-snapshot-20150801:1.5
	cgen-snapshot-20150801:1.5
	sid-snapshot-20150701:1.5
	cgen-snapshot-20150701:1.5
	sid-snapshot-20150601:1.5
	cgen-snapshot-20150601:1.5
	sid-snapshot-20150501:1.5
	cgen-snapshot-20150501:1.5
	sid-snapshot-20150401:1.5
	cgen-snapshot-20150401:1.5
	sid-snapshot-20150301:1.5
	cgen-snapshot-20150301:1.5
	sid-snapshot-20150201:1.5
	cgen-snapshot-20150201:1.5
	sid-snapshot-20150101:1.5
	cgen-snapshot-20150101:1.5
	sid-snapshot-20141201:1.5
	cgen-snapshot-20141201:1.5
	sid-snapshot-20141101:1.5
	cgen-snapshot-20141101:1.5
	sid-snapshot-20141001:1.5
	cgen-snapshot-20141001:1.5
	sid-snapshot-20140901:1.5
	cgen-snapshot-20140901:1.5
	sid-snapshot-20140801:1.5
	cgen-snapshot-20140801:1.5
	sid-snapshot-20140701:1.5
	cgen-snapshot-20140701:1.5
	sid-snapshot-20140601:1.5
	cgen-snapshot-20140601:1.5
	sid-snapshot-20140501:1.5
	cgen-snapshot-20140501:1.5
	sid-snapshot-20140401:1.5
	cgen-snapshot-20140401:1.5
	sid-snapshot-20140301:1.5
	cgen-snapshot-20140301:1.5
	sid-snapshot-20140201:1.5
	cgen-snapshot-20140201:1.5
	sid-snapshot-20140101:1.5
	cgen-snapshot-20140101:1.5
	sid-snapshot-20131201:1.5
	cgen-snapshot-20131201:1.5
	sid-snapshot-20131101:1.5
	cgen-snapshot-20131101:1.5
	sid-snapshot-20131001:1.5
	cgen-snapshot-20131001:1.5
	sid-snapshot-20130901:1.5
	cgen-snapshot-20130901:1.5
	sid-snapshot-20130801:1.5
	cgen-snapshot-20130801:1.5
	sid-snapshot-20130701:1.5
	cgen-snapshot-20130701:1.5
	sid-snapshot-20130601:1.5
	cgen-snapshot-20130601:1.5
	sid-snapshot-20130501:1.5
	cgen-snapshot-20130501:1.5
	sid-snapshot-20130401:1.5
	cgen-snapshot-20130401:1.5
	sid-snapshot-20130301:1.5
	cgen-snapshot-20130301:1.5
	sid-snapshot-20130201:1.5
	cgen-snapshot-20130201:1.5
	sid-snapshot-20130101:1.5
	cgen-snapshot-20130101:1.5
	sid-snapshot-20121201:1.5
	cgen-snapshot-20121201:1.5
	sid-snapshot-20121101:1.5
	cgen-snapshot-20121101:1.5
	sid-snapshot-20121001:1.5
	cgen-snapshot-20121001:1.5
	sid-snapshot-20120901:1.5
	cgen-snapshot-20120901:1.5
	sid-snapshot-20120801:1.5
	cgen-snapshot-20120801:1.5
	sid-snapshot-20120701:1.5
	cgen-snapshot-20120701:1.5
	sid-snapshot-20120601:1.5
	cgen-snapshot-20120601:1.5
	sid-snapshot-20120501:1.5
	cgen-snapshot-20120501:1.5
	sid-snapshot-20120401:1.5
	cgen-snapshot-20120401:1.5
	sid-snapshot-20120301:1.5
	cgen-snapshot-20120301:1.5
	sid-snapshot-20120201:1.5
	cgen-snapshot-20120201:1.5
	sid-snapshot-20120101:1.5
	cgen-snapshot-20120101:1.5
	sid-snapshot-20111201:1.5
	cgen-snapshot-20111201:1.5
	sid-snapshot-20111101:1.5
	cgen-snapshot-20111101:1.5
	sid-snapshot-20111001:1.5
	cgen-snapshot-20111001:1.5
	sid-snapshot-20110901:1.5
	cgen-snapshot-20110901:1.5
	sid-snapshot-20110801:1.5
	cgen-snapshot-20110801:1.5
	sid-snapshot-20110701:1.5
	cgen-snapshot-20110701:1.5
	sid-snapshot-20110601:1.5
	cgen-snapshot-20110601:1.5
	sid-snapshot-20110501:1.5
	cgen-snapshot-20110501:1.5
	sid-snapshot-20110401:1.5
	cgen-snapshot-20110401:1.5
	sid-snapshot-20110301:1.5
	cgen-snapshot-20110301:1.5
	sid-snapshot-20110201:1.5
	cgen-snapshot-20110201:1.5
	sid-snapshot-20110101:1.5
	cgen-snapshot-20110101:1.5
	sid-snapshot-20101201:1.5
	cgen-snapshot-20101201:1.5
	sid-snapshot-20101101:1.5
	cgen-snapshot-20101101:1.5
	sid-snapshot-20101001:1.5
	cgen-snapshot-20101001:1.5
	sid-snapshot-20100901:1.5
	cgen-snapshot-20100901:1.5
	sid-snapshot-20100801:1.5
	cgen-snapshot-20100801:1.5
	sid-snapshot-20100701:1.5
	cgen-snapshot-20100701:1.5
	sid-snapshot-20100601:1.5
	cgen-snapshot-20100601:1.5
	sid-snapshot-20100501:1.5
	cgen-snapshot-20100501:1.5
	sid-snapshot-20100401:1.5
	cgen-snapshot-20100401:1.5
	sid-snapshot-20100301:1.5
	cgen-snapshot-20100301:1.5
	sid-snapshot-20100201:1.5
	cgen-snapshot-20100201:1.5
	sid-snapshot-20100101:1.5
	cgen-snapshot-20100101:1.5
	sid-snapshot-20091201:1.5
	cgen-snapshot-20091201:1.5
	sid-snapshot-20091101:1.5
	cgen-snapshot-20091101:1.5
	sid-snapshot-20091001:1.5
	cgen-snapshot-20091001:1.5
	arc-sim-20090309:1.4
	sid-snapshot-20090901:1.5
	cgen-snapshot-20090901:1.5
	sid-snapshot-20090801:1.5
	cgen-snapshot-20090801:1.5
	sid-snapshot-20090701:1.5
	cgen-snapshot-20090701:1.5
	dje-cgen-play1-branch:1.5.0.2
	dje-cgen-play1-branchpoint:1.5
	cgen-1_1-branch:1.4.0.6
	cgen-1_1-branchpoint:1.4
	sid-snapshot-20090601:1.4
	cgen-snapshot-20090601:1.4
	sid-snapshot-20090501:1.4
	cgen-snapshot-20090501:1.4
	sid-snapshot-20090401:1.4
	cgen-snapshot-20090401:1.4
	arc-insight_6_8-branch:1.4.0.4
	arc-insight_6_8-branchpoint:1.4
	sid-snapshot-20090301:1.4
	cgen-snapshot-20090301:1.4
	sid-snapshot-20090201:1.4
	cgen-snapshot-20090201:1.4
	sid-snapshot-20090101:1.4
	cgen-snapshot-20090101:1.4
	sid-snapshot-20081201:1.4
	cgen-snapshot-20081201:1.4
	sid-snapshot-20081101:1.4
	cgen-snapshot-20081101:1.4
	sid-snapshot-20081001:1.4
	cgen-snapshot-20081001:1.4
	sid-snapshot-20080901:1.4
	cgen-snapshot-20080901:1.4
	sid-snapshot-20080801:1.4
	cgen-snapshot-20080801:1.4
	sid-snapshot-20080701:1.4
	cgen-snapshot-20080701:1.4
	sid-snapshot-20080601:1.4
	cgen-snapshot-20080601:1.4
	sid-snapshot-20080501:1.4
	cgen-snapshot-20080501:1.4
	sid-snapshot-20080403:1.4
	sid-snapshot-20080401:1.4
	cgen-snapshot-20080401:1.4
	sid-snapshot-20080301:1.4
	cgen-snapshot-20080301:1.4
	sid-snapshot-20080201:1.4
	cgen-snapshot-20080201:1.4
	sid-snapshot-20080101:1.4
	cgen-snapshot-20080101:1.4
	sid-snapshot-20071201:1.4
	cgen-snapshot-20071201:1.4
	sid-snapshot-20071101:1.4
	cgen-snapshot-20071101:1.4
	sid-snapshot-20071001:1.4
	cgen-snapshot-20071001:1.4
	msnyder-fork-checkpoint-branch:1.4.0.2
	msnyder-fork-checkpoint-branchpoint:1.4;
locks; strict;
comment	@# @;


1.5
date	2009.06.24.15.03.09;	author devans;	state Exp;
branches;
next	1.4;

1.4
date	2005.02.15.09.01.34;	author jimb;	state Exp;
branches
	1.4.6.1;
next	1.3;

1.3
date	2003.09.08.17.17.22;	author brolley;	state Exp;
branches;
next	1.2;

1.2
date	2003.06.10.21.22.02;	author devans;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.15.07.25.02;	author devans;	state Exp;
branches;
next	;

1.4.6.1
date	2009.06.24.14.57.45;	author devans;	state Exp;
branches;
next	;


desc
@@


1.5
log
@	* All *.scm files: Update copyright year.
	* utils.scm (copyright-fsf, copyright-redhat): Ditto.
@
text
@; CPU description file generator for CGEN cpu documentation
; This is invoked to build: $arch.html.
; Copyright (C) 2003, 2009 Doug Evans
; This file is part of CGEN.
;
; This is a standalone script, we don't load anything until we parse the
; -s argument (keeps reliance off of environment variables, etc.).

; Load the various support routines.

(define (load-files srcdir)
  (load (string-append srcdir "/read.scm"))
  (load (string-append srcdir "/desc.scm"))
  (load (string-append srcdir "/desc-cpu.scm"))
  (load (string-append srcdir "/html.scm"))
)

(define doc-arguments
  (list
   (list "-H" "file" "generate $arch.html in <file>"
	 #f
	 (lambda (arg) (file-write arg cgen.html)))
   (list "-I" "file" "generate $arch-insn.html in <file>"
	 #f
	 (lambda (arg) (file-write arg cgen-insn.html)))
   (list "-N" "file" "specify name of insn.html file"
	 #f
	 (lambda (arg) (set! *insn-html-file-name* arg)))
   )
)

; Kept global so it's available to the other .scm files.
(define srcdir ".")

; Scan argv for -s srcdir.
; We can't process any other args until we find the cgen source dir.
; The result is srcdir.
; We assume "-s" isn't the argument to another option.  Unwise, yes.
; Alternatives are to require it to be the first argument or at least preceed
; any option with a "-s" argument, or to put knowledge of the common argument
; set and common argument parsing code in every top level file.

(define (find-srcdir argv)
  (let loop ((argv argv))
    (if (null? argv)
	(error "`-s srcdir' not present, can't load cgen"))
    (if (string=? "-s" (car argv))
	(begin
	  (if (null? (cdr argv))
	      (error "missing srcdir arg to `-s'"))
	  (cadr argv))
	(loop (cdr argv))))	
)

; Main routine, parses options and calls generators.

(define (cgen-doc argv)
  (let ()

    ; Find and set srcdir, then load all Scheme code.
    ; Drop the first argument, it is the script name (i.e. argv[0]).
    (set! srcdir (find-srcdir (cdr argv)))
    (set! %load-path (cons srcdir %load-path))
    (load-files srcdir)

    (display-argv argv)

    (cgen #:argv argv
	  #:app-name "doc"
	  #:arg-spec doc-arguments
	  #:init doc-init!
	  #:finish doc-finish!
	  #:analyze doc-analyze!)
    )
)

(cgen-doc (program-arguments))
@


1.4
log
@Make backtraces work more reliably.
* guile.scm: Set up debugging parameters, and enable debugging and
source positions while loading.
(cgen-call-with-debugging, cgen-debugging-stack-start): New
functions.
* read.scm: Don't set debugging parameters here.
(catch-with-backtrace): Function deleted.
(-cgen): Simply note the presence or absence of the -b option.
Pass the flag to cgen-call-with-debugging, so debugging is turned
off here if the user didn't request it, for faster computation.
(cgen): Call cgen-debugging-stack-start here, instead of
catch-with-backtrace.

* Makefile.am (GUILE): Explicitly load guile.scm here, and leave a
trailing -s.
(desc, html, opcodes, sim-arch, sim-cpu, gas-test, sim-test):
Don't write out the trailing -s here.
* Makefile.in: Regenerated.
* cgen-doc.scm, cgen-gas.scm, cgen-stest.scm): Don't load
fixup.scm here; let the caller decide which Scheme's customization
file to preload.
* dev.scm: Load guile.scm, not fixup.scm.
* fixup.scm: Deleted; contents have all moved to guile.scm.
* README: Doc fix.

* guile.scm (debug-write): New function.
@
text
@d3 1
a3 1
; Copyright (C) 2003 Doug Evans
@


1.4.6.1
log
@	* All *.scm files: Update copyright year.
	* utils.scm (copyright-fsf, copyright-redhat): Ditto.
@
text
@d3 1
a3 1
; Copyright (C) 2003, 2009 Doug Evans
@


1.3
log
@2003-09-08  Dave Brolley  <brolley@@redhat.com>

        On behalf of Doug Evans <dje@@sebabeach.org>
        Pass in paths to input files, instead of assuming they live in
        $srcdir/cpu.  Plus misc. option processing cleanup.
        * cgen-doc.scm (doc-arguments): Make options strings not symbols.
        Add pre-process pass to all options.
        * cgen-gas.scm (gas-arguments): Ditto.
        * cgen-sid.scm (sim-arguments): Ditto.
        * cgen-sim.scm (sim-arguments): Ditto.
        * cgen-stest.scm (stest-arguments): Ditto.
        * cgen-opc.scm (opc-arguments): Ditto.  New argument -OPC.
        (-opc-file-path): New global.
        (opc-file-path): New fn.
        * opcodes.scm (read-cpu.opc): Replace srcdir,cpu args with opc-file.
        All callers updated.
        (gen-extra-cpu.h,gen-extra-cpu.c,gen-extra-opc.h,gen-extra-opc.c,
        gen-extra-asm.c,gen-extra-dis.c,gen-extra-ibld.h,gen-extra-ibld.c):
        Replace srcdir arg with opc-file.  All callers updated.
        * read.scm (-opt-spec-update): Delete.
        (opt-get-first-pass,opt-get-second-pass): New fns.
        (-cgen): Process application-specific arguments in two passes.
@
text
@a11 3
  ; Fix up Scheme to be what we use (guile is always in flux).
  (primitive-load-path (string-append srcdir "/fixup.scm"))

@


1.2
log
@	* mach.scm (current-*-add!): Disallow redefinition.  Make result
	"unspecified".
	* insn.scm (insn-builtin!): Don't define relaxable here, now defined in
	operand.scm.
	* operand.scm (operand-builtin!): Define RELAXABLE for insns too.
	* cpu/m32r.cpu (disp8,disp24): RELAX renamed to RELAXABLE.

	* gen-all-doc: Split arm and frv docs up a bit.

	* cpu/arm.cpu: Add IDOC attribute.
	* cpu/frv.cpu: Ditto.
	* cpu/i960.cpu: Ditto.
	* cpu/openrisc.cpu: Ditto.
	* cpu/xstormy16.cpu: Ditto.
	* cpu/m32r.cpu: Ditto.
	(all insns): Explicitly specify IDOC attribute.

	* Makefile.am (MACH,ISAS,INSN_FILE_NAME): New vars.
	(desc,opcodes,sim-arch,sim-cpu,gas-test,sim-test): Use MACH,ISAS.
	(html): Use MACH,ISAS,INSN_FILE_NAME.  Generate insn.html separately.
	* Makefile.in: Regenerate.
	* attr.scm (<integer-attribute>:parse-value-def): Implement.
	(-attr-read): Defer computing default value until we know the type.
	(attr-has-attr?): Delete, move contents to <attr-list>:has-attr?.
	(<attr-list>:attr-present?): New method.
	(atlist-attr-present?,obj-attr-present?): New fns.
	(obj-has-attr-value?,obj-has-attr-value-no-default?): New fns.
	(attr-builtin!): New insn attr IDOC.
	* cgen-doc.scm (doc-arguments): New args -I,-N.
	* enum.scm (parse-enum-vals): New arg errtxt, all callers updated.
	Support comment as fourth element of enum value.
	(enum-val-name,enum-val-value,enum-val-attrs,enum-val-comment): New fns.
	* html.scm (gen-html-header): New arg kind, all callers updated.
	(gen-table-of-contents): New arg insn-file, all callers updated.
	(gen-list-entry,gen-doc-header): New fn.
	(get-operands): Delete.
	(gen-iformat-table): Rewrite.
	(gen-insn-doc-1): Print constant-folded and trimmed semantics.
	(gen-insn-doc-list): New args name, comment, insns.  All callers updated.
	(get-insn-properties,guess-insn-idoc-attr!): New fn.
	(insn-sets-pc?,insn-refs-mem?,insn-uses-fpu?): New fns.
	(get-insns-for-category,gen-categories-insn-lists): New fns.
	(gen-insn-docs): Simplify each insn's semantics first.
	Print insn tables sorted by IDOC categories.
	(*insn-html-file-name*): New global.
	(cgen-insn.html): New fn.
	(cgen-all): Update.
	* insn.scm (<insn>): Create a setter for the `tmp' member.
	* semantics.scm (insn-build-known-values): Renamed from
	-build-known-values.  All callers updated.

	* rtl.scm: Move traveral/evaluation support to ...
	* rtl-traverse.scm: New file.
	* read.scm: Maybe-load rtl-traverse.scm.

	* rtl.scm (-rtx-valid-types): Add SETRTX.

	* rtx-funcs.scm (nop,parallel): Fix mode.

	* utils.scm (eqv-lookup-index): New fn.
	(assq-lookup-index): Renamed from lookup-index.  All callers updated.

	* dev.scm (load-doc): Set APPLICATION.
@
text
@d23 2
a24 1
   (list '-H "file" "generate $arch.html in <file>"
d26 2
a27 2
   ; can't use '-I because that gets interpreted as a complex number
   (list (string->symbol "-I") "file" "generate $arch-insn.html in <file>"
d29 2
a30 1
   (list '-N "file" "specify name of insn.html file"
@


1.1
log
@	* Makefile.am (srcroot): New var.
	(html): New rule.
	* Makefile.in: Regenerate.
	* cgen-doc.scm: New file.
	* html.scm: New file.
	* gen-all-doc: New file.
	* dev.scm (cload): Handle DOC application.
	(load-doc): New fn.
	* machs.scm (machs-for-cpu): New fn.
	* model.scm (models-for-cpu): New fn.
	* utils.scm (gen-c-copyright): Renamed from gen-copyright.
	All uses updated.
	(iota): Rewrite to be identical to pmacro version.  All uses updated.
	* utils-cgen.scm (alpha-sort-obj-list): New fn.
@
text
@d2 1
a2 1
; This is invoked to build: $arch-doc.html.
d23 7
a29 2
   (list '-H "file" "generate $arch-doc.html in <file>"
	 (lambda (arg) (file-write arg cgen-doc.html)))
@

