head	1.1;
branch	1.1.1;
access;
symbols
	sid-snapshot-20180601:1.1.1.1
	cgen-snapshot-20180601:1.1.1.1
	sid-snapshot-20180501:1.1.1.1
	cgen-snapshot-20180501:1.1.1.1
	sid-snapshot-20180401:1.1.1.1
	cgen-snapshot-20180401:1.1.1.1
	sid-snapshot-20180301:1.1.1.1
	cgen-snapshot-20180301:1.1.1.1
	sid-snapshot-20180201:1.1.1.1
	cgen-snapshot-20180201:1.1.1.1
	sid-snapshot-20180101:1.1.1.1
	cgen-snapshot-20180101:1.1.1.1
	sid-snapshot-20171201:1.1.1.1
	cgen-snapshot-20171201:1.1.1.1
	sid-snapshot-20171101:1.1.1.1
	cgen-snapshot-20171101:1.1.1.1
	sid-snapshot-20171001:1.1.1.1
	cgen-snapshot-20171001:1.1.1.1
	sid-snapshot-20170901:1.1.1.1
	cgen-snapshot-20170901:1.1.1.1
	sid-snapshot-20170801:1.1.1.1
	cgen-snapshot-20170801:1.1.1.1
	sid-snapshot-20170701:1.1.1.1
	cgen-snapshot-20170701:1.1.1.1
	sid-snapshot-20170601:1.1.1.1
	cgen-snapshot-20170601:1.1.1.1
	sid-snapshot-20170501:1.1.1.1
	cgen-snapshot-20170501:1.1.1.1
	sid-snapshot-20170401:1.1.1.1
	cgen-snapshot-20170401:1.1.1.1
	sid-snapshot-20170301:1.1.1.1
	cgen-snapshot-20170301:1.1.1.1
	sid-snapshot-20170201:1.1.1.1
	cgen-snapshot-20170201:1.1.1.1
	sid-snapshot-20170101:1.1.1.1
	cgen-snapshot-20170101:1.1.1.1
	sid-snapshot-20161201:1.1.1.1
	cgen-snapshot-20161201:1.1.1.1
	sid-snapshot-20161101:1.1.1.1
	cgen-snapshot-20161101:1.1.1.1
	sid-snapshot-20160901:1.1.1.1
	cgen-snapshot-20160901:1.1.1.1
	sid-snapshot-20160801:1.1.1.1
	cgen-snapshot-20160801:1.1.1.1
	sid-snapshot-20160701:1.1.1.1
	cgen-snapshot-20160701:1.1.1.1
	sid-snapshot-20160601:1.1.1.1
	cgen-snapshot-20160601:1.1.1.1
	sid-snapshot-20160501:1.1.1.1
	cgen-snapshot-20160501:1.1.1.1
	sid-snapshot-20160401:1.1.1.1
	cgen-snapshot-20160401:1.1.1.1
	sid-snapshot-20160301:1.1.1.1
	cgen-snapshot-20160301:1.1.1.1
	sid-snapshot-20160201:1.1.1.1
	cgen-snapshot-20160201:1.1.1.1
	sid-snapshot-20160101:1.1.1.1
	cgen-snapshot-20160101:1.1.1.1
	sid-snapshot-20151201:1.1.1.1
	cgen-snapshot-20151201:1.1.1.1
	sid-snapshot-20151101:1.1.1.1
	cgen-snapshot-20151101:1.1.1.1
	sid-snapshot-20151001:1.1.1.1
	cgen-snapshot-20151001:1.1.1.1
	sid-snapshot-20150901:1.1.1.1
	cgen-snapshot-20150901:1.1.1.1
	sid-snapshot-20150801:1.1.1.1
	cgen-snapshot-20150801:1.1.1.1
	sid-snapshot-20150701:1.1.1.1
	cgen-snapshot-20150701:1.1.1.1
	sid-snapshot-20150601:1.1.1.1
	cgen-snapshot-20150601:1.1.1.1
	sid-snapshot-20150501:1.1.1.1
	cgen-snapshot-20150501:1.1.1.1
	sid-snapshot-20150401:1.1.1.1
	cgen-snapshot-20150401:1.1.1.1
	sid-snapshot-20150301:1.1.1.1
	cgen-snapshot-20150301:1.1.1.1
	sid-snapshot-20150201:1.1.1.1
	cgen-snapshot-20150201:1.1.1.1
	sid-snapshot-20150101:1.1.1.1
	cgen-snapshot-20150101:1.1.1.1
	sid-snapshot-20141201:1.1.1.1
	cgen-snapshot-20141201:1.1.1.1
	sid-snapshot-20141101:1.1.1.1
	cgen-snapshot-20141101:1.1.1.1
	sid-snapshot-20141001:1.1.1.1
	cgen-snapshot-20141001:1.1.1.1
	sid-snapshot-20140901:1.1.1.1
	cgen-snapshot-20140901:1.1.1.1
	sid-snapshot-20140801:1.1.1.1
	cgen-snapshot-20140801:1.1.1.1
	sid-snapshot-20140701:1.1.1.1
	cgen-snapshot-20140701:1.1.1.1
	sid-snapshot-20140601:1.1.1.1
	cgen-snapshot-20140601:1.1.1.1
	sid-snapshot-20140501:1.1.1.1
	cgen-snapshot-20140501:1.1.1.1
	sid-snapshot-20140401:1.1.1.1
	cgen-snapshot-20140401:1.1.1.1
	sid-snapshot-20140301:1.1.1.1
	cgen-snapshot-20140301:1.1.1.1
	sid-snapshot-20140201:1.1.1.1
	cgen-snapshot-20140201:1.1.1.1
	sid-snapshot-20140101:1.1.1.1
	cgen-snapshot-20140101:1.1.1.1
	sid-snapshot-20131201:1.1.1.1
	cgen-snapshot-20131201:1.1.1.1
	sid-snapshot-20131101:1.1.1.1
	cgen-snapshot-20131101:1.1.1.1
	sid-snapshot-20131001:1.1.1.1
	cgen-snapshot-20131001:1.1.1.1
	sid-snapshot-20130901:1.1.1.1
	cgen-snapshot-20130901:1.1.1.1
	sid-snapshot-20130801:1.1.1.1
	cgen-snapshot-20130801:1.1.1.1
	sid-snapshot-20130701:1.1.1.1
	cgen-snapshot-20130701:1.1.1.1
	sid-snapshot-20130601:1.1.1.1
	cgen-snapshot-20130601:1.1.1.1
	sid-snapshot-20130501:1.1.1.1
	cgen-snapshot-20130501:1.1.1.1
	sid-snapshot-20130401:1.1.1.1
	cgen-snapshot-20130401:1.1.1.1
	sid-snapshot-20130301:1.1.1.1
	cgen-snapshot-20130301:1.1.1.1
	sid-snapshot-20130201:1.1.1.1
	cgen-snapshot-20130201:1.1.1.1
	sid-snapshot-20130101:1.1.1.1
	cgen-snapshot-20130101:1.1.1.1
	sid-snapshot-20121201:1.1.1.1
	cgen-snapshot-20121201:1.1.1.1
	sid-snapshot-20121101:1.1.1.1
	cgen-snapshot-20121101:1.1.1.1
	sid-snapshot-20121001:1.1.1.1
	cgen-snapshot-20121001:1.1.1.1
	sid-snapshot-20120901:1.1.1.1
	cgen-snapshot-20120901:1.1.1.1
	sid-snapshot-20120801:1.1.1.1
	cgen-snapshot-20120801:1.1.1.1
	sid-snapshot-20120701:1.1.1.1
	cgen-snapshot-20120701:1.1.1.1
	sid-snapshot-20120601:1.1.1.1
	cgen-snapshot-20120601:1.1.1.1
	sid-snapshot-20120501:1.1.1.1
	cgen-snapshot-20120501:1.1.1.1
	sid-snapshot-20120401:1.1.1.1
	cgen-snapshot-20120401:1.1.1.1
	sid-snapshot-20120301:1.1.1.1
	cgen-snapshot-20120301:1.1.1.1
	sid-snapshot-20120201:1.1.1.1
	cgen-snapshot-20120201:1.1.1.1
	sid-snapshot-20120101:1.1.1.1
	cgen-snapshot-20120101:1.1.1.1
	sid-snapshot-20111201:1.1.1.1
	cgen-snapshot-20111201:1.1.1.1
	sid-snapshot-20111101:1.1.1.1
	cgen-snapshot-20111101:1.1.1.1
	sid-snapshot-20111001:1.1.1.1
	cgen-snapshot-20111001:1.1.1.1
	sid-snapshot-20110901:1.1.1.1
	cgen-snapshot-20110901:1.1.1.1
	sid-snapshot-20110801:1.1.1.1
	cgen-snapshot-20110801:1.1.1.1
	sid-snapshot-20110701:1.1.1.1
	cgen-snapshot-20110701:1.1.1.1
	sid-snapshot-20110601:1.1.1.1
	cgen-snapshot-20110601:1.1.1.1
	sid-snapshot-20110501:1.1.1.1
	cgen-snapshot-20110501:1.1.1.1
	sid-snapshot-20110401:1.1.1.1
	cgen-snapshot-20110401:1.1.1.1
	sid-snapshot-20110301:1.1.1.1
	cgen-snapshot-20110301:1.1.1.1
	sid-snapshot-20110201:1.1.1.1
	cgen-snapshot-20110201:1.1.1.1
	sid-snapshot-20110101:1.1.1.1
	cgen-snapshot-20110101:1.1.1.1
	sid-snapshot-20101201:1.1.1.1
	cgen-snapshot-20101201:1.1.1.1
	sid-snapshot-20101101:1.1.1.1
	cgen-snapshot-20101101:1.1.1.1
	sid-snapshot-20101001:1.1.1.1
	cgen-snapshot-20101001:1.1.1.1
	sid-snapshot-20100901:1.1.1.1
	cgen-snapshot-20100901:1.1.1.1
	sid-snapshot-20100801:1.1.1.1
	cgen-snapshot-20100801:1.1.1.1
	sid-snapshot-20100701:1.1.1.1
	cgen-snapshot-20100701:1.1.1.1
	sid-snapshot-20100601:1.1.1.1
	cgen-snapshot-20100601:1.1.1.1
	sid-snapshot-20100501:1.1.1.1
	cgen-snapshot-20100501:1.1.1.1
	sid-snapshot-20100401:1.1.1.1
	cgen-snapshot-20100401:1.1.1.1
	sid-snapshot-20100301:1.1.1.1
	cgen-snapshot-20100301:1.1.1.1
	sid-snapshot-20100201:1.1.1.1
	cgen-snapshot-20100201:1.1.1.1
	sid-snapshot-20100101:1.1.1.1
	cgen-snapshot-20100101:1.1.1.1
	sid-snapshot-20091201:1.1.1.1
	cgen-snapshot-20091201:1.1.1.1
	sid-snapshot-20091101:1.1.1.1
	cgen-snapshot-20091101:1.1.1.1
	sid-snapshot-20091001:1.1.1.1
	cgen-snapshot-20091001:1.1.1.1
	arc-sim-20090309:1.1.1.1
	sid-snapshot-20090901:1.1.1.1
	cgen-snapshot-20090901:1.1.1.1
	sid-snapshot-20090801:1.1.1.1
	cgen-snapshot-20090801:1.1.1.1
	sid-snapshot-20090701:1.1.1.1
	cgen-snapshot-20090701:1.1.1.1
	dje-cgen-play1-branch:1.1.1.1.0.14
	dje-cgen-play1-branchpoint:1.1.1.1
	cgen-1_1-branch:1.1.1.1.0.12
	cgen-1_1-branchpoint:1.1.1.1
	sid-snapshot-20090601:1.1.1.1
	cgen-snapshot-20090601:1.1.1.1
	sid-snapshot-20090501:1.1.1.1
	cgen-snapshot-20090501:1.1.1.1
	sid-snapshot-20090401:1.1.1.1
	cgen-snapshot-20090401:1.1.1.1
	arc-insight_6_8-branch:1.1.1.1.0.10
	arc-insight_6_8-branchpoint:1.1.1.1
	sid-snapshot-20090301:1.1.1.1
	cgen-snapshot-20090301:1.1.1.1
	sid-snapshot-20090201:1.1.1.1
	cgen-snapshot-20090201:1.1.1.1
	sid-snapshot-20090101:1.1.1.1
	cgen-snapshot-20090101:1.1.1.1
	sid-snapshot-20081201:1.1.1.1
	cgen-snapshot-20081201:1.1.1.1
	sid-snapshot-20081101:1.1.1.1
	cgen-snapshot-20081101:1.1.1.1
	sid-snapshot-20081001:1.1.1.1
	cgen-snapshot-20081001:1.1.1.1
	sid-snapshot-20080901:1.1.1.1
	cgen-snapshot-20080901:1.1.1.1
	sid-snapshot-20080801:1.1.1.1
	cgen-snapshot-20080801:1.1.1.1
	sid-snapshot-20080701:1.1.1.1
	cgen-snapshot-20080701:1.1.1.1
	sid-snapshot-20080601:1.1.1.1
	cgen-snapshot-20080601:1.1.1.1
	sid-snapshot-20080501:1.1.1.1
	cgen-snapshot-20080501:1.1.1.1
	sid-snapshot-20080403:1.1.1.1
	sid-snapshot-20080401:1.1.1.1
	cgen-snapshot-20080401:1.1.1.1
	sid-snapshot-20080301:1.1.1.1
	cgen-snapshot-20080301:1.1.1.1
	sid-snapshot-20080201:1.1.1.1
	cgen-snapshot-20080201:1.1.1.1
	sid-snapshot-20080101:1.1.1.1
	cgen-snapshot-20080101:1.1.1.1
	sid-snapshot-20071201:1.1.1.1
	cgen-snapshot-20071201:1.1.1.1
	sid-snapshot-20071101:1.1.1.1
	cgen-snapshot-20071101:1.1.1.1
	sid-snapshot-20071001:1.1.1.1
	cgen-snapshot-20071001:1.1.1.1
	msnyder-fork-checkpoint-branch:1.1.1.1.0.8
	msnyder-fork-checkpoint-branchpoint:1.1.1.1
	sid-20020905-branchpoint:1.1.1.1
	sid-20020905-branch:1.1.1.1.0.6
	cagney_regbuf-20020515-branch:1.1.1.1.0.4
	cagney_regbuf-20020515-branchpoint:1.1.1.1
	cygnus_cvs_20020108_pre:1.1.1.1
	cgen-1-1-branch:1.1.1.1.0.2
	cgen-1-0:1.1.1.1
	cygnus:1.1.1;
locks; strict;
comment	@# @;


1.1
date	2000.07.28.04.11.53;	author bje;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2000.07.28.04.11.53;	author bje;	state Exp;
branches;
next	;


desc
@@



1.1
log
@Initial revision
@
text
@;;; "sort.scm" Defines: sorted?, merge, merge!, sort, sort!
;;; Author : Richard A. O'Keefe (based on Prolog code by D.H.D.Warren)

;;; Updated: 11 June 1991
;;; Modified for scheme library: Aubrey Jaffer 19 Sept. 1991

;;; (sorted? sequence less?)
;;; is true when sequence is a list (x0 x1 ... xm) or a vector #(x0 ... xm)
;;; such that for all 1 <= i <= m,
;;;	(not (less? (list-ref list i) (list-ref list (- i 1)))).

(define (sort:sorted? seq less?)
    (cond
	((null? seq)
	    #t)
	((vector? seq)
	    (let ((n (vector-length seq)))
		(if (<= n 1)
		    #t
		    (do ((i 1 (+ i 1)))
			((or (= i n)
			     (less? (vector-ref seq (- i 1))
			     	    (vector-ref seq i)))
			    (= i n)) )) ))
	(else
	    (let loop ((last (car seq)) (next (cdr seq)))
		(or (null? next)
		    (and (not (less? (car next) last))
			 (loop (car next) (cdr next)) )) )) ))


;;; (merge a b less?)
;;; takes two lists a and b such that (sorted? a less?) and (sorted? b less?)
;;; and returns a new list in which the elements of a and b have been stably
;;; interleaved so that (sorted? (merge a b less?) less?).
;;; Note:  this does _not_ accept vectors.  See below.

(define (sort:merge a b less?)
    (cond
	((null? a) b)
	((null? b) a)
	(else (let loop ((x (car a)) (a (cdr a)) (y (car b)) (b (cdr b)))
	    ;; The loop handles the merging of non-empty lists.  It has
	    ;; been written this way to save testing and car/cdring.
	    (if (less? y x)
		(if (null? b)
		    (cons y (cons x a))
		    (cons y (loop x a (car b) (cdr b)) ))
		;; x <= y
		(if (null? a)
		    (cons x (cons y b))
		    (cons x (loop (car a) (cdr a) y b)) )) )) ))


;;; (merge! a b less?)
;;; takes two sorted lists a and b and smashes their cdr fields to form a
;;; single sorted list including the elements of both.
;;; Note:  this does _not_ accept vectors.

(define (sort:merge! a b less?)
    (define (loop r a b)
	(if (less? (car b) (car a))
	    (begin
		(set-cdr! r b)
		(if (null? (cdr b))
		    (set-cdr! b a)
		    (loop b a (cdr b)) ))
	    ;; (car a) <= (car b)
	    (begin
		(set-cdr! r a)
		(if (null? (cdr a))
		    (set-cdr! a b)
		    (loop a (cdr a) b)) )) )
    (cond
	((null? a) b)
	((null? b) a)
	((less? (car b) (car a))
	    (if (null? (cdr b))
		(set-cdr! b a)
		(loop b a (cdr b)))
	    b)
	(else ; (car a) <= (car b)
	    (if (null? (cdr a))
		(set-cdr! a b)
		(loop a (cdr a) b))
	    a)))



;;; (sort! sequence less?)
;;; sorts the list or vector sequence destructively.  It uses a version
;;; of merge-sort invented, to the best of my knowledge, by David H. D.
;;; Warren, and first used in the DEC-10 Prolog system.  R. A. O'Keefe
;;; adapted it to work destructively in Scheme.

(define (sort:sort! seq less?)
    (define (step n)
	(cond
	    ((> n 2)
		(let* ((j (quotient n 2))
		       (a (step j))
		       (k (- n j))
		       (b (step k)))
		    (sort:merge! a b less?)))
	    ((= n 2)
		(let ((x (car seq))
		      (y (cadr seq))
		      (p seq))
		    (set! seq (cddr seq))
		    (if (less? y x) (begin
			(set-car! p y)
			(set-car! (cdr p) x)))
		    (set-cdr! (cdr p) '())
		    p))
	    ((= n 1)
		(let ((p seq))
		    (set! seq (cdr seq))
		    (set-cdr! p '())
		    p))
	    (else
		'()) ))
    (if (vector? seq)
	(let ((n (vector-length seq))
	      (vec seq))
	  (set! seq (vector->list seq))
	  (do ((p (step n) (cdr p))
	       (i 0 (+ i 1)))
	      ((null? p) vec)
	    (vector-set! vec i (car p)) ))
	;; otherwise, assume it is a list
	(step (length seq)) ))

;;; (sort sequence less?)
;;; sorts a vector or list non-destructively.  It does this by sorting a
;;; copy of the sequence.  My understanding is that the Standard says
;;; that the result of append is always "newly allocated" except for
;;; sharing structure with "the last argument", so (append x '()) ought
;;; to be a standard way of copying a list x.

(define (sort:sort seq less?)
    (if (vector? seq)
	(list->vector (sort:sort! (vector->list seq) less?))
	(sort:sort! (append seq '()) less?)))

;;; eof

(define sorted? sort:sorted?)
(define merge sort:merge)
(define merge! sort:merge!)
(define sort sort:sort)
(define sort! sort:sort!)
@


1.1.1.1
log
@CGEN 1.0 import
@
text
@@
