head	1.5;
access;
symbols
	sid-snapshot-20180601:1.5
	cgen-snapshot-20180601:1.5
	sid-snapshot-20180501:1.5
	cgen-snapshot-20180501:1.5
	sid-snapshot-20180401:1.5
	cgen-snapshot-20180401:1.5
	sid-snapshot-20180301:1.5
	cgen-snapshot-20180301:1.5
	sid-snapshot-20180201:1.5
	cgen-snapshot-20180201:1.5
	sid-snapshot-20180101:1.5
	cgen-snapshot-20180101:1.5
	sid-snapshot-20171201:1.5
	cgen-snapshot-20171201:1.5
	sid-snapshot-20171101:1.5
	cgen-snapshot-20171101:1.5
	sid-snapshot-20171001:1.5
	cgen-snapshot-20171001:1.5
	sid-snapshot-20170901:1.5
	cgen-snapshot-20170901:1.5
	sid-snapshot-20170801:1.5
	cgen-snapshot-20170801:1.5
	sid-snapshot-20170701:1.5
	cgen-snapshot-20170701:1.5
	sid-snapshot-20170601:1.5
	cgen-snapshot-20170601:1.5
	sid-snapshot-20170501:1.5
	cgen-snapshot-20170501:1.5
	sid-snapshot-20170401:1.5
	cgen-snapshot-20170401:1.5
	sid-snapshot-20170301:1.5
	cgen-snapshot-20170301:1.5
	sid-snapshot-20170201:1.5
	cgen-snapshot-20170201:1.5
	sid-snapshot-20170101:1.5
	cgen-snapshot-20170101:1.5
	sid-snapshot-20161201:1.5
	cgen-snapshot-20161201:1.5
	sid-snapshot-20161101:1.5
	cgen-snapshot-20161101:1.5
	sid-snapshot-20160901:1.5
	cgen-snapshot-20160901:1.5
	sid-snapshot-20160801:1.5
	cgen-snapshot-20160801:1.5
	sid-snapshot-20160701:1.5
	cgen-snapshot-20160701:1.5
	sid-snapshot-20160601:1.5
	cgen-snapshot-20160601:1.5
	sid-snapshot-20160501:1.5
	cgen-snapshot-20160501:1.5
	sid-snapshot-20160401:1.5
	cgen-snapshot-20160401:1.5
	sid-snapshot-20160301:1.5
	cgen-snapshot-20160301:1.5
	sid-snapshot-20160201:1.5
	cgen-snapshot-20160201:1.5
	sid-snapshot-20160101:1.5
	cgen-snapshot-20160101:1.5
	sid-snapshot-20151201:1.5
	cgen-snapshot-20151201:1.5
	sid-snapshot-20151101:1.5
	cgen-snapshot-20151101:1.5
	sid-snapshot-20151001:1.5
	cgen-snapshot-20151001:1.5
	sid-snapshot-20150901:1.5
	cgen-snapshot-20150901:1.5
	sid-snapshot-20150801:1.5
	cgen-snapshot-20150801:1.5
	sid-snapshot-20150701:1.5
	cgen-snapshot-20150701:1.5
	sid-snapshot-20150601:1.5
	cgen-snapshot-20150601:1.5
	sid-snapshot-20150501:1.5
	cgen-snapshot-20150501:1.5
	sid-snapshot-20150401:1.5
	cgen-snapshot-20150401:1.5
	sid-snapshot-20150301:1.5
	cgen-snapshot-20150301:1.5
	sid-snapshot-20150201:1.5
	cgen-snapshot-20150201:1.5
	sid-snapshot-20150101:1.5
	cgen-snapshot-20150101:1.5
	sid-snapshot-20141201:1.5
	cgen-snapshot-20141201:1.5
	sid-snapshot-20141101:1.5
	cgen-snapshot-20141101:1.5
	sid-snapshot-20141001:1.5
	cgen-snapshot-20141001:1.5
	sid-snapshot-20140901:1.5
	cgen-snapshot-20140901:1.5
	sid-snapshot-20140801:1.5
	cgen-snapshot-20140801:1.5
	sid-snapshot-20140701:1.5
	cgen-snapshot-20140701:1.5
	sid-snapshot-20140601:1.5
	cgen-snapshot-20140601:1.5
	sid-snapshot-20140501:1.5
	cgen-snapshot-20140501:1.5
	sid-snapshot-20140401:1.5
	cgen-snapshot-20140401:1.5
	sid-snapshot-20140301:1.5
	cgen-snapshot-20140301:1.5
	sid-snapshot-20140201:1.5
	cgen-snapshot-20140201:1.5
	sid-snapshot-20140101:1.5
	cgen-snapshot-20140101:1.5
	sid-snapshot-20131201:1.5
	cgen-snapshot-20131201:1.5
	sid-snapshot-20131101:1.5
	cgen-snapshot-20131101:1.5
	sid-snapshot-20131001:1.5
	cgen-snapshot-20131001:1.5
	sid-snapshot-20130901:1.5
	cgen-snapshot-20130901:1.5
	sid-snapshot-20130801:1.5
	cgen-snapshot-20130801:1.5
	sid-snapshot-20130701:1.5
	cgen-snapshot-20130701:1.5
	sid-snapshot-20130601:1.5
	cgen-snapshot-20130601:1.5
	sid-snapshot-20130501:1.5
	cgen-snapshot-20130501:1.5
	sid-snapshot-20130401:1.5
	cgen-snapshot-20130401:1.5
	sid-snapshot-20130301:1.5
	cgen-snapshot-20130301:1.5
	sid-snapshot-20130201:1.5
	cgen-snapshot-20130201:1.5
	sid-snapshot-20130101:1.5
	cgen-snapshot-20130101:1.5
	sid-snapshot-20121201:1.5
	cgen-snapshot-20121201:1.5
	sid-snapshot-20121101:1.5
	cgen-snapshot-20121101:1.5
	sid-snapshot-20121001:1.5
	cgen-snapshot-20121001:1.5
	sid-snapshot-20120901:1.5
	cgen-snapshot-20120901:1.5
	sid-snapshot-20120801:1.5
	cgen-snapshot-20120801:1.5
	sid-snapshot-20120701:1.5
	cgen-snapshot-20120701:1.5
	sid-snapshot-20120601:1.5
	cgen-snapshot-20120601:1.5
	sid-snapshot-20120501:1.5
	cgen-snapshot-20120501:1.5
	sid-snapshot-20120401:1.5
	cgen-snapshot-20120401:1.5
	sid-snapshot-20120301:1.5
	cgen-snapshot-20120301:1.5
	sid-snapshot-20120201:1.5
	cgen-snapshot-20120201:1.5
	sid-snapshot-20120101:1.5
	cgen-snapshot-20120101:1.5
	sid-snapshot-20111201:1.5
	cgen-snapshot-20111201:1.5
	sid-snapshot-20111101:1.5
	cgen-snapshot-20111101:1.5
	sid-snapshot-20111001:1.5
	cgen-snapshot-20111001:1.5
	sid-snapshot-20110901:1.5
	cgen-snapshot-20110901:1.5
	sid-snapshot-20110801:1.5
	cgen-snapshot-20110801:1.5
	sid-snapshot-20110701:1.5
	cgen-snapshot-20110701:1.5
	sid-snapshot-20110601:1.5
	cgen-snapshot-20110601:1.5
	sid-snapshot-20110501:1.5
	cgen-snapshot-20110501:1.5
	sid-snapshot-20110401:1.5
	cgen-snapshot-20110401:1.5
	sid-snapshot-20110301:1.5
	cgen-snapshot-20110301:1.5
	sid-snapshot-20110201:1.5
	cgen-snapshot-20110201:1.5
	sid-snapshot-20110101:1.5
	cgen-snapshot-20110101:1.5
	sid-snapshot-20101201:1.5
	cgen-snapshot-20101201:1.5
	sid-snapshot-20101101:1.5
	cgen-snapshot-20101101:1.5
	sid-snapshot-20101001:1.5
	cgen-snapshot-20101001:1.5
	sid-snapshot-20100901:1.5
	cgen-snapshot-20100901:1.5
	sid-snapshot-20100801:1.5
	cgen-snapshot-20100801:1.5
	sid-snapshot-20100701:1.5
	cgen-snapshot-20100701:1.5
	sid-snapshot-20100601:1.5
	cgen-snapshot-20100601:1.5
	sid-snapshot-20100501:1.5
	cgen-snapshot-20100501:1.5
	sid-snapshot-20100401:1.5
	cgen-snapshot-20100401:1.5
	sid-snapshot-20100301:1.5
	cgen-snapshot-20100301:1.5
	sid-snapshot-20100201:1.5
	cgen-snapshot-20100201:1.5
	sid-snapshot-20100101:1.5
	cgen-snapshot-20100101:1.5
	sid-snapshot-20091201:1.5
	cgen-snapshot-20091201:1.5
	sid-snapshot-20091101:1.5
	cgen-snapshot-20091101:1.5
	sid-snapshot-20091001:1.5
	cgen-snapshot-20091001:1.5
	arc-sim-20090309:1.3
	sid-snapshot-20090901:1.5
	cgen-snapshot-20090901:1.5
	sid-snapshot-20090801:1.5
	cgen-snapshot-20090801:1.5
	sid-snapshot-20090701:1.4
	cgen-snapshot-20090701:1.4
	dje-cgen-play1-branch:1.4.0.2
	dje-cgen-play1-branchpoint:1.4
	cgen-1_1-branch:1.3.0.6
	cgen-1_1-branchpoint:1.3
	sid-snapshot-20090601:1.3
	cgen-snapshot-20090601:1.3
	sid-snapshot-20090501:1.3
	cgen-snapshot-20090501:1.3
	sid-snapshot-20090401:1.3
	cgen-snapshot-20090401:1.3
	arc-insight_6_8-branch:1.3.0.4
	arc-insight_6_8-branchpoint:1.3
	sid-snapshot-20090301:1.3
	cgen-snapshot-20090301:1.3
	sid-snapshot-20090201:1.3
	cgen-snapshot-20090201:1.3
	sid-snapshot-20090101:1.3
	cgen-snapshot-20090101:1.3
	sid-snapshot-20081201:1.3
	cgen-snapshot-20081201:1.3
	sid-snapshot-20081101:1.3
	cgen-snapshot-20081101:1.3
	sid-snapshot-20081001:1.3
	cgen-snapshot-20081001:1.3
	sid-snapshot-20080901:1.3
	cgen-snapshot-20080901:1.3
	sid-snapshot-20080801:1.3
	cgen-snapshot-20080801:1.3
	sid-snapshot-20080701:1.3
	cgen-snapshot-20080701:1.3
	sid-snapshot-20080601:1.3
	cgen-snapshot-20080601:1.3
	sid-snapshot-20080501:1.3
	cgen-snapshot-20080501:1.3
	sid-snapshot-20080403:1.3
	sid-snapshot-20080401:1.3
	cgen-snapshot-20080401:1.3
	sid-snapshot-20080301:1.3
	cgen-snapshot-20080301:1.3
	sid-snapshot-20080201:1.3
	cgen-snapshot-20080201:1.3
	sid-snapshot-20080101:1.3
	cgen-snapshot-20080101:1.3
	sid-snapshot-20071201:1.3
	cgen-snapshot-20071201:1.3
	sid-snapshot-20071101:1.3
	cgen-snapshot-20071101:1.3
	sid-snapshot-20071001:1.3
	cgen-snapshot-20071001:1.3
	msnyder-fork-checkpoint-branch:1.3.0.2
	msnyder-fork-checkpoint-branchpoint:1.3
	sid-20020905-branchpoint:1.1.1.1
	sid-20020905-branch:1.1.1.1.0.6
	cagney_regbuf-20020515-branch:1.1.1.1.0.4
	cagney_regbuf-20020515-branchpoint:1.1.1.1
	cygnus_cvs_20020108_pre:1.1.1.1
	cgen-1-1-branch:1.1.1.1.0.2
	cgen-1-0:1.1.1.1
	cygnus:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2009.07.07.18.27.08;	author devans;	state Exp;
branches;
next	1.4;

1.4
date	2009.06.24.15.03.09;	author devans;	state Exp;
branches
	1.4.2.1;
next	1.3;

1.3
date	2005.02.08.04.52.23;	author jimb;	state Exp;
branches
	1.3.6.1;
next	1.2;

1.2
date	2003.09.08.17.17.22;	author brolley;	state Exp;
branches;
next	1.1;

1.1
date	2000.07.28.04.11.52;	author bje;	state Exp;
branches
	1.1.1.1;
next	;

1.4.2.1
date	2009.07.14.16.19.51;	author devans;	state Exp;
branches;
next	;

1.3.6.1
date	2009.06.24.14.57.45;	author devans;	state Exp;
branches;
next	;

1.1.1.1
date	2000.07.28.04.11.52;	author bje;	state Exp;
branches;
next	;


desc
@@


1.5
log
@	* cgen-opc.scm (-opc-file-path,opc-file-path): Move to opcodes.scm
	(opc-arguments, -OPC): Call set-opc-file-path!.
	* opcodes.scm (-opc-file-path,opc-file-path): Moved here.
	(set-opc-file-path!): New function.
	* dev.scm: Mention set-opc-file-path!.  Mention doc options.
@
text
@; CPU description file generator for the GNU Binutils.
; This is invoked to build: $arch-desc.[ch], $arch-opinst.c,
; $arch-opc.h, $arch-opc.c, $arch-asm.in, $arch-dis.in, and $arch-ibld.[ch].
; Copyright (C) 2000, 2009 Red Hat, Inc.
; This file is part of CGEN.
;
; This is a standalone script, we don't load anything until we parse the
; -s argument (keeps reliance off of environment variables, etc.).

; Load the various support routines.

(define (load-files srcdir)
  (load (string-append srcdir "/read.scm"))
  (load (string-append srcdir "/desc.scm"))
  (load (string-append srcdir "/desc-cpu.scm"))
  (load (string-append srcdir "/opcodes.scm"))
  (load (string-append srcdir "/opc-asmdis.scm"))
  (load (string-append srcdir "/opc-ibld.scm"))
  (load (string-append srcdir "/opc-itab.scm"))
  (load (string-append srcdir "/opc-opinst.scm"))
)

(define opc-arguments
  (list
   (list "-OPC" "file" "specify path to .opc file"
	 (lambda (arg) (set-opc-file-path! arg))
	 #f)
   (list "-H" "file" "generate $arch-desc.h in <file>"
	 #f
	 (lambda (arg) (file-write arg cgen-desc.h)))
   (list "-C" "file" "generate $arch-desc.c in <file>"
	 #f
	 (lambda (arg) (file-write arg cgen-desc.c)))
   (list "-O" "file" "generate $arch-opc.h in <file>"
	 #f
	 (lambda (arg) (file-write arg cgen-opc.h)))
   (list "-P" "file" "generate $arch-opc.c in <file>"
	 #f
	 (lambda (arg) (file-write arg cgen-opc.c)))
   (list "-Q" "file" "generate $arch-opinst.c in <file>"
	 #f
	 (lambda (arg) (file-write arg cgen-opinst.c)))
   (list "-B" "file" "generate $arch-ibld.h in <file>"
	 #f
	 (lambda (arg) (file-write arg cgen-ibld.h)))
   (list "-L" "file" "generate $arch-ibld.in in <file>"
	 #f
	 (lambda (arg) (file-write arg cgen-ibld.in)))
   (list "-A" "file" "generate $arch-asm.in in <file>"
	 #f
	 (lambda (arg) (file-write arg cgen-asm.in)))
   (list "-D" "file" "generate $arch-dis.in in <file>"
	 #f
	 (lambda (arg) (file-write arg cgen-dis.in)))
   )
)

; (-R "file" "generate $cpu-reloc.h") ; FIXME: wip (rename to -abi.h?)
; (-S "file" "generate cpu-$cpu.c") ; FIXME: wip (bfd's cpu-$cpu.c)
; ((-R) (file-write *arg* cgen-reloc.c))
; ((-S) (file-write *arg* cgen-bfdcpu.c))

; Kept global so it's available to the other .scm files.
(define srcdir ".")

; Scan argv for -s srcdir.
; We can't process any other args until we find the cgen source dir.
; The result is srcdir.
; We assume "-s" isn't the argument to another option.  Unwise, yes.
; Alternatives are to require it to be the first argument or at least preceed
; any option with a "-s" argument, or to put knowledge of the common argument
; set and common argument parsing code in every top level file.

(define (find-srcdir argv)
  (let loop ((argv argv))
    (if (null? argv)
	(error "`-s srcdir' not present, can't load cgen"))
    (if (string=? "-s" (car argv))
	(begin
	  (if (null? (cdr argv))
	      (error "missing srcdir arg to `-s'"))
	  (cadr argv))
	(loop (cdr argv))))	
)

; Main routine, parses options and calls generators.

(define (cgen-opc argv)
  (let ()

    ; Find and set srcdir, then load all Scheme code.
    ; Drop the first argument, it is the script name (i.e. argv[0]).
    (set! srcdir (find-srcdir (cdr argv)))
    (set! %load-path (cons srcdir %load-path))
    (load-files srcdir)

    (display-argv argv)

    (cgen #:argv argv
	  #:app-name "opcodes"
	  #:arg-spec opc-arguments
	  #:init opcodes-init!
	  #:finish opcodes-finish!
	  #:analyze opcodes-analyze!)
    )
)

(cgen-opc (program-arguments))
@


1.4
log
@	* All *.scm files: Update copyright year.
	* utils.scm (copyright-fsf, copyright-redhat): Ditto.
@
text
@a22 8
; Records the -OPC arg which specifies the path to the .opc file.
(define -opc-file-path #f)
(define (opc-file-path)
  (if -opc-file-path
      -opc-file-path
      (error ".opc file unspecified, missing -OPC argument"))
)

d26 1
a26 1
	 (lambda (arg) (set! -opc-file-path arg))
@


1.4.2.1
log
@Bring over various patches from the trunk.
@
text
@d23 8
d34 1
a34 1
	 (lambda (arg) (set-opc-file-path! arg))
@


1.3
log
@cgen/ChangeLog:
2005-02-07  Jim Blandy  <jimb@@redhat.com>

	* cgen-opc.scm: Don't load fixup.scm here.  (See corresponding
	changes in the opcodes directory.)

opcodes/ChangeLog:
2005-02-07  Jim Blandy  <jimb@@redhat.com>

	* Makefile.am (CGEN): Load guile.scm before calling the main
	application script.
	* Makefile.in: Regenerated.
	* cgen.sh: Be prepared for the 'cgen' argument to contain spaces.
	Simply pass the cgen-opc.scm path to ${cgen} as its first
	argument; ${cgen} itself now contains the '-s', or whatever is
	appropriate for the Scheme being used.
@
text
@d4 1
a4 1
; Copyright (C) 2000 Red Hat, Inc.
@


1.3.6.1
log
@	* All *.scm files: Update copyright year.
	* utils.scm (copyright-fsf, copyright-redhat): Ditto.
@
text
@d4 1
a4 1
; Copyright (C) 2000, 2009 Red Hat, Inc.
@


1.2
log
@2003-09-08  Dave Brolley  <brolley@@redhat.com>

        On behalf of Doug Evans <dje@@sebabeach.org>
        Pass in paths to input files, instead of assuming they live in
        $srcdir/cpu.  Plus misc. option processing cleanup.
        * cgen-doc.scm (doc-arguments): Make options strings not symbols.
        Add pre-process pass to all options.
        * cgen-gas.scm (gas-arguments): Ditto.
        * cgen-sid.scm (sim-arguments): Ditto.
        * cgen-sim.scm (sim-arguments): Ditto.
        * cgen-stest.scm (stest-arguments): Ditto.
        * cgen-opc.scm (opc-arguments): Ditto.  New argument -OPC.
        (-opc-file-path): New global.
        (opc-file-path): New fn.
        * opcodes.scm (read-cpu.opc): Replace srcdir,cpu args with opc-file.
        All callers updated.
        (gen-extra-cpu.h,gen-extra-cpu.c,gen-extra-opc.h,gen-extra-opc.c,
        gen-extra-asm.c,gen-extra-dis.c,gen-extra-ibld.h,gen-extra-ibld.c):
        Replace srcdir arg with opc-file.  All callers updated.
        * read.scm (-opt-spec-update): Delete.
        (opt-get-first-pass,opt-get-second-pass): New fns.
        (-cgen): Process application-specific arguments in two passes.
@
text
@a12 3
  ; Fix up Scheme to be what we use (guile is always in flux).
  (primitive-load-path (string-append srcdir "/fixup.scm"))

@


1.1
log
@Initial revision
@
text
@d26 8
d36 5
a40 1
   (list '-H "file" "generate $arch-desc.h in <file>"
d42 2
a43 1
   (list '-C "file" "generate $arch-desc.c in <file>"
d45 2
a46 1
   (list '-O "file" "generate $arch-opc.h in <file>"
d48 2
a49 1
   (list '-P "file" "generate $arch-opc.c in <file>"
d51 2
a52 1
   (list '-Q "file" "generate $arch-opinst.c in <file>"
d54 2
a55 1
   (list '-B "file" "generate $arch-ibld.h in <file>"
d57 2
a58 1
   (list '-L "file" "generate $arch-ibld.in in <file>"
d60 2
a61 1
   (list '-A "file" "generate $arch-asm.in in <file>"
d63 2
a64 1
   (list '-D "file" "generate $arch-dis.in in <file>"
@


1.1.1.1
log
@CGEN 1.0 import
@
text
@@
