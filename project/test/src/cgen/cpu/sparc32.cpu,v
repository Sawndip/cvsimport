head	1.1;
access;
symbols
	sid-snapshot-20180601:1.1
	cgen-snapshot-20180601:1.1
	sid-snapshot-20180501:1.1
	cgen-snapshot-20180501:1.1
	sid-snapshot-20180401:1.1
	cgen-snapshot-20180401:1.1
	sid-snapshot-20180301:1.1
	cgen-snapshot-20180301:1.1
	sid-snapshot-20180201:1.1
	cgen-snapshot-20180201:1.1
	sid-snapshot-20180101:1.1
	cgen-snapshot-20180101:1.1
	sid-snapshot-20171201:1.1
	cgen-snapshot-20171201:1.1
	sid-snapshot-20171101:1.1
	cgen-snapshot-20171101:1.1
	sid-snapshot-20171001:1.1
	cgen-snapshot-20171001:1.1
	sid-snapshot-20170901:1.1
	cgen-snapshot-20170901:1.1
	sid-snapshot-20170801:1.1
	cgen-snapshot-20170801:1.1
	sid-snapshot-20170701:1.1
	cgen-snapshot-20170701:1.1
	sid-snapshot-20170601:1.1
	cgen-snapshot-20170601:1.1
	sid-snapshot-20170501:1.1
	cgen-snapshot-20170501:1.1
	sid-snapshot-20170401:1.1
	cgen-snapshot-20170401:1.1
	sid-snapshot-20170301:1.1
	cgen-snapshot-20170301:1.1
	sid-snapshot-20170201:1.1
	cgen-snapshot-20170201:1.1
	sid-snapshot-20170101:1.1
	cgen-snapshot-20170101:1.1
	sid-snapshot-20161201:1.1
	cgen-snapshot-20161201:1.1
	sid-snapshot-20161101:1.1
	cgen-snapshot-20161101:1.1
	sid-snapshot-20160901:1.1
	cgen-snapshot-20160901:1.1
	sid-snapshot-20160801:1.1
	cgen-snapshot-20160801:1.1
	sid-snapshot-20160701:1.1
	cgen-snapshot-20160701:1.1
	sid-snapshot-20160601:1.1
	cgen-snapshot-20160601:1.1
	sid-snapshot-20160501:1.1
	cgen-snapshot-20160501:1.1
	sid-snapshot-20160401:1.1
	cgen-snapshot-20160401:1.1
	sid-snapshot-20160301:1.1
	cgen-snapshot-20160301:1.1
	sid-snapshot-20160201:1.1
	cgen-snapshot-20160201:1.1
	sid-snapshot-20160101:1.1
	cgen-snapshot-20160101:1.1
	sid-snapshot-20151201:1.1
	cgen-snapshot-20151201:1.1
	sid-snapshot-20151101:1.1
	cgen-snapshot-20151101:1.1
	sid-snapshot-20151001:1.1
	cgen-snapshot-20151001:1.1
	sid-snapshot-20150901:1.1
	cgen-snapshot-20150901:1.1
	sid-snapshot-20150801:1.1
	cgen-snapshot-20150801:1.1
	sid-snapshot-20150701:1.1
	cgen-snapshot-20150701:1.1
	sid-snapshot-20150601:1.1
	cgen-snapshot-20150601:1.1
	sid-snapshot-20150501:1.1
	cgen-snapshot-20150501:1.1
	sid-snapshot-20150401:1.1
	cgen-snapshot-20150401:1.1
	sid-snapshot-20150301:1.1
	cgen-snapshot-20150301:1.1
	sid-snapshot-20150201:1.1
	cgen-snapshot-20150201:1.1
	sid-snapshot-20150101:1.1
	cgen-snapshot-20150101:1.1
	sid-snapshot-20141201:1.1
	cgen-snapshot-20141201:1.1
	sid-snapshot-20141101:1.1
	cgen-snapshot-20141101:1.1
	sid-snapshot-20141001:1.1
	cgen-snapshot-20141001:1.1
	sid-snapshot-20140901:1.1
	cgen-snapshot-20140901:1.1
	sid-snapshot-20140801:1.1
	cgen-snapshot-20140801:1.1
	sid-snapshot-20140701:1.1
	cgen-snapshot-20140701:1.1
	sid-snapshot-20140601:1.1
	cgen-snapshot-20140601:1.1
	sid-snapshot-20140501:1.1
	cgen-snapshot-20140501:1.1
	sid-snapshot-20140401:1.1
	cgen-snapshot-20140401:1.1
	sid-snapshot-20140301:1.1
	cgen-snapshot-20140301:1.1
	sid-snapshot-20140201:1.1
	cgen-snapshot-20140201:1.1
	sid-snapshot-20140101:1.1
	cgen-snapshot-20140101:1.1
	sid-snapshot-20131201:1.1
	cgen-snapshot-20131201:1.1
	sid-snapshot-20131101:1.1
	cgen-snapshot-20131101:1.1
	sid-snapshot-20131001:1.1
	cgen-snapshot-20131001:1.1
	sid-snapshot-20130901:1.1
	cgen-snapshot-20130901:1.1
	sid-snapshot-20130801:1.1
	cgen-snapshot-20130801:1.1
	sid-snapshot-20130701:1.1
	cgen-snapshot-20130701:1.1
	sid-snapshot-20130601:1.1
	cgen-snapshot-20130601:1.1
	sid-snapshot-20130501:1.1
	cgen-snapshot-20130501:1.1
	sid-snapshot-20130401:1.1
	cgen-snapshot-20130401:1.1
	sid-snapshot-20130301:1.1
	cgen-snapshot-20130301:1.1
	sid-snapshot-20130201:1.1
	cgen-snapshot-20130201:1.1
	sid-snapshot-20130101:1.1
	cgen-snapshot-20130101:1.1
	sid-snapshot-20121201:1.1
	cgen-snapshot-20121201:1.1
	sid-snapshot-20121101:1.1
	cgen-snapshot-20121101:1.1
	sid-snapshot-20121001:1.1
	cgen-snapshot-20121001:1.1
	sid-snapshot-20120901:1.1
	cgen-snapshot-20120901:1.1
	sid-snapshot-20120801:1.1
	cgen-snapshot-20120801:1.1
	sid-snapshot-20120701:1.1
	cgen-snapshot-20120701:1.1
	sid-snapshot-20120601:1.1
	cgen-snapshot-20120601:1.1
	sid-snapshot-20120501:1.1
	cgen-snapshot-20120501:1.1
	sid-snapshot-20120401:1.1
	cgen-snapshot-20120401:1.1
	sid-snapshot-20120301:1.1
	cgen-snapshot-20120301:1.1
	sid-snapshot-20120201:1.1
	cgen-snapshot-20120201:1.1
	sid-snapshot-20120101:1.1
	cgen-snapshot-20120101:1.1
	sid-snapshot-20111201:1.1
	cgen-snapshot-20111201:1.1
	sid-snapshot-20111101:1.1
	cgen-snapshot-20111101:1.1
	sid-snapshot-20111001:1.1
	cgen-snapshot-20111001:1.1
	sid-snapshot-20110901:1.1
	cgen-snapshot-20110901:1.1
	sid-snapshot-20110801:1.1
	cgen-snapshot-20110801:1.1
	sid-snapshot-20110701:1.1
	cgen-snapshot-20110701:1.1
	sid-snapshot-20110601:1.1
	cgen-snapshot-20110601:1.1
	sid-snapshot-20110501:1.1
	cgen-snapshot-20110501:1.1
	sid-snapshot-20110401:1.1
	cgen-snapshot-20110401:1.1
	sid-snapshot-20110301:1.1
	cgen-snapshot-20110301:1.1
	sid-snapshot-20110201:1.1
	cgen-snapshot-20110201:1.1
	sid-snapshot-20110101:1.1
	cgen-snapshot-20110101:1.1
	sid-snapshot-20101201:1.1
	cgen-snapshot-20101201:1.1
	sid-snapshot-20101101:1.1
	cgen-snapshot-20101101:1.1
	sid-snapshot-20101001:1.1
	cgen-snapshot-20101001:1.1
	sid-snapshot-20100901:1.1
	cgen-snapshot-20100901:1.1
	sid-snapshot-20100801:1.1
	cgen-snapshot-20100801:1.1
	sid-snapshot-20100701:1.1
	cgen-snapshot-20100701:1.1
	sid-snapshot-20100601:1.1
	cgen-snapshot-20100601:1.1
	sid-snapshot-20100501:1.1
	cgen-snapshot-20100501:1.1
	sid-snapshot-20100401:1.1
	cgen-snapshot-20100401:1.1
	sid-snapshot-20100301:1.1
	cgen-snapshot-20100301:1.1
	sid-snapshot-20100201:1.1
	cgen-snapshot-20100201:1.1
	sid-snapshot-20100101:1.1
	cgen-snapshot-20100101:1.1
	sid-snapshot-20091201:1.1
	cgen-snapshot-20091201:1.1
	sid-snapshot-20091101:1.1
	cgen-snapshot-20091101:1.1
	sid-snapshot-20091001:1.1
	cgen-snapshot-20091001:1.1
	arc-sim-20090309:1.1
	sid-snapshot-20090901:1.1
	cgen-snapshot-20090901:1.1
	sid-snapshot-20090801:1.1
	cgen-snapshot-20090801:1.1
	sid-snapshot-20090701:1.1
	cgen-snapshot-20090701:1.1
	dje-cgen-play1-branch:1.1.0.88
	dje-cgen-play1-branchpoint:1.1
	cgen-1_1-branch:1.1.0.86
	cgen-1_1-branchpoint:1.1
	sid-snapshot-20090601:1.1
	cgen-snapshot-20090601:1.1
	sid-snapshot-20090501:1.1
	cgen-snapshot-20090501:1.1
	sid-snapshot-20090401:1.1
	cgen-snapshot-20090401:1.1
	arc-insight_6_8-branch:1.1.0.84
	arc-insight_6_8-branchpoint:1.1
	sid-snapshot-20090301:1.1
	cgen-snapshot-20090301:1.1
	sid-snapshot-20090201:1.1
	cgen-snapshot-20090201:1.1
	sid-snapshot-20090101:1.1
	cgen-snapshot-20090101:1.1
	sid-snapshot-20081201:1.1
	cgen-snapshot-20081201:1.1
	sid-snapshot-20081101:1.1
	cgen-snapshot-20081101:1.1
	sid-snapshot-20081001:1.1
	cgen-snapshot-20081001:1.1
	sid-snapshot-20080901:1.1
	cgen-snapshot-20080901:1.1
	sid-snapshot-20080801:1.1
	cgen-snapshot-20080801:1.1
	sid-snapshot-20080701:1.1
	cgen-snapshot-20080701:1.1
	sid-snapshot-20080601:1.1
	cgen-snapshot-20080601:1.1
	sid-snapshot-20080501:1.1
	cgen-snapshot-20080501:1.1
	sid-snapshot-20080403:1.1
	sid-snapshot-20080401:1.1
	cgen-snapshot-20080401:1.1
	sid-snapshot-20080301:1.1
	cgen-snapshot-20080301:1.1
	sid-snapshot-20080201:1.1
	cgen-snapshot-20080201:1.1
	sid-snapshot-20080101:1.1
	cgen-snapshot-20080101:1.1
	sid-snapshot-20071201:1.1
	cgen-snapshot-20071201:1.1
	sid-snapshot-20071101:1.1
	cgen-snapshot-20071101:1.1
	sid-snapshot-20071001:1.1
	cgen-snapshot-20071001:1.1
	msnyder-fork-checkpoint-branch:1.1.0.82
	msnyder-fork-checkpoint-branchpoint:1.1
	gdb-csl-arm-20051020-branch:1.1.0.78
	gdb-csl-arm-20051020-branchpoint:1.1
	drow_intercu-merge-20040921:1.1
	drow_intercu-merge-20040915:1.1
	jimb-gdb_6_2-e500-branch:1.1.0.80
	jimb-gdb_6_2-e500-branchpoint:1.1
	gdb_6_2-20040730-release:1.1
	gdb_6_2-branch:1.1.0.76
	gdb_6_2-2004-07-10-gmt-branchpoint:1.1
	gdb_6_1_1-20040616-release:1.1
	gdb_6_1-2004-04-05-release:1.1
	drow_intercu-merge-20040402:1.1
	drow_intercu-merge-20040327:1.1
	ezannoni_pie-20040323-branch:1.1.0.74
	ezannoni_pie-20040323-branchpoint:1.1
	cagney_tramp-20040321-mergepoint:1.1
	cagney_tramp-20040309-branch:1.1.0.72
	cagney_tramp-20040309-branchpoint:1.1
	gdb_6_1-branch:1.1.0.70
	gdb_6_1-2004-03-01-gmt-branchpoint:1.1
	drow_intercu-20040221-branch:1.1.0.68
	drow_intercu-20040221-branchpoint:1.1
	cagney_bfdfile-20040213-branch:1.1.0.66
	cagney_bfdfile-20040213-branchpoint:1.1
	drow-cplus-merge-20040208:1.1
	carlton_dictionary-20040126-merge:1.1
	cagney_bigcore-20040122-branch:1.1.0.64
	cagney_bigcore-20040122-branchpoint:1.1
	drow-cplus-merge-20040113:1.1
	drow-cplus-merge-20031224:1.1
	drow-cplus-merge-20031220:1.1
	carlton_dictionary-20031215-merge:1.1
	drow-cplus-merge-20031214:1.1
	carlton-dictionary-20031111-merge:1.1
	gdb_6_0-2003-10-04-release:1.1
	kettenis_sparc-20030918-branch:1.1.0.62
	kettenis_sparc-20030918-branchpoint:1.1
	carlton_dictionary-20030917-merge:1.1
	ezannoni_pie-20030916-branchpoint:1.1
	ezannoni_pie-20030916-branch:1.1.0.60
	cagney_x86i386-20030821-branch:1.1.0.58
	cagney_x86i386-20030821-branchpoint:1.1
	carlton_dictionary-20030805-merge:1.1
	carlton_dictionary-20030627-merge:1.1
	gdb_6_0-branch:1.1.0.56
	gdb_6_0-2003-06-23-branchpoint:1.1
	jimb-ppc64-linux-20030613-branch:1.1.0.54
	jimb-ppc64-linux-20030613-branchpoint:1.1
	cagney_convert-20030606-branch:1.1.0.52
	cagney_convert-20030606-branchpoint:1.1
	cagney_writestrings-20030508-branch:1.1.0.50
	cagney_writestrings-20030508-branchpoint:1.1
	jimb-ppc64-linux-20030528-branch:1.1.0.48
	jimb-ppc64-linux-20030528-branchpoint:1.1
	carlton_dictionary-20030523-merge:1.1
	cagney_fileio-20030521-branch:1.1.0.46
	cagney_fileio-20030521-branchpoint:1.1
	kettenis_i386newframe-20030517-mergepoint:1.1
	jimb-ppc64-linux-20030509-branch:1.1.0.44
	jimb-ppc64-linux-20030509-branchpoint:1.1
	kettenis_i386newframe-20030504-mergepoint:1.1
	carlton_dictionary-20030430-merge:1.1
	kettenis_i386newframe-20030419-branch:1.1.0.42
	kettenis_i386newframe-20030419-branchpoint:1.1
	carlton_dictionary-20030416-merge:1.1
	cagney_frameaddr-20030409-mergepoint:1.1
	kettenis_i386newframe-20030406-branch:1.1.0.40
	kettenis_i386newframe-20030406-branchpoint:1.1
	cagney_frameaddr-20030403-branchpoint:1.1
	cagney_frameaddr-20030403-branch:1.1.0.38
	cagney_framebase-20030330-mergepoint:1.1
	cagney_framebase-20030326-branch:1.1.0.36
	cagney_framebase-20030326-branchpoint:1.1
	cagney_lazyid-20030317-branch:1.1.0.34
	cagney_lazyid-20030317-branchpoint:1.1
	kettenis-i386newframe-20030316-mergepoint:1.1
	offbyone-20030313-branch:1.1.0.32
	offbyone-20030313-branchpoint:1.1
	kettenis-i386newframe-20030308-branch:1.1.0.30
	kettenis-i386newframe-20030308-branchpoint:1.1
	carlton_dictionary-20030305-merge:1.1
	cagney_offbyone-20030303-branch:1.1.0.28
	cagney_offbyone-20030303-branchpoint:1.1
	carlton_dictionary-20030207-merge:1.1
	interps-20030202-branch:1.1.0.26
	interps-20030202-branchpoint:1.1
	cagney-unwind-20030108-branch:1.1.0.24
	cagney-unwind-20030108-branchpoint:1.1
	carlton_dictionary-20021223-merge:1.1
	gdb_5_3-2002-12-12-release:1.1
	carlton_dictionary-20021115-merge:1.1
	kseitz_interps-20021105-merge:1.1
	kseitz_interps-20021103-merge:1.1
	drow-cplus-merge-20021020:1.1
	drow-cplus-merge-20021025:1.1
	carlton_dictionary-20021025-merge:1.1
	carlton_dictionary-20021011-merge:1.1
	drow-cplus-branch:1.1.0.22
	drow-cplus-branchpoint:1.1
	kseitz_interps-20020930-merge:1.1
	carlton_dictionary-20020927-merge:1.1
	carlton_dictionary-branch:1.1.0.20
	carlton_dictionary-20020920-branchpoint:1.1
	sid-20020905-branchpoint:1.1
	sid-20020905-branch:1.1.0.18
	gdb_5_3-branch:1.1.0.16
	gdb_5_3-2002-09-04-branchpoint:1.1
	kseitz_interps-20020829-merge:1.1
	cagney_sysregs-20020825-branch:1.1.0.14
	cagney_sysregs-20020825-branchpoint:1.1
	readline_4_3-import-branch:1.1.0.12
	readline_4_3-import-branchpoint:1.1
	gdb_5_2_1-2002-07-23-release:1.1
	kseitz_interps-20020528-branch:1.1.0.10
	kseitz_interps-20020528-branchpoint:1.1
	cagney_regbuf-20020515-branch:1.1.0.8
	cagney_regbuf-20020515-branchpoint:1.1
	jimb-macro-020506-branch:1.1.0.6
	jimb-macro-020506-branchpoint:1.1
	gdb_5_2-2002-04-29-release:1.1
	gdb_5_2-branch:1.1.0.4
	gdb_5_2-2002-03-03-branchpoint:1.1
	cygnus_cvs_20020108_pre:1.1
	cgen-1-1-branch:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2001.07.05.12.45.47;	author bje;	state Exp;
branches;
next	;


desc
@@


1.1
log
@2001-07-05  Ben Elliston  <bje@@redhat.com>

	* README: Update.

	* read.scm (include): Include files from srcdir/cpu.
	(-cgen): Likewise for loading .cpu files.
	* *.cpu: Move all cpu descriptions into cpu subdirectory.
	* *.opc: Likewise.
	* simplify.inc: Likewise.
@
text
@; SPARC32 CPU description.  -*- Scheme -*-
; This file contains elements specific to sparc32.
; Copyright (C) 2000 Red Hat, Inc.
; This file is part of CGEN.
; See file COPYING.CGEN for details.

; Notes:
; - sparc64 support wip
; - fp support todo
; - source file layout wip
; - cpu family layout wip

; ??? For the nonce there is one cpu family to cover all 32 bit sparcs.
; It's not clear this will work, but following the goal of incremental
; complication ....

(define-cpu
  (name sparc32)
  (comment "SPARC 32 bit architecture")
  (endian big)
  (word-bitsize 32)
  ; Generated files have a "32" suffix.
  (file-transform "32")
)

(define-mach
  (name sparc-v8)
  (comment "sparc v8")
  (cpu sparc32)
  (bfd-name "sparc")
)

(define-mach
  (name sparclite)
  (comment "Fujitsu sparclite")
  (cpu sparc32)
  (bfd-name "sparc_sparclite")
)

; sparc32 models

(define-model
  (name sparc32-def)
  (comment "sparc32 default")
  (attrs)
  (mach sparc-v8)
  ; wip
  (pipeline p-foo "" () ((fetch) (decode) (execute) (memory) (writeback)))
  (unit u-exec "Execution Unit" ()
	1 1 ; issue done
	() () () ())
)

; sparc32 enums of opcodes, special insn values, etc.

; sparc32 hardware pieces.

; ??? impl,ver are left as part of h-psr (change maybe later)
(define-hardware
  (name h-psr)
  (comment "psr register")
  (type register USI)
  (get () (c-call USI "@@cpu@@_get_h_psr_handler"))
  (set (newval) (c-call VOID "@@cpu@@_set_h_psr_handler" newval))
)

(dsh h-s "supervisor bit" () (register BI))
(dsh h-ps "previous supervisor bit" () (register BI))

(dsh h-pil "processor interrupt level" () (register UQI))

(dsh h-et "enable traps bit" () (register BI))

(define-hardware
  (name h-tbr)
  (comment "trap base register")
  (type register WI)
  ;CPU (h_tbr) = (CPU (h_tbr) & 0xff0) | ((newval) & 0xfffff000);
  (set (newval) (set (raw-reg WI h-tbr)
		     (or WI (and WI (raw-reg WI h-tbr) (const #xff0))
			  (and WI newval (const #xfffff000)))))
)

(define-hardware
  (name h-cwp)
  (comment "current window pointer")
  (type register UQI)
  (set (newval) (c-call VOID "@@cpu@@_set_h_cwp_handler" newval))
)

(define-hardware
  (name h-wim)
  (comment "window invalid mask")
  (type register USI)
  ; ??? These just put ideas down so I can play with them.  Ignore.
  ;(get (value index) (and SI value (c-code SI "((1 << NWINDOWS) - 1)")))
  ;(get (self mode index insn)
  ;     (c-code USI "(CPU (h_wim) & ((1 << NWINDOWS) - 1))"))
  ;(set (self mode index insn newval)
  ;    (s-eval `(set SI ,self (and SI ,newval (const #xff)))))
  (get () (and (raw-reg USI h-wim)
	       (sub (sll (const 1) (c-raw-call SI "GET_NWINDOWS")) (const 1))))
)

(dsh h-ag "alternate global indicator" () (register QI))

; Coprocessor support.

(dsh h-ec "enable coprocessor bit" () (register BI))

; Floating point support.
; wip.
; - currently evaluating the various possibilities

(dsh h-ef "enable fpu bit" () (register BI))

(dsh h-fsr "floating point status register" () (register USI))

; sparc32 instruction definitions.

; Special register move operations.

; %y is handled by the asr insns

(dni rd-asr "read asr" ()
     "rd $rdasr,$rd" ; note: `rdasr' is for ReaD asr, `rd' is for Reg Dest.
     (+ OP_2 OP3_RDASR rd rdasr (f-i 0) (f-simm13 0))
     (set rd rdasr)
     ())
(dni wr-asr "write asr" ()
     "wr $rs1,$rs2,$wrasr"
     (+ OP_2 OP3_WRASR wrasr rs1 rs2 (f-i 0) (f-res-asi 0))
     (set wrasr (xor rs1 rs2))
     ())
(dni wr-asr-imm "write-imm asr" ()
     "wr $rs1,$simm13,$wrasr"
     (+ OP_2 OP3_WRASR wrasr rs1 (f-i 1) simm13)
     (set wrasr (xor rs1 simm13))
     ())

(define-pmacro (rdwr-op name op3 asm-name reg-name)
  (begin
     (dni (.sym rd- name) (.str "read " name) ()
	  (.str "rd " asm-name ",$rd")
	  (+ OP_2 (.sym OP3_RD op3) rd (f-rs1 0) (f-i 0) (f-simm13 0))
	  (set rd (reg WI reg-name))
	  ())
     (dni (.sym wr- name) (.str "write " name) ()
	  (.str "wr $rs1,$rs2," asm-name)
	  (+ OP_2 (.sym OP3_WR op3) (f-rd 0) rs1 rs2 (f-i 0) (f-res-asi 0))
	  (set (reg WI reg-name) (xor rs1 rs2))
	  ())
     (dni (.sym wr- name -imm) (.str "write-imm " name) ()
	  (.str "wr $rs1,$simm13," asm-name)
	  (+ OP_2 (.sym OP3_WR op3) (f-rd 0) rs1 (f-i 1) simm13)
	  (set (reg WI reg-name) (xor rs1 simm13))
	  ())
     )
)

(rdwr-op psr PSR "%psr" h-psr)
(rdwr-op wim WIM "%wim" h-wim)
(rdwr-op tbr TBR "%tbr" h-tbr)

; TODO:
; - rdy,wry
; - stbar
; - flush
; - ldc, lddc, ldcsr, stc, stdc, stcsr, stdcq
; - cbccc, cpop
@
