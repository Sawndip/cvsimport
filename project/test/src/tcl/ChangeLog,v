head	1.43;
access;
symbols
	sid-snapshot-20180601:1.43
	sid-snapshot-20180501:1.43
	sid-snapshot-20180401:1.43
	sid-snapshot-20180301:1.43
	sid-snapshot-20180201:1.43
	sid-snapshot-20180101:1.43
	sid-snapshot-20171201:1.43
	sid-snapshot-20171101:1.43
	sid-snapshot-20171001:1.43
	sid-snapshot-20170901:1.43
	sid-snapshot-20170801:1.43
	sid-snapshot-20170701:1.43
	sid-snapshot-20170601:1.43
	sid-snapshot-20170501:1.43
	sid-snapshot-20170401:1.43
	sid-snapshot-20170301:1.43
	sid-snapshot-20170201:1.43
	sid-snapshot-20170101:1.43
	sid-snapshot-20161201:1.43
	sid-snapshot-20161101:1.43
	sid-snapshot-20160901:1.43
	sid-snapshot-20160801:1.43
	sid-snapshot-20160701:1.43
	sid-snapshot-20160601:1.43
	sid-snapshot-20160501:1.43
	sid-snapshot-20160401:1.43
	sid-snapshot-20160301:1.43
	sid-snapshot-20160201:1.43
	sid-snapshot-20160101:1.43
	sid-snapshot-20151201:1.43
	sid-snapshot-20151101:1.43
	sid-snapshot-20151001:1.43
	sid-snapshot-20150901:1.43
	sid-snapshot-20150801:1.43
	sid-snapshot-20150701:1.43
	sid-snapshot-20150601:1.43
	sid-snapshot-20150501:1.43
	sid-snapshot-20150401:1.43
	sid-snapshot-20150301:1.43
	sid-snapshot-20150201:1.43
	sid-snapshot-20150101:1.43
	sid-snapshot-20141201:1.43
	sid-snapshot-20141101:1.43
	sid-snapshot-20141001:1.43
	sid-snapshot-20140901:1.43
	sid-snapshot-20140801:1.43
	sid-snapshot-20140701:1.43
	sid-snapshot-20140601:1.43
	sid-snapshot-20140501:1.43
	sid-snapshot-20140401:1.43
	sid-snapshot-20140301:1.43
	sid-snapshot-20140201:1.43
	sid-snapshot-20140101:1.43
	sid-snapshot-20131201:1.43
	sid-snapshot-20131101:1.43
	sid-snapshot-20131001:1.43
	sid-snapshot-20130901:1.43
	sid-snapshot-20130801:1.43
	sid-snapshot-20130701:1.43
	sid-snapshot-20130601:1.43
	insight_7_6-2013-04-10-branchpoint:1.43
	gdb_7_6-branch:1.43.0.12
	sid-snapshot-20130501:1.43
	sid-snapshot-20130401:1.43
	sid-snapshot-20130301:1.43
	sid-snapshot-20130201:1.43
	sid-snapshot-20130101:1.43
	sid-snapshot-20121201:1.43
	sid-snapshot-20121101:1.43
	sid-snapshot-20121001:1.43
	sid-snapshot-20120901:1.43
	gdb_7_5-branch:1.43.0.10
	sid-snapshot-20120801:1.43
	sid-snapshot-20120701:1.43
	sid-snapshot-20120601:1.43
	sid-snapshot-20120501:1.43
	sid-snapshot-20120401:1.43
	gdb_7_4-branch:1.43.0.8
	sid-snapshot-20120301:1.43
	sid-snapshot-20120201:1.43
	sid-snapshot-20120101:1.43
	sid-snapshot-20111201:1.43
	sid-snapshot-20111101:1.43
	sid-snapshot-20111001:1.43
	sid-snapshot-20110901:1.43
	gdb_7_3-branch:1.43.0.6
	sid-snapshot-20110801:1.43
	sid-snapshot-20110701:1.43
	sid-snapshot-20110601:1.43
	sid-snapshot-20110501:1.43
	sid-snapshot-20110401:1.43
	sid-snapshot-20110301:1.43
	sid-snapshot-20110201:1.43
	sid-snapshot-20110101:1.43
	sid-snapshot-20101201:1.43
	sid-snapshot-20101101:1.43
	sid-snapshot-20101001:1.43
	sid-snapshot-20100901:1.43
	sid-snapshot-20100801:1.43
	sid-snapshot-20100701:1.43
	sid-snapshot-20100601:1.43
	sid-snapshot-20100501:1.43
	sid-snapshot-20100401:1.43
	sid-snapshot-20100301:1.43
	gdb_7_1-branch:1.43.0.4
	gdb_7_0-branch:1.43.0.2
	sid-snapshot-20100201:1.43
	sid-snapshot-20100101:1.43
	sid-snapshot-20091201:1.43
	sid-snapshot-20091101:1.43
	sid-snapshot-20091001:1.43
	arc-sim-20090309:1.42
	sid-snapshot-20090901:1.43
	sid-snapshot-20090801:1.43
	sid-snapshot-20090701:1.43
	sid-snapshot-20090601:1.43
	sid-snapshot-20090501:1.43
	kevinb-pre-tcl8_5_7_merge:1.43
	sid-snapshot-20090401:1.43
	arc-insight_6_8-branch:1.42.0.6
	arc-insight_6_8-branchpoint:1.42
	insight_6_8-branch:1.42.0.4
	insight_6_8-branchpoint:1.42
	sid-snapshot-20090301:1.43
	sid-snapshot-20090201:1.43
	sid-snapshot-20090101:1.43
	sid-snapshot-20081201:1.43
	sid-snapshot-20081101:1.43
	sid-snapshot-20081001:1.43
	sid-snapshot-20080901:1.43
	sid-snapshot-20080801:1.43
	sid-snapshot-20080701:1.43
	sid-snapshot-20080601:1.43
	sid-snapshot-20080501:1.43
	sid-snapshot-20080403:1.42
	sid-snapshot-20080401:1.42
	gdb_6_8-branch:1.42.0.2
	sid-snapshot-20080301:1.41
	sid-snapshot-20080201:1.41
	sid-snapshot-20080101:1.41
	sid-snapshot-20071201:1.41
	sid-snapshot-20071101:1.41
	sid-snapshot-20071001:1.41
	insight_6_6-20070208-release:1.36.2.1
	gdb_6_6-branch:1.36.0.2
	gdb_6_6-2006-11-15-branchpoint:1.36
	insight_6_5-20061003-release:1.35
	gdb_6_5-branch:1.35.0.4
	gdb_6_5-2006-05-14-branchpoint:1.35
	readline_5_1-import-branch:1.35.0.2
	readline_5_1-import-branchpoint:1.35
	gdb_6_4-branch:1.33.0.10
	gdb_6_4-2005-11-01-branchpoint:1.33
	msnyder-tracepoint-checkpoint-branch:1.33.0.8
	msnyder-tracepoint-checkpoint-branchpoint:1.33
	gdb_6_1-2004-04-05-release:1.33
	ezannoni_pie-20040323-branch:1.33.0.6
	ezannoni_pie-20040323-branchpoint:1.33
	cagney_tramp-20040321-mergepoint:1.33
	cagney_tramp-20040309-branch:1.33.0.4
	cagney_tramp-20040309-branchpoint:1.33
	gdb_6_1-branch:1.33.0.2
	gdb_6_1-2004-03-01-gmt-branchpoint:1.33
	drow-cplus-merge-20040208:1.33
	carlton_dictionary-20040126-merge:1.33
	drow-cplus-merge-20040113:1.32
	drow-cplus-merge-20031224:1.32
	drow-cplus-merge-20031220:1.32
	carlton_dictionary-20031215-merge:1.32
	drow-cplus-merge-20031214:1.32
	carlton-dictionary-20031111-merge:1.32
	gdb_6_0-2003-10-04-release:1.32
	carlton_dictionary-20030917-merge:1.32
	ezannoni_pie-20030916-branchpoint:1.32
	ezannoni_pie-20030916-branch:1.32.0.22
	cagney_x86i386-20030821-branch:1.32.0.20
	cagney_x86i386-20030821-branchpoint:1.32
	carlton_dictionary-20030805-merge:1.32
	carlton_dictionary-20030627-merge:1.32
	gdb_6_0-branch:1.32.0.18
	gdb_6_0-2003-06-23-branchpoint:1.32
	cagney_convert-20030606-branch:1.32.0.16
	cagney_convert-20030606-branchpoint:1.32
	cagney_writestrings-20030508-branch:1.32.0.14
	cagney_writestrings-20030508-branchpoint:1.32
	carlton_dictionary-20030523-merge:1.32
	cagney_fileio-20030521-branch:1.32.0.12
	cagney_fileio-20030521-branchpoint:1.32
	carlton_dictionary-20030430-merge:1.32
	carlton_dictionary-20030416-merge:1.32
	cagney_frameaddr-20030409-mergepoint:1.32
	cagney_frameaddr-20030403-branchpoint:1.32
	cagney_frameaddr-20030403-branch:1.32.0.10
	cagney_framebase-20030330-mergepoint:1.32
	cagney_framebase-20030326-branch:1.32.0.8
	cagney_framebase-20030326-branchpoint:1.32
	cagney_lazyid-20030317-branch:1.32.0.6
	cagney_lazyid-20030317-branchpoint:1.32
	offbyone-20030313-branch:1.32.0.4
	offbyone-20030313-branchpoint:1.32
	carlton_dictionary-20030305-merge:1.32
	cagney_offbyone-20030303-branch:1.32.0.2
	cagney_offbyone-20030303-branchpoint:1.32
	carlton_dictionary-20030207-merge:1.30
	interps-20030202-branch:1.30.0.2
	interps-20030202-branchpoint:1.30
	TCL8_4_1:1.1.1.9
	cagney-unwind-20030108-branch:1.29.0.2
	cagney-unwind-20030108-branchpoint:1.29
	carlton_dictionary-20021223-merge:1.29
	gdb_5_3-2002-12-12-release:1.23
	TCL_8_4_1:1.1.1.9
	carlton_dictionary-20021115-merge:1.26
	kseitz_interps-20021105-merge:1.26
	kseitz_interps-20021103-merge:1.26
	drow-cplus-merge-20021020:1.26
	drow-cplus-merge-20021025:1.26
	carlton_dictionary-20021025-merge:1.26
	carlton_dictionary-20021011-merge:1.26
	drow-cplus-branch:1.25.0.4
	drow-cplus-branchpoint:1.25
	kseitz_interps-20020930-merge:1.25
	carlton_dictionary-20020927-merge:1.25
	tcltk840-20020924-branch:1.25.0.2
	tcltk840-20020924-branchpoint:1.25
	TK_8_4_0:1.1.1.7
	TCL_8_4_0:1.1.1.8
	carlton_dictionary-branch:1.24.0.2
	carlton_dictionary-20020920-branchpoint:1.24
	sid-20020905-branchpoint:1.23
	sid-20020905-branch:1.23.0.8
	gdb_5_3-branch:1.23.0.6
	gdb_5_3-2002-09-04-branchpoint:1.23
	kseitz_interps-20020829-merge:1.23
	cagney_sysregs-20020825-branch:1.23.0.4
	cagney_sysregs-20020825-branchpoint:1.23
	readline_4_3-import-branch:1.23.0.2
	readline_4_3-import-branchpoint:1.23
	gdb_5_2_1-2002-07-23-release:1.20
	kseitz_interps-20020528-branch:1.21.0.4
	kseitz_interps-20020528-branchpoint:1.21
	cagney_regbuf-20020515-branch:1.21.0.2
	cagney_regbuf-20020515-branchpoint:1.21
	gdb_5_2-2002-04-29-release:1.20
	gdb_5_2-branch:1.20.0.2
	gdb_5_2-2002-03-03-branchpoint:1.20
	gdb_5_1_1-2002-01-24-release:1.13
	cygnus_cvs_20020108_pre:1.20
	gdb_5_1_0_1-2002-01-03-branch:1.13.0.6
	gdb_5_1_0_1-2002-01-03-branchpoint:1.13
	gdb_5_1-2001-11-21-release:1.13
	gdb_s390-2001-09-26-branch:1.13.0.4
	gdb_s390-2001-09-26-branchpoint:1.13
	TCL_8_3:1.1.1.5
	NET:1.1.1
	gdb_5_1-2001-07-29-branch:1.13.0.2
	gdb_5_1-2001-07-29-branchpoint:1.13
	insight-precleanup-2001-01-01:1.11
	gdb_5_0-2000-05-19-release:1.2.2.1
	gdb_4_18_2-2000-05-18-release:1.2.2.1
	gdb_4_95_1-2000-05-11-snapshot:1.2.2.1
	gdb_4_95_0-2000-04-27-snapshot:1.2.2.1
	gdb_5_0-2000-04-10-branch:1.2.0.2
	gdb_5_0-2000-04-10-branchpoint:1.2
	repo-unification-2000-02-06:1.2
	dejagnu-2000-02-04:1.1.1.4
	dejagnu-2000-01-31:1.1.1.4
	dejagnu-2000-01-24:1.1.1.3
	dejagnu-2000-01-17:1.1.1.3
	dejagnu-2000-01-10:1.1.1.2
	dejagnu-2000-01-04:1.1.1.2
	dejagnu-1999-12-21:1.1.1.2
	dejagnu-1999-12-13:1.1.1.2
	dejagnu-1999-12-07:1.1.1.2
	dejagnu-1999-12-06:1.1.1.2
	dejagnu-1999-11-15:1.1.1.2
	dejagnu-1999-11-08:1.1.1.1
	SNAPSHOT:1.1.1;
locks; strict;
comment	@# @;
expand	@o@;


1.43
date	2008.04.23.18.09.41;	author kseitz;	state Exp;
branches;
next	1.42;

1.42
date	2008.03.03.23.26.42;	author kseitz;	state Exp;
branches;
next	1.41;

1.41
date	2007.05.14.17.11.42;	author cgf;	state Exp;
branches;
next	1.40;

1.40
date	2006.12.01.20.35.55;	author corinna;	state Exp;
branches;
next	1.39;

1.39
date	2006.12.01.03.49.25;	author cgf;	state Exp;
branches;
next	1.38;

1.38
date	2006.12.01.03.41.02;	author cgf;	state Exp;
branches;
next	1.37;

1.37
date	2006.11.30.17.08.30;	author cgf;	state Exp;
branches;
next	1.36;

1.36
date	2006.07.13.15.46.46;	author sje;	state Exp;
branches
	1.36.2.1;
next	1.35;

1.35
date	2006.02.08.02.13.02;	author aoliva;	state Exp;
branches;
next	1.34;

1.34
date	2006.02.02.20.02.09;	author cgf;	state Exp;
branches;
next	1.33;

1.33
date	2004.01.21.14.38.49;	author kseitz;	state Exp;
branches;
next	1.32;

1.32
date	2003.02.12.04.20.58;	author hunt;	state Exp;
branches;
next	1.31;

1.31
date	2003.02.07.19.51.59;	author hunt;	state Exp;
branches;
next	1.30;

1.30
date	2003.01.21.19.39.56;	author hunt;	state Exp;
branches;
next	1.29;

1.29
date	2002.12.20.02.09.17;	author cgf;	state Exp;
branches;
next	1.28;

1.28
date	2002.12.19.06.23.54;	author cgf;	state Exp;
branches;
next	1.27;

1.27
date	2002.11.26.19.47.46;	author hunt;	state Exp;
branches;
next	1.26;

1.26
date	2002.10.06.20.00.35;	author cgf;	state Exp;
branches;
next	1.25;

1.25
date	2002.09.24.18.37.00;	author kseitz;	state Exp;
branches
	1.25.2.1
	1.25.4.1;
next	1.24;

1.24
date	2002.09.13.14.40.59;	author kseitz;	state Exp;
branches
	1.24.2.1;
next	1.23;

1.23
date	2002.08.01.01.36.14;	author kseitz;	state Exp;
branches;
next	1.22;

1.22
date	2002.07.30.20.23.28;	author kseitz;	state Exp;
branches;
next	1.21;

1.21
date	2002.04.09.17.39.27;	author kseitz;	state Exp;
branches
	1.21.4.1;
next	1.20;

1.20
date	2001.10.28.23.31.03;	author cgf;	state Exp;
branches;
next	1.19;

1.19
date	2001.10.28.16.26.29;	author cgf;	state Exp;
branches;
next	1.18;

1.18
date	2001.10.05.20.33.05;	author cgf;	state Exp;
branches;
next	1.17;

1.17
date	2001.09.13.18.27.52;	author irox;	state Exp;
branches;
next	1.16;

1.16
date	2001.09.13.00.38.49;	author irox;	state Exp;
branches;
next	1.15;

1.15
date	2001.09.09.23.56.03;	author irox;	state Exp;
branches;
next	1.14;

1.14
date	2001.09.09.23.26.06;	author irox;	state Exp;
branches;
next	1.13;

1.13
date	2001.07.17.17.25.32;	author fche;	state Exp;
branches;
next	1.12;

1.12
date	2001.04.10.20.08.26;	author cgf;	state Exp;
branches;
next	1.11;

1.11
date	2000.12.14.00.45.22;	author spolk;	state Exp;
branches;
next	1.10;

1.10
date	2000.12.14.00.22.52;	author spolk;	state Exp;
branches;
next	1.9;

1.9
date	2000.06.27.21.51.18;	author spolk;	state Exp;
branches;
next	1.8;

1.8
date	2000.06.11.02.45.14;	author cgf;	state Exp;
branches;
next	1.7;

1.7
date	2000.06.08.03.26.02;	author cgf;	state Exp;
branches;
next	1.6;

1.6
date	2000.06.06.16.18.48;	author cgf;	state Exp;
branches;
next	1.5;

1.5
date	2000.06.06.07.07.37;	author cagney;	state Exp;
branches;
next	1.4;

1.4
date	2000.06.05.23.07.29;	author cgf;	state Exp;
branches;
next	1.3;

1.3
date	2000.04.20.07.26.07;	author cagney;	state Exp;
branches;
next	1.2;

1.2
date	2000.02.07.02.22.32;	author jsm;	state Exp;
branches
	1.2.2.1;
next	1.1;

1.1
date	99.11.09.01.28.43;	author jsm;	state Exp;
branches
	1.1.1.1;
next	;

1.36.2.1
date	2007.02.09.03.55.40;	author kseitz;	state Exp;
branches;
next	;

1.25.2.1
date	2002.09.27.21.48.59;	author kseitz;	state Exp;
branches;
next	;

1.25.4.1
date	2002.10.26.17.12.35;	author drow;	state Exp;
branches;
next	1.25.4.2;

1.25.4.2
date	2003.12.14.20.28.39;	author drow;	state Exp;
branches;
next	1.25.4.3;

1.25.4.3
date	2004.02.09.19.44.05;	author drow;	state Exp;
branches;
next	;

1.24.2.1
date	2002.10.11.22.23.08;	author carlton;	state Exp;
branches;
next	1.24.2.2;

1.24.2.2
date	2002.12.23.19.39.59;	author carlton;	state Exp;
branches;
next	1.24.2.3;

1.24.2.3
date	2003.02.07.19.18.06;	author carlton;	state Exp;
branches;
next	1.24.2.4;

1.24.2.4
date	2003.03.06.00.56.43;	author carlton;	state Exp;
branches;
next	1.24.2.5;

1.24.2.5
date	2004.01.26.19.11.55;	author carlton;	state Exp;
branches;
next	;

1.21.4.1
date	2002.08.09.18.34.38;	author kseitz;	state Exp;
branches;
next	1.21.4.2;

1.21.4.2
date	2002.10.01.00.46.48;	author kseitz;	state Exp;
branches;
next	1.21.4.3;

1.21.4.3
date	2002.11.03.21.48.42;	author ezannoni;	state Exp;
branches;
next	;

1.2.2.1
date	2000.04.20.07.26.11;	author cagney;	state Exp;
branches;
next	;

1.1.1.1
date	99.11.09.01.28.43;	author jsm;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	99.11.17.02.20.44;	author jsm;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2000.01.18.00.05.12;	author jsm;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2000.02.01.03.15.25;	author jsm;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2001.09.09.22.40.53;	author irox;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2002.09.24.19.55.45;	author kseitz;	state Exp;
branches;
next	1.1.1.7;

1.1.1.7
date	2002.09.24.20.24.20;	author kseitz;	state Exp;
branches;
next	1.1.1.8;

1.1.1.8
date	2002.09.24.22.00.44;	author kseitz;	state Exp;
branches;
next	1.1.1.9;

1.1.1.9
date	2002.11.26.19.59.56;	author hunt;	state Exp;
branches;
next	;


desc
@@


1.43
log
@        Based on patch from Masaki Muranaka  <monaka@@monami-software.com>:
        * compat/strstr.c: Include tcl.h and define NULL if it is
        not already defined.
@
text
@2008-04-23  Keith Seitz  <keiths@@redhat.com>

	Based on patch from Masaki Muranaka  <monaka@@monami-software.com>:
	* compat/strstr.c: Include tcl.h and define NULL if it is
	not already defined.

2008-03-03  Keith Seitz  <keiths@@redhat.com>

	From Dave Murphy  <davem@@devkitpro.org>:
	* win/tclWin32Dll.c (TclpCheckStackSpace): Backport
	EXCEPTION_REGISTRATION code from Tcl mainline.

2007-05-14  Maciej W. Rozycki  <macro@@mips.com>

	* win/tclWinPipe.c (TclpCreateProcess): Only use CW_SYNC_WINENV if
	supported by the compilation environment.

2006-12-01  Corinna Vinschen  <corinna@@vinschen.de>

	* win/tclWin32Dll.c (TclWinInit): Set native cwd to Cygwin's cwd.
	* win/tclWinFile.c (TclpObjChdir): Keep native and Cygwin's cwd
	synched.

2006-11-30  Christopher Faylor  <cgf@@timesys.com>

	* cygwin/configure.in (LIB_AC_PROG_CC): Upgrade macro to accommodate
	newer version of autoconf.
	* cygwin/configure: Regenerate.
	* win/tcl.m4: Upgrade to avoid use of obsolete ac_cv_cygwin variable.
	* win/configure: Regenerate.

2006-11-30  Christopher Faylor  <cgf@@timesys.com>

	* win/tclWinPipe.c (TclpCreateProcess): Call cygwin-specific routine to
	set up windows environment.

2006-07-13  Steve Ellcey  <sje@@cup.hp.com>

	* configure.in: Fix for autoconf 2.5.
	* cygwin/configure.in: Fix for autoconf 2.5.
	* win/configure.in: Fix for autoconf 2.5.
	* unix/configure.in: Fix for autoconf 2.5.
	* unix/tcl.m4: Fix for autoconf 2.5.
	* configure: Regenerate.
	* cygwin/configure: Regenerate.
	* tools/configure: Regenerate.
	* unix/configure: Regenerate.
	* unix/dltest/configure: Regenerate.
	* win/configure: Regenerate.

2006-02-08  Alexandre Oliva  <aoliva@@redhat.com>

	* unix/tcl.m4 (SC_CONFIG_CFLAGS, SC_BLOCKING_STYLE): Remove
	unmatched single quote inside backticks.
	* unix/configure: Rebuild.

2006-02-02  Christopher Faylor  <cgf@@timesys.com>

	* win/tclWin32Dll.c (_except_checkstackspace_handler): Define with
	proper attribute to prevent this static function from being deleted due
	to aggressive gcc optimization.
	* win/tclWinChan.c (_except_makefilechannel_handler): Ditto.
	* win/tclWinFCmd.c (_except_dorenamefile_handler): Ditto.

	* configure.in: Make sure that TCL_LIB_SPEC is properly filled out.
	* configure: Regenerate.

2004-01-21  Keith Seitz  <kseitz@@uglyboxes.com>

	From tcl repository:
	2003-10-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
	* generic/tclCmdAH.c (Tcl_FileObjCmd): Changed FILE_ prefix to FCMD_
	to stop symbol/#def clashes on Cygwin/Mingw32 on NT.

2003-02-11  Martin M. Hunt  <hunt@@redhat.com>
	From Mumit Khan  <khan@@nanotech.wisc.edu>

	* generic/tclIOUtil.c (SetFsPathFromAny): Add Cygwin specific
	code to convert POSIX filename to native format.
	* generic/tclFileName.c (Tcl_TranslateFileName): And remove
	from here.
	(TclDoGlob): Adjust.
	* win/tclWinFile.c (TclpObjChdir): Use chdir on Cygwin.


2003-02-06  Martin M. Hunt  <hunt@@redhat.com>

	* win/tcl.m4 (SC_CONFIG_CFLAGS): Don't default to -O.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Don't default to -O.	
	CFLAGS gets set to "-O2" by default in top level
	configure. Adding "-O" here causes the "-O2" to be
	ignored, but only when the user types "make" within
	the tcl subdirectory. This caused some confusion.
	* win/configure: Rebuilt.
	* unix/configure: Rebuilt.

	* generic/tclEnv.c (TclUnsetEnv): Cast arg to unsigned.

	Import from latest tcl sources to fix a bug with
	"file copy"
	2003-01-25  Mo DeJong  <mdejong@@users.sourceforge.net>	
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile, squelch_warnings):
	Re-implement inline ASM SEH handlers for gcc.
	The esp and ebp registers are now saved on the
	stack instead of in global variables so that
	the code is thread safe. Add additional checks
	when TCL_MEM_DEBUG is defined to be sure the
	values were recovered from the stack properly.
	Remove squelch_warnings functions and add
	a dummy call in the handler methods to squelch
	compiler warnings.
	* win/tclWinReg.c: Add casts to avoid compiler
	warning. Fix assignment in if expression bug.


2002-10-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	*** 8.4.1 TAGGED FOR RELEASE ***

	* changes: updated for 8.4.1 release

	* win/Makefile.in: removed @@MEM_DEBUG_FLAGS@@ subst.
	* win/configure: regen
	* win/configure.in: removed SC_ENABLE_MEMDEBUG call
	* win/tcl.m4: replaced SC_ENABLE_MEMDEBUG with a more intelligent
	SC_ENABLE_SYMBOLS that takes yes|no|mem|compile|all as options now.

2002-10-22  Daniel Steffen  <das@@users.sourceforge.net>

	* library/auto.tcl (tcl_findLibrary):
	* library/package.tcl (tclPkgUnknown): on macosx, search inside the
	Resources/Scripts subdirectory of any potential package directory
	* macosx/Tcl.pbproj/project.pbxproj: add standard Frameworks dirs
	to TCL_PACKAGE_PATH make argument.
	* unix/tclUnixInit.c (TclpSetVariables): on macosx, add embedded
	framework dirs to tcl_pkgPath: @@executable_path/../Frameworks and
	@@executable_path/../PrivateFrameworks (if they exist), as well as
	the dirs in DYLD_FRAMEWORK_PATH (if set). [Patch #624509]
	use standard MAXPATHLEN instead of literal 1024

2002-10-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/StringObj.3, doc/Object.3: Documented that Tcl_Obj's
	standard string form is a modified UTF-8; apparently, this was not
	mentioned anywhere in the main docs, and lead to [Bug 624919].

2002-10-21  Daniel Steffen  <das@@users.sourceforge.net>

	* macosx/Tcl.pbproj/project.pbxproj: bumped version to 8.4.1
	* generic/tcl.h: Added reminder comment to edit
	macosx/Tcl.pbproj/project.pbxproj when version number changes.

2002-10-18  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/reg/pkgIndex.tcl:
	* win/configure:
	* win/configure.in:
	* win/Makefile.in:
	* win/makefile.vc:
	* win/makefile.bc:    Updated to reg1.1

	* doc/registry.n:      Added support for broadcasting changes to
	* tests/registry.test: the registry Environment. Noted proper code
	* win/tclWinReg.c:     in the docs. [Patch #625453]

	* unix/Makefile.in (dist): add any mac/tcl*.sea.hqx files

2002-10-17  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclVar.c:	Fixed code that check for proper # of args to
	* tests/var.test:	[array names].  Added test.  [Bug 624755]

2002-10-16  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/configure:                 add workaround for cygwin windres
	* win/tcl.m4 (SC_CONFIG_CFLAGS): problem. [Patch #624010] (howell)

2002-10-15  Jeff Hobbs  <jeffh@@ActiveState.com>

	* README: added archives.tcl.tk note

	* unix/configure:
	* unix/tcl.m4: Correct AIX-5 ppc build flags.
	Correct HP 11 64-bit gcc building. [Patch #601051] (martin)

2002-10-15  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclCmdMZ.c:
	* tests/trace.test: applied patch from Hemang Levana to fix
	[Bug #615043] in execution traces with idle tasks firing.

2002-10-14  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclEnv.c (Tcl_PutEnv): correct possible mem leak.
	[Patch #623269] (brouwers)

2002-10-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tcl.h: Need a different strategy through the maze of
	#defines to let people building with Cygwin build correctly.  Also
	made some comments less misleading...

2002-10-10  Jeff Hobbs  <jeffh@@ActiveState.com>

	* README: fixed minor nits [Bug #607776] (virden)

	* win/configure:
	* win/tcl.m4: enable USE_THREAD_ALLOC (new threaded allocator) by
	default in cygwin configure on Windows.

2002-10-10  Don Porter  <dgp@@users.sourceforge.net>

	* doc/Tcl.n:	Clarified that namespace separators are legal in
			the variable names during $-subtitution. [Bug 615139]
	
	* doc/regexp.n:	Typo correction.  Thanks Ronnie Brunner. [Bug 606826]

2002-10-10  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* unix/tclLoadAout.c
	* unix/tclLoadDl.c
	* unix/tclLoadDld.c
	* unix/tclLoadDyld.c
	* unix/tclLoadNext.c
	* unix/tclLoadOSF.c
	* unix/tclLoadShl.c
	* win/tclWinLoad.c: allow either full paths or simply dll names
	to be specified when loading files (the latter will be looked
	up by the OS on your PATH/LD_LIBRARY_PATH as appropriate).
	Fixes [Bug 611108]

2002-10-09  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/README: doc'ed --enable-symbols options.
	* unix/Makefile.in: removed @@MEM_DEBUG_FLAGS@@ subst.
	* unix/configure: regen
	* unix/configure.in: removed SC_ENABLE_MEMDEBUG call
	* unix/tcl.m4: replaced SC_ENABLE_MEMDEBUG with a more intelligent
	SC_ENABLE_SYMBOLS that takes yes|no|mem|compile|all as options now.

2002-10-09  Kevin B. Kenny  <kennykb@@acm.org>

	* win/tclWinTime.c: Added code to set an exit handler that
	terminates the thread that calibrates the performance counter, so
	that the thread won't outlive unloading the Tcl DLL. [Tcl bug
	620735].

2002-10-09  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/binary.n: More clarification of [binary scan]'s behaviour.

2002-10-09  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclIntDecls.h: fixed botched regen.

2002-10-09  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclInt.decls: made TclSetPreInitScript() declaration
	generic as it is used on mac & aqua as well.
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c: regen.
	* generic/tclCompile.h: added prototype for TclCompileVariableCmd.

	* mac/tclMacPort.h: removed incorrect <fcntl.h> definitions
	and obsolete <stat.h> definitions.
	* mac/tclMacChan.c: removed obsolete GetOpenMode() and replaced 
	associated constants with the <fcntl.h> analogues (they existing
	defs were inconsistent with <fcntl.h> which was causing havoc when
	Tcl_GetOpenMode was used instead of private GetOpenMode).

	* mac/tclMacFCmd.c: removed GenerateUniqueName(), use equivalent
	(and identiaclly named) routine from MoreFiles instead.

	* mac/tclMacLoad.c: CONSTification, fixes to Vince's last changes.

	* mac/tclMacFile.c: 
	* mac/tclMacTest.c:
	* mac/tclMacUnix.c: CONSTification.

	* mac/tclMacOSA.c: CONSTificcation, sprintf fixes, UH 3.4.x changes;
	fix for missing autoname token from TclOSACompileCmd. (bdesgraupes)
	* mac/AppleScript.html(AppleScript delete): doc fix. (bdesgraupes)

	* mac/tcltkMacBuildSupport.sea.hqx: updated MoreFiles to 1.5.3, 
	updated build instructions for 8.4.
	* mac/tclMacProjects.sea.hqx: rebuilt archive.

2002-10-09  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/Alloc.3: Added a note to mention that attempting to allocate
	a zero-length block can return NULL.  [Tk bug 619544]

2002-10-04  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/binary.n: Doc improvements [Patch 616480]

	* tests/fCmd.test, tests/winFCmd.test:
	* tools/eolFix.tcl, tools/genStubs.tcl: [file exist] -> [file exists]
	Thanks to David Welton.

2002-10-03  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n: fixed typo [Bug 618018].  Thanks to "JJM".

2002-10-03  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tools/man2help2.tcl: 
	* tests/http.test, tests/httpd, tests/httpold.test: 
	* tests/env.test, tests/binary.test, tests/autoMkindex.test: 
	* library/init.tcl, library/http/http.tcl: [info exist] should
	really be [info exists].  [Bug 602566]

	* doc/lsearch.n: Better specification of what happens when -sorted
	is mixed with other options. [Bug 617816]

2002-10-01  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclProc.c (TclCreateProc): mask out VAR_UNDEFINED for
	precompiled locals to support 8.3 precompiled code.
	(Tcl_ProcObjCmd): correct 2002-09-26 fix to look for tclProcBodyType.

2002-10-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/socket.n: Mentioned that ports may be specified as serivce
	names as well as integers. [Bug 616843]

2002-09-30  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclCompCmds.c (TclCompileRegexpCmd): correct the
	checking for bad re's that didn't terminate the re string.
	Resultant compiles were correct, but much slower than necessary.

2002-09-29  David Gravereaux <davygrvy@@pobox.com>

	* win/tclAppInit.c: Added proper exiting conditions using Win32
	console signals.  This handles the existing lack of a Ctrl+C exit
	to call exit handlers when built for thread support.  Also, properly
	handles exits from other conditions such as CTRL_CLOSE_EVENT,
	CTRL_LOGOFF_EVENT, and CTRL_SHUTDOWN_EVENT signals.  In all cases,
	exit handlers will be called.  [Bug 219355]

	* win/makefile.vc: Added missing tclThreadAlloc.c to the build
	rules and defines USE_THREAD_ALLOC when TCL_THREADS is defined
	to get the new behavior by default.

2002-09-27  Don Porter  <dgp@@users.sourceforge.net>

	* README:		Bumped to version 8.4.1 to avoid confusion
	* generic/tcl.h:	of CVS snapshots with the actual 8.4.0
	* tools/tcl.wse.in:	release.
	* unix/configure.in:
	* unix/tcl.spec:
	* win/configure.in:

	* unix/configure:	autoconf
	* win/configure:

2002-09-26  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure: regen.
	* unix/tcl.m4: improve AIX-4/5 64bit compilation support.

	* generic/tclProc.c (Tcl_ProcObjCmd): correct overeager
	optimization of noop proc to handle the precompiled case. (sofer)

	* unix/ldAix (nmopts): add -X32_64 to make it work for 32 or 64bit
	mode compilation.

	* library/encoding/koi8-u.enc: removed extraneous spaces that
	confused encoding reader. [Bug #615115]

	* unix/Makefile.in: generate source dists with -src designator and
	do not generate .Z anymore (just .gz and .zip).

2002-09-18  Mumit Khan <khan@@nanotech.wisc.edu>

	Added basic Cygwin support.

	* win/tcl.m4 (SC_PATH_TCLCONFIG): Support one-tree build.
	(SC_PATH_TKCONFIG): Likewise.
	(SC_PROG_TCLSH): Likewise.
	(SC_CONFIG_CFLAGS): Assume real Cygwin port and remove -mno-cygwin 
	flags.  Add -mwin32 to extra_cflags and extra_ldflags.
	Remove ``-e _WinMain@@16'' from LDFLAGS_WINDOW.
	* win/configure.in: Allow Cygwin build.
	(SEH test): Define to be 1 instead of empty value.
	(EXCEPTION_DISPOSITION): Add test.
	* win/configure: Regenerate.

	* generic/tcl.h: Don't explicitly define __WIN32__ for Cygwin, let
	the user decide whether to use Windows or POSIX personality.
	(TCL_WIDE_INT_TYPE, TCL_LL_MODIFIER, struct Tcl_StatBuf): Define
	for Cygwin.
	* generic/tclEnv.c (Tcl_CygwinPutenv): putenv replacement for
	Cygwin.
	* generic/tclFileName.c (Tcl_TranslateFileName): Convert POSIX 
	to native format.
	(TclDoGlob): Likewise.
	* generic/tclPlatDecls.h (TCHAR): Define for Cygwin.
	* win/tclWinPort.h (putenv, TclpSysAlloc, TclpSysFree, 
	TclpSysRealloc): Define for Cygwin.

2002-09-26  Daniel Steffen  <das@@users.sourceforge.net>

	* macosx/Makefile: preserve environment value of INSTALL_ROOT.
	When embedding only use deployment build. Force relink before
	embedded build to ensure new linker flags are picked up.

	* macosx/Tcl.pbproj/project.pbxproj: add symbolic links to
	debug lib, stub libs and tclConfig.sh in framework toplevel.
	Configure target dependency fix. Fix to 'clean' action. Added
	private tcl headers to framework. Install tclsh symbolic link.
	Html doc build works when no installed tclsh available. Made
	html doc structure in framework more like in Apple frameworks.

2002-09-24  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tcl.m4 (SC_TCL_64BIT_FLAGS): Yet more robust 64-bit value
	detection to close [Bug 613117] on more systems.

	* generic/tclCompile.c (TclPrintSource): More CONSTifying.
	* generic/tclExecute.c (EvalStatsCmd): Object-ify to reduce
	warnings.  Thanks to 'CoderX2' on the chat for bringing this to my
	attention...

	* unix/tcl.m4: Forgot to define TCL_WIDE_INT_IS_LONG at the
	appropriate moment.  I believe this is the cause of [Bug 613117]

	* doc/lset.n: Changed 'list' to 'varName' for consistency with
	lappend documentation.  Thanks to Glenn Jackman [Bug 611719]

2002-09-22  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:  Corrected [puts -nonewline] within
	test bodies.  Thanks to Harald Kirsch.  [Bug 612786, Patch 612788]
	Also corrected reporting of body return code.  Thanks to David
	Taback [Bug 611922]
	* library/tcltest/pkgIndex.tcl: Bump to version 2.2.1.
	* tests/tcltest.test: added tests for these bugs.

2002-09-15  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Add PEEK_XCLOSEIM
	define under Linux. This is used by Tk to double
	check that an X input context is cleaned up
	before it is closed.

2002-09-12  David Gravereaux <davygrvy@@pobox.com>

	* win/coffbase.txt: Added BLT to the virtual base address
	listings table should BLT's build tools decide to use it.

2002-09-12  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tcl.h:
	* mac/tclMacApplication.r:
	* mac/tclMacLibrary.r:
	* mac/tclMacResource.r: unified use of the two equivalent 
	resource compiler header inclusion defines RC_INVOKED and
	RESOURCE_INCLUDED, now use RC_INVOKED throughout. 

2002-09-10  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/README: Add note about building extensions
	with the same compiler Tcl was built with.
	[Tk Bug 592096]

2002-09-10  Daniel Steffen  <das@@users.sourceforge.net>

	* macosx/Tcl.pbproj/project.pbxproj: disabled building html
	documentation during embedded build.

2002-09-10  Daniel Steffen  <das@@users.sourceforge.net>

	* unix/Makefile.in: added DYLIB_INSTALL_DIR variable for macosx
	and set it to default value ${LIB_RUNTIME_DIR}
	* unix/tcl.m4 (Darwin): use DYLIB_INSTALL_DIR instead of
	LIB_RUNTIME_DIR in the -install_name argument to ld.
	* unix/configure: regen.

	* macosx/Tcl.pbproj/project.pbxproj:
	* macosx/Makefile: added support for building Tcl as an embedded
	framework, i.e. using an dyld install_name containing
	@@executable_path/../Frameworks via the new DYLIB_INSTALL_DIR
	unix/Makefile variable.
	
2002-09-10  Jeff Hobbs  <jeffh@@ActiveState.com>

	*** 8.4.0 TAGGED FOR RELEASE ***

2002-09-06  Don Porter  <dgp@@users.sourceforge.net>

	* doc/file.n:  Format correction, and clarified [file normalize]
	returns an absolute path.

	* doc/tcltest.n:  Added examples section, as long promised.

2002-09-06  Reinhard Max  <max@@suse.de>

	* tests/tcltest.test: Added nonRoot flag to tests 8.3, 8.4, and 8.12.

2002-09-05  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n:  Clarified phrasing.

	* generic/tclBasic.c (TclRenameCommand,CallCommandTraces):
	* tests/trace.test (trace-27.1): Corrected memory leak when a rename
	trace deleted the command being traced.  Test added.  Thanks to
	Hemang Lavana for the fix.  [Bug 604609]

	* generic/tclVar.c (TclDeleteVars):  Corrected logic for setting the
	TCL_INTERP_DESTROYED flag when calling variable traces. [Tk Bug 605121]

2002-09-04  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclVar.c (DeleteArray): leak plug [Bug 604239]. Thanks
	to dkf and dgp for the long and difficult discussion in the chat.

2002-09-03  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclVar.c (Tcl_UpVar2): code cleanup to not use goto

	* unix/configure: remove -pthread from LIBS on FreeBSD in thread
	* unix/tcl.m4:    enabled build. [Bug #602849]

2002-09-03  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInterp.c (AliasCreate): a Tcl_Obj was leaked on error
	return from TclPreventAliasLoop.
	
2002-09-03  Daniel Steffen  <das@@users.sourceforge.net>

	* macosx/Tcl.pbproj/project.pbxproj: Bumped version number to
	8.4.0 and updated copyright info.

2002-09-03  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclVar.c (Tcl_UpVar2): a Tcl_Obj was being leaked on
	error return from TclGetFrame.

2002-09-03  Don Porter  <dgp@@users.sourceforge.net>

	* changes:  Updated changes for 8.4.0 release.

2002-09-02  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/tclUnixFile.c (TclpObjLink): removed unnecessary/unfreed
	extra native char*.

	* unix/tclUnixChan.c (Tcl_MakeTcpClientChannel): make sure to init
	flags field of TcpState ptr to 0.

	* unix/configure:
	* unix/tcl.m4: added 64-bit gcc compilation support on HP-11.
	[Patch #601051] (martin)

	* README:		Bumped version number to 8.4.0
	* generic/tcl.h:
	* tools/tcl.wse.in:
	* unix/configure:
	* unix/configure.in:
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure:
	* win/configure.in:

	* generic/tclInterp.c (SlaveCreate): make sure that the memory and
	checkmem commands are initialized in non-safe slave interpreters
	when TCL_MEM_DEBUG is used. [Bug #583445]

	* win/tclWinConsole.c (ConsoleCloseProc): only wait on writable
	pipe if there was something to write.  This may prevent infinite
	wait on exit.

	* tests/exec.test: marked exec-18.1 unixOnly until the Windows
	incompatability (in the test, not the core) can be resolved.

	* tests/http.test (http-3.11): added close $fp that was causing an
	error on Windows because the file was not closed before deleting.

	* unix/tclUnixInit.c (Tcl_MacOSXGetLibraryPath): made this static
	function only appear when HAVE_CFBUNDLE is defined.

2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>

	* unix/tcl.m4: added TK_SHLIB_LD_EXTRAS analogue of existing
	TCL_SHLIB_LD_EXTRAS for linker settings only used when linking Tk.

	* unix/configure: regen

2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>

	*** macosx-8-4-branch merged into the mainline [tcl patch #602770] ***

	* generic/tcl.decls: added new macosx specific entry to stubs table.

	* tools/genStubs.tcl: added generation of platform guards for
	macosx. This is a little more complex than it seems, because MacOS
	X IS "unix" plus a little bit, for the purposes of Tcl. BUT
	unfortunately, Tk uses "unix" to mean X11. So added platform keys
	for macosx (the little added to "unix"), "aqua" and "x11" to
	distinguish these for Tk.
	
	* generic/tcl.h: added a #ifnded RESOURCE_INCLUDED so that tcl.h
	can be passed to the resource compiler.
	
	* generic/tcl.h:
	* generic/tclNotify.c: added a few Notifier procs, to be able to
	modify more bits of the Tcl notifier dynamically. Required to get
	Mac OS X Tk to live on top of the Tcl Unix threaded notifier.
	Changes the size of the Tcl_NotifierProcs structure, but doesn't
	move any elements around.

	* unix/tclUnixNotfy.c: moved the call to Tcl_ConditionNotify till
	AFTER we are done mucking with the pointer swap. Fixes cases where
	the thread waiting on the condition wakes & accesses the
	waitingListPtr before it gets reset, causing a hang.

	* library/auto.tcl (tcl_findLibrary): added checking the
	directories in the tcl_pkgPath for library files on macosx to
	enable support of the standard Mac OSX library locations

	* unix/Makefile.in:
	* unix/configure.in:
	* unix/tcl.m4: added MAC_OSX_DIR.  Added PLAT_OBJS to the OBJS:
	there are some MacOS X specific files now for Tcl, and when I get
	he resource & applescript stuff ported over, and restore support
	for FindFiles, etc, there will be a few more.
	Added LD_LIBRARY_PATH_VAR configure variable to avoid having to set
	all possible LD_LIBRARY_PATH analogues on all platforms.
	LD_LIBRARY_PATH_VAR is "LD_LIBRARY_PATH" by default, "LIBPATH" on
	AIX, "SHLIB_PATH" on HPUX and "DYLD_LIBRARY_PATH" on Mac OSX.
	Added configure option to package Tcl as a framework on Mac OSX.

	* macosx/tclMacOSXBundle.c (new): support for finding Tcl extension
	packaged as 'bundles' in the standard Mac OSX library locations.

	* unix/tclUnixInit.c: added support for findig the tcl script
	library inside Tcl packaged as a framework on Mac OSX.

	* macosx/Tcl.pbproj/jingham.pbxuser (new):
	* macosx/Tcl.pbproj/project.pbxproj (new): project for Apple's
	ProjectBuilder IDE.

	* macosx/Makefile (new): simple makefile for building the project
	from the command line via the ProjectBuilder tool 'pbxbuild'.

	* unix/configure:
	* generic/tclStubInit.c:
	* generic/tclPlatDecls.h: regen

2002-08-29  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* win/tclWinThrd.c (TclpFinalizeThreadData, TclWinFreeAllocCache):
	  Applied patch for bug #599428, provided by Miguel Sofer
	  <msofer@@users.sourceforge.net>.

2002-08-28  David Gravereaux <davygrvy@@pobox.com>

	* generic/tclEnv.c:
	* unix/configure.in:
	* win/tclWinPort.h:  putenv() on some systems copies the buffer
	rather than taking reference to it.  This causes memory leaks
	and is know to effect mswindows (msvcrt) and NetBSD 1.5.2 .  This
	patch tests for this behavior and turns on -DHAVE_PUTENV_THAT_COPIES=1
	when approriate.  Thanks to David Welton for assistance.
	[Bug 414910]

	* unix/configure: regen'd

2002-08-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/eval.n: Added mention of list command and corrected "SEE ALSO".

	* unix/configure.in: Cache handling of ac_cv_type_socklen_t was
	wrong. [Bug 600931] reported by John Ellson.  Fixed by putting the
	brackets where they belong.

2002-08-26  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompCmds.c: fix for [Bug 599788] (error in element
	name causing segfault), reported by Tom Wilkason. Fixed by copying
	the tokens instead of the source string.

2002-08-26  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclThreadAlloc.c: small optimisation, reducing the
	new allocator's overhead.
	
2002-08-23  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclObj.c (USE_THREAD_ALLOC): fixed leak [Bug 597936]. 
	Thanks to Zoran Vasiljevic.

2002-08-23  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclThreadAlloc.c (USE_THREAD_ALLOC): moving objects
	between caches as a block, instead of one-by-one.

2002-08-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c:
	* generic/tclCmdMZ.c: fix for freed memory r/w in delete traces
	[Bug 589863], patch by Hemang Lavana.

2002-08-20  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* win/Makefile.in (CFLAGS): 
	* unix/Makefile.in (MEM_DEBUG_FLAGS): Added usage of @@MEM_DEBUG_FLAGS@@.
	* win/configure.in:
	* unix/configure.in: Added usage of SC_ENABLE_MEMDEBUG.
	* win/tcl.m4:
	* unix/tcl.m4: Added macro SC_ENABLE_MEMDEBUG. Allows a user of
	  configure to (de)activate memory validation and debugging
	  (TCL_MEM_DEBUG). No need to modify the makefile anymore.

2002-08-20  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclCkalloc.c:	CONSTified MemoryCmd and CheckmemCmd.

	* README:		Bumped version number to 8.4b3 to distinguish
	* generic/tcl.h:	HEAD from the 8.4b2 release.
	* tools/tcl.wse.in:
	* unix/configure.in:
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure.in:

	* unix/configure:	autoconf
	* win/configure:

	* library/http/http.tcl:	Corrected installation directory of
	* library/msgcat/msgcat.tcl:	the package tcltest 2.2.  Added
	* library/opt/optparse.tcl:	comments in other packages to remind
	* library/tcltest/tcltest.tcl:	that installation directories need 
	* unix/Makefile.in:		updates to match increasing version
	* win/Makefile.in:		numbers. [Bug 597450]
	* win/makefile.bc:
	* win/makefile.vc:

2002-08-19  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* unix/tclUnixTest.c (TestfilehandlerCmd): Changed
	  readable/writable to the more common readable|writable.

	  Fixes SF #596034 reported by Larry Virden
	  <lvirden@@users.sourceforge.net>.

2002-08-16  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/fCmd.test: Added test to make sure that the cause of the
	problem is detectable with an unpatched Tcl.
	* doc/ObjectType.3: Added note on the root cause of this problem
	to the documentation, since it is possible for user code to
	trigger this sort of behaviour too.
	* generic/tclIOUtil.c (SetFsPathFromAny): Objects should only have
	their old representation deleted when we know that we are about to
	install a new one.  This stops a weird TclX bug under Linux with
	certain kinds of memory debugging enabled which essentally came
	down to a double-free of a string.

2002-08-14  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInt.h:
	* generic/tclObj.c: (code cleanup) factored the parts in the macros 
	TclNewObj() / TclDecrRefCount() into a common part for all
	memory allocators and two new macros TclAllocObjStorage() /
	TclFreeObjStorage() that are specific to each allocator and fully
	describe the differences. Removed allocator-specific code from
	tclObj.c by using the macros.
	
2002-08-12  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCmdMZ.c: fixing UMR in delete traces, [Bug 589863].
	
2002-08-08  David Gravereaux <davygrvy@@pobox.com>

	* tools/man2help.tcl: Fixed $argv handling bug where if -bitmap
	wasn't specified $argc was off by one.

2002-08-08  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/uplevel.test: added 6.1 to test [uplevel] with shadowed
	commands [Bug 524383]

	* tests/subst.test: added 5.8-10 as further tests for [Bug 495207] 

2002-08-08  Don Porter  <dgp@@users.sourceforge.net>

	* tests/README: Noted removal of defs.tcl.

2002-08-08  Jeff Hobbs  <jeffh@@ActiveState.com>

	* doc/lsearch.n: corrected lsearch docs to use -inline in examples.

	*** 8.4b2 TAGGED FOR RELEASE ***

	* tests/fCmd.test:
	* tests/unixFCmd.test: updated tests for new link copy behavior.
	* generic/tclFCmd.c (CopyRenameOneFile): changed the behavior to
	follow links to endpoints and copy that file/directory instead of
	just copying the surface link.  This means that trying to copy a
	link that has no endpoint (danling link) is an error.
	[Patch #591647] (darley)
	(CopyRenameOneFile): this is currently disabled by default until
	further issues with such behavior (like relative links) can be
	handled correctly.

	* tests/README: slight wording improvements

2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>

	* docs/BoolObj.3: added description of valid string reps for a
	boolean object [Bug 584794]
	* generic/tclObj.c: optimised Tcl_GetBooleanFromObj and
	SetBooleanFromAny to avoid parsing the string rep when it can be
	avoided [Bugs 584650, 472576]
	
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.h:
	* generic/tclObj.c: making tclCmdNameType static ([Bug 584567],
	Don Porter).
	
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclObj.c (Tcl_NewObj): added conditional code for
	USE_THREAD_ALLOC; objects allocated through Tcl_NewObj() were
	otherwise being leaked. [Bug 587488] reported by Sven Sass.
	
2002-08-06  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclInt.decls:
	* unix/tclUnixThrd.c: Added stubs and implementations for
	non-threaded build for the tclUnixThrd.c procs TclpReaddir,
	TclpLocaltime, TclpGmtime and TclpInetNtoa.
	Fixes link errors in stubbed & threaded extensions that include
	tclUnixPort.h and use any of the procs readdir, localtime, 
	gmtime or inet_ntoa (e.g. TclX 8.4) [Bug 589526]
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c: Regen.

2002-08-05  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:	The setup and cleanup scripts are now
	* library/tcltest/pkgIndex.tcl:	skipped when a test is skipped, fixing
	* tests/tcltest.test:		[Bug 589859].  Test for bug added, and
	corrected tcltest package bumped to version 2.2.

	* generic/tcl.decls:	Restored Tcl_Concat to return (char *).  Like
	* generic/tclDecls.h:	Tcl_Merge, it transfers ownership of a dynamic
	* generic/tclUtil.c:	allocated string to the caller.

2002-08-04  Don Porter  <dgp@@users.sourceforge.net>

	* doc/CmdCmplt.3:	Applied Patch 585105 to fully CONST-ify
	* doc/Concat.3:		all remaining public interfaces of Tcl.
	* doc/CrtCommand.3:	Notably, the parser no longer writes on 
	* doc/CrtSlave.3:	the string it is parsing, so it is no
	* doc/CrtTrace.3:	longer necessary for Tcl_Eval() to be
	* doc/Eval.3:		given a writable string.  Also, the
	* doc/ExprLong.3:	refactoring of the Tcl_*Var* routines
	* doc/LinkVar.3:	by Miguel Sofer is included, so that the
	* doc/ParseCmd.3:	"part1" argument for them no longer needs
	* doc/SetVar.3:		to be writable either.
	* doc/TraceVar.3:
	* doc/UpVar.3:		Compatibility support has been enhanced so
	* generic/tcl.decls	that a #define of USE_NON_CONST will remove
	* generic/tcl.h		all possible source incompatibilities with
	* generic/tclBasic.c	the 8.3 version of the header file(s).
	* generic/tclCmdMZ.c	The new #define of USE_COMPAT_CONST now does
	* generic/tclCompCmds.c	what USE_NON_CONST used to do -- disable
	* generic/tclCompExpr.c only those new CONST's that introduce
	* generic/tclCompile.c	irreconcilable incompatibilities.
	* generic/tclCompile.h
	* generic/tclDecls.h	Several bugs are also fixed by this patch.
	* generic/tclEnv.c	[Bugs 584051,580433] [Patches 585105,582429]
	* generic/tclEvent.c	
	* generic/tclInt.decls
	* generic/tclInt.h
	* generic/tclIntDecls.h
	* generic/tclInterp.c
	* generic/tclLink.c
	* generic/tclObj.c
	* generic/tclParse.c
	* generic/tclParseExpr.c
	* generic/tclProc.c
	* generic/tclTest.c
	* generic/tclUtf.c
	* generic/tclUtil.c
	* generic/tclVar.c
	* mac/tclMacTest.c
	* tests/expr-old.test
	* tests/parseExpr.test
	* unix/tclUnixTest.c
	* unix/tclXtTest.c
	* win/tclWinTest.c

2002-08-01  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: bugfix (reading freed memory). Testsuite
	passed on linux/i386, compile-13.1 hung on linux/alpha.

2002-08-01  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: added a reference count for the complete
	execution stack, instead of Tcl_Preserve/Tcl_Release. 

2002-08-01  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tclCkalloc.c (TclFinalizeMemorySubsystem):
	Don't lock the ckalloc mutex before invoking the
	Tcl_DumpActiveMemory function since it also
	locks the same mutex. This code is only executed
	when "memory onexit filename" has been executed
	and Tcl is compiled with -DTCL_MEM_DEBUG.

2002-08-01  Reinhard Max  <max@@suse.de>

	* win/tclWinPort.h: The windows headers don't provide socklen_t,
	so we have to do it.

2002-07-31  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInt.h (USE_THREAD_ALLOC): for unshared objects,
	TclDecrRefCount now frees the internal rep before the string rep -
	just like the non-macro Tcl_DecrRefCount/TclFreeObj [Bug 524802]. 
	For the other allocators the fix was done on 2002-03-06.

2002-07-31  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInterp.c: signed/unsigned comparison warning fixed
	(Vince Darley).

2002-07-31  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tcl.m4 (SC_BUGGY_STRTOD): Enabled caching of test results.

	* unix/tcl.m4 (SC_BUGGY_STRTOD): Solaris 2.8 still has a buggy
	strtod() implementation; make sure we detect it.

	* tests/expr.test (expr-22.*): Marked as non-portable because it
	seems that these tests have an annoying tendency to fail in
	unexpected ways.  [Bugs 584825, 584950, 585986]

2002-07-30  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tests/io.test: 
	* generic/tclIO.c (WriteChars): Added flag to break out of loop if
	  nothing of the input is consumed at all, to prevent infinite
	  looping of called with a non-UTF-8 string. Fixes Bug 584603
	  (partially). Added new test "io-60.1". Might need additional
	  changes to Tcl_Main so that unprintable results are printed as
	  binary data.

2002-07-29  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Use CC_SEARCH_FLAGS instead of
	LD_SEARCH_FLAGS when linking with ${CC}.
	* unix/configure: Regen.
	* unix/configure.in: Don't subst CC_SEARCH_FLAGS or
	LD_SEARCH_FLAGS since this is now done in tcl.m4.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Document and
	set CC_SEARCH_FLAGS whenever LD_SEARCH_FLAGS is set.
	[Tcl patch 588290]

2002-07-29  Reinhard Max  <max@@suse.de>

	* unix/tcl.m4 (SC_SERIAL_PORT): Fixed detection for cases when
                                        configure's stdin is not a tty.
	
	* unix/tclUnixPort.h: 
	* generic/tclIOSock.c:          Changed size_t to socklen_t in
                                        socket-related function calls.

	* unix/configure.in:            Added test and fallback definition
                                        for socklen_t.
	
	* unix/configure:               generated.

2002-07-29  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclObj.c: fixed a comment

	* generic/tcl.h: 
	* generic/tclBasic.c: 
	* generic/tclInterp.c: added the new flag TCL_EVAL_INVOKE to
	the interface of the Tcl_Eval* functions, removing the
	TCL_EVAL_NO_TRACEBACK added yesterday: alias invocations not only 
	require no tracebacks, but also look up the command name in the
	global scope - see new test interp-9.4
	* tests/interp.test: added 9.3 to test for safety of aliases to
	hidden commands, 9.4 to test for correct command lookup scope.

2002-07-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/regc_locale.c (cclass): [[:xdigit:]] is only a defined
	concept on western characters, so should not allow any unicode
	digit, and hence number of ranges in [[:xdigit:]] is fixed.
	* tests/reg.test: Added test to detect the bug.
	* generic/regc_cvec.c (newcvec): Corrected initial size value in
	character vector structure.  [Bug 578363]  Many thanks to
	pvgoran@@users.sf.net for tracking this down.

2002-07-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tcl.h: 
	* generic/tclBasic.c: added the new flag TCL_EVAL_NO_TRACEBACK to
	the interface of the Tcl_Eval* functions. Modified the error
	message for too many nested evaluations.
	* generic/tclInterp.h: changed the Alias struct to be of variable
	length and store the prefix arguments directly (instead of a
	pointer to a Tcl_Obj list). Made AliasObjCmd call Tcl_EvalObjv
	instead of TclObjInvoke - thus making aliases trigger execution
	traces [Bug 582522].
	* tests/interp.test:
	* tests/stack.test: adapted to the new error message.
	* tests/trace.test: added tests for aliases firing the exec
	traces. 

2002-07-27  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Revert fix for Tcl bug 529801
	since it was incorrect and broke the build on
	other systems. Fix Tcl bug 587299.
	Add MAJOR_VERSION, MINOR_VERSION, PATCH_LEVEL,
	SHLIB_LD_FLAGS, SHLIB_LD_LIBS, CC_SEARCH_FLAGS,
	LD_SEARCH_FLAGS, and LIB_FILE variables to support
	more generic library build/install rules.
	* unix/configure: Regen.
	* unix/configure.in: Move AC_PROG_RANLIB into
	tcl.m4. Move shared build test and setting
	of MAKE_LIB and MAKE_STUB_LIB into tcl.m4.
	Move subst of a number of variables into
	tcl.m4 where they are defined.
	* unix/tcl.m4 (SC_ENABLE_SYMBOLS, SC_CONFIG_CFLAGS):
	Subst vars where they are defined. Add MAKE_LIB,
	MAKE_STUB_LIB, INSTALL_LIB, and INSTALL_STUB_LIB
	rules to deal with the ugly details of running
	ranlib on static libs at build and install time.
	Replace TCL_SHLIB_LD_EXTRAS with SHLIB_LD_FLAGS
	and use it when building a shared library.
	* unix/tclConfig.sh.in: Add TCL_CC_SEARCH_FLAGS.

2002-07-26  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: fixed Tcl_Obj leak in code corresponding
	to the macro NEXT_INST_V(x, 0, 1) [Bug 587495].
	
2002-07-26  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclVar.c (TclObjLookupVar): leak fix and improved
	comments. 

2002-07-26  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclVar.c (TclLookupVar): removed early returns that
	prevented the parens from being restored. also removed goto label
	as it was not necessary.

2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: 
	* tests/expr-old.test: fix for erroneous error messages in [expr],
	[Bug  587140] reported by Martin Lemburg.

2002-07-25  Joe English  <jenglish@@users.sourceforge.net>
	* generic/tclProc.c: fix for Tk Bug #219218 "error handling 
	with bgerror in Tk"

2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: restoring full TCL_COMPILE_DEBUG
	functionality.

2002-07-24  Don Porter  <dgp@@users.sourceforge.net>

	* tests/unixInit.test: relaxed unixInit-3.1 to accept iso8859-15
	as a valid C encoding.  [Bug 575336]

2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: restoring the tcl_traceCompile
	functionality while I repair tcl_traceExec. The core now compiles
	and runs also under TCL_COMPILE_DEBUG, but execution in the
	bytecode engine can still not be traced.

2002-07-24  Daniel Steffen  <das@@users.sourceforge.net>

	* unix/Makefile.in:
	* unix/configure.in: corrected fix for [Bug 529801]: ranlib
	only needed for static builds on Mac OS X.
	* unix/configure: Regen.
	* unix/tclLoadDyld.c: fixed small bugs introduced by Vince,
	implemented library unloading correctly (needs OS X 10.2).

2002-07-23  Joe English  <jenglish@@users.sourceforge.net>

	* doc/OpenFileChnl.3: (Updates from Larry Virden)
	* doc/open.n:
	* doc/tclsh.1: Fix section numbers in Unix man page references.
	* doc/lset.n:  In EXAMPLES section, include command to set the 
	initial value used in subsequent examples.
	* doc/http.n: Package version updated to 2.4.

2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Enable 64 bit compilation
	when using the native compiler on a 64 bit version of IRIX.
	[Tcl bug 219220]

2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Combine ranlib tests and
	avoid printing unless ranlib is actually run.

2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tcl.m4 (SC_PATH_X): Set XINCLUDES to "" instead
	of "# no special path needed" or "# no include files found"
	when x headers cannot be located.

2002-07-22  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclIOUtil.c: made tclNativeFilesystem static
	(since 07-19 changes removed its usage elsewhere), and
	added comments about its usage.
	* generic/tclLoad.c:
	* generic/tcl.h:
	* generic/tcl.decls: 
	* doc/FileSystem.3: converted last load-related ClientData
	parameter to Tcl_LoadHandle opaque structure, removing a 
	couple of casts in the process.
	
	* generic/tclInt.h: removed tclNativeFilesystem declaration
	since it is now static again.
	
2002-07-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/expr.test (expr-22.*): Added tests to help detect the
	corrected handling.
	* generic/tclExecute.c (IllegalExprOperandType): Improved error
	message generated when attempting to manipulate Inf and NaN values.
	* generic/tclParseExpr.c (GetLexeme): Allowed parser to recognise
	'Inf' as a floating-point number. [Bug 218000]

2002-07-21  Don Porter  <dgp@@users.sourceforge.net>

	* tclIOUtil.c: Silence compiler warning. [Bug 584408].

2002-07-19  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclIOUtil.c: fix to GetFilesystemRecord
	* win/tclWinFile.c:
	* unix/tclUnixFile.c: fix to subtle problem with links shown
	up by latest tclkit builds.

2002-07-19  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure:
	* unix/configure.in:
	* win/configure:
	* win/configure.in: Add AC_PREREQ(2.13) in an attempt
	to make it more clear that the configure scripts
	must be generated with autoconf version 2.13.
	[Bug 583573]

2002-07-19  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* unix/Makefile.in: fix to build on MacOS X [Bug 529801], bug
	report and fix from jcw.

2002-07-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* win/tclWinSerial.c (no_timeout): Made this variable static.

	* generic/tclExecute.c, generic/tclCompile.c, generic/tclBasic.c: 
	* generic/tclCompile.h (builtinFuncTable, instructionTable): Added
	prefix to these symbols because they are visible outside the Tcl
	library.

	* generic/tclCompExpr.c (operatorTable): 
	* unix/tclUnixTime.c (tmKey):
	* generic/tclIOUtil.c (theFilesystemEpoch, filesystemWantToModify,
	filesystemIteratorsInProgress, filesystemOkToModify): Made these
	variables static.

	* unix/tclUnixFile.c:		Renamed nativeFilesystem to
	* win/tclWinFile.c:		tclNativeFilesystem and declared
	* generic/tclIOUtil.c:		it properly in tclInt.h
	* generic/tclInt.h: 

	* generic/tclUtf.c (totalBytes): Made this array static and const.

	* generic/tclParse.c (typeTable): Made this array static and const.
	(Tcl_ParseBraces): Simplified error handling case so that scans
	are only performed when needed, and flags are simpler too.

	* license.terms: Added AS to list of copyright holders; it's only
	fair for the current gatekeepers to be listed here!

	* tests/cmdMZ.test: Renamed constraint for clarity. [Bug#583427]
	Added tests for the [time] command, which was previously only
	indirectly tested!

2002-07-18  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclInt.h:
	* generic/tcl.h:
	* */*Load*.c: added comments on changes of 07/17 and 
	replaced clientData with Tcl_LoadHandle in all locations.

	* generic/tclFCmd.c:
	* tests/fileSystem.test: fixed a 'knownBug' with 'file
	attributes ""'
	* tests/winFCmd.test: 
	* tests/winPipe.test:
	* tests/fCmd.test:
	* tessts/winFile.test: added 'pcOnly' constraint to some
	tests to make for more useful 'tests skipped' log from 
	running all tests on non-Windows platforms.
	
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (CallCommandTraces): delete traces now
	receive the FQ old name of the command. 
	[Bug 582532] (Don Porter)

2002-07-18  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* tests/ioUtil.test: added constraints to 1.4,2.4 so they
	don't run outside of tcltest. [Bugs 583276,583277]
	
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclVar.c (DupParsedVarName): nasty bug fixed, reported
	by Vince Darley.

2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclVar.c (TclPtrIncrVar): missing CONST in declarations,
	inconsistent with tclInt.h. Thanks to Vince Darley for reporting,
	boo to gcc for not complaining.
	
2002-07-17  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclInt.h:
	* generic/tclIOUtil.c:
	* generic/tclLoadNone.c:
	* unix/tclLoadAout.c:
	* unix/tclLoadDl.c:
	* unix/tclLoadDld.c:
	* unix/tclLoadDyld.c:
	* unix/tclLoadNext.c:
	* unix/tclLoadOSF.c:
	* unix/tclLoadShl.c:
	* mac/tclMacLoad.c:
	* win/tclWinLoad.c: modified to move more functionality
	to the generic code and avoid duplication.  Partial replacement
	of internal uses of clientData with opaque Tcl_LoadHandle.  A
	little further work still needed, but significant changes are done.

2002-07-17  D. Richard Hipp    <drh@@hwaci.com>

	* library/msgcat/msgcat.tcl: fix a comment that was causing
	problems for programs (ex: mktclapp) that embed the initialization
	scripts in strings.

2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c: removing the now redundant functions to access
	indexed variables: Tcl(Get|Set|Incr)IndexedScalar() and
	Tcl(Get|Set|Incr)ElementOfIndexedArray(). 

2002-07-17  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclExecute.c (TclExecuteByteCode): Minor fixes to make
	this file compile with SunPro CC...

2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: modified to do variable lookup explicitly,
	and then either inlining the variable access or else calling the new
	TclPtr(Set|Get|Incr)Var functions in tclVar.c
	* generic/tclInt.h: declare some functions previously local to
	tclVar.c for usage by TEBC.
	* generic/tclVar.c: removed local declarations; moved all special
	accessor functions for indexed variables to the end of the file -
	they are unused and ready for removal, but left there for the time
	being as they are in the internal stubs table.

	** WARNING FOR BYTECODE MAINTAINERS **
	TCL_COMPILE_DEBUG is currently not functional; will be fixed ASAP.
	
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in:
	* win/Makefile.in: Add a more descriptive warning
	in the event `make genstubs` needs to be rerun.

2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Use dltest.marker file
	to keep track of when the dltest package
	is up to date. This fixes [Tcl bug 575768]
	since tcltest is no longer linked every time.
	* unix/dltest/Makefile.in: Create ../dltest.marker
	after a successful `make all` run in dltest.

2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/configure.in: Remove useless subst of TCL_BIN_DIR.

2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclVar.c: inaccurate comment fixed
	
2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_AddObjErrorInfo):
	* generic/tclExecute.c (TclUpdateReturnInfo):
	* generic/tclInt.h:	
	* generic/tclProc.c: 
	Added two Tcl_Obj to the ExecEnv structure to hold the fully
	qualified names "::errorInfo" and "::errorCode" to cache the
	addresses of the corresponding variables. The two most frequent
	setters of these variables now profit from the new variable name
	caching. 

2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclVar.c: refactorisation to reuse already looked-up Var
	pointers; definition of three new Tcl_Obj types to cache variable
	name parsing and lookup for later reuse; modification of internal
	functions to profit from the caching. 
	
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclNamesp.c: adding CONST qualifiers to variable names
	passed to Tcl_FindNamespaceVar and to variable resolvers; adding
	CONST qualifier to the 'msg' argument to TclLookupVar. Needed to
	avoid code duplication in the new tclVar.c code.

	* tests/set-old.test:
	* tests/var.test: slight modification of error messages due to the
	modifications in the tclVar.c code.

2002-07-15  Don Porter  <dgp@@users.sourceforge.net>

	* tests/unixInit.test:	Improved constraints to protect /tmp.	
	  [Bug 581403]

2002-07-15  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* tests/winFCmd.test: renamed 'win2000' and 'notWin2000' to
	more appropriate constraint names.
	* win/tclWinFile.c: updated comments to reflect 07-11 changes.
	* win/tclWinFCmd.c: made ConvertFileNameFormat static again,
	since no longer used in tclWinFile.c
	* mac/tclMacFile.c: completed TclpObjLink implementation which
	was previously lacking.
	* generic/tclIOUtil.c: comment cleanup and code speedup.
	
2002-07-14  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclInt.h:	Removed declarations that duplicated entries
	  in the (internal) stub table.
	
	* library/tcltest/tcltest.tcl:  Corrected errors in handling of
	  configuration options -constraints and -limitconstraints.

	* README:		Bumped HEAD to version 8.4b2 so we can
	* generic/tcl.h:	distinguish it from the 8.4b1 release.
	* tools/tcl.wse.in:
	* unix/configure*:
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure*:

2002-07-11  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* doc/file.n:
	* win/tclWinFile.c: on Win 95/98/ME the long form of the path
	is used as a normalized form.  This is required because short
	forms are not a robust representation.  The file normalization
	function has been sped up, but more performance gains might be
	possible, if speed is still an issue on these platforms.

2002-07-11  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl: Corrected reaction to existing but
	false ::tcl_interactive.

	* doc/Hash.3: Overlooked CONST documentation update.

2002-07-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclCkalloc.c: ckalloc() and friends take the block size
	as an unsigned, so we should use %ud when reporting it in fprintf()
	and panic().

2002-07-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.c: now setting local vars undefined at
	compile time, instead of waiting until the proc is initialized. 
	* generic/tclProc.c: use macro TclSetVarUndefined instead of
	directly etting the flag.

2002-07-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/cmdAH.test: [file attr -perm] is Unix-only, so add [catch]
	when not inside a suitably-protected test.

2002-07-10  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/unixFCmd.test, tests/fileName.test: 
	* tests/fCmd.test: Removed [exec] of Unix utilities that have
	equivalents in standard Tcl.  [Bug 579268]  Also simplified some
	of unixFCmd.test while I was at it.

2002-07-10  Don Porter  <dgp@@users.sourceforge.net>

	* tests/tcltest.test:  Greatly reduced the number of [exec]s, using
	slave interps instead.
	* library/tcltest/tcltest.tcl:  Fixed bug uncovered in the conversion
	where a message was written to stdout instead of [outputChannel].

	* tests/basic.test:	Cleaned up, constrained, and reduced the
	* tests/compile.test:	amount of [exec] usage in the test suite.
	* tests/encoding.test:
	* tests/env.test:
	* tests/event.test:
	* tests/exec.test:
	* tests/io.test:
	* tests/ioCmd.test:
	* tests/regexp.test:
	* tests/regexpComp.test:
	* tests/socket.test:
	* tests/tcltest.test:
	* tests/unixInit.test:
	* tests/winDde.test:
	* tests/winPipe.test:

2002-07-10  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/cmdAH.test: Removed [exec] of Unix utilities. [Bug 579211]

	* tests/expr.test: Added tests to make sure that this works.
	* generic/tclExecute.c (ExprCallMathFunc): Functions should also
	be able to return wide-ints.  [Bug 579284]

2002-07-08  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tests/socket.test: Fixed bug #578164. The original reason for
	  the was a DNS outage while running the testsuite. Changed [info
	  hostname] to 127.0.0.1 to bypass DNS, knowing that we operate on
	  the local host.

2002-07-08  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n:		Fixed incompatibility in [viewFile].
	* library/tcltest/tcltest.tcl:	Corrected docs.  Bumped to 2.2.1.
	* library/tcltest/pkgIndex.tcl: [Bug 578163]

2002-07-08  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* tests/cmdAH.test:
	* tests/fCmd.test:
	* tests/fileName.test: tests which rely on 'file link' need a
	constraint so they don't run on older Windows OS. [Bug 578158]
	* generic/tclIOUtil.c:
	* generic/tcl.h:
	* generic/tclInt.h:
	* generic/tclTest.c:
	* mac/tclMacChan.c:
	* unix/tclUnixChan.c:
	* win/tclWinChan.c:
	* doc/FileSystem.3: cleaned up internal handling of
	Tcl_FSOpenFileChannel to remove duplicate code, and make
	writing external vfs's clearer and easier.  No
	functionality change.  Also clarify that objects with refCount
	zero should not be passed in to the Tcl_FS API, and prevent
	segfaults from occuring on such user errors. [Bug 578617]
	
2002-07-06  Don Porter  <dgp@@users.sourceforge.net>

	* tests/pkgMkIndex.test:  Constrained tests of [load] package indexing
	to those platforms where the testing shared libraries have been built.
	[Bug 578166].

2002-07-05  Don Porter  <dgp@@users.sourceforge.net>
	* changes: added recent changes

2002-07-05  Reinhard Max  <max@@suse.de>

	* generic/tclClock.c (FormatClock): Convert the format string to
	UTF8 before calling TclpStrftime, so that non-ASCII characters
	don't get mangled when the result string is being converted back.
	* tests/clock.test: Added a test for that.

2002-07-05  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/Makefile.in (ro-test,ddd,GDB,DDD): Created new targets to
	allow running the test suite with a read-only current directory,
	running under ddd instead of gdb, and factored out some executable
	names for broken sites (like mine) where gdb and ddd are installed
	with non-standard names...

	* tests/httpold.test: Altered test names to httpold-* to avoid
	clashes with http.test, and stopped tests from failing when the
	current directory is not writable...

	* tests/event.test:		Stop these tests from failing
	* tests/ioUtil.test:		when the current directory is
	* tests/regexp.test:		not writable...
	* tests/regexpComp.test: 
	* tests/source.test: 
	* tests/unixFile.test: 
	* tests/unixNotfy.test: 

	* tests/unixFCmd.test:		Trying to make these test-files
	* tests/macFCmd.test:		not bomb out with an error when
	* tests/http.test:		the current directory is not
	* tests/fileName.test:		writable...
	* tests/env.test:

2002-07-05  Jeff Hobbs  <jeffh@@ActiveState.com>

	*** 8.4b1 TAGGED FOR RELEASE ***

2002-07-04  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/cmdMZ.test (cmdMZ-1.4): 
	* tests/cmdAH.test: More fixing of writable-current-dir
	assumption. [Bug 575824]

2002-07-04  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/basic.test: Same issue as below; fixed [Bug 575817]
	
2002-07-04  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tests/socket.test: 
	* tests/winPipe.test: 
	* tests/pid.test: Fixed SF Bug #575848. See below for a
	  description the general problem.

	* All the bugs below are instances of the same problem: The
	  testsuite assumes [pwd] = [temporaryDirectory] and writable.

	* tests/iogt.test: Fixed bug #575860.
	* tests/io.test:   Fixed bug #575862.
	* tests/exec.test: 
	* tests/ioCmd.test: Fixed bug #575836.

2002-07-03  Don Porter  <dgp@@users.sourceforge.net>

	* tests/pkg1/direct1.tcl: removed
	* tests/pkg1/pkgIndex.tcl: removed
	* tests/pkgMkIndex.test:  Imported auxilliary files from tests/pkg1
	  into the test file pkgMkIndex.test itself.  Formatting fixes.

	* unix/Makefile.in: removed tests/pkg/* from `make dist`

	* tests/pkg/circ1.tcl: removed
	* tests/pkg/circ2.tcl: removed
	* tests/pkg/circ3.tcl: removed
	* tests/pkg/global.tcl: removed
	* tests/pkg/import.tcl: removed
	* tests/pkg/pkg1.tcl: removed
	* tests/pkg/pkg2_a.tcl: removed
	* tests/pkg/pkg2_b.tcl: removed
	* tests/pkg/pkg3.tcl: removed
	* tests/pkg/pkg4.tcl: removed
	* tests/pkg/pkg5.tcl: removed
	* tests/pkg/pkga.tcl: removed
	* tests/pkg/samename.tcl: removed
	* tests/pkg/simple.tcl: removed
	* tests/pkg/spacename.tcl: removed
	* tests/pkg/std.tcl: removed
	* tests/pkgMkIndex.test: Fixed [Bug 575857] where this test file
	  expected to be able to write to [file join [testsDirectory]
	  pkg].  Part of the fix was to import several auxilliary files
	  into the test file itself.

	* tests/main.test:	Cheap fix for [Bugs 575851, 575858].  Avoid
	* tests/tcltest.test:	non-writable . by [cd [temporaryDirectory]].

	* library/auto.tcl: Fix [tcl_findLibrary] to be sure it sets
	  $varName only if a successful library script is found.
	  [Bug 577033]

2002-07-03  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompCmds.c (TclCompileCatchCmd): return
	  TCL_OUT_LINE_COMPILE instead of TCL_ERROR: let the failure
	  happen at runtime so that it can be caught [Bug 577015].

2002-07-02  Joe English  <jenglish@@users.sourceforge.net>

	* doc/tcltest.n: Markup fixes, spellcheck.

2002-07-02  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n: more refinements of the documentation.

	* library/tcltest/tcltest.tcl: Added trace to be sure the stdio
	  constraint is updated whenever the [interpreter] changes.

	* doc/tcltest.n:		Reverted [makeFile] and [viewFile] to
	* library/tcltest/tcltest.tcl:	their former behavior, and documented
	* tests/cmdAH.test:		it.  Corrected misspelling of hook
	* tests/event.test:		procedure.  Restored tests.
	* tests/http.test:
	* tests/io.test:

	* library/tcltest/tcltest.tcl: Simplified logic of
	  [GetMatchingFiles] and [GetMatchingDirectories], removing
	  special case processing.

	* doc/tcltest.n: More documentation updates.  Reference sections
	  are complete.  Only examples need adding.

2002-07-02  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* tests/fCmd.test: 
	* generic/tclCmdAH.c: clearer error msgs for 'file link',
	as per the man page.

2002-07-01  Joe English  <jenglish@@users.sourceforge.net>

	* doc/Access.3:
	* doc/AddErrInfo.3:
	* doc/Alloc.3:
	* doc/Backslash.3:
	* doc/CrtChannel.3:
	* doc/CrtSlave.3:
	* doc/Encoding.3:
	* doc/Eval.3:
	* doc/FileSystem.3:
	* doc/Notifier.3:
	* doc/OpenFileChnl.3:
	* doc/ParseCmd.3:
	* doc/RegExp.3:
	* doc/Tcl_Main.3:
	* doc/Thread.3:
	* doc/TraceCmd.3:
	* doc/Utf.3:
	* doc/WrongNumArgs.3:
	* doc/binary.n:
	* doc/clock.n:
	* doc/expr.n:
	* doc/fconfigure.n:
	* doc/glob.n:
	* doc/http.n:
	* doc/interp.n:
	* doc/lsearch.n:
	* doc/lset.n:
	* doc/msgcat.n:
	* doc/packagens.n:
	* doc/pkgMkIndex.n:
	* doc/registry.n:
	* doc/resource.n:
	* doc/safe.n:
	* doc/scan.n:
	* doc/tclvars.n:  Spell-check, fixed typos (Updates from Larry Virden).

2002-07-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Made Solaris use gcc for linking
	when building with gcc to resolve problems with undefined symbols
	being present when tcl library used with non-gcc linker at later
	stage. Symbols were compiler-generated, so it is the compiler's
	business to define them. [Bug #541181] 

2002-07-01  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n: more work in progress updating tcltest docs.

	* library/tcltest/tcltest.tcl: Change [configure -match] to
	stop treating an empty list as a list of the single pattern "*".
	Changed the default value to [list *] so default operation
	remains the same.

	* tests/pkg/samename.tcl: restored.  needed by pkgMkIndex.test.

	* library/tcltest/tcltest.tcl: restored writeability testing of
	-tmpdir, augmented by a special exception for the deafault value.

2002-07-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/concat.n: Documented the *real* behaviour of [concat]!

2002-06-30  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n: more work in progress updating tcltest docs.

	* tests/README:		Updated the instructions on running and
	* tests/cmdMZ.test:	adding to the test suite.  Also updated
	* tests/encoding.test:	several tests, mostly to correctly create
	* tests/fCmd.test:	and destroy any temporary files in the
	* tests/info.test:	[temporaryDirectory] of tcltest.
	* tests/interp.test:

	* library/tcltest/tcltest.tcl:	Stopped checking for writeability
	of -tmpdir value because no default directory can be guaranteed to
	be writeable.

	* tests/autoMkindex.tcl: removed.
	* tests/pkg/samename.tcl: removed.
	* tests/pkg/magicchar.tcl: removed.
	* tests/pkg/magicchar2.tcl: removed.
	* tests/autoMkindex.test: Updated auto_mkIndex tests to use
	[makeFile] and [removeFile] so tests are done in [temporaryDirecotry]
	where write access is guaranteed.

	* library/tcltest/tcltest.tcl:	Fixed [makeFile] and [viewFile] to
	* tests/cmdAH.test:		accurately reflect a file's contents.
	* tests/event.test:		Updated tests that depended on buggy
	* tests/http.test:		behavior.  Also added warning messages
	* tests/io.test:		to "-debug 1" operations to debug test
	* tests/iogt.test:		calls to (make|remove)(File|Directory).

	* unix/mkLinks: `make mklinks` on 6-27 commits.

2002-06-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.h: modified the macro TclEmitPush to not
	call its first argument repeatedly or pass it to other macros,
	[Bug 575194] reported by Peter Spjuth.

2002-06-28  Don Porter  <dgp@@users.sourceforge.net>

	* docs/tcltest.n:	Doc revisions in progress.
	* library/tcltest/tcltest.tcl: Corrected -testdir default value.
	Was not reliable, and disagreed with docs!  Thanks to Hemang Lavana.
	[Bug 575150]

2002-06-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tclUnixThrd.c:	Renamed the Tcl_Platform* #defines to
	* unix/tclUnixPipe.c:	TclOS* because they are only used
	* unix/tclUnixFile.c:	internally.  Also stopped double-#def
	* unix/tclUnixFCmd.c:	of TclOSlstat [Bug #566099, post-rename]
	* unix/tclUnixChan.c:
	* unix/tclUnixPort.h:

	* doc/string.n: Improved documentation for [string last] along
	lines described in Bug #574799 so it indicates that the supplied
	index marks the end of the search space.

2002-06-27  Don Porter  <dgp@@users.sourceforge.net>

	* doc/dde.n:		Work in progress updating the documentation
	* doc/http.n:		of the packages that come bundled with
	* doc/msgcat.n:		the Tcl source distribution, notably tcltest.
	* doc/registry.n:
	* doc/tcltest.n:

	* library/tcltest/tcltest.tcl:  Made sure that the TCLTEST_OPTIONS
	environment variablle configures tcltest at package load time.

2002-06-26  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* tests/fileSystem.test: 
	* generic/tclIOUtil.c: fix to handling of empty paths ""
	which are not claimed by any filesystem (Bug #573758).
	Ensure good error messages are given in all cases.
	* tests/cmdAH.test:
	* unix/tclUnixFCmd.c: fix to bug reported as part of
	(Patch #566669).  Thanks to Taguchi, Takeshi for the report.
	
2002-06-26  Reinhard Max  <max@@suse.de>

	* unix/tclUnixTime.c: Make [clock format] respect locale settings.
	* tests/clock.test:   Bug #565880. ***POTENTIAL INCOMPATIBILITY***

2002-06-26  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/CrtInterp.3:
	* doc/StringObj.3: clarifications by Don Porter, bugs #493995 and
	#500930. 
	
2002-06-24  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:	Corrected suppression of -verbose skip
	* tests/tcltest.test:		and start by [test -output].  Also
	corrected test suite errors exposed by corrected code.  [Bug 564656]

2002-06-25  Reinhard Max  <max@@suse.de>

	* unix/tcl.m4:       New macro SC_CONFIG_MANPAGES.
	* unix/configure.in: Added support for symlinks and compression
	* unix/Makefile.in:  when installing the manpages. [Patch 518052]
	* unix/mkLinks.tcl:  Default is still hardlinks and no compression.

	* unix/mkLinks:      generated
	* unix/configure:

	* unix/README:       Added documentation for the new features.

	* unix/tcl.m4 (SC_PATH_TCLCONFIG): Replaced ${exec_prefix}/lib by
	${libdir}.

2002-06-25  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclUtil.c (TclGetIntForIndex): Fix of critical bug
	#533364 generated when the index is bad and the result is a shared
	object.  The T_ASTO(T_GOR, ...) idiom likely exists elsewhere
	though.  Also removed some cruft that just complicated things to
	no advantage.
	(SetEndOffsetFromAny): Same fix, though this wasn't on the path
	excited by the bug.

2002-06-24  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:	Implementation of TIP 101.  Adds
	* tests/parseOld.test:		and exports a [configure] command
	* tests/tcltest.test:		from tcltest.

2002-06-22  Don Porter  <dgp@@users.sourceforge.net>

	* changes: updated changes file for 8.4b1 release.

	* library/tcltest/tcltest.tcl:	Corrections to tcltest and the
	* tests/basic.test:		Tcl test suite so that a test
	* tests/cmdInfo.test:		with options -constraints knownBug
	* tests/compile.test:		-limitConstraints 1 only tests the
	* tests/encoding.test:		knownBug tests.  Mostly involves
	* tests/env.test:		replacing direct access to the
	* tests/event.test:		testConstraints array with calls
	* tests/exec.test:		to the testConstraint command
	* tests/execute.test:		(which requires tcltest version 2)
	* tests/fCmd.test:
	* tests/format.test:
	* tests/http.test:
	* tests/httpold.test:
	* tests/ioUtil.test:
	* tests/link.test:
	* tests/load.test:
	* tests/namespace.test:
	* tests/pkgMkIndex.test:
	* tests/reg.test:
	* tests/result.test:
	* tests/scan.test:
	* tests/stack.test:

2002-06-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tools/tcl.wse.in (Disk Label), unix/tcl.spec (version): 
	* win/README.binary, README, win/configure.in, unix/configure.in: 
	* generic/tcl.h (TCL_RELEASE_*, TCL_PATCH_LEVEL): Bump to beta1.

2002-06-21  Joe English  <jenglish@@users.sourceforge.net>

	* generic/tclCompExpr.c:
	* generic/tclParseExpr.c: LogSyntaxError() should reset 
	the interpreter result [Bug 550142 "Tcl_ExprObj -> abort"] 

2002-06-21  Don Porter  <dgp@@users.sourceforge.net>
	
	* unix/Makefile.in:	Updated all package install directories
	* win/Makefile.in:	to match current Major.minor versions
	* win/makefile.bc:	of the packages.  Added tcltest package
	* win/makefile.vc:	to installation on Windows.

	* library/init.tcl:  Corrected comments and namespace style
	issues.  Thanks to Bruce Stephens. [Bug 572025]

2002-06-21  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* tests/cmdAH.test:          Added TIP#99 implementation
	* tests/fCmd.test:           of 'file link'.  Supports creation
	* tests/fileName.test:       of symbolic and hard links in the
	* tests/fileSystem.test:     native filesystems and in vfs's,
	* generic/tclTest.c:         when the individual filesystem
	* generic/tclCmdAH.c:        supports the concept.
	* generic/tclIOUtil.c:       
	* generic/tcl.h:
	* generic/tcl.decls:
	* doc/FileSystem.3:
	* doc/file.n:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: Also enhanced speed of 'file normalize' on
	Windows.

2002-06-20  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (TclEvalObjvInternal): fix for [Bug 571385]
	in the implementation of TIP#62 (command tracing). Vince Darley,
	Hemang Lavana & Don Porter: thanks.

2002-06-20  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TclCompEvalObj): clarified and simplified
	the logic for compilation/recompilation.

2002-06-19  Joe English  <jenglish@@users.sourceforge.net>
	* doc/file.n: Fixed indentation.  No substantive changes.

2002-06-19  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): get the resultPtr again
	as the Tcl_ObjSetVar2 may cause the result to change.
	[Patch #558324] (watson)

2002-06-19  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TEBC): removing unused "for(;;)" loop;
	improved comments; re-indentation.

2002-06-18  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TEBC): 
	- elimination of duplicated code in the non-immediate INST_INCR
	  instructions. 
	- elimination of 103 (!) TclDecrRefCount macros. The different
	  instructions now jump back to a common "DecrRefCount zone" at
	  the top of the loop. The macro "ADJUST_PC" was replaced by two
	  macros "NEXT_INST_F" and "NEXT_INST_V" that take three params
	  (pcAdjustment, # of stack objects to discard, resultObjPtr
	  handling flag). The only instructions that retain a
	  TclDecrRefCount are INST_POP (for speed), the common code for
	  the non-immediate INST_INCR, INST_FOREACH_STEP and the two
	  INST_LSET.

	The object size of tclExecute.o was reduced by approx 20% since
	the start of the consolidation drive, while making room for some
	peep-hole optimisation at runtime.

2002-06-18  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TEBC, INST_DONE): small bug in the panic
	code for tcl-stack corruption.

2002-06-17  David Gravereaux <davygrvy@@pobox.com>

	Trims to support the removal of RESOURCE_INCLUDED from rc
	scripts	from FR #565088.

	* generic/tcl.h: moved the #ifndef RC_INVOKED start block up in
	the file.  rc scripts don't need to know thread mutexes.

	* win/tcl.rc:
	* win/tclsh.rc: removed the #define RESOURCE_INCLUDED to let the
	built-in -DRC_INVOKED to the work.

2002-06-17  Jeff Hobbs  <jeffh@@ActiveState.com>

	* doc/CrtTrace.3:        Added TIP#62 implementation of command
	* doc/trace.n:           execution tracing [FR #462580] (lavana).
	* generic/tcl.h:         This includes enter/leave tracing as well
	* generic/tclBasic.c:    as inter-procedure stepping.
	* generic/tclCmdMZ.c:
	* generic/tclCompile.c:
	* generic/tclExecute.c:
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c:
	* tests/trace.test:

2002-06-17  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* win/tclWinPipe.c (BuildCommandLine): Fixed bug #554068 ([exec]
	  on windows did not treat { in filenames well.). Bug reported by
	  Vince Darley <vincentdarley@@users.sourceforge.net>, patch
	  provided by Vince too.

2002-06-17  Joe English  <jenglish@@users.sourceforge.net>

	* generic/tcl.h: #ifdef logic for K&R C backwards compatibility
	changed to assume modern C by default.  See SF FR #565088 for
	full details.

2002-06-17  Don Porter  <dgp@@users.sourceforge.net>

	* doc/msgcat.n: Corrected en_UK references to en_GB.  UK is not
	a country designation recognized in ISO 3166.

	* library/msgcat/msgcat.tcl:  More Windows Registry locale codes
	from Bruno Haible.

	* doc/msgcat.n:
	* library/msgcat/msgcat.tcl:
	* library/msgcat/pkgIndex.tcl:
	* tests/msgcat.test:  Revised locale initialization to interpret
	environment variable locale values according to XPG4, and to
	recognize the LC_ALL and LC_MESSAGES values over that of LANG.
	Also added many Windows Registry locale values to those 
	recognized by msgcat.  Revised tests and docs.  Bumped to
	version 1.3.  Thanks to Bruno Haible for the report and
	assistance crafting the solution.  [Bug 525522, 525525]

2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.c (TclCompileTokens): a better algorithm for
	the previous bug fix.

2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.c (TclCompileTokens): 
	* tests/compile.test: [Bug 569438] in the processing of dollar
	variables; report by Georgios Petasis. 
	
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: bug in the consolidation of the
	INCR_..._STK instructions; the bug could not be exercised as the
	(faulty) instruction INST_INCR_ARRAY_STK was never compiled-in
	(related to [Bug 569438]).

2002-06-14  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TclExecuteByteCode): runtime peep-hole
	optimisation of variables (INST_STORE, INST_INCR) and commands
	(INST_INVOKE); faster check for the existence of a catch.
	(TclExecuteByteCode): runtime peep-hole optimisation of
	comparisons.
	(TclExecuteByteCode): runtime peep-hole optimisation of
	INST_FOREACH - relies on peculiarities of the code produced by the
	bytecode compiler.

2002-06-14  David Gravereaux <davygrvy@@pobox.com>

	* win/rules.vc: The test for compiler optimizations was in error.
	Thanks goes to Roy Terry <royterry@@earthlink.net> for his
	assistance with this.

2002-06-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/trace.n, tests/trace.test: 
	* generic/tclCmdMZ.c (Tcl_TraceObjCmd,TclTraceCommandObjCmd)
	(TclTraceVariableObjCmd): Changed references to "trace list" to
	"trace info" as mandated by TIP#102.

2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TclExecuteByteCode): consolidated code for
	the conditional branch instructions.

2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TclExecuteByteCode): fixed the previous
	patch - wouldn't compile with TCL_COMPILE_DEBUG set.

2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TclExecuteByteCode): consolidated the
	handling of exception returns to INST_INVOKE and INST_EVAL, as
	well as most of the code for INST_CONTINUE and INST_BREAK, in the
	new jump target "processExceptionReturn".

2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TclExecuteByteCode): consolidated variable
	handling opcodes, replaced redundant code with some 'goto'. All
	store/append/lappend opcodes on the same data type now share the
	main code; same with incr opcodes.
	* generic/tclVar.c: added the bit TCL_TRACE_READS to the possible
	flags to Tcl_SetVar2Ex - it causes read traces to be fired prior
	to setting the variable. This is used in the core for [lappend].

	***NOTE*** the usage of TCL_TRACE_READS in Tcl_(Obj)?GetVar.* is
	not documented; there, it causes the call to create the variable
	if it does not exist. The new usage in Tcl_(Obj)?SetVar.* remains
	undocumented too ...
	
2002-06-13  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* tests/fCmd.test:
	* tests/winFile.test:
	* tests/fileSystem.test:
	* generic/tclTest.c:
	* generic/tclCmdAH.c:
	* generic/tclIOUtil.c:
	* doc/FileSystem.3:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: fixed up further so both compiles and
	actually works with VC++ 5 or 6.
	* win/tclWinInt.h: 
	* win/tclWin32Dll.c: cleaned up code and vfs tests and
	added tests for the internal changes of 2002-06-12, to see
	whether WinTcl on NTFS can coexist peacefully with links
	in the filesystem.  Added new test command 'testfilelink'
	to enable the newer code to be tested.
	* tests/fCmd.test: (made certain tests of 'testfilelink' not
	run on unix).

2002-06-12  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tclBasic.c (Tcl_DeleteTrace): fixed [Bug 568123] (thanks to
	Hemang Lavana)
	
2002-06-12  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinFile.c: corrected the symbolic link handling code to
	allow it to compile.  Added real definition of REPARSE_DATA_BUFFER
	(found in winnt.h).  Most of the added definitions appear to have
	correct, cross-Win-version equivalents in winnt.h and should be
	removed, but just making things "work" for now.

2002-06-12  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclIOUtil.c:
	* generic/tcl.decls:
	* generic/tclDecls.h: made code for Tcl_FSNewNativePath
	agree with man pages.
	
	* doc/FileSystem.3: clarified the circumstances under which
	certain functions are called in the presence of symlinks.
	
	* win/tclWinFile.c:
	* win/tclWinPort.h: 
	* win/tclWinInt.h: 
	* win/tclWinFCmd.c:  Fix for Windows to allow 'file lstat', 
	'file type', 'glob -type l', 'file copy', 'file delete', 
	'file normalize', and all VFS code to work correctly in the 
	presence of symlinks (previously Tcl's behaviour was not very 
	well defined).  This also fixes possible serious problems in 
	all versions of WinTcl where 'file delete' on a NTFS symlink 
	could delete the original, not the symlink.
	Note: symlinks cannot yet be created in pure Tcl.

2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c: 
	* generic/tclCompCmds.c:
	* generic/tclInt.h: reverted the new compilation functions;
	replaced by a more general approach described below.

	* generic/tclCompCmds.c:
	* generic/tclCompile.c: made *all* compiled variable access
	attempts create an indexed variable - even get or incr without
	previous set. This allows indexed access to local variables that
	are created and set at runtime, for example by [global], [upvar],
	[variable], [regexp], [regsub].

2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/global.n:
	* doc/info.n:
	* test/info.test:
	* generic/tclCmdIL.c: fix for [Bug 567386], [info locals] was
	reporting some linked variables.
	
	* generic/tclBasic.c: 
	* generic/tclCompCmds.c:
	* generic/tclInt.h: added compile functions for [global],
	[variable] and [upvar]. They just declare the new local variables,
	the commands themselves are not compiled-in. This gives a notably
	faster read access to these linked variables.

2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: optimised algorithm for exception range
	lookup; part of [Patch 453709].

2002-06-10  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* unix/tclUnixFCmd.c: fixed [Bug #566669]
	* generic/tclIOUtil.c: improved and sped up handling of
	native paths (duplication and conversion to normalized paths),
	particularly on Windows.
	* modified part of above commit, due to problems on Linux. 
	Will re-examine bug report and evaluate more closely.

2002-06-07  Don Porter  <dgp@@users.sourceforge.net>

	* tests/tcltest.test:  More corrections to test suite so that tests
	of failing [test]s don't show up themselves as failing tests.

2002-06-07  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclExecute.c: Tidied up headers in relation to float.h
	to cut the cruft and ensure DBL_MAX is defined since doubles seem
	to be the same size everywhere; if the assumption isn't true, the
	variant platforms had better have run configure...

	* unix/tclUnixPort.h (EOVERFLOW): Added code to define it if it
	wasn't previously defined.  Also some other general tidying and
	adding of comments.  [Tcl bugs 563122, 564595]
	* compat/tclErrno.h: Added definition for EOVERFLOW copied from
	Solaris headers; I've been unable to find any uses of EFTYPE,
	which was the error code previously occupying the slot, in Tcl, or
	any definition of it in the Solaris headers.

2002-06-06  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/dltest/Makefile.in: Remove hard coded CFLAGS=-g
	and add CFLAGS_DEBUG, CFLAGS_OPTIMIZE, and
	CFLAGS_DEFAULT varaibles. [Tcl bug 565488]

2002-06-06  Don Porter  <dgp@@users.sourceforge.net>

	* tests/tcltest.test:  Corrections to test suite so that tests
	of failing [test]s don't show up themselves as failing tests.

	* tests/io.test: Fixed up namespace variable resolution issues
	revealed by running test suite with "-singleproc 1".

	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test: Several updates to tcltest.
	  1) changed to lazy initialization of test constraints
	  2) deprecated [initConstraintsHook]
	  3) repaired badly broken [limitConstraints].
	  4) deprecated [threadReap] and [mainThread]
	[Patch 512214, Bug 558742, Bug 461000, Bug 534903]

2002-06-06  Daniel Steffen  <das@@users.sourceforge.net>

	* unix/tclUnixThrd.c (TclpReaddir, TclpLocaltime, TclpGmtime):
	added mutex wrapped calls to readdir, localtime & gmtime in
	case their thread-safe *_r counterparts are not available.
	* unix/tcl.m4: added configure check for readdir_r
	* unix/tcl.m4 (Darwin): set TCL_DEFAULT_ENCODING to utf-8 on
	MacOSX (where posix file apis expect utf-8, not iso8859-1).   
	* unix/configure: regen
	* unix/Makefile.in: set DYLD_LIBRARY_PATH in parallel       
	to LD_LIBRARY_PATH for MacOSX dynamic linker.
	* generic/tclEnv.c (TclSetEnv): fix env var setting on
	MacOSX (adapted from patch #524352 by jkbonfield).

2002-06-05  Don Porter  <dgp@@users.sourceforge.net>

	* doc/Tcl_Main.3: Documented $tcl_rcFileName and added more
	clarifications about the intended use of Tcl_Main(). [Bug 505651]

2002-06-05  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclFileName.c (TclGlob): mac specific fix to
	recent changes in 'glob -tails' handling.
	* mac/tclMacPort.h:
	* mac/tclMacChan.c: fixed TIP#91 bustage.
	* mac/tclMacResource.c (Tcl_MacConvertTextResource): added utf
	conversion of text resource contents.
	* tests/macFCmd.test (macFCmd-1.2): allow CWIE creator.

2002-06-04  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:
	* tests/init.test:
	* tests/tcltest.test:	Added more TIP 85 tests from Arjen Markus.
	Converted tcltest.test to use a private namespace.  Fixed bugs in
	[tcltest::Eval] revealed by calling [tcltest::test] from a non-global
	namespace, and namespace errors in init.test.

2002-06-04  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/README: Update msys+mingw URL.

2002-06-03  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* library/tcltest/pkgIndex.tcl:
	* tests/tcltest.test:  Implementation of TIP 85.  Allows tcltest
	users to add new legal values of the -match option to [test],
	associating each with a Tcl command that does the matching of
	expected results with actual results of tests.  Thanks to
	Arjen Markus.  => tcltest 2.1 [Patch 521362]

2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/namespace.n: added description of [namepace forget]
	behaviour for unqualified patterns [Bug 559268]

2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: reverting an accidental modification in
	the last commit.
	
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/Tcl.n: clarify the empty variable name issue ([Bug 549285]
	reported by Tom Krehbiel, patch by Don Porter).

2002-05-31  Don Porter  <dgp@@users.sourceforge.net>

	* library/package.tcl:  Fixed leak of slave interp in [pkg_mkIndex].
	Thanks to Helmut for report.  [Bug 550534]

	* tests/io.test:
	* tests/main.test:  Use the "stdio" constraint to control whether
	an [open "|[interpreter]"] is attempted.

	* generic/tclExecute.c (TclMathInProgress,TclExecuteByteCode
		ExprCallMathFunc):
	* generic/tclInt.h (TclMathInProgress):
	* unix/Makefile.in (tclMtherr.*):
	* unix/configure.in (NEED_MATHERR):
	* unix/tclAppInit.c (matherr):
	* unix/tclMtherr.c (removed file):
	* win/tclWinMtherr.c (_matherr): Removed internal routine
	TclMathInProgress and Unix implementation of matherr().  These
	are now obsolete, dealing with very old versions of the C math
	library.  Windows version is retained in case Borland compilers
	require it, but it is inactive.  Thanks to Joe English.
	[Bug 474335, Patch 555635].
	* unix/configure: regen

2002-05-30  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompExpr.c:
	* generic/tclCompile.c:
	* generic/tclCompile.h: removed exprIsJustVarRef and
	exprIsComparison from the ExprInfo and CompileEnv structs. These
	were set, but not used since dec 1999 [Bug 562383].

2002-05-30  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c (TclGlob): fix to longstanding
	'knownBug' in fileName tests 15.2-15.4, and fix to a new
	Tcl 8.4 bug in certain uses of 'glob -tails'.
	* tests/fileName.test: removed 'knownBug' flag from some tests,
	added some new tests for above bugs.
	
2002-05-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure: regen'ed
	* unix/configure.in: replaced bigendian check with autoconf
	standard AC_C_BIG_ENDIAN, which defined WORDS_BIGENDIAN on
	bigendian systems.
	* generic/tclUtf.c (Tcl_UniCharNcmp): 
	* generic/tclInt.h (TclUniCharNcmp): use WORDS_BIGENDIAN instead of
	TCL_OPTIMIZE_UNICODE_COMPARE to enable memcmp alternative.

	* generic/tclExecute.c (TclExecuteByteCode INST_STR_CMP):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): changed the case for
	choosing the Tcl_UniCharNcmp compare to when both objs are of
	StringType, as benchmarks show that is the optimal check (both
	bigendian and littleendian systems).

2002-05-29  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclMain.c: Removed "dummy" reference to Tcl_LinkVar.
	It is no longer needed since Tcl_Main() now actually calls
	Tcl_LinkVar().  Thanks to Joe English for pointing that out.

2002-05-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclExecute.c (TclExecuteByteCode): 
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): Use the macro version.
	* generic/tclInt.h (TclUniCharNcmp): Optimised still further with
	a macro for use in sensitive places like tclExecute.c

	* generic/tclUtf.c (Tcl_UniCharNcmp): Use new flag to figure out
	when we can use an optimal comparison scheme, and default to the
	old scheme in other cases which is at least safe.
	* unix/configure.in (TCL_OPTIMIZE_UNICODE_COMPARE): New optional
	flag that indicates when we can use memcmp() to compare Unicode
	strings (i.e. when the high-byte of a Tcl_UniChar precedes the
	low-byte.)

2002-05-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclUtf.c: added TclpUtfNcmp2 private command that
	mirrors Tcl_UtfNcmp, but takes n in bytes, not utf-8 chars.  This
	provides a faster alternative for comparing utf strings	internally.
	(Tcl_UniCharNcmp, Tcl_UniCharNcasecmp): removed the explicit end
	of string check as it wasn't correct for the function (by doc and
	logic).

	* generic/tclCmdMZ.c (Tcl_StringObjCmd): reworked the string equal
	comparison code to use TclpUtfNcmp2 as well as short-circuit for
	equal objects or unequal length strings in the equal case.
	Removed the use of goto and streamlined the other parts.

	* generic/tclExecute.c (TclExecuteByteCode): added check for
	object equality in the comparison instructions.  Added
	short-circuit for != length strings in INST_EQ, INST_NEQ and
	INST_STR_CMP.  Reworked INST_STR_CMP to use TclpUtfNcmp2 where
	appropriate, and only use Tcl_UniCharNcmp when at least one of the
	objects is a Unicode obj with no utf bytes.

	* generic/tclCompCmds.c (TclCompileStringCmd): removed error
	creation in code that no longer throws an error.

	* tests/string.test:
	* tests/stringComp.test: added more string comparison checks.

	* tests/clock.test: better qualified 9.1 constraint check for %s.

2002-05-28  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclThreadAlloc.c (TclpRealloc, TclpFree): protect
	against the case when NULL is based.

	* tests/clock.test: added clock-9.1
	* compat/strftime.c:
	* generic/tclClock.c:
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* unix/tclUnixTime.c: fix for Windows msvcrt mem leak caused by
	using an env(TZ) setting trick for in clock format -gmt 1.  This
	also makes %s seem to work correctly with -gmt 1 as well as
	making it a lot faster by avoid the env(TZ) hack.  TclpStrftime
	now takes useGMT as an arg.  [Bug #559376]

2002-05-28  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclIOUtil.c: fixes to Tcl_FSLoadFile when called on
	a file inside a vfs.  This should avoid leaving temporary 
	files sitting around on exit. [Bug #545579]
	
2002-05-27  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* win/tclWinError.c: Added comment on conversion of
	ERROR_NEGATIVE_SEEK because that is a mapping that really belongs,
	and not a catch-all case.
	* win/tclWinPort.h (EOVERFLOW): Should be either EFBIG or EINVAL
	* generic/tclPosixStr.c (Tcl_ErrnoId, Tcl_ErrnoMsg): EOVERFLOW can
	potentially be a synonym for EINVAL.

2002-05-24  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	=== Changes due to TIP#91 ===

	* win/tclWinPort.h: Added declaration of EOVERFLOW.
	* doc/CrtChannel.3: Added documentation of wideSeekProc.
	* generic/tclIOGT.c (TransformSeekProc, TransformWideSeekProc):
	Adapted to use the new channel mechanism.
	* unix/tclUnixChan.c (FileSeekProc, FileWideSeekProc): Renamed
	FileSeekProc to FileWideSeekProc and created new FileSeekProc
	which has the old-style interface and which errors out with
	EOVERFLOW when the returned file position can't fit into the
	return type (int for historical reasons.)
	* win/tclWinChan.c (FileSeekProc, FileWideSeekProc): Renamed
	FileSeekProc to FileWideSeekProc and created new FileSeekProc
	which has the old-style interface and which errors out with
	EOVERFLOW when the returned file position can't fit into the
	return type (int for historical reasons.)
	* mac/tclMacChan.c (FileSeek): Reverted to old interface; Macs
	lack large-file support because I can't see how to add it.
	* generic/tclIO.c (Tcl_Seek, Tcl_Tell): Given these functions
	knowledge of the new arrangement of channel types.
	(Tcl_ChannelVersion): Added recognition of new version code.
	(HaveVersion): New function to do version checking.
	(Tcl_ChannelBlockModeProc, Tcl_ChannelFlushProc)
	(Tcl_ChannelHandlerProc): Made these functions use HaveVersion for
	ease of future maintainability.
	(Tcl_ChannelBlockModeProc): Obvious lookup function.
	* generic/tcl.h (Tcl_ChannelType): New wideSeekProc field, and
	seekProc type restored to old interpretation.
	(TCL_CHANNEL_VERSION_3): New channel version.

2002-05-24  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
	
	* tests/winPipe.test: Applied patch for SF Tcl Bug #549617. Patch
	  and bug report by Kevin Kenny <kennykb@@users.sourceforge.net>.

	* win/tclWinSock.c (TcpWatchProc): Fixed SF Tcl Bug #557878. We
	  are not allowed to mess with the watch mask if the socket is a
	  server socket. I believe that the original reporter is George
	  Peter Staplin.

2002-05-21  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/configure.in: Invoke SC_ENABLE_SHARED before
	calling SC_CONFIG_CFLAGS so that the SHARED_BUILD
	variable can be checked inside SC_CONFIG_CFLAGS.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Pass -non_shared
	instead of -shared to ld when configured with
	--disable-shared under OSF. [Tcl bug 540390]

2002-05-20  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclInt.h: added prototype for TclpFilesystemPathType().
	* mac/tclMacChan.c: use MSL provided creator type if available
	instead of the default 'MPW '.

2002-05-16  Joe English  <jenglish@@users.sf.net>

	* doc/CrtObjCmd.3: 
	Added Tcl_GetCommandFromObj, Tcl_GetCommandFullName
	(Tcl Bug #547987, #414921)

2002-05-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tclUnixChan.c (TtyOutputProc): #if/#endif-ed this function
	out to stop compiler warnings.  Also much general tidying of
	comments in this file and removal of whitespace from blank lines.

2002-05-13  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tclUnixChan.c (SETBREAK): Solaris thinks ioctl() takes a
	signed second argument, and Linux thinks ioctl() takes an unsigned
	second argument.  So need a longer definition of this macro to get
	neither to spew warnings...

2002-05-13  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclEvent.c: 
	* generic/tclIOUtil.c:
	* generic/tclInt.h: clean up all memory allocated by the
	filesystem, via introduction of 'TclFinalizeFilesystem'.
	Move TclFinalizeLoad into TclFinalizeFilesystem so we can
	be sure it is called at just the right time.
	Fix bad comment also.  [Bug #555078 and 'fs' part of #543549]
	* win/tclWinChan.c: fix comment referring to wrong function.
	
2002-05-10  Don Porter  <dgp@@users.sourceforge.net>

	* tests/load.test:
	* tests/safe.test:
	* tests/tcltest.test: Corrected some list-quoting issues and
	other matters that cause tests to fail when the patch includes
	special characters.  Report from Vince Darley.  [Bug 554068].

2002-05-08    David Gravereaux <davygrvy@@pobox.com>

	* doc/file.n:
	* tools/man2tcl.c:
	* tools/man2help2.tcl:  Thanks to Peter Spjuth
	<peter.spjuth@@space.se>, again.  My prior fix for
	single-quote macro mis-understanding was wrong.	 Reverted to
	reimpliment the 'macro2' proc which handles single-quote macros
	and restored file.n text arrangement to avoid single-quotes on
	the first line.  Sorry for all the confusion.

2002-05-08  David Gravereaux <davygrvy@@pobox.com>

	* tools/man2tcl.c:
	* tools/man2help2.tcl: Proper source of macro error mis-
	understanding single-quote as the leading macro command found
	and repaired.

	* doc/file.n: Reverted to prior state before I messed with
	it.

2002-05-08  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl: Corrected [uplevel] quoting when
	[source]-ing test script in subdirectories.
	* tests/fileName.test:
	* tests/load.test:
	* tests/main.test:
	* tests/tcltest.test: 
	* tests/unixInit.test: Fixes to test suite when there's a space
	in the working path.  Thanks to Kevin Kenny.

2002-05-07  David Gravereaux <davygrvy@@pobox.com>

	-- Changes from Peter Spjuth <peter.spjuth@@space.se>
	* tools/man2tcl.c: Increased line buffer size and a bail-out if
	that should ever be over-run.
	* tools/man2help.tcl: Include Courier New font in rtf header.
	* tools/man2help2.tcl: Improved handling of CS/CE fields.  Use
	Courier New for code samples and indent better.

	* doc/file.n:
	* doc/TraceCmd.3:  winhelp conversion tools where understanding
	a ' as the first character on a line to be an unknown macro.
	Not knowing how to repair tools/man2tcl.c, I decided to rearrange
	the text in the docs instead.

2002-05-07  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c: fix to similar segfault when using 
	'glob -types nonsense -dir dirname -join * *'. [Bug 553320]
	
	* doc/FileSystem.3: further documentation on vfs.
	* tests/cmdAH.test:
	* tests/fileSystem.test:
	* tests/pkgMkindex.test: Fix to testsuite bugs when running out
	of directory whose name contains '{' or '['.

2002-05-07  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/basic.test: Fix for [Bug 549607]
	* tests/encoding.test: Fix for [Bug 549610]
	These are testsuite bugs that caused failures when the filename
	contained spaces. Report & fix by Kevin Kenny.

2002-05-02  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c: fix to freeing a bad object 
	(i.e. segfault) when using 'glob -types nonsense -dir dirname'.
	* generic/tclWinFile.c: fix to [Bug 551306], also wrapped some 
	long lines.
	* tests/fileName.test: added several tests for the above bugs.
	* doc/FileSystem.3: clarified documentation on refCount
	requirements of the object returned by the path type function.
	* generic/tclIOUtil.c:
	* win/tclWinFile.c:
	* unix/tclUnixFile.c:
	* mac/tclMacFile.c: moved TclpFilesystemPathType to the
	platform specific directories, so we can add missing platform-
	specific implementations.  On Windows, 'file system' now returns 
	useful results like "native NTFS", "native FAT" for that system.  
	Unix and MacOS still only return "native".
	* doc/file.n: clarified documentation.
	* tests/winFile.test: test for 'file system' returning correct
	values.
	* tests/fileSystem.test: test for 'file system' returning correct
	values.  Clean up after failed previous test run.
	
2002-04-26  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure:
	* unix/tcl.m4: change HP-11 SHLIB_LD_LIBS from "" to ${LIBS} so
	that the .sl knows its dependent libs.

2002-04-26  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/obj.test (obj-11.[56]): Test conversion to boolean more
	thoroughly.
	* generic/tclObj.c (SetBooleanFromAny): Was not calling an integer
	parsing function on native 64-bit platforms!  [Bug 548686]

2002-04-24  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclInt.h: corrected TclRememberJoinableThread decl to
	use VOID instead of void.
	* generic/tclThreadJoin.c: noted that this code isn't needed on Unix.

2002-04-23  Jeff Hobbs  <jeffh@@ActiveState.com>

	* doc/exec.n: 
	* doc/tclvars.n: doc updates [Patch #509426] (gravereaux)

2002-04-24  Daniel Steffen  <das@@users.sourceforge.net>

	* mac/tclMacResource.r: added check of
	TCLTK_NO_LIBRARY_TEXT_RESOURCES #define to allow disabling the
	inclusion of the tcl library code in the resource fork of Tcl
	executables and shared libraries.

2002-04-23  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/TraceCmd.3: New file that documents Tcl_CommandTraceInfo,
	Tcl_TraceCommand and Tcl_UntraceCommand [Bug 414927]

2002-04-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclAlloc.c:
	* generic/tclInt.h:
	* generic/tclThreadAlloc.c (new):
	* unix/Makefile.in:
	* unix/tclUnixThrd.c:
	* win/Makefile.in:
	* win/tclWinInt.h:
	* win/tclWinThrd.c: added new threaded allocator contributed by
	AOL that significantly reduces lock contention when multiple
	threads are in use.  Only Windows and Unix implementations are
	ready, and the Windows one may need work.  It is only used by
	default on Unix for now, and requires that USE_THREAD_ALLOC be
	defined (--enable-threads on Unix will define this).

	* generic/tclIOUtil.c (Tcl_FSRegister, Tcl_FSUnregister):
	corrected calling of Tcl_ConditionWait to ensure that there would
	be a condition to wait upon.

	* generic/tclCmdAH.c (Tcl_FileObjCmd): added cast in FILE_SIZE.

	* win/tclWinFCmd.c (DoDeleteFile): check return of setattr API
	calls in file deletion for correct Win32 API handling.

	* win/Makefile.in: correct dependencies for shell, gdb, runtest
	targets.

	* doc/clock.n:
	* compat/strftime.c (_fmt): change strftime to correctly handle
	localized %c, %x and %X on Windows.  Added some notes about how
	the other values could be further localized.

2002-04-19  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclMain.c (Tcl_Main):  Free the memory allocated for the
	startup script path.  [Bug 543549]

	* library/msgcat/msgcat.tcl:  [mcmax] wasn't using the caller's
	namespace when determining the max translated length.  Also
	made revisions for better use of namespace variables and more
	efficient [uplevel]s.

	* doc/msgcat.n:
	* library/msgcat/msgcat.tcl:
	* library/msgcat/pkgIndex.tcl:  Added [mcload] to the export list
	of msgcat; bumped to 1.2.3.  [Bug 544727]

2002-04-20  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacUtil.c: Modified TclpObjNormalizePath to be alias
	file aware, and replaced various calls to FSpLocationFrom*Path
	by calls to new alias file aware versions FSpLLocationFrom*Path.
	The alias file aware routines don't resolve the last component of
	a path if it is an alias. This allows [file copy/delete] etc. to
	act correctly on alias files. (c.f. discussion in Bug #511666)

2002-04-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/lindex.test (lindex-3.7): 
	* generic/tclUtil.c (TclGetIntForIndex): Stopped indexes from
	hitting wide ints.  [Bug #526717]

2002-04-18  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclNamesp.c:
	* tests/info.test: [Bug 545325] info level didn't report
	namespace eval, bug report by Richard Suchenwirth.

2002-04-18  Don Porter  <dgp@@users.sourceforge.net>

	* doc/subst.n:  Clarified documentation on handling unusual return
	codes during substitution, and on variable substitutions implied
	by command substitution, and vice versa.  [Bug 536838]

2002-04-18  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclCmdIL.c (InfoBodyCmd): 
	* tests/info.test (info-2.6): Proc bodies without string reps
	would report as empty [Bug #545644]

	* generic/tclCmdMZ.c (Tcl_SubstObj): More clarification for
	comment on behaviour when substitutions are not well-formed,
	prompted by [Bug #536831]; alas, removing the ill-defined
	behaviour is a lot of work.

2002-04-18  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c:
	* tests/expr-old.test: fix for [Bug #542588] (Phil Ehrens), where
	"too large integers" were reported as "floating-point value" in
	[expr] error messages.

2002-04-17  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclEncoding.c (EscapeFromUtfProc): 
	* generic/tclIO.c (WriteChars, Tcl_Close): corrected the handling
	of outputting end escapes for escape-based encodings.
	[Bug #526524] (yamamoto)

2002-04-17  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n:  Removed [saveState] and [restoreState] from
	tcltest 2 documentation, effectively deprecating them.  [Bug 495660]
	* library/tcltest/tcltest.tcl: Made separate export for commands
	kept only for tcltest 1 compatibility.

	* tests/iogt.test: Revised to run tests in a namespace, rather than
	use the useless and buggy [saveState] and [restoreState] commands
	of tcltest.  Updated to use tcltest 2 as well.  [Patch 544911]

2002-04-16  Don Porter  <dgp@@users.sourceforge.net>

	* tests/io.test: Revised to run tests in a namespace, rather than
	use the useless and buggy [saveState] and [restoreState] commands
	of tcltest.  Updated to use tcltest 2 as well.  [Patch 544546]

2002-04-15  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclProc.c:
	* tests/proc-old.test: Improved stack trace for TCL_BREAK and
	TCL_CONTINUE returns from procs. Patch by Don Porter
	[Bug 536955]. 
	
	* generic/tclExecute.c:
	* tests/compile.test: made bytecodes check for a catch before
	  returning; the compiled [return] is otherwise non-catchable. 
	  [Bug 542142] reported by Andreas Kupries.

2002-04-15  Don Porter  <dgp@@users.sourceforge.net>

	* tests/socket.test:  Increased timeout values so that tests have
	time to successfully complete even on slow/busy machines.  [Bug 523470]

	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test:  Revised [tcltest::test] to return errors
	when called with invalid syntax and to accept exactly two arguments
	as documented.  Improved error messages.  [Bug 497446, Patch 513983]
	***POTENTIAL INCOMPATIBILITY***: Incompatible with previous
	tcltest 2.* releases, found only in alpha releases of Tcl 8.4.

2002-04-11  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclNotify.c (TclFinalizeNotifier): remove remaining
	unserviced events on finalization.

	* win/tcl.m4: Enabled COFF as well as CV style debug info with
	--enable-symbols to allow Dr. Watson users to see function info.
	More info on debugging levels can be obtained at:
	http://msdn.microsoft.com/library/en-us/dnvc60/html/gendepdebug.asp

	* tests/ioCmd.test: fixed iocmd-8.15 to have mac and unixPc variants.

	* generic/tclParse.c (Tcl_ParseVar): conditionally incr obj
	refcount to prevent possible mem leak.

2002-04-08  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tcl.h: no <sys/types.h> on mac.
	* mac/tclMacFile.c: minor fixes to Vince's changes from 03-24.
	* mac/tclMacOSA.c:
	* mac/tclMacResource.c: added missing Tcl_UtfToExternalDString
	conversions of resource file names.
	* mac/tclMacSock.c (TcpGetOptionProc): fixed bug introduced
	by Andreas on 02-25; changed strcmp's to strncmp's so that
	option comparison behaves like on other platforms.
	* mac/tcltkMacBuildSupport.sea.hqx (CW Pro6 changes): added
	support to allow Tk to hookup C library stderr/stdout to TkConsole.
	* tests/basic.test:
	* tests/cmdAH.test:
	* tests/encoding.test:
	* tests/fileSystem.test:
	* tests/ioCmd.test: fixed tests failing on mac: check for 
	existence of [exec], changed some result strings.

2002-04-06  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/tclUnixFCmd.c (Realpath): added a little extra code to
	initialize a realpath arg when compiling in PURIFY mode in order
	to prevent spurious purify warnings.  We should really create our
	own realpath implementation, but this will at least quiet purify
	for now.

2002-04-05  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclCmdMZ.c (Tcl_SubstObj):
	* tests/subst.test:  Corrected [subst] so that return codes
	TCL_BREAK and TCL_CONTINUE returned by variable substitution
	have the same effect as when those codes are returned by command
	substitution.  [Bug 536879]

2002-04-03  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/tcltest/tcltest.tcl: added getMatchingFiles back (alias
	to GetMatchingFiles), which was a public function in tcltest 1.0.

2002-04-01  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclEnv.c:
	* generic/tclIOUtil.c: invalidate filesystem cache when the
	user changes env(HOME).  Fixes [Bug #535621].  Also cleaned up
	some of the documentation.
	* tests/fileSystem.test: added test for bug just fixed.
	
2002-04-01  Kevin Kenny  <kennykb@@acm.org>

	* win/tclWinTime.c (Tcl_GetTime): made the checks of clock
	frequency more permissive to cope with the fact that Win98SE
	is observed to return 1.19318 in place of 1.193182 for the
	performance counter frequency.
	
2002-03-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclCmdMZ.c (Tcl_TraceObjCmd, TraceVarProc)
	(TraceCommandProc, TclTraceCommandObjCmd):  corrected
	potential double-free of traces on variables by flagging in
	Trace*Proc that it will free the var in case the eval wants to
	delete the var trace as well. [Bug #536937]
	Also converted Tcl_UntraceVar -> Tcl_UntraceVar2 and Tcl_Eval to
	Tcl_EvalEx in Trace*Proc for slight efficiency improvement.

2002-03-29  Don Porter  <dgp@@users.sourceforge.net>

	* doc/AllowExc.3:
	* generic/tclBasic.c (Tcl_EvalObjv,Tcl_EvalEx,Tcl_EvalObjEx):
	* generic/tclCompile.h (TclCompEvalObj):
	* generic/tclExecute.c (TclCompEvalObj,TclExecuteByteCode):
	* tests/basic.test: Corrected problems with Tcl_AllowExceptions
	having influence over the wrong scope of Tcl_*Eval* calls.  Patch
	from Miguel Sofer.  Report from Jean-Claude Wippler.  [Bug 219181]

2002-03-28  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclVar.c: Refactored CallTraces to collect repeated
	handling of its returned value into CallTraces itself.

2002-03-28  David Gravereaux <davygrvy@@pobox.com>

	* tools/feather.bmp:
	* tools/man2help.tcl:
	* tools/man2help2.tcl:
	* win/makefile.vc: More winhelp target fixups.  Added a feather
	bitmap to the non-scrollable area and changed the color to be
	yellow from a plain white.  The colors can be whatever we want
	them to be, but thought I would start with something bold.
	[Bug 527941]

	* doc/SetVar.3:
	* doc/TraceVar.3:
	* doc/UpVar.3:  .AP macro syntax repair.

2002-03-27  David Gravereaux <davygrvy@@pobox.com>

	* tools/man2help.tcl:
	* win/makefile.vc:  winhelp target now copies all needed files
	from tools/ to a workarea under $(OUT_DIR) and builds it from
	there.  No build cruft is left in tools/ anymore.  All paths
	used in man2help.tcl are now relative to where the script is.
	[Bug 527941]

2002-03-27  David Gravereaux <davygrvy@@pobox.com>

	* win/.cvsignore:
	* win/buildall.vc.bat:
	* win/coffbase.txt:
	* win/makefile.vc:
	* win/nmakehlp.c (new):
	* win/rules.vc:  First draft fix for [Bug 527941].  More changes
	need to done to the makehelp target to get to stop leaving build
	files in the tools/ directory.  This does not address the syntax
	errors in the man files.  Having the contents of tcl.hpj(.in)
	inside makefile.vc allows for version numbers to be replaced with
	macros.
	
	The new nmakehlp.c is built by rules.vc in preprocessing and removes
	the need to use tricky shell syntax that wasn't compatible on Win9x
	systems.  Clean targets made Win9x complient.  This is a first draft
	repair for [Bug 533862].

2002-03-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_EvalEx): passing the correct commandSize
	to TclEvalObjvInternal. [Bug 219362], fix by David Knoll.

2002-03-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_EvalEx):
	* tests/basic.test: avoid exceptional returns at level 0 
	[Bug 219181] 

2002-03-27  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n ([mainThread]):
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test:  Major code cleanup to deal with whitespace,
	coding conventions, and namespace issues, with several minor bugs
	fixed in the process.

	* tests/main.test: Added missing [after cancel]s.

2002-03-25  Don Porter  <dgp@@users.sourceforge.net>

	* tests/main.test: Removed workarounds for Bug 495977.

	* library/tcltest/tcltest.tcl:  Keep the value of $::auto_path
	unchanged, so that the tcltest package can test code that depends
	on auto-loading.  If a testing application needs $::auto_path pruned,
	it should do that itself.  [Bug 495726]
	Improve the processing of the -constraints option to [test] so that
	constraint lists can have arbitrary whitespace, and non-lists don't
	blow things up.  [Bug 495977]
	Corrected faulty variable initialization. [Bug 534845]

2002-03-25  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/CrtTrace.3: small doc correction
	* generic/tclBasic.c (Tcl_DeleteTrace): Allow NULL callback on
	trace deletions [Bug 534728] (Hemang Lavana).

2002-03-24  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_EvalObjv): replaced obscure, incorrect
	code as described in [Bug 533907] (Don Porter).

2002-03-24  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:  Use [interpreter] to set/query the
	executable currently running the tcltest package.  [Bug 454050]

	* library/tcltest/tcltest.tcl:  Allow non-proc commands to be used
	as the customization hooks.  [Bug 495662]

2002-03-24  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFilename.c:
	* generic/tclFCmd.c:
	* generic/tclTest.c:
	* generic/tcl.h:
	* generic/tclIOUtil.c:
	* win/tclWinFile.c:
	* win/tclWinFCmd.c:
	* win/tclWinPipe.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixFCmd.c:
	* mac/tclMacFile.c:
	* doc/FileSystem.3:
	* doc/file.n:
	* tests/cmdAH.test:
	* tests/fileName.test:
	* tests/fileSystem.test: (new file)	
	* tests/winFCmd.test: fix [Bug 511666] and [Bug 511658],
	and improved documentation of some aspects of the filesystem,
	particularly 'Tcl_FSMatchInDirectory' which now might match
	a single file/directory only, and 'file normalize' which
	wasn't very clear before.  Removed inconsistency betweens
	docs and the Tcl_Filesystem structure.  Also fixed 
	[Bug 523217] and corrected file normalization on Unix so that 
	it expands symbolic links.  Added some new tests of the 
	filesystem code (in the new file 'fileSystem.test'), and 
	some extra tests for correct handling of symbolic links.
	Fix to [Bug 530960] which shows up on Win98.  Made comparison
	with ".com" case insensitive in tclWinPipe.c
	
	***POTENTIAL INCOMPATIBILITY***: But only between alpha
	releases (users of the new Tcl_Filesystem lookup table in Tcl
	8.4a4 need to handle the new way in which Tcl may call
	Tcl_FSMatchInDirectory, and 'file normalize' on unix now
	behaves correctly).  Only known impact is with the 'tclvfs'
	extension.

2002-03-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/basic.test (basic-46.1): adding test for [Bug 533758],
	fixed earlier today.
	
2002-03-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinInt.h: moved undef of TCL_STORAGE_CLASS. [Bug #478579]

2002-03-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_EvalObjEx):
	* generic/tclExecute.c (TclCompEvalObj): fixed the errorInfo for
	return codes other than (TCL_OK, TCL_ERROR) to runLevel 0 
	[Bug 533758]. Removed the static RecordTracebackInfo(), as its
	functionality is easily replicated by Tcl_LogCommandInfo. Bug
	and redundancy noted by Don Porter.

2002-03-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/expr.n: Improved documentation for ceil and floor [Bug 530535]

2002-03-20  Don Porter  <dgp@@users.sourceforge.net>

	* doc/SetVar.3:
	* doc/TraceVar.3:
	* doc/UpVar.3:
	* generic/tcl.h (Tcl_VarTraceProc):
	* generic/tcl.decls (Tcl_GetVar2, Tcl_SetVar2, Tcl_TraceVar2,
	  Tcl_UnsetVar2, Tcl_UntraceVar2, Tcl_UpVar2, Tcl_VarTraceInfo2,
	  Tcl_GetVar2Ex, TclSetVar2Ex):
	* generic/tclCmdMZ.c (TraceVarProc):
	* generic/tclEnv.c (EnvTraceProc):
	* generic/tclEvent.c (VwaitVarProc):
	* generic/tclInt.decls (TclLookupVar,TclPrecTraceProc):
	* generic/tclLink.c (LinkTraceProc):
	* generic/tclUtil.c (TclPrecTraceProc):
	* generic/tclVar.c (CallTraces, MakeUpvar, VarErrMsg, TclLookupVar,
	  Tcl_GetVar2, Tcl_SetVar2, Tcl_TraceVar2, Tcl_UnsetVar2,
	  Tcl_UntraceVar2, Tcl_UpVar2, Tcl_VarTraceInfo2, Tcl_GetVar2Ex,
	  TclSetVar2Ex): Updated interfaces of generic/tclVar.c according
	to TIP 27.  In particular, the "part2" arguments were CONSTified.
	[Patch 532642]
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs

2002-03-15  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/compile.test (compile-12.3): Test to detect bug 530320.
	* generic/tclCompile.c (TclCompileTokens): Fixed buffer overrun
	reported in bug 530320.

2002-03-14  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/configure: Regen.
	* win/configure.in: Add configure time test for SEH
	support in the compiler.
	* win/tclWin32Dll.c (ESP, EBP, TclpCheckStackSpace,
	_except_checkstackspace_handler):
	* win/tclWinChan.c (ESP, EBP, Tcl_MakeFileChannel,
	_except_makefilechannel_handler):
	* win/tclWinFCmd.c (ESP, EBP, DoRenameFile,
	_except_dorenamefile_handler,
	DoCopyFile, _except_docopyfile_handler):
	Implement SEH support under gcc using inline asm.
	Tcl and Tk should now compile with Mingw 1.1. [Patch 525746]

2002-03-14  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile): Handle
	an SEH exception with EXCEPTION_EXECUTE_HANDLER instead
	of restarting the faulting instruction with
	EXCEPTION_CONTINUE_EXECUTION. Bug 466102 provides an
	example of how restarting could send Tcl into an
	infinite loop. [Patch 525746]

2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile, DoDeleteFile,
	DoRemoveJustDirectory): Make sure we don't pass NULL or ""
	as a path name to Win32 API functions since this was
	crashing under Windows 98.

2002-03-11  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:
	* library/tcltest/pkgIndex.tcl: Bumped tcltest package to 2.0.2.

2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl (getMatchingFiles): Pass
	a proper list to foreach to avoid munging a Windows
	patch like D:\Foo\Bar into D:FooBar before the glob.

2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tclEncoding.c: Fix typo in comment.
	* generic/tclIO.c (DoReadChars, ReadBytes, ReadChars):
	Use NULL value instead of pointer set to NULL to make
	things more clear. Reorder arguments so that they
	match the function signatures. Cleanup little typos
	and add more descriptive comment.

2002-03-08  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/README: Update to indicate that Mingw 1.1 is
	required to build Tcl. Add section describing new
	msys based build process. Update Cygwin build
	instructions so users know where to find Mingw 1.1.

2002-03-08  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinFCmd.c (DoCopyFile): correctly set retval to TCL_OK.

2002-03-07  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/tclWin32Dll.c (TclpCheckStackSpace):
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile): Replace
	hard coded constants with Win32 symbolic names.
	Move control flow statements out of __try blocks
	since the documentation indicates it is frowned upon.

2002-03-07  Don Porter  <dgp@@users.sourceforge.net>

	* doc/interp.n:
	* generic/tclInterp.c(Tcl_InterpObjCmd,SlaveObjCmd,SlaveRecursionLimit):
	* generic/tclTest.c:
	* tests/interp.test: Added the [interp recursionlimit] command to
	set/query the recursion limit of an interpreter.  Proposal and
	implementation from Stephen Trier. [TIP 87, Patch 522849]

2002-03-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tcl.h, tools/tcl.wse.in, unix/configure.in,
	* unix/tcl.spec, win/README.binary, win/configure.in, README:
	Bumped patchlevel; this might need to change in the future, but it
	will help us distinguish between the CVS version and the most
	recent released version.

2002-03-06  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInt.h: for unshared objects, TclDecrRefCount now
	frees the internal rep before the string rep - just like the
	non-macro Tcl_DecrRefCount/TclFreeObj [Bug 524802]. 

2002-03-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/lsearch.n: Documentation of new features, plus examples.
	* tests/lsearch.test: Tests of new features.
	* generic/tclCmdIL.c (Tcl_LsearchObjCmd): TIP#80 support.  See
	http://purl.org/tcl/tip/80 for details.

2002-03-05  Jeff Hobbs  <jeffh@@ActiveState.com>

	*** 8.4a4 TAGGED FOR RELEASE ***

	* unix/tclUnixChan.c: initial remedy for [Bug #525783] flush
	problem introduced by TIP #35.  This may not satisfy true serial
	channels, but it restores the correct flushing of std* channels on
	exit.

	* unix/README: added --enable-langinfo doc.

	* unix/tcl.spec:
	* tools/tcl.wse.in: fixed URL refs to use www.tcl.tk or SF.

2002-03-04  Jeff Hobbs  <jeffh@@ActiveState.com>

	* README:
	* mac/README:
	* unix/Makefile.in:
	* unix/README:
	* win/README:
	* win/README.binary: updated to use www.tcl.tk URL.

	* unix/Makefile.in: added older ChangeLogs to dist target.

	* tests/io.test:
	* tests/encoding.test: corrected iso2022 encoding results.
	added encoding-24.*
	* generic/tclEncoding.c (EscapeFromUtfProc): corrected output of
	escape codes as per RFC 1468. [Patch #474358] (taguchi)
	(TclFinalizeEncodingSubsystem): corrected potential double-free
	when encodings were finalized on exit. [Bug #219314, #524674]

2002-03-01  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/encoding/iso2022-jp.enc: 
	* library/encoding/iso2022.enc: 
	* tools/encoding/iso2022-jp.esc:
	* tools/encoding/iso2022.esc: gave <ESC>$B precedence over <ESC>$@@,
	based on comments (point 1) in [Bug #219283] (rfc 1468)

	* tests/encoding.test: added encoding-23.* tests
	* generic/tclIO.c (FilterInputBytes): reset the TCL_ENCODING_START
	flags in the ChannelState when using 'gets'. [Bug #523988]
	Also reduced the value of ENCODING_LINESIZE from 30 to 20 as this
	seems to improve the performance of 'gets' according to tclbench.

2002-02-28  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclCmdMZ.c (TraceCommandProc): ensure that TraceCommandInfo
	structure was also deleted when a command was deleted to prevent a
	mem leak.

	* generic/tclBasic.c (Tcl_CreateObjTrace): set tracePtr->flags
	correctly.

	* generic/tclTimer.c (TimerExitProc): remove remaining events in
	tls on thread exit.

2002-02-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclNamesp.c: allow cached fully-qualified namespace
	names to be usable from different namespaces within the same
	interpreter without forcing a new lookup [Patch 458872]. 

2002-02-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: Replaced a few direct stack accesses 
	with the POP_OBJECT() macro [Bug 507181] (Don Porter).

2002-02-27  Don Porter  <dgp@@users.sourceforge.net>

	* doc/GetIndex.3:
	* generic/tcl.decls (Tcl_GetIndexFromObjStruct):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObjStruct):  Revised the
	prototype of the Tcl_GetIndexFromObjStruct to take its struct
	table as a (CONST VOID *) argument, better describing what it is,
	maintaining source compatibility, and adding CONST correctness
	according to TIP 27.  Thanks to Joe English for an elegant
	solution. [Bug 520304]

	* generic/tclDecls.h: make genstubs

	* generic/tclMain.c (Tcl_Main,StdinProc):  Corrected some reference
	count management errors on the interactive command Tcl_Obj found by
	Purify.  Thanks to Jeff Hobbs for the report and assistance.

2002-02-27  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclBasic.c (Tcl_EvalTokensStandard): corrected mem leak
	in error case.

	* generic/tclTest.c (TestStatProc[123]): correct harmless UMRs.

	* generic/tclLink.c (Tcl_LinkVar): correct mem leak in error case.

2002-02-27  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tests/socket.test (2.7): Accepted and applied patch for Tcl SF
	  bug #523470 provided by Don Porter <dgp@@users.sourceforge.net>
	  to avoid timing problems in that test.

	* unix/tclUnixChan.c (TclpOpenFileChannel): Added code to regonize
	  "/dev/tty" (by name) and to not handle it as tty / serial
	  line. This is the controlling terminal and is special. Setting
	  it into raw mode as is done for other tty's is a bad idea. This
	  is a hackish fix for expect SGF Bug #520624. The fix has
	  limitation: Tcl_MakeFileChannel handles tty's specially too, but
	  is unable to recognize /dev/tty as it only gets a file
	  descriptor, and no name for it.

2002-02-26  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclCmdAH.c (StoreStatData): corrected mem leak.

	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): prevent obj leak in
	  remedial regsub case.

	* generic/tclFileName.c (Tcl_TranslateFileName): decr refcount for
	  error case to prevent mem leak.

	* generic/tclVar.c (Tcl_ArrayObjCmd): removed extra obj allocation.

	* unix/tclUnixSock.c (Tcl_GetHostName): added an extra
	  gethostbyname check to guard against failure with truncated
	  names returned by uname.

	* unix/configure:
	* unix/tcl.m4 (SC_SERIAL_PORT): added sys/modem.h check and defined
	  _XOPEN_SOURCE_EXTENDED for HP-11 to get updated header decls.

	* unix/tclUnixChan.c: added Unix implementation of TIP #35, serial
	  port support. [Patch #438509] (schroedter)

2002-02-26  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCmpCmds.c: (bugfix to the bugfix, hopefully the last)
	  Bugfix to the new [for] compiling code: was setting a
	  exceptArray parameter using another param which wasn't yet
	  initialised, thus filling it with noise.

2002-02-25  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* mac/tclMacSock.c (TcpGetOptionProc): Changed to recognize the
	  option "-error". Essentially ignores the option, always
	  returning an empty string.

2002-02-25  Jeff Hobbs  <jeffh@@ActiveState.com>

	* doc/Alloc.3:
	* doc/LinkVar.3:
	* doc/ObjectType.3:
	* doc/PkgRequire.3:
	* doc/Preserve.3:
	* doc/TCL_MEM_DEBUG.3: Updated documentation to describe the ckalloc,
	ckfree, ckrealloc, attemptckalloc, and attemptckrealloc macros, and
	to accurately describe when and how they are used. [Bug #497459] (dgp)

	* generic/tclHash.c (AllocArrayEntry, AllocStringEntry):
	Before invoking ckalloc when creating a Tcl_HashEntry,
	check that the amount of memory being allocated is
	at least as large as sizeof(Tcl_HashEntry). The previous
	code was allocating memory regions that were one
	or two bytes short. [Bug #521950] (dejong)

2002-02-25  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_EvalEx): avoiding a buffer overrun
	reported by Joe English, and restoring tcl7.6 behaviour for
	[subst]: badly terminated nested scripts will raise an error
	and not be evaluated. [Bug #495207]

2002-02-25  Don Porter  <dgp@@users.sourceforge.net>

	* unix/tclUnixPort.h: corrected strtoll prototype mismatch on Tru64.
	* compat/strtod.c (strtod): simplified #includes
	* compat/strtol.c (strtol): gather result in a long before returning
	as a long: necessary on platforms where sizeof(int) != sizeof(long).

2002-02-25  Daniel Steffen  <das@@users.sourceforge.net>

	* unix/tclLoadDyld.c: updated to use Mac OS X 10.1 dyld APIs that
	have more libdl-like semantics. (bug #514392)

2002-02-25  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompCmds: fixing a bug in patch dated 2002-02-22, in
	the code for [for] and [while]. Under certain conditions, for long
	bodies, the exception range parameters were badly computed. Tests
	forthcoming: I still can't reproduce the conditions in the
	testsuite (!), although the bug (with assorted segfault or panic!)
	can be triggered from the console or with the new parse.bench in  
	tclbench.
	
2002-02-25  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* compat/strtoul.c, compat/strtol.c, compat/strtod.c: Added UCHAR,
	CONST and #includes to clean up GCC output.

2002-02-23  Don Porter  <dgp@@users.sourceforge.net>

	* compat/strtoull.c (strtoull):
	* compat/strtoll.c (strtoll):
	* compat/strtoul.c (strtoul): Fixed failure to handle leading
	sign symbols '+' and '-' and '0X' and raise overflow errors.
	[Bug 440916]  Also corrects prototype and errno problems.

2002-02-23  Mo DeJong  <mdejong@@users.sourceforge.net>

	* configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Link with -n32
	instead of -32 when building on IRIX64-6.* system.
	[Tcl bug 521707]

2002-02-22  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclInt.h:
	* generic/tclObj.c: renamed global variable emptyString ->
	tclEmptyString because it is no longer static.
	* generic/tclPkg.c: Fix for panic when library is loaded on a
	platform without backlinking without proper use of stubs. [Bug 476537]

2002-02-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/regexpComp.test: updated regexp-11.[1-4] to match changes
	in regexp.test for new regsub syntax

	* unix/configure:
	* unix/tcl.m4: added --enable-64bit support for AIX-4 (using -q64
	flag) when using IBM's xlc compiler.

	* tests/safe.test: updated safe-8.5 and safe-8.7
	* library/safe.tcl (CheckFileName): removed the limit on
	sourceable file names (was only *.tcl or tclIndex files with no
	more than one dot and 14 chars).  There is enough internal
	protection in a safe interpreter already.  Fixes [Tk Bug #521560].

2002-02-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompCmds: [FR 465811]. Optimising [if], [for] and
	[while] for constant conditions; in addition, [for] and [while]
	are now compiled with the "loop rotation" optimisation (thanks to
	Kevin Kenny). 

2002-02-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	--- TIP#76 CHANGES ---
	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): Final-argument-less
	[regsub] returns the modified string.
	* doc/regsub.n: Updated docs.
	* tests/regexp.test: Updated and added tests.

	* compat/strtoll.c (strtoll): 
	* compat/strtoull.c (strtoull): 
	* unix/tclUnixPort.h:
	* win/tclWinPort.h: Const-ing 64-bit compatability declarations.
	Note that the return pointer is non-const because it is entirely
	legal for the functions to be called from somewhere that owns the
	string being passed.  Fixes problem reported by Larry Virden.

2002-02-21  David Gravereaux <davygrvy@@pobox.com>

	* win/mkd.bat (removed):
	* win/coffbase.txt (new):
	* win/makefile.bc:
	* win/makefile.vc:  Changed the 'setup' target to stop using
	the mkd.bat file and just make the directory right in the rule.
	Same change to makefile.bc.  configure.in nor Makefile.in use
	it.

	coffbase.txt will be the master list for our "prefered base
	addresses" set by the linker.  This should improve load-time
	(NT only) by avoiding relocations.  Submissions to the list
	by extension authors are encouraged.

	Added a 'tidy' target to compliment 'clean' and 'hose' to remove
	just the outputs. Also removed the $(winlibs) macro as it wasn't
	being used.

	Stuff left to do:
	1) get the winhelp target to stop building in the tools/
	directory.
	2) stop using rmd.bat
	3) add more dependacy rules.

	* win/tclAppInit.c:  Reverted back to -r1.6, as the header file
	change to tclPort.h won't allow for easy embedded support
	outside of the source dist.  Thanks to Don Porter for pointing
	this out to me.

2002-02-21  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.vc:
	* win/rules.vc:  Added a new "loimpact" option that sets the
	-ws:aggressive linker option.  Off by default.  It's said to
	keep the heap use low at the expense of alloc speed.

	* win/tclAppInit.c: Changed #include "tcl.h" to be tclPort.h to
	remove the raw windows.h include.  tclPort.h brings in windows.h
	already and lessens the pre-compiled-header mush and the randomly
	useless	#pragma comment (lib,...) references throughout the big
	windows.h tree (as observed at high linker warning levels).

2002-02-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tcl.h: Better guessing of LP64/ILP32 architecture, but
	now sensitive to presence of (suitable) <limits.h>

2002-02-20  Don Porter <dgp@@users.sourceforge.net>

	* generic/tcl.decls (Tcl_RegExpRange,Tcl_GetIndexFromObjStruct):
	Overlooked a few source incompatibilities.  Now using CONST84.
	* generic/tclDecls.h: make genstubs
	* generic/tcl.h (Tcl_CmdObjTraceProc): silence warning from Sun
	Workshop compiler.

2002-02-20  David Gravereaux <davygrvy@@pobox.com>

	* win/buildall.vc.bat:
	* win/makefile.vc:
	* win/rules.vc: General clean-ups.  Added compiler and linker tests
	for a) the pentium 0x0F errata, b) optimizing (not all have this),
	and c) linker v6 section alignment confusion.  All these are tested
	first to make sure any D4002 or LNK1117 warnings aren't displayed.
	The pentium 0x0F errata is a recommended switch.  The v5 linker's
	section alignment default is 512, but the v6 linker was changed
	to 4096 in an attempt to speed loading on Win98.  I changed the
	default to always be 512 across both linkers, unless linking
	statically, then 4096 is used for the claimed speed effect. Using
	a 512 alignment saves 12k bytes of dead space in the DLL.

	Added IA64 B-stepping errata switch when the compiler supports it.

	Added profiling to $(lflags) when requested and also removed the
	explict -entry option as the default works fine as is.

	Removed win/tclWinInit.c from the special case section to let it
	use the common implicit rule as the $(EXTFLAGS) macro it had was
	never referenced anywhere.

2002-02-20  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tcl.h: Added code to guess the correct settings for
	TCL_WIDE_INT_IS_LONG and TCL_WIDE_INT_TYPE when configure doesn't
	tell us them, as can happen with extensions.

2002-02-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/format.n: Updated docs to list the specification.
	* generic/tclCmdAH.c (Tcl_FormatObjCmd): Made behaviour on 64-bit
	platforms correctly meet the specification, that %d works with the
	native word-sized integer, instead of trying to guess (wrongly)
	from the value being passed.

2002-02-19  Don Porter <dgp@@users.sourceforge.net>

	* changes: First draft of updated changes for 8.4a4 release.

2002-02-15  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/tclUnixPort.h: add strtoll/strtoull declarations for
	platforms that do not define them.

	* generic/tclIndexObj.c (STRING_AT): removed ptrdiff_t cast and
	use of VOID* in default case (GNU-ism).

2002-02-15  Kevin Kenny  <kennykb@@acm.org>

	* compat/strtoll.c:
	* compat/strtoul.c:
	* compat/strtoull.c:
	* generic/tclIOUtil.c:
	* generic/tclPosixStr.c:
	* generic/tclTest.c:
	* generic/tclTestObj.c:
	* tests/get.test:
	* win/Makefile.vc: Further tweaks to the TIP 72 patch to make it
	compile under VC++.
	
2002-02-15  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tclExecute.c:
	* tclIOGT.c:
	* tclIndexObj.c: Touchups to the TIP 72 patch to make it
	  compileable under Windows again. The changes are not complete,
	  there is one nasty regarding _stati64

2002-02-15  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	+----------------------+
	| TIP #72 IMPLEMENTED. |
	+----------------------+

	There are a lot of changes from this TIP, so please see
	http://purl.org/tcl/tip/72.html for discussion of
	backward-compatability issues, but the main ones modifications are
	in:

	* generic/tcl.h: New types.
	* generic/tcl.decls: New public functions.
	* generic/tclExecute.c: 64-bit aware bytecode engine.
	* generic/tclBinary.c: 64-bit handling in [binary] command.
	* generic/tclScan.c: 64-bit handling in [scan] command.
	* generic/tclCmdAH.c: 64-bit handling in [file] and [format]
	commands.
	* generic/tclBasic.c: New "wordSize" entry in ::tcl_platform.
	* generic/tclFCmd.c: Large-file support (with many consequences.)
	* generic/tclIO.c: Large-file support (with many consequences.)
	* compat/strtoll.c, compat/strtoull.c: New support functions.
	* unix/tcl.m4, unix/configure: 64-bit support and greatly enhanced
	cacheing.

	Most other changes, including all those in doc/* and test/* as
	well as the majority in the platform directories, follow on from
	these.

	Also coming out of the woodwork:
	* generic/tclIndex.c: Better support for Cray PVP.
	* win/tclWinMtherr.c: Better Borland support.

	Note that, in a number of places through the Unix part of the
	platform support, there are Tcl_Platform* references.  These are
	expanded into the correct way to call that particular underlying
	function, i.e. with or without a '64' suffix, and should be used
	by people working on the core in preference to the API functions
	they overlay so that the code remains portable depending on the
	presence or absence of 64-bit support on the underlying platform.

	***POTENTIAL INCOMPATIBILITY***: Extracted from the TIP

	SUMMARY OF INCOMPATIBILITIES AND FIXES 
	======================================

	The behaviour of expressions containing constants that appear
	positive but which have a negative internal representation will
	change, as these will now usually be interpreted as wide
	integers. This is always fixable by replacing the constant with
	int(constant).

	Extensions creating new channel types will need to be altered as
	different types are now in use in those areas. The change to the
	declaration of Tcl_FSStat and Tcl_FSLstat (which are the new
	preferred API in any case) are less serious as no non-alpha
	releases have been made yet with those API functions.

	Scripts that are lax about the use of the l modifier in format and
	scan will probably need to be rewritten. This should be very
	uncommon though as previously it had absolutely no effect.

	Extensions that create new math functions that take more than one
	argument will need to be recompiled (the size of Tcl_Value
	changes), and functions that accept arguments of any type
	(TCL_EITHER) will need to be rewritten to handle wide integer
	values. (I do not expect this to affect many extensions at all.)

2002-02-14  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIOCmd.c (Tcl_GetsObjCmd): Trivial fix for bug
	  #517503, a memory leak reported by Miguel Sofer
	  <msofer@@users.sourceforge.net>. The leak happens if an error
	  occurs for "set var [gets $chan]" and leak one empty object.

2002-02-12  David Gravereaux <davygrvy@@pobox.com>

	* djgpp/ (new directory)
	* djgpp/Makefile (new):
	* unix/tclAppInit.c:
	* unix/tclMtherr.c:
	* unix/tclUnixFCmd.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixInit.c:
	* unix/tclUnixPort.h:  Early stage of DJGPP support for building
	Tcl on DOS.  Dynamic loading isn't working, yet.  Requires watt32
	for the TCP/IP stack.  No autoconf, yet.  Barely tested, but
	makes a working exe that runs Tcl in protected-mode, flat memory.
	[exec] and pipes will need the most work as multi-tasking on DOS
	has to be carefully.

2002-02-10  Kevin Kenny  <kennykb@@acm.org>

	* doc/CrtObjCmd.3:
	* doc/CrtTrace.3:
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclBasic.c:
	* generic/tclInt.h:
	* generic/tclTest.c:
	* tests/basic.test: Added Tcl_CreateObjTrace,
	Tcl_GetCommandInfoFromToken and Tcl_SetCommandInfoFromToken.
	(TIPs #32 and #79.)

	* generic/tclDecls.h:
	* generic/tclStubInit.c: Regenerated Stubs tables.
	
2002-02-08  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure:
	* unix/tcl.m4: added -pthread for FreeBSD to EXTRA_CFLAGS and
	LDFLAGS.  Also triggered nodots only for FreeBSD-3.
	Added AC_DEFINE(_POSIX_PTHREAD_SEMANTICS) for Solaris.

	* unix/tclUnixPort.h:
	* unix/tclUnixThrd.c: added thread-safe versions of readdir,
	localtime, gmtime and inet_ntoa for threaded build. (jgdavidson)

	* generic/tclScan.c (Tcl_ScanObjCmd): prevented ckfree being
	called on a pointer to NULL.

2002-02-07  Don Porter <dgp@@users.sourceforge.net>

	* doc/DString.3:
	* doc/Encoding.3:
	* doc/GetCwd.3:
	* doc/SplitPath.3:
	* doc/Translate.3:
	* doc/Utf.3:
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclEncoding.c:
	* generic/tclEnv.c:
	* generic/tclFileName.c:
	* generic/tclIOUtil.c:
	* generic/tclUtf.c:
	* generic/tclUtil.c:
	* mac/tclMacInit.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixInit.c:
	* unix/tclUnixPipe.c:
	* win/tclWin32Dll.c:
	* win/tclWinFCmd.c:
	* win/tclWinFile.c:
	* win/tclWinInit.c: Partial TIP 27 rollback.  Following routines
	restored to return (char *): Tcl_DStringAppend,
	Tcl_DStringAppendElement, Tcl_JoinPath, Tcl_TranslateFileName,
	Tcl_ExternalToUtfDString, Tcl_UtfToExternalDString,
	Tcl_UniCharToUtfDString, Tcl_GetCwd, Tcl_WinTCharToUtf.  Also
	restored Tcl_WinUtfToTChar to return (TCHAR *) and 
	Tcl_UtfToUniCharDString to return (Tcl_UniChar *).  Modified
	some callers.  This change recognizes that Tcl_DStrings are
	de-facto white-box objects.

	* generic/tclDecls.h:
	* generic/tclPlatDecls.h: make genstubs

	* generic/tclCmdMZ.c: corrected use of C++-style comment.

2002-02-06  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/scan.test:
	* generic/tclScan.c (Tcl_ScanObjCmd): corrected scan 0x... %x
	handling that didn't accept the 0x as a prelude to a base 16
	number.  [Bug #495213]

	* generic/tclCompCmds.c (TclCompileRegexpCmd): made early check
	for bad RE to stop checking further.

	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): added special case to
	search for simple 'string map' style regsub calls.
	Delayed creation of resultPtr object until an initial match is
	made, as the input string object can then be reused for no matches.
	(Tcl_StringObjCmd): optimization improvements to the STR_MAP
	algorithm for zero-length and nocase cases.

	* tests/regexp.test:
	* tests/regexpComp.test: extra code coverage tests.

	* tests/string.test: added 10.18 and 10.19 extra tests.

	* generic/regc_locale.c (casecmp): slight performance improvement.

2002-02-05  Don Porter <dgp@@users.sourceforge.net>

	* library/http/http.tcl:
	* library/http/pkgIndex.tcl:  Corrected use of http::error when
	::error was intended.  Bump to http 2.4.2.

2002-02-04  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* unix/tclUnixChan.c (FileOutputProc): Fixed [bug 465765] reported
	  by Dale Talcott <daletalcott@@users.sourceforge.net>. Avoid
	  writing nothing into a file as STREAM based implementations will
	  consider this a EOF (if the file is a pipe). Not done in the
	  generic layer as this type of writing is actually useful to
	  check the state of a socket.

	* doc/open.n: Fixed [Bug 511540], added cross-reference to 'pid'
	  as the command to use to retrieve the pid of a command pipeline
	  created via 'open'.

2002-02-01  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): handle quirky about case
	earlier to avoid shimmering problem.

2002-02-01  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tests/io.test: io-39.22 split into two tests, one platform
	  dependent, the other not. -eofchar is not empty on the windows
	  platform.

2002-02-01  Vince Darley <vincentdarley@@users.sourceforge.net>

	* generic/tclTest.c: fix to picky windows compiler problem
	  with the 'MainLoop' function declaration.

2002-01-31  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* win/tclWinFCmd.c: TIP 27: Applied patch fixing CONST warnings on
	  behalf of Don Porter <dgp@@users.sourceforge.net>.

2002-01-30  Don Porter <dgp@@users.sourceforge.net>

	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclInt.h: For each interface identified in the TIP 27
	  changes below as a POTENTIAL INCOMPATIBILITY, the source of the
	  incompatibility has been parameterized so that it can be
	  removed.  When compiling extension code against the Tcl header
	  files, use the compiler flag -DUSE_NON_CONST to remove the
	  irresolvable source incompatibilities introduced by the TIP 27
	  changes.  Resolvable changes are left for extension authors to
	  resolve.
	* generic/tclDecls.h: make genstubs

2002-01-30  Vince Darley <vincentdarley@@users.sourceforge.net>

	* doc/FileSystem.3: added documentation for 3 public
	functions which had been overlooked.  Fixes [Bug 507701].
	* unix/mkLinks: make mklinks

2002-01-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/regexpComp.test:
	* generic/tclCompCmds.c (TclCompileRegexpCmd): enhanced to support
	-nocase and -- options.

2002-01-28  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tcl.m4 (SC_LOAD_TCLCONFIG):
	* win/tcl.m4 (SC_LOAD_TCLCONFIG): Set TCL_LIB_SPEC,
	TCL_STUB_LIB_SPEC, and TCL_STUB_LIB_PATH to the
	values of TCL_BUILD_LIB_SPEC, TCL_BUILD_STUB_LIB_SPEC,
	and TCL_BUILD_STUB_LIB_PATH when tclConfig.sh is loaded
	from the build directory. A Tcl extension should
	make use of the non-build versions of these variables
	since they will work in both cases. This modification
	was described in TIP 34.

2002-01-28  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinReg.c (regConnectRegistryProc,RecursiveDeleteKey)
	(DeleteKey,GetKeyNames,GetType,GetValue,OpenSubKey,SetValue):
	redid the CONSTification as previous changes caused failing tests.

	* tests/regexpComp.test (new):
	* generic/tclInt.h:
	* generic/tclBasic.c: added TclCompileRegexpCmd entry
	* generic/tclCompCmds.c (TclCompileStringCmd): corrected to return
	TCL_OUT_LINE_COMPILE instead of TCL_ERROR for parsing errors, so
	it only throws the error for runtime compile, in case the user
	modifies 'string'.
	(TclCompileRegexpCmd): first try at a byte-compiled regexp
	command.  It handles static strings and ^$ bounded static strings.
	(TclCompileAppendCmd): made TclPushVarName call always use
	TCL_CREATE_VAR as numWords is always > 2 at that point.

	* generic/tclExecute.c (TclExecuteByteCode:INST_LIST): correct
	possibly dangerous decr in macro call.

	* win/tclWinInit.c (TclpFindVariable): CONSTification touch-up

	* win/tclWinReg.c (OpenSubKey): corrected bug introduced in
	CONSTification that dropped pointer reference.

	* ChangeLog.2000 (new file):
	* ChangeLog: broke changes from 2000 into ChangeLog.2000 to reduce
	  size of the main ChangeLog.

2002-01-28  David Gravereaux <davygrvy@@pobox.com>

	* generic/tclPlatDecls.h:  Added preprocessor logic to force a
	typedef of TCHAR when __STDC__ is defined when using the uncommon
	-Za compiler switch with the microsoft compiler.

2002-01-27  Don Porter <dgp@@users.sourceforge.net>

	* doc/package.n: Documented global namespace context for script
	evaluation by [package require].

2002-01-27  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* mac/tclMacChan.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacInit.c:
	* mac/tclMacLoad.c:
	* mac/tclMacResource.c:
	* mac/tclMacSock.c: TIP 27 CONSTification induced changes

	* tests/event.test:
	* tests/main.test: added catches/constraints to test that
	use features that don't exist on the mac.

2002-01-25  Mo DeJong  <mdejong@@users.sourceforge.net>

	Make -eofchar and -translation options read only for
	server sockets. [Bug 496733]
	
	* generic/tclIO.c (Tcl_GetChannelOption, Tcl_SetChannelOption):
	Instead of returning nothing for the -translation option
	on a server socket, always return "auto". Return the empty
	string enclosed in quotes for the -eofchar option on
	a server socket. Fixup -eofchar usage message so that
	it matches the implementation.
	* tests/io.test: Add -eofchar tests and -translation tests
	to ensure options are read only on server sockets.
	* tests/socket.test: Update tests to account for -eofchar
	and -translation option changes.

2002-01-25  Don Porter <dgp@@users.sourceforge.net>

	* compat/strstr.c (strstr):
	* generic/tclCmdAH.c (Tcl_FormatObjCmd):
	* generic/tclCmdIL.c (InfoNameOfExecutableCmd):
	* generic/tclEnv.c (ReplaceString):
	* generic/tclFileName.c (ExtractWinRoot):
	* generic/tclIO.c (FlushChannel,Tcl_BadChannelOption):
	* generic/tclStringObj.c (AppendUnicodeToUtfRep):
	* generic/tclThreadTest.c (TclCreateThread):
	* generic/tclUtf.c (Tcl_UtfPrev):
	* mac/tclMacFCmd.c (TclpObjListVolumes):
	* mac/tclMacResource.c (TclMacRegisterResourceFork,
	  BuildResourceForkList):
	* win/tclWinInit.c (AppendEnvironment):  Sought out and eliminated
	instances of CONST-casting that are no longer needed after the
	TIP 27 effort.

	* Following is [Patch 501006]
	* generic/tclInt.decls (Tcl_AddInterpResolvers, Tcl_Export,
	  Tcl_FindNamespace, Tcl_GetInterpResolvers, Tcl_ForgetImport,
	  Tcl_Import, Tcl_RemoveInterpResolvers):
	* generic/tclNamesp.c (Tcl_Export, Tcl_Import, Tcl_ForgetImport,
	  Tcl_FindNamespace):
	* generic/tclResolve.c (Tcl_AddInterpResolvers,Tcl_GetInterpResolvers,
	  Tcl_RemoveInterpResolvers): Updated APIs in generic/tclResolve.c
	and generic/tclNamesp.c according to the guidelines of TIP 27.
	* generic/tclIntDecls.h: make genstubs

	* Following is [Patch 505630]
	* doc/AddErrorInfo.3:
	* generic/tcl.decls (Tcl_LogCommandInfo):
	* generic/tclBasic.c (Tcl_LogCommandInfo): Updated interfaces
	of generic/tclBasic.cc according to TIP 27.
	* generic/tclDecls.h: make genstubs

	* Following is [Patch 506818]
	* doc/Hash.3:
	* generic/tcl.decls (Tcl_HashStats):
	* generic/tclHash.c (Tcl_HashStats):  Updated APIs of generic/tclHash.c
	according to guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs
	* generic/tclVar.c (Tcl_ArrayObjCmd): Updated callers.

	* Following is [Patch 506807]
	* doc/ObjectType.3:
	* generic/tcl.decls (Tcl_GetObjType):
	* generic/tclObj.c (Tcl_GetObjType): Updated APIs of generic/tclObj.c
	according to guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs

	* Following is [Patch 507304]
	* doc/Encoding.3:
	* generic/tcl.decls (Tcl_WinUtfToTChar,Tcl_WinTCharToUtf):
	* win/tclWin32Dll.c (Tcl_WinUtfToTChar,Tcl_WinTCharToUtf):
	Updated interfaces in win/tclWin32Dll.c according to TIP 27.
	* generic/tclPlatDecls.h: make genstubs
	* generic/tclIOUtil.c (TclpNativeToNormalized):
	* win/tclWinFCmd.c (TclpObjNormalizePath):
	* win/tclWinFile.c (TclpFindExecutable,TclpMatchInDirectory,
	  NativeIsExec,NativeStat):
	* win/tclWinLoad.c (TclpLoadFile):
	* win/tclWinPipe.c (TclpOpenFile,ApplicationType):
	* win/tclWinReg.c (regConnectRegistryProc,RecursiveDeleteKey,DeleteKey,
	  GetKeyNames,GetType,GetValue,OpenSubKey,SetValue):
	* win/tclWinSerial.c (SerialSetOptionProc): Update callers.

	* Following is [Patch 505072]
	* doc/Concat.3:
	* doc/Encoding.3:
	* doc/Filesystem.3:
	* doc/Macintosh.3:
	* doc/OpenFileChnl.3
	* doc/SetResult.3:
	* doc/SetVar.3:
	* doc/SplitList.3:
	* doc/SplitPath.3:
	* doc/Translate.3:
	* generic/tcl.h (Tcl_FSMatchInDirectoryProc):
	* generic/tclInt.h (TclpMatchInDirectory):
	* generic/tcl.decls (Tcl_Concat,Tcl_GetStringResult,Tcl_GetVar,
	  Tcl_GetVar2,Tcl_JoinPath,Tcl_Merge,Tcl_OpenCommandChannel,Tcl_SetVar,
	  Tcl_SetVar2,Tcl_SplitList,Tcl_SplitPath,Tcl_TranslateFileName,
	  Tcl_ExternalToUtfDString,Tcl_GetEncodingName,Tcl_UtfToExternalDString,
	  Tcl_GetDefaultEncodingDir,Tcl_SetDefaultEncodingDir,
	  Tcl_FSMatchInDirectory,Tcl_MacEvalResource,Tcl_MacFindResource):
	* generic/tclInt.decls (TclCreatePipeline,TclGetEnv,TclpGetCwd,
	  TclpCreateProcess):
	* mac/tclMacFile.c (TclpGetCwd):
	* generic/tclEncoding.c (Tcl_GetDefaultEncodingDir,
	  Tcl_SetDefaultEncodingDir,Tcl_GetEncodingName,
	  Tcl_ExternalToUtfDString,Tcl_UtfToExternalDString, OpenEncodingFile,
	  LoadEscapeEncoding):
	* generic/tclFileName.c (DoTildeSubst,Tcl_JoinPath,Tcl_SplitPath,
	  Tcl_TranslateFileName): 
	* generic/tclIOUtil.c (Tcl_FSMatchInDirectory):
	* generic/tclPipe.c (FileForRedirect,TclCreatePipeline,
	  Tcl_OpenCommandChannel):
	* generic/tclResult.c (Tcl_GetStringResult):
	* generic/tclUtil.c (Tcl_Concat,Tcl_SplitList,Tcl_Merge):
	* generic/tclVar.c (Tcl_GetVar,Tcl_GetVar2,Tcl_SetVar,Tcl_SetVar2):
	* mac/tclMacResource.c (Tcl_MacEvalResource,Tcl_MacFindResource):
	Updated interfaces of generic/tclEncoding, generic/tclFilename.c,
	generic/tclIOUtil.c, generic/tclPipe.c, generic/tclResult.c,
	generic/tclUtil.c, generic/tclVar.c and mac/tclMacResource.c according
	to TIP 27.  Tcl_TranslateFileName rewritten as wrapper around
	VFS-aware version.
	***POTENTIAL INCOMPATIBILITY*** 
	Includes source incompatibilities: argv arguments of Tcl_Concat,
	Tcl_JoinPath, Tcl_OpenCommandChannel, Tcl_Merge; argvPtr arguments of
	Tcl_SplitList and Tcl_SplitPath.
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs

	* generic/tclCkalloc.c (MemoryCmd):
	* generic/tclClock.c (FormatClock):
	* generic/tclCmdAH.c (Tcl_CaseObjCmd,Tcl_EncodingObjCmd,Tcl_FileObjCmd):
	* generic/tclCmdIL.c (InfoLibraryCmd,InfoPatchLevelCmd,
	  InfoTclVersionCmd):
	* generic/tclCompCmds.c (TclCompileForeachCmd):
	* generic/tclCompCmds.h (TclCompileForeachCmd):
	* generic/tclCompile.c (TclFindCompiledLocal):
	* generic/tclEnv.c (TclSetupEnv,TclSetEnv,Tcl_PutEnv,TclGetEnv,
	  EnvTraceProc):
	* generic/tclEvent.c (Tcl_BackgroundError):
	* generic/tclIO.c (Tcl_BadChannelOption,Tcl_SetChannelOption):
	* generic/tclIOCmd.c (Tcl_ExecObjCmd,Tcl_OpenObjCmd):
	* generic/tclIOSock.c (TclSockGetPort):
	* generic/tclIOUtil.c (SetFsPathFromAny):
	* generic/tclLink.c (LinkTraceProc):
	* generic/tclMain.c (Tcl_Main):
	* generic/tclNamesp.c (TclTeardownNamespace):
	* generic/tclProc.c (TclCreateProc):
	* generic/tclTest.c (TestregexpObjCmd,TesttranslatefilenameCmd,
	  TestchmodCmd,GetTimesCmd,TestsetCmd,TestOpenFileChannelProc1,
	  TestOpenFileChannelProc2,TestOpenFileChannelProc3,AsyncHandlerProc,
	  TestpanicCmd):
	* generic/tclThreadTest.c (ThreadErrorProc,ThreadEventProc):
	* generic/tclUtil.c (TclPrecTraceProc):
	* mac/tclMacFCmd.c (GetFileSpecs):
	* mac/tclMacFile.c (TclpMatchInDirectory):
	* mac/tclMacInit.c (TclpInitLibraryPath,Tcl_SourceRCFile):
	* mac/tclMacOSA.c (tclOSAStore,tclOSALoad):
	* mac/tclMacResource.c (Tcl_MacEvalResource):
	* unix/tclUnixFCmd.c (TclpObjNormalizePath):
	* unix/tclUnixFile.c (TclpMatchInDirectory,TclpGetUserHome,TclpGetCwd,
	  TclpReadLink):
	* unix/tclUnixInit.c (TclpInitLibraryPath,TclpSetVariables,
	  Tcl_SourceRCFile):
	* unix/tclUnixPipe.c (TclpOpenFile,TclpCreateTempFile,
	  TclpCreateProcess):
	* win/tclWinFile.c (TclpGetCwd,TclpMatchInDirectory):
	* win/tclWinInit.c (TclpInitLibraryPath,Tcl_SourceRCFile,
	  TclpSetVariables):
	* win/tclWinPipe.c (TclpCreateProcess): Updated callers.

2002-01-24  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclIOUtil.c (SetFsPathFromAny):  Corrected tilde-substitution
	of pathnames where > 1 separator follows the ~.  [Bug 504950]

2002-01-24  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/http/pkgIndex.tcl:
	* library/http/http.tcl: don't add port in default case to handle
	broken servers.  http bumped to 2.4.1  [Bug #504508]

2002-01-23  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* unix/mkLinks: Regenerated.
	* doc/CrtChannel.3:
	* doc/ChnlStack.3: Moved documentation for 'Tcl_GetTopChannel'
	  from 'CrtChannel' to 'ChnlStack'. Added documentation of
	  'Tcl_GetStackedChannel'. Bug #506147 reported by Mark Patton
	  <msp@@users.sourceforge.net>.

2002-01-23  Don Porter <dgp@@users.sourceforge.net>

	* win/tclWinFile.c (NativeAccess,NativeStat,NativeIsExec,
	  TclpGetUserHome):
	* win/tclWinPort.h (TclWinSerialReopen):
	* win/tclWinSerial.c (TclWinSerialReopen):
	* win/tclWinSock.c (Tcl_OpenTcpServer):  Corrections to earlier
	TIP 27 changes.  Thanks to Andreas Kupries for the feedback.
	* generic/tclPlatDecls.h: make genstubs

	* doc/GetHostName.3:
	* doc/GetOpnFl.3:
	* doc/OpenTcp.3:
	* tcl.decls (Tcl_GetHostName,Tcl_GetOpenFile,Tcl_OpenTcpClient,
	  Tcl_OpenTclServer):
	* mac/tclMacSock.c (CreateSocket,Tcl_OpenTcpClient,Tcl_OpenTcpServer,
	  Tcl_GetHostName,GetHostFromString):
	* unix/tclUnixChan.c (CreateSocket,CreateSocketAddress,
	  Tcl_OpenTcpClient,Tcl_OpenTcpServer,Tcl_GetOpenFile):
	* unix/tclUnixSock.c (Tcl_GetHostName):
	* win/tclWinSock.c (CreateSocket,CreateSocketAddress,
	  Tcl_OpenTcpClient,Tcl_OpenTcpServer,Tcl_GetHostName):
	Updated socket interfaces according to TIP 27.
	* generic/tclCmdIL.c (InfoHostnameCmd): Updated callers.
	* generic/tclDecls.h: make genstubs

2002-01-21  David Gravereaux <davygrvy@@pobox.com>

	* generic/tclLoadNone.c: TclpLoadFile() didn't match proto of
	  typedef Tcl_FSLoadFileProc.  OK'd by vincentdarley.
	  [Patch #502488]

2002-01-21  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIO.c (WriteChars): Fix for SF #506297, reported by
	  Martin Forssen <ruric@@users.sourceforge.net>. The encoding
	  chosen in the script exposing the bug writes out three intro
	  characters when TCL_ENCODING_START is set, but does not consume
	  any input as TCL_ENCODING_END is cleared. As some output was
	  generated the enclosing loop calls UtfToExternal again, again
	  with START set. Three more characters in the out and still no
	  use of input ... To break this infinite loop we remove
	  TCL_ENCODING_START from the set of flags after the first call
	  (no condition is required, the later calls remove an unset flag,
	  which is a no-op). This causes the subsequent calls to
	  UtfToExternal to consume and convert the actual input.

2002-01-21  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclTest.c: Converted declarations of TestReport file system
	  to more portable form.  [Bug 501417].

	* generic/tcl.decls (Tcl_TraceCommand,Tcl_UntraceCommand,
	  Tcl_CommandTraceInfo):
	* generic/tclCmdMZ.c (Tcl_TraceCommand,Tcl_UntraceCommand,
	  Tcl_CommandTraceInfo): Updated APIs in generic/tclCmdMZ.c 
	  according to the guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs

2002-01-18  Don Porter <dgp@@users.sourceforge.net>

	* win/tclWinChan.c:
	* win/tclWinFCmd.c:
	* win/tclWinFile.c: Overlooked callers of Tcl_FSGetNativePath

	* win/tclWinDde.c:
	* win/tclWinReg.c: Overlooked callers of Tcl_GetIndexFromObj

2002-01-18  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclThreadTest.c:
	* mac/tclMacChan.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacLoad.c:
	* mac/tclMacResource.c: TIP 27 CONSTification broke the mac
	  build in a number of places.

2002-01-17  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIOCmd.c (Tcl_GetsObjCmd): Fixed bug #504642 as
	  reported by Brian Griffin <bgriffin@@users.sourceforge.net>,
	  using his patch. Before the patch the generic I/O layer held an
	  unannounced reference to the interp result to store the read
	  line into. This unfortunately has disastrous results if the
	  channel driver executes a tcl script to perform its operation,
	  this freeing the interp result. In that case we are
	  dereferencing essentially a dangling reference. It is not truly
	  dangling because the object is in the free list, but this only
	  causes us to smash the free list and have the error occur later
	  somewhere else. The patch simply creates a new object for the
	  line and later sets it into the interp result when we are done
	  with reading.

2002-01-16  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tcl.m4 (SC_LOAD_TCLCONFIG):
	* win/tcl.m4 (SC_LOAD_TCLCONFIG): Subst TCL_DBGX
	into TCL_STUB_LIB_FILE and TCL_STUB_LIB_FLAG
	variables so that an extension does not need
	to subst TCL_DBGX into its makefile. [Tk Bug 504356]

2002-01-16  Don Porter <dgp@@users.sourceforge.net>

	* doc/FileSystem.3:
	* doc/GetCwd.3:
	* doc/GetIndex.3:
	* generic/tcl.decls (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_GetCwd, Tcl_FSFileAttrStrings, Tcl_FSGetNativePath,
	  Tcl_FSGetTranslatedStringPath):
	* generic/tcl.h (Tcl_FSFileAttrStringsProc):
	* generic/tclFCmd.c (TclFileAttrsCmd):
	* generic/tclIOUtil.c (Tcl_GetCwd,NativeFileAttrStrings,
	  Tcl_FSFileAttrStrings,Tcl_FSGetTranslatedStringPath,
	  Tcl_FSGetNativePath):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObj,Tcl_GetIndexFromObjStruct):
	More TIP 27 updates in tclIOUtil.c and tclIndexObj.c that were
	overlooked before.  [Patch 504671]
	***POTENTIAL INCOMPATIBILITY*** 
	Includes a source incompatibility in the tablePtr arguments of
	the Tcl_GetIndexFromObj* routines.
	* generic/tclDecls.h: make genstubs

	* generic/tclBinary.c (Tcl_BinaryObjCmd):
	* generic/tclClock.c (Tcl_ClockObjCmd):
	* generic/tclCmdAH.c (Tcl_EncodingObjCmd, Tcl_FileObjCmd):
	* generic/tclCmdIL.c (Tcl_InfoObjCmd,Tcl_LsearchObjCmd,Tcl_LsortObjCmd):
	* generic/tclCmdMZ.c (Tcl_TraceObjCmd,Tcl_RegexpObjCmd,Tcl_RegsubObjCmd,
	  Tcl_StringObjCmd,Tcl_SubstObjCmd,Tcl_SwitchObjCmd,
	  TclTraceCommandObjCmd,TclTraceVariableObjCmd):
	* generic/tclCompCmds.c (TclCompileStringCmd):
	* generic/tclEvent.c (Tcl_UpdateObjCmd):
	* generic/tclFileName.c (Tcl_GlobObjCmd):
	* generic/tclIO.c (Tcl_FileEventObjCmd):
	* generic/tclIOCmd.c (Tcl_SeekObjCmd,Tcl_ExecObjCmd,Tcl_SocketObjCmd,
	  Tcl_FcopyObjCmd):
	* generic/tclInterp.c (Tcl_InterpObjCmd,SlaveObjCmd):
	* generic/tclNamesp.c (Tcl_NamespaceObjCmd):
	* generic/tclPkg.c (Tcl_PackageObjCmd):
	* generic/tclTest.c (Tcltest_Init,TestencodingObjCmd,TestgetplatformCmd,
	  TestlocaleCmd,TestregexpObjCmd,TestsaveresultCmd,
	  TestGetIndexFromObjStructObjCmd,TestReportFileAttrStrings):
	* generic/tclTestObj.c (TestindexObjCmd,TeststringObjCmd):
	* generic/tclTimer.c (Tcl_AfterObjCmd):
	* generic/tclVar.c (Tcl_ArrayObjCmd):
	* mac/tclMacFCmd.c (SetFileFinderAttributes):
	* unix/tclUnixChan.c (TclpOpenFileChannel):
	* unix/tclUnixFCmd.c (tclpFileAttrStrings):
	* unix/tclUnixFile.c (TclpObjAccess,TclpObjChdir,TclpObjStat,
	  TclpObjLstat):
	* win/tclWinFCmd.c (tclpFileAttrStrings): Updated callers.

	* doc/RegExp.3:
	* doc/Utf.3:
	* generic/tcl.decls:
	* generic/tclInt.decls:
	* generic/tclRegexp.c:
	* generic/tclUtf.c:  Updated APIs in generic/tclUtf.c and
	generic/tclRegexp.c according to the guidelines of TIP 27.
	[Patch 471509]

	* generic/regc_locale.c (element,cclass):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd):
	* generic/tclFileName.c (TclpGetNativePathType,SplitMacPath):
	* generic/tclIO.c (ReadChars):
	* mac/tclMacLoad.c (TclpLoadFile):
	* win/tclWinFile.c (TclpGetUserHome): Updated callers.

	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs

	* doc/ParseCmd.3 (Tcl_ParseVar):
	* generic/tcl.decls (Tcl_ParseVar):
	* generic/tclParse.c (Tcl_ParseVar):
	* generic/tclTest.c (TestparsevarObjCmd): Updated APIs in
	generic/tclParse.c according to the guidelines of TIP 27.  Updated
	callers.  [Patch 501046]
	* generic/tclDecls.h: make genstubs

	* generic/tcl.decls (Tcl_RecordAndEval):
	* generic/tclDecls.h: make genstubs
	* generic/tclHistory.c (Tcl_RecordAndEval): Updated APIs in
	generic/tclHistory.c according to the guidelines of TIP 27.
	[Patch 504091]

	* doc/CrtSlave.3:
	* generic/tcl.decls (Tcl_CreateAlias, Tcl_CreateAliasObj,
	  Tcl_CreateSlave, Tcl_GetAlias, Tcl_GetAliasObj, Tcl_GetSlave):
	* generic/tclInterp.c (Tcl_CreateAlias, Tcl_CreateAliasObj,
	  Tcl_CreateSlave, Tcl_GetAlias, Tcl_GetAliasObj, Tcl_GetSlave):
	Updated APIs in the file generic/tclInterp.c according to the
	guidelines of TIP 27.  [Patch 501371]
	***POTENTIAL INCOMPATIBILITY*** 
	Includes a source incompatibility in the targetCmdPtr arguments of
	the Tcl_GetAlias* routines.

	* generic/tclDecls.h: make genstubs

2002-01-15  Don Porter <dgp@@users.sourceforge.net>

	* doc/SetErrno.3 (Tcl_ErrnoMsg): Corrected documentation for
	Tcl_ErrnoMsg; it takes an integer argument.  Thanks to Georgios
	Petasis.  [Bug 468183]

	* doc/AddErrInfo.3 (Tcl_PosixError):
	* doc/Eval.3 (Tcl_EvalFile):
	* doc/FileSystem.c (Tcl_FSOpenFileChannel,Tcl_FSOpenFileChannelProc):
	* doc/OpenFileChnl.3 (Tcl_OpenFileChannel):
	* doc/SetErrno.3 (Tcl_ErrnoId,Tcl_ErrnoMsg):
	* doc/Signal.3 (Tcl_SignalId,Tcl_SignalMsg):
	* generic/tcl.decls (Tcl_ErrnoId,TclErrnoMsg,Tcl_EvalFile,
	  Tcl_OpenFileChannel,Tcl_PosixError,Tcl_SignalId,Tcl_SignalMsg,
	  Tcl_FSOpenFileChannel):
	* generic/tcl.h (Tcl_FSOpenFileChannelProc):
	* generic/tclIO.c (FlushChannel):
	* generic/tclIOUtil.c (Tcl_OpenFileChannel,Tcl_EvalFile,TclGetOpenMode,
	  Tcl_PosixError,Tcl_FSOpenFileChannel):
	* generic/tclInt.decls (TclGetOpenMode):
	* generic/tclInt.h (TclOpenFileChannelProc_,TclGetOpenMode,
	  TclpOpenFileChannel):
	* generic/tclPipe.c (TclCleanupChildren):
	* generic/tclPosixStr.c (Tcl_ErrnoId,Tcl_ErrnoMsg,Tcl_SignalId,
	  Tcl_SignalMsg):
	* generic.tclTest.c (PretendTclpOpenFileChannel,
	  TestOpenFileChannelProc1,TestOpenFileChannelProc2,
	  TestOpenFileChannelProc3,TestReportOpenFileChannel):
	* mac/tclMacChan.c (TclpOpenFileChannel):
	* unix/tclUnixChan.c (TclpOpenFileChannel):
	* win/tclWinChan.c (TclpOpenFileChannel): Updated APIs in
	  generic/tclIOUtil.c and generic/tclPosixStr.c according to the
	  guidelines of TIP 27.  Updated callers.  [Patch 499196]

	* generic/tclDecls.h:
	* generic/tclIntDecls.h: make genstubs

	* doc/CrtChannel.3:
	* doc/OpenFileChnl.3:
	* generic/tcl.decls:
	* generic/tclIO.h:
	* generic/tclIO.c (DoWrite, Tcl_RegisterChannel, Tcl_GetChannel,
	  Tcl_CreateChannel, Tcl_GetChannelName, CloseChannel, Tcl_Write,
	  Tcl_WriteRaw, Tcl_Ungets, Tcl_BadChannelOption, Tcl_GetChannelOption,
	  Tcl_SetChannelOption, Tcl_GetChannelNamesEx, Tcl_ChannelName):
	Updated APIs in the file generic/tclIO.c according to the guidelines
	of TIP 27.  Several minor documentation corrections as well.
	[Patch 503565]
	* generic/tclDecls.h: make genstubs

	* generic/tcl.h (Tcl_DriverOutputProc, Tcl_DriverGetOptionProc,
	  Tcl_DriverSetOptionProc):
	* generic/tclIOGT.c (TransformOutputProc, TransformGetOptionProc,
	  TransformSetOptionProc):
	* mac/tclMacChan.c (FileOutput, StdIOOutput):
	* man/tclMacSock.c (TcpGetOptionProc, TcpOutput):
	* unix/tclUnixChan.c (FileOutputProc, TcpGetOptionProc, TcpOutputProc,
	  TtyGetOptionProc, TtySetOptionProc):
	* unix/tclUnixPipe.c (PipeOuputProc):
	* win/tclWinChan.c (FileOutputProc):
	* win/tclWinConsole.c (ConsleOutputProc):
	* win/tclWinPipe.c (PipeOuputProc):
	* win/tclWinSerial.c (SerialOutputProc, SerialGetOptionProc,
	  SerialSetOptionProc):
	* win/tclWinSock.c (TcpGetOptionProc, TcpOutput): Updated channel
	driver interface according to the guidelines of TIP 27.  See also
	[Bug 500348].

	* doc/CrtChannel.3:
	* generic/tcl.h:
	* generic/tclIO.c:
	* generic/tclIO.h:
	* generic/tclInt.h:
	* tools/checkLibraryDoc.tcl:
	Moved Tcl_EolTranslation enum declaration from generic/tcl.h to
	generic/tclInt.h (renamed to TclEolTranslation).  It is not used
	anywhere in Tcl's public interface.

2002-01-14  Don Porter <dgp@@users.sourceforge.net>

	* doc/GetIndex.3:
	* doc/WrongNumArgs.3:
	* generic/tcl.decls (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_WrongNumArgs):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_WrongNumArgs):  Updated APIs in the file generic/tclIndexObj.c
	according to the guidelines of TIP 27.  [Patch 501491]
	* generic/tclDecls.h: make genstubs

2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/configure.in:
	* win/configure: Regen.
	* win/configure.in: Use ${libdir} instead of ${exec_prefix}/lib
	to properly support the --libdir option to configure. [Bug 489370]

2002-01-11  Andreas Kupries  <andreas_kupries@@users.sourceforge.net> 

	* win/tclWinSerial.c (SerialSetOptionProc): Applied patch for SF
	  bug #500348 supplied by Rolf Schroedter
	  <schroedter@@users.sourceforge.net>. The function modified the
	  contents of the the 'value' string and now does not do this
	  anymore. This is a followup to the change made on 2001-12-17.

2002-01-11  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.vc: Removed -GD compiler option.  It was intended
	for future use, but MS is again changing the future at their whim.
	The D4002 warning was harmless though, but someone using VC .NET
	logged it as a concern.  [Bug #501565]

2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Burn Tcl build directory
	into tcltest executable to avoid crashes caused
	by ld loading a previously installed version
	of the tcl shared library. [Bug 218110]

2002-01-10  Don Porter <dgp@@users.sourceforge.net>,
	Kevin Kenny <kennykb@@users.sourceforge.net>
	
	* unix/tclLoadDld.c (TclpLoadFile):  syntax error: unbalanced
	parens.  Kevin notes that it's far from clear that this file is
	ever included in an actual build; Linux without dlopen appears to
	be a nonexistent configuration.
	
2002-01-08  Don Porter <dgp@@users.sourceforge.net>,
	Kevin Kenny <kennykb@@users.sourceforge.net>

	* doc/StaticPkg.3 (Tcl_StaticPackage):
	* generic/tcl.decls (Tcl_StaticPackage):
	* generic/tclDecls.h (Tcl_StaticPackage):
	* generic/tclInt.decls (TclGuessPackageName):
	* generic/tclInt.h (TclGuessPackageName):
	* generic/tclLoad.c (Tcl_StaticPackage):
	* generic/tclLoadNone.c (TclGuessPackageName):
	* mac/tclMacLoad.c (TclGuessPackageName):
	* unix/tclLoadAout.c (TclGuessPackageName):
	* unix/tclLoadDl.c (TclGuessPackageName):
	* unix/tclLoadDld.c (TclGuessPackageName):
	* unix/tclLoadDyld.c (TclGuessPackageName):
	* unix/tclLoadNext.c (TclGuessPackageName):
	* unix/tclLoadOSF.c (TclGuessPackageName):
	* unix/tclLoadShl.c (TclGuessPackageName):
	* win/tclWinLoad.c (TclGuessPackageName):  Updated APIs in 
	the files */tcl*Load*.c according to the guidelines of TIP 27.
	[Patch 501096]

2002-01-09  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclTest.c (MainLoop):
	* tests/main.test (Tcl_Main-1.{3,4,5,6}):  Corrected some non-portable
	tests from the new Tcl_Main changes.  Thanks to Kevin Kenny.

2002-01-07  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclEvent.c (TclInExit):
	* generic/tclIOUtil.c (SetFsPathFromAbsoluteNormalized,
	  SetFsPathFromAny,Tcl_FSNewNativePath,DupFsPathInternalRep):
	* generic/tclListObj.c (TclLsetList,TclLsetFlat):  Added some type
	casts to satisfy picky compilers.

	* generic/tclMain.c:  Bug fix: neglected the NULL case in
	TclGetStartupScriptFileName().  Broke Tk/wish.

2002-01-05  Don Porter <dgp@@users.sourceforge.net>

	* doc/Tcl_Main.3:
	* generic/tclMain.c:  Substantial rewrite and expanded documentation
	of Tcl_Main to correct a number of bugs and flaws:

		* Interactive Tcl_Main can now enter a main loop, exit
		  that loop and continue interactive operations.  The loop
		  may even exit in the midst of interactive command typing
		  without loss of the partial command.  [Bugs 486453, 474131]
		* Tcl_Main now gracefully handles deletion of its master
		  interpreter.
		* Interactive Tcl_Main can now operate with non-blocking stdin
		* Interactive Tcl_Main can now detect EOF on stdin even in
		  mid-command.  [Bug 491341]
		* Added VFS-aware internal routines for managing the
		  startup script selection.
		* Tcl variable 'tcl_interactive' is now linked to C variable
		  'tty' so that one can disable/enable interactive prompts
		  at the script level when there is no startup script.  This
		  is meant for use by the test suite.
		* Consistent use of the Tcl libraries standard channels as
		  returned by Tcl_GetStdChannel(); as opposed to the channels
		  named 'stdin', 'stdout', and 'stderr' in the master interp,
		  which can be different or unavailable.
		* Tcl_Main now calls Tcl_Exit() if evaluation of [exit] in the
		  master interpreter returns, assuring Tcl_Main does not return.
		* Documented Tcl_Main's absence from public stub table
		* Documented that Tcl_Main does not return.
		* Documented Tcl variables set by Tcl_Main.
		* All prompts are done from a single procedure, Prompt.
		* Use of Tcl_Obj-enabled interfaces everywhere.

	* generic/tclInt.decls (TclGetStartupScriptPath,
	  TclSetStartupScriptPath): New internal VFS-aware routines for
	managing the startup script of Tcl_Main.
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c: make genstubs

	* generic/tclTest.c (TestsetmainloopCmd,TestexitmainloopCmd,
	  Tcltest_Init,TestinterpdeleteCmd):
	* tests/main.test (new):  Added new file to test suite that
	thoroughly tests generic/tclMain.c; added some new test commands
	for testing Tcl_SetMainLoop().

2002-01-04  Don Porter <dgp@@users.sourceforge.net>

	* doc/Alloc.3:
	* doc/Concat.3:
	* doc/CrtMathFnc.3:
	* doc/Hash.3:
	* doc/Interp.3:
	* doc/LinkVar.3:
	* doc/ObjectType.3:
	* doc/PkgRequire.3:
	* doc/Preserve.3:
	* doc/SetResult.3:
	* doc/SplitList.3:
	* doc/SplitPath.3:
	* doc/TCL_MEM_DEBUG.3: Updated documentation to describe the ckalloc,
	ckfree, ckrealloc, attemptckalloc, and attemptckrealloc macros, and
	to accurately describe when and how they are used.  [Bug 497459]

	* generic/tclThreadJoin.c (TclRememberJoinableThread,TclJoinThread):
	Replaced Tcl_Alloc and Tcl_Free calls with ckalloc and ckfree so that
	memory debugging is supported.

2002-01-04  Daniel Steffen <das@@users.sourceforge.net>

	* mac/tclMacTime.c (TclpGetTZName): fix for daylight savings TZName bug

2002-01-03  Don Porter <dgp@@users.sourceforge.net>

	* doc/FileSystem.3:
	* generic/tclIOUtil.c: Updated some old uses of "fileName" to
	new VFS terminology, "pathPtr".

2002-01-03  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/basic.test (basic-39.4): Greatly simplified test while
	still leaving it so that it crashes when run without the fix to
	the [foreach] implementation.
	* generic/tclCmdAH.c (Tcl_ForeachObjCmd): Stopped Bug #494348 from
	happening by not trying to be so clever with cacheing; if nothing
	untoward is happening anyway, the less efficient technique will
	only add a few instruction cycles (one function call and a few
	derefs/assigns per list per iteration, with no change in the
	number of tests) and if something odd *is* going on, the code is
	now far more robust.

	* tests/basic.test (basic-39.4): Reproducable script from Bug #494348

2002-01-02  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/util.test (Wrapper_Tcl_StringMatch,util-5.*): Rewrote so
	the test is performed with the right internal function since
	[string match] no longer uses Tcl_StringCaseMatch internally.

	* tests/string.test (string-11.51):
	* generic/tclUtf.c (Tcl_UniCharCaseMatch):
	* generic/tclUtil.c (Tcl_StringCaseMatch): Fault with matching
	case-insensitive non-ASCII patterns containing upper case
	characters.  [Bug #233257]

	******************************************************************
	*** CHANGELOG ENTRIES FOR 2001 IN "ChangeLog.2001"             ***
	*** CHANGELOG ENTRIES FOR 2000 IN "ChangeLog.2000"             ***
	*** CHANGELOG ENTRIES FOR 1999 AND EARLIER IN "ChangeLog.1999" ***
	******************************************************************
@


1.42
log
@        From Dave Murphy  <davem@@devkitpro.org>:
        * win/tclWin32Dll.c (TclpCheckStackSpace): Backport
        EXCEPTION_REGISTRATION code from Tcl mainline.
@
text
@d1 6
@


1.41
log
@2007-05-14  Maciej W. Rozycki  <macro@@mips.com>

	* win/tclWinPipe.c (TclpCreateProcess): Only use CW_SYNC_WINENV if
	supported by the compilation environment.
@
text
@d1 6
@


1.40
log
@	* win/tclWin32Dll.c (TclWinInit): Set native cwd to Cygwin's cwd.
	* win/tclWinFile.c (TclpObjChdir): Keep native and Cygwin's cwd
	synched.
@
text
@d1 5
@


1.39
log
@fix typo
@
text
@d1 6
@


1.38
log
@* cygwin/configure.in (LIB_AC_PROG_CC): Upgrade macro to accommodate newer
version of autoconf.
* cygwin/configure: Regenerate.
* win/tcl.m4: Upgrade to avoid use of absolete ac_cv_cygwin variable.
* win/configure: Regenerate.
@
text
@d6 1
a6 1
	* win/tcl.m4: Upgrade to avoid use of absolete ac_cv_cygwin variable.
@


1.37
log
@* win/tclWinPipe.c (TclpCreateProcess): Call cygwin-specific routine to set up
windows environment.
@
text
@d3 8
@


1.36
log
@	* configure.in: Fix for autoconf 2.5.
	* cygwin/configure.in: Fix for autoconf 2.5.
	* win/configure.in: Fix for autoconf 2.5.
	* unix/configure.in: Fix for autoconf 2.5.
	* unix/tcl.m4: Fix for autoconf 2.5.
	* configure: Regenerate.
	* cygwin/configure: Regenerate.
	* tools/configure: Regenerate.
	* unix/configure: Regenerate.
	* unix/dltest/configure: Regenerate.
	* win/configure: Regenerate.
@
text
@d1 5
@


1.36.2.1
log
@update to HEAD
@
text
@a0 19
2006-12-01  Corinna Vinschen  <corinna@@vinschen.de>

	* win/tclWin32Dll.c (TclWinInit): Set native cwd to Cygwin's cwd.
	* win/tclWinFile.c (TclpObjChdir): Keep native and Cygwin's cwd
	synched.

2006-11-30  Christopher Faylor  <cgf@@timesys.com>

	* cygwin/configure.in (LIB_AC_PROG_CC): Upgrade macro to accommodate
	newer version of autoconf.
	* cygwin/configure: Regenerate.
	* win/tcl.m4: Upgrade to avoid use of obsolete ac_cv_cygwin variable.
	* win/configure: Regenerate.

2006-11-30  Christopher Faylor  <cgf@@timesys.com>

	* win/tclWinPipe.c (TclpCreateProcess): Call cygwin-specific routine to
	set up windows environment.

@


1.35
log
@tcl/ChangeLog:
* unix/tcl.m4 (SC_CONFIG_CFLAGS, SC_BLOCKING_STYLE): Remove
unmatched single quote inside backticks.
* unix/configure: Rebuild.
tk/ChangeLog:
* unix/tcl.m4 (SC_CONFIG_CFLAGS, SC_BLOCKING_STYLE): Remove
unmatched single quote inside backticks.
* unix/configure: Rebuild.
@
text
@d1 14
@


1.34
log
@* win/tclWin32Dll.c (_except_checkstackspace_handler): Define with proper
attribute to prevent this static function from being deleted due to aggressive
gcc optimization.
* win/tclWinChan.c (_except_makefilechannel_handler): Ditto.
* win/tclWinFCmd.c (_except_dorenamefile_handler): Ditto.
* configure.in: Make sure that TCL_LIB_SPEC is properly filled out.
* configure: Regenerate.
@
text
@d1 6
@


1.33
log
@        From tcl repository:
        2003-10-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
        * generic/tclCmdAH.c (Tcl_FileObjCmd): Changed FILE_ prefix to FCMD_
        to stop symbol/#def clashes on Cygwin/Mingw32 on NT.
@
text
@d1 11
@


1.32
log
@2003-02-11  Martin M. Hunt  <hunt@@redhat.com>
	From Mumit Khan  <khan@@nanotech.wisc.edu>

	* generic/tclIOUtil.c (SetFsPathFromAny): Add Cygwin specific
	code to convert POSIX filename to native format.
	* generic/tclFileName.c (Tcl_TranslateFileName): And remove
	from here.
	(TclDoGlob): Adjust.
	* win/tclWinFile.c (TclpObjChdir): Use chdir on Cygwin.
@
text
@d1 7
@


1.31
log
@2003-02-06  Martin M. Hunt  <hunt@@redhat.com>

	* win/tcl.m4 (SC_CONFIG_CFLAGS): Don't default to -O.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Don't default to -O.
	CFLAGS gets set to "-O2" by default in top level
	configure. Adding "-O" here causes the "-O2" to be
	ignored, but only when the user types "make" within
	the tcl subdirectory. This caused some confusion.
	* win/configure: Rebuilt.
	* unix/configure: Rebuilt.

	* generic/tclEnv.c (TclUnsetEnv): Cast arg to unsigned.

	Import from latest tcl sources to fix a bug with
	"file copy"
	2003-01-25  Mo DeJong  <mdejong@@users.sourceforge.net>
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile, squelch_warnings):
	Re-implement inline ASM SEH handlers for gcc.
	The esp and ebp registers are now saved on the
	stack instead of in global variables so that
	the code is thread safe. Add additional checks
	when TCL_MEM_DEBUG is defined to be sure the
	values were recovered from the stack properly.
	Remove squelch_warnings functions and add
	a dummy call in the handler methods to squelch
	compiler warnings.
	* win/tclWinReg.c: Add casts to avoid compiler
	warning. Fix assignment in if expression bug.
@
text
@d1 11
@


1.30
log
@Updated to tcl 8.4.1
@
text
@d1 30
@


1.29
log
@* win/tclWinInit.c (TclpInitLibraryPath): Default to correct location for
installLib on cygwin.
@
text
@d1 1
a1 1
2002-12-19  Christopher Faylor  <cgf@@redhat.com>
d3 1
a3 2
	* win/tclWinInit.c (TclpInitLibraryPath): Default to correct location
	for installLib on cygwin.
d5 1
a5 1
2002-12-19  Christopher Faylor  <cgf@@redhat.com>
d7 5
a11 2
	* cygwin/configure.in: Set TCL_BUILD_LIB_SPEC.
	* cygwin/configure: Regenerate.
d13 1
a13 1
2002-10-05  Christopher Faylor  <cgf@@redhat.com>
d15 10
a24 2
	* win/tclWin32Dll.c (tclWinTCharEncoding): Remove 'static' since it is
	declared in header as exportable extern.
d26 1
a26 1
2002-09-13  Keith Seitz  <keiths@@redhat.com>
d28 3
a30 4
	From Mo Dejong  <supermo@@bayarea.net>:
	* win/tclWin32Dll.c (DllMain): Remove unused os
	variable since VC++ treats warnings as errors
	when compiling with symbols.
d32 1
a32 3
	* win/tclWinPort.h: Remove undefine of PASCAL
	symbol added on 2001-09-12. It caused
	crashing problems with sockets.
d34 3
a36 1
2002-07-31  Keith Seitz  <keiths@@redhat.com>
d38 1
a38 2
	* generic/tclIntDecls.h (TclIntStubs): Do not include definitions
	for tclpAlloc, tclpFree, or pRealloc on cygwin.
d40 6
a45 11
	* win/tcl.hpj.in: Copied here from tools/tcl.hpj.in.
	
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Add TCL_DLL_BASE, DDE_DLL_BASE,
	and REG_DLL_BASE variables to define DLL image bases on cygwin.
	Do not link with "-e _WinMain@@16" on cygwin.
	* win/configure.in (TCL_DLL_BASE): Substitute into makefile.
	(DDE_DLL_BASE): Likewise.
	(REG_DLL_BASE): Likewise.
	* win/configure: Regenerated.
	* win/Makefile.in: Use TCL_DLL_BASE, DDE_DLL_BASE, and
	REG_DLL_BASE to build DLLs.
d47 3
a49 1
2002-07-30  Keith Seitz  <keiths@@redhat.com>
d51 1
a51 7
	From Mo DeJong  <supermo@@bayarea.net>
	* cygwin/configure: Regenerated.
	* cygwin/configure.in: Emit a tclConfig.sh file
	so that expect can load it at configure time.
	* win/configure: Regenerated.
	* win/configure.in: Don't emit a ../unix/tclConfig.sh
	file, this was a hack to get expect to build.
d53 1
a53 1
2002-04-09  Keith Seitz  <keiths@@redhat.com>
d55 2
a56 2
	* test/iOUtil.test: Removed. Conflicted with real ioUtil.test
	file.
d58 1
a58 1
2001-10-28  Christopher Faylor  <cgf@@redhat.com>
d60 2
a61 2
	* cygwin/configure.in: Check for cygwin host rather than cygwin target.
	* cygwin/configure: Regenerate.
d63 1
a63 1
2001-10-28  Christopher Faylor  <cgf@@redhat.com>
d65 1
a65 3
	* win/configure.in: Modify 2001-10-05 change to check for cygwin host
	rather than cygwin target.
	* win/configure: Regenerate.
d67 3
a69 1
Fri Oct  5 16:03:53 2001  Christopher Faylor <cgf@@cygnus.com>
d71 1
a71 3
	* win/configure.in: Add detection for -mwin32 option requirement under
	cygwin.
	* win/configure: Regenerate.
d73 3
a75 1
2001-09-13  Ian Roxborough  <irox@@redhat.com>
d77 1
a77 45
	* generic/tclStubInit.tcl: Export tclAlloc functions
	if __MINGW32__ is defined.
	* generic/tclAlloc.c: Revert changes from 2001-09-12.
	* generic/tcl.h: Use tclAlloc function if __WIN32__
	is defined.
	* win/tclWinPort.h: Fixed typer __MWIN32 should read
	__WIN32__.

2001-09-12  Ian Roxborough  <irox@@redhat.com>

	* Makefile.in: Add 'cygwin' subdirectory to 'make all'
	target.
	* configure.in: Configure 'cygwin' and 'win' directory
	for a cygwin host.
	* configure: Regenerated.
	* cygwin/configure.in: Change version number to 8.3.
	* cygwin/configure: Regenerated.
	* cygwin/Makefile.am: Added/removed files to be build
	for Tcl8.3.
	* cygwin/Makefile.in: Regenerated.
	* generic/tcl.h: Don't define __WIN32__ for cygwin or
	mwing32 builds.  Don't define USE_TCLALLOC when building
	for cygwin.  Don't use __declspec unless building Tcl or
	tk or build with USE_TCL_STUBS.
	* generic/tclAlloc.c: For cygwin hosts, don't using
	anything in this file unless build with __TCL_UNIX_VARIANT.
	* generic/tclClock.c: Declare 'timezone' as an int, if it
	hasn't been #defined.
	* generic/tclStubInit.c: Don't export any tclAlloc function
	when build for a cygwin host.
	* win/configure.in: Set DL_LIBS and MATH_LIBS.  Create
	unix/tclConfig.sh.
	* win/configure: Regenerated.
	* win/tclWinPort.h: Added missing #endif.
	* win/tclWinFile.c (TclpChdir): Don't invert change
	directory results on cygwin.
	
2001-08-08  Mo DeJong  <mdejong@@redhat.com>

	* cygtcl.m4 (TCL_TOOL_PATH, TCL_TOOL_SHARED_LIB_LONGNAME):
	Raise an error if the CYGPATH variable is not defined when
	TCL_TOOL_PATH is invoked. Add cygwin to the list of hosts
	that do not use a "lib" prefix for shared library names.
	* unix/configure: Regen.
	* win/configure: Regen.
d79 2
a80 1
2001-08-06  Mo DeJong  <mdejong@@redhat.com>
d82 1
a82 39
	* cygtcl.m4 (TCL_TOOL_STATIC_LIB_LONGNAME,
	TCL_TOOL_SHARED_LIB_LONGNAME,
	TCL_TOOL_LIB_SHORTNAME): Use TCL_VENDOR_PREFIX instead
	of VENDORPREFIX to support using these macros in
	extensions that load tclConfig.sh.
	* unix/configure: Regen.
	* unix/configure.in: Subst VENDORPREFIX into tclConfig.sh.
	* unix/tclConfig.sh.in: Add TCL_VENDOR_PREFIX.
	* win/configure: Regen.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Set vendor prefix to "rh"
	instead of "sn" when compiling with VC++ or gcc. When
	compiling with Cygwin set the prefix to "cyg". Set the
	TCL_VENDOR_PREFIX to support the tcl tool macros in Tcl.
	* win/tclConfig.sh.in: Add TCL_VENDOR_PREFIX.

2001-08-06  Mo DeJong  <mdejong@@redhat.com>

	* win/Makefile.in: Subst DDE_DLL_FILE, DDE_LIB_FILE, REG_DLL_FILE,
	REG_LIB_FILE, and PIPE_DLL_FILE from the configure script instead
	of figuring them out in the Makefile.
	* win/configure: Regen.
	* win/configure.in: Use TCL_TOOL_STATIC_LIB_LONGNAME and
	TCL_TOOL_SHARED_LIB_LONGNAME macros to figure out values for
	DDE_DLL_FILE, DDE_LIB_FILE, REG_DLL_FILE, REG_LIB_FILE, and
	PIPE_DLL_FILE and subst them into the Makefile.

2001-08-01  Mo DeJong  <mdejong@@redhat.com>

	* cygtcl.m4 (TCL_TOOL_STATIC_LIB_LONGNAME,
	TCL_TOOL_SHARED_LIB_LONGNAME): Rename
	TCL_TOOL_LIB_LONGNAME to TCL_TOOL_STATIC_LIB_LONGNAME.
	Add new TCL_TOOL_SHARED_LIB_LONGNAME to construct
	shared library names in a cross platform way.
	* unix/configure: Regen.
	* unix/configure.in: Use TCL_TOOL_SHARED_LIB_LONGNAME
	and TCL_TOOL_STATIC_LIB_LONGNAME to generate lib names.
	* win/configure: Regen.
	* win/configure.in: Use TCL_TOOL_SHARED_LIB_LONGNAME
	and TCL_TOOL_STATIC_LIB_LONGNAME to generate lib names.
d84 3
a86 1
2001-07-24  Mo DeJong  <mdejong@@redhat.com>
d88 1
a88 13
	* win/configure:
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Don't pass explicit
	Cygwin libs on the command line since linking is now
	done using $CC and not $LD.

2001-07-24  Mo DeJong  <mdejong@@redhat.com>

	* win/tclWinThrd.c (Tcl_CreateThread, TclpThreadExit):
	When building under Cygwin, call CreateThread instead
	of _beginthreadex and call ExitThread instead of
	_endthreadex. Cygwin does not support these msvcrt
	methods and does not suffer from the memory leak
	problems that prompted their use.
d90 1
a90 1
2001-07-24  Mo DeJong  <mdejong@@redhat.com>
d92 3
a94 7
	* win/configure: Regen.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Check for bug in
	Cygwin version of windres and work around that
	case by passing a POSIX path instead of a Windows
	native path. One can't always pass a POSIX path
	because the mingw native toolchain accepts only
	Windows native paths.
d96 1
a96 1
2001-07-24  Mo DeJong  <mdejong@@redhat.com>
d98 4
a101 4
	* win/tclWinThrd.c (Tcl_CreateThread): Close Windows
	HANDLE returned by _beginthreadex. The MS documentation
	states that this handle is not closed by a later call to
	_endthreadex.
d103 1
a103 1
2001-07-17  Frank Ch. Eigler  <fche@@redhat.com>
d105 11
a115 2
	* generic/tclInitScript.h (initScript): Check that nameofexecutable
	is valid (file exists) before traversing it as a possible link.
d117 1
a117 1
2001-07-16  Mo DeJong  <mdejong@@redhat.com>
d119 6
a124 5
	* generic/tcl.h: Define __WIN32__ when
	__CYGWIN__ or __MINGW32__ is defined.
	* generic/tclAlloc.c: Define caddr_t when
	compiling with VC++ or mingw. This type is
	already defined when compiling with Cygwin.
d126 1
a126 1
2001-07-16  Mo DeJong  <mdejong@@redhat.com>
d128 4
a131 7
	* win/tclWinConsole.c:
	* win/tclWinPipe.c:
	* win/tclWinPort.h:
	* win/tclWinThrd.c:
	Remove unnecessary #includes of dos.h, direct.h,
	and tchar.h. This will help the Cygwin porting
	effort since these headers do not exist under Cygwin.
d133 1
a133 1
2001-07-12  Mo DeJong  <mdejong@@redhat.com>
d135 1
a135 12
	* unix/Makefile.in:
	* unix/configure: Regen.
	* unix/configure.in:
	* unix/tcl.m4:
	* win/Makefile.in:
	* win/configure: Regen.
	* win/configure.in:
	* win/tcl.m4:
	Revert ill-conceived EXTRA_CFLAGS changes made on 2001-07-09.
	The change ended up causing big problems with the
	tclConfig.sh file since	it exported EXTRA_CFLAGS and did
	not deal with the debug/non-debug case.
d137 1
a137 1
2001-07-11  Mo DeJong  <mdejong@@redhat.com>
d139 1
a139 3
	* unix/configure: Regen.
 	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Avoid using AC_CHECK_TOOL
	since Tcl's configure script is not setup properly.
d141 1
a141 1
2001-07-11  Mo DeJong  <mdejong@@redhat.com>
d143 5
a147 11
	* unix/Makefile.in: Add AR variable for use in STLIB_LD.
	* unix/configure: Regen.
	* unix/configure.in: Use STLIB_LD when defining MAKE_LIB
	and MAKE_STUB_LIB. Subst RANLIB and AR.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Add doc comment about
	STLIB_LD command. Check ${AR} env var when setting
	STLIB_LD and delay evaluation until make time.
	* win/configure: Regen.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Pass AR arguments in
	STLIB_LD to better match the Unix implementation. Don't
	bother defining AR when using VC++ since it is not used.
d149 6
a154 1
2001-07-10  Mo DeJong  <mdejong@@redhat.com>
d156 2
a157 3
	* win/configure:
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Use STLIB_LD in MAKE_LIB instead
	of AR which can be overridden on the make command line.
d159 1
a159 1
2001-07-09  Mo DeJong  <mdejong@@redhat.com>
d161 3
a163 3
	* win/configure:
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Fix quoting of CYGPATH
	argument to AC_CHECK_PROG.
d165 3
a167 1
2001-07-09  Mo DeJong  <mdejong@@redhat.com>
d169 3
a171 21
	* unix/Makefile.in: Add EXTRA_CFLAGS_DEBUG and EXTRA_CFLAGS_OPTIMIZE
	variables. These two do not actually differ in the unix version
	but are there to keep in sync with the Windows version.
	* unix/configure: Regen.
	* unix/configure.in: Don't subst EXTRA_CFLAGS. Subst EXTRA_CFLAGS_DEFAULT,
	EXTRA_CFLAGS_DEBUG, and EXTRA_CFLAGS_OPTIMIZE.
	* unix/tcl.m4 (SC_ENABLE_SYMBOLS, SC_CONFIG_CFLAGS): Define
	EXTRA_CFLAGS_DEFAULT based on the --enable-smbols option.
	Set EXTRA_CFLAGS_DEBUG instead of EXTRA_CFLAGS and then set
	EXTRA_CFLAGS_OPTIMIZE to the value of EXTRA_CFLAGS_DEBUG since
	they are the same under Unix.
	* win/Makefile.in: Add EXTRA_CFLAGS_DEBUG and EXTRA_CFLAGS_OPTIMIZE
	variables. This is needed so that the proper runtime lib gets linked
	into VC++ produced .obj files when CFLAGS is reset on the command line.
	* win/configure: Regen.
	* win/configure.in: Don't subst EXTRA_CFLAGS. Subst EXTRA_CFLAGS_DEFAULT,
	EXTRA_CFLAGS_DEBUG, and EXTRA_CFLAGS_OPTIMIZE.
	* win/tcl.m4 :(SC_ENABLE_SYMBOLS, SC_CONFIG_CFLAGS): Define
	EXTRA_CFLAGS_DEFAULT based on the --enable-smbols option. Set
	EXTRA_CFLAGS_DEBUG and EXTRA_CFLAGS_OPTIMIZE based on the runtime
	option when compiled with VC++.
d173 1
a173 1
2001-07-06  Mo DeJong  <mdejong@@redhat.com>
d175 2
a176 5
	* win/configure: Regen.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Pass -e _WinMain@@16 in
	addition to the -mwindows flag to work around a problem
	with ld when it incorrectly uses main() as the executable
	entry point when both WinMain() and main() are available.
d178 1
a178 1
2001-07-06  Mo DeJong  <mdejong@@redhat.com>
d180 1
a180 31
	* unix/configure: Regen.
	* unix/configure.in: Replace call to SC_ENABLE_GCC with
	AC_PROG_CC so that CC passed in from the caller is respected.
	* unix/tcl.m4: Remove the unused SC_ENABLE_GCC macro.
	* win/configure: Regen.
	* win/configure.in: Replace call to SC_ENABLE_GCC with
	AC_PROG_CC so that CC passed in from the caller is respected.
	* win/tcl.m4: Remove unused SC_ENABLE_GCC macro.

2001-07-06  Mo DeJong  <mdejong@@redhat.com>

	* win/Makefile.in: Subst DEPARG directly instead
        of relying on a variable. This will make Cygwin
        builds faster since an extra exec will be avoided.
	* win/configure: Regen.
	* win/configure.in: Subst DEPARG.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Set DEPARG based
	on CYGPATH.

2001-06-26  Mo DeJong  <mdejong@@redhat.com>

	* cygtcl.m4 (TCL_TOOL_PATH): Use CYGPATH variable instead of
	invoking cygpath directly. Handle cross compile by not
	using CYGPATH when set to echo.
	* unix/configure: Regen.
	* win/Makefile.in: Remove PATHTYPE variable.
	* win/configure: regen.
	* win/configure.in: Remove PATHTYPE subst + extra CYGPATH subst.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Remove PATHTYPE variable. Search
	for cygpath in the PATH and set CYGPATH="cygpath -w" if found.
	Remove old cross compiling hack.
d182 3
a184 1
2001-06-26  Mo DeJong  <mdejong@@redhat.com>
d186 1
a186 5
	* win/Makefile.in: Don't use VPSEP in the VPATH,
	just use : as the spearator.
	* win/configure: Regen.
	* win/configure.in: Don't subst VPSEP.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Remove VPSEP.
d188 1
a188 1
2001-06-25  Mo DeJong  <mdejong@@redhat.com>
d190 1
a190 27
	* win/configure: Regen.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): When building with
	gcc, don't attempt to link with LD or support dllwrap.
	Simply require a recent version of Cygwin gcc or Mingw
	gcc that supports -shared. When linking, use gcc instead
	of ld since gcc automatically includes libs like -lmsvcrt.

2001-06-22  Mo DeJong  <mdejong@@redhat.com>

	* unix/Makefile.in: Set CFLAGS to @@CFLAGS@@ and @@CFLAGS_DEFAULT@@.
	Set LDFLAGS to @@LDFLAGS@@ and @@LDFLAGS_DEFAULT@@. Add LDFLAGS_DEBUG
	and LDFLAGS_OPTIMIZE to match the way CFLAGS_DEFAULT works.
	This will support user set CFLAGS or LDFLAGS at configure time.
	* unix/configure: Regen.
	* unix/configure.in: Don't set CFLAGS to CFLAGS_DEFAULT, instead
	subst CFLAGS_DEFAULT into the Makefile. Add AC_SUBST for CFLAGS_DEFAULT,
	LDFLAGS_DEFAULT, LDFLAGS_DEBUG, and LDFLAGS_OPTIMIZE.
	* unix/tcl.m4 (SC_ENABLE_SYMBOLS): Modify LDFLAGS_DEFAULT so that
	it uses a Makefile variable just like CFLAGS_DEFAULT.
	* win/Makefile.in: Set CFLAGS to @@CFLAGS@@ and @@CFLAGS_DEFAULT@@.
	Set LDFLAGS to @@LDFLAGS@@ and @@LDFLAGS_DEFAULT@@.
	This will support user set CFLAGS or LDFLAGS at configure time.
	* win/configure: Regen.
	* win/configure.in: Don't set CFLAGS or LDFLAGS, instead subst
	CFLAGS_DEFAULT and LDFLAGS_DEFAULT into the Makefile.
	* win/tcl.m4 (SC_ENABLE_SYMBOLS): Modify LDFLAGS_DEFAULT so that
	it uses a Makefile variable just like CFLAGS_DEFAULT.
d192 5
a196 1
2001-06-22  Mo DeJong  <mdejong@@redhat.com>
d198 2
a199 10
	* configure: Regen.
	* configure.in: When a windows32 host is detected
	configure in the win subdirectory.
	* cygtcl.m4 (TCL_TOOL_PATH, TCL_TOOL_LIB_LONGNAME,
	TCL_TOOL_LIB_SHORTNAME, TCL_TOOL_LIB_SPEC):
	Add support for mingw32 and windows32 hosts. Remove
	check for cygwin since we are really cross compiling
	when building win32 executables.
	* unix/configure: Regen.
	* win/configure: Regen.
d201 1
a201 1
2001-06-22  Mo DeJong  <mdejong@@redhat.com>
d203 3
a205 35
	* win/configure:
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Don't set LDFLAGS_DEBUG
	to -g or LDFLAGS_OPTIMIZE to -O when compiling with gcc.
	These flags are not needed and can cause problems with
	the Cygwin version of ld.

2001-06-20  Mo DeJong  <mdejong@@redhat.com>

	* generic/tcl.h: Define __WIN32__ when __MINGW32__
	is defined to support building under Cygwin gcc
	with the -mno-cygwin flag.

2001-06-14  Mo DeJong  <mdejong@@redhat.com>

	* unix/Makefile.in: Avoid burning install TCL_LIBRARY into
	tclUnixInit.o at compile time.
	* unix/tclUnixInit.c (TclpInitLibraryPath): Fix location
	independence by searching for Tcl library in share/tclX.X
	instead of lib/tclX.X. This logic is no longer effected by a
	burned in TCL_LIBRARY.
	* win/tclWinInit.c (TclpInitLibraryPath): Search for Tcl library
	in share/tclX.X instead of lib/tclX.X. Remove a couple of
	Cygnus local hacks since they were not doing anything useful.

2001-06-08  Mo DeJong  <mdejong@@redhat.com>

	* win/Makefile.in: Set TCL_LIBRARY to
	$INSTALL/share/tcl8.3 instead of
	$INSTALL/lib/tcl8.3.

2001-06-08  Mo DeJong  <mdejong@@redhat.com>

	* win/tclConfig.sh.in: Correct the definition
	of TCL_LIB_FULL_PATH. It was inclosed in `
	characters instead of ' characters.
d207 1
a207 1
2001-06-05  Mo DeJong  <mdejong@@redhat.com>
d209 2
a210 4
	* unix/configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Add a TCL_LIB_SUFFIX variable
	to make the TCL_TOOL_LIB_SHORTNAME macro happy.
	* unix/tclConfig.sh.in: Add TCL_LIB_SUFFIX variable.
d212 1
a212 1
2001-06-05  Mo DeJong  <mdejong@@redhat.com>
d214 3
a216 4
	* cygtcl.m4 (TCL_TOOL_LIB_PATH): Call TCL_TOOL_PATH so that a
	Windows native path is generated for PATH variables.
	* unix/configure: Regen.
	* win/configure: Regen.
d218 1
a218 1
2001-06-01  Mo DeJong  <mdejong@@redhat.com>
d220 6
a225 9
	* cygtcl.m4 (TCL_TOOL_PATH, TCL_TOOL_LIB_SHORTNAME): Check that argument to
	TCL_TOOL_PATH is not "". Use new TCL_LIB_SUFFIX variable in the
	TCL_TOOL_LIB_SHORTNAME macro under Windows.
	* unix/configure: Regen.
	* win/configure: Regen.
	* win/configure.in: Don't subst SHLIB_SUFFIX.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Set TCL_LIB_SUFFIX so that Tcl
	sees the same variable name that an extension will.
	* win/tclConfig.sh.in: Set the TCL_SHLIB_SUFFIX and TCL_LIB_SUFFIX vars.
d227 3
a229 1
2001-05-30  Mo DeJong  <mdejong@@redhat.com>
d231 1
a231 4
	* unix/configure: Regen.
	* unix/tcl.m4 (SC_PATH_TCLCONFIG, SC_PATH_TKCONFIG):
	Check in win subdirectory in addition to unix subdirectory for
	tclConfig.sh and tkConfig.sh files.
d233 6
a238 1
2001-05-30  Mo DeJong  <mdejong@@redhat.com>
d240 2
a241 21
	* cygtcl.m4: Add FIXME note.
	* unix/configure: Regen.
	* unix/tcl.m4 (SC_PATH_TCLCONFIG, SC_PATH_TKCONFIG):
	Generate an error instead of a warning if the Tcl, or Tk
	configuration files cannot be found.

2001-05-26  Mo DeJong  <mdejong@@redhat.com>

	* cygtcl.m4 (TCL_TOOL_PATH, TCL_TOOL_LIB_LONGNAME,
	TCL_TOOL_LIB_SHORTNAME, TCL_TOOL_LIB_SPEC): Create cross
	platform versions of the TCL_TOOL* macros.
	* unix/aclocal.m4: Include ../cygtcl.m4.
	* unix/configure: Regen.
	* unix/tcl.m4 (TCL_TOOL_PATH, TCL_TOOL_LIB_LONGNAME,
	TCL_TOOL_LIB_SHORTNAME, TCL_TOOL_LIB_SPEC): Remove macros.
	* win/aclocal.m4: Include ../cygtcl.m4.
	* win/configure: Regen.
	* win/tcl.m4 (TCL_TOOL_PATH, TCL_TOOL_LIB_LONGNAME,
	TCL_TOOL_LIB_SHORTNAME, TCL_TOOL_LIB_SPEC): Remove macros.
	
2001-05-24  Mo DeJong  <mdejong@@redhat.com>
d243 1
a243 3
	* unix/configure: Regen.
	* unix/configure.in: Add missing TCL_LIB_FULL_PATH
	variable.
d245 2
a246 1
2001-05-11  Mo DeJong  <mdejong@@redhat.com>
d248 2
a249 5
	* unix/configure:
	* unix/tcl.m4 (SC_ENABLE_SYMBOLS):
	* win/configure:
	* win/tcl.m4 (SC_ENABLE_SYMBOLS): Back port of CFLAGS_DEFAULT fix
	from Tcl 8.4. A Makefile variable name is now used for the CFLAGS.
d251 2
a252 1
2001-05-09  Mo DeJong  <mdejong@@redhat.com>
d254 2
a255 3
	* win/tcl.m4 (TCL_TOOL_PATH): Assign literal macro
	value to a tmp variable before running cygpath
	thus avoiding a problem with a quoted argument.
d257 2
a258 1
2001-05-09  Mo DeJong  <mdejong@@redhat.com>
d260 1
a260 13
	* unix/Makefile.in: Use TCL_STUB_LIB_FILE instead of
	STUB_LIB_FILE subst when defining STUB_LIB_FILE.
	* unix/configure: Regen.
	* unix/configure.in: Use new path macros.
	* unix/tcl.m4 (TCL_TOOL_LIB_LONGNAME, TCL_TOOL_LIB_SHORTNAME,
	TCL_TOOL_LIB_SPEC, TCL_TOOL_LIB_PATH): Add macros
	to deal with library path translations.
	* win/Makefile.in: Add FIXME note.
	* win/configure: Regen.
	* win/configure.in: Use new path macros.
	* win/tcl.m4 (TCL_TOOL_LIB_LONGNAME, TCL_TOOL_LIB_SHORTNAME,
	TCL_TOOL_LIB_SPEC, TCL_TOOL_LIB_PATH): Add macros
	to deal with library path translations.
d262 1
a262 1
2001-04-09  Mo DeJong  <mdejong@@redhat.com>
d264 10
a273 23
	* unix/configure: Regen.
	* unix/tcl.m4: Add placeholder TCL_TOOL_PATH macro.
	* win/configure: Regen.
	* win/configure.in: Set TCL_LIB_FLAG, TCL_BUILD_LIB_SPEC,
	TCL_LIB_SPEC, TCL_LIB_FULL_PATH and subst them.
	* win/tcl.m4: Add TCL_TOOL_PATH macro, it will call
	cygpath -w and replace \ with / to create a native
	Windows path that VC++ will understand.
	* win/tclConfig.sh.in: Add TCL_LIB_FULL_PATH variable.

2001-04-06  Christopher Faylor <cgf@@redhat.com>

	Throughout change __CYGWIN32__ to __CYGWIN__.
	* cygwin/configure.in: When targeting cygwin, detect if C compiler
	supports -mno-win32 flag and use it if so.
	* cygwin/Makefile.in (EXTRA_CFLAGS): New variable.  Holds results of
	-mno-win32 test.
	(COMPILE): Add EXTRA_CFLAGS variable to options.
	* generic/tclEnv.c: Only compile special Cygwin code if building under
	Cygwin and want native windows understanding.
	* win/tclWin32Dll.c (DllMain): #ifdef out CYGWIN impure_ptr stuff.
	* win/Makefile.in: Add -D__USE_W32_SOCKETS to accomodate newer
	newlib/w32api conventions.
d275 50
a324 1
2001-04-05  Mo DeJong  <mdejong@@redhat.com>
d326 1
a326 5
	* win/configure: Regen.
	* win/configure.in: Subst the TCL_LIB_VERSIONS_OK variable.
	* win/tcl.m4: Add Cygnus local search for tcl8.1/win directory. Add
	TCL_LIB_VERSIONS_OK variable, it will get substituted into the
	tclConfig.sh file. Remve the SC_PROG_TCLSH macro.
d328 5
a332 1
2001-04-05  Mo DeJong  <mdejong@@redhat.com>
d334 1
a334 3
	* generic/tclAlloc.c:
	* win/tclWinPort.h:
	Check for #define of WIN32 instead of VC++ specific symbol.
d336 2
a337 1
2001-03-31  Mo DeJong  <mdejong@@redhat.com>
d339 1
a339 6
	* unix/Makefile.in: Remove second
	assignment to SCRIPT_INSTALL_DIR
	variable. This seems to have been
	a merge error. It was installing
	Tcl lib files in the lib directory
	instead of share/tcl8.3.
d341 6
a346 1
2001-03-28  Ian Roxborough  <irox@@redhat.com>
d348 1
a348 2
	* unix/tclConfig.sh.in: Set TCL_CFLAGS to CFLAGS,
	otherwise tclConfig.sh won't work correctly.
d350 3
a352 1
2000-09-15  Syd Polk  <spolk@@redhat.com>
d354 1
a354 1
	* Updated for the 8.3.2 release.
d356 2
a357 1
2000-08-08  Jeff Hobbs  <hobbs@@ajubasolutions.com>
d359 1
a359 1
	8.3.2 RELEASE finalized
d361 5
a365 1
	* changes: updated for release notes version of ChangeLog
d367 7
a373 2
	* library/msgcat1.0/pkgIndex.tcl: 
	* library/msgcat1.0/msgcat.tcl: bumped msgcat version to 1.1.
d375 1
a375 1
2000-08-07  Jeff Hobbs  <hobbs@@ajubasolutions.com>
d377 1
a377 3
	* doc/ChnlStack.3:
	* doc/CrtChannel.3: updated the docs to be aware of the
	TCL_CHANNEL_VERSION_2 style of Tcl channels.
d379 2
a380 3
	* generic/tclIO.c (Tcl_CreateChannel): added assertion to verify
	that the new channel versioning will be binary compatible with
	older channel drivers.
d382 1
a382 1
	* BACKPORTED FROM 8.4 (HEAD) BRANCH:
d384 1
a384 2
	* doc/memory.n: Man page for Tcl "memory" command, which is
	created when TCL_MEM_DEBUG is defined at compile time.
d386 1
a386 2
	* doc/TCL_MEM_DEBUG.3: Man page with overall information about
	TCL_MEM_DEBUG usage.
d388 1
a388 2
	* doc/DumpActiveMemory.3: Man page for Tcl_DumpActiveMemory,
	Tcl_InitMemory, and Tcl_ValidateAllMemory [Bug: 1816, 1835].
d390 1
a390 1
	* doc/Init.3: Man page for Tcl_Init [Bug: 1820].
d392 4
a395 1
	* unix/Makefile.in: add tclsh.ico and tcl.spec to dist target
d397 2
a398 4
	* unix/mkLinks: Regen'd with new mkLinks.tcl.
	* unix/mkLinks.tcl: Fixed indentation, made link setup more
	intelligent (only do one existance test per man page, instead of
	one per function).
d400 1
a400 10
	* doc/AddErrInfo.3:
	* doc/ChnlStack.3:
	* doc/Exit.3:
	* doc/GetIndex.3:
	* doc/Notifier.3:
	* doc/Object.3:
	* doc/RegExp.3:
	* doc/SetResult.3:
	* doc/SplitList.3:
	* doc/Thread.3:  Added missing entries to NAME section.
d402 2
a403 3
	* doc/AddErrInfo.3:
	* doc/CrtObjCmd.3:
	* doc/RecEvalObj.3: Changed Tcl_EvalObj to Tcl_EvalObjEx
d405 1
a405 6
	* doc/library.n: Added entries for auto_qualify and auto_import
	[Bug: 1271].
	* doc/library.n: Fixed .SH NAME macro to include each function
	documented on the page, so that mkLinks will know about the
	functions listed there, and so that the Windows help file index
	will get set up correctly [Bug: 1898, 5273].
d407 1
a407 2
	* doc/expr.n: Added documentation for each of the math library
	functions that expr supports [Bug: 1054].
d409 2
a410 1
	* doc/regsub.n: correct regsub docs [Bug: 5346]
d412 1
a412 1
	* doc/scan.n: minor doc fixes [Bug: 5396]
d414 4
a417 2
	* doc/RegExp.3: Replaced instances of "Tcl_GetRegExpInfo" with
	"Tcl_RegExpGetInfo", the correct name of the function [Bug: 5901].
d419 2
a420 2
	* doc/package.n: Corrected information about [package forget]
	arguments [Bug: 5418].
d422 1
a422 1
	* generic/tclCkalloc.c: Fixed some function headers.
d424 2
a425 2
	* tests/clock.test: Added test for "2 days 2 hours ago" style
	specifications.
d427 1
a427 1
	* generic/tclDate.c: Regenerated from tclGetDate.y.
d429 1
a429 3
	* generic/tclGetDate.y: Tweaked grammar to properly handle the
	"ago" keyword when it follows multiple relative unit specifiers,
	as in "2 days 2 hours ago".  [Bug: 5497].
d431 1
a431 2
	* generic/tclClock.c (FormatClock): correct code to handle locale
	specific return values from strftime, if any. [Bug: 3345]
d433 2
a434 3
	* unix/tclUnixInit.c (TclpSetInitialEncodings): attempt to
	correct setlocale calls for XIM support and locale issues.
	[BUG: 5422 3345 4236 2522 2521]
d436 2
a437 2
	* library/init.tcl (auto_import): added check to see if a valid
	pattern was coming in, to avoid simple error cases [Bug: 3326]
d439 3
a441 3
	* library/history.tcl: Corrected an off-by-one error in HistIndex,
	which was causing [history redo] to start its search at the wrong
	event index. [Bug: 1269].
d443 9
a451 2
	* generic/tclPosixStr.c (Tcl_SignalMsg): clarified #defines for
	Linux on Sparc to compile correctly. [Bug: 5364]
d453 3
a455 2
	* generic/tclEnv.c: cast cleanup [Bug: 5624]
	* win/tclWinFCmd.c: cast cleanup [Bug: 5627]
d457 3
a459 3
	* generic/tclIndexObj.c (Tcl_GetIndexFromObjStruct): Corrected
	caching of the index ptr to account for offsets != sizeof(char *).
	[Bug: 5153]
d461 2
a462 3
	* tests/opt.test:
	* library/opt0.4/optparse.tcl: Applied patch from [Bug: 5922], which 
	corrected an incorrect use of [string match].
d464 2
a465 3
	* tests/stringObj.test: Tweaked tests to avoid hardcoded
	high-ASCII characters (which will fail in multibyte locales);
	instead used \uXXXX syntax. [Bug: 3842].
d467 2
a468 1
2000-08-05  Jeff Hobbs  <hobbs@@scriptics.com>
d470 1
a470 3
	* generic/tclIOGT.c (TclChannelTransform): fixed segfault that
	would occur when transforming a channel with a proc that did not
	yet exist. (Kupries)
d472 2
a473 2
	* generic/tclTest.c (TestChannelCmd): added some lint init'ing of
	statePtr and chan vars.
d475 1
a475 1
2000-07-28  Mo DeJong  <mdejong@@redhat.com>
d477 1
a477 5
	* win/Makefile.in:
	* win/configure.in:
	* win/tcl.m4:
	* win/tclConfig.sh.in: Back port of gcc for windows
	build system from 8.4.
d479 1
a479 1
2000-07-26  Jeff Hobbs  <hobbs@@scriptics.com>
d481 1
a481 2
	* merged core-8-3-1-io-rewrite back into core-8-3-1-branch.
	The core-8-3-1-io-rewrite branch should now be considered defunct.
d483 10
a492 3
	* generic/tclStubInit.c:
	* generic/tclDecls.h:
	* generic/tcl.decls:
d494 14
a507 43
	* generic/tclIO.c: moved the Tcl_Channel* macros from tcl.h to
	tclIO.c and made them proper stubbed functions.  These are:
	Tcl_ChannelName, Tcl_ChannelVersion, Tcl_ChannelBlockModeProc,
	Tcl_ChannelCloseProc, Tcl_ChannelClose2Proc, Tcl_ChannelInputProc,
	Tcl_ChannelOutputProc, Tcl_ChannelSeekProc, Tcl_ChannelSetOptionProc,
	Tcl_ChannelGetOptionProc, Tcl_ChannelWatchProc,
	Tcl_ChannelGetHandleProc, Tcl_ChannelFlushProc,
	and Tcl_ChannelHandlerProc.  These should be used to access the
	Tcl_ChannelType structure instead of direct pointer dereferencing.

	* unix/Makefile.in: undid 07-25 Makefile.in changes because we
	don't really want to force all private makefiles on everyone.
	This needs to be addressed again in the future.  Best possible
	solution is to create a tcl/ subdir in the installing include dir
	(as is done already with the lib dir).

	* tests/iogt.test: added RCS string, marked tests 2.* to be
	unixOnly due to underlying system differences.

	* tests/all.tcl: corrected additional sets by Kupries for testing.

2000-07-26  Syd Polk  <spolk@@redhat.com>

	* win/tcl.m4: Building libraries is significantly different on Cygwin
	now; rewhacked.
	* win/configure.in: Ditto.
	* win/Makefile.in: Ditto.
	* win/configure: Regenerated.
	* win/tclWinPort.h: tchar.h and direct.h are not defined on Cygwin,
	nor or they needed.


2000-07-25 Brent Welch	<welch@@ajubasolutions.com>

	* unix/Makefile.in: Need to install all the Tcl headers because
	Itcl depends on internal headers.

2000-07-25 Andreas Kupries <a.kupries@@westend.com>

	* tests/iogt.test: (line 866f) New tests iogt-6.[01], highlighting
 	  buffering trouble when stacking and unstacking transformations.
	  iogt-6.0 is solved, see the changes below. iogt-6.1 remains, for
 	  now, due to the perceived complexity of solutions.
d509 1
a509 38
	* generic/tclIO.h: (line 139f) struct Channel, added a buffer
	  queue, to hold data pushed back when stacking a transformation.

	* generic/tclIO.c:
	  (line 91f, line 7434f) New internal function 'CopyBuffer'.
	  Derived from 'CopyAndTranslateBuffer', with translation
	  removed.
	  (line 1025f, line 1212f): Initialization of new queue.
	  (line 1164f, Tcl_StackChannel): Pushback of input queue.
	  (line 1293f, Tcl_UnstackChannel): Discard input and pushback.
	  (line 3748f, Tcl_ReadRaw): Modified to use data in the push back
	  area before going to the driver. Uses 'CopyBuffer', s.a.
	  (line 4702f, GetInput): Modified to use data in the push back
	  area before going to the driver.
 	  (line 4867f, Tcl_Seek): Modified to take pushback of the topmost
	  channel in a stack into account.
	  (line 5620f, Tcl_InputBuffered): See above. Added
	  'Tcl_ChannelBuffered'. Analogue to 'Tcl_InputBuffered' but for
	  the buffer area in the channel.

	* generic/tcl.decls: New public API 'Tcl_ChannelBuffered'. S.a.

2000-07-19  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/socket.test: removed doTestsWithRemoteServer constraint
	from socket-12.*.  It requires 'exec', not a remote server.
	Cleaned up some coding errors.

2000-07-18 Brent Welch	<welch@@ajubasolutions.com>

	* win/Makefile.in: Added rules for static tcldde and tclreg libraries.

2000-07-17  Jeff Hobbs  <hobbs@@scriptics.com>

	* README:
	* win/README:
	* win/README.binary:
	* win/configure.in:
d511 19
a529 3
	* unix/tcl.spec:
	* tools/tcl.wse.in:
	* generic/tcl.h (TCL_RELEASE_SERIAL): updated to patchlevel 8.3.2
d531 2
a532 3
	* unix/Makefile.in:
	* win/Makefile.in:
	* win/makefile.vc: added tclIOGT.c to objects list to compile.
d534 1
d536 1
a536 41
	* generic/tclIntDecls.h:
	* generic/tclInt.decls: commented out internal decls for
	TclTestChannelCmd and TclTestChannelEventCmd as they were moved to
	tclTest.c.  Added new decls for TclChannelEventScriptInvoker and
	TclChannelTransform.

	* generic/tclIO.h: new file that contains the main internal
	structures of Tcl_Channel code to allow for multiple files to
	access them.
	* generic/tclTest.c:
	* generic/tclIO.c: broke into 3 files - tclIO.c core code, tclIO.h
	header code, and tclIOGT.c - the giot test code from Kupries.  The
	channel test code also moved to tclTest.c.
	* generic/tclIO.c (CloseChannel): stopped masking out of the
	TCL_READABLE|TCL_WRITABLE bits from the state flags in
	CloseChannel, instead adding extra intelligence to
	CheckChannelErrors with a new CHANNEL_RAW_MODE bit for special
	behavior when called from Raw channel APIs.

2000-07-13  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclIO.c (StackSetBlockMode): moved set of chanPtr
	outside of blockModeProc check to avoid infinite loop when
	blockModeProc was NULL (Kupries).  updated TransformSeekProc to
	not call Tcl_Seek directly (Kupries).

	* win/tclWinChan.c: updated fileChannelType to v2 channel struct
	* win/tclWinConsole.c: updated consoleChannelType to v2 channel struct
	* win/tclWinPipe.c: updated pipeChannelType to v2 channel struct
	* win/tclWinSerial.c: updated serialChannelType to v2 channel struct
	* win/tclWinSock.c: updated tcpChannelType to v2 channel struct

2000-07-11  Brent Welch	<welch@@ajubasolutions.com>

	* win/tclConfig.sh.in: Cleaned up unix-specific autoconf variables.

2000-07-11  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/iogt.test: made tests [345].0 not run by default as they
	were failing in the new design, but I'm not convinced that the
	returned result isn't correct.
d538 1
a538 37
	* generic/tclDecls.h:
	* generic/tclStubInit.c:
	* generic/tcl.decls: added Tcl_GetTopChannel C API that returns
	the current top channel of a channel stack.  Tcl_GetChannel was
	changed earlier to return the bottommost channel of a stack
	because that is the one that is guaranteed to stay around the
	longest, and this was needed to compensate for certain
	operations that want to look at the state of the main channel.
	Most channel APIs already compensate for grabbing the top, so it
	shouldn't be needed often.

	* generic/tclIO.c (Tcl_StackChannel, Tcl_UnstackChannel): Added
	flushing of buffers (Kupries), removed use of DownChannel macro,
	added Tcl_GetTopChannel public API to get to the top channel of
	the channel stack (necessary for TLS).  Rewrote Tcl_NotifyChannel
	for new channel design (Kupries).  Did some code cleanup in the
	transform code.  tclIO.c must still be broken into bits (separate
	out test code and giot code, create tclIO.h).

2000-07-10  Andreas Kupries <a.kupries@@westend.com>

	* tests/iogt.test: Reverted some earlier changes as a fix by Jeff
	  revived the original and correct behaviour. IOW, the tests showed
	  a genuine error and I didn't see it :(.

	* generic/tclIO.c (Tcl_Read|Write_Raw): Changed to directly use
 	  the drivers and not DoRead|DoWrite. The latter use the buffering
 	  system, encoding and eol-translation and this wreaks havoc with
 	  the data going through the transformations. Both procedures use
 	  CheckForchannelErrors and let it believe that there is no
 	  background copy in progress or else stacked channels could not
	  be used for that.

	* generic/tclIO.c (TclCopyChannel, CopyData): Moved access to the
 	  topmost channel from the first to the second procedure to make
 	  the decision about that at the last possible time (Callbacks can
 	  change the stacking).
d540 3
a542 3
	test suite: failures of iogt-[345].0
	
2000-07-06  Jeff Hobbs  <hobbs@@scriptics.com>
d544 1
a544 16
	* tests/iogt.test: new tests for stacked channel stuff based off
	new 'testchannel transform|unstack' code (Kupries IOGT extension).
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclDecls.h:
	* generic/tclStubsInit.c:
	* generic/tclIO.c: complete rewrite of Tcl Channel code for
	stacked channels.  Channels are now designed to work in a more
	stacked fashion with a shared ChannelState data structure.

2000-06-16  Syd Polk  <spolk@@redhat.com>

	* generic/tclEnv.c win/tclWin32Dll.c: Fix impurePtr to work with
	modern Cygwin.
	* win/tcl.m4: Use --compat-implib.
	* win/configure: Regenerate.
d546 8
a553 1
Sat Jun 10 22:43:00 2000  Christopher Faylor <cgf@@cygnus.com>
d555 1
a555 2
	* win/tclWinFile.c (TclMatchFiles): Revert Mon Jun 5 18:48:32 2000
	Christopher Faylor <cgf@@cygnus.com>.  Fails on Windows 95.
d557 1
a557 1
Tue Jun  6 22:09:02 2000  Christopher Faylor <cgf@@cygnus.com>
d559 1
a559 2
	* win/Makefile.in: Set up and use autoconf variables throughout to
	allow overriding variables from the make command line.
d561 3
a563 1
Tue Jun  6 12:17:46 2000  Christopher Faylor <cgf@@cygnus.com>
d565 1
a565 2
	* generic/tclFilename.c (Tcl_TranslateFileName): Reinstate Mon Jun 5
	18:18:32 2000 Christopher Faylor <cgf@@cygnus.com> minus a typo.
d567 3
a569 1
Tue Jun  6 17:05:20 2000  Andrew Cagney  <cagney@@b1.cygnus.com>
d571 1
a571 2
	* generic/tclFileName.c (Tcl_TranslateFileName): Revert Mon Jun 5
 	18:48:32 2000 Christopher Faylor <cgf@@cygnus.com>, didn't compile.
d573 4
a576 1
Mon Jun  5 18:48:32 2000  Christopher Faylor <cgf@@cygnus.com>
d578 2
a579 7
	* generic/tclFileName.c (Tcl_TranslateFileName): Cygwin paths (and
	Windows in general, actually) do not need to have '/'s translated into
	'\'s.
	(TclDoGlob): Ditto.
	* win/tclWinFile.c (TclMatchFiles): Ditto.
	* generic/tclInitScript.h: Look in "../bin/usr/share" as well as
	"../bin/share".
d581 1
a581 1
2000-06-02  Jeff Hobbs  <hobbs@@scriptics.com>
d583 2
a584 4
	* generic/tclIO.c (CloseChannel): removed the &ing out of
	(TCL_READABLE|TCL_WRITABLE) from the flags, as CloseChannel does
	this on the next pass through for the top channel, and it appeared
	to be causing hangs by not allowing the final flush.
d586 1
a586 1
2000-06-01  Jeff Hobbs  <hobbs@@scriptics.com>
d588 3
a590 9
	* generic/tclIO.c (CloseChannel): Rewrote CloseChannel code to
	unstack a channel during the close process.  Fixed a refcount bug
	in Tcl_UnstackChannel.  [Bug: 5623]
	(CloseChannel): further extended CloseChannel in the stacked case
	to effect certain operations on the next channel that would have
	been done in Tcl_Close.  Also added CHANNEL_CLOSED and removed
	(TCL_READABLE|TCL_WRITABLE) bits from chanPtr->flags.  Changed
	final reset of the WatchProc to check the chanDownPtr's (next)
	interestMask.
d592 1
a592 1
2000-05-29  Sandeep Tamhankar <sandeep@@scriptics.com>
d594 8
a601 12
	* tests/http.test
	* doc/http.n
	* library/http2.3/http.tcl: Fixed bug 5741, where unsuccessful
	geturl calls sometimes leaked memory and resources (sockets).  
	Also, switched around some of the logic so that http::wait never 
	throws an exception.  This is because in an asynchronous geturl, 
	the command callback will probably end up doing all the error 
	handling anyway, and in an asynchronous situation, the user
	expects to check the state when the transaction completes, as
	opposed to being thrown an exception.	For the http package, this
	menas the user can check http::status for "error" and http::error
	for the error message after doing the http::wait.
d603 1
a603 1
2000-04-26  Jeff Hobbs  <hobbs@@scriptics.com>
d605 1
a605 1
	8.3.1 RELEASE
d607 2
a608 2
	* README:
	* mac/README:
d610 1
a610 1
	* unix/README:
d612 2
a613 2
	* win/README:
	* win/README.binary: Updating URLs to reference dev.scriptics.com
d615 2
a616 1
2000-04-25  Jeff Hobbs  <hobbs@@scriptics.com>
d618 8
a625 4
	* unix/Makefile.in:
	* win/Makefile.in:
	* win/makefile.vc: updated for http change and some cleanup
	* library/http2.[13]: moved dir http2.1 to http2.3 to match version
d627 1
a627 1
	* doc/Utf.3: clarified docs for Tcl_(UniChar|Utf)AtIndex
d629 2
a630 2
	* unix/tclUnixThrd.c: removed {}s around PTHREAD_MUTEX_INITIALIZER
	[Bug: 5254]
d632 2
a633 1
	* unix/tclLoadDyld.c (TclpLoadFile): removed use of interp->result
d635 12
a646 1
2000-04-25  Eric Melski  <ericm@@scriptics.com>
d648 1
a648 3
	* unix/mkLinks: 
	* doc/AddErrInfo.3: Added information about Tcl_LogCommandInfo
	[Bug: 1818].
d650 9
a658 1
2000-04-24  Eric Melski  <ericm@@scriptics.com>
d660 3
a662 2
	* unix/mkLinks: 
	* doc/OpenFileChnl.3: Added man entry for Tcl_Ungets [Bug: 1834].
d664 2
a665 2
	* unix/mkLinks: 
	* doc/SourceRCFile.3: Man page for Tcl_SourceRCFile [Bug: 1833].
d667 1
a667 2
	* unix/mkLinks: 
	* doc/ParseCmd.3: Added documentation for Tcl_ParseVar [Bug: 1828].
d669 2
a670 1
2000-04-24  Jeff Hobbs  <hobbs@@scriptics.com>
d672 1
a672 3
	* unix/tclUnixNotfy.c (Tcl_FinalizeNotifier, NotifierThreadProc):
	added write of 'q' into triggerPipe for notifier in threaded case,
	so that Tcl doesn't hang when children are still running [Bug: 4139]
d674 1
a674 1
	* unix/tclUnixThrd.c (Tcl_MutexLock): minor comment fixes.
d676 1
a676 1
2000-04-23  Jim Ingham  <jingham@@cygnus.com>
d678 1
a678 2
	These changes make some error handling marginally better for Mac
	sockets.  It is still somewhat flakey, however.
d680 1
a680 12
	* mac/tclMacSock.c (TcpClose): Add timeouts to the close - these
	don't seem to be honored, however.
	Use a separate PB for the release, since an async connect socket
	will still be using the original buffer.
	Make sure TCPRelease returns noErr before freeing the recvBuff.
	If the call returns an error, then the buffer is not right.
	* mac/tclMacSock.c (CreateSocket): Add timeouts to the async
	create. These don't seem to trigger, however.  Sigh...
	* mac/tclMacSock.c (WaitForSocketEvent): If an TCP_ASYNC_CONNECT
	socket errors out, then return EWOULDBLOCK & error out.
	* mac/tclMacSock.c (NotifyRoutine): Added a NotifyRoutine for
	experimenting with MacTCP.
d682 1
a682 1
2000-04-22  Jim Ingham <jingham@@cygnus.com>
d684 10
a693 2
	* library/package.tcl (tclPkgUnknown): Fixed a typo in the Mac package
	search part of tclPkgUnknown.
d695 1
a695 1
2000-04-21  Sandeep Tamhankar <sandeep@@scriptics.com>
d697 1
a697 8
	* library/http2.1/http.tcl: Fixed a newly introduced bug where if
	there's a -command callback and something goes wrong, geturl threw
	an exception, called the callback, and unset the token.  I changed
	it so that it will not call the callback when throwing an
	exception (so the caller only finds out about a given error from
	one place).  Also, fixed http::ncode so that it actually gives you
	back the http return code (i.e. 200, 404, etc.) instead of the
	first digit of the version of HTTP being used (i.e. 1).
d699 7
a705 1
2000-04-21  Brent Welch <welch@@scriptics.com>
d707 5
a711 4
	* library/http2.1/http.tcl: More thrashing with the "server closes
	without reading post data" scenario.  Reverted to the previous
	filevent configuratiuon, which seems to work better with small
	amounts of post data.  
d713 5
a717 1
2000-04-20  Jeff Hobbs  <hobbs@@scriptics.com>
d719 9
a727 3
	* generic/tclAlloc.c: wrapped caddr_t define to not be done on Unix
	* unix/tclUnixPort.h: added Tclp*Alloc defines to allow the use of
	USE_TCLALLOC on Unix. [Bug: 4731]
d729 1
a729 1
2000-04-19  Jeff Hobbs  <hobbs@@scriptics.com>
d731 110
a840 5
	* library/dde1.1/pkgIndex.tcl:
	* library/reg1.0/pkgIndex.tcl:
	* win/tclWinChan.c:
	* win/tclWinThrd.c: converted CRLF to LF the */tcl.hpj.in files
	were not converted, as it confuses hcw locally. [Bug: 5096]
d842 1
a842 1
	* win/Makefile.in: expanded cleanup target for help files
d844 8
a851 1
	* doc/Thread.3: minor macro cleanup
d853 1
a853 2
	* generic/tclFileName.c (SplitUnixPath): added support for QNX
	node ids.
d855 6
a860 1
2000-04-18  Jeff Hobbs  <hobbs@@scriptics.com>
d862 4
a865 7
	* README:
	* generic/tcl.h:
	* tools/tcl.wse.in:
	* unix/configure.in:
	* unix/tcl.spec:
	* win/configure.in:
	* win/README.binary: bumped version to 8.3.1
d867 1
a867 1
	* win/tcl.hpj.in: updated copyright date
d869 1
a869 16
	* generic/tclEnv.c: environment support for Mac OS/X
	* unix/tclUnixPort.h: environment support for Mac OS/X
	* unix/tclLoadDyld.c: new file for Mac OS/X dl functions
	* unix/Makefile.in: added install-strip target; bindir, libdir,
	mandir, includedir vars; tclLoadDyld.c target [Bug: 2527]

	* unix/tclUnixChan.c (CreateSocket): force a socket back into
	blocking mode (default state) after a -async connect succeeds.
	[Bug: 4388]

	* generic/tclEvent.c (TclInitSubsystems): Moved tclLibraryPath to
	thread-local storage to prevent thread-related race condition.
	[Bug: 5033]
	* unix/tclAppInit.c (main): removed #ifdef TCL_TEST that sets the
	library path as it was unnecessary and conflicts with move of
	tclLibraryPath to thread-local storage.
d871 19
a889 1
2000-04-18  Scott Redman  <redman@@scriptics.com>
d891 1
a891 5
	* win/Makefile.in:
	* win/tcl.rc:
	* win/tclsh.rc:
	* win/tclsh.ico:  Modified copyright dates in Windows resource
	files.  Added an icon for tclsh.exe.
d893 37
a929 1
2000-04-17  Brent Welch <welch@@scriptics.com>
d931 1
a931 4
	* generic/tcl.h, generic/tclThreadTest.c, unix/tclUnixThrd.c,
	win/tclWinThread.c, mac/tclMacThread.c:
	Added Tcl_CreateThreadType and TCL_RETURN_THREAD_TYPE
	macros for declaring the NewThread callback proc.
d933 4
a936 1
2000-04-14  Jeff Hobbs  <hobbs@@scriptics.com>
d938 2
a939 2
	* unix/tclUnixChan.c (TtyParseMode): Only allow setting mark/space
	parity on platforms that support it [Bug: 5089]
d941 1
a941 2
	* generic/tclBasic.c (Tcl_GetVersion): adjusted use of major/minor
	to not conflict with global decl on some systems [Bug: 2882]
d943 3
a945 24
	* doc/AppInit.3:
	* doc/Async.3:
	* doc/BackgdErr.3:
	* doc/CrtChannel.3:
	* doc/CrtInterp.3:
	* doc/CrtMathFnc.3:
	* doc/DString.3:
	* doc/Eval.3:
	* doc/ExprLong.3:
	* doc/GetInt.3:
	* doc/GetOpnFl.3:
	* doc/Interp.3:
	* doc/LinkVar.3:
	* doc/OpenFileChnl.3:
	* doc/OpenTcp.3:
	* doc/PkgRequire.3:
	* doc/RecordEval.3:
	* doc/SetResult.3:
	* doc/SplitList.3:
	* doc/StaticPkg.3:
	* doc/TraceVar.3:
	* doc/Translate.3:
	* doc/UpVar.3:
	* doc/load.n: removed or updated references to interp->result use.
d947 1
a947 1
2000-04-13  Jeff Hobbs  <hobbs@@scriptics.com>
d949 3
a951 2
	* doc/regexp.n: doc clarification [Bug: 5037]
	* doc/update.n: typo fix [Bug: 4996]
d953 3
a955 3
	* unix/tcl.m4 (SC_ENABLE_THREADS): enhanced the detection of
	pthread_mutex_init [Bug: 4359] and (SC_CONFIG_CFLAGS) added
	--enable-64bit-vis switch for Sparc VIS compilation [Bug: 4995]
d957 1
a957 1
2000-04-12  Jeff Hobbs  <hobbs@@scriptics.com>
d959 2
a960 1
	* doc/dde.n: corrected dde poke docs. [Bug: 4991]
d962 1
a962 1
2000-04-11  Eric Melski  <ericm@@scriptics.com>
d964 2
a965 2
	* win/tclWinPipe.c: Added "CONST" keyword to declaration of char
	*native in TclpCreateTempFile, to supress compiler warnings.
d967 1
a967 1
2000-04-10  Brent Welch <welch@@scriptics.com>
d969 4
a972 5
	* generic/tcl.h: Fixed Tcl_CreateThread declaration.
	* library/tcltest1.0/tcltest.tcl: Fixed the "mainThread"
	initialization to work with either testthread or the thread extension
	* unix/tclUnixThrd.c: Fixed compiler warning when compiling
	with -DTCL_THREADS
d974 1
a974 1
2000-04-10  Eric Melski  <ericm@@scriptics.com>
d976 6
a981 2
	* win/tclWinPipe.c (TclpCreateTempFile): Added conversion of
	contents string from UTF to native encoding [Bug: 4030].
d983 1
a983 5
	* tests/regexp.test: Added tests for infinite looping in [regexp
	-all].
	
	* generic/tclCmdMZ.c: Fixed infinite loop bug with [regexp -all]
	[Bug: 4981].
d985 6
a990 2
	* tests/*.test: Changed all occurances of "namespace import
	::tcltest" to "namespace import -force ::tcltest" [Bug: 3948].
d992 1
a992 1
2000-04-09  Brent Welch <welch@@scriptics.com>
d994 4
a997 8
	* lib/httpd2.1/http.tcl: Worked on the "server closes before
	reading post data" case, which unfortunately causes different
	error cases on Solaris, which can read the reply, and Linux
	and Windows, which cannot read anything.  This is all in the
	loop-back case - client and server on the same host.  Also
	unified the error handling so the "ioerror" status goes away
	and errors are reflected in a more uniform way. Updated the
	man page to document the behavior.
d999 1
a999 1
2000-04-09  Jeff Hobbs  <hobbs@@scriptics.com>
d1001 2
a1002 2
	* tests/reg.test (matchexpected): corrected tests to use tcltest
	constraint types to skip certain tests.
d1004 1
a1004 1
	* generic/tclBasic.c (Tcl_SetCommandInfo): comment fix
d1006 3
a1008 4
	* unix/tclUnixThrd.c (Tcl_CreateThread): moved TCL_THREADS ifdef
	inside of func as it is declared for non-threads builds as well.
	In the non-threads case, it always returns TCL_ERROR (couldn't
	create thread).
d1010 1
a1010 1
2000-04-08  Andreas Kupries <a.kupries@@westend.com>
d1012 14
a1025 2
	* Overall change: Definition of a public API for the creation of
	  new threads.
d1027 6
a1032 3
	* generic/tclInt.h (line 1802f): Removed the definition of
	'TclpThreadCreate'. (line 793f) Removed the definition of
	'Tcl_ThreadCreateProc'.
d1034 1
a1034 4
	* generic/tcl.h (line 388f): Readded the definition of
	  'Tcl_ThreadCreateProc'. Added Win32 stuff send in by David
	  Graveraux <davygrvy@@bigfoot.com> to that too (__stdcall,
	  ...). Added macros for the default stacksize and allowed flags.
d1036 1
a1036 3
	* generic/tcl.decls (line 1356f): Added definition of
	  'Tcl_CreateThread', slot 393 of the stub table. Two new
	  arguments in the public API, for stacksize and flags.
d1038 1
a1038 3
	* win/tclWinThrd.c:
	* mac/tclMacThrd.c: Renamed TclpThreadCreate to Tcl_CreateThread,
	  added handling of the stacksize. Flags are currently ignored.
d1040 4
a1043 3
	* unix/tclUnixThrd.c: See above, but handles joinable
	  flag. Ignores the specified stacksize if the macro
	  HAVE_PTHREAD_ATTR_SETSTACKSIZE is not defined.
d1045 1
a1045 1
	* generic/tclThreadTest.c (line 363): See below.
d1047 32
a1078 2
	* unix/tclUnixNotfy.c (line 210): Adapted to the changes
	  above. Uses default stacksize and no flags now.
d1080 1
a1080 5
	* unic/tcl.m4 (line 382f): Added a check for
	  'pthread_attr_setstacksize' to detect platforms not implementing
	  this feature of pthreads. If it is implemented, configure will
	  define the macro HAVE_PTHREAD_ATTR_SETSTACKSIZE (See
	  unix/tclUnixThrd.c too).
d1082 3
a1084 3
	* doc/Thread.3: Added Tcl_CreateThread and its arguments to the
	  list of described functions. Removed stuff about not providing a
	  public C-API for thread-creation.
d1086 2
a1087 1
2000-04-07  Jeff Hobbs  <hobbs@@scriptics.com>
d1089 3
a1091 2
	* doc/binary.n: clarified docs on sign extension in binary scan
	[Bug: 3466]
d1093 1
a1093 2
	* library/tcltest1.0/tcltest.tcl (initConstraints): removed win32s
	references (no longer supported)
d1095 4
a1098 3
	* tests/fCmd.test: marked test 8.1 knownBug because it is
	dangerous on poorly configured systems [Bug: 3881]
	and added 8.2 to keep essence of 8.1 tested.
d1100 11
a1110 1
2000-04-05  Andreas Kupries <a.kupries@@westend.com>
d1112 3
a1114 5
	* generic/tclIO.c (Tcl_UnstackChannel, line 1831): Forcing
	interest mask to the correct value after an unstack and
	re-initialization of the notifier via the watchProc. Without this
	the first fileevent after an unstack will come through and be
	processed, but no more. [Bug: ??].
d1116 1
a1116 1
2000-03-04  Brent Welch  <welch@@scriptics.com>
d1118 4
a1121 5
	* {win,unix}/Makefile.in: added dependency of tclStubInit.c on
	tcl.decls and tclInt.decls
	* generic/tclThread.c: Tweak so this compiles w/out TCL_THREADS
	* generic/{tcl.decls,tclStubInit.c}:  Just touched the tcl.decls and
	regenerated the tclStubInit.c file
d1123 2
a1124 1
2000-03-29  Sandeep Tamhankar <sandeep@@scriptics.com>
d1126 1
a1126 7
	* library/http2.1/http.tcl: For the -querychannel option,
	fconfigure the socket to be binary so that we don't translate
	anything while reading the data.  This is because we determine the
	content length of the data on the channel by using seek (to the end
	of the file) and tell on the file handle, and we need the
	content-length to match the amount of data actually sent, and
	translation can affect the number of bytes posted.
d1128 5
a1132 1
2000-04-03  Andreas Kupries <a.kupries@@westend.com>
d1134 21
a1154 2
	* Overall change: Definition of public API's for the finalization
	of conditions and mutexes. [Bug: 4199].
d1156 1
a1156 2
	* generic/tclInt.h: Removed definitions of TclFinalizeMutex and
	TclFinalizeCondition.
d1158 23
a1180 2
	* generic/tcl.decls: Added declarations of Tcl_MutexFinalize and
	Tcl_ConditionFinalize.
d1182 4
a1185 3
	* generic/tclThread.c: Renamed TclFinalizeMutex to
	Tcl_MutexFinalize. Renamed TclFinalizeCondition to
	Tcl_ConditionFinalize.
d1187 3
a1189 2
	* generic/tclNotify.c: Changed usage of TclFinalizeMutex to
	Tcl_MutexFinalize.
d1191 1
a1191 3
	* unix/tclUnixNotfy.c: 
	* generic/tclThreadTest.c: Changed usages of TclFinalizeCondition to
	Tcl_ConditionFinalize.
d1193 6
a1198 3
	* generic/tcl.h: Added empty macros for Tcl_MutexFinalize and
	Tcl_ConditionFinalize, to be used when the core is compiled
	without threads. 
d1200 1
a1200 1
	* doc/Thread.3:	Added description the new API's.
d1202 2
a1203 1
2000-04-03  Jeff Hobbs  <hobbs@@scriptics.com>
d1205 1
a1205 2
	* generic/tclCmdIL.c (InfoVarsCmd): checked for non-NULL procPtr
	to prevent itcl info override crash [Bug: 4064]
d1207 3
a1209 4
	* tests/foreach.test:
	* tests/namespace.test:
	* tests/var.test: Added lsorts to avoid random sorted return
	problems. [Bug: 2682]
d1211 24
a1234 1
	* tests/fileName.test: fixed 14.1 test fragility [Bug: 1482]
d1236 3
a1238 2
	* tools/man2help2.tcl: fixed winhelp cross-linking error [Bug: 4156]
	improved translation to winhelp [Bug: 3679]
d1240 1
a1240 2
	* unix/Makefile.in (MAN_INSTALL_DIR): patch to accept --mandir
	correctly [Bug: 4085]
d1242 2
a1243 1
	* unix/dltest/pkg[a-e].c: Cleaned up test packages [Bug: 2293]
d1245 1
a1245 1
2000-04-03  Eric Melski  <ericm@@scriptics.com>
d1247 10
a1256 3
	* unix/tclUnixFCmd.c (SetGroupAttribute): 
	* unix/tclUnixFCmd.c (SetOwnerAttribute): Added (uid_t) and (gid_t) 
	casts to avoid compiler warnings.
d1258 5
a1262 1
2000-03-31  Eric Melski  <ericm@@scriptics.com>
d1264 7
a1270 3
	* generic/tclGet.c (Tcl_GetDouble): Added additional conditions to
	error test (previously only errno was checked, but the return
	value of strtod() should be checked as well).  [Bug: 4118].
d1272 1
a1272 2
	* tests/exec.test: Added test for proper conversion of UTF data
	when used with "<< $dataWithUTF" on exec's.
d1274 6
a1279 8
	* unix/tclUnixPipe.c (TclpCreateTempFile): Added
	Tcl_UtfToExternalDString call, so that if there is UTF content in
	the string it will be properly converted to the system encoding
	before being written [Bug: 4030].
	(TclpCreateTempFile): Added a check on the return value of tmpnam;
	some systems (Linux, for example) will start to return NULL after
	tmpnam has been called TMP_MAX times; not checking for this can
	have bad results (overwriting temp files, core dumps, etc.)
d1281 1
a1281 1
2000-03-30  Jeff Hobbs  <hobbs@@scriptics.com>
d1283 2
a1284 2
	* generic/tclBasic.c (Tcl_DeleteCommandFromToken): Added comments
	noting the need to pair ckalloc with ckfree. [Bug: 4262]
d1286 1
a1286 5
	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c:
	* win/tclWin32Dll.c: removed TclWinSynchSpawn (vestige of Win32s
	support).
d1288 1
a1288 2
	* win/tclWinReg.c: made use of TclWinGetPlatformId instead of
	getting info again
d1290 3
a1292 4
	* win/tclWinPort.h:
	* win/Makefile.in:
	* win/configure.in:
	* win/tcl.m4: Added support for gcc/mingw on Windows [Bug: 4234]
d1294 1
a1294 1
2000-03-29  Jeff Hobbs  <hobbs@@scriptics.com>
d1296 4
a1299 3
	* generic/tclCompile.c (TclCleanupByteCode): made ByteCode cleanup
	more aware of TCL_BYTECODE_PRECOMPILED flagged structs (gen'd by
	tbcload), to correctly clean them up.
d1301 1
a1301 2
	* generic/tclClock.c (FormatClock): moved check for empty format
	earlier, commented 0 result return value
d1303 2
a1304 1
2000-03-29  Sandeep Tamhankar <sandeep@@scriptics.com>
d1306 1
a1306 10
	* library/http2.1/http.tcl: Removed an unnecessary fileevent
	statement from the error processing part of the Write method.
	Also, fixed two potential memory leaks in wait and reset, in which
	the state array wasn't being unset before throwing an exception.
	Prior to this version, Brent checked in a fix to catch a
	fileevent statement that was sometimes causing a stack trace when
	geturl was called with -timeout.  I believe Brent's fix is
	necessary because TLS closes bad sockets for secure connections,
	and the fileevent was trying to act on a socket that no longer
	existed.
d1308 4
a1311 1
2000-03-27  Jeff Hobbs  <hobbs@@scriptics.com>
d1313 1
a1313 1
	* tests/httpd: removed unnecessary 'puts stderr "Post Dispatch"'
d1315 4
a1318 4
	* tests/namespace.test:
	* generic/tclNamesp.c (Tcl_Export): added a uniq'ing test to the
	export list so only one instance of each export pattern would
	exist in the list.
d1320 15
a1334 2
	* generic/tclExecute.c (TclExecuteByteCode): optimized case for
	the empty string in ==/!= comparisons
d1336 1
a1336 1
2000-03-27  Eric Melski  <ericm@@scriptics.com>
d1338 1
a1338 2
	* unix/tclUnixChan.c: Added (off_t) type casts in lseek() call
	[Bug: 4409].
d1340 3
a1342 3
	* unix/tclLoadAout.c: 
	* unix/tclUnixPipe.c: Added (off_t) type casts in lseek() calls
	[Bug: 4410].
d1344 1
a1344 1
2000-03-22  Sandeep Tamhankar <sandeep@@scriptics.com>
d1346 4
a1349 3
	* library/http2.1/http.tcl: Fixed a bug where string query data
	that was bigger than queryblocksize would get duplicate characters
	at block boundaries.
d1351 1
a1351 1
2000-03-22  Sandeep Tamhankar <sandeep@@scriptics.com>
d1353 3
a1355 7
	* library/http2.1/http.tcl: Fixed bug 4463, where we were getting
	a stack trace if we tried to publish a project to a good host but
	a port where there was no server listening.  It turned out the
	problem was a stray fileevent that needed to be cleared.  Also,
	fixed a bug where http::code could stack trace if called on a bad
	token (one which didn't represent a successful geturl) by adding
	an http element to the state array in geturl.
d1357 1
a1357 1
2000-03-21  Eric Melski  <ericm@@scriptics.com>
d1359 59
a1417 3
	* tests/clock.test: Modified some tests that were not robust with
	respect to the time zone in which they were run and were thus
	failing.
d1419 1
a1419 3
	* doc/clock.n: Clarified meaning of -gmt with respect to -base
	when used with [clock scan] (-gmt does not affect the
	interpretation of -base).
d1421 1
a1421 1
2000-03-19  Sandeep Tamhankar <sandeep@@scriptics.com>
d1423 1
a1423 5
	* library/http2.1/http.tcl: geturl used to throw an exception when
	the connection failed; I accidentally returned a token with the
	error info, breaking backwards compatibility.  I changed it back
	to throwing an exception, but unsetting the state array first
	(thus still eliminating the original memory leak problem).
d1425 3
a1427 1
2000-03-19  Sandeep Tamhankar <sandeep@@scriptics.com>
d1429 1
a1429 9
	* library/http2.1/http.tcl: Added -querychannel option and altered
	some of Brent's modifications to allow asynchronous posts (via
	-command).  Also modified -queryprogress so that it calls the
	query callback as <callback> <token> <total size> <current size>
	to be consistent with -progress.  Added -queryblocksize option
	with default 8192 bytes for post blocksize.  Fixed a bunch of
	potential memory leaks for the case when geturl receives bad args
	or can't open a socket, etc.  Overall, the package really rocks
	now.
d1431 3
a1433 4
	* doc/http.n: Added -queryblocksize, -querychannel, and
	-queryprogress.  Also, changed the description of -blocksize,
	which states that the -progress callback will be called for each
	block, to now qualify that with an "if -progress is specified".
d1435 4
a1438 5
	* tests/http.test: Added a querychannel test for synchronous and
	asynchronous posts, altered the queryprogress test such that the
	callback conforms to the -progress format.  Also, had to use the
	-queryblocksize option to do the post 16K at a time to match
	Brent's expected results (and to test that -queryblocksize works).
d1440 2
a1441 1
2000-03-15  Brent Welch <welch@@scriptics.com>
d1443 4
a1446 6
	* library/http2.1/http.tcl: Added -queryprogress callback to
	http::geturl and also changed it so that writing the post data
	is event driven if the queryprogress callback or a timeout is given.
	This allows a timeout to occur when writing lots of post data.
	The queryprogress callback is called after each block of query
	data is posted.  It has the same signature as the -progress callback.
d1448 1
a1448 1
2000-03-06  Eric Melski  <ericm@@scriptics.com>
d1450 4
a1453 5
	* library/package.tcl: Applied patch from Bug: 2570; rather than
	setting geometry of slave interp to 0x0 when Tk was loaded, it now
	does "wm withdraw .".  Both remove the main window from the
	display, but the former caused some internal structures to get
	initialized to zero, which caused crashes with some extensions.
d1455 1
a1455 1
2000-03-02  Jeff Hobbs  <hobbs@@scriptics.com>
d1457 20
a1476 3
	* library/package.tcl (tclPkgUnknown): extended to allow
	recognizes changes in the auto_path while sourcing in other
	pkgIndex.tcl files
d1478 2
a1479 2
	* doc/FindExec.3: fixed doc for declaration of Tcl_FindExecutable
	[Bug: 4275]
d1481 3
a1483 3
	* generic/tclFileName.c (Tcl_TranslateFileName): Applied patch
	from Newman to significantly speedup file split/join on Windows
	(replaces regexp with custom parser).  [Bug: 2867]
d1485 1
a1485 2
	* win/README.binary: change mailing lists from @@consortium.org
	to @@scriptics.com [Bug: 4173]
d1487 3
a1489 1
2000-02-28  Eric Melski  <ericm@@scriptics.com>
d1491 1
a1491 1
	* tests/clock.test: Added test for ISO bases < 100000
d1493 1
a1493 4
	* generic/tclDate.c: (generated on Solaris)
	* generic/tclGetDate.y: Changed condition for deciding if a number
	is an ISO 8601 base from number >= 100000 to numberOfDigits >= 6.
	Previously it would fail to recognize 000000 as an ISO base.
d1495 1
a1495 1
2000-02-14  Eric Melski  <ericm@@scriptics.com>
d1497 1
a1497 1
	* unix/Makefile.in: Added rpm target to generate Tcl binary RPM.
d1499 2
a1500 2
	* unix/tcl.spec: RPM specification file for a Tcl binary RPM for
	Linux.
d1502 6
a1507 1
2000-02-10  Jeff Hobbs  <hobbs@@scriptics.com>
d1509 3
a1511 1
	8.3.0 RELEASE
d1513 2
a1514 1
	* changes: updated for 8.3.0 release
d1516 1
a1516 1
	* doc/load.n: added notes about dll load errors on Windows
d1518 3
a1520 4
	* unix/README:
	* unix/Makefile.in (dist): removed porting.notes and porting.old
	from distribution and CVS.  The information was very outdated.  Now
	refer to http://dev.scriptics.com/services/support/platforms.html
d1522 1
a1522 1397
	* tests/unixInit.test: fixed japanese LANG encoding test [Bug: 3549]

	* unix/configure.in:
	* unix/tcl.m4: correct CFLAG_WARNING setting,
	fixed gcc config for AIX,
	added -export-dynamic to LDFLAGS for FreeBSD-3+ [Bug: 2998]

	* win/tclWinLoad.c (TclpLoadFile): improved error message for load
	failures, could perhaps be even more intelligent.

2000-02-09  Jim Ingham	 <jingham@@cygnus.com>

	* mac/tclMacSock.c: Don't panic when you get an error closing an async 
	socket.	 This doesn't seem to hurt anything, and we return the error so
	the caller can do the right thing.

	New Files:
	* mac/MW_TclHeader.h:
	* mac/MW_TclTestHeader.h:
	* mac/MW_TclTestHeader.pch:
	* mac/MW_TclAppleScriptHeader.h: More convenient to use .h prefix files
	in the preference panels...

	The above are curtesy of Daniel Steffen (steffen@@math.mq.edu.au)

2000-02-08  Eric Melski  <ericm@@scriptics.com>

	* tests/clock.test: Added tests for "next monthname" constructs.
	* generic/tclDate.c: 
	* generic/tclGetDate.y (Message): Added a grammar rule for "next
	monthname" so that we can handle "next january" and similar
	constructs (bug #4146).

2000-02-08  Jeff Hobbs  <hobbs@@scriptics.com>

	* README:
	* tools/tcl.wse.in:
	* unix/configure.in:
	* win/configure.in:
	* win/README:
	* win/README.binary:
	* generic/tcl.h (TCL_RELEASE_SERIAL): Moved to 8.3.0 patchlevel

	* doc/library.n:
	* library/auto.tcl: fixed crufty puts code and docs [Bug: 4122]

	* library/tcltest1.0/tcltest.tcl: correctly protected searchDirectory
	list to allow dirnames with spaces

	* unix/tcl.m4: changed all -fpic to -fPIC

	* generic/tclDecls.h:
	* generic/tcl.decls: change Tcl_GetOpenFile to use decl of 'int
	forWriting' instead of 'int write' to avoid shadowing [Bug: 4121]

	* tests/httpold.test: changed test script to source in the httpd
	server procs from httpd instead of having its own set.

	* tests/httpd: improved query support in test httpd to handle fix
	in http.tcl. [Bug: 4089 change 2000-02-01]

	* unix/README: fixed notes about --enable-shared and add note
	about --disable-shared.

2000-02-07  Eric Melski  <ericm@@scriptics.com>

	* tests/package.test: 
	* library/tclIndex: 
	* library/package.tcl: Renamed ::package namespace to ::pkg.

2000-02-03  Eric Melski <ericm@@scriptics.com>

	* doc/Package.n:
	* doc/packagens.n: Renamed Package.n -> packagens.n because Windows 
	can't deal with case-sensitive names.

2000-02-02  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/regexp.test: added tests for -all and -inline switches
	* doc/regexp.n: added docs for -all and -inline switches
	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): added extra comments for
	new -all and -inline switches to regexp command

2000-02-01  Eric Melski  <ericm@@scriptics.com>

	* library/init.tcl: Applied patch from rfe 1734 regarding
	auto_load errors not setting error message and errorInfo properly.

2000-02-01  Jeff Hobbs  <hobbs@@scriptics.com>

	* win/Makefile.in (install-*): reduced verbosity of install

	* generic/tclFileName.c (Tcl_JoinPath): improved support for special
	QNX node id prefixes in pathnames [Bug: 4053]

	* library/http1.0/http.tcl:
	* library/http2.1/http.tcl: The query data POSTed was newline
	terminated when it shouldn't be altered [Bug: 4089]

2000-01-31  Eric Melski  <ericm@@scriptics.com>

	* tests/package.test: 
	* library/tclIndex: 
	* library/package.tcl: Added ::package namespace and
	::package::create function.

	* library/init.tcl: Fixed problem with auto_load and determining
	if commands were loaded.

	* library/auto.tcl: "Fixed" issues with $ in files to be auto indexed.

	* doc/Package.n: New man page for package::create function.

	* doc/pkgMkIndex.n: Added additional information.

	* doc/library.n: Added additional qualification regarding auto_mkindex.

2000-01-28  Eric Melski  <ericm@@scriptics.com>

	* tests/pkg/magicchar2.tcl: 
	* tests/autoMkindex.test: Test for auto loader fix (bug #2480).

	* library/init.tcl: auto_load was using [info commands $name] to
	determine if a given command was available; if the command name
	had * or [] it, this would fail because info commands uses
	glob-style matching.  This is fixed.  (Bug #2480).

	* tests/pkg/spacename.tcl: 
	* tests/pkgMkIndex.test: Tests for fix for bug #2360.

	* library/package.tcl: Fixed to extract only the first element of
	the list returned by auto_qualify (bug #2360).

	* tests/pkg/magicchar.tcl: 
	* tests/autoMkindex.test: Test for fix for bug #2611.

	* library/auto.tcl: Fixed the regular expression that performs $
	escaping before sourcing a file to index.  It was erroneously
	adding \ escapes even to $'s that were already escaped,
	effectively "un-escaping" those $'s.  (bug #2611).

2000-01-27  Eric Melski  <ericm@@scriptics.com>

	* tests/autoMkindex.test: 
	* library/auto.tcl: Applied patch (with slight modification) from
	bug #2701:  auto_mkIndex uses platform dependent file paths.
	Added test for fix.

2000-01-27  Jennifer Hom  <jenn@@scriptics.com>

	* library/tcltest1.0/tcltest.tcl: Changed NormalizePath to
	normalizePath and exported it as a public proc.  This proc 
	creates an absolute path given the name of the variable containing
	the path to modify.  The path is modified in place.
	* library/tcltest1.0/pkgIndex.tcl: Added normalizePath.
	* tests/all.tcl: Changed code to use normalizePath.

2000-01-27  Eric Melski  <ericm@@scriptics.com>

	* tests/pkg/samename.tcl: test file for bug #1983
	
	* tests/pkgMkIndex.test: 
	* doc/pkgMkIndex.n: 
	* library/package.tcl: Per rfe #4097, optimized creation of direct
	load packages to bypass computing the list of commands added by
	the new package.  Also made direct loading the default, and added
	a -lazy option.
	Fixed bug #1983, dealing with pkg_mkIndex incorrectly handling
	situations with two procs by the same name but in different
	namespaces (ie, foo::baz and bar::baz).

2000-01-26  Eric Melski  <ericm@@scriptics.com>

	* generic/tclNamesp.c: Undid fix for #956, which broke backwards
	compatibility.

	* doc/variable.n: 
	* doc/trace.n: 
	* doc/namespace.n: 
	* doc/info.n: Added further information about differences between
	"namespace which" and "info exists".

	* doc/SetErrno.3: Added descriptions of ErrnoId() and ErrnoMsg()
	functions.

2000-01-25  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/tcl.m4: modified EXTRA_CFLAGS to add -DHAVE_TZSET for
	OSF1-V* and ULTRIX-4.* when not using gcc.  Also added higher min
	stack size for OSF1-V* when building with threads. [Bug: 4063]

	* generic/tclClock.c (FormatClock): inlined resultPtr, as it
	conflicted with var creation for HAVE_TZSET #def [Bug: 4063]

	* generic/tclCmdIL.c (Tcl_LsortObjCmd): fixed potential leak
	when calling lsort -command with bad command [Bug: 4067]

	* generic/tclFileName.c (Tcl_JoinPath): added support for special
	QNX node id prefixes in pathnames [Bug: 4053]

	* doc/ListObj.3: clarified Tcl_ListObjGetElements docs [Bug: 4080]

	* doc/glob.n: clarified Mac path separator determination docs.

	* win/makefile.vc: added some support for building helpfile on Windows

2000-01-23  Jeff Hobbs  <hobbs@@scriptics.com>

	* library/init.tcl (auto_execok): added 'start' to list of
	recognized built-in commands for COMSPEC on NT. [Bug: 2858]

	* unix/tclUnixPort.h: moved include of <utime.h> lower since some
	systems (UTS) require sys/types.h to be included first [Bug: 4031]

	* unix/tclUnixChan.c (CreateSocketAddress): changed comparison
	with -1 to 0xFFFFFFFF, to ensure 32 bit comparison even on 64 bit
	systems. [Bug: 3878]

	* generic/tclFileName.c: improved guessing of path separator
	for the Mac. (Darley)

	* generic/tclInt.h:
	* generic/tcl.decls: moved Tcl_ProcObjCmd to stubs table [Bug: 3827]
	and removed 'register' from stub definition of
	Tcl_AppendUnicodeToObj [Bug: 4038]

2000-01-21  Eric Melski  <ericm@@scriptics.com>

	* unix/mkLinks: 
	* doc/GetHostName.3: Man page for Tcl_GetHostName (bug #1817).

	* doc/lreplace.n: Corrected man page with respect to treatment of
	empty lists, and "prettied up" the page. (bug #1705).

2000-01-20  Eric Melski  <ericm@@scriptics.com>

	* tests/namespace.test: Added test for undefined variables with
	namespace which (bug #956).

	* generic/tclNamesp.c: Added check for undefined variables in
	NamespaceWhichCmd (bug #956).

	* tests/var.test: Added tests for corrected variable behavior 
	(bug #981).

	* doc/upvar.n: Expanded explanation of upvar behavior with respect to
	variable traces.  (bugs 3917 1433 2110).

	* generic/tclVar.c: Changed behavior of variable command when name
	refers to an element in an array (ie, "variable foo(x)") to always
	return an error, regardless of existance of that element in the
	array (now behavior is consistant with docs too) (bug #981).

2000-01-20  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclCmdIL.c (InfoBodyCmd): made [info body] return a
	string if the body has been bytecompiled.
	* generic/tclBasic.c (Tcl_EvalObjEx): added pedantic check for
	originating proc body of bytecompiled code, #def'd out as the
	change for [info body] should make it unnecessary

	* unix/tclUnixNotfy.c (Tcl_InitNotifier): added cast for tsdPtr

	* tests/set.test: added test for complex array elem name compiling
	* generic/tclCompCmds.c (TclCompileSetCmd): Fixed parsing of array
	elements during compiling, and slightly optimised same [Bug: 3889]

	* doc/tclvars.n: added definitions for tcl_(non)wordchars

	* doc/vwait.n: added notes about requirement for vwait var being
	globally scoped [Bug: 3329]

	* library/word.tcl: changed tcl_(non)wordchars settings to use
	new unicode regexp char class escapes instead of char sequences

2000-01-14  Eric Melski  <ericm@@scriptics.com>

	* tests/var.test: Added a test for the array multiple delete
	protection in Tcl_UnsetVar2.

	* generic/tclVar.c: Added protection in Tcl_UnsetVar2 against
	attempts to multiply delete arrays when unsetting them (bug
	#3453).  This could happen if there was an unset trace on an array
	element and the trace proc made a global or upvar link to the
	array, and then the array was unset at the global level.  See the
	bug reference for more information.

	* unix/tclUnixTime.c: New clock format format.

	* compat/strftime.c: New clock format format.

	* generic/tclGetDate.y: New clock scan format.

2000-01-13  Jeff Hobbs  <hobbs@@scriptics.com>

	* changes: updated changes file to reflect 8.3b2 mods

	* README:
	* generic/tcl.h:
	* tools/tcl.wse.in:
	* unix/configure.in:
	* unix/tcl.m4:
	* win/README.binary:
	* win/configure.in: updated to patchlevel 8.3b2

	* generic/regexec.c: added var initialization to prevent compiler
	warning

2000-01-13  Eric Melski  <ericm@@scriptics.com>

	* tests/cmdIL.test: Added tests for lsort -dictionary with
	characters that occur between Z and a in ASCII.

	* generic/tclCmdIL.c: Modified DictionaryCompare function (used by
	lsort -dictionary) to do upper/lower case equivalency before doing
	character comparisons, instead of after.  This fixes bug #1357, in
	which lsort -dictionary [list ` AA c CC] and lsort -dictionary
	[list AA c ` CC] gave different (and both wrong) results.

2000-01-12  Eric Melski  <ericm@@scriptics.com>

	* tests/clock.test: Added tests for "next <day-of-week>" and
	"<day-of-week>"
	Added tests for "monday 1 week ago", etc, from RFE #3671.

	* doc/tests/clock.test: Added numerous tests for clock scan.

	* doc/generic/tclGetDate.y: Fixed some shift/reduce conflicts in
	clock grammar.

	* doc/doc/clock.n: Added documentation for new supported clock
	scan formats and additional explanation of daylight savings time
	correction algorithm.

2000-01-12  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/file.n:
	* tests/unixFCmd.test:
	* unix/tclUnixFCmd.c: added support for symbolic permissions
	setting in SetPermissionsAttribute (file attr $file -perm ...)
	[Bug: 3970]

	* generic/tclClock.c: fixed support for 64bit handling of clock
	values [Bug: 1806]

	* generic/tclThreadTest.c: upped a buffer size to hold double

	* tests/info.test:
	* generic/tclCmdIL.c: fixed 'info procs ::namesp::*' behavior (Dejong)

	* generic/tclNamesp.c: made imported commands also import their
	compile proc [Bug: 2100]

	* tests/expr.test:
	* unix/Makefile.in:
	* unix/configure.in:
	* unix/tcl.m4: recognize strtod bug on Tru64 v5.0 [Bug: 3378]
	and added tests to prevent unnecessary chmod +x in sources while
	installing, as well as more intelligent setsockopt/gethostbyname
	checks [Bug: 3366, 3389]

	* unix/tclUnixThrd.c: added compile time support (through use of
	the TCL_THREAD_STACK_MIN define) for increasing the default stack
	size for a thread. [Bug: 3797, 1966]

2000-01-11  Eric Melski  <ericm@@scriptics.com>

	* generic/tclGetDate.y: Added comments for the Convert function.
	Added a fix for daylight savings time handling for relative time
	spans of days, weeks or fortnights. (bug 3441, 3868).

	* generic/tclDate.c: Fixed compiler warning issues.

2000-01-10  Jeff Hobbs  <hobbs@@scriptics.com>

	* compat/waitpid.c: use pid_t type instead of int [Bug: 3999]

	* tests/utf.test: fixed test that allowed \8 as octal value
	* generic/tclUtf.c: changed Tcl_UtfBackslash to not allow
	non-octal digits (8,9) in \ooo substs. [Bug: 3975]

	* generic/tcl.h: noted need to change win/tcl.m4 and
	tools/tclSplash.bmp for minor version changes

	* library/http2.1/http.tcl: trim value for $state(meta) key

	* unix/tclUnixFile.c: fixed signature style on functions

	* unix/Makefile.in: made sure tcl.m4 would be installed with dist

	* unix/tcl.m4: added ELF support for NetBSD [Bug: 3959]

2000-01-10  Eric Melski  <ericm@@scriptics.com>

	* generic/tclGetDate.y: Added rules for ISO 8601 formats (BUG #847):
	CCYY-MM-DD
	CCYYMMDD
	YY-MM-DD
	YYMMDD
	CCYYMMDDTHHMMSS
	CCYYMMDD HHMMSS
	CCYYMMDDTHH:MM:SS
	Fixed "clock scan <number>" to scan the number as an hour for the
	current day, rather than a minute after 00:00 for the current day
	(bug #2732).
	

2000-01-07  Eric Melski  <ericm@@scriptics.com>

	* generic/tclClock.c: Changed switch in Tcl_ClockObjCmd to use
	enumerated values instead of constants. (ie, COMMAND_SCAN instead
	of 3).

1999-12-22  Jeff Hobbs  <hobbs@@scriptics.com>

	* changes: updated changes file
	* tools/tclSplash.bmp: updated to show 8.3

1999-12-21  Jeff Hobbs  <hobbs@@scriptics.com>

	* README:
	* generic/tcl.h:
	* mac/README:
	* unix/configure.in:
	* tools/tcl.wse.in:
	* win/README.binary:
	* win/configure.in: updated to patch level 8.3b1

	* unix/Makefile.in: added -srcdir=... for 'make html'

	* doc/Hash.3: fixed reference to ckfree [Bug: 3912]
	* doc/RegExp.3: fixed calling params for Tcl_RegExecFromObj
	* doc/open.n: fixed minor formatting errors
	* doc/string.n: fixed minor formatting errors

	* doc/lsort.n: added -unique docs
	* tests/cmdIL.test:
	* generic/tclCmdIL.c: added -unique option to lsort

	* generic/tclThreadTest.c: changed thread ids to longs [Bug: 3902]

	* mac/tclMacOSA.c: fixed applescript for I18N [Bug: 3644]

	* win/mkd.bat:
	* win/rmd.bat: removed necessity of tag.txt [Bug: 3874]

	* win/tclWinThrd.c: changed CreateThread to _beginthreadex and
	ExitThread to _endthreadex

1999-12-12  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/glob.n:
	* tests/fileName.test:
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclEncoding.c:
	* generic/tclFileName.c:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: enhanced the glob command with the new options
	-types -path -directory and -join.  Deprecated TclpMatchFiles with
	TclpMatchFilesTypes, extended TclGlob and TclDoGlob and added
	GlobTypeData structure. [Bug: 2363]

1999-12-10  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/var.test:
	* generic/tclCompile.c: fixed problem where setting to {} array
	would intermittently not work. (Fontaine) [Bug: 3339]

	* generic/tclCmdMZ.c:
	* generic/tclExecute.c: optimized INST_TRY_CVT_TO_NUMERIC to
	recognize boolean objects. (Spjuth) [Bug: 2815]

	* tests/info.test:
	* tests/parseOld.test:
	* generic/tclCmdAH.c:
	* generic/tclProc.c: changed Tcl_UplevelObjCmd (uplevel) and
	Tcl_EvalObjCmd (eval) to use TCL_EVAL_DIRECT in the single arg
	case as well, to take advantage	of potential pure list input
	optimization.  This means that it won't get byte compiled though,
	which should be acceptable.
	* generic/tclBasic.c: made Tcl_EvalObjEx pure list object aware in
	the TCL_EVAL_DIRECT case for efficiency.
	* generic/tclUtil.c: made Tcl_ConcatObj pure list object aware,
	and return a list object in that case [Bug: 2098 2257]

	* generic/tclMain.c: changed Tcl_Main to not constantly reuse the
	commandPtr object (interactive case) as it could be shared. (Fellows)

	* unix/configure.in:
	* unix/tcl.m4:
	* unix/tclUnixPipe.c: removed checking for compatible vfork
	function and use of the vfork function.  Modern VM systems rarely
	suffer any performance degradation when fork is used, and it
	solves multiple problems with vfork.  Users that still want vfork
	can add -Dfork=vfork to the compile flags. [Bug: 942 2228 1312]

1999-12-09  Jeff Hobbs  <hobbs@@scriptics.com>

	* win/aclocal.m4: made it just include tcl.m4

	* doc/exec.n:
	* doc/open.n:
	* win/tclWin32Dll.c:
	* win/tclWinChan.c:
	* win/tclWinFCmd.c:
	* win/tclWinInit.c:
	* win/tclWinPipe.c:
	* win/tclWinSock.c: removed all code that supported Win32s.  It
	was no longer officially supported, and likely didn't work anyway.
	* win/makefile.vc: removed 16 bit stuff, cleaned up.

	* win/tcl16.rc:
	* win/tclWin16.c:
	* win/winDumpExts.c: these files have been removed from the
	source tree (no longer necessary to build)

1999-12-07  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/io.test: removed 'knownBug' tests that were for
	unsupported0, which is now fcopy (that already has tests)

	* mac/tclMacPort.h: added utime.h include

	* generic/tclDate.c:
	* unix/Makefile.in: fixed make gendate to swap const with CONST
	so it uses the Tcl defined CONST type [Bug: 3521]

	* generic/tclIO.c: removed panic that could occur in FlushChannel
	when a "blocking" channel would receive EAGAIN, instead treating
	it the same as non-blocking. [Bug: 3773]

	* generic/tclUtil.c: fixed Tcl_ScanCountedElement to not step
	beyond the end of the counted string [Bug: 3336]

1999-12-03  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/load.n: added note about NT's buggy handling of './' with
	LoadLibrary

	* library/http2.1/http.tcl: fixed error handling in http::Event
	[Bug: 3752]

	* tests/env.test: removed knownBug limitation from working test
	* tests/all.tcl: ensured that ::tcltest::testsDirectory would be
	set to an absolute path

	* tests/expr-old.test:
	* tests/parseExpr.test:
	* tests/string.test:
	* generic/tclGet.c:
	* generic/tclInt.h:
	* generic/tclObj.c:
	* generic/tclParseExpr.c:
	* generic/tclUtil.c:
	* generic/tclExecute.c: added TclCheckBadOctal routine to enhance
	error message checking for when users use invalid octal numbers
	(like 08), as well as replumbed the Expr*Funcs with a new
	VerifyExprObjType to simplify type handling. [Bug: 2467]

	* tests/expr.test:
	* generic/tclCompile.c: fixed 'bad code length' error for
	'expr + {[incr]}' case, with new test case [Bug: 3736]
	and seg fault on 'expr + {[error]}' (different cause) that
	was caused by a correct optimization that didn't correctly
	track how it was modifying the source string in the opt.
	The optimization was removed, which means that:
		expr 1 + {[string length abc]}
	will be not be compiled inline as before, but this should be
	written:
		expr {1 + [string length abc]}
	which will be compiled inline for speed.  This prevents
		expr 1 + {[mindless error]}
	from seg faulting, and only affects optimizations for
	degenerate cases [Bug: 3737]

1999-12-01  Scott Redman <redman@@scriptics.com>

	* generic/tcl.decls :
	* generic/tclMain.c :
	* unix/tclAppInit.c: 
	* win/tclAppInit.c: Added two new internal functions,
	TclSetStartupScriptFileName() and TclGetStartupScriptFileName()
	and added hooks into the main() code for supporting TclPro and
	other "big" shells more easily without requiring a copy of the
	main() code.
	
	* generic/tclEncoding.c:
	* generic/tclEvent.c:  Moved encoding-related startup code from
	tclEvent.c into the more appropriate tclEncoding.c.
	
1999-11-30  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclIO.c: fix from Kupries for	Tcl_UnstackChannel that
	correctly handles resetting translation and encoding.

	* generic/tclLoad.c: #def'd out the unloading of DLLs at finalize
	time for Unix in TclFinalizeLoad. [Bug: 2560 3373]  Should be
	parametrized to allow for user to specify unload or not.

	* win/tclWinTime.c: fixed handling of %Z on NT for time zones
	that don't have DST.

1999-11-29  Jeff Hobbs  <hobbs@@scriptics.com>

	* library/dde1.1/pkgIndex.tcl:
	* library/reg1.0/pkgIndex.tcl: added supported for debugged
	versions of the libraries

	* unix/tclUnixPipe.c: fixed PipeBlockModeProc to properly set
	isNonBlocking flag on pipe. [Bug: 1356 710]
	removed spurious fcntl call from PipeBlockModeProc

	* tests/scan.test:
	* generic/tclScan.c: fixed scan where %[..] didn't match anything
	and added test case [Bug: 3700]

1999-11-24  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/open.n:
	* win/tclWinSerial.c: adopted patch from Schroedter to handle
	fconfigure $sock -lasterror on Windows. [RFE: 3368]

	* generic/tclCmdIL.c: made SORTMODE_INTEGER work with Longs
	[Bug: 3652]

1999-11-23  Scott Stanton  <stanton@@scriptics.com>

	* library/tcltest1.0/tcltest.tcl: Fixed bug where tcltest output
	went to stdout instead of the specified output file in some
	cases.

1999-11-19  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclProc.c: backed out change from 1999-11-18 as it
	could affect return string from upvar as well.

	* tools/tcl.wse.in: added tcltest1.0 library to distribution list

	* doc/http.n:
	* library/http2.1/http.tcl:
	* library/http2.1/pkgIndex.tcl: updated http package to 2.2

1999-11-18  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/tcl.m4: added defined for _THREAD_SAFE in --enable-threads
	case; added check for pthread_mutex_init in libc; in AIX case,
	with --enable-threads ${CC}_r is used; fixed flags when using gcc
	on SCO

	* generic/tclProc.c: corrected error reporting for default case
	at the global level for uplevel command.

	* generic/tclIOSock.c: changed int to size_t type for len
	in TclSockMinimumBuffers.

	* generic/tclCkalloc.c: fixed Tcl_DbCkfree to return a value
	on NULL input. [Bug: 3400]

	* generic/tclStringObj.c: fixed support for passing in negative
	length to Tcl_SetUnicodeObj, et al handling routines. [Bug: 3380]

	* doc/scan.n:
	* tests/scan.test:
	* generic/tclScan.c: finished support for inline scan by
	supporting XPG identifiers.

	* doc/http.n:
	* library/http2.1/http.tcl: added register and unregister
	commands to http:: package (better support for tls/SSL),
	as well as -type argument to http::geturl. [RFE: 2617]

	* generic/tclBasic.c: removed extra decr of numLevels in
	Tcl_EvalObjEx that could cause seg fault. (mjansen@@wendt.de)

	* generic/tclEvent.c: fixed possible lack of MutexUnlock in
	Tcl_DeleteExitHandler [Bug: 3545]

	* unix/tcl.m4: Added better pthreads library check and inclusion
	of _THREAD_SAFE in --enable-threads case
	Added support for gcc config on SCO

	* doc/glob.n: added note about ..../ glob behavior on Win9*
	* doc/tcltest.n: fixed minor example errors [Bug: 3551]

1999-11-17 Brent Welch <welch@@scriptics.com>
	* library/http2.1/http.tcl: Correctly fixed the -timeout
	problem mentioned in the 10-29 change.  Also added error
	handling for failed writes on the socket during the protocol.

1999-11-09  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/open.n: corrected docs for 'a' open mode.

	* generic/tclIOUtil.c: changed Tcl_Alloc to ckalloc

	* generic/tclInt.h:
	* generic/tclObj.c: rolled back changes from 1999-10-29
	Purify noted new leaks with that code

	* generic/tclParse.c: added code in Tcl_ParseBraces to test for
	possible unbalanced open brace in a comment

	* library/init.tcl: removed the installed binary directory from
	the auto_path variable

	* tools/tcl.wse.in: updated to 8.3a1, fixed install of twind.tcl
	and koi8-r.enc files

	* unix/tcl.m4: added recognition of pthreads library for AIX

1999-10-29  Brent Welch <welch@@scriptics.com>
	* generic/tclInt.h: Modified the TclNewObj and TclDecrRefCount
	in two ways.  First, in the case of TCL_THREADS, we do not use
	the special Tcl_Obj allocator because that is a source of 
	lock contention.  Second, general code cleanup to eliminate
	duplicated code. In particular, TclDecrRefCount now uses
	TclFreeObj instead of duplicating that code, so it is now
	identical to Tcl_DecrRefCount.

	* generic/tclObj.c: Changed Tcl_NewObj so it uses the
	TclNewObj macro instead of duplicating the code.  Adjusted
	TclFreeObj so it understands the TCL_THREADS case described
	above.

	* library/http2.1/http.tcl: Fixed a bug in the handling of
	the state(status) variable when the -timeout flag is specified.
	Previously it was possible to leave the status undefined
	instead of empty, which caused errors in http::status

1999-10-28  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/aclocal.m4: made it just include tcl.m4

	* library/tcltest1.0/tcltest.tcl: updated makeFile to return
	full pathname of file created

	* generic/tclStringObj.c: fixed Tcl_AppendStringsToObjVA so it only
	iterates once over the va_list (avoiding a memcpy of it,
	which is not portable).

	* generic/tclEnv.c: fixed possible ABR error in environ array

	* tests/scan.test:
	* generic/tclScan.c: added support for use of inline scan,
	XPG3 currently not included

	* tests/incr.test:
	* tests/set.test:
	* generic/tclCompCmds.c: fixed improper bytecode handling of
	'eval {set array($unknownvar) 5}' (also for incr) [Bug: 3184]

	* win/tclWinTest.c: added testvolumetype command, as atime is
	completely ignored for Windows FAT file systems
	* win/tclWinPort.h: added sys/utime.h to includes
	* unix/tclUnixPort.h: added utime.h to includes
	* doc/file.n:
	* tests/cmdAH.test:
	* generic/tclCmdAH.c: added time arguments to atime and mtime
	file command methods (support 'touch' functionality)

1999-10-20  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/tclUnixNotfy.c: fixed event/io threading problems by
	making triggerPipe non-blocking [Bug: 2792]

	* library/tcltest1.0/tcltest.tcl:
	* generic/tclThreadTest.c: fixed mem leaks in threads

	* generic/tclResult.c: fixed Tcl_AppendResultVA so it only
	iterates once over the va_list (avoiding a memcpy of it,
	which is not portable).

	* generic/regc_color.c: fixed mem leak and assertion, from HS

	* generic/tclCompile.c: removed savedChar trick that appeared to
	be causing a segv when the literal table was released

	* tests/string.test:
	* generic/tclCmdMZ.c: fixed [string index] to return ByteArrayObj
	when indexing into one (test case string-5.16) [Bug: 2871]

	* library/http2.1/http.tcl: protected gets with catch [Bug: 2665]

1999-10-19  Jennifer Hom  <jenn@@scriptics.com>

	* tests/tcltest.test:
	* doc/tcltest.n:
	* library/tcltest1.0/tcltest.tcl: Removed the extra return at the
	end of the tcltest.tcl file, added version information about tcl.

	Applied patches sent in by Andreas Kupries to add helper procs for
	debug output, add 3 new flags (-testsdir, -load, -loadfile), and
	internally refactors common code for dealing with paths into
	separate procedures. [Bug: 2838, 2842]

	Merged code from core-8-2-1 branch that changes the checks for the
	value of tcl_interactive to also incorporate a check for the
	existence of the variable.

	* tests/autoMkindex.test:
	* tests/pkgMkIndex.test: Explicitly cd to
	::tcltest::testsDirectory at the beginning of the test run

	* tests/basic.test: Use version information defined in tcltest
	instead of hardcoded version number

	* tests/socket.test: package require tcltest before attempting to
	use variable defined in tcltest namespace

	* tests/unixInit.test: 
	* tests/unixNotfy.test: Added explicit exits needed to avoid
	problems when the tests area run in wish.
	
1999-10-12  Jim Ingham  <jingham@@scriptics.com>

	* mac/tclMacLoad.c: Stupid bug - we converted the filename to
	external, but used the unconverted version.
	* mac/tclMacFCmd.c: Fix a merge error in the bug fix for [Bug: 2869]

1999-10-12  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/regc_color.c:
	* generic/regc_cvec.c:
	* generic/regc_lex.c:
	* generic/regc_locale.c:
	* generic/regcomp.c:
	* generic/regcustom.h:
	* generic/regerrs.h:
	* generic/regex.h:
	* generic/regexec.c:
	* generic/regguts.h:
	* generic/tclRegexp.c:
	* generic/tclTest.c:
	* tests/reg.test: updated to Henry Spencer's new regexp engine
	(mid-Sept 99).  Should greatly reduce stack space reqs.

	* library/tcltest1.0/pkgIndex.tcl: fixed procs in pkgIndex.tcl file

	* generic/tclEnv.c: fixed mem leak with putenv and DStrings
	* doc/Encoding.3: corrected docs
	* tests/basic.test: updated test cases for 8.3
	* tests/encoding.test: fixed test case that change system
	encoding to a double-byte one (this causes a bogus mem read
	error for purify)
	* unix/Makefile.in: purify has to use -best-effort to instrument
	* unix/tclAppInit.c: identified potential mem leak when compiling
	tcltest (not critical)
	* unix/tclUnixPipe.c: fixed mem leak in TclpCreateProcess when
	doing alloc between vfork and execvp.
	* unix/tclUnixTest.c: fixed mem leak in findexecutable test command

1999-10-05  Jeff Hobbs  <hobbs@@scriptics.com>

	* {win,mac,unix,tools,}/README:
	* win/README.binary:
	* win/makefile.vc:
	* {win,unix}/configure.in:
	* generic/tcl.h:
	* library/init.tcl: updated to 8.3a1 from 8.2.0.

	* library/http2.1/http.tcl: fixed possible use of global c var.

	* win/tclWinReg.c: fixed registry command to properly 'get'
	HKEY_PERFORMANCE_DATA root key data.  Needs more work.
	
	* generic/tclNamesp.c:
	* generic/tclVar.c:
	* generic/tclCmdIL.c: fixed comment typos

	* mac/tclMacFCmd.c: fixed filename stuff to support UTF-8 [Bug: 2869]

	* win/tclWinSerial.c: changed SerialSetOptionProc to return
	TCL_OK by default. (patch from Rolf Schroedter)

1999-09-21  Jennifer Hom  <jenn@@scriptics.com>

	* library/tcltest1.0/tcltest.tcl: Applied patches sent in by
	Andreas Kupries to fix typos in comments and ::tcltest::grep,
	fix hook redefinition problems, and change "string compare" to
	"string equal." [Bug: 2836, 2837, 2839, 2840]

1999-09-20  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/env.test:
	* unix/Makefile.in: added support for AIX LIBPATH env var [Bug:	2793]
	removed second definition of INCLUDE_INSTALL_DIR (the one that
	referenced @@includedir@@) [Bug: 2805]
	* unix/dltest/Makefile.in: added -lc to LIBS [Bug: 2794]

1999-09-16  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/timer.test: changed after delay in timer test 6.29 from
	1 to 10. [Bug: 2796]

	* tests/pkg.test:
	* generic/tclPkg.c: fixed package version check to disallow 1.2..3
	[Bug: 2539]

	* unix/Makefile.in: fixed gendate target - this never worked
	since RCS was intro'd.
	* generic/tclGetDate.y: updated to reflect previous changes
	to tclDate.c (leap year calc) and added CEST and UCT time zone
	recognition.  Fixed 4 missing UCHAR() casts. [Bug: 2717, 954,
	1245, 1249]

	* generic/tclCkalloc.c: changed Tcl_DumpActiveMemory to really
	dump to stderr and close it [Bug: 725] and changed Tcl_Ckrealloc
	and Tcl_Ckfree to not bomb when NULL was passed in [Bug: 1719]
	and changed Tcl_Alloc, et al to not panic when a alloc request
	for zero came through and NULL was returned (valid on AIX, Tru64)
	[Bug: 2795, etc]

	* tests/clock.test:
	* doc/clock.n:
	* generic/tclClock.c: added -milliseconds switch to clock clicks
	to guarantee that the return value of clicks is in the millisecs
	granularity [Bug: 2682, 1332]

1999-09-15  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclIOCmd.c: fixed potential core dump in conjunction
	with stacked channels with result obj manipulation in
	Tcl_ReadChars [Bug: 2623]

	* tests/format.test:
	* generic/tclCmdAH.c: fixed translation of %0#s in format [Bug: 2605]

	* doc/msgcat.n: fixed \\ bug in example [Bug: 2548]

	* unix/tcl.m4:
	* unix/aclocal.m4: added fix for FreeBSD-[1-2] recognition
	[Bug: 2070] and fix for IRIX SHLIB_LB_LIBS. [Bug: 2610]

	* doc/array.n:
	* tests/var.test:
	* tests/set.test:
	* generic/tclVar.c: added an array unset operation, with docs
	and tests.  Variation of [Bug: 1775].  Added fix in TclArraySet
	to check when trying to set in a non-existent namespace. [Bug: 2613]

1999-09-14  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/linsert.test:
	* doc/linsert.n:
	* generic/tclCmdIL.c: fixed end-int interpretation of linsert
	to correctly calculate value for end, added test and docs [Bug: 2693]

	* doc/regexp.n:
	* doc/regsub.n:
	* tests/regexp.test:
	* generic/tclCmdMZ.c: add -start switch to regexp and regsub
	with docs and tests

	* doc/switch.n: added proper use of comments to example.
	* generic/tclCmdMZ.c: changed switch to complain when an error
	occurs that seems to be due to a misplaced comment.

	* generic/tclCmdMZ.c: fixed illegal ref for \[0-9] substitutions
	in regsub [Bug: 2723]

	* generic/tclCmdMZ.c: changed [string equal] to return an Int
	type object (was a Boolean)

1999-09-01  Jennifer Hom  <jenn@@scriptics.com>

	* library/tcltest1.0/tcltest.tcl: Process command-line arguments
	only ::tcltest doesn't have a child namespace (requires that
	command-line args are processed in that namespace)

1999-09-01  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclParseExpr.c: changed '"' to '\"' to make FreeBSD
	happy [Bug: 2625]
	* generic/tclProc.c: moved static buf to better location and
	changed static msg that would overflow in ProcessProcResultCode
	[Bug: 2483] and added Tcl_DStringFree to Tcl_ProcObjCmd.
	Also reworked size of static buffers.
	* tests/stringObj.test: added test 9.11
	* generic/tclStringObj.c: changed Tcl_AppendObjToObj to
	properly handle the 1-byte dest and mixed src case where
	both had had Unicode string len checks made on them.  [Bug: 2678]
	* unix/aclocal.m4:
	* unix/tcl.m4: adjusted fix from 8-21 to add -bnoentry to the
	AIX-* case and readjusted the range

1999-08-31  Jennifer Hom  <jenn@@scriptics.com>

	* library/tcltest1.0/tcltest.tcl:
	* doc/tcltest.n:
	* tests/README: Modified testConstraints variable so that it isn't
	unset every time ::tcltest::initConstraints is called and cleaned up
	documentation in the README file and the man page.

1999-08-27  Jennifer Hom  <jenn@@scriptics.com>

	* tests/env.test:
	* tests/exec.test:
	* tests/io.test:
	* tests/event.test:
	* tests/tcltest.test: Added 'exit' calls to scripts that the tests 
	themselves write, and removed accidental checkin of knownBugThreaded
	constraints for Solaris and Linux.
	
	* library/tcltest1.0/tcltest.tcl:  Modified tcltest so that
	variables are only initialized to their default values if they did
	not previously exist. 

1999-08-26  Jennifer Hom  <jenn@@scriptics.com>

	* tests/tcltest.test:
	* library/tcltest1.0/tcltest.tcl:  Added a -args flag that sets a
	variable named ::tcltest::parameters based on whatever's being
	sent in as the argument to the -args flag. 

1999-08-23  Jennifer Hom  <jenn@@scriptics.com>

	* tests/tcltest.test: Added additional tests for -tmpdir, marked
	all tests that use exec as unixOrPc.

	* tests/encoding.test:
	* tests/interp.test: 
	* tests/macFCmd.test:
	* tests/parseOld.test:
	* tests/regexp.test: Applied patches from Jim Ingham to add
	encoding to a Mac only interp test, change an error message in
	macFCmd.tet, put a comment in parseOld.test, fix tests using the
	testencoding path command, and put unixOrPc constraints on tests
	that use exec. 

1999-08-21  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/aclocal.m4: Changed AIX-4.[2-9] check to AIX-4.[1-9]
	[Bug: 1909]

1999-08-20  Jeff Hobbs  <hobbs@@scriptics.com>
>>>>>>> 1.1.1.5

<<<<<<< ChangeLog
Thu Apr 20 17:01:19 2000  Andrew Cagney  <cagney@@b1.cygnus.com>
=======
	* generic/tclPosixStr.c: fixed typo [Bug: 2592]
>>>>>>> 1.1.1.5

<<<<<<< ChangeLog
	From Alexandre Oliva <aoliva@@cygnus.com>
	* generic/tclPosixStr.c (Tcl_SignalId, Tcl_SignalMsg): Do not
	issue SIGPWR case if it's the same as SIGLOST.
=======
	* doc/*: fixed various nroff bugs in man pages [Bug: 2503 2588]
>>>>>>> 1.1.1.5

<<<<<<< ChangeLog
2000-01-26  DJ Delorie  <dj@@cygnus.com>
=======
1999-08-19  Jeff Hobbs  <hobbs@@scriptics.com>
>>>>>>> 1.1.1.5

<<<<<<< ChangeLog
	* win/tclWin32Dll.c (DllMain): Use standard _imp__reent_data,
	not old-style __imp_reent_data
	* generic/tclEnv.c (environ): ditto for _imp____cygwin_environ

2000-01-17  Drew Moseley  <dmoseley@@cygnus.com>
=======
	* win/README.binary: fixed version info and some typos [Bug: 2561]
	
	* doc/interp.n: updated list of commands available in a safe
	interpreter [Bug: 2526]

	* generic/tclIO.c: changed Tcl_GetChannelNames* to use style guide
	headers (pleases HP cc)
>>>>>>> 1.1.1.5

<<<<<<< ChangeLog
	* cygwin/configure.in: Fixed bug in setting of shell variable which
	caused it to be interpreted as a subcommand rather than a variable.
	* cygwin/configure: Regenerated.
=======
1999-08-18  Jeff Hobbs  <hobbs@@scriptics.com>
>>>>>>> 1.1.1.5

<<<<<<< ChangeLog
1999-11-09  DJ Delorie  <dj@@cygnus.com>
=======
	* doc/Eval.3: fixed doc on input args [Bug: 2114]

	* doc/OpenFileChnl.3:
	* doc/file.n:
	* tests/cmdAH.test:
	* tclIO.c:
	* tclCmdAH.c: added "file channels ?pattern?" tcl command, with
	associated Tcl_GetChannelNames and Tcl_GetChannelNamesEx public
	C APIs (added to tcl.decls as well), with docs and tests.

	* tests/expr.test:
	* generic/tclCompile.c: add TCL_TOKEN_VARIABLE to the part types
	that cause differed compilation for exprs, to correct the expr
	double-evaluation problem for vars.  Added test cases.
	Related to [Bug: 732]

	* unix/Makefile.in: changed the dependency structure so that
	install-* is dependent on * (ie - install-binaries is dependent
	on binaries).
	
	* library/auto.tcl:
	* library/init.tcl:
	* library/ldAout.tcl:
	* library/package.tcl:
	* library/safe.tcl:
	* library/word.tcl:
	* library/http2.1/http.tcl:
	* library/msgcat1.0/msgcat.tcl: updated libraries to better
	Tcl style guide (no more string comparisons with == or !=, spacing
	changes).

1999-08-05  Jim Ingham  <jingham@@cygnus.com>

	* mac/tclMacProjects.sea.hqx: Rearrange the projects so that the build
	directory is separate from the sources.	 Much more convenient!

1999-08-13  Scott Redman <redman@@scriptics.com>

	* /: 8.2.0 tagged for final release

1999-08-12  Scott Stanton  <stanton@@scriptics.com>

	* win/Makefile.in: Added COMPILE_DEBUG_FLAGS macro to make it
	easier to turn on compiler tracing.

	* tests/parse.test: 
	* generic/tclParse.c: Fixed bug in Tcl_EvalEx where the termOffset
	was not being updated in cases where the evaluation returned a non
	TCL_OK error code. [Bug: 2535]

1999-08-12  Scott Redman  <redman@@scriptics.com>

	* win/tclWinSerial.c: Applied patch from Petteri Kettunen to
	remove compiler warning.

1999-08-10  Scott Redman  <redman@@scriptics.com>

	* generic/tclAlloc.c:
	* generic/tclCmdIL.c:
	* generic/tclIO.c:
	* generic/tclThread.c:
	* win/tclWinThrd.c:
	* unix/tclUnixThrd.c: Fixed Brent's changes so that they work on
	Windows (and he fixed the bug in the Unix thread implementation).

1999-08-09  Brent Welch  <welch@@scriptics.com>
        
	* generic/tcl.decls:
	* generic/tclAlloc.c:
	* generic/tclCkalloc.c:
	* generic/tclCmdIL.c:
	* generic/tclDecls.h: 
	* generic/tclIO.c:
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c:
	* mac/tclMacThrd.c:
	* unix/tclUnixThrd.c:
	* win/tclWinThrd.c: Added use of Tcl_GetAllocMutex to tclAlloc.c
	and tclCkalloc.c so they can be linked against alternate thread
	packages. Added Tcl_GetChannelNames to tclIO.c.	Added
	TclVarTraceExists hook so "info exists" triggers read traces
	exactly like it did in Tcl 7.6. Stubs table changes to reflect new
	internal and external APIs.

1999-08-09  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/string.test: added largest_int proc to adapt for >32 bit
	machines and int overflow testing.
	* tests/tcltest.test: fixed minor error in 8.2 result (from dgp)

	* doc/Object.3: clarified Tcl_DecrRefCount docs [Bug: 1952]
	* doc/array.n: clarified array pattern docs [Bug: 1330]
	* doc/clock.n: fixed clock docs [Bug: 693]
	* doc/lindex.n: clarified to account for new end-int behavior.
	* doc/string.n: fixed formatting errors [Bug: 2188 2189]
	* doc/tclvars.n: fixed doc error [Bug: 2042]
	* library/init.tcl: fixed path handling in auto_execok (it could
	miss including the normal path on some Windows machines) [Bug: 1276]

1999-08-05  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/tclvars.n: Made it clear that tcl_pkgPath was not set
	for Windows (already mentioned in init.tcl) [Bug: 2455]
	* generic/tclLiteral.c: fixed reference to bytes that might
	not be null terminated (using objPtr->bytes, which is) [Bug: 2496]
	* library/http2.1/http.tcl: Made use of "i" in init section use
	local var and start at 0 (was 1). [Bug: 2502]

1999-08-04  Scott Stanton  <stanton@@scriptics.com>

	* tests/reg.test: Added test for REG_EXPECT bug fixed by Henry's
	patch.

	* generic/regc_nfa.c: 
	* generic/regcomp.c: 
	* generic/rege_dfa.c:
	* generic/regexec.c: 
	* generic/regguts.h: Applied patches supplied by Henry Spencer to
	greatly enhance the performance of certain classes of regular
	expressions. [Bug: 2440, 2447]

1999-08-03  Scott Redman  <redman@@scriptics.com>
>>>>>>> 1.1.1.5

<<<<<<< ChangeLog
	* cygwin/*: redone with automake for cygwin-specific info (from cgf)
	to support cross-host builds
=======
	* win/tclWinInt.h: Remove function declarations in header that was
	moved to tclInt.decls file in previous changes.
>>>>>>> 1.1.1.5

<<<<<<< ChangeLog
1999-10-26  DJ Delorie  <dj@@cygnus.com>

	* cygwin/*: new; replicate unix/* setup (other modules look
	in unix/* for "local" builds; we don't want them to find the
	cygwin version)
	* unix/Makefile.in: undo
	* configure.in: For cygwin, build win and cygwin
	* Makefile.in: re-enable multi-dir support

Tue Oct 26 13:16:09 1999  Christopher Faylor <cgf@@cygnus.com>

	* win/configure.in: Add better detection of cross-compilation
	environment.
	* win/configure: Regenerate.
=======
1999-08-02  Scott Redman  <redman@@scriptics.com>

	* unix/configure.in:
	* win/configure.in: Change beta level to b2.
	
	* generic/tcl.h:
	* generic/tcl.decls:
	* generic/tclDecls.h:
	* generic/tclInt.h:
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclRegexp.h:
	* generic/tclStubInit.c: Move some exported public and internal
	functions to the stub tables.  Removed functions that are in the
	stub tables (from this and previous changes) from the original
	header files.

1999-08-01  Scott Redman  <redman@@scriptics.com>

	* win/tclWinSock.c: Added comment block to SocketThread()
	function.  Added code to avoid calling TerminateThread(), but
	instead to send a message to the socket event window to tell it to
	terminate its thread.

1999-07-30  Jennifer Hom  <jenn@@scriptics.com>

	* tests/tcltest.test:
	* library/tcltest1.0/tcltest.tcl: Exit with non-zero status if
	there were problems with the way the test suite was started
	(e.g. wrong # arguments).  

1999-07-30  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclInt.decls: added declaractions necessary for the
	Tcl test code to work wth stubs [Bug: 2445]

1999-07-30    <redman@@scriptics.com>

	* win/tclWinPipe.c:
	* win/Makefile.in: Fixing launching of 16-bit apps on Win9x from
	wish.  The command line was primed with tclpip82.dll, but it was
	ignored.  Fixed that, then fixed the gmake makefile to build
	tclpip82.dll as an executable.

	* win/tclWinSock.c: Applied small patch to get thread-specific
	data after initializing the socket driver.

	* unix/tclUnixThrd.c: Applied patch to fix threads on Irix 6.5.
	Patch from James Dennett.  [Bug: 2450]

	* tests/info.test: Enable test for tclParse.c change (info
	complete).
	
1999-07-30    <hobbs@@scriptics.com>

	* tclIO.c: added fix for Kupries' trf patch [Bug: 2386]

	* tclParse.c: fixed bug in info complete regarding nested square
	brackets [Bug: 2382, 2466]
	
1999-07-29    <redman@@scriptics.com>

	* win/tclWinChan.c: Allow tcl to open CON and NUL, even for std
	channels.  Checking for bad/unusable std channels was moved to Tk
	since its only purpose was to check whether to use the Tk Console
	Window for the std channels.  [Bug: 2393 2392 2209 2458]

	* unix/mkLinks.tcl: Applied patch to avoid linking pack.n to
	pack-old.n.  Patch from Don Porter. [Bug: 2469]

	* doc/Encoding.n: Applied patch to fix typo in .SH NAME line.
	Patch from Don Porter.  [Bug: 2451]
	
	* win/tclWinSock.c:  Free Win32 Event handles when destroying
	the socket helper thread.

1999-07-28    <jenn@@scriptics.com>

	* tests/tcltest.test:
	* library/tcltest1.0/tcltest.tcl: Fixed the condition under which
	::tcltest::PrintError had an infinite loop problem and added a
	test case for it.  Added an optional argument to
	::tcltest::getMatchingFiles telling it where to search for test
	files. 

1999-07-27    <redman@@scriptics.com>

	* tools/tclSplash.bmp:  Updated Windows installer bitmap
	to ready Tcl/Tk Version 8.2.

1999-07-26    <redman@@scriptics.com>

	* tests/tcltest.test:  Need to close the new core file, there
	seems to be a hang in threaded WinNT if the file isn't closed.
	Open issue, need to fix that hang.

	* tests/httpold.test:  Add time delay in response from Http server
	so that test cases can properly detect timeout conditions with
	threads enabled on multi-CPU WinNT.

	* tests/winFCmd.test:  Test case winFcmd-1.33 was looking for
	c:\windows, which may not exist.  Instead, create a new directory
	on c:\ and use it for the test.

	* win/tclWinConsole.c:
	* win/tclWinPipe.c:
	* win/tclWinSock.c:  Fix terminating helper threads by holding any
	mutexes from the primary thread while waiting for the helper
	thread to terminate.  Without these changes, the test suite hangs
	on WinNT with 2 CPUs and threads enabled.  Open issue, seems to be
	a sporadic hang on dual CPU systems still (very rare).

1999-07-26  Jennifer Hom  <jenn@@scriptics.com>

	* tests/tcltest.test:
	* library/tcltest1.0/tcltest.tcl:
	* doc/tcltest.n: Cleaned up code in ::tcltest::PrintError, revised
	documentation, and added tests for the tcltest package.

1999-07-23    <redman@@scriptics.com>

	* tests/info.test:
	* generic/tclParse.c:  Removed patch for info command, breaks test
	cases on Unix.  Patch was bad and needs to be redone
	properly. [Bug: 2382]

1999-07-22    <redman@@scriptics.com>

	* Changed version to 8.2b2.

	* win/tclWinSock.c: Fixed hang with threads enabled, fixed
	semaphores with threads disabled.

	* win/safe.test: Fixed safe-6.3 with threads enabled.
	
	* win/Makefile.in:  Fixed calling of tcltest to fix safe.test
	failures due to path TCL_LIBRARY path.

	* win/tclWinPort.h: Block out include of sys/*.h in order to
	build extensions with MetroWerks compiler for Win32. [Bug: 2385]
	
	* generic/tclCmdMZ.c:
	* generic/tclIO.c: Fix ANSI-style prototypes based on patch from
	Ulrich Ring.  [Bug: 2391]
	
	* unix/Makefile.in: Need to make install-sh executable before
	calling (with chmod +x).  [Bug: 2413]
	
	* tests/var.test:
	* generic/tclVar.c:  Fixed bug that caused a seg. fault when using
	"array set a(b) {}", which is a bad array name anyway.  Now the
	"array set" command will return an error in this case.  Added test
	case and fixed existing test. [Bug: 2427]

1999-07-21    <redman@@scriptics.com>

	* tests/info.test:
	* generic/tclParse.c:  Applied patch to fix "info complete"
	for the string {[a [b]}.  Patch from Peter Spjuth. [Bug: 2382]
d1524 16
d1541 18
a1558 52
	* generic/tcl.decls:
	* generic/tclDecls.h:
	* generic/tclUtf.c: Changed function declarations in
	non-platform-specific public APIs to use "unsigned long" instead of
	"size_t", which may not be defined on certain compilers (rather
	than include sys/types.h, which may not exist).
	
	* unix/Makefile.in: Added the Windows configure script to the
	distribution file list, already shipping configure.in and the .m4
	files, but needed the configure script itself.
	
	* win/makefile.vc: Changed version number of DDE package in VC++
	makefile to use 1.1 instead of 1.0.

	* doc/open.n: Added documentation of \\.\comX notation for opening
	serial ports on Windows (alternative to comX:).
	
	* tests/ioCmd.test:
	* doc/open.n:
	* win/tclWinSerial.c: Applied patch from Rolf Schroedter to add
	-pollinterval option to fconfigure to modify the maxblocktime used
	in the fileevent polling. Added documentation and fixed the test
	case as well.
	
	* win/tclWinSock.c: Modified 8.1.0 version of the Win32 socket
	driver to move the handling of the socket event window in a
	separate thread.  It also turned out that Win95 & Win98 were, in
	some cases, getting multiple FD_ACCEPTs but only handling one.
	Added a count for the FD_ACCEPT to take care of this.  Tested on
	NT4 SP3, NT4 SP4, Win95, and Win98.
	[Bug: 2178 2256 2259 2329 2323 2355]

1999-07-21    <jpeek@@scriptics.com>

	* README: Small tweaks to clean up typos and wording.

1999-07-20  Melissa Hirschl  <hershey@@matisse.scriptics.com>

	* generic/tclInitScript.h: 
	* unix/tclUnixInit.c: merged code with 8.0.5.  We now use an
	intermediate global tcl var "tclDefaultLibrary" to keep the
	"tcl_library" var from being set by the default value in the
	Makefile.  Also fixed a bug in which caused the value of
	TCL_LIBRARY env var to be ignored.
	* unix/tclWinInit.c: just updated some comments.

1999-07-19  Melissa Hirschl  <hershey@@matisse.scriptics.com>

	* library/http2.1/http.tcl: updated -useragent text to say version
	2.1.

1999-07-16    <redman@@scriptics.com>
d1560 1
a1560 12
	* generic/tcl.decls:
	* generic/tclDecls.h:
	* generic/tclStubInit.c:  Add Tcl_SetNotifier to stub table.
	[Bug: 2364]
	
	* unix/aclocal.m4:
	* unix/tcl.m4:  Add check for Alpha/Linux to correct the IEEE
	floating flag to the compiler, should be -mieee.  Patch from Don
	Porter.
	
	* tools/tcl.hpj.in: Change version number of .cnt file referenced
	in .HPJ file.
d1562 5
a1566 3
1999-07-15    <redman@@scriptics.com>
	
	* tools/tcl.wse.in: Fixed naming of target files for Windows.
d1568 1
a1568 1
1999-07-14    <jpeek@@scriptics.com>
d1570 1
a1570 1
	* doc/re_syntax.n: Deleted sentence as suggested by Scott S.
d1572 4
a1575 1
1999-07-12    <jpeek@@scriptics.com>
d1577 1
a1577 2
	* doc/re_syntax.n: Removed two notes to myself (oops), cleaned
	up wording, fixed changebars, made two examples easier to read.
d1579 2
a1580 1
1999-07-11    <redman@@scriptics.com>
d1582 1
a1582 5
	* win/makefile.vc: Since the makefile.vc should continue to work
	while we're working out bugs/issues in the new TEA-style
	autoconf/configure/gmake build mechanism for Windows, the version
	numbers of the Tcl libraries need to remain in sync.  Modified the
	version numbers in the makefile to reflect the change to 8.2b1.
d1584 1
a1584 1
1999-07-09    <redman@@scriptics.com>
d1586 1
a1586 6
	* win/configure.in: Eval DLLSUFFIX, LIBSUFFIX, and EXESUFFIX in
	the configure script so that substitutions get expanded before
	being placed in the Makefile.  The "d" portion for debug libraries
	and DLLs was not being set properly.
	
1999-07-08    <stanton@@scriptics.com>
d1588 1
a1588 3
	* tests/string.test: 
	* generic/tclCmdMZ.c: Fixed bug in string range bounds checking
	code.
d1590 6
a1595 1
1999-07-08  Jennifer Hom  <jenn@@scriptics.com>
d1597 53
a1650 4
	* library/tcltest1.0/tcltest.tcl: Removed -asidefromdir and
	-relateddir flags, removed unused ::tcltest::dotests proc, cleaned
	up implementation of core file checking, and fixed the code that
	checks for 1-letter flag abbreviations.
d1652 2
a1653 1
1999-07-08    <stanton@@scriptics.com>
d1655 1
a1655 2
	* win/Makefile.in: Added tcltest target so runtest works
	properly.  Added missing names to the clean/distclean targets.
d1657 7
a1663 215
	* tests/reg.test: 
	* generic/rege_dfa.c: Applied fix supplied by Henry Spencer for
	bug in DFA state caching under lookahead conditions.  [Bug: 2318]

1999-07-07    <stanton@@scriptics.com>

	* doc/fconfigure.n: Clarified default buffering behavior for the
	standard channels. [Bug: 2335]

1999-07-06    <redman@@scriptics.com>

	* win/tclWinSerial.c:  New implementation of serial port driver
	from Rolf Shroedter (Rolf.Schroedter@@dlr.de) that allows more than
	one byte to be read from the port.  Implemented using polling
	instead of threads, there is a max. 10ms latency between checking the
	port for file events.  [Bug: 1980 2217]

1999-07-06    <welch@@scriptics.com>

	* library/http2.0/http.tcl: Fixed the -timeout option so it
	handles timeouts that occur during connection attempts to
	hosts that are down (the only case that really matters!)

1999-07-03    <welch@@scriptics.com>

	* doc/ChnlStack.3:
	* generic/tcl.decls:
	* generic/tclIO.c: Added a new variant of the "Trf patch"
	from Andreas Kupres that adds new C APIs Tcl_StackChannel,
	Tcl_UnstackChannel, and Tcl_GetStackedChannel.

1999-07-03    <welch@@scriptics.com>

	* generic/tclNotify.c:
	* unix/tclUnixNotfy.c:
	* unix/tclXtTest.c:
	* unix/tclXtNotify.c:
	* win/tclWinNotify.c:
	* mac/tclMacNotify.c: Added Tcl_SetNotifier and the associated
	hook points in the notifiers to be able to replace the notifier
	calls at runtime  The Xt notifier and test program use this hook.

1999-07-03    <welch@@scriptics.com>

	* generic/tclParse.c: Changed parsing of variable names to
	allow empty array names.  Now "$(foo)" is a variable reference!
	Previous you had to use something like $::(foo), which is slower.
	This change is requested by Jean-Luc Fontaine for his STOOOP
	package.

1999-07-01    <redman@@scriptics.com>

	* generic/tclCmdAH.c:
	* generic/tclFCmd.c: Call TclStat instead of TclpStat in order to
	allow Tcl_Stat hooks to work properly.

1999-06-29  Jennifer Hom  <jenn@@scriptics.com>

	* library/tcltest1.0/pkgIndex.tcl:
	* library/tcltest1.0/tcltest.tcl:
	* doc/tcltest.n:
	* tests/all.tcl: Added -preservecore, -limitconstraints, -help,
	-file, -notfile, -relateddir and -asidefromdir flags to the
	tcltest package along with exported proc
	::tcltest::getMatchingFiles.  The documentation was modified to
	match and all.tcl was modified to use the new functionality
	instead of implementing -file itself. 

1999-06-28    <redman@@scriptics.com>

	* generic/tclIndexObj.c:
	* doc/GetIndex.3:
	* tests/binary.test:
	* tests/winDde.test: Applied patch from Peter Hardie (with
	changes) to fix problem with Tcl_GetIndexFromObj() when the key
	being passed is the empty string.  It used to match "" and return
	TCL_OK, but it should have returned TCL_ERROR instead.  Added test
	case to "binary" and "dde" commands to check the behavior.  Added
	documentation note as well.

1999-06-26    <redman@@scriptics.com>

	* win/tclWinDde.c: Applied patch from Peter Hardie to add poke
	command to dde.  Also rev'd version of dde package to 1.1.
	[Bug: 1738]

1999-06-25  Jennifer Hom  <jenn@@scriptics.com>

	* unix/Makefile.in:
	* win/Makefile.in:
	* library/tcltest1.0/pkgIndex.tcl:
	* library/tcltest1.0/tcltest.tcl:
	* library/tcltest1.0: Added initial implementation of the Tcl test
	harness package.  This package was based on the defs.tcl file that
	was part of the tests directory. Reversed the way that tests were
	evaluated to fix a problem with false passes.

	* doc/tcltest.n: Added documentation for the tcltest package.

	* tests/README:
	* tests/defs.tcl:
	* tests/all.tcl: Modified all test files (tests/*.test) and
	all.tcl to use the new tcltest package and removed references to
	the defs.tcl file. Modified the README file to point to the man
	page for tcltest. 
	
1999-06-25    <stanton@@scriptics.com>

	* tests/reg.test: 
	* generic/regexec.c: Fixed bugs in non-greedy quantifiers.

1999-06-23    <jpeek@@scriptics.com>

	* doc/re_syntax.n:
	* doc/switch.n:
	* doc/lsearch.n:
	* doc/RegExp.3:
	* doc/regexp.n:
	* doc/regsub.n: Moved information about syntax of 8.1 regular
	expressions from regexp(n) manpage into new re_syntax(n) page.
	Added pointers from other manpages to new re_syntax(n) page.

1999-06-23    <stanton@@scriptics.com>

	* unix/Makefile.in: Changed install-doc to install-man.

	* tools/uniParse.tcl: 
	* tools/uniClass.tcl: 
	* tools/README: 
	* tests/string.test: 
	* generic/regc_locale.c: 
	* generic/tclUniData.c: 
	* generic/tclUtf.c: 
	* doc/string.n: Updated Unicode character tables to reflect latest
	Unicode 2.1 data.  Also rationalized "regexp" and "string is"
	definitions of character classes.

1999-06-21    <stanton@@scriptics.com>

	* unix/tclUnixThrd.c (TclpThreadCreate): Fixed memory leak where
	thread attributes were not being released. [Bug: 2254]

1999-06-17    <stanton@@scriptics.com>

	* tests/regexp.test: 
	* generic/tclCmdMZ.c: 
	* generic/tclCmdIL.c: Changed to use new regexp interfaces.  Added
	-expanded, -line, -linestop, and -lineanchor switches to regsub.

	* doc/RegExp.3: Documented the new regexp interfaces and
	the compile/execute flags.
	
	* generic/tclTest.c: 
	* generic/tclRegexp.h:
	* generic/tclRegexp.c: 
	* generic/tcl.h: 
	* generic/tcl.decls: Renamed Tcl_RegExpMatchObj to
	Tcl_RegExpExecObj and added a new Tcl_RegExpMatchObj that is
	equivalent to Tcl_RegExpMatch.  Added public macros for the regexp
	compile/execute flags.  Changed to store either an object pointer
	or a string pointer in the TclRegexp structure.  Changed to avoid
	adding a reference to the object or copying the string.

	* generic/regcomp.c: lint

	* tests/reg.test: 
	* generic/regex.h: 
	* generic/regc_lex.c: Added REG_BOSONLY flag to allow Expect to
	iterate through a string an only find matches that start at the
	current position within the string.

1999-06-16  <wart@@scriptics.com>

	* unix/configure.in:
	* unix/Makefile.in:
	* unix/tcl.m4:
	* unix/aclocal.m4: Numerous build changes to make Tcl conform to the
	proposed TEA spec

1999-06-16  Melissa Hirschl  <hershey@@matisse.scriptics.com>

	* generic/tclVar.c (Tcl_VariableObjCmd): fixed premature increment
	in loop that was causing out-of-bounds reads on array "varName".

1999-06-16    <stanton@@scriptics.com>

	* tests/execute.test:
	* generic/tclExecute.c (TclExecuteByteCode): Fixed crash caused by
	a bug in INST_LOAD_SCALAR1 where the scalar index was read as
	a signed 1 byte value instead of unsigned.  [Bug: 2243]

1999-06-14  Melissa Hirschl  <hershey@@matisse.scriptics.com>

	* doc/StringObj.3
	* test/stringObj.test
	* unix/Makefile.in
	* win/Makefile.in
	* win/makefile.vc
	* generic/tclStringObj.c:
	Merged String and Unicode object types.  Added new functions to
	the puplic API:  Tcl_NewUnicodeObj, Tcl_SetUnicodeObj,
	Tcl_GetUnicode, Tcl_GetUniChar, Tcl_GetCharLength, Tcl_GetRange,
	Tcl_AppendUnicodeToObj.

1999-06-09    <stanton@@scriptics.com>

	* generic/tclUnicodeObj.c: Lots of cleanup and simplification.
	Fixed several memory bugs.  Added TclAppendUnicodeToObj.  

	* generic/tclInt.h: Added declarations for various Unicode string
	functions.  

	* generic/tclRegexp.c: 
	* generic/tclCmdMZ.c: Changed to use new Unicode string interfaces
	for better performance. 
d1665 1
a1665 11
	* generic/tclRegexp.h: 
	* generic/tclRegexp.c: 
	* generic/tcl.h: 
	* generic/tcl.decls: Added Tcl_RegExpMatchObj and
	Tcl_RegExpGetInfo calls to access lower level regexp API.  These
	features are needed by Expect.  This is a preliminary
	implementation pending final review and cleanup.

	* generic/tclCmdMZ.c:
	* tests/string.test: Fixed bug where string map failed on null
	strings. 
d1667 2
a1668 2
	* generic/regexec.c: 
	* unix/tclUnixNotfy.c: lint
d1670 1
a1670 1
	* tools/genStubs.tcl: Changed to always write output in LF mode.
d1672 3
a1674 123
1999-06-08    <stanton@@scriptics.com>

	* win/tclWinSock.c: Rolled back to the 8.1.0 implementation
	because of serious problems with the new driver.  Basically no
	incoming socket connections would be reported to a server port.
	The 8.1.1 code needs to be redesigned and fixed correctly.

1999-06-07  Melissa Hirschl  <hershey@@matisse.scriptics.com>

	* tests/string.test: 
	* generic/tclVar.c (Tcl_SetVar2Ex):
	* generic/tclStringObj.c (Tcl_AppendObjToObj):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): optimized the string
	index, string length, string range, and append command in cases
	where the object's internal rep is a bytearray.  Objects with
	other internal reps are converted to have the new unicode internal
	rep.  

	* unix/Makefile.in: 
	* win/Makefile.in: 
	* win/Makefile.vc: 
	* tests/unicode.test: 
	* generic/tclInt.h:
	* generic/tclObj.c:
	* generic/tclUnicodeObj.c: added a new object type to store the
	unicode representation of a string.

	* generic/tclTestObj.c: added the objtype option to the testobj
	command.  This option returns the name of the type of internal rep
	an object has.

1999-06-04    <stanton@@scriptics.com>

	* win/configure.in: 
	* win/Makefile.in: Windows build now handles static/dynamic
	debug/nodebug builds and supports the standard targets using
	Cygwin user tools plus GNU make and autoconf.

1999-06-03    <stanton@@scriptics.com>

	* generic/tclCmdMZ.c (Tcl_StringObjCmd): 
	* tests/string.test: Fixed bug where string equal/compare -nocase
	reported wrong result on null strings. [Bug: 2138]

1999-06-02    <stanton@@scriptics.com>

	* generic/tclUtf.c (Tcl_UtfNcasecmp): Fixed incorrect computation
	of relative ordering. [Bug: 2135]

1999-06-01    <stanton@@scriptics.com>

	* unix/configure.in: Fixed various small configure.in patches
	submitted by Jan Nijtmans. [Bug: 2121]

	* tests/reg.test: 
	* generic/regc_color.c: 
	* generic/regc_cvec.c: 
	* generic/regc_lex.c: 
	* generic/regc_locale.c: 
	* generic/regc_nfa.c: 
	* generic/regcomp.c: 
	* generic/regcustom.h: 
	* generic/rege_dfa.c: 
	* generic/regerror.c: 
	* generic/regerrs.h: 
	* generic/regex.h: 
	* generic/regexec.c: 
	* generic/regfree.c: 
	* generic/regfronts.c: 
	* generic/regguts.h: 
	* generic/tclCmdMZ.c: 
	* generic/tclRegexp.c: 
	* generic/tclRegexp.h: 
	* generic/tclTest.c: Applied Henry Spencer's latest regexp patches
	that fix an infinite loop bug and add support for testing whether
	a string could match with additional input.  [Bug: 2117]

1999-05-28    <stanton@@scriptics.com>

	* generic/tclObj.c: Changed to eliminate use of isupper/tolower in
	favor of the Unicode versions.

	* win/Makefile.in:
	* win/configure.in: Added preliminary TEA implementation.

	* win/tclWinDde.c: Fixed bug where dde calls were being passed an
	invalid dde handle because Initialize had not been called.
	[Bug: 2124]

1999-05-26    <redman@@scriptic.com>

	* generic/tclThreadTest.c: Fixed race condition in testthread
	code that showed up in the WinNT test suite intermittently.

	* win/tclWinSock.c: Fixed a hang in the WinNT socket driver, wake
	up the socket thread every 100ms to check for events on the
	sockets that did not wake up the thread (race condition).

1999-05-24    <stanton@@scriptics.com>

	* tools/genStubs.tcl: Changed to allow a list of platforms instead
	of just one at a time.

	* generic/tcl.decls: 
	* generic/tclCmdMZ.c: 
	* generic/tclDecls.h: 
	* generic/tclInt.decls: 
	* generic/tclIntDecls.h: 
	* generic/tclPort.h: 
	* generic/tclStubInit.c: 
	* generic/tclStubLib.c: Various header file related changes and other
	lint to try to get the Mac builds working.

1999-05-21    <redman@@scriptics.com>

	* win/tclWinPipe.c: Fix bug when launching command.com on
	Win95/98.  Need to wait for the procInfo.hProcess of the process that
	was created, not the hProcess of the current process.  [Bug: 2105]

1999-05-20    <redman@@scriptics.com>

	* library/init.tcl: Add the directory where the executable is, and
	the ../lib directory relative to that, to the auto_path variable.
d1676 1
a1676 1
1999-05-19    <stanton@@scriptics.com>
d1678 3
a1680 16
	Merged in various changes submitted by Jeff Hobbs:
	
	* generic/tcl.decls: 
	* generic/tclUtf.c: Added Tcl_UniCharIs* functions for control,
	graph, print, and punct classes.

	* generic/tclUtil.c:
	* doc/StrMatch.3: Added Tcl_StringCaseMatch() implementation to
	support case-insensitive globbing.
	
	* doc/string.n: 
	* unix/mkLinks: 
	* tests/string.test: 
	* generic/tclCmdMZ.c: Added additional character class tests,
	added -nocase switch to "string match", changed string first/last
	to use offsets.
d1682 1
a1682 1
1999-05-19    <redman@@scriptics.com>
d1684 4
a1687 3
	* generic/tcl.h: Add extern "C" block around entire header file for
	C++ compilers to fix linkage issues.  Submitted by Don Porter and
	Paul Duffin.
d1689 2
a1690 508
	* generic/tclRegexp.c: Fix bug when the regexp cache is empty
	and an empty pattern is used in regexp ( such as {} or "" ).

1999-05-18    <stanton@@scriptics.com>

	* win/tclWinChan.c: Modified initialization code to avoid
	inherenting closed or invalid channels.  If the standard input is
	anything other than a console, file, serial port, or pipe, then we
	fall back to the standard Tk window console.

1999-05-14    <stanton@@scriptics.com>

	* generic/tclCmdAH.c (Tcl_ForObjCmd): Fixed crash caused by
	failure to reset the result before evaluating the test
	expression. 

1999-05-14    <surles@@scriptics.com>

	* generic/tclBasic.c (Tcl_CreateInterp): Added introspection
	variable for threaded interps.  If the interp was compiled with
	threads enabled, the tcl_platform(threaded) variable will exist.

1999-05-14    <redman@@scriptics.com>

	* generic/tclDate.c: Applied patch to fix 100-year and 400-year
	boundaries in leap year code, from Isaac Hollander.  [Bug: 2066]

1999-05-13    <stanton@@scriptics.com>

	* unix/Makefile.in:
	* unix/tclAppInit.c: Minor cleanup related to Xt notifier.
	
	* unix/tclUnixInit.c (TclpSetInitialEncodings): Tcl now looks for
	an encoding subfield in the LANG/LC_ALL variables in cases where
	the locale is not found in the locale table.  Ensure that
	setlocale() is called at least once so X11 will initialize
	properly.  Also, forces the LC_NUMERIC locale to be "C" so numeric
	processing in scripts is not affected by the current locale
	setting. [Bug: 1989]

	* generic/tclRegexp.c: Increased per-thread regexp cache to 30
	slots.  This seems to be about the right number for larger
	applications like exmh.  [Bug: 1063]

1999-05-12    <stanton@@scriptics.com>

	* doc/tclsh.1: Updated references to rc script names to accurately
	reflect the platform differences on Windows.

	* tests/regexp.test: 
	* generic/tclInt.h: 
	* generic/tclBasic.c: 
	* generic/tclRegexp.h:
	* generic/tclRegexp.c: Replaced the per-interpreter regexp cache
	with a per-thread cache.  Changed the Regexp object to take
	advantage of this extra cache.  Added a reference count to the
	TclRegexp type so regexps can be shared by multiple objects.
	Removed the per-interp regexp cache from the interpreter.  Now
	regexps can be used with no need for an interpreter. [Bug: 1063]

	* win/tclWinInit.c (TclpSetVariables): Avoid calling GetUserName
	if the value can be determined from the USERNAME environment
	variable.  GetUserName is very slow.

1999-05-07    <stanton@@scriptics.com>

	* win/winDumpExts.c: 
	* win/makefile.vc: Removed incorrect patch. [Bug: 1998]
	
	* generic/tcl.decls: Replaced const with CONST.

	* generic/tclResult.c (Tcl_AppendResultVA): 
	* generic/tclStringObj.c (Tcl_AppendStringsToObjVA): Fixed to copy
	arglist using memcpy instead of assignment so it works properly on
	OS/390. [Bug: 1997]

	* generic/tclLoadNone.c: Updated to use current interfaces, added
	TclpUnloadFile. [Bug: 2003]

	* win/winDumpExts.c: 
	* win/makefile.vc: Changed to emit library name in defs
	file. [Bug: 1998]

	* unix/configure.in: Added fix for OS/390. [Bug: 1976]

1999-05-06    <stanton@@scriptics.com>

	* tests/string.test: 
	* generic/tclCmdMZ.c: 
	* doc/string.n: Fixed bug in string equal/compare code when using
	-length option.  Cleaned up docs a bit more.

	* tests/http.test: Unset "data" array before running tests to
	avoid failures due to previous tests.

	* doc/string.n: 
	* tests/cmdIL.test: 
	* tests/cmdMZ.test: 
	* tests/error.test: 
	* tests/ioCmd.test: 
	* tests/lindex.test: 
	* tests/linsert.test: 
	* tests/lrange.test: 
	* tests/lreplace.test: 
	* tests/string.test: 
	* tests/cmdIL.test: 
	* generic/tclUtil.c: 
	* generic/tclCmdMZ.c: Replaced "string icompare/iequal" with
	-nocase and -length switches to "string compare/equal".  Added a
	-nocase option to "string map".  Changed index syntax to allow
	integer or end?-integer? instead of a full expression.  This is
	much simpler with safeTcl scripts since it avoids double
	substitution issues.

	* doc/Utf.3: 
	* generic/tclStubInit.c: 
	* generic/tclDecls.h: 
	* generic/tclUtf.c:
	* generic/tcl.decls: Added Tcl_UtfNcmp and Tcl_UtfNcasecmp.

1999-05-05    <stanton@@scriptics.com>

	* win/makefile.vc: Added encoding directory to install-libraries
	target.

1999-05-03    <stanton@@scriptics.com>

	* doc/string.n: 
	* tests/cmdMZ.test: 
	* tests/string.test: 
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): Changed "string length"
	to avoid regenerating the string rep of a ByteArray object.
	
	* tests/cmdIL.test: 
	* tests/cmdMZ.test: 
	* tests/error.test: 
	* tests/lindex.test:
	* tests/linsert.test: 
	* tests/lrange.test: 
	* tests/lreplace.test: 
	* tests/string.test: 
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): 
	* generic/tclUtil.c (TclGetIntForIndex): Applied Jeff Hobbs's
	string patch which includes the following changes [Bug: 1845]:
	
	    - string compare now takes optional length arg (for strncmp
		behavior)
                            
            - added string equal (just a few lines of code blended
                in with string compare)
            
            - added string icompare/iequal for case-insensitive comparisons
            
            - string index's index can now be ?end[+-]?expression
                I made this change in the private TclGetIntForIndex,
                which means that the list commands also benefit, as
                well as string range, et al.
            
            - added [string repeat string count]
                Repeats given string  number of times
            
            - added string replace, string equiv to lreplace
              (quasi opposite of string range):
                        string replace first last ?string?
                Example of use, replacing end of string with ...
                should the string be more than 16 chars long:
                        string replace $string 16 end "..."
                This just returns the string len < 16, so it
                will only affect the long strings.
            
            - added optional first and last args to string to*
                This allows you to just affect certain regions of
                a string with the command (like just capping the
                first letter).  I found the original totitle to
                be too draconian to be useful.
            
            - added [string map charMap string]
                where charMap is a {from to from to} list that equates to
                what one might get from [array get].  Each  and 
                can be multiple chars (or none at all).  For Tcl/CGI users,
                this is a MAJOR speed booster.
	
	* generic/tclParse.c (Tcl_ParseCommand): Changed to avoid
	modifying eval'ed strings that are already null terminated.
	[Bug: 1793] 

	* tests/binary.test: 
	* generic/tclBinary.c (DupByteArrayInternalRep): Fixed bug where
	type was not being set in duplicated object. [Bug: 1975, 2047]

1999-04-30    <stanton@@scriptics.com>
	
	* Changed version to 8.1.1.
	
1999-04-30    <stanton@@scriptics.com>

	* Merged changes from 8.1.0 branch:

	* generic/tclParse.c: Fixed memory leak in CommandComplete.

	* generic/tclPlatDecls.h: 
	* generic/tclIntPlatDecls.h: 
	* generic/tclIntDecls.h: 
	* generic/tclDecls.h: 
	* tools/genStubs.tcl: Added 'extern "C" {}' block around the stub
	table pointer declaration so the stub library can be used from
	C++. [Bug: 1934]

	* Lots of documentation and other release engineering fixes.

1999-04-28    <stanton@@scriptics.com>

	* mac/tclMacResource.c: 
	* generic/tclListObj.c: 
	* generic/tclObj.c: 
	* generic/tclStringObj.c: Changed to avoid freeing the string
	representation before freeing the internal rep.  This helps with
	debugging since the string rep will still be valid when the free
	proc is invoked.

1999-04-27    <stanton@@scriptics.com>

	* generic/tclLiteral.c (TclHideLiteral): Fixed so hidden literals
	get duplicated to avoid accidental sharing in the global object
	table. 

1999-04-23    <stanton@@scriptics.com>

	* generic/tclStubInit.c: 
	* tools/genStubs.tcl: Changed to avoid the need for forward
	declarations in stub initializers.

1999-04-23    <stanton@@scriptics.com>

	* library/encoding/koi8-r.enc:
	* tools/encoding/koi8-r.txt: Added support for the koi8-r Cyrillic
	encoding. [Bug: 1771]

1999-04-22    <stanton@@scriptics.com>

	* win/tclWinFCmd.c:
	* win/tclWin32Dll.c: Changed uses of "try" to "__try", since that
	is the actual keyword.  This eliminates the need for some -D flags
	from the makefile.

	* generic/tclPort.h: Added include of tcl.h since it defines
	various Windows macros that are needed before deciding which
	platform porting file to use.

	* generic/tclEvent.c: lint

	* win/tclWinInit.c (TclpInitPlatform): Added call to TclWinInit
	when building a static library since DllMain will not be invoked.
	This could break old code that explicitly called TclWinInit, but
	should be simpler in the long run.

1999-04-22  Scott Stanton  <stanton@@scriptics.com>

	* generic/tclInt.h: 
	* generic/tclInt.decls: 
	* generic/tclCompile.c: Added TclSetByteCodeFromAny that takes a
	hook procedure to invoke after compilation but before the byte
	codes are emitted.  This makes it possible to do postprocessing on
	the compiled byte codes before the ByteCode is generated.

	* generic/tclLiteral.c: Added TclHideLiteral and TclAddLiteralObj
	to make it possible to create local unshared literal objects.
	
	* win/tclWinInit.c:
	* unix/tclUnixInit.c: Changed initial search path to match that
	found used by tcl_findLibrary.

1999-04-22    <redman@@scriptics.com>

	* win/tclWinPort.h:
	* win/tclWinSock.c: Added code to use WinSock 2.0 API on NT to
	avoid creating a window to handle sockets.  API not available on
	Win95 and needs to be fixed on Win98, until then continue to use
	the older (window-based) scheme on those two OSes.
	
1999-04-15    <stanton@@scriptics.com>

	* Merged 8.1 back into the main trunk

1999-04-13    <stanton@@scriptics.com>

	* library/encoding/gb2312.enc:
	* library/encoding/euc-cn.enc:
	* tools/encoding/gb2312.txt:
	* tools/encoding/cp950.txt:
	* tools/encoding/Makefile: Restored the double byte definition of
	GB2312 and added the EUC-CN encoding.  EUC-CN is a variant of
	GB2312 that shifts the characters into bytes with the high bit set
	and includes ASCII as a subset. [Bug: 632]

1999-04-13    <redman@@scriptics.com>

	* win/tclWinSock.c: Apply patch to allow write access to a socket
	if FD_WRITE is sent but FD_CONNECT is not.  Some strange problem
	with either Win32 or a socket driver.  [Bug: 1664 1776]

1999-04-09    <redman@@scriptics.com>

	* unix/tclUnixNotfy.c: Fixed notifier deadlock situation when the
	pipe used to talk back notifier thread is filled with data.  When
	calling the write() function to feed data down that pipe, unlock
	the notifierMutex to allow the notifier to wake up again.  Found
	as a result of the focus.test for Tk hanging. [Bug: 1700]

1999-04-06    <stanton@@scriptics.com>

	* tests/unixNotfy.test: Fixed hang in tests when built with thread
	support. 

	* tests/httpold.test: Fixed broken test that didn't wait long
	enough for events to arrive.

	* tests/unixInit.test: Fixed race condition in test.
	
	* tests/unixInit.test: 
	* tests/fileName.test: Minor test nits.

	* unix/tclUnixInit.c (TclpSetInitialEncodings): Fixed bad initial
	encoding string.

1999-04-06    <surles@@scriptics.com>

	* generic/tclVar.c: 
	* generic/tclEnv.c: Moved the "array set" C level code into a
	common routine (TclArraySet).  The TclSetupEnv routine now uses
	this API to create an env array w/ no elements.

	* generic/tclEnv.c:
	* generic/tclWinInit.h:
	* generic/tclUnixInit.h:
	* generic/tclInt.h: Made the Env module I18N compliant.  Changed the
	FindVariable routine to TclpFindVariable, that now does a case
	insensitive string comparison on Windows, and not on UNIX. [Bug:
	1299, 1500]

1999-04-05    <stanton@@scriptics.com>

	* tests/io.test: Minor test cleanup.

	* generic/tclEncoding.c (Tcl_CreateEncoding): Minor lint to make
	it easier to compile on Digital-unix. [Bug: 1659]

	* unix/configure.in: 
	* unix/tclUnixPort.h: Applied patch for OS/390 to handle lack of
	sys/param.h. [Bug: 1725]

	* unix/configure.in: Fixed BSD/OS 4.* configuration to support
	shared libraries properly. [Bug: 1730]
	
1999-04-05    <redman@@scriptics.com>

	* win/tclWinDde.c: decrease timeout value for DDE calls to 30k
	[Bug: 1639]

	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclDecls.h:
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclUtil.c: Added more functions to the Tcl stubs table,
	including all Tcl_ functions not already in it (except Cmd
	functions) and Tcl_GetCwd() and Tcl_Chdir() (new functions).
	
	* tests/safe.test:
	* doc/safe.n:
	* generic/tclBasic.c:
	* library/safe.tcl: The encoding command is not safe as-is, so
	create a safe alias to mask out the "encoding system <name>" but
	allow all other uses including "encoding system". Added test cases
	and updated the man page for Safe Tcl.

1999-04-05    <stanton@@scriptics.com>

	* tests/winTime.test: 
	* win/tclWinTime.c: Fixed crash in clock command that occurred
	when manipulating negative time values in timezones east of
	GMT. [Bug: 1142, 1458]
	
	* tests/platform.test: 
	* tests/fileName.test: Fixed broken tests.
	
	* generic/tclFileName.c: Moved global regexps into thread local
	storage.

	* tests/socket.test: Changed so tests don't reuse sockets,
	since Windows is slow to release sockets.

	* win/tclWinConsole.c: 
	* win/tclWinPipe.c: 
	* win/tclWinSerial.c: Fixed race condition where background
	threads were terminated while they still held a lock in the
	notifier. 

1999-04-02    <stanton@@scriptics.com>

	* tests/http.test: Fixed bad test initialization code.

	* generic/tclThreadTest.c (ThreadExitProc): Fixed bug where static
	memory was being returned instead of a dynamically allocated
	result in error cases.

1999-04-02    <redman@@scriptics.com>

	* doc/dde.n:
	* tools/tcl.wse.in:
	* win/makefile.vc:
	* win/pkgIndex.tcl:
	* win/tclWinDde.c:  Add new DDE package, code removed from Tk now
	separated into its own package.  Changed DDE-based send code into
	"dde eval" command.  Can be loaded into tclsh (not just wish).
	Windows only.

1999-04-02    <stanton@@scriptics.com>

	* tests/expr.test: 
	* tests/for-old.test: 
	* tests/for.test: 
	* tests/foreach.test: 
	* tests/format.test: 
	* tests/httpold.test: 
	* tests/if.test: 
	* tests/init.test: 
	* tests/interp.test: 
	* tests/while.test:  Added some tests for known bugs (marked with
	knownBug constraint), and cleaned up a few bad tests.

	* generic/regc_locale.c: 
	* generic/regcustom.h: 
	* generic/tcl.decls: 
	* generic/tclCmdIL.c: 
	* generic/tclCmdMZ.c: 
	* generic/tclInt.h: 
	* generic/tclRegexp.c: 
	* generic/tclScan.c: 
	* generic/tclTest.c:
	* generic/tclUtf.c: 
	* win/tclWinFCmd.c: 
	* win/tclWinFile.c: Made various Unicode utility functions
	public. The following functions were made public and added to the
	stubs table: 
		Tcl_UtfToUniCharDString, Tcl_UniCharToUtfDString,
		Tcl_UniCharLen, Tcl_UniCharNcmp, Tcl_UniCharIsAlnum,
		Tcl_UniCharIsAlpha, Tcl_UniCharIsDigit, Tcl_UniCharIsLower,
		Tcl_UniCharIsSpace, Tcl_UniCharIsUpper, Tcl_UniCharIsWordChar

1999-04-01    <stanton@@scriptics.com>

	* tests/registry.test: 
	* win/tclWinReg.c: Internationalized the registry code.  It now
	uses Unicode interfaces on NT. [Bug: 1197]

	* tests/parse.test: 
	* generic/tclParse.c: Fixed crash due to multiple frees in parser
	during error cleanup when parsing commands with more tokens than
	will fit in the static area of the parse structure. [Bug: 1681]

	* generic/tclInt.h: Removed duplicate declarations.

	* generic/tclInt.decls: 
	* generic/tcl.decls: Added Tcl_WinUtfToTChar and Tcl_WinTCharToUtf
	to the tclPlat table.

1999-04-01    <redman@@scriptics.com>

	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclBasic.c:
	* generic/tclDecls.h:
	* generic/StubInit.c:
	* tools/genStubs.tcl:
	* unix/Makefile.in:
	* win/makefile.vc: Applied patch from Jan Nijtmans to fix Ultrix
	multiple symbol definition problem.  Now, even Tcl includes a copy
	of the Tcl stub library.  Also fixed TCL_MEM_DEBUG mode (for Tk).

1999-03-31    <redman@@scriptics.com>

	* win/tclWinConsole.c: WinNT has a bug when reading a single
	character from the console.  Rewrote the code for the console to
	read an entire line at a time using the reader thread.

1999-03-30    <stanton@@scriptics.com>

	* unix/Makefile.in: Removed trailing backslash that broke the
	"depend" target.

	* unix/tclUnixInit.c (TclpSetInitialEncodings): Changed to avoid
	calling setlocale().  We now look directly at env(LANG) and
	env(LC_CTYPE) instead. [Bug: 1636]

	* generic/tclFileName.c: 
	* generic/tclDecls.h: 
	* generic/tcl.decls: Removed CONST from Tcl_JoinPath and
	Tcl_TranslateFileName because it changes the signature of
	Tcl_JoinPath in an incompatible manner.

	* generic/tclInt.h: 
	* generic/tclLoad.c (TclFinalizeLoad): 
	* generic/tclEvent.c (Tcl_Finalize): Defer unloading of loadable
	modules until all exit handlers have been invoked.
	[Bug: 998, 1273, 1573, 1593]
d1692 1
a1692 1
1999-03-29    <stanton@@scriptics.com>
d1694 2
a1695 4
	* generic/tclFileName.c: 
	* generic/tclDecls.h: 
	* generic/tcl.decls: Added CONST to Tcl_JoinPath and
	Tcl_TranslateFileName.
d1697 1
a1697 1
1999-03-29    <redman@@scriptics.com>
d1699 40
a1738 66
	* tools/genStubs.tcl:
	* unix/configure.in:
	* unix/Makefile.in:
	* win/makefile.vc:
	* generic/tcl.h:
	* generic/tclBasic.c:
	* generic/tclDecls.h:
	* generic/tclIntDecls.h:
	* generic/tclPlatDecls.h:
	* generic/tclIntPlatDecls.h: Removed the stub functions and
	changed the stub macros to just use the name without params. Pass
	&tclStubs into the interp (don't use tclStubsPtr because of
	collisions with the stubs on Solaris).
	
1999-03-27    <redman@@scriptics.com>

	* win/makefile.bc: Removed makefile for Borland compiler, no
	longer supported.

1999-03-26    <redman@@scriptics.com>

	* win/tclWinSerial.c:
	* win/tclWinConsole.c:
	* win/tclWinPipe.c: Don't close the Win32 handle for a channel if
	it's a stdio handle (GetStdHandle()) during shutdown of a thread
	to prevent it from destroying the stdio of other threads.

1999-03-26    <suresh@@scriptics.com>

	* unix/configure.in
	--nameble-shared is now the default and build Tcl as a shared
	library; specify --disable-shared to build a static Tcl library
	and shell.

1999-03-25    <stanton@@scriptics.com>

	* tests/interp.test: 
	* generic/tclInterp.c (AliasObjCmd): Changed so aliases are
	invoked at current scope in the target interpreter instead of at
	the global scope.  This was an incompatibility introduced in 8.1
	that is being removed. [Bug: 1153, 1556]
	
	* library/encoding/big5.enc:
	* library/encoding/gb2312.enc:
	* tools/encoding/big5.enc:
	* tools/encoding/gb2312.enc: Added ASCII to big5 and gb2312
	encodings. [Bug: 632]
	
	* generic/tclPkg.c (Tcl_PkgRequireEx): Fixed broken clientData
	initialization in package code.

	* unix/Makefile.in (dist): Added tcl.decls and tclInt.decls to
	source distribution. [Bug: 1571]

	* doc/Thread.3: Updated documentation of Tcl_MutexLock to indicate
	that the recursive locking behavior is undefined.  On Windows, it
	does not block, on Unix it deadlocks. [Bug: 1275]

1999-03-24    <stanton@@scriptics.com>

	* tests/execute.test: 
	* generic/tclExecute.c (TclExecuteByteCode): Fixed expression code
	that incorrectly returned floating point values for integers if
	the internal rep happened to be a double.  Now we check to see if
	the object has a string rep that looks like an integer before
	using the double internal rep. [Bug: 1516]
d1740 1
a1740 1
1999-03-24    <redman@@scriptics.com>
d1742 3
a1744 39
	* generic/tclAlloc.c:
	* generic/tclEncoding.c:
	* generic/tclProc.c:
	* unix/tclUnixTime.c:
	* win/tclWinSerial.c: Fixed compilation warnings/errors for VC++
	5.0 and 6.0 and HP-UX native compiler without -Aa or -Ae. 
	[Bug: 1323 1518 1324 1583 1585 1586]

	* win/tclWinSock.c: Make sockets thread-safe on Windows. The
	current implementation uses windows to handle events on the
	socket, one for each thread (thread local storage). Previously,
	there was only one window shared between threads, which didn't
	work. [Bug: 1326]

1999-03-23    <stanton@@scriptics.com>

	* tools/tcl.wse: Fixed file association to look in the right place
	for the wish icon. [Bug: 1544]

	* tests/winNotify.test: 
	* tests/ioCmd.test: 
	* tests/event.test: Changed to use new style conditionals.

	* tests/encoding.test: Fixed nonportable test.

	* unix/dltest/configure.in: 
	* unix/dltest/Makefile.in: Added missing DBGX macros. [Bug: 1564]

	* tests/winNotify.test: 
	* mac/tclMacNotify.c: 
	* win/tclWinNotify.c: 
	* unix/tclUnixNotfy.c:
	* generic/tclNotify.c: Added a new Tcl_ServiceModeHook interface
	that is invoked whenever the service mode changes.  This is needed
	to allow the Windows notifier to create a communication window the
	first time Tcl is about to enter an external modal event loop
	instead of at startup time.  This will avoid the various problems
	that people have been seeing where the system hangs when tclsh
	is running outside of the event loop. [Bug: 783]
d1746 1
a1746 4
	* generic/tclInt.h: 
	* generic/tcl.decls: Renamed TclpAlertNotifier back to
	Tcl_AlertNotifier since it is part of the public notifier driver
	API.
d1748 3
a1750 1
1999-03-23    <redman@@scriptics.com>
d1752 1
a1752 3
	* win/tclWinSerial.c: Fixed problem with fileevent on the serial
	port and nonblocking mode.  Gets no longer hangs, fileevents fire
	whenever there is any character data on the port.
d1754 4
a1757 8
	* tests/winConsole.test:
	* win/tclWinConsole.c: Fixed problem with fileevents and gets from
	a console stdin.  Previously, fileevents were firing before an
	entire line was available for reading, which meant that when you
	did a gets or read, it blocked (even in nonblocking mode). Now, it
	should work the same as Unix: fileevents fire when an entire line
	is ready, and gets and read do not block in non-blocking mode.
	Added an interactive test case to check for this.
d1759 2
a1760 1
1999-03-22    <stanton@@scriptics.com>
d1762 1
a1762 2
	* tests/reg.test: 
	* generic/regc_color.c: Applied regexp bug fix from Henry Spencer.
d1764 15
a1778 1
1999-03-19    <redman@@scriptics.com>
d1780 1
a1780 2
	* generic/tclCmdIL.c: Fixed the initialization of an array so that
 	the Sun 5.0 C compiler wouldn't complain.
d1782 3
a1784 5
	* unix/configure.in: Added support for --enable-64bit.  For now,
 	this is only supported on Solaris 7 64bit (SunOS 5.7) using the Sun 
	compiler (not gcc).
	
1999-03-18    <stanton@@scriptics.com>
d1786 1
a1786 5
	* win/tclWinChan.c (TclpOpenFileChannel, Tcl_MakeFileChannel):
	Changed to only test for console or comm handles when the type is
	FILE_TYPE_CHAR to avoid useless tests on simple files.  Also
	reordered tests so consoles are tested first as this is more
	common.
d1788 2
a1789 1
	* win/makefile.vc: Regularized usage of mkd and rmd and rm.
d1791 2
a1792 3
	* library/encoding/shiftjis.enc: 
	* tools/encoding/shiftjis.txt: Missing/incorrect characters in
	shift-jis table. [Bug: 1008, 1526]
d1794 1
a1794 3
	* generic/tclInt.decls:
	* generic/tcl.decls: Eliminated use of "string" and "list" from
	argument lists to avoid conflicts with C++ STL. [Bug: 1181]
d1796 3
a1798 11
	* win/tclWinFile.c (TclpMatchFiles): Changed to ignore the
	FS_CASE_IS_PRESERVED bit and always return exactly what we get
	from the system.

1999-03-17    <stanton@@GASPODE>

	* win/README.binary: 
	* win/README: 
	* unix/configure.in: 
	* generic/tcl.h: 
	* README: Updated version to 8.1b3.
d1800 1
a1800 1
1999-03-14    <stanton@@GASPODE>
d1802 2
a1803 18
	* win/tclWinConsole.c: 
	* win/tclWinPipe.c: 
	* win/tclWinSerial.c: Changed so channel drivers wait for the
	reader/writer threads to exit before returning during a close
	operation.  This ensures that the main thread is the last thread
	to exit, so the process return value is set properly.

	* generic/tclIntDecls.h: 
	* generic/tclIntPlatDecls.h: 
	* generic/tclIntPlatStubs.c: 
	* generic/tclIntStubs.c: 
	* generic/tclPlatDecls.h: 
	* generic/tclPlatStubs.c: 
	* generic/tclStubInit.c: 
	* generic/tclStubs.c: Fixed bad eol characters.
	
	* generic/tclInt.decls: Changed "const" to "CONST" in
	declarations for better portability.
d1805 1
a1805 2
	* generic/tcl.decls: Renamed panic and panicVA to Tcl_Panic and
	Tcl_PanicVA in the stub files.
d1807 12
a1818 2
	* generic/tclInterp.c (Tcl_MakeSafe): Remove tcl_platform(user)
	from safe interps.
d1820 3
a1822 1
1999-03-11    <stanton@@GASPODE>
d1824 1
a1824 18
	* unix/Makefile.in:
	* unix/configure.in: Include compat files in the stub library in
	addition to the main library.  Compat files are now built for
	dynamic use in all cases.
	
	* generic/tcl.h: Changed magic number so it doesn't match the plus
	patch, at Jan's request.
	
	* unix/tclConfig.sh.in:
	* unix/dltest/Makefile.in:
	* unix/dltest/configure.in:
	* unix/dltest/pkga.c:
	* unix/dltest/pkgb.c:
	* unix/dltest/pkgc.c:
	* unix/dltest/pkgd.c:
	* unix/dltest/pkge.c:
	* unix/dltest/pkgf.c: Changed package tests to build against the
	stubs library.
d1826 2
a1827 1
1999-03-10    <stanton@@GASPODE>
d1829 1
a1829 4
	* generic/tcl.h: 
	* generic/tcl.decls: Changed Tcl_ReleaseType from an enum to
	macros so it can be used in .rc files.
	Added Tcl_GetString.
d1831 2
a1832 5
	* mac/tclMacNotify.c:
	* generic/tclNotify.c:
	* generic/tclInt.h: 
	* win/tclWinNotify.c: 
	* generic/tcl.h: Renamed Tcl_AlertNotifier to TclpAlertNotifier.
d1834 2
a1835 3
	* generic/tclInt.decls: Added TclWinAddProcess to make it possible
	for expect to use Tcl_WaitForPid().  This patch is from Gordon
	Chaffee. 
d1837 3
a1839 6
	* mac/tclMacPort.h: 
	* win/tclWinInit.c: 
	* unix/tclUnixPort.h: 
	* generic/tclAsync.c: Added TclpAsyncMark to fix bug in async
	handling on Windows where async events don't wake up the event
	loop.  This patch comes from Gordon Chaffee.
d1841 1
a1841 3
	* generic/tcl.decls: Fixed declarations of reserved slots.
	
1999-03-10    <redman@@scriptic.com>
d1843 13
a1855 2
	* generic/tclCompile.h: Ensure that the ByteCode struct is binary
	compatible with the version in 8.0.6.
d1857 1
a1857 5
	* generic/tcl.h:
	* generic/tclBasic.c: Add Tcl_GetVersion() function to the public
	C API to allow programs to check the version number of the Tcl
	library at runtime.  Also added an enum to clarify the release
	level (alpha, beta, final).
d1859 4
a1862 1
1999-03-09    <stanton@@GASPODE>
d1864 1
a1864 6
	* Integrated changes from Tcl 8.0 including:
		stubs mechanism
		configure patches from Jan Nijtmans
		rename of panic to Tcl_Panic
	
1999-03-08    <lfb@@scriptics.com>
d1866 3
a1868 2
	* win/tclWin32Dll.c: Removed Dll instance from thread-local
	storage.
d1870 1
a1870 4
1999-03-08    <stanton@@GASPODE>
	
	* generic/tcl.h: Moved Tcl_Mutex, etc. macros above the inclusion
	of tclDecls.h to avoid macro conflicts.
d1872 2
a1873 17
	* generic/tclInt.h:
	* generic/regc_color.c: 
	* generic/regcomp.c:
	* generic/tclCmdIL.c:
	* generic/tclCmdAH.c:
	* generic/tclIOCmd.c:
	* generic/tclParse.c:
	* generic/tclStringObj.c:
	* unix/tclUnixNotfy.c: Cleaned up various compiler warnings,
	eliminated UCHAR bugs.
	
	* unix/tclUnixNotfy.c:
	* unix/tclUnixThrd.c:
	* generic/tclThreadTest.c:
	* mac/tclMacThrd.c: Changed TclpCondition*() to Tcl_Condition*().
	
	* INTEGRATED PATCHES FROM 8.0.6:
d1875 2
a1876 26
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclBasic.c: 
	* generic/tclDecls.h:
	* generic/tclInt.decls:
	* generic/tclInt.h: 
	* generic/tclIntDecls.h:
	* generic/tclIntPlatDecls.h:
	* generic/tclIntPlatStubs.c:
	* generic/tclIntStubs.c:
	* generic/tclPlatDecls.h:
	* generic/tclPlatStubs.c:
	* generic/tclStubInit.c:
	* generic/tclStubLib.c:
	* generic/tclStubs.c:
	* tools/genStubs.tcl:
	* unix/configure.in:
	* unix/Makefile.in:
	* unix/tclConfig.sh.in:
	* win/makefile.vc:  
	* win/tclWinPort.h: Added Tcl stubs implementation.  There are
	now two new macros USE_TCL_STUBS and USE_TCL_STUB_PROCS that
	enable use of stubs and disable stub macros respectively.  All of
	the public and private function declarations from tcl.h and
	tclInt.h have moved into the *.decls files and the *Stubs.c and
	*Decls.h files are generated using the genStubs.tcl script.
d1878 10
a1887 3
	* unix/Makefile.in:
	* unix/configure.in: 
	* unix/ldAix: Enhanced AIX shared library support.
d1889 1
a1889 2
	* win/tclWinSock.c: Removed a bunch of extraneous PASCAL FAR
	attributes from internal functions.
d1891 2
a1892 2
	* win/tclWinReg.c: Changed registry package to use stubs mechanism
	so it no longer depends on the specific version of Tcl.
d1894 1
a1894 12
	* doc/AddErrInfo.3: 
	* doc/Eval.3: 
	* doc/PkgRequire.3: 
	* doc/SetResult.3: 
	* doc/StringObj.3: 
	* generic/tcl.h:
	* generic/tclBasic.c: 
	* generic/tclPanic.c:
	* generic/tclStringObj.c:
	* generic/tclUtil.c:
	* unix/mkLinks: Added va_list versions of all VARARGS
	functions so they can be invoked from the stub functions.
d1896 5
a1900 5
	* doc/package.n: 
	* doc/PkgRequire.3: 
	* generic/tclPkg.c: Added Tcl_PkgProvideEx, Tcl_RequireEx,
	Tcl_PresentEx, and Tcl_PkgPresent.  Added "package present"
	command.
d1902 4
a1905 7
	* generic/tclFileName.c: 
	* mac/tclMacFile.c: 
	* mac/tclMacShLib.exp: 
	* unix/tclUnixFile.c: 
	* win/tclWinFile.c: Changed so TclGetUserHome is defined on
	all platforms, even though it is currently a noop on mac and
	windows, and renamed it to TclpGetUserHome.
d1907 1
a1907 4
	* generic/tclPanic.c:
	* generic/panic.c: Renamed panic to Tcl_Panic.
	
1999-02-25    <redman@@scriptics.com>
d1909 8
a1916 7
	* win/makefile.vc: Added tclWinConsole.c and tclWinSerial.c
	
	* win/tclWinConsole.c: New code to properly deal with fileevents
	and nonblocking mode on consoles.
	
	* win/tclWinSerial.c: New code to properly deal with fileevents
	and nonblocking mode on serial ports.
d1918 1
a1918 3
	* win/tclWinPipe.c: 
	* win/tclWinPort.h: Exported functions to allow creation of pipe
	channels from tclWinChan.c
d1920 3
a1922 3
	* win/tclWinChan.c: Check the type of a channel, including for the
	standard (stdin/stdout/stderr), and use the correct channel type
	to create the channel (file, serial, console, or pipe).
d1924 1
a1924 1
1999-02-11    <stanton@@GASPODE>
d1926 4
a1929 12
	* README: 
	* generic/tcl.h: 
	* win/README.binary: 
	* win/README: 
	* unix/configure.in: 
	* mac/README: Updated version numbers to 8.1b2.

1999-02-10    <stanton@@GASPODE>

	* library/auto.tcl: Fixed auto_mkindex so it handles .tbc files.
	Did some general cleanup to handle bad eval statements that didn't
	use "list".
d1931 1
a1931 7
	* unix/mkLinks:
	* doc/SetVar.3:
	* generic/tcl.h:
	* generic/tclVar.c: Restored Tcl_ObjGetVar2 and Tcl_ObjSetVar2
	from 8.0. Renamed Tcl_Get/SetObjVar2 to Tcl_GetVar2Ex and
	Tcl_SetVar2Ex.
>>>>>>> 1.1.1.5
d1933 2
a1934 1
1999-02-10    <stanton@@GASPODE>
d1936 1
a1936 1
	INTEGRATED PATCHES FROM 8.0.5b2: 
d1938 2
a1939 21
	* test/winPipe.test: Changed to remove echoArgs.tcl temporary file
	when done.
	
	* tests/cmdAH.test:
	* generic/tclFileName.c (TclGetExtension): Changed behavior so the
	split happens at the last period in the name instead of the first
	period of the last run of periods.  So, "foo..o" is split into
	"foo." and ".o" now. [Bug: 1126]
	
	* win/makefile.vc: Added better support for paths with spaces in
	the name. Added .lib and support .dlls to the install-binaries
	target.  Added generate of a pkgIndex.tcl script to the
	install-libraries target.

	* win/tclAppInit.c: 
	* unix/tclAppInit.c: 
	* mac/tclMacAppInit.c: 
	* generic/tclTest.c: Changed some EXTERN declarations to extern
	since they are not defining exported interfaces.  This avoids
	generating useless declspec() attributes and makes the windows
	makefile simpler.
d1941 1
a1941 2
	* generic/tcl.h: Moved Tcl_AppInit declaration to end and cleared
	out TCL_STORAGE_CLASS so it is not declared with a declspec().
d1943 4
a1946 10
	* tests/interp.test:
	* generic/tclInterp.c (DeleteAlias): Changed to use
	Tcl_DeleteCommandFromToken so we handle renames properly. This
	avoids senseless panic. [Bug: 736]

	* unix/tclUnixChan.c: 
	* win/tclWinSock.c: 
	* doc/socket.n: Applied Gordon Chaffee's patch to handle failures
	during asynchronous socket connection operations.  This adds a new
	"-error" fconfgure option to socket channels. [Bug: 893]
d1948 1
a1948 60
	* generic/tclProc.c:
	* generic/tclNamesp.c:
	* generic/tclInt.h: 
	* generic/tclCmdIL.c: 
	* generic/tclBasic.c: 
	* generic/tclVar.c: Applied patch from Viktor Dukhovni to
	rationalize TCL_LEAVE_ERR_MSG behavior when creating variables.
	
	* generic/tclVar.c: Fixed bug in namespace tail computation.
	Fixed bug where upvar could resurrect a namespace variable whose
	namespace had been deleted.

	* generic/tclCompile.c (TclCompileExprCmd): Eliminated yet another
	bogus optimization in expression compilation.

	* unix/configure.in: Added branch for BSD/OS-4* to shared library
	case statement. [Bug: 975]
	Fixed to correctly handle IRIX 6.5 n32 library support. [Bug: 1117]
	
	* win/winDumpExts.c: Patched to be pickier about stripping
	@@'s. [Bug: 920]

	* library/http2.0/http.tcl: Added catch around eof test in
	CopyDone since the user may have already called http::reset.
	[Bug: 1108] 

	* unix/configure.in: Changed Linux and IRIX to set SHLIB_LIBS to
	LIBS so shared libraries are linked with the system
	libraries. [Bug: 1018]

	* generic/tclCompile.c (CompileExprWord): Fixed exception stack
	overflow bug caused by missing statement. [Bug: 928]

	* generic/tclIOCmd.c: 
	* generic/tclBasic.c: Objectified the "open" command. [Bug: 1113] 

	* generic/tclPosixStr.c (Tcl_ErrnoId, Tcl_ErrnoMsg): When using
	egcs, ENOTSUP and EOPNOTSUPP are the same, so now we handle that
	case. [Bug: 1137]

	* library/init.tcl: Various small changes requested by Jan Nijtmans.
	- If the variable $tcl_library contains the empty string, this
	empty string will be put in $auto_path. This is not useful at all,
	it only slows down later package processing.
	- If the variable tcl_pkgPath is not set, the "unset __dir"
	fails. Thich makes init.tcl totally unusable. Better put a "catch"
	around it. 
	- In the function tcl_findLibraries, the "string match" function
	only works correctly if $tcl_patchLevel is in one of the forms
	"?.?a?", "?.?b?" or "?.?.?". Could a "regexp" be used instead,
	then it allows anything to be appended to the patchLevel
	string. And it is more efficient.
	- The tclPkgSetup function assumes that if $type != "load" then
	the type must be "source". This needn't be true. Some users want
	to add their own setup types.
	[RFE: 1138] [Bug: 978]

	* win/tclWinReg.c: 
	* doc/registry.n: Added support for HKEY_PERFORMANCE_DATA and
	HKEY_DYN_DATA keys. [Bug: 1109]
d1950 7
a1956 2
	* win/tclWinInit.c (TclPlatformInit): Added code to ensure
	tcl_pkgPath is set to "" when no registry entry is found. [Bug: 978]
d1958 6
a1963 1
1999-02-01    <stanton@@GASPODE>
d1965 4
a1968 1
	* generic/tclBasic.c:
a1969 5
	* generic/tclCmdIL.c:
	* generic/tclCmdMZ.c:
	* generic/tclExecute.c:
	* generic/tclHistory.c:
	* generic/tclIO.c:
d1971 26
a1996 11
	* generic/tclInterp.c:
	* generic/tclMain.c:
	* generic/tclNamesp.c:
	* generic/tclParse.c:
	* generic/tclProc.c:
	* generic/tclTest.c:
	* generic/tclTimer.c:
	* generic/tcl.h: Made eval interfaces compatible with 8.0 by
	renaming Tcl_EvalObj to Tcl_EvalObjEx, renaming Tcl_Eval2 to
	Tcl_EvalEx and restoring Tcl_EvalObj and Tcl_GlobalEvalObj
	interfaces so they match Tcl 8.0.
d1998 1
a1998 1
1999-01-28    <stanton@@GASPODE>
d2000 7
a2006 1
	* Merged Tcl 8.0.5b1 changes.
d2008 11
a2018 3
	* generic/tclUtil.c (Tcl_DStringSetLength): Changed so the buffer
	overallocates in a manner similar to Tcl_DStringAppend.  This
	should improve performance for TclUniCharToUtfDString.
d2020 21
a2040 1
1998-12-11    === Tcl 8.1b1 Release ===
d2042 6
a2047 1
1998-12-10    <stanton@@GASPODE>
d2049 1
a2049 1
2000-03-21  Syd Polk  <spolk@@cygnus.com>
d2051 2
a2052 2
	* configure.in: Check for cygwin, not cygwin32.
	* configure: Regenerate.
d2054 1
a2054 2
	* generic/tclInitScript.h: Added newline at end of file to make
	current gcc happy.
d2056 6
a2061 1
1999-12-06  Mo DeJong <mdejong@@cygnus.com>
d2063 1
a2063 1
	* win/Makefile.in: added cl flags needed for VC++ 6.0
d2065 2
a2066 1
1999-06-21  Syd Polk  <spolk@@cygnus.com>
d2068 1
a2068 2
	* generic/tclIO.c: Bug fixes from Scriptics to get exit status
	correct on pipe channels.
d2070 4
a2073 1
1999-04-22  Syd Polk  <spolk@@cygnus.com>
d2075 7
a2081 1
	* unix/Makefile.in: Don't install tcl.h for install-libaries.
d2083 1
a2083 7
1999-02-16  Syd Polk  <spolk@@cygnus.com>
    
	* win/configure.in: TCL_SRC_DIR needs to have forward slashes
	for the MS build.
	* win/configure: Regenerate.
	* win/tclWinInit.c: Stupid Visual C++ compiler has limit on
	number of characters in string constant.
d2085 3
a2087 1
1999-02-11  Syd Polk  <spolk@@cygnus.com>
d2089 1
a2089 3
	* generic/tclInitScript.h: The tclInit proc that Jim Ingham wrote
	blew MS's string buffer away, so I hacked the original in for the
	Microsoft build, which only SN is using anyway. Yuck.
d2091 2
a2092 1
1999-02-08  Syd Polk  <spolk@@cygnus.com>
d2094 2
a2095 9
<<<<<<< ChangeLog
	* unix/configure.in unix/tclConfig.sh.in: Export TCL_LIB_FULL_PATH
	for dependencies.
=======
	* unix/configure.in: Fixed problem with test in --enable-symbols.
>>>>>>> 1.1.1.5
	* unix/configure: Regenerated.
	* library/auto.tcl: Fixed a problem with the regsub inside of
	auto_mkindex since the regsub semantics changed.
d2097 46
a2142 1
1999-02-04  James Ingham  <jingham@@cygnus.com>	
d2144 1
a2144 6
	* generic/tclInitScript.h: Change the tclInit proc to find the Tcl 
	library in both build & install trees.
	* library/auto.tcl (tcl_findLibrary): Change tcl_findLibrary to
	search around the executible for the tclConfig.sh, and then use
	this to find the source tree.  This works in many more cases than
	the Scriptics version.
d2146 1
a2146 2
	* configure.in: If no value is given for --enable-symbols, use the 
	value from AC_PROG_CC, this adds -g for gcc.
d2148 1
a2148 10
<<<<<<< ChangeLog
	* library/init.tcl (auto_mkindex_parser::mkindex): Clean out the parser
	interpreter completely between each file, rather than
	trying to remove imports by hand.  The latter method loses with
	IncrTcl, since that imports the class command by hand, and if you
	ever do "namespace import itcl::*" in your code, this will get
	undone.
=======
1999-01-19  Ben Elliston  <bje@@cygnus.com>
>>>>>>> 1.1.1.5
d2150 8
a2157 2
	* tools/encoding/shiftjis.txt: Map tilde in ShiftJIS to tilde in
	Unicode.
d2159 1
a2159 1
	* library/encoding/shiftjis.enc: Regenerate.
d2161 2
a2162 1
1998-12-21  Syd Polk  <spolk@@cygnus.com>
d2164 1
a2164 2
	* generic/tclCompExpr.c: Remove another instance of string
	blasting.
d2166 4
a2169 3
	* generic/tclLiteral.c (TclDeleteLiteralTable): Make code 
	that detects infinite loops exit gracefully in production
	build and panic in development build.
d2171 2
a2172 1
1998-12-21  Khamis Abuelkomboz  <khamis@@cygnus.com>
d2174 1
a2174 2
	* generic/tclLiteral.c (TclDeleteLiteralTable): added a daemon to catch
	a hanging bug by deleteing a literal.
d2176 2
a2177 1
1998-12-19  Syd Polk  <spolk@@cygnus.com>
d2179 3
a2181 3
        * generic/tclCompile.c (tclCompileScript): Localize modifying 
	the compiled string to the call which needs it. This prevents 
	the string getting hashed incorrectly later.
d2183 67
a2249 1
	* generic/tclAlloc.c: Latest patch from Scriptics.
d2251 1
a2251 1
1998-12-16  Syd Polk  <spolk@@cygnus.com>
d2253 21
a2273 3
	* tools/encoding/shiftjis.txt: Unicode character 0xFF5E
	was missing from the shiftjis table.
	* library/encoding/shiftjis.enc: Regnerated.
d2275 2
a2276 1
1998-12-16  Ben Elliston  <bje@@sanguine.cygnus.com>
d2278 2
a2279 2
	* generic/tclBasic.c (builtInCmds): Add `encoding'. Patch from
	Scriptics.
d2281 1
a2281 2
	* generic/tclCmdAH.c (Tcl_EncodingObjCmd): New function. Patch
	from Scriptics.
d2283 1
a2283 2
	* generic/tclEncoding.c: Changed at the same time as the rest of
	these files, so it might be important. Patch from Scriptics.
d2285 2
a2286 1
	* doc/encoding.n: New file. From Scriptics.
d2288 67
a2354 1
1998-12-03  Syd Polk  <spolk@@cygnus.com>
d2356 1
a2356 2
	* generic/tclIO.c: Integrated more complete fix to
	channel problem from Scott Stanton at Scriptics.
d2358 7
a2364 1
1998-12-02  Syd Polk  <spolk@@cygnus.com>
d2366 1
a2366 2
	* generic/tclIO.c: Fixed problem when writing out to a
	channel set to -crlf translations.
d2368 3
a2370 1
1998-12-02  Ian Roxborough  <irox@@cygnus.com>
d2372 1
a2372 2
	* win/tclWinChan.c: Merged in WishCon0.1 Changes to
	support pipe IO at console level of a WishShell.
d2374 3
a2376 1
1998-11-24  Syd Polk  <spolk@@cygnus.com>
d2378 1
a2378 4
	* win/Makefile.in: Under MSVC, use the Tcl dumpexts method
	to generate exports.
	* win/tclWinPort.h tclWinSock.c: Do not #define PASCAL away. 
	It is needed in calls to DLLs.
d2380 3
a2382 1
1998-11-18  Syd Polk  <spolk@@cygnus.com>
d2384 1
a2384 3
	* generic/tclAlloc.c: Made sure that blocks are allocated on
	eight-byte boundaries.
	* unix/tclUnixPort.h: Added a CYGNUS LOCAL comment.
d2386 4
a2389 1
1998-11-09  Ben Elliston  <bje@@cygnus.com>
d2391 1
a2391 3
	* generic/tclVar.c (TclGetIndexedScalar): Fix a general problem
	with compiled local variables that are upvar'ed. Contributed by
	Scott Stanton <stanton@@scriptics.com>.
d2393 8
a2400 1
1998-11-04  Ian Roxborough  <irox@@cygnus.com>
d2402 1
a2402 1
	* win/tclWinPort.h: #endif in the wrong place and missing ')'.
d2404 5
a2408 1
1998-11-06  Syd Polk  <spolk@@cygnus.com>
d2410 1
a2410 2
	* win/tclWinPort.h: Updated from Scriptics. Tcl_Realloc no longer
	fails with blocks that are more than 64K.
d2412 15
a2426 1
1998-11-04  Ian Roxborough  <irox@@cygnus.com>
d2428 2
a2429 3
	* generic/panic.c (panic): Removed a #define _DEBUG,
	under MSVC if you want an exception Breakpoint instead
	of a panic dialog, CFLAGS must contain -D_DEBUG.
d2431 1
a2431 1
1998-11-03  Ian Roxborough  <irox@@cygnus.com>
d2433 17
a2449 2
	* generic/panic.c (panic): If compiling with Microsoft, have this
	generate an exception Breakpoint.
d2451 5
a2455 1
1998-11-03  Syd Polk  <spolk@@cygnus.com>
d2457 1
a2457 3
	* generic/panic.c: If compiling with Microsoft, have this generate
	a core dump so that we can actually see where it is happening when
	we have co stdout/stderr.
d2459 40
a2498 1
1998-10-29  Syd Polk  <spolk@@cygnus.com>
d2500 3
a2502 6
	* win/configure.in: Removed check for caddr_t. This configure.in
	is not really ready for autoheader and the other garbage.
	* win/configure: Regenerated.
	* generic/tclAlloc.c: Put declaration of caddr_t inside of 
	#ifdef _MSC_VER. It appears that this is the only compiler that
	is missing this typedef.
d2504 1
a2504 1
1998-10-29  Syd Polk  <spolk@@cygnus.com>
d2506 4
a2509 2
	* win/Makefile.in: The directory for encodings is called 'encoding',
	not 'encodings'.
d2511 1
a2511 1
1998-10-29  Syd Polk  <spolk@@cygnus.com>
d2513 3
a2515 7
	* unix/configure.in: Fix merge problem with socket libraries. Run
	autoconf test for caddr_t.
	* unix/configure: Regenerate.
	* win/configure.in Run autoconf test for caddr_t.
	* win/configure: Regnerate.
	* generic/tclAlloc.c: Remove declaration of caddr_t. Should be
	provided by configure now.
d2517 1
a2517 1
1998-10-28  Syd Polk  <spolk@@cygnus.com>
d2519 2
a2520 2
	* unix/Makefile.in: Install encodings from make install.
	* win/Makefile.in: Install encodings from make install.
d2522 1
a2522 1
1998-10-28  Ben Elliston  <bje@@cygnus.com>
d2524 4
a2527 2
	* win/configure.in (TCL_BUILD_INCLUDES): Remove. Do not subst.
	* win/configure: Regenerate.
d2529 1
a2529 1
1998-10-26  Syd Polk  <spolk@@cygnus.com>
d2531 2
a2532 1
	* win/Makefile.in: Fix references to old opt0.1 library.
d2534 1
a2534 1
1998-10-20  Syd Polk  <spolk@@cygnus.com>
d2536 17
a2552 1
	* unix/Makefile.in: Fix references to old opt0.1 library.
d2554 1
a2554 1
1998-10-19  Ben Elliston  <bje@@cygnus.com>
d2556 2
a2557 1
	* unix/configure.in: Compute a value for @@TCL_BUILD_INCLUDES@@.
d2559 2
a2560 1
	* unix/configure: Regenerate.
d2562 19
a2580 3
	* unix/tclConfig.sh.in (TCL_BUILD_INCLUDES): Set.
	
	* win/configure.in: Compute a value for @@TCL_BUILD_INCLUDES@@.
d2582 1
a2582 1
	* win/configure: Regenerate.
d2584 17
a2600 1
1998-10-14  Syd Polk  <spolk@@cygnus.com>
d2602 1
a2602 2
	* win/configure.in Makefile.in: More fixes for the tcl8.l build
	* win/configure: Regenerated
d2604 3
a2606 1
1998-10-14  Syd Polk  <spolk@@cygnus.com>
d2608 1
a2608 4
	* generic/tclCmdIL.c (SortCompare}: Support as much of the old
	comparison semantics as possible. It is now possible to do
	lsort -command {foo bar} {1 3 45}.
	* tests/cmdIL.test (cmdIL-3.16}: Restore test.
d2610 3
a2612 1
1998-10-08  Syd Polk  <spolk@@cygnus.com>
d2614 1
a2614 10
	* generic/tclCmdIL.c (SortCompare): Make the comparison callback
	object based for performance.
	* tests/cmdIL.test (cmdIL-3.16): Test relied on incorrect behavior
	of old string based comparison callback, which was a bug. Corrected
	test.
	* unix/configure.in: Minor fixes for gcc
	* unix/configure: Regenerated
	* unix/dltest/configure.in: GCC needs -f writeable-strings
	* unix/dltest/Makefile.in: Fixed invalid TCL_CFLAGS reference
	* unix/dltest/configure: Regenerated.
d2616 3
a2618 1
1998-10-01  Ben Elliston  <bje@@cygnus.com>
d2620 4
a2623 3
	* generic/tclCmdIL.c (InfoEncodingsCmd): New function. Implement a
	Tcl ``info encodings'' command.
	(Tcl_InfoObjCmd): Detect ``encodings'' subcommand.
d2625 1
a2625 3
	* doc/info.n: Update documentation.
	
1998-09-29  Syd Polk  <spolk@@cygnus.com>
d2627 4
a2630 5
	* win/Makefile.in: Still some hard-coded references to 8.0.
	Fix problems with try and except
	* win/configure.in: Likewise
	* win/configure: Regenerated
	* win/tclWin32Dll.c: try and except not supported under gcc.
d2632 1
a2632 9
1998-09-28  Syd Polk  <spolk@@cygnus.com>
	
	* generic/tclClock.c: timezone needs to be declared somewhere
	* win/Makefile.in: Fixed OBJEXT problems
	* win/tclWinFile.c win/tclWinInit.c: Fixed merge problems
	* win/tclWinPipe.c: Removed Cygnus thread stuff to use the tcl 8.1
	thread stuff instead.

1998-09-28  Syd Polk  <spolk@@cygnus.com>
d2634 4
a2637 3
        * win/configure.in: Merged from 4.2 branch
        * win/configure: Regenerated
	* win/Makefile.in: Updated for tcl8.1.
d2639 1
a2639 3
Wed Aut 19 17:48:00 PDT 1998  Syd Polk  <spolk@@cygnus.com>
	
	* 8.1 integration continues.
d2641 4
a2644 1
Thu Apr 30 18:10:15 1998  Geoffrey Noer  <noer@@cygnus.com>
d2646 3
a2648 2
	* win/Makefile.in: invoke gcc instead of ld when producing
        dlls.  Pass the linker options down via args to -Wl options.
d2650 1
a2650 4
Mon Apr 20 11:40:23 MEST 1998 Khamis Abuelkomboz <khamis@@cygnus.com>
	*tcl/win tclWinPipe.c
	(PipeWatchProc): Mask PipeThread using (LPTHREAD_START_ROUTINE) to 
		remind bogus messages.
d2652 3
a2654 1
Tue Apr  7 16:36:49 1998  Ian Lance Taylor  <ian@@cygnus.com>
d2656 1
a2656 3
	* win/tclWinFile.c: If __CYGWIN32__, call chdir rather than
	SetCurrentDirectory, so that the cygwin32 DLL knows the current
	directory when doing path munging.
d2658 4
a2661 1
Sat Mar 21 21:18:06 1998  Elena Zannoni  <ezannoni@@kwikemart.cygnus.com>
d2663 4
a2666 2
	Merged changes from Foundry (list follows in reverse chronological 
        order)
d2668 1
a2668 7
        - Tom Tromey  <tromey@@cygnus.com>
	* library/init.tcl (auto_execok): If ide_cygwin_path command is
	defined, the convert PATH environment variable to Win32 path list
	before use.
	* win/stub16.c: Include <string.h>.
	* win/tclWinInit.c (TclPlatformInit): Don't look in registry to
	find default tcl_library setting.
d2670 2
a2671 11
        - Ian Lance Taylor  <ian@@cygnus.com>
	* win/Makefile.in ($(TCLDLL)): Don't generate relocs for debugging
	information.
	($(TCLPLUGINDLL), $(TCLREGDLL)): Likewise.
	* generic/tclIOUtil.c (Tcl_EvalFile): Put the newly allocated
	buffer into an object and use Tcl_EvalObj, rather than having
	Tcl_Eval copy the buffer.
	* generic/tclEnv.c (TclSetEnv): Don't set the env array if the
	value is the same as the one we are trying to set.
  
Sat Feb 21 08:59:00 1998  Chris Provenzano  <proven@@cygnus.com>
d2673 41
a2713 2
	* Makefile.in, unix/Makefile.in
	Don't set shell to /bin/sh. Set it to @@SHELL@@
d2715 1
a2715 1
	* configure: Regenerated with support for @@SHELL@@ substitution
d2717 5
a2721 1
Mon Feb  9 16:02:47 1998  Ian Lance Taylor  <ian@@cygnus.com>
d2723 1
a2723 3
	* win/configure.in: Call AC_PROG_RANLIB so that TCL_RANLIB gets
	set correctly in tclConfig.sh.
	* win/configure: Rebuild.
d2725 5
a2729 1
Tue Jan 20 19:24:22 1998  Ian Lance Taylor  <ian@@cygnus.com>
d2731 1
a2731 2
	* win/tclWinChan.c (TclGetDefaultStdChannel): Check for error
	return from Tcl_MakeFileChannel.
d2733 2
a2734 1
Tue Dec 23 16:25:02 1997  Ian Lance Taylor  <ian@@cygnus.com>
d2736 1
a2736 3
	* win/Makefile.in ($(TCLDLL)): Don't generate relocs for debugging
	information.
	($(TCLPLUGINDLL), $(TCLREGDLL)): Likewise.
d2738 48
a2785 1
Wed Nov  5 00:50:32 1997  Martin M. Hunt  <hunt@@cygnus.com>
d2787 3
a2789 1
	* library/word.tcl: Always use Motif-style selections.
d2791 1
a2791 1
Tue Oct 28 17:44:15 1997  Martin M. Hunt  <hunt@@cygnus.com>
d2793 25
a2817 2
	* win/tclWinChan.c (Tcl_OpenFileChannel): Patch "winchan.txt"
	from net. Fixes problems with PC-NFS access.
d2819 1
a2819 4
	* win/tclWinSock.c (Tcl_GetHostName): Fix problem where
	[info hostname] crashes on NT 4.0 machines that do not have 
	networking installed. Patch from Darrel Schneider 
	<darrel@@gemstone.com>
d2821 2
a2822 1
Tue Oct 28 16:31:46 1997  Ian Lance Taylor  <ian@@cygnus.com>
d2824 1
a2824 2
	* Makefile.in (install-minimal): New target.
	* win/Makefile.in (install-minimal): New target.
d2826 3
a2828 1
Wed Oct 15 18:58:32 1997  Ian Lance Taylor  <ian@@cygnus.com>
d2830 1
a2830 4
	* win/tclWinPort.h: If __CYGWIN32__, define TclpAlloc, TclpFree,
	and TclpRealloc rather than TclpSysAlloc, TclpSysFree, and
	TclpSysRealloc.
	* win/Makefile.in (TCLOBJS): Remove tclAlloc.o.
d2832 5
a2836 1
Thu Sep 25 02:57:00 1997  Martin M. Hunt  <hunt@@cygnus.com>
d2838 1
a2838 4
	* generic/tclCmdAH.c (Tcl_FormatObjCmd): This fixes an 
	off-by-one error in the format command that can lead to memory 
	corruption on some systems, most notable little endian systems, 
	such as Intel. Patch "format.txt" from patches archive.
d2840 1
a2840 2
	* unix/tclUnixChan.c (TcpGetOptionProc): Applied patch
	"unixchan.txt" from patches archive.
d2842 1
a2842 1
Tue Sep 23 14:31:01 1997  Tom Tromey  <tromey@@cygnus.com>
d2844 8
a2851 2
	* generic/tclStringObj.c (Tcl_DbNewStringObj): Don't die if
	bytes==NULL.  From schoenw@@gaertner.de (Juergen Schoenwaelder).
d2853 1
a2853 2
	* generic/tclIO.c (Tcl_SetChannelOption): Allow output translation
	mode to be "auto".  From Dave Dykstra <dwd@@bell-labs.com>.
d2855 3
a2857 1
Thu Sep  4 11:29:14 1997  Martin M. Hunt  <hunt@@cygnus.com>
d2859 1
a2859 2
	* generic/tclIO.c: Applied patch "io.txt" from the
	patches archive.
d2861 2
a2862 7
Tue Sep  2 16:49:16 PDT 1997 Khamis Abuelkomboz <khamis@@cygnus.com>
	* library/menu.tcl
	In this file I have found two bugs:
	One in focus policy (wrong function call)
	and the main error was by the tkMenuUnpost procedure (toplevel problem).
	Generaly this script doesn't work correctly at all and I don't
	know if we have the latest version of this file.
d2864 1
a2864 1
Thu Aug 28 17:20:57 1997  Ian Lance Taylor  <ian@@cygnus.com>
d2866 2
a2867 2
	* win/Makefile.in (install-libraries): Install http2.0 and
	opt0.1.
d2869 2
a2870 2
	* generic/tclEnv.c (TclCygwin32Putenv): Call unsetenv rather than
	putenv to remove the variable.
d2872 1
a2872 1
	* generic/tclAlloc.c: Don't define caddr_t if __CYGWIN32__.
d2874 53
a2926 3
Thu Aug 28 15:31:05 MET DST 1997 Zsolt Koppany <zkoppany@@multix.de>
	* generic/tclCompile.c generic/tclEnv.c generic/tclTestObj.c
	  unix/tclUnixFCmd.c
d2928 1
a2928 2
	* Memory bug fixes.
Sun Aug 24 21:35:19 1997  Ian Lance Taylor  <ian@@cygnus.com>
d2930 1
a2930 2
	* win/Makefile.in ($(TCLDLL)): Set base address to 0x66000000.
	($(TCLREGDLL)): Set base address to 0x66200000.
d2932 1
a2932 1
Thu Aug 21 12:49:47 1997  Ian Lance Taylor  <ian@@cygnus.com>
d2934 21
a2954 2
	* win/tclWinPipe.c (Tcl_WaitPid): If __CYGWIN32__, handle a
	cygwin32 signal exit status correctly.
d2956 1
a2956 5
	* win/tclWinPipe.c (PipeThread): Only set PIPE_READAHEAD if we
	really did read a byte.  Set PIPE_READABLE if ReadFile completes.
	(PipeProc): Don't bother to set PIPE_READABLE either.
	(PipeSetupProc): Handle a read from a pipe without a thread.
	(PipeCheckProc): Likewise.
d2958 3
a2960 1
Wed Aug 20 23:17:23 1997  Ian Lance Taylor  <ian@@cygnus.com>
d2962 1
a2962 24
	* win/tclWinPipe.c (PIPE_READABLE, PIPE_CLOSED): Define.
	(PIPE_HAS_THREAD, PIPE_READAHEAD): Define.
	(PipeInfo): Add fields: flagsMutex, mutex, tryReadEvent,
	readAhead.
	(pipeHwnd): New static variable.
	(PipeGetFlags, PipeSetFlag, PipeResetFlag): New static functions.
	Use them for all access to the flags field of a pipe.
	(PipeThread): New static function.
	(PipeProc): New static function.
	(PipeInit): Set up pipe window class and window.
	(PipeExitHandler): Unregister the class and destroy the window.
	(PipeSetupProc): Only set the block time to 0 for a readable pipe
	if we know that it is readable.  If we want read events, tell the
	thread to try a read.
	(PipeCheckProc): Only post an event for a readable pipe if we know
	that it is readable.
	(TclpCreateCommandChannel): Create the flags mutex.
	(PipeCloseProc): If the pipe has a thread, tell the thread the
	pipe is closed, and let it free everything.  Otherwise, close the
	flags mutex.
	(PipeInputProc): Lock the pipe during the function.  Use the
	readahead byte if it is available.  Reset PIPE_READABLE.
	(PipeEventProc): Check PIPE_READABLE if we have a thread.
	(PipeWatchProc): Create a thread if we want read events.
d2964 12
a2975 3
Tue Aug 19 16:34:54 MET DST 1997 Zsolt Koppany <zkoppany@@multix.de>
	* generic/tclEnv.c
	  Removed patch from EnvExitProc()
d2977 1
a2977 1
Mon Aug 18 20:15:23 1997  Ian Lance Taylor  <ian@@cygnus.com>
d2979 6
a2984 2
	* win/tclWinPipe.c (TclpCreateProcess): Make sure the pipe stuff
	is initialized.
d2986 1
a2986 2
	* win/tclWin32Dll.c (TclSetSystemEnv): If we set Path, clear
	PATH.  If we set PATH, clear Path.
d2988 4
a2991 1
Fri Aug 15 19:20:44 1997  Ian Lance Taylor  <ian@@cygnus.com>
d2993 1
a2993 2
	* win/tclWinInit.c (initScript): Look up one more level, to allow
	for exec-prefix being a subdirectory of prefix.
d2995 2
a2996 1
Wed Aug 13 13:22:15 1997  Ian Lance Taylor  <ian@@cygnus.com>
d2998 1
a2998 3
	* generic/tclPipe.c (TclCreatePipeline): Check explicitly for
	redirecting stderr to stdout, and handle it by making the stderr
	file a copy of the stdout file.
d3000 3
a3002 2
	* generic/tclEnv.c (TclSetEnv): Call TclSetSystemEnv before
	calling Tcl_SetVar2.
d3004 1
a3004 1
Mon Aug 11 19:39:45 1997  Ian Lance Taylor  <ian@@cygnus.com>
d3006 6
a3011 3
	* configure.in: Call AC_CANONICAL_HOST.  Check host, not target,
	for cygwin32.
	* configure: Rebuild.
d3013 1
a3013 1
Sat Aug  9 20:27:48 1997  Ian Lance Taylor  <ian@@cygnus.com>
d3015 4
a3018 7
	* win/tclWinSock.c (SocketEventProc): Handle an FD_CONNECT event
	for a client channel.  On FD_CLOSE for a client channel, set
	TCL_WRITABLE.
	(Tcl_MakeTcpClientChannel): Select for FD_CONNECT.
	(TcpWatchProc): Watch for FD_CLOSE on a client channel when
	looking for writable.  Watch for FD_CONNECT on a client channel in
	all cases.
d3020 1
a3020 1
Thu Aug  7 12:44:49 1997  Ian Lance Taylor  <ian@@cygnus.com>
d3022 1
a3022 6
	* win/tclWinSock.c: Add clientChannel field.
	(SocketEventProc): Handle FD_ACCEPT on a client channel by setting
	TCL_READABLE.
	(NewSocketInfo): Initialize clientChannel field to 0.
	(Tcl_MakeTcpClientChannel): Set clientChannel field to 1.  Select
	for FD_ACCEPT.
d3024 1
a3024 1
	* win/tclWinInit.c (initScript): Use share rather than lib.
d3026 5
a3030 1
Wed Aug  6 20:49:13 1997  Ian Lance Taylor  <ian@@cygnus.com>
d3032 1
a3032 8
	* win/Makefile.in: Update for Tcl 8.0.
	* win/configure.in: Likewise.
	* win/configure: Rebuild.
	* win/tclWin32Dll.c (TclSetSystemEnv): Handle a NULL value.
	* win/tclWinChan.c (Tcl_OpenFileChannel): Move conv_to_win32_path
	call after Tcl_TranslateFileName call.
	* win/tclWinFile.c: Don't include <shlobj.h> if __CYGWIN32__.
	(TclWinStat): Don't adjust stat times if __CYGWIN32__.
d3034 6
a3039 1
Tue Aug  5 13:25:43 1997  Tom Tromey  <tromey@@cygnus.com>
d3041 1
a3041 3
	* win/tclWinPipe.c: Preserved local changes.
	* win/tclWinSock.c: Preserved local changes.
	* win/tclWinChan.c: Preserved local changes.
d3043 5
a3047 1
Mon Aug  4 16:23:53 1997  Tom Tromey  <tromey@@cygnus.com>
d3049 1
a3049 2
	* tests/fCmd.test: fCmd-8.1 test marked nonportable; removed local
	changes.
d3051 3
a3053 1
	* tests/defs: Preserved local changes.
d3055 1
a3055 1
Fri Aug  1 16:51:03 1997  Ian Lance Taylor  <ian@@cygnus.com>
d3057 4
a3060 2
	* win/tclWinChan.c (Tcl_OpenFileChannel): If __CYGWIN32__, convert
	the path name to a win32 path name.
d3062 1
a3062 1
Wed Jul 23 20:03:07 1997  Ian Lance Taylor  <ian@@cygnus.com>
d3064 1
a3064 3
	* win/tclWinSock.c (TclWinWatchSocket): Only set the maximum block
	time to zero if we have an event that matches something in the
	desired mask.
d3066 4
a3069 1
Mon Jun 30 13:38:43 1997  Ian Lance Taylor  <ian@@cygnus.com>
d3071 1
a3071 2
	* win/tclWinPipe.c (TclpCreateProcess): Our DLL is named
	cygtclpip, not tclpip.
d3073 2
a3074 9
	* generic/tclEnv.c: If __CYGWIN32__, define environ as a static
	variable.
	(EnvInit): If __CYGWIN32__, initialize environ from
	__imp___cygwin_environ.
	* win/tclWinPort.h (__imp___cygwin_environ): Don't declare.
	(environ): Don't define.
	(TclSetSystemEnv): If __CYGWIN32__, declare as function, don't
	define as macro.
	* win/tclWin32Dll.c (TclSetSystemEnv): New function.
d3076 1
a3076 1
Thu Jun 26 13:56:01 1997  Ian Lance Taylor  <ian@@cygnus.com>
d3078 6
a3083 9
	* win/Makefile.in (WINDRES): New variable.
	(install-binaries): Don't install DLLs here...
	(install-libraries): ...install them here instead.
	($(TCLDLL)): Depend upon and link with tclres.o.
	($(TCLSH)): Depend upon and link with tclshres.o.
	($(TCLTEST)): Likewise.
	(tclres.o, tclshres.o): New targets.
	* win/configure.in: Define and substitute WINDRES.
	* win/configure: Rebuild.
d3085 1
a3085 1
Mon Jun 23 10:15:10 1997  Ian Lance Taylor  <ian@@cygnus.com>
d3087 7
a3093 1
	* Makefile.in (install-binaries, install-libraries): New targets.
d3095 1
a3095 1
Wed Jun 18 12:12:36 1997  Ian Lance Taylor  <ian@@cygnus.com>
d3097 5
a3101 3
	* win/Makefile.in: Copy install, install-binaries, and
	install-libraries rules, and associated variables from
	unix/Makefile.in, with appropriate adjustments.
d3103 5
a3107 1
Thu Jun 12 19:12:20 1997  Ian Lance Taylor  <ian@@cygnus.com>
d3109 1
a3109 2
	* win/Makefile.in ($(TMPDIR)/tclcyg.def): Don't export
	impure_ptr.
d3111 3
a3113 1
Fri Jun  6 15:52:50 1997  Ian Lance Taylor  <ian@@cygnus.com>
d3115 2
a3116 16
	Add support for building with cygwin32:
	* win/Makefile.in: Rewrite completely based on makefile.vc.
	* win/configure.in: Rewrite completely.
	* win/configure: Rebuild.
	* win/tclWinPort.h (__imp___cygwin_environ): Declare if
	__CYGWIN32__.
	(environ): Define if __CYGWIN32__.
	* win/tclWin32Dll.c (_impure_ptr): Define if __CYGWIN32__.
	(__imp_reent_data): Declare if __CYGWIN32__.
	(DllMain): Initialize _impure_ptr if __CYGWIN32__.
	* win/tclWinFCmd.c (TclpRenameFile): Don't use try and except if
	__GNUC__.
 	(TclpCopyFile): Likewise.
	* win/tclWinPipe.c: Don't include dos.h if __CYGWIN32__.
	* win/tclWinSock.c (InitSockets): Don't cast to PASCAL FAR if
	__GNUC__.
d3118 2
a3119 1
Thu Jun  5 18:17:53 1997  Ian Lance Taylor  <ian@@cygnus.com>
d3121 1
a3121 2
	* generic/tcl.h (USE_TCLALLOC): Don't define USE_TCLALLOC if it is
	already defined (this modifies a CYGNUS LOCAL patch).
d3123 3
a3125 1
Fri May  9 09:36:00 1997  Tom Tromey  <tromey@@cygnus.com>
d3127 1
a3127 1
	* patchlevel.h: Removed.
d3129 2
a3130 1
Wed Apr  9 17:31:41 1997  Bob Manson  <manson@@charmed.cygnus.com>
d3132 1
a3132 3
	* generic/regexp.c (regmatch): Speed up .* matching
 	significantly. Treat a single bracketed character the same as a
 	string.
d3134 8
a3141 1
Thu Mar 20 14:27:45 1997  Geoffrey Noer  <noer@@cygnus.com>
d3143 1
a3143 1
        * compat/strncasecmp.c: fix args in prototype for strcasecmp
d3145 3
a3147 1
Fri Mar 14 10:36:30 1997  Tom Tromey  <tromey@@cygnus.com>
d3149 1
a3149 1
	* tests/fCmd.test: Commented out fcmd-8.1 test.
d3151 2
a3152 1
Fri Mar  7 10:46:04 1997  Tom Tromey  <tromey@@cygnus.com>
d3154 1
a3154 1
	* Updated to Tcl 7.6p2 and preserved Cygnus changes.
d3156 1
a3156 1
Wed Mar  5 12:00:44 1997  Martin  <hunt@@cyber>
d3158 1
a3158 3
	* Makefile.in, configure.in: Added support for building
	the windows directory.
	* configure: Rebuilt.
d3160 3
a3162 1
Fri Dec 13 15:47:07 1996  Tom Tromey  <tromey@@cygnus.com>
d3164 8
a3171 2
	* compat/strtod.c: Include ../compat/stdlib.h, not
	compat/stdlib.h.  From Donald Koch <koch@@cognex.com>.
d3173 1
a3173 1
Wed Nov 20 14:07:06 1996  Tom Tromey  <tromey@@cygnus.com>
d3175 1
a3175 2
	* generic/tclAlloc.c: Removed; functionality has been integrated
	into Tcl core.
d3177 2
a3178 1
Tue Nov 19 09:30:41 1996  Tom Tromey  <tromey@@cygnus.com>
d3180 2
a3181 1
	* generic/tcl.h: Remove redundant decls of Tcl_Alloc and friends.
d3183 1
a3183 1
Mon Nov 18 14:59:47 1996  Tom Tromey  <tromey@@cygnus.com>
d3185 3
a3187 2
	* generic/tclAlloc.c (Tcl_Alloc): Renamed.
	* generic/tcl.h: Always define USE_TCLALLOC.
d3189 3
a3191 1
	* Imported Tcl 7.6 and preserved local changes.
d3193 2
a3194 1
Mon Aug  5 10:41:11 1996  Tom Tromey  <tromey@@creche.cygnus.com>
d3196 1
a3196 2
	* Makefile.in (configure): Don't depend on configure.in.
	(config.status): Depend on configure.
d3198 4
a3201 1
Wed Jul 31 14:41:34 1996  Tom Tromey  <tromey@@creche.cygnus.com>
d3203 1
a3203 2
	* tests/socket.test: Commented out test socket-8.1; it can fail on
	Solaris 2.4.
d3205 3
a3207 1
Tue Jul 30 14:53:59 1996  Tom Tromey  <tromey@@creche.cygnus.com>
d3209 1
a3209 3
	* tests/socket.test: Find remote.tcl in srcdir.
	* tests/io.test: Find io.test in srcdir.
	* tests/defs: Find "defs" in directory $srcdir.
d3211 8
a3218 1
Wed Jun 26 12:36:57 1996  Jason Molenda  (crash@@godzilla.cygnus.co.jp)
d3220 6
a3225 2
	* configure.in (AC_PREREQ): autoconf 2.5 or higher.
	* configure: Rebuilt.
d3227 1
a3227 1
Thu Jun  6 15:04:44 1996  Gordon Irlam  <gordoni@@snuffle.cygnus.com>
d3229 4
a3232 2
	* doc/usenix.ps, doc/usenix.text: Removed because copyright status
	unclear.
d3234 1
a3234 1
Mon May 20 16:11:55 1996  Tom Tromey  <tromey@@creche.cygnus.com>
d3236 4
a3239 1
	* tcltk-man-html.tcl: Moved to devo/inet.
d3241 1
a3241 1
Mon May  6 15:21:14 1996  Tom Tromey  <tromey@@lisa.cygnus.com>
d3243 2
a3244 1
	* tcltk-man-html.tcl: Search Tk section 3 man pages if possible.
d3246 1
a3246 1
Wed May  1 15:17:14 1996  Tom Tromey  <tromey@@lisa.cygnus.com>
d3248 9
a3256 1
	* tcltk-man-html.tcl: New file.
d3258 2
a3259 1
Thu Mar  7 10:01:05 1996  Tom Tromey  <tromey@@creche.cygnus.com>
d3261 1
a3261 1
	* Makefile.in (config.status): Don't depend on configure.
d3263 5
a3267 1
Wed Mar  6 10:48:56 1996  Tom Tromey  <tromey@@creche.cygnus.com>
d3269 1
a3269 1
	* Makefile.in (Makefile): Removed redundant rule.
d3271 4
a3274 1
Thu Feb 29 21:27:38 1996  Fred Fish  <fnf@@ninemoons.com>
d3276 1
a3276 2
	* Makefile.in (configure): Run autoconf in source dir,
	not build dir.
d3278 5
a3282 1
Thu Feb 29 09:08:52 1996  Tom Tromey  <tromey@@creche.cygnus.com>
d3284 1
a3284 2
	* Makefile.in (Makefile): New rule.
	(config.status): New rule.
d3286 2
a3287 3
	* tests/all: Use $srcdir to find tests.
	Source `defs' here.
	Only print filename, not entire path.
d3289 3
a3291 1
Tue Feb 27 20:40:56 1996  Rob Savoye  <rob@@chinadoll.cygnus.com>
d3293 58
a3350 3
	* unix/configure.in: Use -fpic for dltests, as gcc now support
	shared libraries on HPUX.
	* configure: Rebuild.
d3352 1
a3352 1
Mon Feb 12 14:55:34 1996  Rob Savoye  <rob@@chinadoll.cygnus.com>
d3354 4
a3357 2
	* unix/configure.in: Set the shared lib flags so the dynamic
	loading tests work for SunOS and Solaris when using GCC.
d3359 5
a3363 1
Wed Jan 24 09:41:00 1996  Tom Tromey  <tromey@@creche.cygnus.com>
d3365 1
a3365 1
	* Makefile.in: Replaced realclean with maintainer-clean.
d3367 2
a3368 1
Mon Jan 22 14:42:47 1996  Tom Tromey  <tromey@@creche.cygnus.com>
d3370 1
a3370 1
	* tests/all: Print message when tests finished.
d3372 5
a3376 2
	* Makefile.in (check): Use absolute directory when finding
	TCL_LIBRARY.
d3378 1
a3378 1
Fri Jan 19 10:35:16 1996  Tom Tromey  <tromey@@creche.cygnus.com>
d3380 12
a3391 1
	* Makefile.in (check installcheck): Moved from unix/Makefile.in.
d3393 1
a3393 1
Thu Jan 11 14:41:35 1996  Tom Tromey  <tromey@@creche.cygnus.com>
d3395 2
a3396 1
	* Makefile.in (test): New target.
d3398 3
a3400 1
Wed Jan 10 11:21:38 1996  Tom Tromey  <tromey@@creche.cygnus.com>
d3402 1
a3402 3
	* Makefile.in (mostlyclean-recursive clean-recursive
	distclean-recursive realclean-recursive): Separated out recursive
	rules.
d3404 3
a3406 1
Tue Jan  9 17:34:56 1996  Tom Tromey  <tromey@@creche.cygnus.com>
d3408 1
a3408 2
	* Makefile.in: New file.
	* configure.in: New file.
d3410 5
a3414 3
	* Updated to the tcl7.5a2 release, plus preserved our patches.
	Entries past this point mostly likely refer to files in various
	subdirectories.
d3416 1
a3416 1
Fri Dec  1 10:18:01 1995  Rob Savoye  <rob@@chinadoll.cygnus.com>
d3418 1
a3418 7
	* Makefile.in, changes, configure, patchlevel.h, tcl.h,
	tclBasic.c, tclCkalloc.c, tclCmdAH.c, tclCmdMZ.c, tclInt.h,
	tclMain.c, tclPort.h, tclRegexp.h, tclUnixAZ.c, tclUnixStr.c,
	tclUnixUtil.c, tclVar.c, README, compat/fixstrtod.c,
	tests/lsort.test, testsuite/config/default.exp,
	testsuite/tcl.tests/tcl-test.exp: Upgrade to Tcl7.4p3 to fix a few
	bugs.
d3420 1
a3420 1
Thu Nov 16 10:01:20 1995  Rob Savoye  <rob@@chinadoll.cygnus.com>
d3422 2
a3423 2
	* configure.in: Use AC_PROG_CC again since Cygnus configure now
	does the sames thing.
d3425 2
a3426 1
Sat Oct  7 20:51:29 1995  Michael Meissner  <meissner@@cygnus.com>
d3428 1
a3428 2
	* tcl.h (ckrealloc): Cast pointer argument to char * to silence
	warnings.
d3430 109
a3538 1
Sun Aug 20 00:43:51 1995  Jason Molenda  (crash@@phydeaux.cygnus.com)
d3540 1
a3540 2
	* configure.in: If the system has a functional strtod(), *don't*
	provide one.
d3542 10
a3551 1
Thu Aug 17 16:04:39 1995  Rob Savoye  <rob@@darkstar.cygnus.com>
d3553 4
a3556 2
	* tcl: Updated to the official tcl7.4 release, plus preserved
	  our patches.
d3558 8
a3565 1
Sun Aug  6 11:45:19 1995  Fred Fish  <fnf@@cygnus.com>
d3567 2
a3568 1
	* Makefile.in (distclean):  Remove config.cache & config.log
d3570 1
a3570 1
Mon Jun 12 15:46:48 1995  J.T. Conklin  <jtc@@rtl.cygnus.com>
d3572 30
a3601 6
	* tclAlloc.c: New file.
	* tcl.h (Tcl_Malloc, Tcl_Realloc, Tcl_Free): New functions.
	  (ckalloc, ckrealloc, ckfree): Defined to Tcl_Malloc, Tcl_Free
	  respectively when compiling without TCL_MEM_DEBUG.
	* Makefile.in (GENERIC_OBJS): Added tclAlloc.o
	  (SRCS): Added tclAlloc.c.
d3603 2
a3604 1
Thu Apr  6 19:32:43 1995  Doug Evans  <dje@@chestnut.cygnus.com>
d3606 1
a3606 1
	* tclPort.h (gettimeofday): Comment out prototype.
d3608 1
a3608 1
Thu Mar 23 17:58:38 1995  Rob Savoye  <rob@@thepub.cygnus.com>
d3610 14
a3623 2
	* tcl: Upgrade to 7.4.b2. Update configure.in to autoconf 2.2,
	merge in our LynxOS patches.
d3625 2
a3626 1
Wed Dec 21 15:12:14 1994  J.T. Conklin  (jtc@@phishhead.cygnus.com)
d3628 1
a3628 2
	* tclUnixUtil.c: Use __Lynx__ in the conditional which selects
	  LynxOS-specific waitpid() prototype.
d3630 1
a3630 1
Mon Dec 19 04:38:49 1994  Angela Marie Thomas  <angela@@cygnus.com>
d3632 1
a3632 3
	* Makefile.in (all): use ${AR_FLAGS}, not ${ARFLAGS} because the
	"make" default for ${ARFLAGS} includes an option, f, which I can't
	find in any man page and breaks builds.
d3634 3
a3636 1
Tue Jun  7 07:44:31 1994  D. V. Henkel-Wallace  (gumby@@cygnus.com)
d3638 1
a3638 1
	* compat/tmpnam.c: handle losing LynxOS mktemp.
d3640 6
a3645 1
Thu May 26 20:15:55 1994  David J. Mackenzie  (djm@@poseidon.cygnus.com)
d3647 3
a3649 4
	* aclocal.m4 (TCL_LYNX_POSIX): Renamed from AC_LYNX_POSIX.
	Check __GNUC__ value to get POSIX flag right.
	* configure.in: Use new name.
	* configure: Regenerate.
d3651 1
a3651 1
Wed May  4 20:17:46 1994  D. V. Henkel-Wallace  (gumby@@cygnus.com)
d3653 2
a3654 2
	* compat/tmpnam.c: if you're going to redefine P_tmpdir,
	undefine it first.
d3656 1
a3656 3
	* compat/strerror.c: undefine various error codes which are
	defined in terms of others, where that causes duplicated case
	labels on r/s6000 lynxos 2.2.2.
d3658 3
a3660 1
Sat Apr 23 17:10:13 1994  Bill Cox  (bill@@rtl.cygnus.com)
d3662 1
a3662 2
	* compat/getcwd.c: The contents of this file was the UCB
	  float.h file.  Restored the correct contents from devo.
d3664 2
a3665 1
Fri Apr 22 11:28:35 1994  Bill Cox  (bill@@cygnus.com)
d3667 1
a3667 2
	* tclUnixUtil.c: Make a new prototype for waitpid if
	  we're compiling under the Lynx version of gcc.
d3669 2
a3670 1
Thu Mar 31 19:36:44 1994  Ken Raeburn  (raeburn@@cujo.cygnus.com)
d3672 1
a3672 4
	* install.sh: Since "set -e" is in effect, don't use a test that
	can fail in a while condition; it confuses some shells.  Use break
	instead.  Use "case" rather than "if [" for efficiency with some
	shells.
d3674 41
a3714 1
Tue Jan  4 17:03:31 1994  Rob Savoye  (rob@@rtl.cygnus.com)
d3716 11
a3726 2
	* All files: Upgraded to Tcl7.3. This version has incompatablities
	with the old versions before 7.0.
d3728 2
a3729 1
Tue Nov 23 13:01:22 1993  Rob Savoye  (rob@@darkstar.cygnus.com)
d3731 1
a3731 1
	* configure.in: Use AC_HEADER_CHECK for unistd.h.
d3733 2
a3734 1
Tue Nov  9 19:07:39 1993  Rob Savoye  (rob@@cygnus.com)
d3736 3
a3738 2
	* tclUnixStr.c (Tcl_ErrnoId): Added cpp tests for duplicate
	defines that choked LynxOS.
d3740 1
a3740 1
Fri Oct  1 17:30:06 1993  Doug Evans  (dje@@canuck.cygnus.com)
d3742 3
a3744 1
	* Makefile.in (tclTest.o): Sun VPATH lossage.
d3746 1
a3746 1
Tue Aug 17 11:23:27 1993  david d `zoo' zuhn  (zoo@@rtl.cygnus.com)
d3748 2
a3749 1
	* Makefile.in (install): don't install *.tcl all at once
d3751 1
a3751 1
Thu Jul  8 09:24:47 1993  Doug Evans  (dje@@canuck.cygnus.com)
d3753 9
a3761 1
	* Makefile.in: Add stuff needed to make Sun VPATH work.
d3763 3
a3765 1
Thu May  6 12:04:52 1993  Rob Savoye  (rob at darkstar.cygnus.com)
d3767 1
a3767 1
	* Makefile.in: Install the manpages too.
d3769 127
a3895 1
Tue May  4 22:01:24 1993  Rob Savoye  (rob at darkstar.cygnus.com)
d3897 52
a3948 5
	* tclUnix.h: Don't set TCL_PID_T anymore. FInd the right dirent.h.
	* configure.in: Handle no pid_t in sys/types.h. Also also check
	for dirent.h.
	* Makefile.in: Let INSTALL_PROGRAM and INSTALL_DATA come from
	configure.
d3950 1
a3950 1
Fri Apr 16 07:25:07 1993  Fred Fish  (fnf@@lisa.cygnus.com)
d3952 16
a3967 2
	* configure (DEFS):  When defining "-Dconst=" define "-DCONST="
	as well, for the sake of things in compat/* that use it.
d3969 48
a4016 1
	* Makefile.in (opendir.c):  Add missing ../compat/..
d4018 1
a4018 1
Mon Apr  5 10:56:28 1993  Rob Savoye  (rob@@cygnus.com)
d4020 3
a4022 4
	* testsuite/config/unix-tcl.exp: Use tcl/tclTest for test code
	driver. 
	* Makefile.in, testsuite/*.in, testsuite/tcl.tests/*.in: Don't use
	Cygnus configure anymore.
d4024 2
a4025 1
Wed Mar 24 02:09:33 1993  david d `zoo' zuhn  (zoo at poseidon.cygnus.com)
d4027 1
a4027 1
	* Makefile.in: add installcheck & dvi targets
d4029 31
a4059 1
Fri Mar 19 21:07:25 1993  david d `zoo' zuhn  (zoo at cirdan.cygnus.com)
d4061 1
a4061 1
	* tclEnv.c: disable putenv.  no one uses it.
d4063 47
a4109 1
Mon Feb 22 07:54:03 1993  Mike Werner  (mtw@@poseidon.cygnus.com)
d4111 15
a4125 3
        * tcl/testsuite: made modifications to testcases, etc., to allow
        them to work properly  given the reorganization of deja-gnu and the
        relocation of the testcases from deja-gnu to a "tool" subdirectory.
d4127 2
a4128 1
Sun Feb 21 10:55:55 1993  Mike Werner  (mtw@@poseidon.cygnus.com)
d4130 60
a4189 7
	* tcl/testsuite: Initial creation of tcl/testsuite.
	Migrated dejagnu testcases and support files for testing nm to
	tcl/testsuite from deja-gnu.  These files were moved "as is"
	with no modifications.	This migration is part of a major overhaul
	of dejagnu.  The modifications to these testcases, etc., which
	will allow them to work with the new version of dejagnu will be
	made in a future update.
d4191 2
a4192 1
Thu Feb 18 11:31:05 1993  Fred Fish  (fnf@@cygnus.com)
d4194 30
a4223 3
	* tclEnv.c (putenv):  On at least the Sun and SVR4, and possibly
	most other systems, the argument is just "char *", not
	"const char *".
d4225 9
a4233 1
Sat Dec 26 11:13:40 1992  Fred Fish  (fnf@@cygnus.com)
d4235 1
a4235 2
	* tclUnix.h (fseek):  Returns int, not long.  True for both
	ANSI-C and traditional C unix environments.
d4237 8
a4244 1
Wed Dec 16 11:02:29 1992  Ian Lance Taylor  (ian@@cygnus.com)
d4246 1
a4246 3
	* configure.in: check for gettimeofday, and define TCL_GETTOD
	accordingly.
	* configure: regenerated.
d4248 5
a4252 1
Fri Nov 27 19:09:03 1992  david d `zoo' zuhn  (zoo at cirdan.cygnus.com)
d4254 1
a4254 1
	* Makefile.in: don't make TCL_INCLUDE a subdir of $(includedir)
d4256 105
a4360 1
Fri Nov 20 10:15:55 1992  Ian Lance Taylor  (ian@@cygnus.com)
d4362 5
a4366 8
	* Makefile.in (INSTALL): Default to @@INSTALL@@, not install -c.
	(test): get tests from $(srcdir).

Sun Nov  8 21:56:26 1992  david d `zoo' zuhn  (zoo at cirdan.cygnus.com)

	* Makefile.in: install .tcl files from $(srcdir)/library

	* New file for GNU/Cygnus distribution of TCL.
d4368 1
d4370 62
@


1.28
log
@* cygwin/configure.in: Set TCL_BUILD_LIB_SPEC.
* cygwin/configure: Regenerate.
@
text
@d3 5
@


1.27
log
@touched all sources to ease next import
@
text
@d1 5
@


1.26
log
@* win/tclWin32Dll.c (tclWinTCharEncoding): Remove 'static' since it is declared
in header as exportable extern.
@
text
@@


1.25
log
@touched all sources to ease next import
@
text
@d1 5
@


1.25.4.1
log
@Merge drow-cplus-merge-20021025 to drow-cplus-branch.
@
text
@a0 5
2002-10-05  Christopher Faylor  <cgf@@redhat.com>

	* win/tclWin32Dll.c (tclWinTCharEncoding): Remove 'static' since it is
	declared in header as exportable extern.

@


1.25.4.2
log
@Merge drow-cplus-branch to:
  cvs rtag -D 2003-12-14 00:00:00 UTC drow-cplus-merge-20031214 gdb+dejagnu
@
text
@d1 1
a1 2
2003-02-11  Martin M. Hunt  <hunt@@redhat.com>
	From Mumit Khan  <khan@@nanotech.wisc.edu>
d3 2
a4 74
	* generic/tclIOUtil.c (SetFsPathFromAny): Add Cygwin specific
	code to convert POSIX filename to native format.
	* generic/tclFileName.c (Tcl_TranslateFileName): And remove
	from here.
	(TclDoGlob): Adjust.
	* win/tclWinFile.c (TclpObjChdir): Use chdir on Cygwin.


2003-02-06  Martin M. Hunt  <hunt@@redhat.com>

	* win/tcl.m4 (SC_CONFIG_CFLAGS): Don't default to -O.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Don't default to -O.	
	CFLAGS gets set to "-O2" by default in top level
	configure. Adding "-O" here causes the "-O2" to be
	ignored, but only when the user types "make" within
	the tcl subdirectory. This caused some confusion.
	* win/configure: Rebuilt.
	* unix/configure: Rebuilt.

	* generic/tclEnv.c (TclUnsetEnv): Cast arg to unsigned.

	Import from latest tcl sources to fix a bug with
	"file copy"
	2003-01-25  Mo DeJong  <mdejong@@users.sourceforge.net>	
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile, squelch_warnings):
	Re-implement inline ASM SEH handlers for gcc.
	The esp and ebp registers are now saved on the
	stack instead of in global variables so that
	the code is thread safe. Add additional checks
	when TCL_MEM_DEBUG is defined to be sure the
	values were recovered from the stack properly.
	Remove squelch_warnings functions and add
	a dummy call in the handler methods to squelch
	compiler warnings.
	* win/tclWinReg.c: Add casts to avoid compiler
	warning. Fix assignment in if expression bug.


2002-10-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	*** 8.4.1 TAGGED FOR RELEASE ***

	* changes: updated for 8.4.1 release

	* win/Makefile.in: removed @@MEM_DEBUG_FLAGS@@ subst.
	* win/configure: regen
	* win/configure.in: removed SC_ENABLE_MEMDEBUG call
	* win/tcl.m4: replaced SC_ENABLE_MEMDEBUG with a more intelligent
	SC_ENABLE_SYMBOLS that takes yes|no|mem|compile|all as options now.

2002-10-22  Daniel Steffen  <das@@users.sourceforge.net>

	* library/auto.tcl (tcl_findLibrary):
	* library/package.tcl (tclPkgUnknown): on macosx, search inside the
	Resources/Scripts subdirectory of any potential package directory
	* macosx/Tcl.pbproj/project.pbxproj: add standard Frameworks dirs
	to TCL_PACKAGE_PATH make argument.
	* unix/tclUnixInit.c (TclpSetVariables): on macosx, add embedded
	framework dirs to tcl_pkgPath: @@executable_path/../Frameworks and
	@@executable_path/../PrivateFrameworks (if they exist), as well as
	the dirs in DYLD_FRAMEWORK_PATH (if set). [Patch #624509]
	use standard MAXPATHLEN instead of literal 1024

2002-10-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/StringObj.3, doc/Object.3: Documented that Tcl_Obj's
	standard string form is a modified UTF-8; apparently, this was not
	mentioned anywhere in the main docs, and lead to [Bug 624919].

2002-10-21  Daniel Steffen  <das@@users.sourceforge.net>

	* macosx/Tcl.pbproj/project.pbxproj: bumped version to 8.4.1
	* generic/tcl.h: Added reminder comment to edit
	macosx/Tcl.pbproj/project.pbxproj when version number changes.
d6 1
a6 1
2002-10-18  Jeff Hobbs  <jeffh@@ActiveState.com>
d8 10
a17 6
	* library/reg/pkgIndex.tcl:
	* win/configure:
	* win/configure.in:
	* win/Makefile.in:
	* win/makefile.vc:
	* win/makefile.bc:    Updated to reg1.1
d19 2
a20 3
	* doc/registry.n:      Added support for broadcasting changes to
	* tests/registry.test: the registry Environment. Noted proper code
	* win/tclWinReg.c:     in the docs. [Patch #625453]
d22 11
a32 1
	* unix/Makefile.in (dist): add any mac/tcl*.sea.hqx files
d34 1
a34 1
2002-10-17  Don Porter  <dgp@@users.sourceforge.net>
d36 7
a42 2
	* generic/tclVar.c:	Fixed code that check for proper # of args to
	* tests/var.test:	[array names].  Added test.  [Bug 624755]
d44 1
a44 1
2002-10-16  Jeff Hobbs  <jeffh@@ActiveState.com>
d46 2
a47 2
	* win/configure:                 add workaround for cygwin windres
	* win/tcl.m4 (SC_CONFIG_CFLAGS): problem. [Patch #624010] (howell)
d49 1
a49 1
2002-10-15  Jeff Hobbs  <jeffh@@ActiveState.com>
d51 2
a52 1
	* README: added archives.tcl.tk note
d54 1
a54 3
	* unix/configure:
	* unix/tcl.m4: Correct AIX-5 ppc build flags.
	Correct HP 11 64-bit gcc building. [Patch #601051] (martin)
d56 3
a58 1
2002-10-15  Vince Darley  <vincentdarley@@users.sourceforge.net>
d60 1
a60 3
	* generic/tclCmdMZ.c:
	* tests/trace.test: applied patch from Hemang Levana to fix
	[Bug #615043] in execution traces with idle tasks firing.
d62 3
a64 1
2002-10-14  Jeff Hobbs  <jeffh@@ActiveState.com>
d66 1
a66 2
	* generic/tclEnv.c (Tcl_PutEnv): correct possible mem leak.
	[Patch #623269] (brouwers)
d68 45
a112 1
2002-10-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d114 1
a114 3
	* generic/tcl.h: Need a different strategy through the maze of
	#defines to let people building with Cygwin build correctly.  Also
	made some comments less misleading...
d116 39
a154 1
2002-10-10  Jeff Hobbs  <jeffh@@ActiveState.com>
d156 1
a156 1
	* README: fixed minor nits [Bug #607776] (virden)
d159 31
a189 2
	* win/tcl.m4: enable USE_THREAD_ALLOC (new threaded allocator) by
	default in cygwin configure on Windows.
d191 2
a192 1
2002-10-10  Don Porter  <dgp@@users.sourceforge.net>
d194 1
a194 4
	* doc/Tcl.n:	Clarified that namespace separators are legal in
			the variable names during $-subtitution. [Bug 615139]
	
	* doc/regexp.n:	Typo correction.  Thanks Ronnie Brunner. [Bug 606826]
d196 5
a200 1
2002-10-10  Vince Darley  <vincentdarley@@users.sourceforge.net>
d202 1
a202 11
	* unix/tclLoadAout.c
	* unix/tclLoadDl.c
	* unix/tclLoadDld.c
	* unix/tclLoadDyld.c
	* unix/tclLoadNext.c
	* unix/tclLoadOSF.c
	* unix/tclLoadShl.c
	* win/tclWinLoad.c: allow either full paths or simply dll names
	to be specified when loading files (the latter will be looked
	up by the OS on your PATH/LD_LIBRARY_PATH as appropriate).
	Fixes [Bug 611108]
d204 7
a210 1
2002-10-09  Jeff Hobbs  <jeffh@@ActiveState.com>
d212 1
a212 6
	* unix/README: doc'ed --enable-symbols options.
	* unix/Makefile.in: removed @@MEM_DEBUG_FLAGS@@ subst.
	* unix/configure: regen
	* unix/configure.in: removed SC_ENABLE_MEMDEBUG call
	* unix/tcl.m4: replaced SC_ENABLE_MEMDEBUG with a more intelligent
	SC_ENABLE_SYMBOLS that takes yes|no|mem|compile|all as options now.
d214 12
a225 1
2002-10-09  Kevin B. Kenny  <kennykb@@acm.org>
d227 1
a227 4
	* win/tclWinTime.c: Added code to set an exit handler that
	terminates the thread that calibrates the performance counter, so
	that the thread won't outlive unloading the Tcl DLL. [Tcl bug
	620735].
d229 3
a231 1
2002-10-09  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d233 1
a233 1
	* doc/binary.n: More clarification of [binary scan]'s behaviour.
d235 11
a245 1
2002-10-09  Daniel Steffen  <das@@users.sourceforge.net>
d247 1
a247 1
	* generic/tclIntDecls.h: fixed botched regen.
d249 3
a251 1
2002-10-09  Daniel Steffen  <das@@users.sourceforge.net>
d253 1
a253 5
	* generic/tclInt.decls: made TclSetPreInitScript() declaration
	generic as it is used on mac & aqua as well.
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c: regen.
	* generic/tclCompile.h: added prototype for TclCompileVariableCmd.
d255 3
a257 6
	* mac/tclMacPort.h: removed incorrect <fcntl.h> definitions
	and obsolete <stat.h> definitions.
	* mac/tclMacChan.c: removed obsolete GetOpenMode() and replaced 
	associated constants with the <fcntl.h> analogues (they existing
	defs were inconsistent with <fcntl.h> which was causing havoc when
	Tcl_GetOpenMode was used instead of private GetOpenMode).
d259 1
a259 2
	* mac/tclMacFCmd.c: removed GenerateUniqueName(), use equivalent
	(and identiaclly named) routine from MoreFiles instead.
d261 21
a281 1
	* mac/tclMacLoad.c: CONSTification, fixes to Vince's last changes.
d283 1
a283 3
	* mac/tclMacFile.c: 
	* mac/tclMacTest.c:
	* mac/tclMacUnix.c: CONSTification.
d285 5
a289 3
	* mac/tclMacOSA.c: CONSTificcation, sprintf fixes, UH 3.4.x changes;
	fix for missing autoname token from TclOSACompileCmd. (bdesgraupes)
	* mac/AppleScript.html(AppleScript delete): doc fix. (bdesgraupes)
d291 1
a291 3
	* mac/tcltkMacBuildSupport.sea.hqx: updated MoreFiles to 1.5.3, 
	updated build instructions for 8.4.
	* mac/tclMacProjects.sea.hqx: rebuilt archive.
d293 31
a323 1
2002-10-09  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d325 1
a325 2
	* doc/Alloc.3: Added a note to mention that attempting to allocate
	a zero-length block can return NULL.  [Tk bug 619544]
d327 5
a331 1
2002-10-04  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d333 1
a333 1
	* doc/binary.n: Doc improvements [Patch 616480]
d335 27
a361 3
	* tests/fCmd.test, tests/winFCmd.test:
	* tools/eolFix.tcl, tools/genStubs.tcl: [file exist] -> [file exists]
	Thanks to David Welton.
d363 1
a363 1
2002-10-03  Don Porter  <dgp@@users.sourceforge.net>
d365 10
a374 1
	* doc/tcltest.n: fixed typo [Bug 618018].  Thanks to "JJM".
d376 1
a376 1
2002-10-03  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d378 35
a412 5
	* tools/man2help2.tcl: 
	* tests/http.test, tests/httpd, tests/httpold.test: 
	* tests/env.test, tests/binary.test, tests/autoMkindex.test: 
	* library/init.tcl, library/http/http.tcl: [info exist] should
	really be [info exists].  [Bug 602566]
d414 1
a414 2
	* doc/lsearch.n: Better specification of what happens when -sorted
	is mixed with other options. [Bug 617816]
d416 4
a419 1
2002-10-01  Jeff Hobbs  <jeffh@@ActiveState.com>
d421 1
a421 3
	* generic/tclProc.c (TclCreateProc): mask out VAR_UNDEFINED for
	precompiled locals to support 8.3 precompiled code.
	(Tcl_ProcObjCmd): correct 2002-09-26 fix to look for tclProcBodyType.
d423 4
a426 1
2002-10-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d428 1
a428 2
	* doc/socket.n: Mentioned that ports may be specified as serivce
	names as well as integers. [Bug 616843]
d430 9
a438 1
2002-09-30  Jeff Hobbs  <jeffh@@ActiveState.com>
d440 1
a440 3
	* generic/tclCompCmds.c (TclCompileRegexpCmd): correct the
	checking for bad re's that didn't terminate the re string.
	Resultant compiles were correct, but much slower than necessary.
d442 4
a445 1
2002-09-29  David Gravereaux <davygrvy@@pobox.com>
d447 1
a447 6
	* win/tclAppInit.c: Added proper exiting conditions using Win32
	console signals.  This handles the existing lack of a Ctrl+C exit
	to call exit handlers when built for thread support.  Also, properly
	handles exits from other conditions such as CTRL_CLOSE_EVENT,
	CTRL_LOGOFF_EVENT, and CTRL_SHUTDOWN_EVENT signals.  In all cases,
	exit handlers will be called.  [Bug 219355]
d449 21
a469 3
	* win/makefile.vc: Added missing tclThreadAlloc.c to the build
	rules and defines USE_THREAD_ALLOC when TCL_THREADS is defined
	to get the new behavior by default.
d471 3
a473 1
2002-09-27  Don Porter  <dgp@@users.sourceforge.net>
d475 1
a475 6
	* README:		Bumped to version 8.4.1 to avoid confusion
	* generic/tcl.h:	of CVS snapshots with the actual 8.4.0
	* tools/tcl.wse.in:	release.
	* unix/configure.in:
	* unix/tcl.spec:
	* win/configure.in:
d477 2
a478 1
	* unix/configure:	autoconf
d480 8
d489 1
a489 1
2002-09-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d491 13
a503 2
	* unix/configure: regen.
	* unix/tcl.m4: improve AIX-4/5 64bit compilation support.
d505 1
a505 2
	* generic/tclProc.c (Tcl_ProcObjCmd): correct overeager
	optimization of noop proc to handle the precompiled case. (sofer)
d507 23
a529 2
	* unix/ldAix (nmopts): add -X32_64 to make it work for 32 or 64bit
	mode compilation.
d531 1
a531 2
	* library/encoding/koi8-u.enc: removed extraneous spaces that
	confused encoding reader. [Bug #615115]
d533 5
a537 2
	* unix/Makefile.in: generate source dists with -src designator and
	do not generate .Z anymore (just .gz and .zip).
d539 1
a539 1
2002-09-18  Mumit Khan <khan@@nanotech.wisc.edu>
d541 3
a543 1
	Added basic Cygwin support.
d545 1
a545 10
	* win/tcl.m4 (SC_PATH_TCLCONFIG): Support one-tree build.
	(SC_PATH_TKCONFIG): Likewise.
	(SC_PROG_TCLSH): Likewise.
	(SC_CONFIG_CFLAGS): Assume real Cygwin port and remove -mno-cygwin 
	flags.  Add -mwin32 to extra_cflags and extra_ldflags.
	Remove ``-e _WinMain@@16'' from LDFLAGS_WINDOW.
	* win/configure.in: Allow Cygwin build.
	(SEH test): Define to be 1 instead of empty value.
	(EXCEPTION_DISPOSITION): Add test.
	* win/configure: Regenerate.
d547 6
a552 50
	* generic/tcl.h: Don't explicitly define __WIN32__ for Cygwin, let
	the user decide whether to use Windows or POSIX personality.
	(TCL_WIDE_INT_TYPE, TCL_LL_MODIFIER, struct Tcl_StatBuf): Define
	for Cygwin.
	* generic/tclEnv.c (Tcl_CygwinPutenv): putenv replacement for
	Cygwin.
	* generic/tclFileName.c (Tcl_TranslateFileName): Convert POSIX 
	to native format.
	(TclDoGlob): Likewise.
	* generic/tclPlatDecls.h (TCHAR): Define for Cygwin.
	* win/tclWinPort.h (putenv, TclpSysAlloc, TclpSysFree, 
	TclpSysRealloc): Define for Cygwin.

2002-09-26  Daniel Steffen  <das@@users.sourceforge.net>

	* macosx/Makefile: preserve environment value of INSTALL_ROOT.
	When embedding only use deployment build. Force relink before
	embedded build to ensure new linker flags are picked up.

	* macosx/Tcl.pbproj/project.pbxproj: add symbolic links to
	debug lib, stub libs and tclConfig.sh in framework toplevel.
	Configure target dependency fix. Fix to 'clean' action. Added
	private tcl headers to framework. Install tclsh symbolic link.
	Html doc build works when no installed tclsh available. Made
	html doc structure in framework more like in Apple frameworks.

2002-09-24  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tcl.m4 (SC_TCL_64BIT_FLAGS): Yet more robust 64-bit value
	detection to close [Bug 613117] on more systems.

	* generic/tclCompile.c (TclPrintSource): More CONSTifying.
	* generic/tclExecute.c (EvalStatsCmd): Object-ify to reduce
	warnings.  Thanks to 'CoderX2' on the chat for bringing this to my
	attention...

	* unix/tcl.m4: Forgot to define TCL_WIDE_INT_IS_LONG at the
	appropriate moment.  I believe this is the cause of [Bug 613117]

	* doc/lset.n: Changed 'list' to 'varName' for consistency with
	lappend documentation.  Thanks to Glenn Jackman [Bug 611719]

2002-09-22  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:  Corrected [puts -nonewline] within
	test bodies.  Thanks to Harald Kirsch.  [Bug 612786, Patch 612788]
	Also corrected reporting of body return code.  Thanks to David
	Taback [Bug 611922]
	* library/tcltest/pkgIndex.tcl: Bump to version 2.2.1.
	* tests/tcltest.test: added tests for these bugs.
d554 1
a554 1
2002-09-15  Mo DeJong  <mdejong@@users.sourceforge.net>
d556 2
a557 5
	* unix/configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Add PEEK_XCLOSEIM
	define under Linux. This is used by Tk to double
	check that an X input context is cleaned up
	before it is closed.
d559 1
a559 1
2002-09-12  David Gravereaux <davygrvy@@pobox.com>
d561 1
a561 2
	* win/coffbase.txt: Added BLT to the virtual base address
	listings table should BLT's build tools decide to use it.
d563 1
a563 1
2002-09-12  Daniel Steffen  <das@@users.sourceforge.net>
d565 1
a565 6
	* generic/tcl.h:
	* mac/tclMacApplication.r:
	* mac/tclMacLibrary.r:
	* mac/tclMacResource.r: unified use of the two equivalent 
	resource compiler header inclusion defines RC_INVOKED and
	RESOURCE_INCLUDED, now use RC_INVOKED throughout. 
d567 1
a567 1
2002-09-10  Mo DeJong  <mdejong@@users.sourceforge.net>
d569 2
a570 3
	* unix/README: Add note about building extensions
	with the same compiler Tcl was built with.
	[Tk Bug 592096]
d572 1
a572 1
2002-09-10  Daniel Steffen  <das@@users.sourceforge.net>
d574 3
a576 2
	* macosx/Tcl.pbproj/project.pbxproj: disabled building html
	documentation during embedded build.
d578 3
a580 1
2002-09-10  Daniel Steffen  <das@@users.sourceforge.net>
d582 1
a582 5
	* unix/Makefile.in: added DYLIB_INSTALL_DIR variable for macosx
	and set it to default value ${LIB_RUNTIME_DIR}
	* unix/tcl.m4 (Darwin): use DYLIB_INSTALL_DIR instead of
	LIB_RUNTIME_DIR in the -install_name argument to ld.
	* unix/configure: regen.
d584 2
a585 7
	* macosx/Tcl.pbproj/project.pbxproj:
	* macosx/Makefile: added support for building Tcl as an embedded
	framework, i.e. using an dyld install_name containing
	@@executable_path/../Frameworks via the new DYLIB_INSTALL_DIR
	unix/Makefile variable.
	
2002-09-10  Jeff Hobbs  <jeffh@@ActiveState.com>
d587 2
a588 1
	*** 8.4.0 TAGGED FOR RELEASE ***
d590 2
a591 1
2002-09-06  Don Porter  <dgp@@users.sourceforge.net>
d593 1
a593 2
	* doc/file.n:  Format correction, and clarified [file normalize]
	returns an absolute path.
d595 1
a595 1
	* doc/tcltest.n:  Added examples section, as long promised.
d597 4
a600 1
2002-09-06  Reinhard Max  <max@@suse.de>
d602 10
a611 1
	* tests/tcltest.test: Added nonRoot flag to tests 8.3, 8.4, and 8.12.
d613 3
a615 1
2002-09-05  Don Porter  <dgp@@users.sourceforge.net>
d617 6
a622 1
	* doc/tcltest.n:  Clarified phrasing.
d624 2
a625 4
	* generic/tclBasic.c (TclRenameCommand,CallCommandTraces):
	* tests/trace.test (trace-27.1): Corrected memory leak when a rename
	trace deleted the command being traced.  Test added.  Thanks to
	Hemang Lavana for the fix.  [Bug 604609]
d627 1
a627 2
	* generic/tclVar.c (TclDeleteVars):  Corrected logic for setting the
	TCL_INTERP_DESTROYED flag when calling variable traces. [Tk Bug 605121]
d629 1
a629 1
2002-09-04  Miguel Sofer  <msofer@@users.sourceforge.net>
d631 2
a632 2
	* generic/tclVar.c (DeleteArray): leak plug [Bug 604239]. Thanks
	to dkf and dgp for the long and difficult discussion in the chat.
d634 2
a635 1
2002-09-03  Jeff Hobbs  <jeffh@@ActiveState.com>
d637 1
a637 1
	* generic/tclVar.c (Tcl_UpVar2): code cleanup to not use goto
d639 2
a640 2
	* unix/configure: remove -pthread from LIBS on FreeBSD in thread
	* unix/tcl.m4:    enabled build. [Bug #602849]
d642 1
a642 1
2002-09-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d644 3
a646 4
	* generic/tclInterp.c (AliasCreate): a Tcl_Obj was leaked on error
	return from TclPreventAliasLoop.
	
2002-09-03  Daniel Steffen  <das@@users.sourceforge.net>
d648 2
a649 2
	* macosx/Tcl.pbproj/project.pbxproj: Bumped version number to
	8.4.0 and updated copyright info.
d651 3
a653 1
2002-09-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d655 2
a656 2
	* generic/tclVar.c (Tcl_UpVar2): a Tcl_Obj was being leaked on
	error return from TclGetFrame.
d658 3
a660 1
2002-09-03  Don Porter  <dgp@@users.sourceforge.net>
d662 2
a663 1
	* changes:  Updated changes for 8.4.0 release.
d665 2
a666 1
2002-09-02  Jeff Hobbs  <jeffh@@ActiveState.com>
d668 3
a670 2
	* unix/tclUnixFile.c (TclpObjLink): removed unnecessary/unfreed
	extra native char*.
d672 3
a674 2
	* unix/tclUnixChan.c (Tcl_MakeTcpClientChannel): make sure to init
	flags field of TcpState ptr to 0.
d676 3
a678 3
	* unix/configure:
	* unix/tcl.m4: added 64-bit gcc compilation support on HP-11.
	[Patch #601051] (martin)
d680 1
a680 9
	* README:		Bumped version number to 8.4.0
	* generic/tcl.h:
	* tools/tcl.wse.in:
	* unix/configure:
	* unix/configure.in:
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure:
	* win/configure.in:
d682 3
a684 3
	* generic/tclInterp.c (SlaveCreate): make sure that the memory and
	checkmem commands are initialized in non-safe slave interpreters
	when TCL_MEM_DEBUG is used. [Bug #583445]
d686 2
a687 3
	* win/tclWinConsole.c (ConsoleCloseProc): only wait on writable
	pipe if there was something to write.  This may prevent infinite
	wait on exit.
d689 1
a689 2
	* tests/exec.test: marked exec-18.1 unixOnly until the Windows
	incompatability (in the test, not the core) can be resolved.
d691 5
a695 2
	* tests/http.test (http-3.11): added close $fp that was causing an
	error on Windows because the file was not closed before deleting.
d697 1
a697 2
	* unix/tclUnixInit.c (Tcl_MacOSXGetLibraryPath): made this static
	function only appear when HAVE_CFBUNDLE is defined.
d699 2
a700 1
2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>
d702 47
a748 2
	* unix/tcl.m4: added TK_SHLIB_LD_EXTRAS analogue of existing
	TCL_SHLIB_LD_EXTRAS for linker settings only used when linking Tk.
d750 2
a751 1
	* unix/configure: regen
d753 24
a776 1
2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>
d778 1
a778 1
	*** macosx-8-4-branch merged into the mainline [tcl patch #602770] ***
d780 1
a780 1
	* generic/tcl.decls: added new macosx specific entry to stubs table.
d782 1
a782 25
	* tools/genStubs.tcl: added generation of platform guards for
	macosx. This is a little more complex than it seems, because MacOS
	X IS "unix" plus a little bit, for the purposes of Tcl. BUT
	unfortunately, Tk uses "unix" to mean X11. So added platform keys
	for macosx (the little added to "unix"), "aqua" and "x11" to
	distinguish these for Tk.
	
	* generic/tcl.h: added a #ifnded RESOURCE_INCLUDED so that tcl.h
	can be passed to the resource compiler.
	
	* generic/tcl.h:
	* generic/tclNotify.c: added a few Notifier procs, to be able to
	modify more bits of the Tcl notifier dynamically. Required to get
	Mac OS X Tk to live on top of the Tcl Unix threaded notifier.
	Changes the size of the Tcl_NotifierProcs structure, but doesn't
	move any elements around.

	* unix/tclUnixNotfy.c: moved the call to Tcl_ConditionNotify till
	AFTER we are done mucking with the pointer swap. Fixes cases where
	the thread waiting on the condition wakes & accesses the
	waitingListPtr before it gets reset, causing a hang.

	* library/auto.tcl (tcl_findLibrary): added checking the
	directories in the tcl_pkgPath for library files on macosx to
	enable support of the standard Mac OSX library locations
d784 4
a787 1
	* unix/Makefile.in:
d789 3
a791 19
	* unix/tcl.m4: added MAC_OSX_DIR.  Added PLAT_OBJS to the OBJS:
	there are some MacOS X specific files now for Tcl, and when I get
	he resource & applescript stuff ported over, and restore support
	for FindFiles, etc, there will be a few more.
	Added LD_LIBRARY_PATH_VAR configure variable to avoid having to set
	all possible LD_LIBRARY_PATH analogues on all platforms.
	LD_LIBRARY_PATH_VAR is "LD_LIBRARY_PATH" by default, "LIBPATH" on
	AIX, "SHLIB_PATH" on HPUX and "DYLD_LIBRARY_PATH" on Mac OSX.
	Added configure option to package Tcl as a framework on Mac OSX.

	* macosx/tclMacOSXBundle.c (new): support for finding Tcl extension
	packaged as 'bundles' in the standard Mac OSX library locations.

	* unix/tclUnixInit.c: added support for findig the tcl script
	library inside Tcl packaged as a framework on Mac OSX.

	* macosx/Tcl.pbproj/jingham.pbxuser (new):
	* macosx/Tcl.pbproj/project.pbxproj (new): project for Apple's
	ProjectBuilder IDE.
d793 3
a795 2
	* macosx/Makefile (new): simple makefile for building the project
	from the command line via the ProjectBuilder tool 'pbxbuild'.
a796 1
	* unix/configure:
d798 41
a838 1
	* generic/tclPlatDecls.h: regen
d840 37
a876 1
2002-08-29  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d878 3
a880 3
	* win/tclWinThrd.c (TclpFinalizeThreadData, TclWinFreeAllocCache):
	  Applied patch for bug #599428, provided by Miguel Sofer
	  <msofer@@users.sourceforge.net>.
d882 16
a897 1
2002-08-28  David Gravereaux <davygrvy@@pobox.com>
d899 1
a899 8
	* generic/tclEnv.c:
	* unix/configure.in:
	* win/tclWinPort.h:  putenv() on some systems copies the buffer
	rather than taking reference to it.  This causes memory leaks
	and is know to effect mswindows (msvcrt) and NetBSD 1.5.2 .  This
	patch tests for this behavior and turns on -DHAVE_PUTENV_THAT_COPIES=1
	when approriate.  Thanks to David Welton for assistance.
	[Bug 414910]
d901 2
a902 1
	* unix/configure: regen'd
d904 1
a904 1
2002-08-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d906 2
a907 1
	* doc/eval.n: Added mention of list command and corrected "SEE ALSO".
d909 1
a909 3
	* unix/configure.in: Cache handling of ac_cv_type_socklen_t was
	wrong. [Bug 600931] reported by John Ellson.  Fixed by putting the
	brackets where they belong.
d911 2
a912 1
2002-08-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d914 1
a914 3
	* generic/tclCompCmds.c: fix for [Bug 599788] (error in element
	name causing segfault), reported by Tom Wilkason. Fixed by copying
	the tokens instead of the source string.
d916 2
a917 1
2002-08-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d919 1
a919 4
	* generic/tclThreadAlloc.c: small optimisation, reducing the
	new allocator's overhead.
	
2002-08-23  Miguel Sofer  <msofer@@users.sourceforge.net>
d921 7
a927 2
	* generic/tclObj.c (USE_THREAD_ALLOC): fixed leak [Bug 597936]. 
	Thanks to Zoran Vasiljevic.
d929 1
a929 1
2002-08-23  Miguel Sofer  <msofer@@users.sourceforge.net>
d931 4
a934 2
	* generic/tclThreadAlloc.c (USE_THREAD_ALLOC): moving objects
	between caches as a block, instead of one-by-one.
d936 1
a936 1
2002-08-22  Miguel Sofer  <msofer@@users.sourceforge.net>
d938 9
a946 3
	* generic/tclBasic.c:
	* generic/tclCmdMZ.c: fix for freed memory r/w in delete traces
	[Bug 589863], patch by Hemang Lavana.
d948 1
a948 1
2002-08-20  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d950 12
a961 8
	* win/Makefile.in (CFLAGS): 
	* unix/Makefile.in (MEM_DEBUG_FLAGS): Added usage of @@MEM_DEBUG_FLAGS@@.
	* win/configure.in:
	* unix/configure.in: Added usage of SC_ENABLE_MEMDEBUG.
	* win/tcl.m4:
	* unix/tcl.m4: Added macro SC_ENABLE_MEMDEBUG. Allows a user of
	  configure to (de)activate memory validation and debugging
	  (TCL_MEM_DEBUG). No need to modify the makefile anymore.
d963 1
a963 1
2002-08-20  Don Porter  <dgp@@users.sourceforge.net>
d965 1
a965 1
	* generic/tclCkalloc.c:	CONSTified MemoryCmd and CheckmemCmd.
d967 2
a968 2
	* README:		Bumped version number to 8.4b3 to distinguish
	* generic/tcl.h:	HEAD from the 8.4b2 release.
d970 1
a970 1
	* unix/configure.in:
d972 9
a980 2
	* win/README.binary:
	* win/configure.in:
d982 1
a982 2
	* unix/configure:	autoconf
	* win/configure:
d984 2
a985 8
	* library/http/http.tcl:	Corrected installation directory of
	* library/msgcat/msgcat.tcl:	the package tcltest 2.2.  Added
	* library/opt/optparse.tcl:	comments in other packages to remind
	* library/tcltest/tcltest.tcl:	that installation directories need 
	* unix/Makefile.in:		updates to match increasing version
	* win/Makefile.in:		numbers. [Bug 597450]
	* win/makefile.bc:
	* win/makefile.vc:
d987 1
a987 1
2002-08-19  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d989 1
a989 2
	* unix/tclUnixTest.c (TestfilehandlerCmd): Changed
	  readable/writable to the more common readable|writable.
d991 3
a993 2
	  Fixes SF #596034 reported by Larry Virden
	  <lvirden@@users.sourceforge.net>.
d995 1
a995 12
2002-08-16  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/fCmd.test: Added test to make sure that the cause of the
	problem is detectable with an unpatched Tcl.
	* doc/ObjectType.3: Added note on the root cause of this problem
	to the documentation, since it is possible for user code to
	trigger this sort of behaviour too.
	* generic/tclIOUtil.c (SetFsPathFromAny): Objects should only have
	their old representation deleted when we know that we are about to
	install a new one.  This stops a weird TclX bug under Linux with
	certain kinds of memory debugging enabled which essentally came
	down to a double-free of a string.
d997 2
a998 1
2002-08-14  Miguel Sofer  <msofer@@users.sourceforge.net>
d1000 2
a1001 9
	* generic/tclInt.h:
	* generic/tclObj.c: (code cleanup) factored the parts in the macros 
	TclNewObj() / TclDecrRefCount() into a common part for all
	memory allocators and two new macros TclAllocObjStorage() /
	TclFreeObjStorage() that are specific to each allocator and fully
	describe the differences. Removed allocator-specific code from
	tclObj.c by using the macros.
	
2002-08-12  Miguel Sofer  <msofer@@users.sourceforge.net>
d1003 2
a1004 3
	* generic/tclCmdMZ.c: fixing UMR in delete traces, [Bug 589863].
	
2002-08-08  David Gravereaux <davygrvy@@pobox.com>
d1006 1
a1006 2
	* tools/man2help.tcl: Fixed $argv handling bug where if -bitmap
	wasn't specified $argc was off by one.
d1008 3
a1010 1
2002-08-08  Miguel Sofer  <msofer@@users.sourceforge.net>
d1012 1
a1012 2
	* tests/uplevel.test: added 6.1 to test [uplevel] with shadowed
	commands [Bug 524383]
d1014 1
a1014 1
	* tests/subst.test: added 5.8-10 as further tests for [Bug 495207] 
d1016 2
a1017 1
2002-08-08  Don Porter  <dgp@@users.sourceforge.net>
d1019 12
a1030 1
	* tests/README: Noted removal of defs.tcl.
d1032 1
a1032 1
2002-08-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d1034 2
a1035 1
	* doc/lsearch.n: corrected lsearch docs to use -inline in examples.
d1037 1
a1037 1
	*** 8.4b2 TAGGED FOR RELEASE ***
d1039 8
a1046 10
	* tests/fCmd.test:
	* tests/unixFCmd.test: updated tests for new link copy behavior.
	* generic/tclFCmd.c (CopyRenameOneFile): changed the behavior to
	follow links to endpoints and copy that file/directory instead of
	just copying the surface link.  This means that trying to copy a
	link that has no endpoint (danling link) is an error.
	[Patch #591647] (darley)
	(CopyRenameOneFile): this is currently disabled by default until
	further issues with such behavior (like relative links) can be
	handled correctly.
d1048 1
a1048 1
	* tests/README: slight wording improvements
d1050 4
a1053 1
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>
d1055 1
a1055 7
	* docs/BoolObj.3: added description of valid string reps for a
	boolean object [Bug 584794]
	* generic/tclObj.c: optimised Tcl_GetBooleanFromObj and
	SetBooleanFromAny to avoid parsing the string rep when it can be
	avoided [Bugs 584650, 472576]
	
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>
d1057 3
a1059 5
	* generic/tclCompile.h:
	* generic/tclObj.c: making tclCmdNameType static ([Bug 584567],
	Don Porter).
	
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>
d1061 1
a1061 5
	* generic/tclObj.c (Tcl_NewObj): added conditional code for
	USE_THREAD_ALLOC; objects allocated through Tcl_NewObj() were
	otherwise being leaked. [Bug 587488] reported by Sven Sass.
	
2002-08-06  Daniel Steffen  <das@@users.sourceforge.net>
d1063 5
a1067 9
	* generic/tclInt.decls:
	* unix/tclUnixThrd.c: Added stubs and implementations for
	non-threaded build for the tclUnixThrd.c procs TclpReaddir,
	TclpLocaltime, TclpGmtime and TclpInetNtoa.
	Fixes link errors in stubbed & threaded extensions that include
	tclUnixPort.h and use any of the procs readdir, localtime, 
	gmtime or inet_ntoa (e.g. TclX 8.4) [Bug 589526]
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c: Regen.
d1069 1
a1069 1
2002-08-05  Don Porter  <dgp@@users.sourceforge.net>
d1071 1
a1071 110
	* library/tcltest/tcltest.tcl:	The setup and cleanup scripts are now
	* library/tcltest/pkgIndex.tcl:	skipped when a test is skipped, fixing
	* tests/tcltest.test:		[Bug 589859].  Test for bug added, and
	corrected tcltest package bumped to version 2.2.

	* generic/tcl.decls:	Restored Tcl_Concat to return (char *).  Like
	* generic/tclDecls.h:	Tcl_Merge, it transfers ownership of a dynamic
	* generic/tclUtil.c:	allocated string to the caller.

2002-08-04  Don Porter  <dgp@@users.sourceforge.net>

	* doc/CmdCmplt.3:	Applied Patch 585105 to fully CONST-ify
	* doc/Concat.3:		all remaining public interfaces of Tcl.
	* doc/CrtCommand.3:	Notably, the parser no longer writes on 
	* doc/CrtSlave.3:	the string it is parsing, so it is no
	* doc/CrtTrace.3:	longer necessary for Tcl_Eval() to be
	* doc/Eval.3:		given a writable string.  Also, the
	* doc/ExprLong.3:	refactoring of the Tcl_*Var* routines
	* doc/LinkVar.3:	by Miguel Sofer is included, so that the
	* doc/ParseCmd.3:	"part1" argument for them no longer needs
	* doc/SetVar.3:		to be writable either.
	* doc/TraceVar.3:
	* doc/UpVar.3:		Compatibility support has been enhanced so
	* generic/tcl.decls	that a #define of USE_NON_CONST will remove
	* generic/tcl.h		all possible source incompatibilities with
	* generic/tclBasic.c	the 8.3 version of the header file(s).
	* generic/tclCmdMZ.c	The new #define of USE_COMPAT_CONST now does
	* generic/tclCompCmds.c	what USE_NON_CONST used to do -- disable
	* generic/tclCompExpr.c only those new CONST's that introduce
	* generic/tclCompile.c	irreconcilable incompatibilities.
	* generic/tclCompile.h
	* generic/tclDecls.h	Several bugs are also fixed by this patch.
	* generic/tclEnv.c	[Bugs 584051,580433] [Patches 585105,582429]
	* generic/tclEvent.c	
	* generic/tclInt.decls
	* generic/tclInt.h
	* generic/tclIntDecls.h
	* generic/tclInterp.c
	* generic/tclLink.c
	* generic/tclObj.c
	* generic/tclParse.c
	* generic/tclParseExpr.c
	* generic/tclProc.c
	* generic/tclTest.c
	* generic/tclUtf.c
	* generic/tclUtil.c
	* generic/tclVar.c
	* mac/tclMacTest.c
	* tests/expr-old.test
	* tests/parseExpr.test
	* unix/tclUnixTest.c
	* unix/tclXtTest.c
	* win/tclWinTest.c

2002-08-01  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: bugfix (reading freed memory). Testsuite
	passed on linux/i386, compile-13.1 hung on linux/alpha.

2002-08-01  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: added a reference count for the complete
	execution stack, instead of Tcl_Preserve/Tcl_Release. 

2002-08-01  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tclCkalloc.c (TclFinalizeMemorySubsystem):
	Don't lock the ckalloc mutex before invoking the
	Tcl_DumpActiveMemory function since it also
	locks the same mutex. This code is only executed
	when "memory onexit filename" has been executed
	and Tcl is compiled with -DTCL_MEM_DEBUG.

2002-08-01  Reinhard Max  <max@@suse.de>

	* win/tclWinPort.h: The windows headers don't provide socklen_t,
	so we have to do it.

2002-07-31  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInt.h (USE_THREAD_ALLOC): for unshared objects,
	TclDecrRefCount now frees the internal rep before the string rep -
	just like the non-macro Tcl_DecrRefCount/TclFreeObj [Bug 524802]. 
	For the other allocators the fix was done on 2002-03-06.

2002-07-31  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInterp.c: signed/unsigned comparison warning fixed
	(Vince Darley).

2002-07-31  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tcl.m4 (SC_BUGGY_STRTOD): Enabled caching of test results.

	* unix/tcl.m4 (SC_BUGGY_STRTOD): Solaris 2.8 still has a buggy
	strtod() implementation; make sure we detect it.

	* tests/expr.test (expr-22.*): Marked as non-portable because it
	seems that these tests have an annoying tendency to fail in
	unexpected ways.  [Bugs 584825, 584950, 585986]

2002-07-30  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tests/io.test: 
	* generic/tclIO.c (WriteChars): Added flag to break out of loop if
	  nothing of the input is consumed at all, to prevent infinite
	  looping of called with a non-UTF-8 string. Fixes Bug 584603
	  (partially). Added new test "io-60.1". Might need additional
	  changes to Tcl_Main so that unprintable results are printed as
	  binary data.
d1073 2
a1074 1
2002-07-29  Mo DeJong  <mdejong@@users.sourceforge.net>
d1076 1
a1076 8
	* unix/Makefile.in: Use CC_SEARCH_FLAGS instead of
	LD_SEARCH_FLAGS when linking with ${CC}.
	* unix/configure: Regen.
	* unix/configure.in: Don't subst CC_SEARCH_FLAGS or
	LD_SEARCH_FLAGS since this is now done in tcl.m4.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Document and
	set CC_SEARCH_FLAGS whenever LD_SEARCH_FLAGS is set.
	[Tcl patch 588290]
d1078 7
a1084 1
2002-07-29  Reinhard Max  <max@@suse.de>
d1086 1
a1086 6
	* unix/tcl.m4 (SC_SERIAL_PORT): Fixed detection for cases when
                                        configure's stdin is not a tty.
	
	* unix/tclUnixPort.h: 
	* generic/tclIOSock.c:          Changed size_t to socklen_t in
                                        socket-related function calls.
d1088 16
a1103 4
	* unix/configure.in:            Added test and fallback definition
                                        for socklen_t.
	
	* unix/configure:               generated.
d1105 1
a1105 1
2002-07-29  Miguel Sofer  <msofer@@users.sourceforge.net>
d1107 5
a1111 1
	* generic/tclObj.c: fixed a comment
d1113 1
a1113 19
	* generic/tcl.h: 
	* generic/tclBasic.c: 
	* generic/tclInterp.c: added the new flag TCL_EVAL_INVOKE to
	the interface of the Tcl_Eval* functions, removing the
	TCL_EVAL_NO_TRACEBACK added yesterday: alias invocations not only 
	require no tracebacks, but also look up the command name in the
	global scope - see new test interp-9.4
	* tests/interp.test: added 9.3 to test for safety of aliases to
	hidden commands, 9.4 to test for correct command lookup scope.

2002-07-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/regc_locale.c (cclass): [[:xdigit:]] is only a defined
	concept on western characters, so should not allow any unicode
	digit, and hence number of ranges in [[:xdigit:]] is fixed.
	* tests/reg.test: Added test to detect the bug.
	* generic/regc_cvec.c (newcvec): Corrected initial size value in
	character vector structure.  [Bug 578363]  Many thanks to
	pvgoran@@users.sf.net for tracking this down.
d1115 4
a1118 1
2002-07-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d1120 1
a1120 37
	* generic/tcl.h: 
	* generic/tclBasic.c: added the new flag TCL_EVAL_NO_TRACEBACK to
	the interface of the Tcl_Eval* functions. Modified the error
	message for too many nested evaluations.
	* generic/tclInterp.h: changed the Alias struct to be of variable
	length and store the prefix arguments directly (instead of a
	pointer to a Tcl_Obj list). Made AliasObjCmd call Tcl_EvalObjv
	instead of TclObjInvoke - thus making aliases trigger execution
	traces [Bug 582522].
	* tests/interp.test:
	* tests/stack.test: adapted to the new error message.
	* tests/trace.test: added tests for aliases firing the exec
	traces. 

2002-07-27  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Revert fix for Tcl bug 529801
	since it was incorrect and broke the build on
	other systems. Fix Tcl bug 587299.
	Add MAJOR_VERSION, MINOR_VERSION, PATCH_LEVEL,
	SHLIB_LD_FLAGS, SHLIB_LD_LIBS, CC_SEARCH_FLAGS,
	LD_SEARCH_FLAGS, and LIB_FILE variables to support
	more generic library build/install rules.
	* unix/configure: Regen.
	* unix/configure.in: Move AC_PROG_RANLIB into
	tcl.m4. Move shared build test and setting
	of MAKE_LIB and MAKE_STUB_LIB into tcl.m4.
	Move subst of a number of variables into
	tcl.m4 where they are defined.
	* unix/tcl.m4 (SC_ENABLE_SYMBOLS, SC_CONFIG_CFLAGS):
	Subst vars where they are defined. Add MAKE_LIB,
	MAKE_STUB_LIB, INSTALL_LIB, and INSTALL_STUB_LIB
	rules to deal with the ugly details of running
	ranlib on static libs at build and install time.
	Replace TCL_SHLIB_LD_EXTRAS with SHLIB_LD_FLAGS
	and use it when building a shared library.
	* unix/tclConfig.sh.in: Add TCL_CC_SEARCH_FLAGS.
d1122 2
a1123 1
2002-07-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d1125 2
a1126 4
	* generic/tclExecute.c: fixed Tcl_Obj leak in code corresponding
	to the macro NEXT_INST_V(x, 0, 1) [Bug 587495].
	
2002-07-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d1128 24
a1151 2
	* generic/tclVar.c (TclObjLookupVar): leak fix and improved
	comments. 
d1153 1
a1153 1
2002-07-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d1155 2
a1156 3
	* generic/tclVar.c (TclLookupVar): removed early returns that
	prevented the parens from being restored. also removed goto label
	as it was not necessary.
d1158 3
a1160 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d1162 1
a1162 3
	* generic/tclExecute.c: 
	* tests/expr-old.test: fix for erroneous error messages in [expr],
	[Bug  587140] reported by Martin Lemburg.
d1164 1
a1164 3
2002-07-25  Joe English  <jenglish@@users.sourceforge.net>
	* generic/tclProc.c: fix for Tk Bug #219218 "error handling 
	with bgerror in Tk"
d1166 1
a1166 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d1168 2
a1169 2
	* generic/tclExecute.c: restoring full TCL_COMPILE_DEBUG
	functionality.
d1171 1
a1171 1
2002-07-24  Don Porter  <dgp@@users.sourceforge.net>
d1173 5
a1177 2
	* tests/unixInit.test: relaxed unixInit-3.1 to accept iso8859-15
	as a valid C encoding.  [Bug 575336]
d1179 1
a1179 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d1181 2
a1182 4
	* generic/tclExecute.c: restoring the tcl_traceCompile
	functionality while I repair tcl_traceExec. The core now compiles
	and runs also under TCL_COMPILE_DEBUG, but execution in the
	bytecode engine can still not be traced.
d1184 5
a1188 1
2002-07-24  Daniel Steffen  <das@@users.sourceforge.net>
d1190 2
a1191 6
	* unix/Makefile.in:
	* unix/configure.in: corrected fix for [Bug 529801]: ranlib
	only needed for static builds on Mac OS X.
	* unix/configure: Regen.
	* unix/tclLoadDyld.c: fixed small bugs introduced by Vince,
	implemented library unloading correctly (needs OS X 10.2).
d1193 1
a1193 1
2002-07-23  Joe English  <jenglish@@users.sourceforge.net>
d1195 8
a1202 6
	* doc/OpenFileChnl.3: (Updates from Larry Virden)
	* doc/open.n:
	* doc/tclsh.1: Fix section numbers in Unix man page references.
	* doc/lset.n:  In EXAMPLES section, include command to set the 
	initial value used in subsequent examples.
	* doc/http.n: Package version updated to 2.4.
d1204 1
a1204 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d1206 2
a1207 4
	* unix/configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Enable 64 bit compilation
	when using the native compiler on a 64 bit version of IRIX.
	[Tcl bug 219220]
d1209 1
a1209 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d1211 4
a1214 2
	* unix/Makefile.in: Combine ranlib tests and
	avoid printing unless ranlib is actually run.
d1216 1
a1216 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d1218 2
a1219 3
	* unix/tcl.m4 (SC_PATH_X): Set XINCLUDES to "" instead
	of "# no special path needed" or "# no include files found"
	when x headers cannot be located.
d1221 3
a1223 1
2002-07-22  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1225 4
a1228 14
	* generic/tclIOUtil.c: made tclNativeFilesystem static
	(since 07-19 changes removed its usage elsewhere), and
	added comments about its usage.
	* generic/tclLoad.c:
	* generic/tcl.h:
	* generic/tcl.decls: 
	* doc/FileSystem.3: converted last load-related ClientData
	parameter to Tcl_LoadHandle opaque structure, removing a 
	couple of casts in the process.
	
	* generic/tclInt.h: removed tclNativeFilesystem declaration
	since it is now static again.
	
2002-07-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d1230 3
a1232 6
	* tests/expr.test (expr-22.*): Added tests to help detect the
	corrected handling.
	* generic/tclExecute.c (IllegalExprOperandType): Improved error
	message generated when attempting to manipulate Inf and NaN values.
	* generic/tclParseExpr.c (GetLexeme): Allowed parser to recognise
	'Inf' as a floating-point number. [Bug 218000]
d1234 3
a1236 1
2002-07-21  Don Porter  <dgp@@users.sourceforge.net>
d1238 3
a1240 1
	* tclIOUtil.c: Silence compiler warning. [Bug 584408].
d1242 1
a1242 1
2002-07-19  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1244 2
a1245 4
	* generic/tclIOUtil.c: fix to GetFilesystemRecord
	* win/tclWinFile.c:
	* unix/tclUnixFile.c: fix to subtle problem with links shown
	up by latest tclkit builds.
d1247 5
a1251 1
2002-07-19  Mo DeJong  <mdejong@@users.sourceforge.net>
d1253 3
a1255 32
	* unix/configure:
	* unix/configure.in:
	* win/configure:
	* win/configure.in: Add AC_PREREQ(2.13) in an attempt
	to make it more clear that the configure scripts
	must be generated with autoconf version 2.13.
	[Bug 583573]

2002-07-19  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* unix/Makefile.in: fix to build on MacOS X [Bug 529801], bug
	report and fix from jcw.

2002-07-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* win/tclWinSerial.c (no_timeout): Made this variable static.

	* generic/tclExecute.c, generic/tclCompile.c, generic/tclBasic.c: 
	* generic/tclCompile.h (builtinFuncTable, instructionTable): Added
	prefix to these symbols because they are visible outside the Tcl
	library.

	* generic/tclCompExpr.c (operatorTable): 
	* unix/tclUnixTime.c (tmKey):
	* generic/tclIOUtil.c (theFilesystemEpoch, filesystemWantToModify,
	filesystemIteratorsInProgress, filesystemOkToModify): Made these
	variables static.

	* unix/tclUnixFile.c:		Renamed nativeFilesystem to
	* win/tclWinFile.c:		tclNativeFilesystem and declared
	* generic/tclIOUtil.c:		it properly in tclInt.h
	* generic/tclInt.h: 
d1257 1
a1257 1
	* generic/tclUtf.c (totalBytes): Made this array static and const.
d1259 2
a1260 3
	* generic/tclParse.c (typeTable): Made this array static and const.
	(Tcl_ParseBraces): Simplified error handling case so that scans
	are only performed when needed, and flags are simpler too.
d1262 2
a1263 2
	* license.terms: Added AS to list of copyright holders; it's only
	fair for the current gatekeepers to be listed here!
d1265 3
a1267 3
	* tests/cmdMZ.test: Renamed constraint for clarity. [Bug#583427]
	Added tests for the [time] command, which was previously only
	indirectly tested!
d1269 1
a1269 1
2002-07-18  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1271 5
a1275 4
	* generic/tclInt.h:
	* generic/tcl.h:
	* */*Load*.c: added comments on changes of 07/17 and 
	replaced clientData with Tcl_LoadHandle in all locations.
d1277 1
a1277 11
	* generic/tclFCmd.c:
	* tests/fileSystem.test: fixed a 'knownBug' with 'file
	attributes ""'
	* tests/winFCmd.test: 
	* tests/winPipe.test:
	* tests/fCmd.test:
	* tessts/winFile.test: added 'pcOnly' constraint to some
	tests to make for more useful 'tests skipped' log from 
	running all tests on non-Windows platforms.
	
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d1279 5
a1283 3
	* generic/tclBasic.c (CallCommandTraces): delete traces now
	receive the FQ old name of the command. 
	[Bug 582532] (Don Porter)
d1285 1
a1285 1
2002-07-18  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1287 7
a1293 4
	* tests/ioUtil.test: added constraints to 1.4,2.4 so they
	don't run outside of tcltest. [Bugs 583276,583277]
	
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d1295 1
a1295 2
	* generic/tclVar.c (DupParsedVarName): nasty bug fixed, reported
	by Vince Darley.
d1297 2
a1298 1
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d1300 2
a1301 5
	* generic/tclVar.c (TclPtrIncrVar): missing CONST in declarations,
	inconsistent with tclInt.h. Thanks to Vince Darley for reporting,
	boo to gcc for not complaining.
	
2002-07-17  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1303 2
a1304 21
	* generic/tclInt.h:
	* generic/tclIOUtil.c:
	* generic/tclLoadNone.c:
	* unix/tclLoadAout.c:
	* unix/tclLoadDl.c:
	* unix/tclLoadDld.c:
	* unix/tclLoadDyld.c:
	* unix/tclLoadNext.c:
	* unix/tclLoadOSF.c:
	* unix/tclLoadShl.c:
	* mac/tclMacLoad.c:
	* win/tclWinLoad.c: modified to move more functionality
	to the generic code and avoid duplication.  Partial replacement
	of internal uses of clientData with opaque Tcl_LoadHandle.  A
	little further work still needed, but significant changes are done.

2002-07-17  D. Richard Hipp    <drh@@hwaci.com>

	* library/msgcat/msgcat.tcl: fix a comment that was causing
	problems for programs (ex: mktclapp) that embed the initialization
	scripts in strings.
d1306 3
a1308 1
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d1310 2
a1311 23
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c: removing the now redundant functions to access
	indexed variables: Tcl(Get|Set|Incr)IndexedScalar() and
	Tcl(Get|Set|Incr)ElementOfIndexedArray(). 

2002-07-17  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclExecute.c (TclExecuteByteCode): Minor fixes to make
	this file compile with SunPro CC...

2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: modified to do variable lookup explicitly,
	and then either inlining the variable access or else calling the new
	TclPtr(Set|Get|Incr)Var functions in tclVar.c
	* generic/tclInt.h: declare some functions previously local to
	tclVar.c for usage by TEBC.
	* generic/tclVar.c: removed local declarations; moved all special
	accessor functions for indexed variables to the end of the file -
	they are unused and ready for removal, but left there for the time
	being as they are in the internal stubs table.
d1313 3
a1315 4
	** WARNING FOR BYTECODE MAINTAINERS **
	TCL_COMPILE_DEBUG is currently not functional; will be fixed ASAP.
	
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d1317 3
a1319 3
	* unix/Makefile.in:
	* win/Makefile.in: Add a more descriptive warning
	in the event `make genstubs` needs to be rerun.
d1321 1
a1321 1
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d1323 1
a1323 6
	* unix/Makefile.in: Use dltest.marker file
	to keep track of when the dltest package
	is up to date. This fixes [Tcl bug 575768]
	since tcltest is no longer linked every time.
	* unix/dltest/Makefile.in: Create ../dltest.marker
	after a successful `make all` run in dltest.
d1325 2
a1326 1
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d1328 4
a1331 2
	* unix/configure: Regen.
	* unix/configure.in: Remove useless subst of TCL_BIN_DIR.
d1333 1
a1333 1
2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d1335 2
a1336 3
	* generic/tclVar.c: inaccurate comment fixed
	
2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d1338 2
a1339 24
	* generic/tclBasic.c (Tcl_AddObjErrorInfo):
	* generic/tclExecute.c (TclUpdateReturnInfo):
	* generic/tclInt.h:	
	* generic/tclProc.c: 
	Added two Tcl_Obj to the ExecEnv structure to hold the fully
	qualified names "::errorInfo" and "::errorCode" to cache the
	addresses of the corresponding variables. The two most frequent
	setters of these variables now profit from the new variable name
	caching. 

2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclVar.c: refactorisation to reuse already looked-up Var
	pointers; definition of three new Tcl_Obj types to cache variable
	name parsing and lookup for later reuse; modification of internal
	functions to profit from the caching. 
	
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclNamesp.c: adding CONST qualifiers to variable names
	passed to Tcl_FindNamespaceVar and to variable resolvers; adding
	CONST qualifier to the 'msg' argument to TclLookupVar. Needed to
	avoid code duplication in the new tclVar.c code.
d1341 1
a1341 3
	* tests/set-old.test:
	* tests/var.test: slight modification of error messages due to the
	modifications in the tclVar.c code.
d1343 1
a1343 1
2002-07-15  Don Porter  <dgp@@users.sourceforge.net>
d1345 3
a1347 2
	* tests/unixInit.test:	Improved constraints to protect /tmp.	
	  [Bug 581403]
d1349 1
a1349 1
2002-07-15  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1351 3
a1353 10
	* tests/winFCmd.test: renamed 'win2000' and 'notWin2000' to
	more appropriate constraint names.
	* win/tclWinFile.c: updated comments to reflect 07-11 changes.
	* win/tclWinFCmd.c: made ConvertFileNameFormat static again,
	since no longer used in tclWinFile.c
	* mac/tclMacFile.c: completed TclpObjLink implementation which
	was previously lacking.
	* generic/tclIOUtil.c: comment cleanup and code speedup.
	
2002-07-14  Don Porter  <dgp@@users.sourceforge.net>
d1355 2
a1356 5
	* generic/tclInt.h:	Removed declarations that duplicated entries
	  in the (internal) stub table.
	
	* library/tcltest/tcltest.tcl:  Corrected errors in handling of
	  configuration options -constraints and -limitconstraints.
d1358 8
a1365 7
	* README:		Bumped HEAD to version 8.4b2 so we can
	* generic/tcl.h:	distinguish it from the 8.4b1 release.
	* tools/tcl.wse.in:
	* unix/configure*:
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure*:
d1367 1
a1367 1
2002-07-11  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1369 2
a1370 6
	* doc/file.n:
	* win/tclWinFile.c: on Win 95/98/ME the long form of the path
	is used as a normalized form.  This is required because short
	forms are not a robust representation.  The file normalization
	function has been sped up, but more performance gains might be
	possible, if speed is still an issue on these platforms.
d1372 5
a1376 1
2002-07-11  Don Porter  <dgp@@users.sourceforge.net>
d1378 2
a1379 2
	* library/tcltest/tcltest.tcl: Corrected reaction to existing but
	false ::tcl_interactive.
d1381 4
a1384 1
	* doc/Hash.3: Overlooked CONST documentation update.
d1386 1
a1386 1
2002-07-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d1388 3
a1390 3
	* generic/tclCkalloc.c: ckalloc() and friends take the block size
	as an unsigned, so we should use %ud when reporting it in fprintf()
	and panic().
d1392 2
a1393 1
2002-07-11  Miguel Sofer  <msofer@@users.sourceforge.net>
d1395 1
a1395 4
	* generic/tclCompile.c: now setting local vars undefined at
	compile time, instead of waiting until the proc is initialized. 
	* generic/tclProc.c: use macro TclSetVarUndefined instead of
	directly etting the flag.
d1397 10
a1406 1
2002-07-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d1408 1
a1408 2
	* tests/cmdAH.test: [file attr -perm] is Unix-only, so add [catch]
	when not inside a suitably-protected test.
d1410 1
a1410 1
2002-07-10  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d1412 4
a1415 4
	* tests/unixFCmd.test, tests/fileName.test: 
	* tests/fCmd.test: Removed [exec] of Unix utilities that have
	equivalents in standard Tcl.  [Bug 579268]  Also simplified some
	of unixFCmd.test while I was at it.
d1417 2
a1418 1
2002-07-10  Don Porter  <dgp@@users.sourceforge.net>
d1420 1
a1420 4
	* tests/tcltest.test:  Greatly reduced the number of [exec]s, using
	slave interps instead.
	* library/tcltest/tcltest.tcl:  Fixed bug uncovered in the conversion
	where a message was written to stdout instead of [outputChannel].
d1422 2
a1423 15
	* tests/basic.test:	Cleaned up, constrained, and reduced the
	* tests/compile.test:	amount of [exec] usage in the test suite.
	* tests/encoding.test:
	* tests/env.test:
	* tests/event.test:
	* tests/exec.test:
	* tests/io.test:
	* tests/ioCmd.test:
	* tests/regexp.test:
	* tests/regexpComp.test:
	* tests/socket.test:
	* tests/tcltest.test:
	* tests/unixInit.test:
	* tests/winDde.test:
	* tests/winPipe.test:
d1425 3
a1427 1
2002-07-10  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d1429 1
a1429 1
	* tests/cmdAH.test: Removed [exec] of Unix utilities. [Bug 579211]
d1431 3
a1433 3
	* tests/expr.test: Added tests to make sure that this works.
	* generic/tclExecute.c (ExprCallMathFunc): Functions should also
	be able to return wide-ints.  [Bug 579284]
d1435 1
a1435 1
2002-07-08  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d1437 7
a1443 4
	* tests/socket.test: Fixed bug #578164. The original reason for
	  the was a DNS outage while running the testsuite. Changed [info
	  hostname] to 127.0.0.1 to bypass DNS, knowing that we operate on
	  the local host.
d1445 1
a1445 1
2002-07-08  Don Porter  <dgp@@users.sourceforge.net>
d1447 3
a1449 3
	* doc/tcltest.n:		Fixed incompatibility in [viewFile].
	* library/tcltest/tcltest.tcl:	Corrected docs.  Bumped to 2.2.1.
	* library/tcltest/pkgIndex.tcl: [Bug 578163]
d1451 3
a1453 1
2002-07-08  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1455 1
a1455 59
	* tests/cmdAH.test:
	* tests/fCmd.test:
	* tests/fileName.test: tests which rely on 'file link' need a
	constraint so they don't run on older Windows OS. [Bug 578158]
	* generic/tclIOUtil.c:
	* generic/tcl.h:
	* generic/tclInt.h:
	* generic/tclTest.c:
	* mac/tclMacChan.c:
	* unix/tclUnixChan.c:
	* win/tclWinChan.c:
	* doc/FileSystem.3: cleaned up internal handling of
	Tcl_FSOpenFileChannel to remove duplicate code, and make
	writing external vfs's clearer and easier.  No
	functionality change.  Also clarify that objects with refCount
	zero should not be passed in to the Tcl_FS API, and prevent
	segfaults from occuring on such user errors. [Bug 578617]
	
2002-07-06  Don Porter  <dgp@@users.sourceforge.net>

	* tests/pkgMkIndex.test:  Constrained tests of [load] package indexing
	to those platforms where the testing shared libraries have been built.
	[Bug 578166].

2002-07-05  Don Porter  <dgp@@users.sourceforge.net>
	* changes: added recent changes

2002-07-05  Reinhard Max  <max@@suse.de>

	* generic/tclClock.c (FormatClock): Convert the format string to
	UTF8 before calling TclpStrftime, so that non-ASCII characters
	don't get mangled when the result string is being converted back.
	* tests/clock.test: Added a test for that.

2002-07-05  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/Makefile.in (ro-test,ddd,GDB,DDD): Created new targets to
	allow running the test suite with a read-only current directory,
	running under ddd instead of gdb, and factored out some executable
	names for broken sites (like mine) where gdb and ddd are installed
	with non-standard names...

	* tests/httpold.test: Altered test names to httpold-* to avoid
	clashes with http.test, and stopped tests from failing when the
	current directory is not writable...

	* tests/event.test:		Stop these tests from failing
	* tests/ioUtil.test:		when the current directory is
	* tests/regexp.test:		not writable...
	* tests/regexpComp.test: 
	* tests/source.test: 
	* tests/unixFile.test: 
	* tests/unixNotfy.test: 

	* tests/unixFCmd.test:		Trying to make these test-files
	* tests/macFCmd.test:		not bomb out with an error when
	* tests/http.test:		the current directory is not
	* tests/fileName.test:		writable...
	* tests/env.test:
d1457 5
a1461 1
2002-07-05  Jeff Hobbs  <jeffh@@ActiveState.com>
d1463 1
a1463 1
	*** 8.4b1 TAGGED FOR RELEASE ***
d1465 9
a1473 1
2002-07-04  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d1475 4
a1478 3
	* tests/cmdMZ.test (cmdMZ-1.4): 
	* tests/cmdAH.test: More fixing of writable-current-dir
	assumption. [Bug 575824]
d1480 5
a1484 1
2002-07-04  Miguel Sofer  <msofer@@users.sourceforge.net>
d1486 1
a1486 3
	* tests/basic.test: Same issue as below; fixed [Bug 575817]
	
2002-07-04  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d1488 6
a1493 4
	* tests/socket.test: 
	* tests/winPipe.test: 
	* tests/pid.test: Fixed SF Bug #575848. See below for a
	  description the general problem.
d1495 1
a1495 2
	* All the bugs below are instances of the same problem: The
	  testsuite assumes [pwd] = [temporaryDirectory] and writable.
d1497 5
a1501 4
	* tests/iogt.test: Fixed bug #575860.
	* tests/io.test:   Fixed bug #575862.
	* tests/exec.test: 
	* tests/ioCmd.test: Fixed bug #575836.
d1503 1
a1503 1
2002-07-03  Don Porter  <dgp@@users.sourceforge.net>
d1505 3
a1507 4
	* tests/pkg1/direct1.tcl: removed
	* tests/pkg1/pkgIndex.tcl: removed
	* tests/pkgMkIndex.test:  Imported auxilliary files from tests/pkg1
	  into the test file pkgMkIndex.test itself.  Formatting fixes.
d1509 2
a1510 1
	* unix/Makefile.in: removed tests/pkg/* from `make dist`
d1512 3
a1514 20
	* tests/pkg/circ1.tcl: removed
	* tests/pkg/circ2.tcl: removed
	* tests/pkg/circ3.tcl: removed
	* tests/pkg/global.tcl: removed
	* tests/pkg/import.tcl: removed
	* tests/pkg/pkg1.tcl: removed
	* tests/pkg/pkg2_a.tcl: removed
	* tests/pkg/pkg2_b.tcl: removed
	* tests/pkg/pkg3.tcl: removed
	* tests/pkg/pkg4.tcl: removed
	* tests/pkg/pkg5.tcl: removed
	* tests/pkg/pkga.tcl: removed
	* tests/pkg/samename.tcl: removed
	* tests/pkg/simple.tcl: removed
	* tests/pkg/spacename.tcl: removed
	* tests/pkg/std.tcl: removed
	* tests/pkgMkIndex.test: Fixed [Bug 575857] where this test file
	  expected to be able to write to [file join [testsDirectory]
	  pkg].  Part of the fix was to import several auxilliary files
	  into the test file itself.
d1516 2
a1517 2
	* tests/main.test:	Cheap fix for [Bugs 575851, 575858].  Avoid
	* tests/tcltest.test:	non-writable . by [cd [temporaryDirectory]].
d1519 1
a1519 3
	* library/auto.tcl: Fix [tcl_findLibrary] to be sure it sets
	  $varName only if a successful library script is found.
	  [Bug 577033]
d1521 1
a1521 1
2002-07-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d1523 4
a1526 3
	* generic/tclCompCmds.c (TclCompileCatchCmd): return
	  TCL_OUT_LINE_COMPILE instead of TCL_ERROR: let the failure
	  happen at runtime so that it can be caught [Bug 577015].
d1528 1
a1528 1
2002-07-02  Joe English  <jenglish@@users.sourceforge.net>
d1530 1
a1530 1
	* doc/tcltest.n: Markup fixes, spellcheck.
d1532 2
a1533 1
2002-07-02  Don Porter  <dgp@@users.sourceforge.net>
d1535 1
a1535 1
	* doc/tcltest.n: more refinements of the documentation.
d1537 1
a1537 2
	* library/tcltest/tcltest.tcl: Added trace to be sure the stdio
	  constraint is updated whenever the [interpreter] changes.
d1539 1
a1539 6
	* doc/tcltest.n:		Reverted [makeFile] and [viewFile] to
	* library/tcltest/tcltest.tcl:	their former behavior, and documented
	* tests/cmdAH.test:		it.  Corrected misspelling of hook
	* tests/event.test:		procedure.  Restored tests.
	* tests/http.test:
	* tests/io.test:
d1541 1
a1541 3
	* library/tcltest/tcltest.tcl: Simplified logic of
	  [GetMatchingFiles] and [GetMatchingDirectories], removing
	  special case processing.
d1543 4
a1546 2
	* doc/tcltest.n: More documentation updates.  Reference sections
	  are complete.  Only examples need adding.
d1548 1
a1548 1
2002-07-02  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1550 4
a1553 3
	* tests/fCmd.test: 
	* generic/tclCmdAH.c: clearer error msgs for 'file link',
	as per the man page.
d1555 1390
a2944 1
2002-07-01  Joe English  <jenglish@@users.sourceforge.net>
a2945 16
	* doc/Access.3:
	* doc/AddErrInfo.3:
	* doc/Alloc.3:
	* doc/Backslash.3:
	* doc/CrtChannel.3:
	* doc/CrtSlave.3:
	* doc/Encoding.3:
	* doc/Eval.3:
	* doc/FileSystem.3:
	* doc/Notifier.3:
	* doc/OpenFileChnl.3:
	* doc/ParseCmd.3:
	* doc/RegExp.3:
	* doc/Tcl_Main.3:
	* doc/Thread.3:
	* doc/TraceCmd.3:
d2947 228
a3174 8
	* doc/WrongNumArgs.3:
	* doc/binary.n:
	* doc/clock.n:
	* doc/expr.n:
	* doc/fconfigure.n:
	* doc/glob.n:
	* doc/http.n:
	* doc/interp.n:
d3176 562
a3737 9
	* doc/lset.n:
	* doc/msgcat.n:
	* doc/packagens.n:
	* doc/pkgMkIndex.n:
	* doc/registry.n:
	* doc/resource.n:
	* doc/safe.n:
	* doc/scan.n:
	* doc/tclvars.n:  Spell-check, fixed typos (Updates from Larry Virden).
d3739 3
a3741 1
2002-07-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3743 1
a3743 5
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Made Solaris use gcc for linking
	when building with gcc to resolve problems with undefined symbols
	being present when tcl library used with non-gcc linker at later
	stage. Symbols were compiler-generated, so it is the compiler's
	business to define them. [Bug #541181] 
d3745 5
a3749 1
2002-07-01  Don Porter  <dgp@@users.sourceforge.net>
d3751 1
a3751 1
	* doc/tcltest.n: more work in progress updating tcltest docs.
d3753 2
a3754 4
	* library/tcltest/tcltest.tcl: Change [configure -match] to
	stop treating an empty list as a list of the single pattern "*".
	Changed the default value to [list *] so default operation
	remains the same.
d3756 2
a3757 1
	* tests/pkg/samename.tcl: restored.  needed by pkgMkIndex.test.
d3759 4
a3762 2
	* library/tcltest/tcltest.tcl: restored writeability testing of
	-tmpdir, augmented by a special exception for the deafault value.
d3764 2
a3765 1
2002-07-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3767 1
a3767 1
	* doc/concat.n: Documented the *real* behaviour of [concat]!
d3769 4
a3772 1
2002-06-30  Don Porter  <dgp@@users.sourceforge.net>
d3774 7
a3780 1
	* doc/tcltest.n: more work in progress updating tcltest docs.
d3782 1
a3782 6
	* tests/README:		Updated the instructions on running and
	* tests/cmdMZ.test:	adding to the test suite.  Also updated
	* tests/encoding.test:	several tests, mostly to correctly create
	* tests/fCmd.test:	and destroy any temporary files in the
	* tests/info.test:	[temporaryDirectory] of tcltest.
	* tests/interp.test:
d3784 1
a3784 54
	* library/tcltest/tcltest.tcl:	Stopped checking for writeability
	of -tmpdir value because no default directory can be guaranteed to
	be writeable.

	* tests/autoMkindex.tcl: removed.
	* tests/pkg/samename.tcl: removed.
	* tests/pkg/magicchar.tcl: removed.
	* tests/pkg/magicchar2.tcl: removed.
	* tests/autoMkindex.test: Updated auto_mkIndex tests to use
	[makeFile] and [removeFile] so tests are done in [temporaryDirecotry]
	where write access is guaranteed.

	* library/tcltest/tcltest.tcl:	Fixed [makeFile] and [viewFile] to
	* tests/cmdAH.test:		accurately reflect a file's contents.
	* tests/event.test:		Updated tests that depended on buggy
	* tests/http.test:		behavior.  Also added warning messages
	* tests/io.test:		to "-debug 1" operations to debug test
	* tests/iogt.test:		calls to (make|remove)(File|Directory).

	* unix/mkLinks: `make mklinks` on 6-27 commits.

2002-06-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.h: modified the macro TclEmitPush to not
	call its first argument repeatedly or pass it to other macros,
	[Bug 575194] reported by Peter Spjuth.

2002-06-28  Don Porter  <dgp@@users.sourceforge.net>

	* docs/tcltest.n:	Doc revisions in progress.
	* library/tcltest/tcltest.tcl: Corrected -testdir default value.
	Was not reliable, and disagreed with docs!  Thanks to Hemang Lavana.
	[Bug 575150]

2002-06-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tclUnixThrd.c:	Renamed the Tcl_Platform* #defines to
	* unix/tclUnixPipe.c:	TclOS* because they are only used
	* unix/tclUnixFile.c:	internally.  Also stopped double-#def
	* unix/tclUnixFCmd.c:	of TclOSlstat [Bug #566099, post-rename]
	* unix/tclUnixChan.c:
	* unix/tclUnixPort.h:

	* doc/string.n: Improved documentation for [string last] along
	lines described in Bug #574799 so it indicates that the supplied
	index marks the end of the search space.

2002-06-27  Don Porter  <dgp@@users.sourceforge.net>

	* doc/dde.n:		Work in progress updating the documentation
	* doc/http.n:		of the packages that come bundled with
	* doc/msgcat.n:		the Tcl source distribution, notably tcltest.
	* doc/registry.n:
	* doc/tcltest.n:
d3786 2
a3787 2
	* library/tcltest/tcltest.tcl:  Made sure that the TCLTEST_OPTIONS
	environment variablle configures tcltest at package load time.
d3789 3
a3791 1
2002-06-26  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3793 2
a3794 7
	* tests/fileSystem.test: 
	* generic/tclIOUtil.c: fix to handling of empty paths ""
	which are not claimed by any filesystem (Bug #573758).
	Ensure good error messages are given in all cases.
	* tests/cmdAH.test:
	* unix/tclUnixFCmd.c: fix to bug reported as part of
	(Patch #566669).  Thanks to Taguchi, Takeshi for the report.
d3796 1
a3796 1
2002-06-26  Reinhard Max  <max@@suse.de>
d3798 21
a3818 2
	* unix/tclUnixTime.c: Make [clock format] respect locale settings.
	* tests/clock.test:   Bug #565880. ***POTENTIAL INCOMPATIBILITY***
d3820 1
a3820 1
2002-06-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d3822 7
a3828 3
	* doc/CrtInterp.3:
	* doc/StringObj.3: clarifications by Don Porter, bugs #493995 and
	#500930. 
d3830 99
a3928 1
2002-06-24  Don Porter  <dgp@@users.sourceforge.net>
d3930 1
a3930 3
	* library/tcltest/tcltest.tcl:	Corrected suppression of -verbose skip
	* tests/tcltest.test:		and start by [test -output].  Also
	corrected test suite errors exposed by corrected code.  [Bug 564656]
d3932 2
a3933 1
2002-06-25  Reinhard Max  <max@@suse.de>
d3935 3
a3937 4
	* unix/tcl.m4:       New macro SC_CONFIG_MANPAGES.
	* unix/configure.in: Added support for symlinks and compression
	* unix/Makefile.in:  when installing the manpages. [Patch 518052]
	* unix/mkLinks.tcl:  Default is still hardlinks and no compression.
d3939 11
a3949 2
	* unix/mkLinks:      generated
	* unix/configure:
d3951 1
a3951 1
	* unix/README:       Added documentation for the new features.
d3953 4
a3956 2
	* unix/tcl.m4 (SC_PATH_TCLCONFIG): Replaced ${exec_prefix}/lib by
	${libdir}.
d3958 1
a3958 1
2002-06-25  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3960 66
a4025 40
	* generic/tclUtil.c (TclGetIntForIndex): Fix of critical bug
	#533364 generated when the index is bad and the result is a shared
	object.  The T_ASTO(T_GOR, ...) idiom likely exists elsewhere
	though.  Also removed some cruft that just complicated things to
	no advantage.
	(SetEndOffsetFromAny): Same fix, though this wasn't on the path
	excited by the bug.

2002-06-24  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:	Implementation of TIP 101.  Adds
	* tests/parseOld.test:		and exports a [configure] command
	* tests/tcltest.test:		from tcltest.

2002-06-22  Don Porter  <dgp@@users.sourceforge.net>

	* changes: updated changes file for 8.4b1 release.

	* library/tcltest/tcltest.tcl:	Corrections to tcltest and the
	* tests/basic.test:		Tcl test suite so that a test
	* tests/cmdInfo.test:		with options -constraints knownBug
	* tests/compile.test:		-limitConstraints 1 only tests the
	* tests/encoding.test:		knownBug tests.  Mostly involves
	* tests/env.test:		replacing direct access to the
	* tests/event.test:		testConstraints array with calls
	* tests/exec.test:		to the testConstraint command
	* tests/execute.test:		(which requires tcltest version 2)
	* tests/fCmd.test:
	* tests/format.test:
	* tests/http.test:
	* tests/httpold.test:
	* tests/ioUtil.test:
	* tests/link.test:
	* tests/load.test:
	* tests/namespace.test:
	* tests/pkgMkIndex.test:
	* tests/reg.test:
	* tests/result.test:
	* tests/scan.test:
	* tests/stack.test:
d4027 1
a4027 1
2002-06-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4029 39
a4067 3
	* tools/tcl.wse.in (Disk Label), unix/tcl.spec (version): 
	* win/README.binary, README, win/configure.in, unix/configure.in: 
	* generic/tcl.h (TCL_RELEASE_*, TCL_PATCH_LEVEL): Bump to beta1.
d4069 4
a4072 1
2002-06-21  Joe English  <jenglish@@users.sourceforge.net>
d4074 1
a4074 3
	* generic/tclCompExpr.c:
	* generic/tclParseExpr.c: LogSyntaxError() should reset 
	the interpreter result [Bug 550142 "Tcl_ExprObj -> abort"] 
d4076 3
a4078 1
2002-06-21  Don Porter  <dgp@@users.sourceforge.net>
d4080 8
a4087 4
	* unix/Makefile.in:	Updated all package install directories
	* win/Makefile.in:	to match current Major.minor versions
	* win/makefile.bc:	of the packages.  Added tcltest package
	* win/makefile.vc:	to installation on Windows.
d4089 1
a4089 2
	* library/init.tcl:  Corrected comments and namespace style
	issues.  Thanks to Bruce Stephens. [Bug 572025]
d4091 2
a4092 1
2002-06-21  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4094 1
a4094 15
	* tests/cmdAH.test:          Added TIP#99 implementation
	* tests/fCmd.test:           of 'file link'.  Supports creation
	* tests/fileName.test:       of symbolic and hard links in the
	* tests/fileSystem.test:     native filesystems and in vfs's,
	* generic/tclTest.c:         when the individual filesystem
	* generic/tclCmdAH.c:        supports the concept.
	* generic/tclIOUtil.c:       
	* generic/tcl.h:
	* generic/tcl.decls:
	* doc/FileSystem.3:
	* doc/file.n:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: Also enhanced speed of 'file normalize' on
	Windows.
d4096 2
a4097 1
2002-06-20  Miguel Sofer  <msofer@@users.sourceforge.net>
d4099 5
a4103 3
	* generic/tclBasic.c (TclEvalObjvInternal): fix for [Bug 571385]
	in the implementation of TIP#62 (command tracing). Vince Darley,
	Hemang Lavana & Don Porter: thanks.
d4105 5
a4109 1
2002-06-20  Miguel Sofer  <msofer@@users.sourceforge.net>
d4111 1
a4111 2
	* generic/tclExecute.c (TclCompEvalObj): clarified and simplified
	the logic for compilation/recompilation.
d4113 3
a4115 2
2002-06-19  Joe English  <jenglish@@users.sourceforge.net>
	* doc/file.n: Fixed indentation.  No substantive changes.
d4117 3
a4119 1
2002-06-19  Jeff Hobbs  <jeffh@@ActiveState.com>
d4121 11
a4131 3
	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): get the resultPtr again
	as the Tcl_ObjSetVar2 may cause the result to change.
	[Patch #558324] (watson)
d4133 1
a4133 1
2002-06-19  Miguel Sofer  <msofer@@users.sourceforge.net>
d4135 18
a4152 2
	* generic/tclExecute.c (TEBC): removing unused "for(;;)" loop;
	improved comments; re-indentation.
d4154 2
a4155 1
2002-06-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4157 2
a4158 12
	* generic/tclExecute.c (TEBC): 
	- elimination of duplicated code in the non-immediate INST_INCR
	  instructions. 
	- elimination of 103 (!) TclDecrRefCount macros. The different
	  instructions now jump back to a common "DecrRefCount zone" at
	  the top of the loop. The macro "ADJUST_PC" was replaced by two
	  macros "NEXT_INST_F" and "NEXT_INST_V" that take three params
	  (pcAdjustment, # of stack objects to discard, resultObjPtr
	  handling flag). The only instructions that retain a
	  TclDecrRefCount are INST_POP (for speed), the common code for
	  the non-immediate INST_INCR, INST_FOREACH_STEP and the two
	  INST_LSET.
d4160 1
a4160 3
	The object size of tclExecute.o was reduced by approx 20% since
	the start of the consolidation drive, while making room for some
	peep-hole optimisation at runtime.
d4162 18
a4179 1
2002-06-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4181 1
a4181 2
	* generic/tclExecute.c (TEBC, INST_DONE): small bug in the panic
	code for tcl-stack corruption.
d4183 4
a4186 1
2002-06-17  David Gravereaux <davygrvy@@pobox.com>
d4188 5
a4192 2
	Trims to support the removal of RESOURCE_INCLUDED from rc
	scripts	from FR #565088.
d4194 3
a4196 2
	* generic/tcl.h: moved the #ifndef RC_INVOKED start block up in
	the file.  rc scripts don't need to know thread mutexes.
d4198 6
a4203 3
	* win/tcl.rc:
	* win/tclsh.rc: removed the #define RESOURCE_INCLUDED to let the
	built-in -DRC_INVOKED to the work.
d4205 3
a4207 1
2002-06-17  Jeff Hobbs  <jeffh@@ActiveState.com>
d4209 2
a4210 13
	* doc/CrtTrace.3:        Added TIP#62 implementation of command
	* doc/trace.n:           execution tracing [FR #462580] (lavana).
	* generic/tcl.h:         This includes enter/leave tracing as well
	* generic/tclBasic.c:    as inter-procedure stepping.
	* generic/tclCmdMZ.c:
	* generic/tclCompile.c:
	* generic/tclExecute.c:
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c:
	* tests/trace.test:
d4212 5
a4216 1
2002-06-17  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d4218 1
a4218 4
	* win/tclWinPipe.c (BuildCommandLine): Fixed bug #554068 ([exec]
	  on windows did not treat { in filenames well.). Bug reported by
	  Vince Darley <vincentdarley@@users.sourceforge.net>, patch
	  provided by Vince too.
d4220 6
a4225 1
2002-06-17  Joe English  <jenglish@@users.sourceforge.net>
d4227 2
a4228 3
	* generic/tcl.h: #ifdef logic for K&R C backwards compatibility
	changed to assume modern C by default.  See SF FR #565088 for
	full details.
d4230 4
a4233 1
2002-06-17  Don Porter  <dgp@@users.sourceforge.net>
d4235 17
a4251 2
	* doc/msgcat.n: Corrected en_UK references to en_GB.  UK is not
	a country designation recognized in ISO 3166.
d4253 26
a4278 2
	* library/msgcat/msgcat.tcl:  More Windows Registry locale codes
	from Bruno Haible.
d4280 3
a4282 10
	* doc/msgcat.n:
	* library/msgcat/msgcat.tcl:
	* library/msgcat/pkgIndex.tcl:
	* tests/msgcat.test:  Revised locale initialization to interpret
	environment variable locale values according to XPG4, and to
	recognize the LC_ALL and LC_MESSAGES values over that of LANG.
	Also added many Windows Registry locale values to those 
	recognized by msgcat.  Revised tests and docs.  Bumped to
	version 1.3.  Thanks to Bruno Haible for the report and
	assistance crafting the solution.  [Bug 525522, 525525]
d4284 2
a4285 1
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>
d4287 2
a4288 2
	* generic/tclCompile.c (TclCompileTokens): a better algorithm for
	the previous bug fix.
d4290 12
a4301 1
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>
d4303 5
a4307 5
	* generic/tclCompile.c (TclCompileTokens): 
	* tests/compile.test: [Bug 569438] in the processing of dollar
	variables; report by Georgios Petasis. 
	
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>
d4309 7
a4315 4
	* generic/tclExecute.c: bug in the consolidation of the
	INCR_..._STK instructions; the bug could not be exercised as the
	(faulty) instruction INST_INCR_ARRAY_STK was never compiled-in
	(related to [Bug 569438]).
d4317 4
a4320 1
2002-06-14  Miguel Sofer  <msofer@@users.sourceforge.net>
d4322 7
a4328 8
	* generic/tclExecute.c (TclExecuteByteCode): runtime peep-hole
	optimisation of variables (INST_STORE, INST_INCR) and commands
	(INST_INVOKE); faster check for the existence of a catch.
	(TclExecuteByteCode): runtime peep-hole optimisation of
	comparisons.
	(TclExecuteByteCode): runtime peep-hole optimisation of
	INST_FOREACH - relies on peculiarities of the code produced by the
	bytecode compiler.
d4330 3
a4332 1
2002-06-14  David Gravereaux <davygrvy@@pobox.com>
d4334 3
a4336 3
	* win/rules.vc: The test for compiler optimizations was in error.
	Thanks goes to Roy Terry <royterry@@earthlink.net> for his
	assistance with this.
d4338 1
a4338 1
2002-06-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4340 12
a4351 4
	* doc/trace.n, tests/trace.test: 
	* generic/tclCmdMZ.c (Tcl_TraceObjCmd,TclTraceCommandObjCmd)
	(TclTraceVariableObjCmd): Changed references to "trace list" to
	"trace info" as mandated by TIP#102.
d4353 7
a4359 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4361 1
a4361 2
	* generic/tclExecute.c (TclExecuteByteCode): consolidated code for
	the conditional branch instructions.
d4363 1
a4363 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4365 21
a4385 2
	* generic/tclExecute.c (TclExecuteByteCode): fixed the previous
	patch - wouldn't compile with TCL_COMPILE_DEBUG set.
d4387 2
a4388 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4390 10
a4399 4
	* generic/tclExecute.c (TclExecuteByteCode): consolidated the
	handling of exception returns to INST_INVOKE and INST_EVAL, as
	well as most of the code for INST_CONTINUE and INST_BREAK, in the
	new jump target "processExceptionReturn".
d4401 60
a4460 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4462 2
a4463 7
	* generic/tclExecute.c (TclExecuteByteCode): consolidated variable
	handling opcodes, replaced redundant code with some 'goto'. All
	store/append/lappend opcodes on the same data type now share the
	main code; same with incr opcodes.
	* generic/tclVar.c: added the bit TCL_TRACE_READS to the possible
	flags to Tcl_SetVar2Ex - it causes read traces to be fired prior
	to setting the variable. This is used in the core for [lappend].
d4465 1
a4465 6
	***NOTE*** the usage of TCL_TRACE_READS in Tcl_(Obj)?GetVar.* is
	not documented; there, it causes the call to create the variable
	if it does not exist. The new usage in Tcl_(Obj)?SetVar.* remains
	undocumented too ...
	
2002-06-13  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4467 1
a4467 4
	* tests/fCmd.test:
	* tests/winFile.test:
	* tests/fileSystem.test:
	* generic/tclTest.c:
d4469 5
d4475 11
a4485 26
	* doc/FileSystem.3:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: fixed up further so both compiles and
	actually works with VC++ 5 or 6.
	* win/tclWinInt.h: 
	* win/tclWin32Dll.c: cleaned up code and vfs tests and
	added tests for the internal changes of 2002-06-12, to see
	whether WinTcl on NTFS can coexist peacefully with links
	in the filesystem.  Added new test command 'testfilelink'
	to enable the newer code to be tested.
	* tests/fCmd.test: (made certain tests of 'testfilelink' not
	run on unix).

2002-06-12  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tclBasic.c (Tcl_DeleteTrace): fixed [Bug 568123] (thanks to
	Hemang Lavana)
	
2002-06-12  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinFile.c: corrected the symbolic link handling code to
	allow it to compile.  Added real definition of REPARSE_DATA_BUFFER
	(found in winnt.h).  Most of the added definitions appear to have
	correct, cross-Win-version equivalents in winnt.h and should be
	removed, but just making things "work" for now.
d4487 1
a4487 1
2002-06-12  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4489 1
a4489 7
	* generic/tclIOUtil.c:
	* generic/tcl.decls:
	* generic/tclDecls.h: made code for Tcl_FSNewNativePath
	agree with man pages.
	
	* doc/FileSystem.3: clarified the circumstances under which
	certain functions are called in the presence of symlinks.
d4491 3
a4493 11
	* win/tclWinFile.c:
	* win/tclWinPort.h: 
	* win/tclWinInt.h: 
	* win/tclWinFCmd.c:  Fix for Windows to allow 'file lstat', 
	'file type', 'glob -type l', 'file copy', 'file delete', 
	'file normalize', and all VFS code to work correctly in the 
	presence of symlinks (previously Tcl's behaviour was not very 
	well defined).  This also fixes possible serious problems in 
	all versions of WinTcl where 'file delete' on a NTFS symlink 
	could delete the original, not the symlink.
	Note: symlinks cannot yet be created in pure Tcl.
d4495 1
a4495 21
2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c: 
	* generic/tclCompCmds.c:
	* generic/tclInt.h: reverted the new compilation functions;
	replaced by a more general approach described below.

	* generic/tclCompCmds.c:
	* generic/tclCompile.c: made *all* compiled variable access
	attempts create an indexed variable - even get or incr without
	previous set. This allows indexed access to local variables that
	are created and set at runtime, for example by [global], [upvar],
	[variable], [regexp], [regsub].

2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/global.n:
	* doc/info.n:
	* test/info.test:
	* generic/tclCmdIL.c: fix for [Bug 567386], [info locals] was
	reporting some linked variables.
d4497 1
a4497 6
	* generic/tclBasic.c: 
	* generic/tclCompCmds.c:
	* generic/tclInt.h: added compile functions for [global],
	[variable] and [upvar]. They just declare the new local variables,
	the commands themselves are not compiled-in. This gives a notably
	faster read access to these linked variables.
d4499 1
a4499 1
2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>
d4501 2
a4502 2
	* generic/tclExecute.c: optimised algorithm for exception range
	lookup; part of [Patch 453709].
d4504 2
a4505 1
2002-06-10  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4507 1
a4507 6
	* unix/tclUnixFCmd.c: fixed [Bug #566669]
	* generic/tclIOUtil.c: improved and sped up handling of
	native paths (duplication and conversion to normalized paths),
	particularly on Windows.
	* modified part of above commit, due to problems on Linux. 
	Will re-examine bug report and evaluate more closely.
d4509 1
a4509 1
2002-06-07  Don Porter  <dgp@@users.sourceforge.net>
d4511 1
a4511 2
	* tests/tcltest.test:  More corrections to test suite so that tests
	of failing [test]s don't show up themselves as failing tests.
d4513 2
a4514 1
2002-06-07  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4516 1
a4516 4
	* generic/tclExecute.c: Tidied up headers in relation to float.h
	to cut the cruft and ensure DBL_MAX is defined since doubles seem
	to be the same size everywhere; if the assumption isn't true, the
	variant platforms had better have run configure...
d4518 1
a4518 7
	* unix/tclUnixPort.h (EOVERFLOW): Added code to define it if it
	wasn't previously defined.  Also some other general tidying and
	adding of comments.  [Tcl bugs 563122, 564595]
	* compat/tclErrno.h: Added definition for EOVERFLOW copied from
	Solaris headers; I've been unable to find any uses of EFTYPE,
	which was the error code previously occupying the slot, in Tcl, or
	any definition of it in the Solaris headers.
d4520 7
a4526 1
2002-06-06  Mo DeJong  <mdejong@@users.sourceforge.net>
d4528 1
a4528 3
	* unix/dltest/Makefile.in: Remove hard coded CFLAGS=-g
	and add CFLAGS_DEBUG, CFLAGS_OPTIMIZE, and
	CFLAGS_DEFAULT varaibles. [Tcl bug 565488]
d4530 3
a4532 1
2002-06-06  Don Porter  <dgp@@users.sourceforge.net>
d4534 1
a4534 2
	* tests/tcltest.test:  Corrections to test suite so that tests
	of failing [test]s don't show up themselves as failing tests.
d4536 9
a4544 2
	* tests/io.test: Fixed up namespace variable resolution issues
	revealed by running test suite with "-singleproc 1".
d4546 1
a4546 46
	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test: Several updates to tcltest.
	  1) changed to lazy initialization of test constraints
	  2) deprecated [initConstraintsHook]
	  3) repaired badly broken [limitConstraints].
	  4) deprecated [threadReap] and [mainThread]
	[Patch 512214, Bug 558742, Bug 461000, Bug 534903]

2002-06-06  Daniel Steffen  <das@@users.sourceforge.net>

	* unix/tclUnixThrd.c (TclpReaddir, TclpLocaltime, TclpGmtime):
	added mutex wrapped calls to readdir, localtime & gmtime in
	case their thread-safe *_r counterparts are not available.
	* unix/tcl.m4: added configure check for readdir_r
	* unix/tcl.m4 (Darwin): set TCL_DEFAULT_ENCODING to utf-8 on
	MacOSX (where posix file apis expect utf-8, not iso8859-1).   
	* unix/configure: regen
	* unix/Makefile.in: set DYLD_LIBRARY_PATH in parallel       
	to LD_LIBRARY_PATH for MacOSX dynamic linker.
	* generic/tclEnv.c (TclSetEnv): fix env var setting on
	MacOSX (adapted from patch #524352 by jkbonfield).

2002-06-05  Don Porter  <dgp@@users.sourceforge.net>

	* doc/Tcl_Main.3: Documented $tcl_rcFileName and added more
	clarifications about the intended use of Tcl_Main(). [Bug 505651]

2002-06-05  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclFileName.c (TclGlob): mac specific fix to
	recent changes in 'glob -tails' handling.
	* mac/tclMacPort.h:
	* mac/tclMacChan.c: fixed TIP#91 bustage.
	* mac/tclMacResource.c (Tcl_MacConvertTextResource): added utf
	conversion of text resource contents.
	* tests/macFCmd.test (macFCmd-1.2): allow CWIE creator.

2002-06-04  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:
	* tests/init.test:
	* tests/tcltest.test:	Added more TIP 85 tests from Arjen Markus.
	Converted tcltest.test to use a private namespace.  Fixed bugs in
	[tcltest::Eval] revealed by calling [tcltest::test] from a non-global
	namespace, and namespace errors in init.test.
d4548 6
a4553 1
2002-06-04  Mo DeJong  <mdejong@@users.sourceforge.net>
d4555 2
a4556 1
	* win/README: Update msys+mingw URL.
d4558 10
a4567 1
2002-06-03  Don Porter  <dgp@@users.sourceforge.net>
d4569 2
a4570 8
	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* library/tcltest/pkgIndex.tcl:
	* tests/tcltest.test:  Implementation of TIP 85.  Allows tcltest
	users to add new legal values of the -match option to [test],
	associating each with a Tcl command that does the matching of
	expected results with actual results of tests.  Thanks to
	Arjen Markus.  => tcltest 2.1 [Patch 521362]
d4572 1
a4572 1
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d4574 1
a4574 2
	* doc/namespace.n: added description of [namepace forget]
	behaviour for unqualified patterns [Bug 559268]
d4576 2
a4577 1
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d4579 3
a4581 4
	* generic/tclExecute.c: reverting an accidental modification in
	the last commit.
	
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d4583 1
a4583 2
	* doc/Tcl.n: clarify the empty variable name issue ([Bug 549285]
	reported by Tom Krehbiel, patch by Don Porter).
d4585 2
a4586 1
2002-05-31  Don Porter  <dgp@@users.sourceforge.net>
d4588 1
a4588 2
	* library/package.tcl:  Fixed leak of slave interp in [pkg_mkIndex].
	Thanks to Helmut for report.  [Bug 550534]
d4590 3
a4592 3
	* tests/io.test:
	* tests/main.test:  Use the "stdio" constraint to control whether
	an [open "|[interpreter]"] is attempted.
d4594 1
a4594 67
	* generic/tclExecute.c (TclMathInProgress,TclExecuteByteCode
		ExprCallMathFunc):
	* generic/tclInt.h (TclMathInProgress):
	* unix/Makefile.in (tclMtherr.*):
	* unix/configure.in (NEED_MATHERR):
	* unix/tclAppInit.c (matherr):
	* unix/tclMtherr.c (removed file):
	* win/tclWinMtherr.c (_matherr): Removed internal routine
	TclMathInProgress and Unix implementation of matherr().  These
	are now obsolete, dealing with very old versions of the C math
	library.  Windows version is retained in case Borland compilers
	require it, but it is inactive.  Thanks to Joe English.
	[Bug 474335, Patch 555635].
	* unix/configure: regen

2002-05-30  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompExpr.c:
	* generic/tclCompile.c:
	* generic/tclCompile.h: removed exprIsJustVarRef and
	exprIsComparison from the ExprInfo and CompileEnv structs. These
	were set, but not used since dec 1999 [Bug 562383].

2002-05-30  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c (TclGlob): fix to longstanding
	'knownBug' in fileName tests 15.2-15.4, and fix to a new
	Tcl 8.4 bug in certain uses of 'glob -tails'.
	* tests/fileName.test: removed 'knownBug' flag from some tests,
	added some new tests for above bugs.
	
2002-05-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure: regen'ed
	* unix/configure.in: replaced bigendian check with autoconf
	standard AC_C_BIG_ENDIAN, which defined WORDS_BIGENDIAN on
	bigendian systems.
	* generic/tclUtf.c (Tcl_UniCharNcmp): 
	* generic/tclInt.h (TclUniCharNcmp): use WORDS_BIGENDIAN instead of
	TCL_OPTIMIZE_UNICODE_COMPARE to enable memcmp alternative.

	* generic/tclExecute.c (TclExecuteByteCode INST_STR_CMP):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): changed the case for
	choosing the Tcl_UniCharNcmp compare to when both objs are of
	StringType, as benchmarks show that is the optimal check (both
	bigendian and littleendian systems).

2002-05-29  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclMain.c: Removed "dummy" reference to Tcl_LinkVar.
	It is no longer needed since Tcl_Main() now actually calls
	Tcl_LinkVar().  Thanks to Joe English for pointing that out.

2002-05-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclExecute.c (TclExecuteByteCode): 
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): Use the macro version.
	* generic/tclInt.h (TclUniCharNcmp): Optimised still further with
	a macro for use in sensitive places like tclExecute.c

	* generic/tclUtf.c (Tcl_UniCharNcmp): Use new flag to figure out
	when we can use an optimal comparison scheme, and default to the
	old scheme in other cases which is at least safe.
	* unix/configure.in (TCL_OPTIMIZE_UNICODE_COMPARE): New optional
	flag that indicates when we can use memcmp() to compare Unicode
	strings (i.e. when the high-byte of a Tcl_UniChar precedes the
	low-byte.)
d4596 1
a4596 1
2002-05-29  Jeff Hobbs  <jeffh@@ActiveState.com>
d4598 3
a4600 21
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclUtf.c: added TclpUtfNcmp2 private command that
	mirrors Tcl_UtfNcmp, but takes n in bytes, not utf-8 chars.  This
	provides a faster alternative for comparing utf strings	internally.
	(Tcl_UniCharNcmp, Tcl_UniCharNcasecmp): removed the explicit end
	of string check as it wasn't correct for the function (by doc and
	logic).

	* generic/tclCmdMZ.c (Tcl_StringObjCmd): reworked the string equal
	comparison code to use TclpUtfNcmp2 as well as short-circuit for
	equal objects or unequal length strings in the equal case.
	Removed the use of goto and streamlined the other parts.

	* generic/tclExecute.c (TclExecuteByteCode): added check for
	object equality in the comparison instructions.  Added
	short-circuit for != length strings in INST_EQ, INST_NEQ and
	INST_STR_CMP.  Reworked INST_STR_CMP to use TclpUtfNcmp2 where
	appropriate, and only use Tcl_UniCharNcmp when at least one of the
	objects is a Unicode obj with no utf bytes.
d4602 1
a4602 2
	* generic/tclCompCmds.c (TclCompileStringCmd): removed error
	creation in code that no longer throws an error.
d4604 2
a4605 2
	* tests/string.test:
	* tests/stringComp.test: added more string comparison checks.
d4607 2
a4608 1
	* tests/clock.test: better qualified 9.1 constraint check for %s.
d4610 2
a4611 1
2002-05-28  Jeff Hobbs  <jeffh@@ActiveState.com>
d4613 1
a4613 2
	* generic/tclThreadAlloc.c (TclpRealloc, TclpFree): protect
	against the case when NULL is based.
d4615 1
a4615 67
	* tests/clock.test: added clock-9.1
	* compat/strftime.c:
	* generic/tclClock.c:
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* unix/tclUnixTime.c: fix for Windows msvcrt mem leak caused by
	using an env(TZ) setting trick for in clock format -gmt 1.  This
	also makes %s seem to work correctly with -gmt 1 as well as
	making it a lot faster by avoid the env(TZ) hack.  TclpStrftime
	now takes useGMT as an arg.  [Bug #559376]

2002-05-28  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclIOUtil.c: fixes to Tcl_FSLoadFile when called on
	a file inside a vfs.  This should avoid leaving temporary 
	files sitting around on exit. [Bug #545579]
	
2002-05-27  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* win/tclWinError.c: Added comment on conversion of
	ERROR_NEGATIVE_SEEK because that is a mapping that really belongs,
	and not a catch-all case.
	* win/tclWinPort.h (EOVERFLOW): Should be either EFBIG or EINVAL
	* generic/tclPosixStr.c (Tcl_ErrnoId, Tcl_ErrnoMsg): EOVERFLOW can
	potentially be a synonym for EINVAL.

2002-05-24  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	=== Changes due to TIP#91 ===

	* win/tclWinPort.h: Added declaration of EOVERFLOW.
	* doc/CrtChannel.3: Added documentation of wideSeekProc.
	* generic/tclIOGT.c (TransformSeekProc, TransformWideSeekProc):
	Adapted to use the new channel mechanism.
	* unix/tclUnixChan.c (FileSeekProc, FileWideSeekProc): Renamed
	FileSeekProc to FileWideSeekProc and created new FileSeekProc
	which has the old-style interface and which errors out with
	EOVERFLOW when the returned file position can't fit into the
	return type (int for historical reasons.)
	* win/tclWinChan.c (FileSeekProc, FileWideSeekProc): Renamed
	FileSeekProc to FileWideSeekProc and created new FileSeekProc
	which has the old-style interface and which errors out with
	EOVERFLOW when the returned file position can't fit into the
	return type (int for historical reasons.)
	* mac/tclMacChan.c (FileSeek): Reverted to old interface; Macs
	lack large-file support because I can't see how to add it.
	* generic/tclIO.c (Tcl_Seek, Tcl_Tell): Given these functions
	knowledge of the new arrangement of channel types.
	(Tcl_ChannelVersion): Added recognition of new version code.
	(HaveVersion): New function to do version checking.
	(Tcl_ChannelBlockModeProc, Tcl_ChannelFlushProc)
	(Tcl_ChannelHandlerProc): Made these functions use HaveVersion for
	ease of future maintainability.
	(Tcl_ChannelBlockModeProc): Obvious lookup function.
	* generic/tcl.h (Tcl_ChannelType): New wideSeekProc field, and
	seekProc type restored to old interpretation.
	(TCL_CHANNEL_VERSION_3): New channel version.

2002-05-24  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
	
	* tests/winPipe.test: Applied patch for SF Tcl Bug #549617. Patch
	  and bug report by Kevin Kenny <kennykb@@users.sourceforge.net>.

	* win/tclWinSock.c (TcpWatchProc): Fixed SF Tcl Bug #557878. We
	  are not allowed to mess with the watch mask if the socket is a
	  server socket. I believe that the original reporter is George
	  Peter Staplin.
d4617 2
a4618 1
2002-05-21  Mo DeJong  <mdejong@@users.sourceforge.net>
d4620 1
a4620 7
	* unix/configure: Regen.
	* unix/configure.in: Invoke SC_ENABLE_SHARED before
	calling SC_CONFIG_CFLAGS so that the SHARED_BUILD
	variable can be checked inside SC_CONFIG_CFLAGS.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Pass -non_shared
	instead of -shared to ld when configured with
	--disable-shared under OSF. [Tcl bug 540390]
d4622 2
a4623 1
2002-05-20  Daniel Steffen  <das@@users.sourceforge.net>
d4625 1
a4625 3
	* generic/tclInt.h: added prototype for TclpFilesystemPathType().
	* mac/tclMacChan.c: use MSL provided creator type if available
	instead of the default 'MPW '.
d4627 2
a4628 1
2002-05-16  Joe English  <jenglish@@users.sf.net>
d4630 1
a4630 3
	* doc/CrtObjCmd.3: 
	Added Tcl_GetCommandFromObj, Tcl_GetCommandFullName
	(Tcl Bug #547987, #414921)
d4632 4
a4635 1
2002-05-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4637 1
a4637 3
	* unix/tclUnixChan.c (TtyOutputProc): #if/#endif-ed this function
	out to stop compiler warnings.  Also much general tidying of
	comments in this file and removal of whitespace from blank lines.
d4639 3
a4641 1
2002-05-13  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4643 1
a4643 4
	* unix/tclUnixChan.c (SETBREAK): Solaris thinks ioctl() takes a
	signed second argument, and Linux thinks ioctl() takes an unsigned
	second argument.  So need a longer definition of this macro to get
	neither to spew warnings...
d4645 3
a4647 1
2002-05-13  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4649 1
a4649 8
	* generic/tclEvent.c: 
	* generic/tclIOUtil.c:
	* generic/tclInt.h: clean up all memory allocated by the
	filesystem, via introduction of 'TclFinalizeFilesystem'.
	Move TclFinalizeLoad into TclFinalizeFilesystem so we can
	be sure it is called at just the right time.
	Fix bad comment also.  [Bug #555078 and 'fs' part of #543549]
	* win/tclWinChan.c: fix comment referring to wrong function.
d4651 1
a4651 1
2002-05-10  Don Porter  <dgp@@users.sourceforge.net>
d4653 4
a4656 5
	* tests/load.test:
	* tests/safe.test:
	* tests/tcltest.test: Corrected some list-quoting issues and
	other matters that cause tests to fail when the patch includes
	special characters.  Report from Vince Darley.  [Bug 554068].
d4658 1
a4658 1
2002-05-08    David Gravereaux <davygrvy@@pobox.com>
d4660 3
a4662 15
	* doc/file.n:
	* tools/man2tcl.c:
	* tools/man2help2.tcl:  Thanks to Peter Spjuth
	<peter.spjuth@@space.se>, again.  My prior fix for
	single-quote macro mis-understanding was wrong.	 Reverted to
	reimpliment the 'macro2' proc which handles single-quote macros
	and restored file.n text arrangement to avoid single-quotes on
	the first line.  Sorry for all the confusion.

2002-05-08  David Gravereaux <davygrvy@@pobox.com>

	* tools/man2tcl.c:
	* tools/man2help2.tcl: Proper source of macro error mis-
	understanding single-quote as the leading macro command found
	and repaired.
d4664 1
a4664 2
	* doc/file.n: Reverted to prior state before I messed with
	it.
d4666 2
a4667 1
2002-05-08  Don Porter  <dgp@@users.sourceforge.net>
d4669 1
a4669 17
	* library/tcltest/tcltest.tcl: Corrected [uplevel] quoting when
	[source]-ing test script in subdirectories.
	* tests/fileName.test:
	* tests/load.test:
	* tests/main.test:
	* tests/tcltest.test: 
	* tests/unixInit.test: Fixes to test suite when there's a space
	in the working path.  Thanks to Kevin Kenny.

2002-05-07  David Gravereaux <davygrvy@@pobox.com>

	-- Changes from Peter Spjuth <peter.spjuth@@space.se>
	* tools/man2tcl.c: Increased line buffer size and a bail-out if
	that should ever be over-run.
	* tools/man2help.tcl: Include Courier New font in rtf header.
	* tools/man2help2.tcl: Improved handling of CS/CE fields.  Use
	Courier New for code samples and indent better.
d4671 3
a4673 5
	* doc/file.n:
	* doc/TraceCmd.3:  winhelp conversion tools where understanding
	a ' as the first character on a line to be an unknown macro.
	Not knowing how to repair tools/man2tcl.c, I decided to rearrange
	the text in the docs instead.
d4675 1
a4675 1
2002-05-07  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4677 6
a4682 40
	* generic/tclFileName.c: fix to similar segfault when using 
	'glob -types nonsense -dir dirname -join * *'. [Bug 553320]
	
	* doc/FileSystem.3: further documentation on vfs.
	* tests/cmdAH.test:
	* tests/fileSystem.test:
	* tests/pkgMkindex.test: Fix to testsuite bugs when running out
	of directory whose name contains '{' or '['.

2002-05-07  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/basic.test: Fix for [Bug 549607]
	* tests/encoding.test: Fix for [Bug 549610]
	These are testsuite bugs that caused failures when the filename
	contained spaces. Report & fix by Kevin Kenny.

2002-05-02  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c: fix to freeing a bad object 
	(i.e. segfault) when using 'glob -types nonsense -dir dirname'.
	* generic/tclWinFile.c: fix to [Bug 551306], also wrapped some 
	long lines.
	* tests/fileName.test: added several tests for the above bugs.
	* doc/FileSystem.3: clarified documentation on refCount
	requirements of the object returned by the path type function.
	* generic/tclIOUtil.c:
	* win/tclWinFile.c:
	* unix/tclUnixFile.c:
	* mac/tclMacFile.c: moved TclpFilesystemPathType to the
	platform specific directories, so we can add missing platform-
	specific implementations.  On Windows, 'file system' now returns 
	useful results like "native NTFS", "native FAT" for that system.  
	Unix and MacOS still only return "native".
	* doc/file.n: clarified documentation.
	* tests/winFile.test: test for 'file system' returning correct
	values.
	* tests/fileSystem.test: test for 'file system' returning correct
	values.  Clean up after failed previous test run.
	
2002-04-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d4684 1
a4684 3
	* unix/configure:
	* unix/tcl.m4: change HP-11 SHLIB_LD_LIBS from "" to ${LIBS} so
	that the .sl knows its dependent libs.
d4686 2
a4687 1
2002-04-26  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4689 1
a4689 4
	* tests/obj.test (obj-11.[56]): Test conversion to boolean more
	thoroughly.
	* generic/tclObj.c (SetBooleanFromAny): Was not calling an integer
	parsing function on native 64-bit platforms!  [Bug 548686]
d4691 7
a4697 1
2002-04-24  Jeff Hobbs  <jeffh@@ActiveState.com>
d4699 1
a4699 3
	* generic/tclInt.h: corrected TclRememberJoinableThread decl to
	use VOID instead of void.
	* generic/tclThreadJoin.c: noted that this code isn't needed on Unix.
d4701 2
a4702 1
2002-04-23  Jeff Hobbs  <jeffh@@ActiveState.com>
d4704 1
a4704 2
	* doc/exec.n: 
	* doc/tclvars.n: doc updates [Patch #509426] (gravereaux)
d4706 2
a4707 1
2002-04-24  Daniel Steffen  <das@@users.sourceforge.net>
d4709 1
a4709 4
	* mac/tclMacResource.r: added check of
	TCLTK_NO_LIBRARY_TEXT_RESOURCES #define to allow disabling the
	inclusion of the tcl library code in the resource fork of Tcl
	executables and shared libraries.
d4711 1
a4711 1
2002-04-23  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4713 1
a4713 2
	* doc/TraceCmd.3: New file that documents Tcl_CommandTraceInfo,
	Tcl_TraceCommand and Tcl_UntraceCommand [Bug 414927]
d4715 1
a4715 1
2002-04-22  Jeff Hobbs  <jeffh@@ActiveState.com>
d4717 1
a4717 17
	* generic/tclAlloc.c:
	* generic/tclInt.h:
	* generic/tclThreadAlloc.c (new):
	* unix/Makefile.in:
	* unix/tclUnixThrd.c:
	* win/Makefile.in:
	* win/tclWinInt.h:
	* win/tclWinThrd.c: added new threaded allocator contributed by
	AOL that significantly reduces lock contention when multiple
	threads are in use.  Only Windows and Unix implementations are
	ready, and the Windows one may need work.  It is only used by
	default on Unix for now, and requires that USE_THREAD_ALLOC be
	defined (--enable-threads on Unix will define this).

	* generic/tclIOUtil.c (Tcl_FSRegister, Tcl_FSUnregister):
	corrected calling of Tcl_ConditionWait to ensure that there would
	be a condition to wait upon.
d4719 1
a4719 1
	* generic/tclCmdAH.c (Tcl_FileObjCmd): added cast in FILE_SIZE.
d4721 1
a4721 2
	* win/tclWinFCmd.c (DoDeleteFile): check return of setattr API
	calls in file deletion for correct Win32 API handling.
d4723 3
a4725 2
	* win/Makefile.in: correct dependencies for shell, gdb, runtest
	targets.
d4727 1
a4727 19
	* doc/clock.n:
	* compat/strftime.c (_fmt): change strftime to correctly handle
	localized %c, %x and %X on Windows.  Added some notes about how
	the other values could be further localized.

2002-04-19  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclMain.c (Tcl_Main):  Free the memory allocated for the
	startup script path.  [Bug 543549]

	* library/msgcat/msgcat.tcl:  [mcmax] wasn't using the caller's
	namespace when determining the max translated length.  Also
	made revisions for better use of namespace variables and more
	efficient [uplevel]s.

	* doc/msgcat.n:
	* library/msgcat/msgcat.tcl:
	* library/msgcat/pkgIndex.tcl:  Added [mcload] to the export list
	of msgcat; bumped to 1.2.3.  [Bug 544727]
d4729 1
a4729 1
2002-04-20  Daniel Steffen  <das@@users.sourceforge.net>
d4731 2
a4732 17
	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacUtil.c: Modified TclpObjNormalizePath to be alias
	file aware, and replaced various calls to FSpLocationFrom*Path
	by calls to new alias file aware versions FSpLLocationFrom*Path.
	The alias file aware routines don't resolve the last component of
	a path if it is an alias. This allows [file copy/delete] etc. to
	act correctly on alias files. (c.f. discussion in Bug #511666)

2002-04-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/lindex.test (lindex-3.7): 
	* generic/tclUtil.c (TclGetIntForIndex): Stopped indexes from
	hitting wide ints.  [Bug #526717]
d4734 1
a4734 1
2002-04-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4736 4
a4739 3
	* generic/tclNamesp.c:
	* tests/info.test: [Bug 545325] info level didn't report
	namespace eval, bug report by Richard Suchenwirth.
d4741 1
a4741 1
2002-04-18  Don Porter  <dgp@@users.sourceforge.net>
d4743 10
a4752 3
	* doc/subst.n:  Clarified documentation on handling unusual return
	codes during substitution, and on variable substitutions implied
	by command substitution, and vice versa.  [Bug 536838]
d4754 1
a4754 1
2002-04-18  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4756 3
a4758 3
	* generic/tclCmdIL.c (InfoBodyCmd): 
	* tests/info.test (info-2.6): Proc bodies without string reps
	would report as empty [Bug #545644]
d4760 3
a4762 4
	* generic/tclCmdMZ.c (Tcl_SubstObj): More clarification for
	comment on behaviour when substitutions are not well-formed,
	prompted by [Bug #536831]; alas, removing the ill-defined
	behaviour is a lot of work.
d4764 5
a4768 1
2002-04-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4770 7
a4776 4
	* generic/tclExecute.c:
	* tests/expr-old.test: fix for [Bug #542588] (Phil Ehrens), where
	"too large integers" were reported as "floating-point value" in
	[expr] error messages.
d4778 1
a4778 1
2002-04-17  Jeff Hobbs  <jeffh@@ActiveState.com>
d4780 3
a4782 4
	* generic/tclEncoding.c (EscapeFromUtfProc): 
	* generic/tclIO.c (WriteChars, Tcl_Close): corrected the handling
	of outputting end escapes for escape-based encodings.
	[Bug #526524] (yamamoto)
d4784 3
a4786 1
2002-04-17  Don Porter  <dgp@@users.sourceforge.net>
d4788 1
a4788 4
	* doc/tcltest.n:  Removed [saveState] and [restoreState] from
	tcltest 2 documentation, effectively deprecating them.  [Bug 495660]
	* library/tcltest/tcltest.tcl: Made separate export for commands
	kept only for tcltest 1 compatibility.
d4790 2
a4791 3
	* tests/iogt.test: Revised to run tests in a namespace, rather than
	use the useless and buggy [saveState] and [restoreState] commands
	of tcltest.  Updated to use tcltest 2 as well.  [Patch 544911]
d4793 4
a4796 1
2002-04-16  Don Porter  <dgp@@users.sourceforge.net>
d4798 1
a4798 3
	* tests/io.test: Revised to run tests in a namespace, rather than
	use the useless and buggy [saveState] and [restoreState] commands
	of tcltest.  Updated to use tcltest 2 as well.  [Patch 544546]
d4800 3
a4802 1
2002-04-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d4804 1
a4804 4
	* generic/tclProc.c:
	* tests/proc-old.test: Improved stack trace for TCL_BREAK and
	TCL_CONTINUE returns from procs. Patch by Don Porter
	[Bug 536955]. 
d4806 25
a4830 4
	* generic/tclExecute.c:
	* tests/compile.test: made bytecodes check for a catch before
	  returning; the compiled [return] is otherwise non-catchable. 
	  [Bug 542142] reported by Andreas Kupries.
d4832 1
a4832 1
2002-04-15  Don Porter  <dgp@@users.sourceforge.net>
d4834 1
a4834 2
	* tests/socket.test:  Increased timeout values so that tests have
	time to successfully complete even on slow/busy machines.  [Bug 523470]
d4836 3
a4838 41
	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test:  Revised [tcltest::test] to return errors
	when called with invalid syntax and to accept exactly two arguments
	as documented.  Improved error messages.  [Bug 497446, Patch 513983]
	***POTENTIAL INCOMPATIBILITY***: Incompatible with previous
	tcltest 2.* releases, found only in alpha releases of Tcl 8.4.

2002-04-11  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclNotify.c (TclFinalizeNotifier): remove remaining
	unserviced events on finalization.

	* win/tcl.m4: Enabled COFF as well as CV style debug info with
	--enable-symbols to allow Dr. Watson users to see function info.
	More info on debugging levels can be obtained at:
	http://msdn.microsoft.com/library/en-us/dnvc60/html/gendepdebug.asp

	* tests/ioCmd.test: fixed iocmd-8.15 to have mac and unixPc variants.

	* generic/tclParse.c (Tcl_ParseVar): conditionally incr obj
	refcount to prevent possible mem leak.

2002-04-08  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tcl.h: no <sys/types.h> on mac.
	* mac/tclMacFile.c: minor fixes to Vince's changes from 03-24.
	* mac/tclMacOSA.c:
	* mac/tclMacResource.c: added missing Tcl_UtfToExternalDString
	conversions of resource file names.
	* mac/tclMacSock.c (TcpGetOptionProc): fixed bug introduced
	by Andreas on 02-25; changed strcmp's to strncmp's so that
	option comparison behaves like on other platforms.
	* mac/tcltkMacBuildSupport.sea.hqx (CW Pro6 changes): added
	support to allow Tk to hookup C library stderr/stdout to TkConsole.
	* tests/basic.test:
	* tests/cmdAH.test:
	* tests/encoding.test:
	* tests/fileSystem.test:
	* tests/ioCmd.test: fixed tests failing on mac: check for 
	existence of [exec], changed some result strings.
d4840 1
a4840 1
2002-04-06  Jeff Hobbs  <jeffh@@ActiveState.com>
d4842 2
a4843 5
	* unix/tclUnixFCmd.c (Realpath): added a little extra code to
	initialize a realpath arg when compiling in PURIFY mode in order
	to prevent spurious purify warnings.  We should really create our
	own realpath implementation, but this will at least quiet purify
	for now.
d4845 1
a4845 1
2002-04-05  Don Porter  <dgp@@users.sourceforge.net>
d4847 3
a4849 5
	* generic/tclCmdMZ.c (Tcl_SubstObj):
	* tests/subst.test:  Corrected [subst] so that return codes
	TCL_BREAK and TCL_CONTINUE returned by variable substitution
	have the same effect as when those codes are returned by command
	substitution.  [Bug 536879]
d4851 1
a4851 1
2002-04-03  Jeff Hobbs  <jeffh@@ActiveState.com>
d4853 1
a4853 2
	* library/tcltest/tcltest.tcl: added getMatchingFiles back (alias
	to GetMatchingFiles), which was a public function in tcltest 1.0.
d4855 1
a4855 1
2002-04-01  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4857 2
a4858 48
	* generic/tclEnv.c:
	* generic/tclIOUtil.c: invalidate filesystem cache when the
	user changes env(HOME).  Fixes [Bug #535621].  Also cleaned up
	some of the documentation.
	* tests/fileSystem.test: added test for bug just fixed.
	
2002-04-01  Kevin Kenny  <kennykb@@acm.org>

	* win/tclWinTime.c (Tcl_GetTime): made the checks of clock
	frequency more permissive to cope with the fact that Win98SE
	is observed to return 1.19318 in place of 1.193182 for the
	performance counter frequency.
	
2002-03-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclCmdMZ.c (Tcl_TraceObjCmd, TraceVarProc)
	(TraceCommandProc, TclTraceCommandObjCmd):  corrected
	potential double-free of traces on variables by flagging in
	Trace*Proc that it will free the var in case the eval wants to
	delete the var trace as well. [Bug #536937]
	Also converted Tcl_UntraceVar -> Tcl_UntraceVar2 and Tcl_Eval to
	Tcl_EvalEx in Trace*Proc for slight efficiency improvement.

2002-03-29  Don Porter  <dgp@@users.sourceforge.net>

	* doc/AllowExc.3:
	* generic/tclBasic.c (Tcl_EvalObjv,Tcl_EvalEx,Tcl_EvalObjEx):
	* generic/tclCompile.h (TclCompEvalObj):
	* generic/tclExecute.c (TclCompEvalObj,TclExecuteByteCode):
	* tests/basic.test: Corrected problems with Tcl_AllowExceptions
	having influence over the wrong scope of Tcl_*Eval* calls.  Patch
	from Miguel Sofer.  Report from Jean-Claude Wippler.  [Bug 219181]

2002-03-28  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclVar.c: Refactored CallTraces to collect repeated
	handling of its returned value into CallTraces itself.

2002-03-28  David Gravereaux <davygrvy@@pobox.com>

	* tools/feather.bmp:
	* tools/man2help.tcl:
	* tools/man2help2.tcl:
	* win/makefile.vc: More winhelp target fixups.  Added a feather
	bitmap to the non-scrollable area and changed the color to be
	yellow from a plain white.  The colors can be whatever we want
	them to be, but thought I would start with something bold.
	[Bug 527941]
d4860 4
a4863 3
	* doc/SetVar.3:
	* doc/TraceVar.3:
	* doc/UpVar.3:  .AP macro syntax repair.
d4865 1
a4865 1
2002-03-27  David Gravereaux <davygrvy@@pobox.com>
d4867 2
a4868 25
	* tools/man2help.tcl:
	* win/makefile.vc:  winhelp target now copies all needed files
	from tools/ to a workarea under $(OUT_DIR) and builds it from
	there.  No build cruft is left in tools/ anymore.  All paths
	used in man2help.tcl are now relative to where the script is.
	[Bug 527941]

2002-03-27  David Gravereaux <davygrvy@@pobox.com>

	* win/.cvsignore:
	* win/buildall.vc.bat:
	* win/coffbase.txt:
	* win/makefile.vc:
	* win/nmakehlp.c (new):
	* win/rules.vc:  First draft fix for [Bug 527941].  More changes
	need to done to the makehelp target to get to stop leaving build
	files in the tools/ directory.  This does not address the syntax
	errors in the man files.  Having the contents of tcl.hpj(.in)
	inside makefile.vc allows for version numbers to be replaced with
	macros.
	
	The new nmakehlp.c is built by rules.vc in preprocessing and removes
	the need to use tricky shell syntax that wasn't compatible on Win9x
	systems.  Clean targets made Win9x complient.  This is a first draft
	repair for [Bug 533862].
d4870 1
a4870 1
2002-03-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d4872 4
a4875 2
	* generic/tclBasic.c (Tcl_EvalEx): passing the correct commandSize
	to TclEvalObjvInternal. [Bug 219362], fix by David Knoll.
d4877 1
a4877 1
2002-03-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d4879 4
a4882 3
	* generic/tclBasic.c (Tcl_EvalEx):
	* tests/basic.test: avoid exceptional returns at level 0 
	[Bug 219181] 
d4884 2
a4885 1
2002-03-27  Don Porter  <dgp@@users.sourceforge.net>
d4887 1
a4887 5
	* doc/tcltest.n ([mainThread]):
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test:  Major code cleanup to deal with whitespace,
	coding conventions, and namespace issues, with several minor bugs
	fixed in the process.
d4889 2
a4890 1
	* tests/main.test: Added missing [after cancel]s.
d4892 2
a4893 1
2002-03-25  Don Porter  <dgp@@users.sourceforge.net>
d4895 1
a4895 1
	* tests/main.test: Removed workarounds for Bug 495977.
d4897 2
a4898 8
	* library/tcltest/tcltest.tcl:  Keep the value of $::auto_path
	unchanged, so that the tcltest package can test code that depends
	on auto-loading.  If a testing application needs $::auto_path pruned,
	it should do that itself.  [Bug 495726]
	Improve the processing of the -constraints option to [test] so that
	constraint lists can have arbitrary whitespace, and non-lists don't
	blow things up.  [Bug 495977]
	Corrected faulty variable initialization. [Bug 534845]
d4900 7
a4906 1
2002-03-25  Miguel Sofer  <msofer@@users.sourceforge.net>
d4908 1
a4908 3
	* doc/CrtTrace.3: small doc correction
	* generic/tclBasic.c (Tcl_DeleteTrace): Allow NULL callback on
	trace deletions [Bug 534728] (Hemang Lavana).
d4910 2
a4911 1
2002-03-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d4913 2
a4914 2
	* generic/tclBasic.c (Tcl_EvalObjv): replaced obscure, incorrect
	code as described in [Bug 533907] (Don Porter).
d4916 1
a4916 1
2002-03-24  Don Porter  <dgp@@users.sourceforge.net>
d4918 3
a4920 2
	* library/tcltest/tcltest.tcl:  Use [interpreter] to set/query the
	executable currently running the tcltest package.  [Bug 454050]
d4922 2
a4923 2
	* library/tcltest/tcltest.tcl:  Allow non-proc commands to be used
	as the customization hooks.  [Bug 495662]
d4925 2
a4926 1
2002-03-24  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4928 1
a4928 53
	* generic/tclFilename.c:
	* generic/tclFCmd.c:
	* generic/tclTest.c:
	* generic/tcl.h:
	* generic/tclIOUtil.c:
	* win/tclWinFile.c:
	* win/tclWinFCmd.c:
	* win/tclWinPipe.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixFCmd.c:
	* mac/tclMacFile.c:
	* doc/FileSystem.3:
	* doc/file.n:
	* tests/cmdAH.test:
	* tests/fileName.test:
	* tests/fileSystem.test: (new file)	
	* tests/winFCmd.test: fix [Bug 511666] and [Bug 511658],
	and improved documentation of some aspects of the filesystem,
	particularly 'Tcl_FSMatchInDirectory' which now might match
	a single file/directory only, and 'file normalize' which
	wasn't very clear before.  Removed inconsistency betweens
	docs and the Tcl_Filesystem structure.  Also fixed 
	[Bug 523217] and corrected file normalization on Unix so that 
	it expands symbolic links.  Added some new tests of the 
	filesystem code (in the new file 'fileSystem.test'), and 
	some extra tests for correct handling of symbolic links.
	Fix to [Bug 530960] which shows up on Win98.  Made comparison
	with ".com" case insensitive in tclWinPipe.c
	
	***POTENTIAL INCOMPATIBILITY***: But only between alpha
	releases (users of the new Tcl_Filesystem lookup table in Tcl
	8.4a4 need to handle the new way in which Tcl may call
	Tcl_FSMatchInDirectory, and 'file normalize' on unix now
	behaves correctly).  Only known impact is with the 'tclvfs'
	extension.

2002-03-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/basic.test (basic-46.1): adding test for [Bug 533758],
	fixed earlier today.
	
2002-03-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinInt.h: moved undef of TCL_STORAGE_CLASS. [Bug #478579]

2002-03-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_EvalObjEx):
	* generic/tclExecute.c (TclCompEvalObj): fixed the errorInfo for
	return codes other than (TCL_OK, TCL_ERROR) to runLevel 0 
	[Bug 533758]. Removed the static RecordTracebackInfo(), as its
	functionality is easily replicated by Tcl_LogCommandInfo. Bug
	and redundancy noted by Don Porter.
d4930 2
a4931 1
2002-03-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4933 5
a4937 1
	* doc/expr.n: Improved documentation for ceil and floor [Bug 530535]
d4939 1
a4939 1
2002-03-20  Don Porter  <dgp@@users.sourceforge.net>
d4941 24
a4964 21
	* doc/SetVar.3:
	* doc/TraceVar.3:
	* doc/UpVar.3:
	* generic/tcl.h (Tcl_VarTraceProc):
	* generic/tcl.decls (Tcl_GetVar2, Tcl_SetVar2, Tcl_TraceVar2,
	  Tcl_UnsetVar2, Tcl_UntraceVar2, Tcl_UpVar2, Tcl_VarTraceInfo2,
	  Tcl_GetVar2Ex, TclSetVar2Ex):
	* generic/tclCmdMZ.c (TraceVarProc):
	* generic/tclEnv.c (EnvTraceProc):
	* generic/tclEvent.c (VwaitVarProc):
	* generic/tclInt.decls (TclLookupVar,TclPrecTraceProc):
	* generic/tclLink.c (LinkTraceProc):
	* generic/tclUtil.c (TclPrecTraceProc):
	* generic/tclVar.c (CallTraces, MakeUpvar, VarErrMsg, TclLookupVar,
	  Tcl_GetVar2, Tcl_SetVar2, Tcl_TraceVar2, Tcl_UnsetVar2,
	  Tcl_UntraceVar2, Tcl_UpVar2, Tcl_VarTraceInfo2, Tcl_GetVar2Ex,
	  TclSetVar2Ex): Updated interfaces of generic/tclVar.c according
	to TIP 27.  In particular, the "part2" arguments were CONSTified.
	[Patch 532642]
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs
d4966 3
a4968 1
2002-03-15  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4970 1
a4970 3
	* tests/compile.test (compile-12.3): Test to detect bug 530320.
	* generic/tclCompile.c (TclCompileTokens): Fixed buffer overrun
	reported in bug 530320.
d4972 2
a4973 1
2002-03-14  Mo DeJong  <mdejong@@users.sourceforge.net>
d4975 2
a4976 12
	* win/configure: Regen.
	* win/configure.in: Add configure time test for SEH
	support in the compiler.
	* win/tclWin32Dll.c (ESP, EBP, TclpCheckStackSpace,
	_except_checkstackspace_handler):
	* win/tclWinChan.c (ESP, EBP, Tcl_MakeFileChannel,
	_except_makefilechannel_handler):
	* win/tclWinFCmd.c (ESP, EBP, DoRenameFile,
	_except_dorenamefile_handler,
	DoCopyFile, _except_docopyfile_handler):
	Implement SEH support under gcc using inline asm.
	Tcl and Tk should now compile with Mingw 1.1. [Patch 525746]
d4978 1
a4978 1
2002-03-14  Mo DeJong  <mdejong@@users.sourceforge.net>
d4980 2
a4981 6
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile): Handle
	an SEH exception with EXCEPTION_EXECUTE_HANDLER instead
	of restarting the faulting instruction with
	EXCEPTION_CONTINUE_EXECUTION. Bug 466102 provides an
	example of how restarting could send Tcl into an
	infinite loop. [Patch 525746]
d4983 1
a4983 1
2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d4985 3
a4987 4
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile, DoDeleteFile,
	DoRemoveJustDirectory): Make sure we don't pass NULL or ""
	as a path name to Win32 API functions since this was
	crashing under Windows 98.
d4989 2
a4990 1
2002-03-11  Don Porter  <dgp@@users.sourceforge.net>
d4992 1
a4992 2
	* library/tcltest/tcltest.tcl:
	* library/tcltest/pkgIndex.tcl: Bumped tcltest package to 2.0.2.
d4994 3
a4996 1
2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d4998 1
a4998 3
	* library/tcltest/tcltest.tcl (getMatchingFiles): Pass
	a proper list to foreach to avoid munging a Windows
	patch like D:\Foo\Bar into D:FooBar before the glob.
d5000 7
a5006 1
2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d5008 1
a5008 6
	* generic/tclEncoding.c: Fix typo in comment.
	* generic/tclIO.c (DoReadChars, ReadBytes, ReadChars):
	Use NULL value instead of pointer set to NULL to make
	things more clear. Reorder arguments so that they
	match the function signatures. Cleanup little typos
	and add more descriptive comment.
d5010 6
a5015 1
2002-03-08  Mo DeJong  <mdejong@@users.sourceforge.net>
d5017 1
a5017 4
	* win/README: Update to indicate that Mingw 1.1 is
	required to build Tcl. Add section describing new
	msys based build process. Update Cygwin build
	instructions so users know where to find Mingw 1.1.
d5019 1
a5019 1
2002-03-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d5021 8
a5028 1
	* win/tclWinFCmd.c (DoCopyFile): correctly set retval to TCL_OK.
d5030 1
a5030 1
2002-03-07  Mo DeJong  <mdejong@@users.sourceforge.net>
d5032 3
a5034 5
	* win/tclWin32Dll.c (TclpCheckStackSpace):
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile): Replace
	hard coded constants with Win32 symbolic names.
	Move control flow statements out of __try blocks
	since the documentation indicates it is frowned upon.
d5036 1
a5036 1
2002-03-07  Don Porter  <dgp@@users.sourceforge.net>
d5038 2
a5039 6
	* doc/interp.n:
	* generic/tclInterp.c(Tcl_InterpObjCmd,SlaveObjCmd,SlaveRecursionLimit):
	* generic/tclTest.c:
	* tests/interp.test: Added the [interp recursionlimit] command to
	set/query the recursion limit of an interpreter.  Proposal and
	implementation from Stephen Trier. [TIP 87, Patch 522849]
d5041 1
a5041 1
2002-03-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5043 1
a5043 5
	* generic/tcl.h, tools/tcl.wse.in, unix/configure.in,
	* unix/tcl.spec, win/README.binary, win/configure.in, README:
	Bumped patchlevel; this might need to change in the future, but it
	will help us distinguish between the CVS version and the most
	recent released version.
d5045 2
a5046 1
2002-03-06  Miguel Sofer  <msofer@@users.sourceforge.net>
d5048 1
a5048 3
	* generic/tclInt.h: for unshared objects, TclDecrRefCount now
	frees the internal rep before the string rep - just like the
	non-macro Tcl_DecrRefCount/TclFreeObj [Bug 524802]. 
d5050 3
a5052 1
2002-03-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5054 1
a5054 4
	* doc/lsearch.n: Documentation of new features, plus examples.
	* tests/lsearch.test: Tests of new features.
	* generic/tclCmdIL.c (Tcl_LsearchObjCmd): TIP#80 support.  See
	http://purl.org/tcl/tip/80 for details.
d5056 2
a5057 1
2002-03-05  Jeff Hobbs  <jeffh@@ActiveState.com>
d5059 9
a5067 1
	*** 8.4a4 TAGGED FOR RELEASE ***
d5069 1
a5069 4
	* unix/tclUnixChan.c: initial remedy for [Bug #525783] flush
	problem introduced by TIP #35.  This may not satisfy true serial
	channels, but it restores the correct flushing of std* channels on
	exit.
d5071 9
a5079 1
	* unix/README: added --enable-langinfo doc.
d5081 1
a5081 2
	* unix/tcl.spec:
	* tools/tcl.wse.in: fixed URL refs to use www.tcl.tk or SF.
d5083 1
a5083 1
2002-03-04  Jeff Hobbs  <jeffh@@ActiveState.com>
d5085 1
a5085 6
	* README:
	* mac/README:
	* unix/Makefile.in:
	* unix/README:
	* win/README:
	* win/README.binary: updated to use www.tcl.tk URL.
d5087 3
a5089 1
	* unix/Makefile.in: added older ChangeLogs to dist target.
d5091 1
a5091 7
	* tests/io.test:
	* tests/encoding.test: corrected iso2022 encoding results.
	added encoding-24.*
	* generic/tclEncoding.c (EscapeFromUtfProc): corrected output of
	escape codes as per RFC 1468. [Patch #474358] (taguchi)
	(TclFinalizeEncodingSubsystem): corrected potential double-free
	when encodings were finalized on exit. [Bug #219314, #524674]
d5093 2
a5094 1
2002-03-01  Jeff Hobbs  <jeffh@@ActiveState.com>
d5096 1
a5096 5
	* library/encoding/iso2022-jp.enc: 
	* library/encoding/iso2022.enc: 
	* tools/encoding/iso2022-jp.esc:
	* tools/encoding/iso2022.esc: gave <ESC>$B precedence over <ESC>$@@,
	based on comments (point 1) in [Bug #219283] (rfc 1468)
d5098 16
a5113 5
	* tests/encoding.test: added encoding-23.* tests
	* generic/tclIO.c (FilterInputBytes): reset the TCL_ENCODING_START
	flags in the ChannelState when using 'gets'. [Bug #523988]
	Also reduced the value of ENCODING_LINESIZE from 30 to 20 as this
	seems to improve the performance of 'gets' according to tclbench.
d5115 1
a5115 1
2002-02-28  Jeff Hobbs  <jeffh@@ActiveState.com>
d5117 2
a5118 3
	* generic/tclCmdMZ.c (TraceCommandProc): ensure that TraceCommandInfo
	structure was also deleted when a command was deleted to prevent a
	mem leak.
d5120 1
a5120 2
	* generic/tclBasic.c (Tcl_CreateObjTrace): set tracePtr->flags
	correctly.
d5122 1
a5122 2
	* generic/tclTimer.c (TimerExitProc): remove remaining events in
	tls on thread exit.
d5124 1
a5124 1
2002-02-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d5126 3
a5128 3
	* generic/tclNamesp.c: allow cached fully-qualified namespace
	names to be usable from different namespaces within the same
	interpreter without forcing a new lookup [Patch 458872]. 
d5130 1
a5130 1
2002-02-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d5132 1
a5132 2
	* generic/tclExecute.c: Replaced a few direct stack accesses 
	with the POP_OBJECT() macro [Bug 507181] (Don Porter).
d5134 1
a5134 1
2002-02-27  Don Porter  <dgp@@users.sourceforge.net>
d5136 1
a5136 8
	* doc/GetIndex.3:
	* generic/tcl.decls (Tcl_GetIndexFromObjStruct):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObjStruct):  Revised the
	prototype of the Tcl_GetIndexFromObjStruct to take its struct
	table as a (CONST VOID *) argument, better describing what it is,
	maintaining source compatibility, and adding CONST correctness
	according to TIP 27.  Thanks to Joe English for an elegant
	solution. [Bug 520304]
d5138 1
a5138 1
	* generic/tclDecls.h: make genstubs
d5140 1
a5140 3
	* generic/tclMain.c (Tcl_Main,StdinProc):  Corrected some reference
	count management errors on the interactive command Tcl_Obj found by
	Purify.  Thanks to Jeff Hobbs for the report and assistance.
d5142 1
a5142 1
2002-02-27  Jeff Hobbs  <jeffh@@ActiveState.com>
d5144 3
a5146 2
	* generic/tclBasic.c (Tcl_EvalTokensStandard): corrected mem leak
	in error case.
d5148 1
a5148 1
	* generic/tclTest.c (TestStatProc[123]): correct harmless UMRs.
d5150 2
a5151 1
	* generic/tclLink.c (Tcl_LinkVar): correct mem leak in error case.
d5153 1
a5153 1
2002-02-27  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5155 2
a5156 3
	* tests/socket.test (2.7): Accepted and applied patch for Tcl SF
	  bug #523470 provided by Don Porter <dgp@@users.sourceforge.net>
	  to avoid timing problems in that test.
d5158 1
a5158 8
	* unix/tclUnixChan.c (TclpOpenFileChannel): Added code to regonize
	  "/dev/tty" (by name) and to not handle it as tty / serial
	  line. This is the controlling terminal and is special. Setting
	  it into raw mode as is done for other tty's is a bad idea. This
	  is a hackish fix for expect SGF Bug #520624. The fix has
	  limitation: Tcl_MakeFileChannel handles tty's specially too, but
	  is unable to recognize /dev/tty as it only gets a file
	  descriptor, and no name for it.
d5160 1
a5160 1
2002-02-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d5162 1
a5162 1
	* generic/tclCmdAH.c (StoreStatData): corrected mem leak.
d5164 2
a5165 2
	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): prevent obj leak in
	  remedial regsub case.
d5167 1
a5167 2
	* generic/tclFileName.c (Tcl_TranslateFileName): decr refcount for
	  error case to prevent mem leak.
d5169 1
a5169 1
	* generic/tclVar.c (Tcl_ArrayObjCmd): removed extra obj allocation.
d5171 2
a5172 3
	* unix/tclUnixSock.c (Tcl_GetHostName): added an extra
	  gethostbyname check to guard against failure with truncated
	  names returned by uname.
d5174 1
a5174 3
	* unix/configure:
	* unix/tcl.m4 (SC_SERIAL_PORT): added sys/modem.h check and defined
	  _XOPEN_SOURCE_EXTENDED for HP-11 to get updated header decls.
d5176 2
a5177 2
	* unix/tclUnixChan.c: added Unix implementation of TIP #35, serial
	  port support. [Patch #438509] (schroedter)
d5179 1
a5179 1
2002-02-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d5181 3
a5183 4
	* generic/tclCmpCmds.c: (bugfix to the bugfix, hopefully the last)
	  Bugfix to the new [for] compiling code: was setting a
	  exceptArray parameter using another param which wasn't yet
	  initialised, thus filling it with noise.
d5185 1
a5185 1
2002-02-25  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5187 2
a5188 3
	* mac/tclMacSock.c (TcpGetOptionProc): Changed to recognize the
	  option "-error". Essentially ignores the option, always
	  returning an empty string.
d5190 1
a5190 1
2002-02-25  Jeff Hobbs  <jeffh@@ActiveState.com>
d5192 2
a5193 8
	* doc/Alloc.3:
	* doc/LinkVar.3:
	* doc/ObjectType.3:
	* doc/PkgRequire.3:
	* doc/Preserve.3:
	* doc/TCL_MEM_DEBUG.3: Updated documentation to describe the ckalloc,
	ckfree, ckrealloc, attemptckalloc, and attemptckrealloc macros, and
	to accurately describe when and how they are used. [Bug #497459] (dgp)
d5195 1
a5195 6
	* generic/tclHash.c (AllocArrayEntry, AllocStringEntry):
	Before invoking ckalloc when creating a Tcl_HashEntry,
	check that the amount of memory being allocated is
	at least as large as sizeof(Tcl_HashEntry). The previous
	code was allocating memory regions that were one
	or two bytes short. [Bug #521950] (dejong)
d5197 1
a5197 1
2002-02-25  Miguel Sofer  <msofer@@users.sourceforge.net>
d5199 1
a5199 4
	* generic/tclBasic.c (Tcl_EvalEx): avoiding a buffer overrun
	reported by Joe English, and restoring tcl7.6 behaviour for
	[subst]: badly terminated nested scripts will raise an error
	and not be evaluated. [Bug #495207]
d5201 1
a5201 1
2002-02-25  Don Porter  <dgp@@users.sourceforge.net>
d5203 1
a5203 4
	* unix/tclUnixPort.h: corrected strtoll prototype mismatch on Tru64.
	* compat/strtod.c (strtod): simplified #includes
	* compat/strtol.c (strtol): gather result in a long before returning
	as a long: necessary on platforms where sizeof(int) != sizeof(long).
d5205 1
a5205 1
2002-02-25  Daniel Steffen  <das@@users.sourceforge.net>
d5207 1
a5207 2
	* unix/tclLoadDyld.c: updated to use Mac OS X 10.1 dyld APIs that
	have more libdl-like semantics. (bug #514392)
d5209 1
a5209 1
2002-02-25  Miguel Sofer  <msofer@@users.sourceforge.net>
d5211 1
a5211 9
	* generic/tclCompCmds: fixing a bug in patch dated 2002-02-22, in
	the code for [for] and [while]. Under certain conditions, for long
	bodies, the exception range parameters were badly computed. Tests
	forthcoming: I still can't reproduce the conditions in the
	testsuite (!), although the bug (with assorted segfault or panic!)
	can be triggered from the console or with the new parse.bench in  
	tclbench.
	
2002-02-25  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5213 1
a5213 2
	* compat/strtoul.c, compat/strtol.c, compat/strtod.c: Added UCHAR,
	CONST and #includes to clean up GCC output.
d5215 1
a5215 1
2002-02-23  Don Porter  <dgp@@users.sourceforge.net>
d5217 2
a5218 5
	* compat/strtoull.c (strtoull):
	* compat/strtoll.c (strtoll):
	* compat/strtoul.c (strtoul): Fixed failure to handle leading
	sign symbols '+' and '-' and '0X' and raise overflow errors.
	[Bug 440916]  Also corrects prototype and errno problems.
d5220 1
a5220 1
2002-02-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d5222 2
a5223 4
	* configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Link with -n32
	instead of -32 when building on IRIX64-6.* system.
	[Tcl bug 521707]
d5225 3
a5227 1
2002-02-22  Don Porter <dgp@@users.sourceforge.net>
d5229 1
a5229 5
	* generic/tclInt.h:
	* generic/tclObj.c: renamed global variable emptyString ->
	tclEmptyString because it is no longer static.
	* generic/tclPkg.c: Fix for panic when library is loaded on a
	platform without backlinking without proper use of stubs. [Bug 476537]
d5231 3
a5233 1
2002-02-22  Jeff Hobbs  <jeffh@@ActiveState.com>
d5235 1
a5235 2
	* tests/regexpComp.test: updated regexp-11.[1-4] to match changes
	in regexp.test for new regsub syntax
d5237 2
a5238 3
	* unix/configure:
	* unix/tcl.m4: added --enable-64bit support for AIX-4 (using -q64
	flag) when using IBM's xlc compiler.
d5240 1
a5240 58
	* tests/safe.test: updated safe-8.5 and safe-8.7
	* library/safe.tcl (CheckFileName): removed the limit on
	sourceable file names (was only *.tcl or tclIndex files with no
	more than one dot and 14 chars).  There is enough internal
	protection in a safe interpreter already.  Fixes [Tk Bug #521560].

2002-02-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompCmds: [FR 465811]. Optimising [if], [for] and
	[while] for constant conditions; in addition, [for] and [while]
	are now compiled with the "loop rotation" optimisation (thanks to
	Kevin Kenny). 

2002-02-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	--- TIP#76 CHANGES ---
	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): Final-argument-less
	[regsub] returns the modified string.
	* doc/regsub.n: Updated docs.
	* tests/regexp.test: Updated and added tests.

	* compat/strtoll.c (strtoll): 
	* compat/strtoull.c (strtoull): 
	* unix/tclUnixPort.h:
	* win/tclWinPort.h: Const-ing 64-bit compatability declarations.
	Note that the return pointer is non-const because it is entirely
	legal for the functions to be called from somewhere that owns the
	string being passed.  Fixes problem reported by Larry Virden.

2002-02-21  David Gravereaux <davygrvy@@pobox.com>

	* win/mkd.bat (removed):
	* win/coffbase.txt (new):
	* win/makefile.bc:
	* win/makefile.vc:  Changed the 'setup' target to stop using
	the mkd.bat file and just make the directory right in the rule.
	Same change to makefile.bc.  configure.in nor Makefile.in use
	it.

	coffbase.txt will be the master list for our "prefered base
	addresses" set by the linker.  This should improve load-time
	(NT only) by avoiding relocations.  Submissions to the list
	by extension authors are encouraged.

	Added a 'tidy' target to compliment 'clean' and 'hose' to remove
	just the outputs. Also removed the $(winlibs) macro as it wasn't
	being used.

	Stuff left to do:
	1) get the winhelp target to stop building in the tools/
	directory.
	2) stop using rmd.bat
	3) add more dependacy rules.

	* win/tclAppInit.c:  Reverted back to -r1.6, as the header file
	change to tclPort.h won't allow for easy embedded support
	outside of the source dist.  Thanks to Don Porter for pointing
	this out to me.
d5242 1
a5242 1
2002-02-21  David Gravereaux <davygrvy@@pobox.com>
d5244 1
a5244 4
	* win/makefile.vc:
	* win/rules.vc:  Added a new "loimpact" option that sets the
	-ws:aggressive linker option.  Off by default.  It's said to
	keep the heap use low at the expense of alloc speed.
d5246 1
a5246 5
	* win/tclAppInit.c: Changed #include "tcl.h" to be tclPort.h to
	remove the raw windows.h include.  tclPort.h brings in windows.h
	already and lessens the pre-compiled-header mush and the randomly
	useless	#pragma comment (lib,...) references throughout the big
	windows.h tree (as observed at high linker warning levels).
d5248 2
a5249 1
2002-02-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5251 1
a5251 2
	* generic/tcl.h: Better guessing of LP64/ILP32 architecture, but
	now sensitive to presence of (suitable) <limits.h>
d5253 1
a5253 1
2002-02-20  Don Porter <dgp@@users.sourceforge.net>
d5255 1
a5255 5
	* generic/tcl.decls (Tcl_RegExpRange,Tcl_GetIndexFromObjStruct):
	Overlooked a few source incompatibilities.  Now using CONST84.
	* generic/tclDecls.h: make genstubs
	* generic/tcl.h (Tcl_CmdObjTraceProc): silence warning from Sun
	Workshop compiler.
d5257 1
a5257 1
2002-02-20  David Gravereaux <davygrvy@@pobox.com>
d5259 1
a5259 12
	* win/buildall.vc.bat:
	* win/makefile.vc:
	* win/rules.vc: General clean-ups.  Added compiler and linker tests
	for a) the pentium 0x0F errata, b) optimizing (not all have this),
	and c) linker v6 section alignment confusion.  All these are tested
	first to make sure any D4002 or LNK1117 warnings aren't displayed.
	The pentium 0x0F errata is a recommended switch.  The v5 linker's
	section alignment default is 512, but the v6 linker was changed
	to 4096 in an attempt to speed loading on Win98.  I changed the
	default to always be 512 across both linkers, unless linking
	statically, then 4096 is used for the claimed speed effect. Using
	a 512 alignment saves 12k bytes of dead space in the DLL.
d5261 3
a5263 1
	Added IA64 B-stepping errata switch when the compiler supports it.
d5265 1
a5265 2
	Added profiling to $(lflags) when requested and also removed the
	explict -entry option as the default works fine as is.
d5267 2
a5268 3
	Removed win/tclWinInit.c from the special case section to let it
	use the common implicit rule as the $(EXTFLAGS) macro it had was
	never referenced anywhere.
d5270 3
a5272 1
2002-02-20  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5274 1
a5274 3
	* generic/tcl.h: Added code to guess the correct settings for
	TCL_WIDE_INT_IS_LONG and TCL_WIDE_INT_TYPE when configure doesn't
	tell us them, as can happen with extensions.
d5276 7
a5282 1
2002-02-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5284 1
a5284 5
	* doc/format.n: Updated docs to list the specification.
	* generic/tclCmdAH.c (Tcl_FormatObjCmd): Made behaviour on 64-bit
	platforms correctly meet the specification, that %d works with the
	native word-sized integer, instead of trying to guess (wrongly)
	from the value being passed.
d5286 2
a5287 1
2002-02-19  Don Porter <dgp@@users.sourceforge.net>
d5289 1
a5289 1
	* changes: First draft of updated changes for 8.4a4 release.
d5291 2
a5292 1
2002-02-15  Jeff Hobbs  <jeffh@@ActiveState.com>
d5294 1
a5294 2
	* unix/tclUnixPort.h: add strtoll/strtoull declarations for
	platforms that do not define them.
d5296 2
a5297 2
	* generic/tclIndexObj.c (STRING_AT): removed ptrdiff_t cast and
	use of VOID* in default case (GNU-ism).
d5299 1
a5299 1
2002-02-15  Kevin Kenny  <kennykb@@acm.org>
d5301 2
a5302 109
	* compat/strtoll.c:
	* compat/strtoul.c:
	* compat/strtoull.c:
	* generic/tclIOUtil.c:
	* generic/tclPosixStr.c:
	* generic/tclTest.c:
	* generic/tclTestObj.c:
	* tests/get.test:
	* win/Makefile.vc: Further tweaks to the TIP 72 patch to make it
	compile under VC++.
	
2002-02-15  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tclExecute.c:
	* tclIOGT.c:
	* tclIndexObj.c: Touchups to the TIP 72 patch to make it
	  compileable under Windows again. The changes are not complete,
	  there is one nasty regarding _stati64

2002-02-15  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	+----------------------+
	| TIP #72 IMPLEMENTED. |
	+----------------------+

	There are a lot of changes from this TIP, so please see
	http://purl.org/tcl/tip/72.html for discussion of
	backward-compatability issues, but the main ones modifications are
	in:

	* generic/tcl.h: New types.
	* generic/tcl.decls: New public functions.
	* generic/tclExecute.c: 64-bit aware bytecode engine.
	* generic/tclBinary.c: 64-bit handling in [binary] command.
	* generic/tclScan.c: 64-bit handling in [scan] command.
	* generic/tclCmdAH.c: 64-bit handling in [file] and [format]
	commands.
	* generic/tclBasic.c: New "wordSize" entry in ::tcl_platform.
	* generic/tclFCmd.c: Large-file support (with many consequences.)
	* generic/tclIO.c: Large-file support (with many consequences.)
	* compat/strtoll.c, compat/strtoull.c: New support functions.
	* unix/tcl.m4, unix/configure: 64-bit support and greatly enhanced
	cacheing.

	Most other changes, including all those in doc/* and test/* as
	well as the majority in the platform directories, follow on from
	these.

	Also coming out of the woodwork:
	* generic/tclIndex.c: Better support for Cray PVP.
	* win/tclWinMtherr.c: Better Borland support.

	Note that, in a number of places through the Unix part of the
	platform support, there are Tcl_Platform* references.  These are
	expanded into the correct way to call that particular underlying
	function, i.e. with or without a '64' suffix, and should be used
	by people working on the core in preference to the API functions
	they overlay so that the code remains portable depending on the
	presence or absence of 64-bit support on the underlying platform.

	***POTENTIAL INCOMPATIBILITY***: Extracted from the TIP

	SUMMARY OF INCOMPATIBILITIES AND FIXES 
	======================================

	The behaviour of expressions containing constants that appear
	positive but which have a negative internal representation will
	change, as these will now usually be interpreted as wide
	integers. This is always fixable by replacing the constant with
	int(constant).

	Extensions creating new channel types will need to be altered as
	different types are now in use in those areas. The change to the
	declaration of Tcl_FSStat and Tcl_FSLstat (which are the new
	preferred API in any case) are less serious as no non-alpha
	releases have been made yet with those API functions.

	Scripts that are lax about the use of the l modifier in format and
	scan will probably need to be rewritten. This should be very
	uncommon though as previously it had absolutely no effect.

	Extensions that create new math functions that take more than one
	argument will need to be recompiled (the size of Tcl_Value
	changes), and functions that accept arguments of any type
	(TCL_EITHER) will need to be rewritten to handle wide integer
	values. (I do not expect this to affect many extensions at all.)

2002-02-14  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIOCmd.c (Tcl_GetsObjCmd): Trivial fix for bug
	  #517503, a memory leak reported by Miguel Sofer
	  <msofer@@users.sourceforge.net>. The leak happens if an error
	  occurs for "set var [gets $chan]" and leak one empty object.

2002-02-12  David Gravereaux <davygrvy@@pobox.com>

	* djgpp/ (new directory)
	* djgpp/Makefile (new):
	* unix/tclAppInit.c:
	* unix/tclMtherr.c:
	* unix/tclUnixFCmd.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixInit.c:
	* unix/tclUnixPort.h:  Early stage of DJGPP support for building
	Tcl on DOS.  Dynamic loading isn't working, yet.  Requires watt32
	for the TCP/IP stack.  No autoconf, yet.  Barely tested, but
	makes a working exe that runs Tcl in protected-mode, flat memory.
	[exec] and pipes will need the most work as multi-tasking on DOS
	has to be carefully.
d5304 1
a5304 1
2002-02-10  Kevin Kenny  <kennykb@@acm.org>
d5306 1
a5306 10
	* doc/CrtObjCmd.3:
	* doc/CrtTrace.3:
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclBasic.c:
	* generic/tclInt.h:
	* generic/tclTest.c:
	* tests/basic.test: Added Tcl_CreateObjTrace,
	Tcl_GetCommandInfoFromToken and Tcl_SetCommandInfoFromToken.
	(TIPs #32 and #79.)
d5308 1
a5308 4
	* generic/tclDecls.h:
	* generic/tclStubInit.c: Regenerated Stubs tables.
	
2002-02-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d5310 6
a5315 8
	* unix/configure:
	* unix/tcl.m4: added -pthread for FreeBSD to EXTRA_CFLAGS and
	LDFLAGS.  Also triggered nodots only for FreeBSD-3.
	Added AC_DEFINE(_POSIX_PTHREAD_SEMANTICS) for Solaris.

	* unix/tclUnixPort.h:
	* unix/tclUnixThrd.c: added thread-safe versions of readdir,
	localtime, gmtime and inet_ntoa for threaded build. (jgdavidson)
d5317 1
a5317 2
	* generic/tclScan.c (Tcl_ScanObjCmd): prevented ckfree being
	called on a pointer to NULL.
d5319 1
a5319 1
2002-02-07  Don Porter <dgp@@users.sourceforge.net>
d5321 1
a5321 30
	* doc/DString.3:
	* doc/Encoding.3:
	* doc/GetCwd.3:
	* doc/SplitPath.3:
	* doc/Translate.3:
	* doc/Utf.3:
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclEncoding.c:
	* generic/tclEnv.c:
	* generic/tclFileName.c:
	* generic/tclIOUtil.c:
	* generic/tclUtf.c:
	* generic/tclUtil.c:
	* mac/tclMacInit.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixInit.c:
	* unix/tclUnixPipe.c:
	* win/tclWin32Dll.c:
	* win/tclWinFCmd.c:
	* win/tclWinFile.c:
	* win/tclWinInit.c: Partial TIP 27 rollback.  Following routines
	restored to return (char *): Tcl_DStringAppend,
	Tcl_DStringAppendElement, Tcl_JoinPath, Tcl_TranslateFileName,
	Tcl_ExternalToUtfDString, Tcl_UtfToExternalDString,
	Tcl_UniCharToUtfDString, Tcl_GetCwd, Tcl_WinTCharToUtf.  Also
	restored Tcl_WinUtfToTChar to return (TCHAR *) and 
	Tcl_UtfToUniCharDString to return (Tcl_UniChar *).  Modified
	some callers.  This change recognizes that Tcl_DStrings are
	de-facto white-box objects.
d5323 2
a5324 2
	* generic/tclDecls.h:
	* generic/tclPlatDecls.h: make genstubs
d5326 1
a5326 1
	* generic/tclCmdMZ.c: corrected use of C++-style comment.
d5328 2
a5329 1
2002-02-06  Jeff Hobbs  <jeffh@@ActiveState.com>
d5331 1
a5331 14
	* tests/scan.test:
	* generic/tclScan.c (Tcl_ScanObjCmd): corrected scan 0x... %x
	handling that didn't accept the 0x as a prelude to a base 16
	number.  [Bug #495213]

	* generic/tclCompCmds.c (TclCompileRegexpCmd): made early check
	for bad RE to stop checking further.

	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): added special case to
	search for simple 'string map' style regsub calls.
	Delayed creation of resultPtr object until an initial match is
	made, as the input string object can then be reused for no matches.
	(Tcl_StringObjCmd): optimization improvements to the STR_MAP
	algorithm for zero-length and nocase cases.
d5333 3
a5335 2
	* tests/regexp.test:
	* tests/regexpComp.test: extra code coverage tests.
d5337 1
a5337 1
	* tests/string.test: added 10.18 and 10.19 extra tests.
d5339 1
a5339 1
	* generic/regc_locale.c (casecmp): slight performance improvement.
d5341 1
a5341 1
2002-02-05  Don Porter <dgp@@users.sourceforge.net>
d5343 4
a5346 3
	* library/http/http.tcl:
	* library/http/pkgIndex.tcl:  Corrected use of http::error when
	::error was intended.  Bump to http 2.4.2.
d5348 1
a5348 1
2002-02-04  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5350 2
a5351 6
	* unix/tclUnixChan.c (FileOutputProc): Fixed [bug 465765] reported
	  by Dale Talcott <daletalcott@@users.sourceforge.net>. Avoid
	  writing nothing into a file as STREAM based implementations will
	  consider this a EOF (if the file is a pipe). Not done in the
	  generic layer as this type of writing is actually useful to
	  check the state of a socket.
d5353 3
a5355 3
	* doc/open.n: Fixed [Bug 511540], added cross-reference to 'pid'
	  as the command to use to retrieve the pid of a command pipeline
	  created via 'open'.
d5357 1
a5357 1
2002-02-01  Jeff Hobbs  <jeffh@@ActiveState.com>
d5359 2
a5360 2
	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): handle quirky about case
	earlier to avoid shimmering problem.
d5362 1
a5362 1
2002-02-01  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5364 2
a5365 3
	* tests/io.test: io-39.22 split into two tests, one platform
	  dependent, the other not. -eofchar is not empty on the windows
	  platform.
d5367 1
a5367 1
2002-02-01  Vince Darley <vincentdarley@@users.sourceforge.net>
d5369 4
a5372 2
	* generic/tclTest.c: fix to picky windows compiler problem
	  with the 'MainLoop' function declaration.
d5374 1
a5374 1
2002-01-31  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5376 2
a5377 2
	* win/tclWinFCmd.c: TIP 27: Applied patch fixing CONST warnings on
	  behalf of Don Porter <dgp@@users.sourceforge.net>.
d5379 1
a5379 1
2002-01-30  Don Porter <dgp@@users.sourceforge.net>
d5381 1
a5381 41
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclInt.h: For each interface identified in the TIP 27
	  changes below as a POTENTIAL INCOMPATIBILITY, the source of the
	  incompatibility has been parameterized so that it can be
	  removed.  When compiling extension code against the Tcl header
	  files, use the compiler flag -DUSE_NON_CONST to remove the
	  irresolvable source incompatibilities introduced by the TIP 27
	  changes.  Resolvable changes are left for extension authors to
	  resolve.
	* generic/tclDecls.h: make genstubs

2002-01-30  Vince Darley <vincentdarley@@users.sourceforge.net>

	* doc/FileSystem.3: added documentation for 3 public
	functions which had been overlooked.  Fixes [Bug 507701].
	* unix/mkLinks: make mklinks

2002-01-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/regexpComp.test:
	* generic/tclCompCmds.c (TclCompileRegexpCmd): enhanced to support
	-nocase and -- options.

2002-01-28  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tcl.m4 (SC_LOAD_TCLCONFIG):
	* win/tcl.m4 (SC_LOAD_TCLCONFIG): Set TCL_LIB_SPEC,
	TCL_STUB_LIB_SPEC, and TCL_STUB_LIB_PATH to the
	values of TCL_BUILD_LIB_SPEC, TCL_BUILD_STUB_LIB_SPEC,
	and TCL_BUILD_STUB_LIB_PATH when tclConfig.sh is loaded
	from the build directory. A Tcl extension should
	make use of the non-build versions of these variables
	since they will work in both cases. This modification
	was described in TIP 34.

2002-01-28  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinReg.c (regConnectRegistryProc,RecursiveDeleteKey)
	(DeleteKey,GetKeyNames,GetType,GetValue,OpenSubKey,SetValue):
	redid the CONSTification as previous changes caused failing tests.
d5383 1
a5383 11
	* tests/regexpComp.test (new):
	* generic/tclInt.h:
	* generic/tclBasic.c: added TclCompileRegexpCmd entry
	* generic/tclCompCmds.c (TclCompileStringCmd): corrected to return
	TCL_OUT_LINE_COMPILE instead of TCL_ERROR for parsing errors, so
	it only throws the error for runtime compile, in case the user
	modifies 'string'.
	(TclCompileRegexpCmd): first try at a byte-compiled regexp
	command.  It handles static strings and ^$ bounded static strings.
	(TclCompileAppendCmd): made TclPushVarName call always use
	TCL_CREATE_VAR as numWords is always > 2 at that point.
d5385 2
a5386 2
	* generic/tclExecute.c (TclExecuteByteCode:INST_LIST): correct
	possibly dangerous decr in macro call.
d5388 1
a5388 1
	* win/tclWinInit.c (TclpFindVariable): CONSTification touch-up
d5390 1
a5390 2
	* win/tclWinReg.c (OpenSubKey): corrected bug introduced in
	CONSTification that dropped pointer reference.
d5392 1
a5392 3
	* ChangeLog.2000 (new file):
	* ChangeLog: broke changes from 2000 into ChangeLog.2000 to reduce
	  size of the main ChangeLog.
d5394 1
a5394 1
2002-01-28  David Gravereaux <davygrvy@@pobox.com>
d5396 1
a5396 3
	* generic/tclPlatDecls.h:  Added preprocessor logic to force a
	typedef of TCHAR when __STDC__ is defined when using the uncommon
	-Za compiler switch with the microsoft compiler.
d5398 1
a5398 1
2002-01-27  Don Porter <dgp@@users.sourceforge.net>
d5400 1
a5400 2
	* doc/package.n: Documented global namespace context for script
	evaluation by [package require].
d5402 1
a5402 1
2002-01-27  Daniel Steffen  <das@@users.sourceforge.net>
d5404 1
a5404 9
	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* mac/tclMacChan.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacInit.c:
	* mac/tclMacLoad.c:
	* mac/tclMacResource.c:
	* mac/tclMacSock.c: TIP 27 CONSTification induced changes
d5406 5
a5410 3
	* tests/event.test:
	* tests/main.test: added catches/constraints to test that
	use features that don't exist on the mac.
d5412 1
a5412 1
2002-01-25  Mo DeJong  <mdejong@@users.sourceforge.net>
d5414 2
a5415 127
	Make -eofchar and -translation options read only for
	server sockets. [Bug 496733]
	
	* generic/tclIO.c (Tcl_GetChannelOption, Tcl_SetChannelOption):
	Instead of returning nothing for the -translation option
	on a server socket, always return "auto". Return the empty
	string enclosed in quotes for the -eofchar option on
	a server socket. Fixup -eofchar usage message so that
	it matches the implementation.
	* tests/io.test: Add -eofchar tests and -translation tests
	to ensure options are read only on server sockets.
	* tests/socket.test: Update tests to account for -eofchar
	and -translation option changes.

2002-01-25  Don Porter <dgp@@users.sourceforge.net>

	* compat/strstr.c (strstr):
	* generic/tclCmdAH.c (Tcl_FormatObjCmd):
	* generic/tclCmdIL.c (InfoNameOfExecutableCmd):
	* generic/tclEnv.c (ReplaceString):
	* generic/tclFileName.c (ExtractWinRoot):
	* generic/tclIO.c (FlushChannel,Tcl_BadChannelOption):
	* generic/tclStringObj.c (AppendUnicodeToUtfRep):
	* generic/tclThreadTest.c (TclCreateThread):
	* generic/tclUtf.c (Tcl_UtfPrev):
	* mac/tclMacFCmd.c (TclpObjListVolumes):
	* mac/tclMacResource.c (TclMacRegisterResourceFork,
	  BuildResourceForkList):
	* win/tclWinInit.c (AppendEnvironment):  Sought out and eliminated
	instances of CONST-casting that are no longer needed after the
	TIP 27 effort.

	* Following is [Patch 501006]
	* generic/tclInt.decls (Tcl_AddInterpResolvers, Tcl_Export,
	  Tcl_FindNamespace, Tcl_GetInterpResolvers, Tcl_ForgetImport,
	  Tcl_Import, Tcl_RemoveInterpResolvers):
	* generic/tclNamesp.c (Tcl_Export, Tcl_Import, Tcl_ForgetImport,
	  Tcl_FindNamespace):
	* generic/tclResolve.c (Tcl_AddInterpResolvers,Tcl_GetInterpResolvers,
	  Tcl_RemoveInterpResolvers): Updated APIs in generic/tclResolve.c
	and generic/tclNamesp.c according to the guidelines of TIP 27.
	* generic/tclIntDecls.h: make genstubs

	* Following is [Patch 505630]
	* doc/AddErrorInfo.3:
	* generic/tcl.decls (Tcl_LogCommandInfo):
	* generic/tclBasic.c (Tcl_LogCommandInfo): Updated interfaces
	of generic/tclBasic.cc according to TIP 27.
	* generic/tclDecls.h: make genstubs

	* Following is [Patch 506818]
	* doc/Hash.3:
	* generic/tcl.decls (Tcl_HashStats):
	* generic/tclHash.c (Tcl_HashStats):  Updated APIs of generic/tclHash.c
	according to guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs
	* generic/tclVar.c (Tcl_ArrayObjCmd): Updated callers.

	* Following is [Patch 506807]
	* doc/ObjectType.3:
	* generic/tcl.decls (Tcl_GetObjType):
	* generic/tclObj.c (Tcl_GetObjType): Updated APIs of generic/tclObj.c
	according to guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs

	* Following is [Patch 507304]
	* doc/Encoding.3:
	* generic/tcl.decls (Tcl_WinUtfToTChar,Tcl_WinTCharToUtf):
	* win/tclWin32Dll.c (Tcl_WinUtfToTChar,Tcl_WinTCharToUtf):
	Updated interfaces in win/tclWin32Dll.c according to TIP 27.
	* generic/tclPlatDecls.h: make genstubs
	* generic/tclIOUtil.c (TclpNativeToNormalized):
	* win/tclWinFCmd.c (TclpObjNormalizePath):
	* win/tclWinFile.c (TclpFindExecutable,TclpMatchInDirectory,
	  NativeIsExec,NativeStat):
	* win/tclWinLoad.c (TclpLoadFile):
	* win/tclWinPipe.c (TclpOpenFile,ApplicationType):
	* win/tclWinReg.c (regConnectRegistryProc,RecursiveDeleteKey,DeleteKey,
	  GetKeyNames,GetType,GetValue,OpenSubKey,SetValue):
	* win/tclWinSerial.c (SerialSetOptionProc): Update callers.

	* Following is [Patch 505072]
	* doc/Concat.3:
	* doc/Encoding.3:
	* doc/Filesystem.3:
	* doc/Macintosh.3:
	* doc/OpenFileChnl.3
	* doc/SetResult.3:
	* doc/SetVar.3:
	* doc/SplitList.3:
	* doc/SplitPath.3:
	* doc/Translate.3:
	* generic/tcl.h (Tcl_FSMatchInDirectoryProc):
	* generic/tclInt.h (TclpMatchInDirectory):
	* generic/tcl.decls (Tcl_Concat,Tcl_GetStringResult,Tcl_GetVar,
	  Tcl_GetVar2,Tcl_JoinPath,Tcl_Merge,Tcl_OpenCommandChannel,Tcl_SetVar,
	  Tcl_SetVar2,Tcl_SplitList,Tcl_SplitPath,Tcl_TranslateFileName,
	  Tcl_ExternalToUtfDString,Tcl_GetEncodingName,Tcl_UtfToExternalDString,
	  Tcl_GetDefaultEncodingDir,Tcl_SetDefaultEncodingDir,
	  Tcl_FSMatchInDirectory,Tcl_MacEvalResource,Tcl_MacFindResource):
	* generic/tclInt.decls (TclCreatePipeline,TclGetEnv,TclpGetCwd,
	  TclpCreateProcess):
	* mac/tclMacFile.c (TclpGetCwd):
	* generic/tclEncoding.c (Tcl_GetDefaultEncodingDir,
	  Tcl_SetDefaultEncodingDir,Tcl_GetEncodingName,
	  Tcl_ExternalToUtfDString,Tcl_UtfToExternalDString, OpenEncodingFile,
	  LoadEscapeEncoding):
	* generic/tclFileName.c (DoTildeSubst,Tcl_JoinPath,Tcl_SplitPath,
	  Tcl_TranslateFileName): 
	* generic/tclIOUtil.c (Tcl_FSMatchInDirectory):
	* generic/tclPipe.c (FileForRedirect,TclCreatePipeline,
	  Tcl_OpenCommandChannel):
	* generic/tclResult.c (Tcl_GetStringResult):
	* generic/tclUtil.c (Tcl_Concat,Tcl_SplitList,Tcl_Merge):
	* generic/tclVar.c (Tcl_GetVar,Tcl_GetVar2,Tcl_SetVar,Tcl_SetVar2):
	* mac/tclMacResource.c (Tcl_MacEvalResource,Tcl_MacFindResource):
	Updated interfaces of generic/tclEncoding, generic/tclFilename.c,
	generic/tclIOUtil.c, generic/tclPipe.c, generic/tclResult.c,
	generic/tclUtil.c, generic/tclVar.c and mac/tclMacResource.c according
	to TIP 27.  Tcl_TranslateFileName rewritten as wrapper around
	VFS-aware version.
	***POTENTIAL INCOMPATIBILITY*** 
	Includes source incompatibilities: argv arguments of Tcl_Concat,
	Tcl_JoinPath, Tcl_OpenCommandChannel, Tcl_Merge; argvPtr arguments of
	Tcl_SplitList and Tcl_SplitPath.
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs
d5417 1
a5417 52
	* generic/tclCkalloc.c (MemoryCmd):
	* generic/tclClock.c (FormatClock):
	* generic/tclCmdAH.c (Tcl_CaseObjCmd,Tcl_EncodingObjCmd,Tcl_FileObjCmd):
	* generic/tclCmdIL.c (InfoLibraryCmd,InfoPatchLevelCmd,
	  InfoTclVersionCmd):
	* generic/tclCompCmds.c (TclCompileForeachCmd):
	* generic/tclCompCmds.h (TclCompileForeachCmd):
	* generic/tclCompile.c (TclFindCompiledLocal):
	* generic/tclEnv.c (TclSetupEnv,TclSetEnv,Tcl_PutEnv,TclGetEnv,
	  EnvTraceProc):
	* generic/tclEvent.c (Tcl_BackgroundError):
	* generic/tclIO.c (Tcl_BadChannelOption,Tcl_SetChannelOption):
	* generic/tclIOCmd.c (Tcl_ExecObjCmd,Tcl_OpenObjCmd):
	* generic/tclIOSock.c (TclSockGetPort):
	* generic/tclIOUtil.c (SetFsPathFromAny):
	* generic/tclLink.c (LinkTraceProc):
	* generic/tclMain.c (Tcl_Main):
	* generic/tclNamesp.c (TclTeardownNamespace):
	* generic/tclProc.c (TclCreateProc):
	* generic/tclTest.c (TestregexpObjCmd,TesttranslatefilenameCmd,
	  TestchmodCmd,GetTimesCmd,TestsetCmd,TestOpenFileChannelProc1,
	  TestOpenFileChannelProc2,TestOpenFileChannelProc3,AsyncHandlerProc,
	  TestpanicCmd):
	* generic/tclThreadTest.c (ThreadErrorProc,ThreadEventProc):
	* generic/tclUtil.c (TclPrecTraceProc):
	* mac/tclMacFCmd.c (GetFileSpecs):
	* mac/tclMacFile.c (TclpMatchInDirectory):
	* mac/tclMacInit.c (TclpInitLibraryPath,Tcl_SourceRCFile):
	* mac/tclMacOSA.c (tclOSAStore,tclOSALoad):
	* mac/tclMacResource.c (Tcl_MacEvalResource):
	* unix/tclUnixFCmd.c (TclpObjNormalizePath):
	* unix/tclUnixFile.c (TclpMatchInDirectory,TclpGetUserHome,TclpGetCwd,
	  TclpReadLink):
	* unix/tclUnixInit.c (TclpInitLibraryPath,TclpSetVariables,
	  Tcl_SourceRCFile):
	* unix/tclUnixPipe.c (TclpOpenFile,TclpCreateTempFile,
	  TclpCreateProcess):
	* win/tclWinFile.c (TclpGetCwd,TclpMatchInDirectory):
	* win/tclWinInit.c (TclpInitLibraryPath,Tcl_SourceRCFile,
	  TclpSetVariables):
	* win/tclWinPipe.c (TclpCreateProcess): Updated callers.

2002-01-24  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclIOUtil.c (SetFsPathFromAny):  Corrected tilde-substitution
	of pathnames where > 1 separator follows the ~.  [Bug 504950]

2002-01-24  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/http/pkgIndex.tcl:
	* library/http/http.tcl: don't add port in default case to handle
	broken servers.  http bumped to 2.4.1  [Bug #504508]
d5419 1
a5419 1
2002-01-23  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5421 4
a5424 16
	* unix/mkLinks: Regenerated.
	* doc/CrtChannel.3:
	* doc/ChnlStack.3: Moved documentation for 'Tcl_GetTopChannel'
	  from 'CrtChannel' to 'ChnlStack'. Added documentation of
	  'Tcl_GetStackedChannel'. Bug #506147 reported by Mark Patton
	  <msp@@users.sourceforge.net>.

2002-01-23  Don Porter <dgp@@users.sourceforge.net>

	* win/tclWinFile.c (NativeAccess,NativeStat,NativeIsExec,
	  TclpGetUserHome):
	* win/tclWinPort.h (TclWinSerialReopen):
	* win/tclWinSerial.c (TclWinSerialReopen):
	* win/tclWinSock.c (Tcl_OpenTcpServer):  Corrections to earlier
	TIP 27 changes.  Thanks to Andreas Kupries for the feedback.
	* generic/tclPlatDecls.h: make genstubs
d5426 1
a5426 48
	* doc/GetHostName.3:
	* doc/GetOpnFl.3:
	* doc/OpenTcp.3:
	* tcl.decls (Tcl_GetHostName,Tcl_GetOpenFile,Tcl_OpenTcpClient,
	  Tcl_OpenTclServer):
	* mac/tclMacSock.c (CreateSocket,Tcl_OpenTcpClient,Tcl_OpenTcpServer,
	  Tcl_GetHostName,GetHostFromString):
	* unix/tclUnixChan.c (CreateSocket,CreateSocketAddress,
	  Tcl_OpenTcpClient,Tcl_OpenTcpServer,Tcl_GetOpenFile):
	* unix/tclUnixSock.c (Tcl_GetHostName):
	* win/tclWinSock.c (CreateSocket,CreateSocketAddress,
	  Tcl_OpenTcpClient,Tcl_OpenTcpServer,Tcl_GetHostName):
	Updated socket interfaces according to TIP 27.
	* generic/tclCmdIL.c (InfoHostnameCmd): Updated callers.
	* generic/tclDecls.h: make genstubs

2002-01-21  David Gravereaux <davygrvy@@pobox.com>

	* generic/tclLoadNone.c: TclpLoadFile() didn't match proto of
	  typedef Tcl_FSLoadFileProc.  OK'd by vincentdarley.
	  [Patch #502488]

2002-01-21  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIO.c (WriteChars): Fix for SF #506297, reported by
	  Martin Forssen <ruric@@users.sourceforge.net>. The encoding
	  chosen in the script exposing the bug writes out three intro
	  characters when TCL_ENCODING_START is set, but does not consume
	  any input as TCL_ENCODING_END is cleared. As some output was
	  generated the enclosing loop calls UtfToExternal again, again
	  with START set. Three more characters in the out and still no
	  use of input ... To break this infinite loop we remove
	  TCL_ENCODING_START from the set of flags after the first call
	  (no condition is required, the later calls remove an unset flag,
	  which is a no-op). This causes the subsequent calls to
	  UtfToExternal to consume and convert the actual input.

2002-01-21  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclTest.c: Converted declarations of TestReport file system
	  to more portable form.  [Bug 501417].

	* generic/tcl.decls (Tcl_TraceCommand,Tcl_UntraceCommand,
	  Tcl_CommandTraceInfo):
	* generic/tclCmdMZ.c (Tcl_TraceCommand,Tcl_UntraceCommand,
	  Tcl_CommandTraceInfo): Updated APIs in generic/tclCmdMZ.c 
	  according to the guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs
d5428 1
a5428 1
2002-01-18  Don Porter <dgp@@users.sourceforge.net>
d5430 1
a5430 3
	* win/tclWinChan.c:
	* win/tclWinFCmd.c:
	* win/tclWinFile.c: Overlooked callers of Tcl_FSGetNativePath
d5432 1
a5432 2
	* win/tclWinDde.c:
	* win/tclWinReg.c: Overlooked callers of Tcl_GetIndexFromObj
d5434 1
a5434 1
2002-01-18  Daniel Steffen  <das@@users.sourceforge.net>
d5436 3
a5438 31
	* generic/tclThreadTest.c:
	* mac/tclMacChan.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacLoad.c:
	* mac/tclMacResource.c: TIP 27 CONSTification broke the mac
	  build in a number of places.

2002-01-17  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIOCmd.c (Tcl_GetsObjCmd): Fixed bug #504642 as
	  reported by Brian Griffin <bgriffin@@users.sourceforge.net>,
	  using his patch. Before the patch the generic I/O layer held an
	  unannounced reference to the interp result to store the read
	  line into. This unfortunately has disastrous results if the
	  channel driver executes a tcl script to perform its operation,
	  this freeing the interp result. In that case we are
	  dereferencing essentially a dangling reference. It is not truly
	  dangling because the object is in the free list, but this only
	  causes us to smash the free list and have the error occur later
	  somewhere else. The patch simply creates a new object for the
	  line and later sets it into the interp result when we are done
	  with reading.

2002-01-16  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tcl.m4 (SC_LOAD_TCLCONFIG):
	* win/tcl.m4 (SC_LOAD_TCLCONFIG): Subst TCL_DBGX
	into TCL_STUB_LIB_FILE and TCL_STUB_LIB_FLAG
	variables so that an extension does not need
	to subst TCL_DBGX into its makefile. [Tk Bug 504356]
d5440 1
a5440 1
2002-01-16  Don Porter <dgp@@users.sourceforge.net>
d5442 7
a5448 47
	* doc/FileSystem.3:
	* doc/GetCwd.3:
	* doc/GetIndex.3:
	* generic/tcl.decls (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_GetCwd, Tcl_FSFileAttrStrings, Tcl_FSGetNativePath,
	  Tcl_FSGetTranslatedStringPath):
	* generic/tcl.h (Tcl_FSFileAttrStringsProc):
	* generic/tclFCmd.c (TclFileAttrsCmd):
	* generic/tclIOUtil.c (Tcl_GetCwd,NativeFileAttrStrings,
	  Tcl_FSFileAttrStrings,Tcl_FSGetTranslatedStringPath,
	  Tcl_FSGetNativePath):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObj,Tcl_GetIndexFromObjStruct):
	More TIP 27 updates in tclIOUtil.c and tclIndexObj.c that were
	overlooked before.  [Patch 504671]
	***POTENTIAL INCOMPATIBILITY*** 
	Includes a source incompatibility in the tablePtr arguments of
	the Tcl_GetIndexFromObj* routines.
	* generic/tclDecls.h: make genstubs

	* generic/tclBinary.c (Tcl_BinaryObjCmd):
	* generic/tclClock.c (Tcl_ClockObjCmd):
	* generic/tclCmdAH.c (Tcl_EncodingObjCmd, Tcl_FileObjCmd):
	* generic/tclCmdIL.c (Tcl_InfoObjCmd,Tcl_LsearchObjCmd,Tcl_LsortObjCmd):
	* generic/tclCmdMZ.c (Tcl_TraceObjCmd,Tcl_RegexpObjCmd,Tcl_RegsubObjCmd,
	  Tcl_StringObjCmd,Tcl_SubstObjCmd,Tcl_SwitchObjCmd,
	  TclTraceCommandObjCmd,TclTraceVariableObjCmd):
	* generic/tclCompCmds.c (TclCompileStringCmd):
	* generic/tclEvent.c (Tcl_UpdateObjCmd):
	* generic/tclFileName.c (Tcl_GlobObjCmd):
	* generic/tclIO.c (Tcl_FileEventObjCmd):
	* generic/tclIOCmd.c (Tcl_SeekObjCmd,Tcl_ExecObjCmd,Tcl_SocketObjCmd,
	  Tcl_FcopyObjCmd):
	* generic/tclInterp.c (Tcl_InterpObjCmd,SlaveObjCmd):
	* generic/tclNamesp.c (Tcl_NamespaceObjCmd):
	* generic/tclPkg.c (Tcl_PackageObjCmd):
	* generic/tclTest.c (Tcltest_Init,TestencodingObjCmd,TestgetplatformCmd,
	  TestlocaleCmd,TestregexpObjCmd,TestsaveresultCmd,
	  TestGetIndexFromObjStructObjCmd,TestReportFileAttrStrings):
	* generic/tclTestObj.c (TestindexObjCmd,TeststringObjCmd):
	* generic/tclTimer.c (Tcl_AfterObjCmd):
	* generic/tclVar.c (Tcl_ArrayObjCmd):
	* mac/tclMacFCmd.c (SetFileFinderAttributes):
	* unix/tclUnixChan.c (TclpOpenFileChannel):
	* unix/tclUnixFCmd.c (tclpFileAttrStrings):
	* unix/tclUnixFile.c (TclpObjAccess,TclpObjChdir,TclpObjStat,
	  TclpObjLstat):
	* win/tclWinFCmd.c (tclpFileAttrStrings): Updated callers.
d5450 1
a5450 15
	* doc/RegExp.3:
	* doc/Utf.3:
	* generic/tcl.decls:
	* generic/tclInt.decls:
	* generic/tclRegexp.c:
	* generic/tclUtf.c:  Updated APIs in generic/tclUtf.c and
	generic/tclRegexp.c according to the guidelines of TIP 27.
	[Patch 471509]

	* generic/regc_locale.c (element,cclass):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd):
	* generic/tclFileName.c (TclpGetNativePathType,SplitMacPath):
	* generic/tclIO.c (ReadChars):
	* mac/tclMacLoad.c (TclpLoadFile):
	* win/tclWinFile.c (TclpGetUserHome): Updated callers.
d5452 3
a5454 2
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs
d5456 1
a5456 60
	* doc/ParseCmd.3 (Tcl_ParseVar):
	* generic/tcl.decls (Tcl_ParseVar):
	* generic/tclParse.c (Tcl_ParseVar):
	* generic/tclTest.c (TestparsevarObjCmd): Updated APIs in
	generic/tclParse.c according to the guidelines of TIP 27.  Updated
	callers.  [Patch 501046]
	* generic/tclDecls.h: make genstubs

	* generic/tcl.decls (Tcl_RecordAndEval):
	* generic/tclDecls.h: make genstubs
	* generic/tclHistory.c (Tcl_RecordAndEval): Updated APIs in
	generic/tclHistory.c according to the guidelines of TIP 27.
	[Patch 504091]

	* doc/CrtSlave.3:
	* generic/tcl.decls (Tcl_CreateAlias, Tcl_CreateAliasObj,
	  Tcl_CreateSlave, Tcl_GetAlias, Tcl_GetAliasObj, Tcl_GetSlave):
	* generic/tclInterp.c (Tcl_CreateAlias, Tcl_CreateAliasObj,
	  Tcl_CreateSlave, Tcl_GetAlias, Tcl_GetAliasObj, Tcl_GetSlave):
	Updated APIs in the file generic/tclInterp.c according to the
	guidelines of TIP 27.  [Patch 501371]
	***POTENTIAL INCOMPATIBILITY*** 
	Includes a source incompatibility in the targetCmdPtr arguments of
	the Tcl_GetAlias* routines.

	* generic/tclDecls.h: make genstubs

2002-01-15  Don Porter <dgp@@users.sourceforge.net>

	* doc/SetErrno.3 (Tcl_ErrnoMsg): Corrected documentation for
	Tcl_ErrnoMsg; it takes an integer argument.  Thanks to Georgios
	Petasis.  [Bug 468183]

	* doc/AddErrInfo.3 (Tcl_PosixError):
	* doc/Eval.3 (Tcl_EvalFile):
	* doc/FileSystem.c (Tcl_FSOpenFileChannel,Tcl_FSOpenFileChannelProc):
	* doc/OpenFileChnl.3 (Tcl_OpenFileChannel):
	* doc/SetErrno.3 (Tcl_ErrnoId,Tcl_ErrnoMsg):
	* doc/Signal.3 (Tcl_SignalId,Tcl_SignalMsg):
	* generic/tcl.decls (Tcl_ErrnoId,TclErrnoMsg,Tcl_EvalFile,
	  Tcl_OpenFileChannel,Tcl_PosixError,Tcl_SignalId,Tcl_SignalMsg,
	  Tcl_FSOpenFileChannel):
	* generic/tcl.h (Tcl_FSOpenFileChannelProc):
	* generic/tclIO.c (FlushChannel):
	* generic/tclIOUtil.c (Tcl_OpenFileChannel,Tcl_EvalFile,TclGetOpenMode,
	  Tcl_PosixError,Tcl_FSOpenFileChannel):
	* generic/tclInt.decls (TclGetOpenMode):
	* generic/tclInt.h (TclOpenFileChannelProc_,TclGetOpenMode,
	  TclpOpenFileChannel):
	* generic/tclPipe.c (TclCleanupChildren):
	* generic/tclPosixStr.c (Tcl_ErrnoId,Tcl_ErrnoMsg,Tcl_SignalId,
	  Tcl_SignalMsg):
	* generic.tclTest.c (PretendTclpOpenFileChannel,
	  TestOpenFileChannelProc1,TestOpenFileChannelProc2,
	  TestOpenFileChannelProc3,TestReportOpenFileChannel):
	* mac/tclMacChan.c (TclpOpenFileChannel):
	* unix/tclUnixChan.c (TclpOpenFileChannel):
	* win/tclWinChan.c (TclpOpenFileChannel): Updated APIs in
	  generic/tclIOUtil.c and generic/tclPosixStr.c according to the
	  guidelines of TIP 27.  Updated callers.  [Patch 499196]
d5458 2
a5459 2
	* generic/tclDecls.h:
	* generic/tclIntDecls.h: make genstubs
d5461 1
a5461 30
	* doc/CrtChannel.3:
	* doc/OpenFileChnl.3:
	* generic/tcl.decls:
	* generic/tclIO.h:
	* generic/tclIO.c (DoWrite, Tcl_RegisterChannel, Tcl_GetChannel,
	  Tcl_CreateChannel, Tcl_GetChannelName, CloseChannel, Tcl_Write,
	  Tcl_WriteRaw, Tcl_Ungets, Tcl_BadChannelOption, Tcl_GetChannelOption,
	  Tcl_SetChannelOption, Tcl_GetChannelNamesEx, Tcl_ChannelName):
	Updated APIs in the file generic/tclIO.c according to the guidelines
	of TIP 27.  Several minor documentation corrections as well.
	[Patch 503565]
	* generic/tclDecls.h: make genstubs

	* generic/tcl.h (Tcl_DriverOutputProc, Tcl_DriverGetOptionProc,
	  Tcl_DriverSetOptionProc):
	* generic/tclIOGT.c (TransformOutputProc, TransformGetOptionProc,
	  TransformSetOptionProc):
	* mac/tclMacChan.c (FileOutput, StdIOOutput):
	* man/tclMacSock.c (TcpGetOptionProc, TcpOutput):
	* unix/tclUnixChan.c (FileOutputProc, TcpGetOptionProc, TcpOutputProc,
	  TtyGetOptionProc, TtySetOptionProc):
	* unix/tclUnixPipe.c (PipeOuputProc):
	* win/tclWinChan.c (FileOutputProc):
	* win/tclWinConsole.c (ConsleOutputProc):
	* win/tclWinPipe.c (PipeOuputProc):
	* win/tclWinSerial.c (SerialOutputProc, SerialGetOptionProc,
	  SerialSetOptionProc):
	* win/tclWinSock.c (TcpGetOptionProc, TcpOutput): Updated channel
	driver interface according to the guidelines of TIP 27.  See also
	[Bug 500348].
d5463 3
a5465 9
	* doc/CrtChannel.3:
	* generic/tcl.h:
	* generic/tclIO.c:
	* generic/tclIO.h:
	* generic/tclInt.h:
	* tools/checkLibraryDoc.tcl:
	Moved Tcl_EolTranslation enum declaration from generic/tcl.h to
	generic/tclInt.h (renamed to TclEolTranslation).  It is not used
	anywhere in Tcl's public interface.
d5467 1
a5467 1
2002-01-14  Don Porter <dgp@@users.sourceforge.net>
d5469 1
a5469 8
	* doc/GetIndex.3:
	* doc/WrongNumArgs.3:
	* generic/tcl.decls (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_WrongNumArgs):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_WrongNumArgs):  Updated APIs in the file generic/tclIndexObj.c
	according to the guidelines of TIP 27.  [Patch 501491]
	* generic/tclDecls.h: make genstubs
d5471 1
a5471 1
2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d5473 2
a5474 5
	* unix/configure: Regen.
	* unix/configure.in:
	* win/configure: Regen.
	* win/configure.in: Use ${libdir} instead of ${exec_prefix}/lib
	to properly support the --libdir option to configure. [Bug 489370]
d5476 1
a5476 1
2002-01-11  Andreas Kupries  <andreas_kupries@@users.sourceforge.net> 
d5478 1
a5478 105
	* win/tclWinSerial.c (SerialSetOptionProc): Applied patch for SF
	  bug #500348 supplied by Rolf Schroedter
	  <schroedter@@users.sourceforge.net>. The function modified the
	  contents of the the 'value' string and now does not do this
	  anymore. This is a followup to the change made on 2001-12-17.

2002-01-11  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.vc: Removed -GD compiler option.  It was intended
	for future use, but MS is again changing the future at their whim.
	The D4002 warning was harmless though, but someone using VC .NET
	logged it as a concern.  [Bug #501565]

2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Burn Tcl build directory
	into tcltest executable to avoid crashes caused
	by ld loading a previously installed version
	of the tcl shared library. [Bug 218110]

2002-01-10  Don Porter <dgp@@users.sourceforge.net>,
	Kevin Kenny <kennykb@@users.sourceforge.net>
	
	* unix/tclLoadDld.c (TclpLoadFile):  syntax error: unbalanced
	parens.  Kevin notes that it's far from clear that this file is
	ever included in an actual build; Linux without dlopen appears to
	be a nonexistent configuration.
	
2002-01-08  Don Porter <dgp@@users.sourceforge.net>,
	Kevin Kenny <kennykb@@users.sourceforge.net>

	* doc/StaticPkg.3 (Tcl_StaticPackage):
	* generic/tcl.decls (Tcl_StaticPackage):
	* generic/tclDecls.h (Tcl_StaticPackage):
	* generic/tclInt.decls (TclGuessPackageName):
	* generic/tclInt.h (TclGuessPackageName):
	* generic/tclLoad.c (Tcl_StaticPackage):
	* generic/tclLoadNone.c (TclGuessPackageName):
	* mac/tclMacLoad.c (TclGuessPackageName):
	* unix/tclLoadAout.c (TclGuessPackageName):
	* unix/tclLoadDl.c (TclGuessPackageName):
	* unix/tclLoadDld.c (TclGuessPackageName):
	* unix/tclLoadDyld.c (TclGuessPackageName):
	* unix/tclLoadNext.c (TclGuessPackageName):
	* unix/tclLoadOSF.c (TclGuessPackageName):
	* unix/tclLoadShl.c (TclGuessPackageName):
	* win/tclWinLoad.c (TclGuessPackageName):  Updated APIs in 
	the files */tcl*Load*.c according to the guidelines of TIP 27.
	[Patch 501096]

2002-01-09  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclTest.c (MainLoop):
	* tests/main.test (Tcl_Main-1.{3,4,5,6}):  Corrected some non-portable
	tests from the new Tcl_Main changes.  Thanks to Kevin Kenny.

2002-01-07  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclEvent.c (TclInExit):
	* generic/tclIOUtil.c (SetFsPathFromAbsoluteNormalized,
	  SetFsPathFromAny,Tcl_FSNewNativePath,DupFsPathInternalRep):
	* generic/tclListObj.c (TclLsetList,TclLsetFlat):  Added some type
	casts to satisfy picky compilers.

	* generic/tclMain.c:  Bug fix: neglected the NULL case in
	TclGetStartupScriptFileName().  Broke Tk/wish.

2002-01-05  Don Porter <dgp@@users.sourceforge.net>

	* doc/Tcl_Main.3:
	* generic/tclMain.c:  Substantial rewrite and expanded documentation
	of Tcl_Main to correct a number of bugs and flaws:

		* Interactive Tcl_Main can now enter a main loop, exit
		  that loop and continue interactive operations.  The loop
		  may even exit in the midst of interactive command typing
		  without loss of the partial command.  [Bugs 486453, 474131]
		* Tcl_Main now gracefully handles deletion of its master
		  interpreter.
		* Interactive Tcl_Main can now operate with non-blocking stdin
		* Interactive Tcl_Main can now detect EOF on stdin even in
		  mid-command.  [Bug 491341]
		* Added VFS-aware internal routines for managing the
		  startup script selection.
		* Tcl variable 'tcl_interactive' is now linked to C variable
		  'tty' so that one can disable/enable interactive prompts
		  at the script level when there is no startup script.  This
		  is meant for use by the test suite.
		* Consistent use of the Tcl libraries standard channels as
		  returned by Tcl_GetStdChannel(); as opposed to the channels
		  named 'stdin', 'stdout', and 'stderr' in the master interp,
		  which can be different or unavailable.
		* Tcl_Main now calls Tcl_Exit() if evaluation of [exit] in the
		  master interpreter returns, assuring Tcl_Main does not return.
		* Documented Tcl_Main's absence from public stub table
		* Documented that Tcl_Main does not return.
		* Documented Tcl variables set by Tcl_Main.
		* All prompts are done from a single procedure, Prompt.
		* Use of Tcl_Obj-enabled interfaces everywhere.

	* generic/tclInt.decls (TclGetStartupScriptPath,
	  TclSetStartupScriptPath): New internal VFS-aware routines for
	managing the startup script of Tcl_Main.
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c: make genstubs
d5480 1
a5480 5
	* generic/tclTest.c (TestsetmainloopCmd,TestexitmainloopCmd,
	  Tcltest_Init,TestinterpdeleteCmd):
	* tests/main.test (new):  Added new file to test suite that
	thoroughly tests generic/tclMain.c; added some new test commands
	for testing Tcl_SetMainLoop().
a5481 1
2002-01-04  Don Porter <dgp@@users.sourceforge.net>
a5482 62
	* doc/Alloc.3:
	* doc/Concat.3:
	* doc/CrtMathFnc.3:
	* doc/Hash.3:
	* doc/Interp.3:
	* doc/LinkVar.3:
	* doc/ObjectType.3:
	* doc/PkgRequire.3:
	* doc/Preserve.3:
	* doc/SetResult.3:
	* doc/SplitList.3:
	* doc/SplitPath.3:
	* doc/TCL_MEM_DEBUG.3: Updated documentation to describe the ckalloc,
	ckfree, ckrealloc, attemptckalloc, and attemptckrealloc macros, and
	to accurately describe when and how they are used.  [Bug 497459]

	* generic/tclThreadJoin.c (TclRememberJoinableThread,TclJoinThread):
	Replaced Tcl_Alloc and Tcl_Free calls with ckalloc and ckfree so that
	memory debugging is supported.

2002-01-04  Daniel Steffen <das@@users.sourceforge.net>

	* mac/tclMacTime.c (TclpGetTZName): fix for daylight savings TZName bug

2002-01-03  Don Porter <dgp@@users.sourceforge.net>

	* doc/FileSystem.3:
	* generic/tclIOUtil.c: Updated some old uses of "fileName" to
	new VFS terminology, "pathPtr".

2002-01-03  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/basic.test (basic-39.4): Greatly simplified test while
	still leaving it so that it crashes when run without the fix to
	the [foreach] implementation.
	* generic/tclCmdAH.c (Tcl_ForeachObjCmd): Stopped Bug #494348 from
	happening by not trying to be so clever with cacheing; if nothing
	untoward is happening anyway, the less efficient technique will
	only add a few instruction cycles (one function call and a few
	derefs/assigns per list per iteration, with no change in the
	number of tests) and if something odd *is* going on, the code is
	now far more robust.

	* tests/basic.test (basic-39.4): Reproducable script from Bug #494348

2002-01-02  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/util.test (Wrapper_Tcl_StringMatch,util-5.*): Rewrote so
	the test is performed with the right internal function since
	[string match] no longer uses Tcl_StringCaseMatch internally.

	* tests/string.test (string-11.51):
	* generic/tclUtf.c (Tcl_UniCharCaseMatch):
	* generic/tclUtil.c (Tcl_StringCaseMatch): Fault with matching
	case-insensitive non-ASCII patterns containing upper case
	characters.  [Bug #233257]

	******************************************************************
	*** CHANGELOG ENTRIES FOR 2001 IN "ChangeLog.2001"             ***
	*** CHANGELOG ENTRIES FOR 2000 IN "ChangeLog.2000"             ***
	*** CHANGELOG ENTRIES FOR 1999 AND EARLIER IN "ChangeLog.1999" ***
	******************************************************************
@


1.25.4.3
log
@Merge drow-cplus-merge-20040208 to drow-cplus-branch.
@
text
@a0 7
2004-01-21  Keith Seitz  <kseitz@@uglyboxes.com>

	From tcl repository:
	2003-10-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
	* generic/tclCmdAH.c (Tcl_FileObjCmd): Changed FILE_ prefix to FCMD_
	to stop symbol/#def clashes on Cygwin/Mingw32 on NT.

@


1.25.2.1
log
@Import Tcl 8.4.0 into mainline-like sources. Simplest Tcl build possible for
cygwin.
@
text
@d1 1
a1 1
2002-09-10  Daniel Steffen  <das@@users.sourceforge.net>
d3 2201
a2203 5
	* unix/Makefile.in: added DYLIB_INSTALL_DIR variable for macosx
	and set it to default value ${LIB_RUNTIME_DIR}
	* unix/tcl.m4 (Darwin): use DYLIB_INSTALL_DIR instead of
	LIB_RUNTIME_DIR in the -install_name argument to ld.
	* unix/configure: regen.
d2205 15
a2219 7
	* macosx/Tcl.pbproj/project.pbxproj:
	* macosx/Makefile: added support for building Tcl as an embedded
	framework, i.e. using an dyld install_name containing
	@@executable_path/../Frameworks via the new DYLIB_INSTALL_DIR
	unix/Makefile variable.
	
2002-09-10  Jeff Hobbs  <jeffh@@ActiveState.com>
d2221 2
a2222 1
	*** 8.4.0 TAGGED FOR RELEASE ***
d2224 3
a2226 1
2002-09-06  Don Porter  <dgp@@users.sourceforge.net>
d2228 2
a2229 2
	* doc/file.n:  Format correction, and clarified [file normalize]
	returns an absolute path.
d2231 4
a2234 1
	* doc/tcltest.n:  Added examples section, as long promised.
d2236 1
a2236 1
2002-09-06  Reinhard Max  <max@@suse.de>
d2238 1
a2238 1
	* tests/tcltest.test: Added nonRoot flag to tests 8.3, 8.4, and 8.12.
d2240 1
a2240 1
2002-09-05  Don Porter  <dgp@@users.sourceforge.net>
d2242 3
a2244 1
	* doc/tcltest.n:  Clarified phrasing.
d2246 2
a2247 4
	* generic/tclBasic.c (TclRenameCommand,CallCommandTraces):
	* tests/trace.test (trace-27.1): Corrected memory leak when a rename
	trace deleted the command being traced.  Test added.  Thanks to
	Hemang Lavana for the fix.  [Bug 604609]
d2249 2
a2250 2
	* generic/tclVar.c (TclDeleteVars):  Corrected logic for setting the
	TCL_INTERP_DESTROYED flag when calling variable traces. [Tk Bug 605121]
d2252 2
a2253 1
2002-09-04  Miguel Sofer  <msofer@@users.sourceforge.net>
d2255 1
a2255 2
	* generic/tclVar.c (DeleteArray): leak plug [Bug 604239]. Thanks
	to dkf and dgp for the long and difficult discussion in the chat.
d2257 8
a2264 1
2002-09-03  Jeff Hobbs  <jeffh@@ActiveState.com>
d2266 4
a2269 1
	* generic/tclVar.c (Tcl_UpVar2): code cleanup to not use goto
d2271 4
a2274 2
	* unix/configure: remove -pthread from LIBS on FreeBSD in thread
	* unix/tcl.m4:    enabled build. [Bug #602849]
d2276 1
a2276 1
2002-09-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d2278 1
a2278 4
	* generic/tclInterp.c (AliasCreate): a Tcl_Obj was leaked on error
	return from TclPreventAliasLoop.
	
2002-09-03  Daniel Steffen  <das@@users.sourceforge.net>
d2280 2
a2281 2
	* macosx/Tcl.pbproj/project.pbxproj: Bumped version number to
	8.4.0 and updated copyright info.
d2283 3
a2285 1
2002-09-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d2287 1
a2287 2
	* generic/tclVar.c (Tcl_UpVar2): a Tcl_Obj was being leaked on
	error return from TclGetFrame.
d2289 3
a2291 1
2002-09-03  Don Porter  <dgp@@users.sourceforge.net>
d2293 13
a2305 1
	* changes:  Updated changes for 8.4.0 release.
d2307 1
a2307 1
2002-09-02  Jeff Hobbs  <jeffh@@ActiveState.com>
d2309 2
a2310 2
	* unix/tclUnixFile.c (TclpObjLink): removed unnecessary/unfreed
	extra native char*.
d2312 2
a2313 2
	* unix/tclUnixChan.c (Tcl_MakeTcpClientChannel): make sure to init
	flags field of TcpState ptr to 0.
d2315 3
a2317 3
	* unix/configure:
	* unix/tcl.m4: added 64-bit gcc compilation support on HP-11.
	[Patch #601051] (martin)
d2319 1
a2319 9
	* README:		Bumped version number to 8.4.0
	* generic/tcl.h:
	* tools/tcl.wse.in:
	* unix/configure:
	* unix/configure.in:
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure:
	* win/configure.in:
d2321 2
a2322 3
	* generic/tclInterp.c (SlaveCreate): make sure that the memory and
	checkmem commands are initialized in non-safe slave interpreters
	when TCL_MEM_DEBUG is used. [Bug #583445]
d2324 3
a2326 3
	* win/tclWinConsole.c (ConsoleCloseProc): only wait on writable
	pipe if there was something to write.  This may prevent infinite
	wait on exit.
d2328 1
a2328 2
	* tests/exec.test: marked exec-18.1 unixOnly until the Windows
	incompatability (in the test, not the core) can be resolved.
d2330 1
a2330 2
	* tests/http.test (http-3.11): added close $fp that was causing an
	error on Windows because the file was not closed before deleting.
d2332 4
a2335 2
	* unix/tclUnixInit.c (Tcl_MacOSXGetLibraryPath): made this static
	function only appear when HAVE_CFBUNDLE is defined.
d2337 45
a2381 1
2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>
d2383 1
a2383 2
	* unix/tcl.m4: added TK_SHLIB_LD_EXTRAS analogue of existing
	TCL_SHLIB_LD_EXTRAS for linker settings only used when linking Tk.
d2385 12
a2396 1
	* unix/configure: regen
d2398 1
a2398 1
2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>
d2400 6
a2405 1
	*** macosx-8-4-branch merged into the mainline [tcl patch #602770] ***
d2407 1
a2407 1
	* generic/tcl.decls: added new macosx specific entry to stubs table.
d2409 2
a2410 6
	* tools/genStubs.tcl: added generation of platform guards for
	macosx. This is a little more complex than it seems, because MacOS
	X IS "unix" plus a little bit, for the purposes of Tcl. BUT
	unfortunately, Tk uses "unix" to mean X11. So added platform keys
	for macosx (the little added to "unix"), "aqua" and "x11" to
	distinguish these for Tk.
d2412 63
a2474 18
	* generic/tcl.h: added a #ifnded RESOURCE_INCLUDED so that tcl.h
	can be passed to the resource compiler.
	
	* generic/tcl.h:
	* generic/tclNotify.c: added a few Notifier procs, to be able to
	modify more bits of the Tcl notifier dynamically. Required to get
	Mac OS X Tk to live on top of the Tcl Unix threaded notifier.
	Changes the size of the Tcl_NotifierProcs structure, but doesn't
	move any elements around.

	* unix/tclUnixNotfy.c: moved the call to Tcl_ConditionNotify till
	AFTER we are done mucking with the pointer swap. Fixes cases where
	the thread waiting on the condition wakes & accesses the
	waitingListPtr before it gets reset, causing a hang.

	* library/auto.tcl (tcl_findLibrary): added checking the
	directories in the tcl_pkgPath for library files on macosx to
	enable support of the standard Mac OSX library locations
d2476 17
a2492 21
	* unix/Makefile.in:
	* unix/configure.in:
	* unix/tcl.m4: added MAC_OSX_DIR.  Added PLAT_OBJS to the OBJS:
	there are some MacOS X specific files now for Tcl, and when I get
	he resource & applescript stuff ported over, and restore support
	for FindFiles, etc, there will be a few more.
	Added LD_LIBRARY_PATH_VAR configure variable to avoid having to set
	all possible LD_LIBRARY_PATH analogues on all platforms.
	LD_LIBRARY_PATH_VAR is "LD_LIBRARY_PATH" by default, "LIBPATH" on
	AIX, "SHLIB_PATH" on HPUX and "DYLD_LIBRARY_PATH" on Mac OSX.
	Added configure option to package Tcl as a framework on Mac OSX.

	* macosx/tclMacOSXBundle.c (new): support for finding Tcl extension
	packaged as 'bundles' in the standard Mac OSX library locations.

	* unix/tclUnixInit.c: added support for findig the tcl script
	library inside Tcl packaged as a framework on Mac OSX.

	* macosx/Tcl.pbproj/jingham.pbxuser (new):
	* macosx/Tcl.pbproj/project.pbxproj (new): project for Apple's
	ProjectBuilder IDE.
d2494 5
a2498 2
	* macosx/Makefile (new): simple makefile for building the project
	from the command line via the ProjectBuilder tool 'pbxbuild'.
d2500 31
a2530 3
	* unix/configure:
	* generic/tclStubInit.c:
	* generic/tclPlatDecls.h: regen
d2532 1
a2532 1
2002-08-29  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d2534 5
a2538 3
	* win/tclWinThrd.c (TclpFinalizeThreadData, TclWinFreeAllocCache):
	  Applied patch for bug #599428, provided by Miguel Sofer
	  <msofer@@users.sourceforge.net>.
d2540 1
a2540 1
2002-08-28  David Gravereaux <davygrvy@@pobox.com>
d2542 11
a2552 8
	* generic/tclEnv.c:
	* unix/configure.in:
	* win/tclWinPort.h:  putenv() on some systems copies the buffer
	rather than taking reference to it.  This causes memory leaks
	and is know to effect mswindows (msvcrt) and NetBSD 1.5.2 .  This
	patch tests for this behavior and turns on -DHAVE_PUTENV_THAT_COPIES=1
	when approriate.  Thanks to David Welton for assistance.
	[Bug 414910]
d2554 1
a2554 1
	* unix/configure: regen'd
d2556 4
a2559 1
2002-08-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d2561 1
a2561 1
	* doc/eval.n: Added mention of list command and corrected "SEE ALSO".
d2563 2
a2564 3
	* unix/configure.in: Cache handling of ac_cv_type_socklen_t was
	wrong. [Bug 600931] reported by John Ellson.  Fixed by putting the
	brackets where they belong.
d2566 66
a2631 1
2002-08-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d2633 7
a2639 3
	* generic/tclCompCmds.c: fix for [Bug 599788] (error in element
	name causing segfault), reported by Tom Wilkason. Fixed by copying
	the tokens instead of the source string.
d2641 5
a2645 1
2002-08-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d2647 3
a2649 2
	* generic/tclThreadAlloc.c: small optimisation, reducing the
	new allocator's overhead.
d2651 15
a2665 1
2002-08-23  Miguel Sofer  <msofer@@users.sourceforge.net>
d2667 1
a2667 2
	* generic/tclObj.c (USE_THREAD_ALLOC): fixed leak [Bug 597936]. 
	Thanks to Zoran Vasiljevic.
d2669 1
a2669 1
2002-08-23  Miguel Sofer  <msofer@@users.sourceforge.net>
d2671 1
a2671 2
	* generic/tclThreadAlloc.c (USE_THREAD_ALLOC): moving objects
	between caches as a block, instead of one-by-one.
d2673 2
a2674 1
2002-08-22  Miguel Sofer  <msofer@@users.sourceforge.net>
d2676 6
a2681 3
	* generic/tclBasic.c:
	* generic/tclCmdMZ.c: fix for freed memory r/w in delete traces
	[Bug 589863], patch by Hemang Lavana.
d2683 2
a2684 1
2002-08-20  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d2686 1
a2686 8
	* win/Makefile.in (CFLAGS): 
	* unix/Makefile.in (MEM_DEBUG_FLAGS): Added usage of @@MEM_DEBUG_FLAGS@@.
	* win/configure.in:
	* unix/configure.in: Added usage of SC_ENABLE_MEMDEBUG.
	* win/tcl.m4:
	* unix/tcl.m4: Added macro SC_ENABLE_MEMDEBUG. Allows a user of
	  configure to (de)activate memory validation and debugging
	  (TCL_MEM_DEBUG). No need to modify the makefile anymore.
d2688 7
a2694 1
2002-08-20  Don Porter  <dgp@@users.sourceforge.net>
d2696 86
a2781 1
	* generic/tclCkalloc.c:	CONSTified MemoryCmd and CheckmemCmd.
a2782 3
	* README:		Bumped version number to 8.4b3 to distinguish
	* generic/tcl.h:	HEAD from the 8.4b2 release.
	* tools/tcl.wse.in:
d2784 22
a2805 3
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure.in:
d2807 4
a2810 2
	* unix/configure:	autoconf
	* win/configure:
d2812 1
a2812 8
	* library/http/http.tcl:	Corrected installation directory of
	* library/msgcat/msgcat.tcl:	the package tcltest 2.2.  Added
	* library/opt/optparse.tcl:	comments in other packages to remind
	* library/tcltest/tcltest.tcl:	that installation directories need 
	* unix/Makefile.in:		updates to match increasing version
	* win/Makefile.in:		numbers. [Bug 597450]
	* win/makefile.bc:
	* win/makefile.vc:
d2814 2
a2815 1
2002-08-19  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d2817 1
a2817 2
	* unix/tclUnixTest.c (TestfilehandlerCmd): Changed
	  readable/writable to the more common readable|writable.
d2819 5
a2823 2
	  Fixes SF #596034 reported by Larry Virden
	  <lvirden@@users.sourceforge.net>.
d2825 2
a2826 12
2002-08-16  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/fCmd.test: Added test to make sure that the cause of the
	problem is detectable with an unpatched Tcl.
	* doc/ObjectType.3: Added note on the root cause of this problem
	to the documentation, since it is possible for user code to
	trigger this sort of behaviour too.
	* generic/tclIOUtil.c (SetFsPathFromAny): Objects should only have
	their old representation deleted when we know that we are about to
	install a new one.  This stops a weird TclX bug under Linux with
	certain kinds of memory debugging enabled which essentally came
	down to a double-free of a string.
d2828 2
a2829 1
2002-08-14  Miguel Sofer  <msofer@@users.sourceforge.net>
d2831 2
a2832 7
	* generic/tclInt.h:
	* generic/tclObj.c: (code cleanup) factored the parts in the macros 
	TclNewObj() / TclDecrRefCount() into a common part for all
	memory allocators and two new macros TclAllocObjStorage() /
	TclFreeObjStorage() that are specific to each allocator and fully
	describe the differences. Removed allocator-specific code from
	tclObj.c by using the macros.
d2834 1
a2834 1
2002-08-12  Miguel Sofer  <msofer@@users.sourceforge.net>
d2836 4
a2839 1
	* generic/tclCmdMZ.c: fixing UMR in delete traces, [Bug 589863].
d2841 1
a2841 1
2002-08-08  David Gravereaux <davygrvy@@pobox.com>
d2843 4
a2846 2
	* tools/man2help.tcl: Fixed $argv handling bug where if -bitmap
	wasn't specified $argc was off by one.
d2848 2
a2849 1
2002-08-08  Miguel Sofer  <msofer@@users.sourceforge.net>
d2851 5
a2855 2
	* tests/uplevel.test: added 6.1 to test [uplevel] with shadowed
	commands [Bug 524383]
d2857 1
a2857 1
	* tests/subst.test: added 5.8-10 as further tests for [Bug 495207] 
d2859 6
a2864 1
2002-08-08  Don Porter  <dgp@@users.sourceforge.net>
d2866 1
a2866 1
	* tests/README: Noted removal of defs.tcl.
d2868 2
a2869 1
2002-08-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d2871 1
a2871 1
	* doc/lsearch.n: corrected lsearch docs to use -inline in examples.
d2873 3
a2875 1
	*** 8.4b2 TAGGED FOR RELEASE ***
d2877 3
a2879 10
	* tests/fCmd.test:
	* tests/unixFCmd.test: updated tests for new link copy behavior.
	* generic/tclFCmd.c (CopyRenameOneFile): changed the behavior to
	follow links to endpoints and copy that file/directory instead of
	just copying the surface link.  This means that trying to copy a
	link that has no endpoint (danling link) is an error.
	[Patch #591647] (darley)
	(CopyRenameOneFile): this is currently disabled by default until
	further issues with such behavior (like relative links) can be
	handled correctly.
d2881 3
a2883 1
	* tests/README: slight wording improvements
d2885 7
a2891 1
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>
d2893 1
a2893 7
	* docs/BoolObj.3: added description of valid string reps for a
	boolean object [Bug 584794]
	* generic/tclObj.c: optimised Tcl_GetBooleanFromObj and
	SetBooleanFromAny to avoid parsing the string rep when it can be
	avoided [Bugs 584650, 472576]
	
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>
d2895 4
a2898 5
	* generic/tclCompile.h:
	* generic/tclObj.c: making tclCmdNameType static ([Bug 584567],
	Don Porter).
	
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>
d2900 1
a2900 5
	* generic/tclObj.c (Tcl_NewObj): added conditional code for
	USE_THREAD_ALLOC; objects allocated through Tcl_NewObj() were
	otherwise being leaked. [Bug 587488] reported by Sven Sass.
	
2002-08-06  Daniel Steffen  <das@@users.sourceforge.net>
d2902 4
a2905 9
	* generic/tclInt.decls:
	* unix/tclUnixThrd.c: Added stubs and implementations for
	non-threaded build for the tclUnixThrd.c procs TclpReaddir,
	TclpLocaltime, TclpGmtime and TclpInetNtoa.
	Fixes link errors in stubbed & threaded extensions that include
	tclUnixPort.h and use any of the procs readdir, localtime, 
	gmtime or inet_ntoa (e.g. TclX 8.4) [Bug 589526]
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c: Regen.
d2907 1
a2907 1
2002-08-05  Don Porter  <dgp@@users.sourceforge.net>
d2909 1
a2909 110
	* library/tcltest/tcltest.tcl:	The setup and cleanup scripts are now
	* library/tcltest/pkgIndex.tcl:	skipped when a test is skipped, fixing
	* tests/tcltest.test:		[Bug 589859].  Test for bug added, and
	corrected tcltest package bumped to version 2.2.

	* generic/tcl.decls:	Restored Tcl_Concat to return (char *).  Like
	* generic/tclDecls.h:	Tcl_Merge, it transfers ownership of a dynamic
	* generic/tclUtil.c:	allocated string to the caller.

2002-08-04  Don Porter  <dgp@@users.sourceforge.net>

	* doc/CmdCmplt.3:	Applied Patch 585105 to fully CONST-ify
	* doc/Concat.3:		all remaining public interfaces of Tcl.
	* doc/CrtCommand.3:	Notably, the parser no longer writes on 
	* doc/CrtSlave.3:	the string it is parsing, so it is no
	* doc/CrtTrace.3:	longer necessary for Tcl_Eval() to be
	* doc/Eval.3:		given a writable string.  Also, the
	* doc/ExprLong.3:	refactoring of the Tcl_*Var* routines
	* doc/LinkVar.3:	by Miguel Sofer is included, so that the
	* doc/ParseCmd.3:	"part1" argument for them no longer needs
	* doc/SetVar.3:		to be writable either.
	* doc/TraceVar.3:
	* doc/UpVar.3:		Compatibility support has been enhanced so
	* generic/tcl.decls	that a #define of USE_NON_CONST will remove
	* generic/tcl.h		all possible source incompatibilities with
	* generic/tclBasic.c	the 8.3 version of the header file(s).
	* generic/tclCmdMZ.c	The new #define of USE_COMPAT_CONST now does
	* generic/tclCompCmds.c	what USE_NON_CONST used to do -- disable
	* generic/tclCompExpr.c only those new CONST's that introduce
	* generic/tclCompile.c	irreconcilable incompatibilities.
	* generic/tclCompile.h
	* generic/tclDecls.h	Several bugs are also fixed by this patch.
	* generic/tclEnv.c	[Bugs 584051,580433] [Patches 585105,582429]
	* generic/tclEvent.c	
	* generic/tclInt.decls
	* generic/tclInt.h
	* generic/tclIntDecls.h
	* generic/tclInterp.c
	* generic/tclLink.c
	* generic/tclObj.c
	* generic/tclParse.c
	* generic/tclParseExpr.c
	* generic/tclProc.c
	* generic/tclTest.c
	* generic/tclUtf.c
	* generic/tclUtil.c
	* generic/tclVar.c
	* mac/tclMacTest.c
	* tests/expr-old.test
	* tests/parseExpr.test
	* unix/tclUnixTest.c
	* unix/tclXtTest.c
	* win/tclWinTest.c

2002-08-01  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: bugfix (reading freed memory). Testsuite
	passed on linux/i386, compile-13.1 hung on linux/alpha.

2002-08-01  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: added a reference count for the complete
	execution stack, instead of Tcl_Preserve/Tcl_Release. 

2002-08-01  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tclCkalloc.c (TclFinalizeMemorySubsystem):
	Don't lock the ckalloc mutex before invoking the
	Tcl_DumpActiveMemory function since it also
	locks the same mutex. This code is only executed
	when "memory onexit filename" has been executed
	and Tcl is compiled with -DTCL_MEM_DEBUG.

2002-08-01  Reinhard Max  <max@@suse.de>

	* win/tclWinPort.h: The windows headers don't provide socklen_t,
	so we have to do it.

2002-07-31  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInt.h (USE_THREAD_ALLOC): for unshared objects,
	TclDecrRefCount now frees the internal rep before the string rep -
	just like the non-macro Tcl_DecrRefCount/TclFreeObj [Bug 524802]. 
	For the other allocators the fix was done on 2002-03-06.

2002-07-31  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInterp.c: signed/unsigned comparison warning fixed
	(Vince Darley).

2002-07-31  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tcl.m4 (SC_BUGGY_STRTOD): Enabled caching of test results.

	* unix/tcl.m4 (SC_BUGGY_STRTOD): Solaris 2.8 still has a buggy
	strtod() implementation; make sure we detect it.

	* tests/expr.test (expr-22.*): Marked as non-portable because it
	seems that these tests have an annoying tendency to fail in
	unexpected ways.  [Bugs 584825, 584950, 585986]

2002-07-30  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tests/io.test: 
	* generic/tclIO.c (WriteChars): Added flag to break out of loop if
	  nothing of the input is consumed at all, to prevent infinite
	  looping of called with a non-UTF-8 string. Fixes Bug 584603
	  (partially). Added new test "io-60.1". Might need additional
	  changes to Tcl_Main so that unprintable results are printed as
	  binary data.
d2911 2
a2912 1
2002-07-29  Mo DeJong  <mdejong@@users.sourceforge.net>
d2914 4
a2917 8
	* unix/Makefile.in: Use CC_SEARCH_FLAGS instead of
	LD_SEARCH_FLAGS when linking with ${CC}.
	* unix/configure: Regen.
	* unix/configure.in: Don't subst CC_SEARCH_FLAGS or
	LD_SEARCH_FLAGS since this is now done in tcl.m4.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Document and
	set CC_SEARCH_FLAGS whenever LD_SEARCH_FLAGS is set.
	[Tcl patch 588290]
d2919 21
a2939 1
2002-07-29  Reinhard Max  <max@@suse.de>
d2941 11
a2951 2
	* unix/tcl.m4 (SC_SERIAL_PORT): Fixed detection for cases when
                                        configure's stdin is not a tty.
d2953 2
a2954 3
	* unix/tclUnixPort.h: 
	* generic/tclIOSock.c:          Changed size_t to socklen_t in
                                        socket-related function calls.
d2956 2
a2957 2
	* unix/configure.in:            Added test and fallback definition
                                        for socklen_t.
d2959 30
a2988 1
	* unix/configure:               generated.
d2990 2
a2991 1
2002-07-29  Miguel Sofer  <msofer@@users.sourceforge.net>
d2993 1
a2993 1
	* generic/tclObj.c: fixed a comment
d2995 16
a3010 19
	* generic/tcl.h: 
	* generic/tclBasic.c: 
	* generic/tclInterp.c: added the new flag TCL_EVAL_INVOKE to
	the interface of the Tcl_Eval* functions, removing the
	TCL_EVAL_NO_TRACEBACK added yesterday: alias invocations not only 
	require no tracebacks, but also look up the command name in the
	global scope - see new test interp-9.4
	* tests/interp.test: added 9.3 to test for safety of aliases to
	hidden commands, 9.4 to test for correct command lookup scope.

2002-07-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/regc_locale.c (cclass): [[:xdigit:]] is only a defined
	concept on western characters, so should not allow any unicode
	digit, and hence number of ranges in [[:xdigit:]] is fixed.
	* tests/reg.test: Added test to detect the bug.
	* generic/regc_cvec.c (newcvec): Corrected initial size value in
	character vector structure.  [Bug 578363]  Many thanks to
	pvgoran@@users.sf.net for tracking this down.
d3012 1
a3012 1
2002-07-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d3014 1
a3014 37
	* generic/tcl.h: 
	* generic/tclBasic.c: added the new flag TCL_EVAL_NO_TRACEBACK to
	the interface of the Tcl_Eval* functions. Modified the error
	message for too many nested evaluations.
	* generic/tclInterp.h: changed the Alias struct to be of variable
	length and store the prefix arguments directly (instead of a
	pointer to a Tcl_Obj list). Made AliasObjCmd call Tcl_EvalObjv
	instead of TclObjInvoke - thus making aliases trigger execution
	traces [Bug 582522].
	* tests/interp.test:
	* tests/stack.test: adapted to the new error message.
	* tests/trace.test: added tests for aliases firing the exec
	traces. 

2002-07-27  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Revert fix for Tcl bug 529801
	since it was incorrect and broke the build on
	other systems. Fix Tcl bug 587299.
	Add MAJOR_VERSION, MINOR_VERSION, PATCH_LEVEL,
	SHLIB_LD_FLAGS, SHLIB_LD_LIBS, CC_SEARCH_FLAGS,
	LD_SEARCH_FLAGS, and LIB_FILE variables to support
	more generic library build/install rules.
	* unix/configure: Regen.
	* unix/configure.in: Move AC_PROG_RANLIB into
	tcl.m4. Move shared build test and setting
	of MAKE_LIB and MAKE_STUB_LIB into tcl.m4.
	Move subst of a number of variables into
	tcl.m4 where they are defined.
	* unix/tcl.m4 (SC_ENABLE_SYMBOLS, SC_CONFIG_CFLAGS):
	Subst vars where they are defined. Add MAKE_LIB,
	MAKE_STUB_LIB, INSTALL_LIB, and INSTALL_STUB_LIB
	rules to deal with the ugly details of running
	ranlib on static libs at build and install time.
	Replace TCL_SHLIB_LD_EXTRAS with SHLIB_LD_FLAGS
	and use it when building a shared library.
	* unix/tclConfig.sh.in: Add TCL_CC_SEARCH_FLAGS.
d3016 1
a3016 1
2002-07-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d3018 2
a3019 4
	* generic/tclExecute.c: fixed Tcl_Obj leak in code corresponding
	to the macro NEXT_INST_V(x, 0, 1) [Bug 587495].
	
2002-07-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d3021 1
a3021 2
	* generic/tclVar.c (TclObjLookupVar): leak fix and improved
	comments. 
d3023 5
a3027 1
2002-07-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d3029 1
a3029 3
	* generic/tclVar.c (TclLookupVar): removed early returns that
	prevented the parens from being restored. also removed goto label
	as it was not necessary.
d3031 6
a3036 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d3038 3
a3040 3
	* generic/tclExecute.c: 
	* tests/expr-old.test: fix for erroneous error messages in [expr],
	[Bug  587140] reported by Martin Lemburg.
d3042 1
a3042 3
2002-07-25  Joe English  <jenglish@@users.sourceforge.net>
	* generic/tclProc.c: fix for Tk Bug #219218 "error handling 
	with bgerror in Tk"
d3044 5
a3048 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d3050 1
a3050 2
	* generic/tclExecute.c: restoring full TCL_COMPILE_DEBUG
	functionality.
d3052 2
a3053 1
2002-07-24  Don Porter  <dgp@@users.sourceforge.net>
d3055 3
a3057 2
	* tests/unixInit.test: relaxed unixInit-3.1 to accept iso8859-15
	as a valid C encoding.  [Bug 575336]
d3059 1
a3059 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d3061 2
a3062 4
	* generic/tclExecute.c: restoring the tcl_traceCompile
	functionality while I repair tcl_traceExec. The core now compiles
	and runs also under TCL_COMPILE_DEBUG, but execution in the
	bytecode engine can still not be traced.
d3064 1
a3064 1
2002-07-24  Daniel Steffen  <das@@users.sourceforge.net>
d3066 5
a3070 6
	* unix/Makefile.in:
	* unix/configure.in: corrected fix for [Bug 529801]: ranlib
	only needed for static builds on Mac OS X.
	* unix/configure: Regen.
	* unix/tclLoadDyld.c: fixed small bugs introduced by Vince,
	implemented library unloading correctly (needs OS X 10.2).
d3072 1
a3072 1
2002-07-23  Joe English  <jenglish@@users.sourceforge.net>
d3074 3
a3076 6
	* doc/OpenFileChnl.3: (Updates from Larry Virden)
	* doc/open.n:
	* doc/tclsh.1: Fix section numbers in Unix man page references.
	* doc/lset.n:  In EXAMPLES section, include command to set the 
	initial value used in subsequent examples.
	* doc/http.n: Package version updated to 2.4.
d3078 1
a3078 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d3080 24
a3103 4
	* unix/configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Enable 64 bit compilation
	when using the native compiler on a 64 bit version of IRIX.
	[Tcl bug 219220]
d3105 1
a3105 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d3107 3
a3109 2
	* unix/Makefile.in: Combine ranlib tests and
	avoid printing unless ranlib is actually run.
d3111 1
a3111 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d3113 9
a3121 3
	* unix/tcl.m4 (SC_PATH_X): Set XINCLUDES to "" instead
	of "# no special path needed" or "# no include files found"
	when x headers cannot be located.
d3123 1
a3123 1
2002-07-22  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3125 15
a3139 14
	* generic/tclIOUtil.c: made tclNativeFilesystem static
	(since 07-19 changes removed its usage elsewhere), and
	added comments about its usage.
	* generic/tclLoad.c:
	* generic/tcl.h:
	* generic/tcl.decls: 
	* doc/FileSystem.3: converted last load-related ClientData
	parameter to Tcl_LoadHandle opaque structure, removing a 
	couple of casts in the process.
	
	* generic/tclInt.h: removed tclNativeFilesystem declaration
	since it is now static again.
	
2002-07-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3141 1
a3141 6
	* tests/expr.test (expr-22.*): Added tests to help detect the
	corrected handling.
	* generic/tclExecute.c (IllegalExprOperandType): Improved error
	message generated when attempting to manipulate Inf and NaN values.
	* generic/tclParseExpr.c (GetLexeme): Allowed parser to recognise
	'Inf' as a floating-point number. [Bug 218000]
d3143 19
a3161 1
2002-07-21  Don Porter  <dgp@@users.sourceforge.net>
d3163 2
a3164 1
	* tclIOUtil.c: Silence compiler warning. [Bug 584408].
d3166 1
a3166 1
2002-07-19  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3168 57
a3224 4
	* generic/tclIOUtil.c: fix to GetFilesystemRecord
	* win/tclWinFile.c:
	* unix/tclUnixFile.c: fix to subtle problem with links shown
	up by latest tclkit builds.
d3226 1
a3226 1
2002-07-19  Mo DeJong  <mdejong@@users.sourceforge.net>
a3227 1
	* unix/configure:
d3229 4
a3232 30
	* win/configure:
	* win/configure.in: Add AC_PREREQ(2.13) in an attempt
	to make it more clear that the configure scripts
	must be generated with autoconf version 2.13.
	[Bug 583573]

2002-07-19  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* unix/Makefile.in: fix to build on MacOS X [Bug 529801], bug
	report and fix from jcw.

2002-07-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* win/tclWinSerial.c (no_timeout): Made this variable static.

	* generic/tclExecute.c, generic/tclCompile.c, generic/tclBasic.c: 
	* generic/tclCompile.h (builtinFuncTable, instructionTable): Added
	prefix to these symbols because they are visible outside the Tcl
	library.

	* generic/tclCompExpr.c (operatorTable): 
	* unix/tclUnixTime.c (tmKey):
	* generic/tclIOUtil.c (theFilesystemEpoch, filesystemWantToModify,
	filesystemIteratorsInProgress, filesystemOkToModify): Made these
	variables static.

	* unix/tclUnixFile.c:		Renamed nativeFilesystem to
	* win/tclWinFile.c:		tclNativeFilesystem and declared
	* generic/tclIOUtil.c:		it properly in tclInt.h
	* generic/tclInt.h: 
d3234 1
a3234 1
	* generic/tclUtf.c (totalBytes): Made this array static and const.
d3236 2
a3237 3
	* generic/tclParse.c (typeTable): Made this array static and const.
	(Tcl_ParseBraces): Simplified error handling case so that scans
	are only performed when needed, and flags are simpler too.
d3239 1
a3239 2
	* license.terms: Added AS to list of copyright holders; it's only
	fair for the current gatekeepers to be listed here!
d3241 4
a3244 3
	* tests/cmdMZ.test: Renamed constraint for clarity. [Bug#583427]
	Added tests for the [time] command, which was previously only
	indirectly tested!
d3246 1
a3246 1
2002-07-18  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3248 10
a3257 4
	* generic/tclInt.h:
	* generic/tcl.h:
	* */*Load*.c: added comments on changes of 07/17 and 
	replaced clientData with Tcl_LoadHandle in all locations.
d3259 1
a3259 11
	* generic/tclFCmd.c:
	* tests/fileSystem.test: fixed a 'knownBug' with 'file
	attributes ""'
	* tests/winFCmd.test: 
	* tests/winPipe.test:
	* tests/fCmd.test:
	* tessts/winFile.test: added 'pcOnly' constraint to some
	tests to make for more useful 'tests skipped' log from 
	running all tests on non-Windows platforms.
	
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d3261 2
a3262 3
	* generic/tclBasic.c (CallCommandTraces): delete traces now
	receive the FQ old name of the command. 
	[Bug 582532] (Don Porter)
d3264 2
a3265 1
2002-07-18  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3267 3
a3269 2
	* tests/ioUtil.test: added constraints to 1.4,2.4 so they
	don't run outside of tcltest. [Bugs 583276,583277]
d3271 7
a3277 1
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d3279 3
a3281 2
	* generic/tclVar.c (DupParsedVarName): nasty bug fixed, reported
	by Vince Darley.
d3283 2
a3284 1
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d3286 1
a3286 5
	* generic/tclVar.c (TclPtrIncrVar): missing CONST in declarations,
	inconsistent with tclInt.h. Thanks to Vince Darley for reporting,
	boo to gcc for not complaining.
	
2002-07-17  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3288 22
d3311 53
a3363 20
	* generic/tclIOUtil.c:
	* generic/tclLoadNone.c:
	* unix/tclLoadAout.c:
	* unix/tclLoadDl.c:
	* unix/tclLoadDld.c:
	* unix/tclLoadDyld.c:
	* unix/tclLoadNext.c:
	* unix/tclLoadOSF.c:
	* unix/tclLoadShl.c:
	* mac/tclMacLoad.c:
	* win/tclWinLoad.c: modified to move more functionality
	to the generic code and avoid duplication.  Partial replacement
	of internal uses of clientData with opaque Tcl_LoadHandle.  A
	little further work still needed, but significant changes are done.

2002-07-17  D. Richard Hipp    <drh@@hwaci.com>

	* library/msgcat/msgcat.tcl: fix a comment that was causing
	problems for programs (ex: mktclapp) that embed the initialization
	scripts in strings.
d3365 1
a3365 25
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c: removing the now redundant functions to access
	indexed variables: Tcl(Get|Set|Incr)IndexedScalar() and
	Tcl(Get|Set|Incr)ElementOfIndexedArray(). 

2002-07-17  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclExecute.c (TclExecuteByteCode): Minor fixes to make
	this file compile with SunPro CC...

2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: modified to do variable lookup explicitly,
	and then either inlining the variable access or else calling the new
	TclPtr(Set|Get|Incr)Var functions in tclVar.c
	* generic/tclInt.h: declare some functions previously local to
	tclVar.c for usage by TEBC.
	* generic/tclVar.c: removed local declarations; moved all special
	accessor functions for indexed variables to the end of the file -
	they are unused and ready for removal, but left there for the time
	being as they are in the internal stubs table.
d3367 2
a3368 4
	** WARNING FOR BYTECODE MAINTAINERS **
	TCL_COMPILE_DEBUG is currently not functional; will be fixed ASAP.
	
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d3370 2
a3371 3
	* unix/Makefile.in:
	* win/Makefile.in: Add a more descriptive warning
	in the event `make genstubs` needs to be rerun.
d3373 3
a3375 1
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d3377 1
a3377 6
	* unix/Makefile.in: Use dltest.marker file
	to keep track of when the dltest package
	is up to date. This fixes [Tcl bug 575768]
	since tcltest is no longer linked every time.
	* unix/dltest/Makefile.in: Create ../dltest.marker
	after a successful `make all` run in dltest.
d3379 2
a3380 1
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d3382 3
a3384 2
	* unix/configure: Regen.
	* unix/configure.in: Remove useless subst of TCL_BIN_DIR.
d3386 1
a3386 1
2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d3388 2
a3389 3
	* generic/tclVar.c: inaccurate comment fixed
	
2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d3391 9
a3399 24
	* generic/tclBasic.c (Tcl_AddObjErrorInfo):
	* generic/tclExecute.c (TclUpdateReturnInfo):
	* generic/tclInt.h:	
	* generic/tclProc.c: 
	Added two Tcl_Obj to the ExecEnv structure to hold the fully
	qualified names "::errorInfo" and "::errorCode" to cache the
	addresses of the corresponding variables. The two most frequent
	setters of these variables now profit from the new variable name
	caching. 

2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclVar.c: refactorisation to reuse already looked-up Var
	pointers; definition of three new Tcl_Obj types to cache variable
	name parsing and lookup for later reuse; modification of internal
	functions to profit from the caching. 
	
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclNamesp.c: adding CONST qualifiers to variable names
	passed to Tcl_FindNamespaceVar and to variable resolvers; adding
	CONST qualifier to the 'msg' argument to TclLookupVar. Needed to
	avoid code duplication in the new tclVar.c code.
d3401 1
a3401 3
	* tests/set-old.test:
	* tests/var.test: slight modification of error messages due to the
	modifications in the tclVar.c code.
d3403 3
a3405 1
2002-07-15  Don Porter  <dgp@@users.sourceforge.net>
d3407 1
a3407 2
	* tests/unixInit.test:	Improved constraints to protect /tmp.	
	  [Bug 581403]
d3409 4
a3412 1
2002-07-15  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3414 1
a3414 8
	* tests/winFCmd.test: renamed 'win2000' and 'notWin2000' to
	more appropriate constraint names.
	* win/tclWinFile.c: updated comments to reflect 07-11 changes.
	* win/tclWinFCmd.c: made ConvertFileNameFormat static again,
	since no longer used in tclWinFile.c
	* mac/tclMacFile.c: completed TclpObjLink implementation which
	was previously lacking.
	* generic/tclIOUtil.c: comment cleanup and code speedup.
d3416 3
a3418 1
2002-07-14  Don Porter  <dgp@@users.sourceforge.net>
d3420 3
a3422 2
	* generic/tclInt.h:	Removed declarations that duplicated entries
	  in the (internal) stub table.
d3424 6
a3429 2
	* library/tcltest/tcltest.tcl:  Corrected errors in handling of
	  configuration options -constraints and -limitconstraints.
d3431 1
a3431 7
	* README:		Bumped HEAD to version 8.4b2 so we can
	* generic/tcl.h:	distinguish it from the 8.4b1 release.
	* tools/tcl.wse.in:
	* unix/configure*:
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure*:
d3433 3
a3435 1
2002-07-11  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3437 2
a3438 6
	* doc/file.n:
	* win/tclWinFile.c: on Win 95/98/ME the long form of the path
	is used as a normalized form.  This is required because short
	forms are not a robust representation.  The file normalization
	function has been sped up, but more performance gains might be
	possible, if speed is still an issue on these platforms.
d3440 1
a3440 1
2002-07-11  Don Porter  <dgp@@users.sourceforge.net>
d3442 4
a3445 2
	* library/tcltest/tcltest.tcl: Corrected reaction to existing but
	false ::tcl_interactive.
d3447 1
a3447 1
	* doc/Hash.3: Overlooked CONST documentation update.
d3449 3
a3451 1
2002-07-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3453 1
a3453 3
	* generic/tclCkalloc.c: ckalloc() and friends take the block size
	as an unsigned, so we should use %ud when reporting it in fprintf()
	and panic().
d3455 3
a3457 1
2002-07-11  Miguel Sofer  <msofer@@users.sourceforge.net>
d3459 1
a3459 4
	* generic/tclCompile.c: now setting local vars undefined at
	compile time, instead of waiting until the proc is initialized. 
	* generic/tclProc.c: use macro TclSetVarUndefined instead of
	directly etting the flag.
d3461 2
a3462 1
2002-07-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3464 1
a3464 2
	* tests/cmdAH.test: [file attr -perm] is Unix-only, so add [catch]
	when not inside a suitably-protected test.
d3466 14
a3479 1
2002-07-10  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3481 1
a3481 4
	* tests/unixFCmd.test, tests/fileName.test: 
	* tests/fCmd.test: Removed [exec] of Unix utilities that have
	equivalents in standard Tcl.  [Bug 579268]  Also simplified some
	of unixFCmd.test while I was at it.
d3483 2
a3484 1
2002-07-10  Don Porter  <dgp@@users.sourceforge.net>
d3486 64
a3549 4
	* tests/tcltest.test:  Greatly reduced the number of [exec]s, using
	slave interps instead.
	* library/tcltest/tcltest.tcl:  Fixed bug uncovered in the conversion
	where a message was written to stdout instead of [outputChannel].
d3551 5
a3555 15
	* tests/basic.test:	Cleaned up, constrained, and reduced the
	* tests/compile.test:	amount of [exec] usage in the test suite.
	* tests/encoding.test:
	* tests/env.test:
	* tests/event.test:
	* tests/exec.test:
	* tests/io.test:
	* tests/ioCmd.test:
	* tests/regexp.test:
	* tests/regexpComp.test:
	* tests/socket.test:
	* tests/tcltest.test:
	* tests/unixInit.test:
	* tests/winDde.test:
	* tests/winPipe.test:
d3557 1
a3557 1
2002-07-10  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3559 2
a3560 1
	* tests/cmdAH.test: Removed [exec] of Unix utilities. [Bug 579211]
d3562 1
a3562 3
	* tests/expr.test: Added tests to make sure that this works.
	* generic/tclExecute.c (ExprCallMathFunc): Functions should also
	be able to return wide-ints.  [Bug 579284]
d3564 80
a3643 1
2002-07-08  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d3645 1
a3645 4
	* tests/socket.test: Fixed bug #578164. The original reason for
	  the was a DNS outage while running the testsuite. Changed [info
	  hostname] to 127.0.0.1 to bypass DNS, knowing that we operate on
	  the local host.
d3647 1
a3647 1
2002-07-08  Don Porter  <dgp@@users.sourceforge.net>
d3649 7
a3655 3
	* doc/tcltest.n:		Fixed incompatibility in [viewFile].
	* library/tcltest/tcltest.tcl:	Corrected docs.  Bumped to 2.2.1.
	* library/tcltest/pkgIndex.tcl: [Bug 578163]
d3657 1
a3657 1
2002-07-08  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3659 3
a3661 59
	* tests/cmdAH.test:
	* tests/fCmd.test:
	* tests/fileName.test: tests which rely on 'file link' need a
	constraint so they don't run on older Windows OS. [Bug 578158]
	* generic/tclIOUtil.c:
	* generic/tcl.h:
	* generic/tclInt.h:
	* generic/tclTest.c:
	* mac/tclMacChan.c:
	* unix/tclUnixChan.c:
	* win/tclWinChan.c:
	* doc/FileSystem.3: cleaned up internal handling of
	Tcl_FSOpenFileChannel to remove duplicate code, and make
	writing external vfs's clearer and easier.  No
	functionality change.  Also clarify that objects with refCount
	zero should not be passed in to the Tcl_FS API, and prevent
	segfaults from occuring on such user errors. [Bug 578617]
	
2002-07-06  Don Porter  <dgp@@users.sourceforge.net>

	* tests/pkgMkIndex.test:  Constrained tests of [load] package indexing
	to those platforms where the testing shared libraries have been built.
	[Bug 578166].

2002-07-05  Don Porter  <dgp@@users.sourceforge.net>
	* changes: added recent changes

2002-07-05  Reinhard Max  <max@@suse.de>

	* generic/tclClock.c (FormatClock): Convert the format string to
	UTF8 before calling TclpStrftime, so that non-ASCII characters
	don't get mangled when the result string is being converted back.
	* tests/clock.test: Added a test for that.

2002-07-05  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/Makefile.in (ro-test,ddd,GDB,DDD): Created new targets to
	allow running the test suite with a read-only current directory,
	running under ddd instead of gdb, and factored out some executable
	names for broken sites (like mine) where gdb and ddd are installed
	with non-standard names...

	* tests/httpold.test: Altered test names to httpold-* to avoid
	clashes with http.test, and stopped tests from failing when the
	current directory is not writable...

	* tests/event.test:		Stop these tests from failing
	* tests/ioUtil.test:		when the current directory is
	* tests/regexp.test:		not writable...
	* tests/regexpComp.test: 
	* tests/source.test: 
	* tests/unixFile.test: 
	* tests/unixNotfy.test: 

	* tests/unixFCmd.test:		Trying to make these test-files
	* tests/macFCmd.test:		not bomb out with an error when
	* tests/http.test:		the current directory is not
	* tests/fileName.test:		writable...
	* tests/env.test:
d3663 1
a3663 1
2002-07-05  Jeff Hobbs  <jeffh@@ActiveState.com>
d3665 3
a3667 1
	*** 8.4b1 TAGGED FOR RELEASE ***
d3669 1
a3669 1
2002-07-04  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3671 3
a3673 3
	* tests/cmdMZ.test (cmdMZ-1.4): 
	* tests/cmdAH.test: More fixing of writable-current-dir
	assumption. [Bug 575824]
d3675 1
a3675 1
2002-07-04  Miguel Sofer  <msofer@@users.sourceforge.net>
d3677 15
a3691 3
	* tests/basic.test: Same issue as below; fixed [Bug 575817]
	
2002-07-04  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d3693 1
a3693 4
	* tests/socket.test: 
	* tests/winPipe.test: 
	* tests/pid.test: Fixed SF Bug #575848. See below for a
	  description the general problem.
d3695 6
a3700 2
	* All the bugs below are instances of the same problem: The
	  testsuite assumes [pwd] = [temporaryDirectory] and writable.
d3702 6
a3707 4
	* tests/iogt.test: Fixed bug #575860.
	* tests/io.test:   Fixed bug #575862.
	* tests/exec.test: 
	* tests/ioCmd.test: Fixed bug #575836.
d3709 1
a3709 1
2002-07-03  Don Porter  <dgp@@users.sourceforge.net>
d3711 7
a3717 4
	* tests/pkg1/direct1.tcl: removed
	* tests/pkg1/pkgIndex.tcl: removed
	* tests/pkgMkIndex.test:  Imported auxilliary files from tests/pkg1
	  into the test file pkgMkIndex.test itself.  Formatting fixes.
d3719 1
a3719 1
	* unix/Makefile.in: removed tests/pkg/* from `make dist`
d3721 1
a3721 20
	* tests/pkg/circ1.tcl: removed
	* tests/pkg/circ2.tcl: removed
	* tests/pkg/circ3.tcl: removed
	* tests/pkg/global.tcl: removed
	* tests/pkg/import.tcl: removed
	* tests/pkg/pkg1.tcl: removed
	* tests/pkg/pkg2_a.tcl: removed
	* tests/pkg/pkg2_b.tcl: removed
	* tests/pkg/pkg3.tcl: removed
	* tests/pkg/pkg4.tcl: removed
	* tests/pkg/pkg5.tcl: removed
	* tests/pkg/pkga.tcl: removed
	* tests/pkg/samename.tcl: removed
	* tests/pkg/simple.tcl: removed
	* tests/pkg/spacename.tcl: removed
	* tests/pkg/std.tcl: removed
	* tests/pkgMkIndex.test: Fixed [Bug 575857] where this test file
	  expected to be able to write to [file join [testsDirectory]
	  pkg].  Part of the fix was to import several auxilliary files
	  into the test file itself.
d3723 8
a3730 2
	* tests/main.test:	Cheap fix for [Bugs 575851, 575858].  Avoid
	* tests/tcltest.test:	non-writable . by [cd [temporaryDirectory]].
d3732 1
a3732 3
	* library/auto.tcl: Fix [tcl_findLibrary] to be sure it sets
	  $varName only if a successful library script is found.
	  [Bug 577033]
d3734 3
a3736 1
2002-07-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d3738 1
a3738 3
	* generic/tclCompCmds.c (TclCompileCatchCmd): return
	  TCL_OUT_LINE_COMPILE instead of TCL_ERROR: let the failure
	  happen at runtime so that it can be caught [Bug 577015].
d3740 5
a3744 1
2002-07-02  Joe English  <jenglish@@users.sourceforge.net>
d3746 1
a3746 1
	* doc/tcltest.n: Markup fixes, spellcheck.
d3748 2
a3749 1
2002-07-02  Don Porter  <dgp@@users.sourceforge.net>
d3751 2
a3752 1
	* doc/tcltest.n: more refinements of the documentation.
d3754 4
a3757 2
	* library/tcltest/tcltest.tcl: Added trace to be sure the stdio
	  constraint is updated whenever the [interpreter] changes.
d3759 2
a3760 6
	* doc/tcltest.n:		Reverted [makeFile] and [viewFile] to
	* library/tcltest/tcltest.tcl:	their former behavior, and documented
	* tests/cmdAH.test:		it.  Corrected misspelling of hook
	* tests/event.test:		procedure.  Restored tests.
	* tests/http.test:
	* tests/io.test:
d3762 1
a3762 3
	* library/tcltest/tcltest.tcl: Simplified logic of
	  [GetMatchingFiles] and [GetMatchingDirectories], removing
	  special case processing.
d3764 4
a3767 2
	* doc/tcltest.n: More documentation updates.  Reference sections
	  are complete.  Only examples need adding.
d3769 7
a3775 1
2002-07-02  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3777 1
a3777 3
	* tests/fCmd.test: 
	* generic/tclCmdAH.c: clearer error msgs for 'file link',
	as per the man page.
d3779 1
a3779 1
2002-07-01  Joe English  <jenglish@@users.sourceforge.net>
d3781 2
a3782 35
	* doc/Access.3:
	* doc/AddErrInfo.3:
	* doc/Alloc.3:
	* doc/Backslash.3:
	* doc/CrtChannel.3:
	* doc/CrtSlave.3:
	* doc/Encoding.3:
	* doc/Eval.3:
	* doc/FileSystem.3:
	* doc/Notifier.3:
	* doc/OpenFileChnl.3:
	* doc/ParseCmd.3:
	* doc/RegExp.3:
	* doc/Tcl_Main.3:
	* doc/Thread.3:
	* doc/TraceCmd.3:
	* doc/Utf.3:
	* doc/WrongNumArgs.3:
	* doc/binary.n:
	* doc/clock.n:
	* doc/expr.n:
	* doc/fconfigure.n:
	* doc/glob.n:
	* doc/http.n:
	* doc/interp.n:
	* doc/lsearch.n:
	* doc/lset.n:
	* doc/msgcat.n:
	* doc/packagens.n:
	* doc/pkgMkIndex.n:
	* doc/registry.n:
	* doc/resource.n:
	* doc/safe.n:
	* doc/scan.n:
	* doc/tclvars.n:  Spell-check, fixed typos (Updates from Larry Virden).
d3784 3
a3786 1
2002-07-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3788 4
a3791 5
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Made Solaris use gcc for linking
	when building with gcc to resolve problems with undefined symbols
	being present when tcl library used with non-gcc linker at later
	stage. Symbols were compiler-generated, so it is the compiler's
	business to define them. [Bug #541181] 
d3793 2
a3794 1
2002-07-01  Don Porter  <dgp@@users.sourceforge.net>
d3796 18
a3813 1
	* doc/tcltest.n: more work in progress updating tcltest docs.
d3815 1
a3815 4
	* library/tcltest/tcltest.tcl: Change [configure -match] to
	stop treating an empty list as a list of the single pattern "*".
	Changed the default value to [list *] so default operation
	remains the same.
d3817 10
a3826 1
	* tests/pkg/samename.tcl: restored.  needed by pkgMkIndex.test.
d3828 2
a3829 2
	* library/tcltest/tcltest.tcl: restored writeability testing of
	-tmpdir, augmented by a special exception for the deafault value.
d3831 5
a3835 1
2002-07-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3837 1
a3837 1
	* doc/concat.n: Documented the *real* behaviour of [concat]!
d3839 1
a3839 1
2002-06-30  Don Porter  <dgp@@users.sourceforge.net>
d3841 3
a3843 1
	* doc/tcltest.n: more work in progress updating tcltest docs.
d3845 1
a3845 6
	* tests/README:		Updated the instructions on running and
	* tests/cmdMZ.test:	adding to the test suite.  Also updated
	* tests/encoding.test:	several tests, mostly to correctly create
	* tests/fCmd.test:	and destroy any temporary files in the
	* tests/info.test:	[temporaryDirectory] of tcltest.
	* tests/interp.test:
d3847 22
a3868 54
	* library/tcltest/tcltest.tcl:	Stopped checking for writeability
	of -tmpdir value because no default directory can be guaranteed to
	be writeable.

	* tests/autoMkindex.tcl: removed.
	* tests/pkg/samename.tcl: removed.
	* tests/pkg/magicchar.tcl: removed.
	* tests/pkg/magicchar2.tcl: removed.
	* tests/autoMkindex.test: Updated auto_mkIndex tests to use
	[makeFile] and [removeFile] so tests are done in [temporaryDirecotry]
	where write access is guaranteed.

	* library/tcltest/tcltest.tcl:	Fixed [makeFile] and [viewFile] to
	* tests/cmdAH.test:		accurately reflect a file's contents.
	* tests/event.test:		Updated tests that depended on buggy
	* tests/http.test:		behavior.  Also added warning messages
	* tests/io.test:		to "-debug 1" operations to debug test
	* tests/iogt.test:		calls to (make|remove)(File|Directory).

	* unix/mkLinks: `make mklinks` on 6-27 commits.

2002-06-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.h: modified the macro TclEmitPush to not
	call its first argument repeatedly or pass it to other macros,
	[Bug 575194] reported by Peter Spjuth.

2002-06-28  Don Porter  <dgp@@users.sourceforge.net>

	* docs/tcltest.n:	Doc revisions in progress.
	* library/tcltest/tcltest.tcl: Corrected -testdir default value.
	Was not reliable, and disagreed with docs!  Thanks to Hemang Lavana.
	[Bug 575150]

2002-06-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tclUnixThrd.c:	Renamed the Tcl_Platform* #defines to
	* unix/tclUnixPipe.c:	TclOS* because they are only used
	* unix/tclUnixFile.c:	internally.  Also stopped double-#def
	* unix/tclUnixFCmd.c:	of TclOSlstat [Bug #566099, post-rename]
	* unix/tclUnixChan.c:
	* unix/tclUnixPort.h:

	* doc/string.n: Improved documentation for [string last] along
	lines described in Bug #574799 so it indicates that the supplied
	index marks the end of the search space.

2002-06-27  Don Porter  <dgp@@users.sourceforge.net>

	* doc/dde.n:		Work in progress updating the documentation
	* doc/http.n:		of the packages that come bundled with
	* doc/msgcat.n:		the Tcl source distribution, notably tcltest.
	* doc/registry.n:
	* doc/tcltest.n:
d3870 35
a3904 2
	* library/tcltest/tcltest.tcl:  Made sure that the TCLTEST_OPTIONS
	environment variablle configures tcltest at package load time.
d3906 1
a3906 1
2002-06-26  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3908 10
a3917 9
	* tests/fileSystem.test: 
	* generic/tclIOUtil.c: fix to handling of empty paths ""
	which are not claimed by any filesystem (Bug #573758).
	Ensure good error messages are given in all cases.
	* tests/cmdAH.test:
	* unix/tclUnixFCmd.c: fix to bug reported as part of
	(Patch #566669).  Thanks to Taguchi, Takeshi for the report.
	
2002-06-26  Reinhard Max  <max@@suse.de>
d3919 1
a3919 2
	* unix/tclUnixTime.c: Make [clock format] respect locale settings.
	* tests/clock.test:   Bug #565880. ***POTENTIAL INCOMPATIBILITY***
d3921 3
a3923 1
2002-06-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d3925 1
a3925 5
	* doc/CrtInterp.3:
	* doc/StringObj.3: clarifications by Don Porter, bugs #493995 and
	#500930. 
	
2002-06-24  Don Porter  <dgp@@users.sourceforge.net>
d3927 2
a3928 3
	* library/tcltest/tcltest.tcl:	Corrected suppression of -verbose skip
	* tests/tcltest.test:		and start by [test -output].  Also
	corrected test suite errors exposed by corrected code.  [Bug 564656]
d3930 3
a3932 1
2002-06-25  Reinhard Max  <max@@suse.de>
d3934 5
a3938 4
	* unix/tcl.m4:       New macro SC_CONFIG_MANPAGES.
	* unix/configure.in: Added support for symlinks and compression
	* unix/Makefile.in:  when installing the manpages. [Patch 518052]
	* unix/mkLinks.tcl:  Default is still hardlinks and no compression.
d3940 5
a3944 2
	* unix/mkLinks:      generated
	* unix/configure:
d3946 1
a3946 1
	* unix/README:       Added documentation for the new features.
d3948 4
a3951 2
	* unix/tcl.m4 (SC_PATH_TCLCONFIG): Replaced ${exec_prefix}/lib by
	${libdir}.
d3953 1
a3953 1
2002-06-25  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3955 66
a4020 40
	* generic/tclUtil.c (TclGetIntForIndex): Fix of critical bug
	#533364 generated when the index is bad and the result is a shared
	object.  The T_ASTO(T_GOR, ...) idiom likely exists elsewhere
	though.  Also removed some cruft that just complicated things to
	no advantage.
	(SetEndOffsetFromAny): Same fix, though this wasn't on the path
	excited by the bug.

2002-06-24  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:	Implementation of TIP 101.  Adds
	* tests/parseOld.test:		and exports a [configure] command
	* tests/tcltest.test:		from tcltest.

2002-06-22  Don Porter  <dgp@@users.sourceforge.net>

	* changes: updated changes file for 8.4b1 release.

	* library/tcltest/tcltest.tcl:	Corrections to tcltest and the
	* tests/basic.test:		Tcl test suite so that a test
	* tests/cmdInfo.test:		with options -constraints knownBug
	* tests/compile.test:		-limitConstraints 1 only tests the
	* tests/encoding.test:		knownBug tests.  Mostly involves
	* tests/env.test:		replacing direct access to the
	* tests/event.test:		testConstraints array with calls
	* tests/exec.test:		to the testConstraint command
	* tests/execute.test:		(which requires tcltest version 2)
	* tests/fCmd.test:
	* tests/format.test:
	* tests/http.test:
	* tests/httpold.test:
	* tests/ioUtil.test:
	* tests/link.test:
	* tests/load.test:
	* tests/namespace.test:
	* tests/pkgMkIndex.test:
	* tests/reg.test:
	* tests/result.test:
	* tests/scan.test:
	* tests/stack.test:
d4022 1
a4022 1
2002-06-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4024 39
a4062 3
	* tools/tcl.wse.in (Disk Label), unix/tcl.spec (version): 
	* win/README.binary, README, win/configure.in, unix/configure.in: 
	* generic/tcl.h (TCL_RELEASE_*, TCL_PATCH_LEVEL): Bump to beta1.
d4064 4
a4067 1
2002-06-21  Joe English  <jenglish@@users.sourceforge.net>
d4069 1
a4069 3
	* generic/tclCompExpr.c:
	* generic/tclParseExpr.c: LogSyntaxError() should reset 
	the interpreter result [Bug 550142 "Tcl_ExprObj -> abort"] 
d4071 3
a4073 1
2002-06-21  Don Porter  <dgp@@users.sourceforge.net>
d4075 8
a4082 4
	* unix/Makefile.in:	Updated all package install directories
	* win/Makefile.in:	to match current Major.minor versions
	* win/makefile.bc:	of the packages.  Added tcltest package
	* win/makefile.vc:	to installation on Windows.
d4084 1
a4084 2
	* library/init.tcl:  Corrected comments and namespace style
	issues.  Thanks to Bruce Stephens. [Bug 572025]
d4086 2
a4087 1
2002-06-21  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4089 1
a4089 15
	* tests/cmdAH.test:          Added TIP#99 implementation
	* tests/fCmd.test:           of 'file link'.  Supports creation
	* tests/fileName.test:       of symbolic and hard links in the
	* tests/fileSystem.test:     native filesystems and in vfs's,
	* generic/tclTest.c:         when the individual filesystem
	* generic/tclCmdAH.c:        supports the concept.
	* generic/tclIOUtil.c:       
	* generic/tcl.h:
	* generic/tcl.decls:
	* doc/FileSystem.3:
	* doc/file.n:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: Also enhanced speed of 'file normalize' on
	Windows.
d4091 2
a4092 1
2002-06-20  Miguel Sofer  <msofer@@users.sourceforge.net>
d4094 5
a4098 3
	* generic/tclBasic.c (TclEvalObjvInternal): fix for [Bug 571385]
	in the implementation of TIP#62 (command tracing). Vince Darley,
	Hemang Lavana & Don Porter: thanks.
d4100 5
a4104 1
2002-06-20  Miguel Sofer  <msofer@@users.sourceforge.net>
d4106 1
a4106 2
	* generic/tclExecute.c (TclCompEvalObj): clarified and simplified
	the logic for compilation/recompilation.
d4108 3
a4110 2
2002-06-19  Joe English  <jenglish@@users.sourceforge.net>
	* doc/file.n: Fixed indentation.  No substantive changes.
d4112 3
a4114 1
2002-06-19  Jeff Hobbs  <jeffh@@ActiveState.com>
d4116 11
a4126 3
	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): get the resultPtr again
	as the Tcl_ObjSetVar2 may cause the result to change.
	[Patch #558324] (watson)
d4128 1
a4128 1
2002-06-19  Miguel Sofer  <msofer@@users.sourceforge.net>
d4130 18
a4147 2
	* generic/tclExecute.c (TEBC): removing unused "for(;;)" loop;
	improved comments; re-indentation.
d4149 2
a4150 1
2002-06-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4152 2
a4153 12
	* generic/tclExecute.c (TEBC): 
	- elimination of duplicated code in the non-immediate INST_INCR
	  instructions. 
	- elimination of 103 (!) TclDecrRefCount macros. The different
	  instructions now jump back to a common "DecrRefCount zone" at
	  the top of the loop. The macro "ADJUST_PC" was replaced by two
	  macros "NEXT_INST_F" and "NEXT_INST_V" that take three params
	  (pcAdjustment, # of stack objects to discard, resultObjPtr
	  handling flag). The only instructions that retain a
	  TclDecrRefCount are INST_POP (for speed), the common code for
	  the non-immediate INST_INCR, INST_FOREACH_STEP and the two
	  INST_LSET.
d4155 1
a4155 3
	The object size of tclExecute.o was reduced by approx 20% since
	the start of the consolidation drive, while making room for some
	peep-hole optimisation at runtime.
d4157 18
a4174 1
2002-06-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4176 1
a4176 2
	* generic/tclExecute.c (TEBC, INST_DONE): small bug in the panic
	code for tcl-stack corruption.
d4178 4
a4181 1
2002-06-17  David Gravereaux <davygrvy@@pobox.com>
d4183 5
a4187 2
	Trims to support the removal of RESOURCE_INCLUDED from rc
	scripts	from FR #565088.
d4189 3
a4191 2
	* generic/tcl.h: moved the #ifndef RC_INVOKED start block up in
	the file.  rc scripts don't need to know thread mutexes.
d4193 6
a4198 3
	* win/tcl.rc:
	* win/tclsh.rc: removed the #define RESOURCE_INCLUDED to let the
	built-in -DRC_INVOKED to the work.
d4200 3
a4202 1
2002-06-17  Jeff Hobbs  <jeffh@@ActiveState.com>
d4204 2
a4205 13
	* doc/CrtTrace.3:        Added TIP#62 implementation of command
	* doc/trace.n:           execution tracing [FR #462580] (lavana).
	* generic/tcl.h:         This includes enter/leave tracing as well
	* generic/tclBasic.c:    as inter-procedure stepping.
	* generic/tclCmdMZ.c:
	* generic/tclCompile.c:
	* generic/tclExecute.c:
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c:
	* tests/trace.test:
d4207 5
a4211 1
2002-06-17  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d4213 1
a4213 4
	* win/tclWinPipe.c (BuildCommandLine): Fixed bug #554068 ([exec]
	  on windows did not treat { in filenames well.). Bug reported by
	  Vince Darley <vincentdarley@@users.sourceforge.net>, patch
	  provided by Vince too.
d4215 6
a4220 1
2002-06-17  Joe English  <jenglish@@users.sourceforge.net>
d4222 2
a4223 3
	* generic/tcl.h: #ifdef logic for K&R C backwards compatibility
	changed to assume modern C by default.  See SF FR #565088 for
	full details.
d4225 4
a4228 1
2002-06-17  Don Porter  <dgp@@users.sourceforge.net>
d4230 17
a4246 2
	* doc/msgcat.n: Corrected en_UK references to en_GB.  UK is not
	a country designation recognized in ISO 3166.
d4248 26
a4273 2
	* library/msgcat/msgcat.tcl:  More Windows Registry locale codes
	from Bruno Haible.
d4275 3
a4277 10
	* doc/msgcat.n:
	* library/msgcat/msgcat.tcl:
	* library/msgcat/pkgIndex.tcl:
	* tests/msgcat.test:  Revised locale initialization to interpret
	environment variable locale values according to XPG4, and to
	recognize the LC_ALL and LC_MESSAGES values over that of LANG.
	Also added many Windows Registry locale values to those 
	recognized by msgcat.  Revised tests and docs.  Bumped to
	version 1.3.  Thanks to Bruno Haible for the report and
	assistance crafting the solution.  [Bug 525522, 525525]
d4279 2
a4280 1
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>
d4282 2
a4283 2
	* generic/tclCompile.c (TclCompileTokens): a better algorithm for
	the previous bug fix.
d4285 12
a4296 1
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>
d4298 5
a4302 5
	* generic/tclCompile.c (TclCompileTokens): 
	* tests/compile.test: [Bug 569438] in the processing of dollar
	variables; report by Georgios Petasis. 
	
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>
d4304 7
a4310 4
	* generic/tclExecute.c: bug in the consolidation of the
	INCR_..._STK instructions; the bug could not be exercised as the
	(faulty) instruction INST_INCR_ARRAY_STK was never compiled-in
	(related to [Bug 569438]).
d4312 4
a4315 1
2002-06-14  Miguel Sofer  <msofer@@users.sourceforge.net>
d4317 7
a4323 8
	* generic/tclExecute.c (TclExecuteByteCode): runtime peep-hole
	optimisation of variables (INST_STORE, INST_INCR) and commands
	(INST_INVOKE); faster check for the existence of a catch.
	(TclExecuteByteCode): runtime peep-hole optimisation of
	comparisons.
	(TclExecuteByteCode): runtime peep-hole optimisation of
	INST_FOREACH - relies on peculiarities of the code produced by the
	bytecode compiler.
d4325 3
a4327 1
2002-06-14  David Gravereaux <davygrvy@@pobox.com>
d4329 3
a4331 3
	* win/rules.vc: The test for compiler optimizations was in error.
	Thanks goes to Roy Terry <royterry@@earthlink.net> for his
	assistance with this.
d4333 1
a4333 1
2002-06-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4335 12
a4346 4
	* doc/trace.n, tests/trace.test: 
	* generic/tclCmdMZ.c (Tcl_TraceObjCmd,TclTraceCommandObjCmd)
	(TclTraceVariableObjCmd): Changed references to "trace list" to
	"trace info" as mandated by TIP#102.
d4348 7
a4354 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4356 1
a4356 2
	* generic/tclExecute.c (TclExecuteByteCode): consolidated code for
	the conditional branch instructions.
d4358 1
a4358 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4360 21
a4380 2
	* generic/tclExecute.c (TclExecuteByteCode): fixed the previous
	patch - wouldn't compile with TCL_COMPILE_DEBUG set.
d4382 2
a4383 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4385 10
a4394 4
	* generic/tclExecute.c (TclExecuteByteCode): consolidated the
	handling of exception returns to INST_INVOKE and INST_EVAL, as
	well as most of the code for INST_CONTINUE and INST_BREAK, in the
	new jump target "processExceptionReturn".
d4396 60
a4455 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4457 2
a4458 7
	* generic/tclExecute.c (TclExecuteByteCode): consolidated variable
	handling opcodes, replaced redundant code with some 'goto'. All
	store/append/lappend opcodes on the same data type now share the
	main code; same with incr opcodes.
	* generic/tclVar.c: added the bit TCL_TRACE_READS to the possible
	flags to Tcl_SetVar2Ex - it causes read traces to be fired prior
	to setting the variable. This is used in the core for [lappend].
d4460 1
a4460 6
	***NOTE*** the usage of TCL_TRACE_READS in Tcl_(Obj)?GetVar.* is
	not documented; there, it causes the call to create the variable
	if it does not exist. The new usage in Tcl_(Obj)?SetVar.* remains
	undocumented too ...
	
2002-06-13  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4462 1
a4462 4
	* tests/fCmd.test:
	* tests/winFile.test:
	* tests/fileSystem.test:
	* generic/tclTest.c:
d4464 5
d4470 11
a4480 26
	* doc/FileSystem.3:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: fixed up further so both compiles and
	actually works with VC++ 5 or 6.
	* win/tclWinInt.h: 
	* win/tclWin32Dll.c: cleaned up code and vfs tests and
	added tests for the internal changes of 2002-06-12, to see
	whether WinTcl on NTFS can coexist peacefully with links
	in the filesystem.  Added new test command 'testfilelink'
	to enable the newer code to be tested.
	* tests/fCmd.test: (made certain tests of 'testfilelink' not
	run on unix).

2002-06-12  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tclBasic.c (Tcl_DeleteTrace): fixed [Bug 568123] (thanks to
	Hemang Lavana)
	
2002-06-12  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinFile.c: corrected the symbolic link handling code to
	allow it to compile.  Added real definition of REPARSE_DATA_BUFFER
	(found in winnt.h).  Most of the added definitions appear to have
	correct, cross-Win-version equivalents in winnt.h and should be
	removed, but just making things "work" for now.
d4482 1
a4482 1
2002-06-12  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4484 1
a4484 4
	* generic/tclIOUtil.c:
	* generic/tcl.decls:
	* generic/tclDecls.h: made code for Tcl_FSNewNativePath
	agree with man pages.
d4486 3
a4488 16
	* doc/FileSystem.3: clarified the circumstances under which
	certain functions are called in the presence of symlinks.
	
	* win/tclWinFile.c:
	* win/tclWinPort.h: 
	* win/tclWinInt.h: 
	* win/tclWinFCmd.c:  Fix for Windows to allow 'file lstat', 
	'file type', 'glob -type l', 'file copy', 'file delete', 
	'file normalize', and all VFS code to work correctly in the 
	presence of symlinks (previously Tcl's behaviour was not very 
	well defined).  This also fixes possible serious problems in 
	all versions of WinTcl where 'file delete' on a NTFS symlink 
	could delete the original, not the symlink.
	Note: symlinks cannot yet be created in pure Tcl.

2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>
d4490 1
a4490 19
	* generic/tclBasic.c: 
	* generic/tclCompCmds.c:
	* generic/tclInt.h: reverted the new compilation functions;
	replaced by a more general approach described below.

	* generic/tclCompCmds.c:
	* generic/tclCompile.c: made *all* compiled variable access
	attempts create an indexed variable - even get or incr without
	previous set. This allows indexed access to local variables that
	are created and set at runtime, for example by [global], [upvar],
	[variable], [regexp], [regsub].

2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/global.n:
	* doc/info.n:
	* test/info.test:
	* generic/tclCmdIL.c: fix for [Bug 567386], [info locals] was
	reporting some linked variables.
d4492 1
a4492 6
	* generic/tclBasic.c: 
	* generic/tclCompCmds.c:
	* generic/tclInt.h: added compile functions for [global],
	[variable] and [upvar]. They just declare the new local variables,
	the commands themselves are not compiled-in. This gives a notably
	faster read access to these linked variables.
d4494 1
a4494 1
2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>
d4496 2
a4497 2
	* generic/tclExecute.c: optimised algorithm for exception range
	lookup; part of [Patch 453709].
d4499 2
a4500 1
2002-06-10  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4502 1
a4502 6
	* unix/tclUnixFCmd.c: fixed [Bug #566669]
	* generic/tclIOUtil.c: improved and sped up handling of
	native paths (duplication and conversion to normalized paths),
	particularly on Windows.
	* modified part of above commit, due to problems on Linux. 
	Will re-examine bug report and evaluate more closely.
d4504 1
a4504 1
2002-06-07  Don Porter  <dgp@@users.sourceforge.net>
d4506 1
a4506 2
	* tests/tcltest.test:  More corrections to test suite so that tests
	of failing [test]s don't show up themselves as failing tests.
d4508 2
a4509 1
2002-06-07  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4511 1
a4511 4
	* generic/tclExecute.c: Tidied up headers in relation to float.h
	to cut the cruft and ensure DBL_MAX is defined since doubles seem
	to be the same size everywhere; if the assumption isn't true, the
	variant platforms had better have run configure...
d4513 1
a4513 7
	* unix/tclUnixPort.h (EOVERFLOW): Added code to define it if it
	wasn't previously defined.  Also some other general tidying and
	adding of comments.  [Tcl bugs 563122, 564595]
	* compat/tclErrno.h: Added definition for EOVERFLOW copied from
	Solaris headers; I've been unable to find any uses of EFTYPE,
	which was the error code previously occupying the slot, in Tcl, or
	any definition of it in the Solaris headers.
d4515 7
a4521 1
2002-06-06  Mo DeJong  <mdejong@@users.sourceforge.net>
d4523 1
a4523 3
	* unix/dltest/Makefile.in: Remove hard coded CFLAGS=-g
	and add CFLAGS_DEBUG, CFLAGS_OPTIMIZE, and
	CFLAGS_DEFAULT varaibles. [Tcl bug 565488]
d4525 3
a4527 1
2002-06-06  Don Porter  <dgp@@users.sourceforge.net>
d4529 1
a4529 2
	* tests/tcltest.test:  Corrections to test suite so that tests
	of failing [test]s don't show up themselves as failing tests.
d4531 9
a4539 2
	* tests/io.test: Fixed up namespace variable resolution issues
	revealed by running test suite with "-singleproc 1".
d4541 1
a4541 46
	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test: Several updates to tcltest.
	  1) changed to lazy initialization of test constraints
	  2) deprecated [initConstraintsHook]
	  3) repaired badly broken [limitConstraints].
	  4) deprecated [threadReap] and [mainThread]
	[Patch 512214, Bug 558742, Bug 461000, Bug 534903]

2002-06-06  Daniel Steffen  <das@@users.sourceforge.net>

	* unix/tclUnixThrd.c (TclpReaddir, TclpLocaltime, TclpGmtime):
	added mutex wrapped calls to readdir, localtime & gmtime in
	case their thread-safe *_r counterparts are not available.
	* unix/tcl.m4: added configure check for readdir_r
	* unix/tcl.m4 (Darwin): set TCL_DEFAULT_ENCODING to utf-8 on
	MacOSX (where posix file apis expect utf-8, not iso8859-1).   
	* unix/configure: regen
	* unix/Makefile.in: set DYLD_LIBRARY_PATH in parallel       
	to LD_LIBRARY_PATH for MacOSX dynamic linker.
	* generic/tclEnv.c (TclSetEnv): fix env var setting on
	MacOSX (adapted from patch #524352 by jkbonfield).

2002-06-05  Don Porter  <dgp@@users.sourceforge.net>

	* doc/Tcl_Main.3: Documented $tcl_rcFileName and added more
	clarifications about the intended use of Tcl_Main(). [Bug 505651]

2002-06-05  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclFileName.c (TclGlob): mac specific fix to
	recent changes in 'glob -tails' handling.
	* mac/tclMacPort.h:
	* mac/tclMacChan.c: fixed TIP#91 bustage.
	* mac/tclMacResource.c (Tcl_MacConvertTextResource): added utf
	conversion of text resource contents.
	* tests/macFCmd.test (macFCmd-1.2): allow CWIE creator.

2002-06-04  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:
	* tests/init.test:
	* tests/tcltest.test:	Added more TIP 85 tests from Arjen Markus.
	Converted tcltest.test to use a private namespace.  Fixed bugs in
	[tcltest::Eval] revealed by calling [tcltest::test] from a non-global
	namespace, and namespace errors in init.test.
d4543 6
a4548 1
2002-06-04  Mo DeJong  <mdejong@@users.sourceforge.net>
d4550 2
a4551 1
	* win/README: Update msys+mingw URL.
d4553 10
a4562 1
2002-06-03  Don Porter  <dgp@@users.sourceforge.net>
d4564 2
a4565 8
	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* library/tcltest/pkgIndex.tcl:
	* tests/tcltest.test:  Implementation of TIP 85.  Allows tcltest
	users to add new legal values of the -match option to [test],
	associating each with a Tcl command that does the matching of
	expected results with actual results of tests.  Thanks to
	Arjen Markus.  => tcltest 2.1 [Patch 521362]
d4567 1
a4567 1
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d4569 1
a4569 2
	* doc/namespace.n: added description of [namepace forget]
	behaviour for unqualified patterns [Bug 559268]
d4571 2
a4572 1
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d4574 3
a4576 4
	* generic/tclExecute.c: reverting an accidental modification in
	the last commit.
	
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d4578 1
a4578 2
	* doc/Tcl.n: clarify the empty variable name issue ([Bug 549285]
	reported by Tom Krehbiel, patch by Don Porter).
d4580 2
a4581 1
2002-05-31  Don Porter  <dgp@@users.sourceforge.net>
d4583 1
a4583 2
	* library/package.tcl:  Fixed leak of slave interp in [pkg_mkIndex].
	Thanks to Helmut for report.  [Bug 550534]
d4585 3
a4587 3
	* tests/io.test:
	* tests/main.test:  Use the "stdio" constraint to control whether
	an [open "|[interpreter]"] is attempted.
d4589 1
a4589 67
	* generic/tclExecute.c (TclMathInProgress,TclExecuteByteCode
		ExprCallMathFunc):
	* generic/tclInt.h (TclMathInProgress):
	* unix/Makefile.in (tclMtherr.*):
	* unix/configure.in (NEED_MATHERR):
	* unix/tclAppInit.c (matherr):
	* unix/tclMtherr.c (removed file):
	* win/tclWinMtherr.c (_matherr): Removed internal routine
	TclMathInProgress and Unix implementation of matherr().  These
	are now obsolete, dealing with very old versions of the C math
	library.  Windows version is retained in case Borland compilers
	require it, but it is inactive.  Thanks to Joe English.
	[Bug 474335, Patch 555635].
	* unix/configure: regen

2002-05-30  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompExpr.c:
	* generic/tclCompile.c:
	* generic/tclCompile.h: removed exprIsJustVarRef and
	exprIsComparison from the ExprInfo and CompileEnv structs. These
	were set, but not used since dec 1999 [Bug 562383].

2002-05-30  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c (TclGlob): fix to longstanding
	'knownBug' in fileName tests 15.2-15.4, and fix to a new
	Tcl 8.4 bug in certain uses of 'glob -tails'.
	* tests/fileName.test: removed 'knownBug' flag from some tests,
	added some new tests for above bugs.
	
2002-05-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure: regen'ed
	* unix/configure.in: replaced bigendian check with autoconf
	standard AC_C_BIG_ENDIAN, which defined WORDS_BIGENDIAN on
	bigendian systems.
	* generic/tclUtf.c (Tcl_UniCharNcmp): 
	* generic/tclInt.h (TclUniCharNcmp): use WORDS_BIGENDIAN instead of
	TCL_OPTIMIZE_UNICODE_COMPARE to enable memcmp alternative.

	* generic/tclExecute.c (TclExecuteByteCode INST_STR_CMP):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): changed the case for
	choosing the Tcl_UniCharNcmp compare to when both objs are of
	StringType, as benchmarks show that is the optimal check (both
	bigendian and littleendian systems).

2002-05-29  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclMain.c: Removed "dummy" reference to Tcl_LinkVar.
	It is no longer needed since Tcl_Main() now actually calls
	Tcl_LinkVar().  Thanks to Joe English for pointing that out.

2002-05-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclExecute.c (TclExecuteByteCode): 
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): Use the macro version.
	* generic/tclInt.h (TclUniCharNcmp): Optimised still further with
	a macro for use in sensitive places like tclExecute.c

	* generic/tclUtf.c (Tcl_UniCharNcmp): Use new flag to figure out
	when we can use an optimal comparison scheme, and default to the
	old scheme in other cases which is at least safe.
	* unix/configure.in (TCL_OPTIMIZE_UNICODE_COMPARE): New optional
	flag that indicates when we can use memcmp() to compare Unicode
	strings (i.e. when the high-byte of a Tcl_UniChar precedes the
	low-byte.)
d4591 1
a4591 1
2002-05-29  Jeff Hobbs  <jeffh@@ActiveState.com>
d4593 3
a4595 21
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclUtf.c: added TclpUtfNcmp2 private command that
	mirrors Tcl_UtfNcmp, but takes n in bytes, not utf-8 chars.  This
	provides a faster alternative for comparing utf strings	internally.
	(Tcl_UniCharNcmp, Tcl_UniCharNcasecmp): removed the explicit end
	of string check as it wasn't correct for the function (by doc and
	logic).

	* generic/tclCmdMZ.c (Tcl_StringObjCmd): reworked the string equal
	comparison code to use TclpUtfNcmp2 as well as short-circuit for
	equal objects or unequal length strings in the equal case.
	Removed the use of goto and streamlined the other parts.

	* generic/tclExecute.c (TclExecuteByteCode): added check for
	object equality in the comparison instructions.  Added
	short-circuit for != length strings in INST_EQ, INST_NEQ and
	INST_STR_CMP.  Reworked INST_STR_CMP to use TclpUtfNcmp2 where
	appropriate, and only use Tcl_UniCharNcmp when at least one of the
	objects is a Unicode obj with no utf bytes.
d4597 1
a4597 2
	* generic/tclCompCmds.c (TclCompileStringCmd): removed error
	creation in code that no longer throws an error.
d4599 2
a4600 2
	* tests/string.test:
	* tests/stringComp.test: added more string comparison checks.
d4602 2
a4603 1
	* tests/clock.test: better qualified 9.1 constraint check for %s.
d4605 2
a4606 1
2002-05-28  Jeff Hobbs  <jeffh@@ActiveState.com>
d4608 1
a4608 2
	* generic/tclThreadAlloc.c (TclpRealloc, TclpFree): protect
	against the case when NULL is based.
d4610 1
a4610 67
	* tests/clock.test: added clock-9.1
	* compat/strftime.c:
	* generic/tclClock.c:
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* unix/tclUnixTime.c: fix for Windows msvcrt mem leak caused by
	using an env(TZ) setting trick for in clock format -gmt 1.  This
	also makes %s seem to work correctly with -gmt 1 as well as
	making it a lot faster by avoid the env(TZ) hack.  TclpStrftime
	now takes useGMT as an arg.  [Bug #559376]

2002-05-28  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclIOUtil.c: fixes to Tcl_FSLoadFile when called on
	a file inside a vfs.  This should avoid leaving temporary 
	files sitting around on exit. [Bug #545579]
	
2002-05-27  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* win/tclWinError.c: Added comment on conversion of
	ERROR_NEGATIVE_SEEK because that is a mapping that really belongs,
	and not a catch-all case.
	* win/tclWinPort.h (EOVERFLOW): Should be either EFBIG or EINVAL
	* generic/tclPosixStr.c (Tcl_ErrnoId, Tcl_ErrnoMsg): EOVERFLOW can
	potentially be a synonym for EINVAL.

2002-05-24  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	=== Changes due to TIP#91 ===

	* win/tclWinPort.h: Added declaration of EOVERFLOW.
	* doc/CrtChannel.3: Added documentation of wideSeekProc.
	* generic/tclIOGT.c (TransformSeekProc, TransformWideSeekProc):
	Adapted to use the new channel mechanism.
	* unix/tclUnixChan.c (FileSeekProc, FileWideSeekProc): Renamed
	FileSeekProc to FileWideSeekProc and created new FileSeekProc
	which has the old-style interface and which errors out with
	EOVERFLOW when the returned file position can't fit into the
	return type (int for historical reasons.)
	* win/tclWinChan.c (FileSeekProc, FileWideSeekProc): Renamed
	FileSeekProc to FileWideSeekProc and created new FileSeekProc
	which has the old-style interface and which errors out with
	EOVERFLOW when the returned file position can't fit into the
	return type (int for historical reasons.)
	* mac/tclMacChan.c (FileSeek): Reverted to old interface; Macs
	lack large-file support because I can't see how to add it.
	* generic/tclIO.c (Tcl_Seek, Tcl_Tell): Given these functions
	knowledge of the new arrangement of channel types.
	(Tcl_ChannelVersion): Added recognition of new version code.
	(HaveVersion): New function to do version checking.
	(Tcl_ChannelBlockModeProc, Tcl_ChannelFlushProc)
	(Tcl_ChannelHandlerProc): Made these functions use HaveVersion for
	ease of future maintainability.
	(Tcl_ChannelBlockModeProc): Obvious lookup function.
	* generic/tcl.h (Tcl_ChannelType): New wideSeekProc field, and
	seekProc type restored to old interpretation.
	(TCL_CHANNEL_VERSION_3): New channel version.

2002-05-24  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
	
	* tests/winPipe.test: Applied patch for SF Tcl Bug #549617. Patch
	  and bug report by Kevin Kenny <kennykb@@users.sourceforge.net>.

	* win/tclWinSock.c (TcpWatchProc): Fixed SF Tcl Bug #557878. We
	  are not allowed to mess with the watch mask if the socket is a
	  server socket. I believe that the original reporter is George
	  Peter Staplin.
d4612 2
a4613 1
2002-05-21  Mo DeJong  <mdejong@@users.sourceforge.net>
d4615 1
a4615 7
	* unix/configure: Regen.
	* unix/configure.in: Invoke SC_ENABLE_SHARED before
	calling SC_CONFIG_CFLAGS so that the SHARED_BUILD
	variable can be checked inside SC_CONFIG_CFLAGS.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Pass -non_shared
	instead of -shared to ld when configured with
	--disable-shared under OSF. [Tcl bug 540390]
d4617 2
a4618 1
2002-05-20  Daniel Steffen  <das@@users.sourceforge.net>
d4620 1
a4620 3
	* generic/tclInt.h: added prototype for TclpFilesystemPathType().
	* mac/tclMacChan.c: use MSL provided creator type if available
	instead of the default 'MPW '.
d4622 2
a4623 1
2002-05-16  Joe English  <jenglish@@users.sf.net>
d4625 1
a4625 3
	* doc/CrtObjCmd.3: 
	Added Tcl_GetCommandFromObj, Tcl_GetCommandFullName
	(Tcl Bug #547987, #414921)
d4627 4
a4630 1
2002-05-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4632 1
a4632 3
	* unix/tclUnixChan.c (TtyOutputProc): #if/#endif-ed this function
	out to stop compiler warnings.  Also much general tidying of
	comments in this file and removal of whitespace from blank lines.
d4634 3
a4636 1
2002-05-13  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4638 1
a4638 4
	* unix/tclUnixChan.c (SETBREAK): Solaris thinks ioctl() takes a
	signed second argument, and Linux thinks ioctl() takes an unsigned
	second argument.  So need a longer definition of this macro to get
	neither to spew warnings...
d4640 3
a4642 1
2002-05-13  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4644 1
a4644 8
	* generic/tclEvent.c: 
	* generic/tclIOUtil.c:
	* generic/tclInt.h: clean up all memory allocated by the
	filesystem, via introduction of 'TclFinalizeFilesystem'.
	Move TclFinalizeLoad into TclFinalizeFilesystem so we can
	be sure it is called at just the right time.
	Fix bad comment also.  [Bug #555078 and 'fs' part of #543549]
	* win/tclWinChan.c: fix comment referring to wrong function.
d4646 1
a4646 1
2002-05-10  Don Porter  <dgp@@users.sourceforge.net>
d4648 4
a4651 5
	* tests/load.test:
	* tests/safe.test:
	* tests/tcltest.test: Corrected some list-quoting issues and
	other matters that cause tests to fail when the patch includes
	special characters.  Report from Vince Darley.  [Bug 554068].
d4653 1
a4653 1
2002-05-08    David Gravereaux <davygrvy@@pobox.com>
d4655 3
a4657 15
	* doc/file.n:
	* tools/man2tcl.c:
	* tools/man2help2.tcl:  Thanks to Peter Spjuth
	<peter.spjuth@@space.se>, again.  My prior fix for
	single-quote macro mis-understanding was wrong.	 Reverted to
	reimpliment the 'macro2' proc which handles single-quote macros
	and restored file.n text arrangement to avoid single-quotes on
	the first line.  Sorry for all the confusion.

2002-05-08  David Gravereaux <davygrvy@@pobox.com>

	* tools/man2tcl.c:
	* tools/man2help2.tcl: Proper source of macro error mis-
	understanding single-quote as the leading macro command found
	and repaired.
d4659 1
a4659 2
	* doc/file.n: Reverted to prior state before I messed with
	it.
d4661 2
a4662 1
2002-05-08  Don Porter  <dgp@@users.sourceforge.net>
d4664 1
a4664 17
	* library/tcltest/tcltest.tcl: Corrected [uplevel] quoting when
	[source]-ing test script in subdirectories.
	* tests/fileName.test:
	* tests/load.test:
	* tests/main.test:
	* tests/tcltest.test: 
	* tests/unixInit.test: Fixes to test suite when there's a space
	in the working path.  Thanks to Kevin Kenny.

2002-05-07  David Gravereaux <davygrvy@@pobox.com>

	-- Changes from Peter Spjuth <peter.spjuth@@space.se>
	* tools/man2tcl.c: Increased line buffer size and a bail-out if
	that should ever be over-run.
	* tools/man2help.tcl: Include Courier New font in rtf header.
	* tools/man2help2.tcl: Improved handling of CS/CE fields.  Use
	Courier New for code samples and indent better.
d4666 3
a4668 5
	* doc/file.n:
	* doc/TraceCmd.3:  winhelp conversion tools where understanding
	a ' as the first character on a line to be an unknown macro.
	Not knowing how to repair tools/man2tcl.c, I decided to rearrange
	the text in the docs instead.
d4670 1
a4670 1
2002-05-07  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4672 6
a4677 40
	* generic/tclFileName.c: fix to similar segfault when using 
	'glob -types nonsense -dir dirname -join * *'. [Bug 553320]
	
	* doc/FileSystem.3: further documentation on vfs.
	* tests/cmdAH.test:
	* tests/fileSystem.test:
	* tests/pkgMkindex.test: Fix to testsuite bugs when running out
	of directory whose name contains '{' or '['.

2002-05-07  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/basic.test: Fix for [Bug 549607]
	* tests/encoding.test: Fix for [Bug 549610]
	These are testsuite bugs that caused failures when the filename
	contained spaces. Report & fix by Kevin Kenny.

2002-05-02  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c: fix to freeing a bad object 
	(i.e. segfault) when using 'glob -types nonsense -dir dirname'.
	* generic/tclWinFile.c: fix to [Bug 551306], also wrapped some 
	long lines.
	* tests/fileName.test: added several tests for the above bugs.
	* doc/FileSystem.3: clarified documentation on refCount
	requirements of the object returned by the path type function.
	* generic/tclIOUtil.c:
	* win/tclWinFile.c:
	* unix/tclUnixFile.c:
	* mac/tclMacFile.c: moved TclpFilesystemPathType to the
	platform specific directories, so we can add missing platform-
	specific implementations.  On Windows, 'file system' now returns 
	useful results like "native NTFS", "native FAT" for that system.  
	Unix and MacOS still only return "native".
	* doc/file.n: clarified documentation.
	* tests/winFile.test: test for 'file system' returning correct
	values.
	* tests/fileSystem.test: test for 'file system' returning correct
	values.  Clean up after failed previous test run.
	
2002-04-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d4679 1
a4679 3
	* unix/configure:
	* unix/tcl.m4: change HP-11 SHLIB_LD_LIBS from "" to ${LIBS} so
	that the .sl knows its dependent libs.
d4681 2
a4682 1
2002-04-26  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4684 1
a4684 4
	* tests/obj.test (obj-11.[56]): Test conversion to boolean more
	thoroughly.
	* generic/tclObj.c (SetBooleanFromAny): Was not calling an integer
	parsing function on native 64-bit platforms!  [Bug 548686]
d4686 7
a4692 1
2002-04-24  Jeff Hobbs  <jeffh@@ActiveState.com>
d4694 1
a4694 3
	* generic/tclInt.h: corrected TclRememberJoinableThread decl to
	use VOID instead of void.
	* generic/tclThreadJoin.c: noted that this code isn't needed on Unix.
d4696 2
a4697 1
2002-04-23  Jeff Hobbs  <jeffh@@ActiveState.com>
d4699 1
a4699 2
	* doc/exec.n: 
	* doc/tclvars.n: doc updates [Patch #509426] (gravereaux)
d4701 2
a4702 1
2002-04-24  Daniel Steffen  <das@@users.sourceforge.net>
d4704 1
a4704 4
	* mac/tclMacResource.r: added check of
	TCLTK_NO_LIBRARY_TEXT_RESOURCES #define to allow disabling the
	inclusion of the tcl library code in the resource fork of Tcl
	executables and shared libraries.
d4706 1
a4706 1
2002-04-23  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4708 1
a4708 2
	* doc/TraceCmd.3: New file that documents Tcl_CommandTraceInfo,
	Tcl_TraceCommand and Tcl_UntraceCommand [Bug 414927]
d4710 1
a4710 1
2002-04-22  Jeff Hobbs  <jeffh@@ActiveState.com>
d4712 1
a4712 17
	* generic/tclAlloc.c:
	* generic/tclInt.h:
	* generic/tclThreadAlloc.c (new):
	* unix/Makefile.in:
	* unix/tclUnixThrd.c:
	* win/Makefile.in:
	* win/tclWinInt.h:
	* win/tclWinThrd.c: added new threaded allocator contributed by
	AOL that significantly reduces lock contention when multiple
	threads are in use.  Only Windows and Unix implementations are
	ready, and the Windows one may need work.  It is only used by
	default on Unix for now, and requires that USE_THREAD_ALLOC be
	defined (--enable-threads on Unix will define this).

	* generic/tclIOUtil.c (Tcl_FSRegister, Tcl_FSUnregister):
	corrected calling of Tcl_ConditionWait to ensure that there would
	be a condition to wait upon.
d4714 1
a4714 1
	* generic/tclCmdAH.c (Tcl_FileObjCmd): added cast in FILE_SIZE.
d4716 1
a4716 2
	* win/tclWinFCmd.c (DoDeleteFile): check return of setattr API
	calls in file deletion for correct Win32 API handling.
d4718 3
a4720 2
	* win/Makefile.in: correct dependencies for shell, gdb, runtest
	targets.
d4722 1
a4722 19
	* doc/clock.n:
	* compat/strftime.c (_fmt): change strftime to correctly handle
	localized %c, %x and %X on Windows.  Added some notes about how
	the other values could be further localized.

2002-04-19  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclMain.c (Tcl_Main):  Free the memory allocated for the
	startup script path.  [Bug 543549]

	* library/msgcat/msgcat.tcl:  [mcmax] wasn't using the caller's
	namespace when determining the max translated length.  Also
	made revisions for better use of namespace variables and more
	efficient [uplevel]s.

	* doc/msgcat.n:
	* library/msgcat/msgcat.tcl:
	* library/msgcat/pkgIndex.tcl:  Added [mcload] to the export list
	of msgcat; bumped to 1.2.3.  [Bug 544727]
d4724 1
a4724 1
2002-04-20  Daniel Steffen  <das@@users.sourceforge.net>
d4726 2
a4727 17
	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacUtil.c: Modified TclpObjNormalizePath to be alias
	file aware, and replaced various calls to FSpLocationFrom*Path
	by calls to new alias file aware versions FSpLLocationFrom*Path.
	The alias file aware routines don't resolve the last component of
	a path if it is an alias. This allows [file copy/delete] etc. to
	act correctly on alias files. (c.f. discussion in Bug #511666)

2002-04-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/lindex.test (lindex-3.7): 
	* generic/tclUtil.c (TclGetIntForIndex): Stopped indexes from
	hitting wide ints.  [Bug #526717]
d4729 1
a4729 1
2002-04-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4731 4
a4734 3
	* generic/tclNamesp.c:
	* tests/info.test: [Bug 545325] info level didn't report
	namespace eval, bug report by Richard Suchenwirth.
d4736 1
a4736 1
2002-04-18  Don Porter  <dgp@@users.sourceforge.net>
d4738 10
a4747 3
	* doc/subst.n:  Clarified documentation on handling unusual return
	codes during substitution, and on variable substitutions implied
	by command substitution, and vice versa.  [Bug 536838]
d4749 1
a4749 1
2002-04-18  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4751 3
a4753 3
	* generic/tclCmdIL.c (InfoBodyCmd): 
	* tests/info.test (info-2.6): Proc bodies without string reps
	would report as empty [Bug #545644]
d4755 3
a4757 4
	* generic/tclCmdMZ.c (Tcl_SubstObj): More clarification for
	comment on behaviour when substitutions are not well-formed,
	prompted by [Bug #536831]; alas, removing the ill-defined
	behaviour is a lot of work.
d4759 5
a4763 1
2002-04-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4765 7
a4771 4
	* generic/tclExecute.c:
	* tests/expr-old.test: fix for [Bug #542588] (Phil Ehrens), where
	"too large integers" were reported as "floating-point value" in
	[expr] error messages.
d4773 1
a4773 1
2002-04-17  Jeff Hobbs  <jeffh@@ActiveState.com>
d4775 3
a4777 4
	* generic/tclEncoding.c (EscapeFromUtfProc): 
	* generic/tclIO.c (WriteChars, Tcl_Close): corrected the handling
	of outputting end escapes for escape-based encodings.
	[Bug #526524] (yamamoto)
d4779 3
a4781 1
2002-04-17  Don Porter  <dgp@@users.sourceforge.net>
d4783 1
a4783 4
	* doc/tcltest.n:  Removed [saveState] and [restoreState] from
	tcltest 2 documentation, effectively deprecating them.  [Bug 495660]
	* library/tcltest/tcltest.tcl: Made separate export for commands
	kept only for tcltest 1 compatibility.
d4785 2
a4786 3
	* tests/iogt.test: Revised to run tests in a namespace, rather than
	use the useless and buggy [saveState] and [restoreState] commands
	of tcltest.  Updated to use tcltest 2 as well.  [Patch 544911]
d4788 4
a4791 1
2002-04-16  Don Porter  <dgp@@users.sourceforge.net>
d4793 1
a4793 3
	* tests/io.test: Revised to run tests in a namespace, rather than
	use the useless and buggy [saveState] and [restoreState] commands
	of tcltest.  Updated to use tcltest 2 as well.  [Patch 544546]
d4795 3
a4797 1
2002-04-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d4799 1
a4799 4
	* generic/tclProc.c:
	* tests/proc-old.test: Improved stack trace for TCL_BREAK and
	TCL_CONTINUE returns from procs. Patch by Don Porter
	[Bug 536955]. 
d4801 25
a4825 4
	* generic/tclExecute.c:
	* tests/compile.test: made bytecodes check for a catch before
	  returning; the compiled [return] is otherwise non-catchable. 
	  [Bug 542142] reported by Andreas Kupries.
d4827 1
a4827 1
2002-04-15  Don Porter  <dgp@@users.sourceforge.net>
d4829 1
a4829 2
	* tests/socket.test:  Increased timeout values so that tests have
	time to successfully complete even on slow/busy machines.  [Bug 523470]
d4831 3
a4833 41
	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test:  Revised [tcltest::test] to return errors
	when called with invalid syntax and to accept exactly two arguments
	as documented.  Improved error messages.  [Bug 497446, Patch 513983]
	***POTENTIAL INCOMPATIBILITY***: Incompatible with previous
	tcltest 2.* releases, found only in alpha releases of Tcl 8.4.

2002-04-11  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclNotify.c (TclFinalizeNotifier): remove remaining
	unserviced events on finalization.

	* win/tcl.m4: Enabled COFF as well as CV style debug info with
	--enable-symbols to allow Dr. Watson users to see function info.
	More info on debugging levels can be obtained at:
	http://msdn.microsoft.com/library/en-us/dnvc60/html/gendepdebug.asp

	* tests/ioCmd.test: fixed iocmd-8.15 to have mac and unixPc variants.

	* generic/tclParse.c (Tcl_ParseVar): conditionally incr obj
	refcount to prevent possible mem leak.

2002-04-08  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tcl.h: no <sys/types.h> on mac.
	* mac/tclMacFile.c: minor fixes to Vince's changes from 03-24.
	* mac/tclMacOSA.c:
	* mac/tclMacResource.c: added missing Tcl_UtfToExternalDString
	conversions of resource file names.
	* mac/tclMacSock.c (TcpGetOptionProc): fixed bug introduced
	by Andreas on 02-25; changed strcmp's to strncmp's so that
	option comparison behaves like on other platforms.
	* mac/tcltkMacBuildSupport.sea.hqx (CW Pro6 changes): added
	support to allow Tk to hookup C library stderr/stdout to TkConsole.
	* tests/basic.test:
	* tests/cmdAH.test:
	* tests/encoding.test:
	* tests/fileSystem.test:
	* tests/ioCmd.test: fixed tests failing on mac: check for 
	existence of [exec], changed some result strings.
d4835 1
a4835 1
2002-04-06  Jeff Hobbs  <jeffh@@ActiveState.com>
d4837 2
a4838 5
	* unix/tclUnixFCmd.c (Realpath): added a little extra code to
	initialize a realpath arg when compiling in PURIFY mode in order
	to prevent spurious purify warnings.  We should really create our
	own realpath implementation, but this will at least quiet purify
	for now.
d4840 1
a4840 1
2002-04-05  Don Porter  <dgp@@users.sourceforge.net>
d4842 3
a4844 5
	* generic/tclCmdMZ.c (Tcl_SubstObj):
	* tests/subst.test:  Corrected [subst] so that return codes
	TCL_BREAK and TCL_CONTINUE returned by variable substitution
	have the same effect as when those codes are returned by command
	substitution.  [Bug 536879]
d4846 1
a4846 1
2002-04-03  Jeff Hobbs  <jeffh@@ActiveState.com>
d4848 1
a4848 2
	* library/tcltest/tcltest.tcl: added getMatchingFiles back (alias
	to GetMatchingFiles), which was a public function in tcltest 1.0.
d4850 1
a4850 1
2002-04-01  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4852 2
a4853 48
	* generic/tclEnv.c:
	* generic/tclIOUtil.c: invalidate filesystem cache when the
	user changes env(HOME).  Fixes [Bug #535621].  Also cleaned up
	some of the documentation.
	* tests/fileSystem.test: added test for bug just fixed.
	
2002-04-01  Kevin Kenny  <kennykb@@acm.org>

	* win/tclWinTime.c (Tcl_GetTime): made the checks of clock
	frequency more permissive to cope with the fact that Win98SE
	is observed to return 1.19318 in place of 1.193182 for the
	performance counter frequency.
	
2002-03-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclCmdMZ.c (Tcl_TraceObjCmd, TraceVarProc)
	(TraceCommandProc, TclTraceCommandObjCmd):  corrected
	potential double-free of traces on variables by flagging in
	Trace*Proc that it will free the var in case the eval wants to
	delete the var trace as well. [Bug #536937]
	Also converted Tcl_UntraceVar -> Tcl_UntraceVar2 and Tcl_Eval to
	Tcl_EvalEx in Trace*Proc for slight efficiency improvement.

2002-03-29  Don Porter  <dgp@@users.sourceforge.net>

	* doc/AllowExc.3:
	* generic/tclBasic.c (Tcl_EvalObjv,Tcl_EvalEx,Tcl_EvalObjEx):
	* generic/tclCompile.h (TclCompEvalObj):
	* generic/tclExecute.c (TclCompEvalObj,TclExecuteByteCode):
	* tests/basic.test: Corrected problems with Tcl_AllowExceptions
	having influence over the wrong scope of Tcl_*Eval* calls.  Patch
	from Miguel Sofer.  Report from Jean-Claude Wippler.  [Bug 219181]

2002-03-28  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclVar.c: Refactored CallTraces to collect repeated
	handling of its returned value into CallTraces itself.

2002-03-28  David Gravereaux <davygrvy@@pobox.com>

	* tools/feather.bmp:
	* tools/man2help.tcl:
	* tools/man2help2.tcl:
	* win/makefile.vc: More winhelp target fixups.  Added a feather
	bitmap to the non-scrollable area and changed the color to be
	yellow from a plain white.  The colors can be whatever we want
	them to be, but thought I would start with something bold.
	[Bug 527941]
d4855 4
a4858 3
	* doc/SetVar.3:
	* doc/TraceVar.3:
	* doc/UpVar.3:  .AP macro syntax repair.
d4860 1
a4860 1
2002-03-27  David Gravereaux <davygrvy@@pobox.com>
d4862 2
a4863 25
	* tools/man2help.tcl:
	* win/makefile.vc:  winhelp target now copies all needed files
	from tools/ to a workarea under $(OUT_DIR) and builds it from
	there.  No build cruft is left in tools/ anymore.  All paths
	used in man2help.tcl are now relative to where the script is.
	[Bug 527941]

2002-03-27  David Gravereaux <davygrvy@@pobox.com>

	* win/.cvsignore:
	* win/buildall.vc.bat:
	* win/coffbase.txt:
	* win/makefile.vc:
	* win/nmakehlp.c (new):
	* win/rules.vc:  First draft fix for [Bug 527941].  More changes
	need to done to the makehelp target to get to stop leaving build
	files in the tools/ directory.  This does not address the syntax
	errors in the man files.  Having the contents of tcl.hpj(.in)
	inside makefile.vc allows for version numbers to be replaced with
	macros.
	
	The new nmakehlp.c is built by rules.vc in preprocessing and removes
	the need to use tricky shell syntax that wasn't compatible on Win9x
	systems.  Clean targets made Win9x complient.  This is a first draft
	repair for [Bug 533862].
d4865 1
a4865 1
2002-03-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d4867 4
a4870 2
	* generic/tclBasic.c (Tcl_EvalEx): passing the correct commandSize
	to TclEvalObjvInternal. [Bug 219362], fix by David Knoll.
d4872 1
a4872 1
2002-03-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d4874 4
a4877 3
	* generic/tclBasic.c (Tcl_EvalEx):
	* tests/basic.test: avoid exceptional returns at level 0 
	[Bug 219181] 
d4879 2
a4880 1
2002-03-27  Don Porter  <dgp@@users.sourceforge.net>
d4882 1
a4882 5
	* doc/tcltest.n ([mainThread]):
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test:  Major code cleanup to deal with whitespace,
	coding conventions, and namespace issues, with several minor bugs
	fixed in the process.
d4884 2
a4885 1
	* tests/main.test: Added missing [after cancel]s.
d4887 2
a4888 1
2002-03-25  Don Porter  <dgp@@users.sourceforge.net>
d4890 1
a4890 1
	* tests/main.test: Removed workarounds for Bug 495977.
d4892 2
a4893 8
	* library/tcltest/tcltest.tcl:  Keep the value of $::auto_path
	unchanged, so that the tcltest package can test code that depends
	on auto-loading.  If a testing application needs $::auto_path pruned,
	it should do that itself.  [Bug 495726]
	Improve the processing of the -constraints option to [test] so that
	constraint lists can have arbitrary whitespace, and non-lists don't
	blow things up.  [Bug 495977]
	Corrected faulty variable initialization. [Bug 534845]
d4895 7
a4901 1
2002-03-25  Miguel Sofer  <msofer@@users.sourceforge.net>
d4903 1
a4903 3
	* doc/CrtTrace.3: small doc correction
	* generic/tclBasic.c (Tcl_DeleteTrace): Allow NULL callback on
	trace deletions [Bug 534728] (Hemang Lavana).
d4905 2
a4906 1
2002-03-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d4908 2
a4909 2
	* generic/tclBasic.c (Tcl_EvalObjv): replaced obscure, incorrect
	code as described in [Bug 533907] (Don Porter).
d4911 1
a4911 1
2002-03-24  Don Porter  <dgp@@users.sourceforge.net>
d4913 3
a4915 2
	* library/tcltest/tcltest.tcl:  Use [interpreter] to set/query the
	executable currently running the tcltest package.  [Bug 454050]
d4917 2
a4918 2
	* library/tcltest/tcltest.tcl:  Allow non-proc commands to be used
	as the customization hooks.  [Bug 495662]
d4920 2
a4921 1
2002-03-24  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4923 1
a4923 53
	* generic/tclFilename.c:
	* generic/tclFCmd.c:
	* generic/tclTest.c:
	* generic/tcl.h:
	* generic/tclIOUtil.c:
	* win/tclWinFile.c:
	* win/tclWinFCmd.c:
	* win/tclWinPipe.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixFCmd.c:
	* mac/tclMacFile.c:
	* doc/FileSystem.3:
	* doc/file.n:
	* tests/cmdAH.test:
	* tests/fileName.test:
	* tests/fileSystem.test: (new file)	
	* tests/winFCmd.test: fix [Bug 511666] and [Bug 511658],
	and improved documentation of some aspects of the filesystem,
	particularly 'Tcl_FSMatchInDirectory' which now might match
	a single file/directory only, and 'file normalize' which
	wasn't very clear before.  Removed inconsistency betweens
	docs and the Tcl_Filesystem structure.  Also fixed 
	[Bug 523217] and corrected file normalization on Unix so that 
	it expands symbolic links.  Added some new tests of the 
	filesystem code (in the new file 'fileSystem.test'), and 
	some extra tests for correct handling of symbolic links.
	Fix to [Bug 530960] which shows up on Win98.  Made comparison
	with ".com" case insensitive in tclWinPipe.c
	
	***POTENTIAL INCOMPATIBILITY***: But only between alpha
	releases (users of the new Tcl_Filesystem lookup table in Tcl
	8.4a4 need to handle the new way in which Tcl may call
	Tcl_FSMatchInDirectory, and 'file normalize' on unix now
	behaves correctly).  Only known impact is with the 'tclvfs'
	extension.

2002-03-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/basic.test (basic-46.1): adding test for [Bug 533758],
	fixed earlier today.
	
2002-03-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinInt.h: moved undef of TCL_STORAGE_CLASS. [Bug #478579]

2002-03-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_EvalObjEx):
	* generic/tclExecute.c (TclCompEvalObj): fixed the errorInfo for
	return codes other than (TCL_OK, TCL_ERROR) to runLevel 0 
	[Bug 533758]. Removed the static RecordTracebackInfo(), as its
	functionality is easily replicated by Tcl_LogCommandInfo. Bug
	and redundancy noted by Don Porter.
d4925 2
a4926 1
2002-03-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4928 5
a4932 1
	* doc/expr.n: Improved documentation for ceil and floor [Bug 530535]
d4934 1
a4934 1
2002-03-20  Don Porter  <dgp@@users.sourceforge.net>
d4936 24
a4959 21
	* doc/SetVar.3:
	* doc/TraceVar.3:
	* doc/UpVar.3:
	* generic/tcl.h (Tcl_VarTraceProc):
	* generic/tcl.decls (Tcl_GetVar2, Tcl_SetVar2, Tcl_TraceVar2,
	  Tcl_UnsetVar2, Tcl_UntraceVar2, Tcl_UpVar2, Tcl_VarTraceInfo2,
	  Tcl_GetVar2Ex, TclSetVar2Ex):
	* generic/tclCmdMZ.c (TraceVarProc):
	* generic/tclEnv.c (EnvTraceProc):
	* generic/tclEvent.c (VwaitVarProc):
	* generic/tclInt.decls (TclLookupVar,TclPrecTraceProc):
	* generic/tclLink.c (LinkTraceProc):
	* generic/tclUtil.c (TclPrecTraceProc):
	* generic/tclVar.c (CallTraces, MakeUpvar, VarErrMsg, TclLookupVar,
	  Tcl_GetVar2, Tcl_SetVar2, Tcl_TraceVar2, Tcl_UnsetVar2,
	  Tcl_UntraceVar2, Tcl_UpVar2, Tcl_VarTraceInfo2, Tcl_GetVar2Ex,
	  TclSetVar2Ex): Updated interfaces of generic/tclVar.c according
	to TIP 27.  In particular, the "part2" arguments were CONSTified.
	[Patch 532642]
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs
d4961 3
a4963 1
2002-03-15  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4965 1
a4965 3
	* tests/compile.test (compile-12.3): Test to detect bug 530320.
	* generic/tclCompile.c (TclCompileTokens): Fixed buffer overrun
	reported in bug 530320.
d4967 2
a4968 1
2002-03-14  Mo DeJong  <mdejong@@users.sourceforge.net>
d4970 2
a4971 12
	* win/configure: Regen.
	* win/configure.in: Add configure time test for SEH
	support in the compiler.
	* win/tclWin32Dll.c (ESP, EBP, TclpCheckStackSpace,
	_except_checkstackspace_handler):
	* win/tclWinChan.c (ESP, EBP, Tcl_MakeFileChannel,
	_except_makefilechannel_handler):
	* win/tclWinFCmd.c (ESP, EBP, DoRenameFile,
	_except_dorenamefile_handler,
	DoCopyFile, _except_docopyfile_handler):
	Implement SEH support under gcc using inline asm.
	Tcl and Tk should now compile with Mingw 1.1. [Patch 525746]
d4973 1
a4973 1
2002-03-14  Mo DeJong  <mdejong@@users.sourceforge.net>
d4975 2
a4976 6
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile): Handle
	an SEH exception with EXCEPTION_EXECUTE_HANDLER instead
	of restarting the faulting instruction with
	EXCEPTION_CONTINUE_EXECUTION. Bug 466102 provides an
	example of how restarting could send Tcl into an
	infinite loop. [Patch 525746]
d4978 1
a4978 1
2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d4980 3
a4982 4
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile, DoDeleteFile,
	DoRemoveJustDirectory): Make sure we don't pass NULL or ""
	as a path name to Win32 API functions since this was
	crashing under Windows 98.
d4984 2
a4985 1
2002-03-11  Don Porter  <dgp@@users.sourceforge.net>
d4987 1
a4987 2
	* library/tcltest/tcltest.tcl:
	* library/tcltest/pkgIndex.tcl: Bumped tcltest package to 2.0.2.
d4989 3
a4991 1
2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d4993 1
a4993 3
	* library/tcltest/tcltest.tcl (getMatchingFiles): Pass
	a proper list to foreach to avoid munging a Windows
	patch like D:\Foo\Bar into D:FooBar before the glob.
d4995 7
a5001 1
2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d5003 1
a5003 6
	* generic/tclEncoding.c: Fix typo in comment.
	* generic/tclIO.c (DoReadChars, ReadBytes, ReadChars):
	Use NULL value instead of pointer set to NULL to make
	things more clear. Reorder arguments so that they
	match the function signatures. Cleanup little typos
	and add more descriptive comment.
d5005 6
a5010 1
2002-03-08  Mo DeJong  <mdejong@@users.sourceforge.net>
d5012 1
a5012 4
	* win/README: Update to indicate that Mingw 1.1 is
	required to build Tcl. Add section describing new
	msys based build process. Update Cygwin build
	instructions so users know where to find Mingw 1.1.
d5014 1
a5014 1
2002-03-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d5016 8
a5023 1
	* win/tclWinFCmd.c (DoCopyFile): correctly set retval to TCL_OK.
d5025 1
a5025 1
2002-03-07  Mo DeJong  <mdejong@@users.sourceforge.net>
d5027 3
a5029 5
	* win/tclWin32Dll.c (TclpCheckStackSpace):
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile): Replace
	hard coded constants with Win32 symbolic names.
	Move control flow statements out of __try blocks
	since the documentation indicates it is frowned upon.
d5031 1
a5031 1
2002-03-07  Don Porter  <dgp@@users.sourceforge.net>
d5033 2
a5034 6
	* doc/interp.n:
	* generic/tclInterp.c(Tcl_InterpObjCmd,SlaveObjCmd,SlaveRecursionLimit):
	* generic/tclTest.c:
	* tests/interp.test: Added the [interp recursionlimit] command to
	set/query the recursion limit of an interpreter.  Proposal and
	implementation from Stephen Trier. [TIP 87, Patch 522849]
d5036 1
a5036 1
2002-03-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5038 1
a5038 5
	* generic/tcl.h, tools/tcl.wse.in, unix/configure.in,
	* unix/tcl.spec, win/README.binary, win/configure.in, README:
	Bumped patchlevel; this might need to change in the future, but it
	will help us distinguish between the CVS version and the most
	recent released version.
d5040 2
a5041 1
2002-03-06  Miguel Sofer  <msofer@@users.sourceforge.net>
d5043 1
a5043 3
	* generic/tclInt.h: for unshared objects, TclDecrRefCount now
	frees the internal rep before the string rep - just like the
	non-macro Tcl_DecrRefCount/TclFreeObj [Bug 524802]. 
d5045 3
a5047 1
2002-03-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5049 1
a5049 4
	* doc/lsearch.n: Documentation of new features, plus examples.
	* tests/lsearch.test: Tests of new features.
	* generic/tclCmdIL.c (Tcl_LsearchObjCmd): TIP#80 support.  See
	http://purl.org/tcl/tip/80 for details.
d5051 2
a5052 1
2002-03-05  Jeff Hobbs  <jeffh@@ActiveState.com>
d5054 9
a5062 1
	*** 8.4a4 TAGGED FOR RELEASE ***
d5064 1
a5064 4
	* unix/tclUnixChan.c: initial remedy for [Bug #525783] flush
	problem introduced by TIP #35.  This may not satisfy true serial
	channels, but it restores the correct flushing of std* channels on
	exit.
d5066 9
a5074 1
	* unix/README: added --enable-langinfo doc.
d5076 1
a5076 2
	* unix/tcl.spec:
	* tools/tcl.wse.in: fixed URL refs to use www.tcl.tk or SF.
d5078 1
a5078 1
2002-03-04  Jeff Hobbs  <jeffh@@ActiveState.com>
d5080 1
a5080 6
	* README:
	* mac/README:
	* unix/Makefile.in:
	* unix/README:
	* win/README:
	* win/README.binary: updated to use www.tcl.tk URL.
d5082 3
a5084 1
	* unix/Makefile.in: added older ChangeLogs to dist target.
d5086 1
a5086 7
	* tests/io.test:
	* tests/encoding.test: corrected iso2022 encoding results.
	added encoding-24.*
	* generic/tclEncoding.c (EscapeFromUtfProc): corrected output of
	escape codes as per RFC 1468. [Patch #474358] (taguchi)
	(TclFinalizeEncodingSubsystem): corrected potential double-free
	when encodings were finalized on exit. [Bug #219314, #524674]
d5088 2
a5089 1
2002-03-01  Jeff Hobbs  <jeffh@@ActiveState.com>
d5091 1
a5091 5
	* library/encoding/iso2022-jp.enc: 
	* library/encoding/iso2022.enc: 
	* tools/encoding/iso2022-jp.esc:
	* tools/encoding/iso2022.esc: gave <ESC>$B precedence over <ESC>$@@,
	based on comments (point 1) in [Bug #219283] (rfc 1468)
d5093 16
a5108 5
	* tests/encoding.test: added encoding-23.* tests
	* generic/tclIO.c (FilterInputBytes): reset the TCL_ENCODING_START
	flags in the ChannelState when using 'gets'. [Bug #523988]
	Also reduced the value of ENCODING_LINESIZE from 30 to 20 as this
	seems to improve the performance of 'gets' according to tclbench.
d5110 1
a5110 1
2002-02-28  Jeff Hobbs  <jeffh@@ActiveState.com>
d5112 2
a5113 3
	* generic/tclCmdMZ.c (TraceCommandProc): ensure that TraceCommandInfo
	structure was also deleted when a command was deleted to prevent a
	mem leak.
d5115 1
a5115 2
	* generic/tclBasic.c (Tcl_CreateObjTrace): set tracePtr->flags
	correctly.
d5117 1
a5117 2
	* generic/tclTimer.c (TimerExitProc): remove remaining events in
	tls on thread exit.
d5119 1
a5119 1
2002-02-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d5121 3
a5123 3
	* generic/tclNamesp.c: allow cached fully-qualified namespace
	names to be usable from different namespaces within the same
	interpreter without forcing a new lookup [Patch 458872]. 
d5125 1
a5125 1
2002-02-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d5127 1
a5127 2
	* generic/tclExecute.c: Replaced a few direct stack accesses 
	with the POP_OBJECT() macro [Bug 507181] (Don Porter).
d5129 1
a5129 1
2002-02-27  Don Porter  <dgp@@users.sourceforge.net>
d5131 1
a5131 8
	* doc/GetIndex.3:
	* generic/tcl.decls (Tcl_GetIndexFromObjStruct):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObjStruct):  Revised the
	prototype of the Tcl_GetIndexFromObjStruct to take its struct
	table as a (CONST VOID *) argument, better describing what it is,
	maintaining source compatibility, and adding CONST correctness
	according to TIP 27.  Thanks to Joe English for an elegant
	solution. [Bug 520304]
d5133 1
a5133 1
	* generic/tclDecls.h: make genstubs
d5135 1
a5135 3
	* generic/tclMain.c (Tcl_Main,StdinProc):  Corrected some reference
	count management errors on the interactive command Tcl_Obj found by
	Purify.  Thanks to Jeff Hobbs for the report and assistance.
d5137 1
a5137 1
2002-02-27  Jeff Hobbs  <jeffh@@ActiveState.com>
d5139 3
a5141 2
	* generic/tclBasic.c (Tcl_EvalTokensStandard): corrected mem leak
	in error case.
d5143 1
a5143 1
	* generic/tclTest.c (TestStatProc[123]): correct harmless UMRs.
d5145 2
a5146 1
	* generic/tclLink.c (Tcl_LinkVar): correct mem leak in error case.
d5148 1
a5148 1
2002-02-27  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5150 2
a5151 3
	* tests/socket.test (2.7): Accepted and applied patch for Tcl SF
	  bug #523470 provided by Don Porter <dgp@@users.sourceforge.net>
	  to avoid timing problems in that test.
d5153 1
a5153 8
	* unix/tclUnixChan.c (TclpOpenFileChannel): Added code to regonize
	  "/dev/tty" (by name) and to not handle it as tty / serial
	  line. This is the controlling terminal and is special. Setting
	  it into raw mode as is done for other tty's is a bad idea. This
	  is a hackish fix for expect SGF Bug #520624. The fix has
	  limitation: Tcl_MakeFileChannel handles tty's specially too, but
	  is unable to recognize /dev/tty as it only gets a file
	  descriptor, and no name for it.
d5155 1
a5155 1
2002-02-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d5157 1
a5157 1
	* generic/tclCmdAH.c (StoreStatData): corrected mem leak.
d5159 2
a5160 2
	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): prevent obj leak in
	  remedial regsub case.
d5162 1
a5162 2
	* generic/tclFileName.c (Tcl_TranslateFileName): decr refcount for
	  error case to prevent mem leak.
d5164 1
a5164 1
	* generic/tclVar.c (Tcl_ArrayObjCmd): removed extra obj allocation.
d5166 2
a5167 3
	* unix/tclUnixSock.c (Tcl_GetHostName): added an extra
	  gethostbyname check to guard against failure with truncated
	  names returned by uname.
d5169 1
a5169 3
	* unix/configure:
	* unix/tcl.m4 (SC_SERIAL_PORT): added sys/modem.h check and defined
	  _XOPEN_SOURCE_EXTENDED for HP-11 to get updated header decls.
d5171 2
a5172 2
	* unix/tclUnixChan.c: added Unix implementation of TIP #35, serial
	  port support. [Patch #438509] (schroedter)
d5174 1
a5174 1
2002-02-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d5176 3
a5178 4
	* generic/tclCmpCmds.c: (bugfix to the bugfix, hopefully the last)
	  Bugfix to the new [for] compiling code: was setting a
	  exceptArray parameter using another param which wasn't yet
	  initialised, thus filling it with noise.
d5180 1
a5180 1
2002-02-25  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5182 2
a5183 3
	* mac/tclMacSock.c (TcpGetOptionProc): Changed to recognize the
	  option "-error". Essentially ignores the option, always
	  returning an empty string.
d5185 1
a5185 1
2002-02-25  Jeff Hobbs  <jeffh@@ActiveState.com>
d5187 2
a5188 8
	* doc/Alloc.3:
	* doc/LinkVar.3:
	* doc/ObjectType.3:
	* doc/PkgRequire.3:
	* doc/Preserve.3:
	* doc/TCL_MEM_DEBUG.3: Updated documentation to describe the ckalloc,
	ckfree, ckrealloc, attemptckalloc, and attemptckrealloc macros, and
	to accurately describe when and how they are used. [Bug #497459] (dgp)
d5190 1
a5190 6
	* generic/tclHash.c (AllocArrayEntry, AllocStringEntry):
	Before invoking ckalloc when creating a Tcl_HashEntry,
	check that the amount of memory being allocated is
	at least as large as sizeof(Tcl_HashEntry). The previous
	code was allocating memory regions that were one
	or two bytes short. [Bug #521950] (dejong)
d5192 1
a5192 1
2002-02-25  Miguel Sofer  <msofer@@users.sourceforge.net>
d5194 1
a5194 4
	* generic/tclBasic.c (Tcl_EvalEx): avoiding a buffer overrun
	reported by Joe English, and restoring tcl7.6 behaviour for
	[subst]: badly terminated nested scripts will raise an error
	and not be evaluated. [Bug #495207]
d5196 1
a5196 1
2002-02-25  Don Porter  <dgp@@users.sourceforge.net>
d5198 1
a5198 4
	* unix/tclUnixPort.h: corrected strtoll prototype mismatch on Tru64.
	* compat/strtod.c (strtod): simplified #includes
	* compat/strtol.c (strtol): gather result in a long before returning
	as a long: necessary on platforms where sizeof(int) != sizeof(long).
d5200 1
a5200 1
2002-02-25  Daniel Steffen  <das@@users.sourceforge.net>
d5202 1
a5202 2
	* unix/tclLoadDyld.c: updated to use Mac OS X 10.1 dyld APIs that
	have more libdl-like semantics. (bug #514392)
d5204 1
a5204 1
2002-02-25  Miguel Sofer  <msofer@@users.sourceforge.net>
d5206 1
a5206 9
	* generic/tclCompCmds: fixing a bug in patch dated 2002-02-22, in
	the code for [for] and [while]. Under certain conditions, for long
	bodies, the exception range parameters were badly computed. Tests
	forthcoming: I still can't reproduce the conditions in the
	testsuite (!), although the bug (with assorted segfault or panic!)
	can be triggered from the console or with the new parse.bench in  
	tclbench.
	
2002-02-25  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5208 1
a5208 2
	* compat/strtoul.c, compat/strtol.c, compat/strtod.c: Added UCHAR,
	CONST and #includes to clean up GCC output.
d5210 1
a5210 1
2002-02-23  Don Porter  <dgp@@users.sourceforge.net>
d5212 2
a5213 5
	* compat/strtoull.c (strtoull):
	* compat/strtoll.c (strtoll):
	* compat/strtoul.c (strtoul): Fixed failure to handle leading
	sign symbols '+' and '-' and '0X' and raise overflow errors.
	[Bug 440916]  Also corrects prototype and errno problems.
d5215 1
a5215 1
2002-02-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d5217 2
a5218 4
	* configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Link with -n32
	instead of -32 when building on IRIX64-6.* system.
	[Tcl bug 521707]
d5220 3
a5222 1
2002-02-22  Don Porter <dgp@@users.sourceforge.net>
d5224 1
a5224 5
	* generic/tclInt.h:
	* generic/tclObj.c: renamed global variable emptyString ->
	tclEmptyString because it is no longer static.
	* generic/tclPkg.c: Fix for panic when library is loaded on a
	platform without backlinking without proper use of stubs. [Bug 476537]
d5226 3
a5228 1
2002-02-22  Jeff Hobbs  <jeffh@@ActiveState.com>
d5230 1
a5230 2
	* tests/regexpComp.test: updated regexp-11.[1-4] to match changes
	in regexp.test for new regsub syntax
d5232 2
a5233 3
	* unix/configure:
	* unix/tcl.m4: added --enable-64bit support for AIX-4 (using -q64
	flag) when using IBM's xlc compiler.
d5235 1
a5235 58
	* tests/safe.test: updated safe-8.5 and safe-8.7
	* library/safe.tcl (CheckFileName): removed the limit on
	sourceable file names (was only *.tcl or tclIndex files with no
	more than one dot and 14 chars).  There is enough internal
	protection in a safe interpreter already.  Fixes [Tk Bug #521560].

2002-02-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompCmds: [FR 465811]. Optimising [if], [for] and
	[while] for constant conditions; in addition, [for] and [while]
	are now compiled with the "loop rotation" optimisation (thanks to
	Kevin Kenny). 

2002-02-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	--- TIP#76 CHANGES ---
	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): Final-argument-less
	[regsub] returns the modified string.
	* doc/regsub.n: Updated docs.
	* tests/regexp.test: Updated and added tests.

	* compat/strtoll.c (strtoll): 
	* compat/strtoull.c (strtoull): 
	* unix/tclUnixPort.h:
	* win/tclWinPort.h: Const-ing 64-bit compatability declarations.
	Note that the return pointer is non-const because it is entirely
	legal for the functions to be called from somewhere that owns the
	string being passed.  Fixes problem reported by Larry Virden.

2002-02-21  David Gravereaux <davygrvy@@pobox.com>

	* win/mkd.bat (removed):
	* win/coffbase.txt (new):
	* win/makefile.bc:
	* win/makefile.vc:  Changed the 'setup' target to stop using
	the mkd.bat file and just make the directory right in the rule.
	Same change to makefile.bc.  configure.in nor Makefile.in use
	it.

	coffbase.txt will be the master list for our "prefered base
	addresses" set by the linker.  This should improve load-time
	(NT only) by avoiding relocations.  Submissions to the list
	by extension authors are encouraged.

	Added a 'tidy' target to compliment 'clean' and 'hose' to remove
	just the outputs. Also removed the $(winlibs) macro as it wasn't
	being used.

	Stuff left to do:
	1) get the winhelp target to stop building in the tools/
	directory.
	2) stop using rmd.bat
	3) add more dependacy rules.

	* win/tclAppInit.c:  Reverted back to -r1.6, as the header file
	change to tclPort.h won't allow for easy embedded support
	outside of the source dist.  Thanks to Don Porter for pointing
	this out to me.
d5237 1
a5237 1
2002-02-21  David Gravereaux <davygrvy@@pobox.com>
d5239 1
a5239 4
	* win/makefile.vc:
	* win/rules.vc:  Added a new "loimpact" option that sets the
	-ws:aggressive linker option.  Off by default.  It's said to
	keep the heap use low at the expense of alloc speed.
d5241 1
a5241 5
	* win/tclAppInit.c: Changed #include "tcl.h" to be tclPort.h to
	remove the raw windows.h include.  tclPort.h brings in windows.h
	already and lessens the pre-compiled-header mush and the randomly
	useless	#pragma comment (lib,...) references throughout the big
	windows.h tree (as observed at high linker warning levels).
d5243 2
a5244 1
2002-02-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5246 1
a5246 2
	* generic/tcl.h: Better guessing of LP64/ILP32 architecture, but
	now sensitive to presence of (suitable) <limits.h>
d5248 1
a5248 1
2002-02-20  Don Porter <dgp@@users.sourceforge.net>
d5250 1
a5250 5
	* generic/tcl.decls (Tcl_RegExpRange,Tcl_GetIndexFromObjStruct):
	Overlooked a few source incompatibilities.  Now using CONST84.
	* generic/tclDecls.h: make genstubs
	* generic/tcl.h (Tcl_CmdObjTraceProc): silence warning from Sun
	Workshop compiler.
d5252 1
a5252 1
2002-02-20  David Gravereaux <davygrvy@@pobox.com>
d5254 1
a5254 12
	* win/buildall.vc.bat:
	* win/makefile.vc:
	* win/rules.vc: General clean-ups.  Added compiler and linker tests
	for a) the pentium 0x0F errata, b) optimizing (not all have this),
	and c) linker v6 section alignment confusion.  All these are tested
	first to make sure any D4002 or LNK1117 warnings aren't displayed.
	The pentium 0x0F errata is a recommended switch.  The v5 linker's
	section alignment default is 512, but the v6 linker was changed
	to 4096 in an attempt to speed loading on Win98.  I changed the
	default to always be 512 across both linkers, unless linking
	statically, then 4096 is used for the claimed speed effect. Using
	a 512 alignment saves 12k bytes of dead space in the DLL.
d5256 3
a5258 1
	Added IA64 B-stepping errata switch when the compiler supports it.
d5260 1
a5260 2
	Added profiling to $(lflags) when requested and also removed the
	explict -entry option as the default works fine as is.
d5262 2
a5263 3
	Removed win/tclWinInit.c from the special case section to let it
	use the common implicit rule as the $(EXTFLAGS) macro it had was
	never referenced anywhere.
d5265 3
a5267 1
2002-02-20  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5269 1
a5269 3
	* generic/tcl.h: Added code to guess the correct settings for
	TCL_WIDE_INT_IS_LONG and TCL_WIDE_INT_TYPE when configure doesn't
	tell us them, as can happen with extensions.
d5271 7
a5277 1
2002-02-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5279 1
a5279 5
	* doc/format.n: Updated docs to list the specification.
	* generic/tclCmdAH.c (Tcl_FormatObjCmd): Made behaviour on 64-bit
	platforms correctly meet the specification, that %d works with the
	native word-sized integer, instead of trying to guess (wrongly)
	from the value being passed.
d5281 2
a5282 1
2002-02-19  Don Porter <dgp@@users.sourceforge.net>
d5284 1
a5284 1
	* changes: First draft of updated changes for 8.4a4 release.
d5286 2
a5287 1
2002-02-15  Jeff Hobbs  <jeffh@@ActiveState.com>
d5289 1
a5289 2
	* unix/tclUnixPort.h: add strtoll/strtoull declarations for
	platforms that do not define them.
d5291 2
a5292 2
	* generic/tclIndexObj.c (STRING_AT): removed ptrdiff_t cast and
	use of VOID* in default case (GNU-ism).
d5294 1
a5294 1
2002-02-15  Kevin Kenny  <kennykb@@acm.org>
d5296 2
a5297 109
	* compat/strtoll.c:
	* compat/strtoul.c:
	* compat/strtoull.c:
	* generic/tclIOUtil.c:
	* generic/tclPosixStr.c:
	* generic/tclTest.c:
	* generic/tclTestObj.c:
	* tests/get.test:
	* win/Makefile.vc: Further tweaks to the TIP 72 patch to make it
	compile under VC++.
	
2002-02-15  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tclExecute.c:
	* tclIOGT.c:
	* tclIndexObj.c: Touchups to the TIP 72 patch to make it
	  compileable under Windows again. The changes are not complete,
	  there is one nasty regarding _stati64

2002-02-15  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	+----------------------+
	| TIP #72 IMPLEMENTED. |
	+----------------------+

	There are a lot of changes from this TIP, so please see
	http://purl.org/tcl/tip/72.html for discussion of
	backward-compatability issues, but the main ones modifications are
	in:

	* generic/tcl.h: New types.
	* generic/tcl.decls: New public functions.
	* generic/tclExecute.c: 64-bit aware bytecode engine.
	* generic/tclBinary.c: 64-bit handling in [binary] command.
	* generic/tclScan.c: 64-bit handling in [scan] command.
	* generic/tclCmdAH.c: 64-bit handling in [file] and [format]
	commands.
	* generic/tclBasic.c: New "wordSize" entry in ::tcl_platform.
	* generic/tclFCmd.c: Large-file support (with many consequences.)
	* generic/tclIO.c: Large-file support (with many consequences.)
	* compat/strtoll.c, compat/strtoull.c: New support functions.
	* unix/tcl.m4, unix/configure: 64-bit support and greatly enhanced
	cacheing.

	Most other changes, including all those in doc/* and test/* as
	well as the majority in the platform directories, follow on from
	these.

	Also coming out of the woodwork:
	* generic/tclIndex.c: Better support for Cray PVP.
	* win/tclWinMtherr.c: Better Borland support.

	Note that, in a number of places through the Unix part of the
	platform support, there are Tcl_Platform* references.  These are
	expanded into the correct way to call that particular underlying
	function, i.e. with or without a '64' suffix, and should be used
	by people working on the core in preference to the API functions
	they overlay so that the code remains portable depending on the
	presence or absence of 64-bit support on the underlying platform.

	***POTENTIAL INCOMPATIBILITY***: Extracted from the TIP

	SUMMARY OF INCOMPATIBILITIES AND FIXES 
	======================================

	The behaviour of expressions containing constants that appear
	positive but which have a negative internal representation will
	change, as these will now usually be interpreted as wide
	integers. This is always fixable by replacing the constant with
	int(constant).

	Extensions creating new channel types will need to be altered as
	different types are now in use in those areas. The change to the
	declaration of Tcl_FSStat and Tcl_FSLstat (which are the new
	preferred API in any case) are less serious as no non-alpha
	releases have been made yet with those API functions.

	Scripts that are lax about the use of the l modifier in format and
	scan will probably need to be rewritten. This should be very
	uncommon though as previously it had absolutely no effect.

	Extensions that create new math functions that take more than one
	argument will need to be recompiled (the size of Tcl_Value
	changes), and functions that accept arguments of any type
	(TCL_EITHER) will need to be rewritten to handle wide integer
	values. (I do not expect this to affect many extensions at all.)

2002-02-14  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIOCmd.c (Tcl_GetsObjCmd): Trivial fix for bug
	  #517503, a memory leak reported by Miguel Sofer
	  <msofer@@users.sourceforge.net>. The leak happens if an error
	  occurs for "set var [gets $chan]" and leak one empty object.

2002-02-12  David Gravereaux <davygrvy@@pobox.com>

	* djgpp/ (new directory)
	* djgpp/Makefile (new):
	* unix/tclAppInit.c:
	* unix/tclMtherr.c:
	* unix/tclUnixFCmd.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixInit.c:
	* unix/tclUnixPort.h:  Early stage of DJGPP support for building
	Tcl on DOS.  Dynamic loading isn't working, yet.  Requires watt32
	for the TCP/IP stack.  No autoconf, yet.  Barely tested, but
	makes a working exe that runs Tcl in protected-mode, flat memory.
	[exec] and pipes will need the most work as multi-tasking on DOS
	has to be carefully.
d5299 1
a5299 1
2002-02-10  Kevin Kenny  <kennykb@@acm.org>
d5301 1
a5301 10
	* doc/CrtObjCmd.3:
	* doc/CrtTrace.3:
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclBasic.c:
	* generic/tclInt.h:
	* generic/tclTest.c:
	* tests/basic.test: Added Tcl_CreateObjTrace,
	Tcl_GetCommandInfoFromToken and Tcl_SetCommandInfoFromToken.
	(TIPs #32 and #79.)
d5303 1
a5303 4
	* generic/tclDecls.h:
	* generic/tclStubInit.c: Regenerated Stubs tables.
	
2002-02-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d5305 6
a5310 8
	* unix/configure:
	* unix/tcl.m4: added -pthread for FreeBSD to EXTRA_CFLAGS and
	LDFLAGS.  Also triggered nodots only for FreeBSD-3.
	Added AC_DEFINE(_POSIX_PTHREAD_SEMANTICS) for Solaris.

	* unix/tclUnixPort.h:
	* unix/tclUnixThrd.c: added thread-safe versions of readdir,
	localtime, gmtime and inet_ntoa for threaded build. (jgdavidson)
d5312 1
a5312 2
	* generic/tclScan.c (Tcl_ScanObjCmd): prevented ckfree being
	called on a pointer to NULL.
d5314 1
a5314 1
2002-02-07  Don Porter <dgp@@users.sourceforge.net>
d5316 1
a5316 30
	* doc/DString.3:
	* doc/Encoding.3:
	* doc/GetCwd.3:
	* doc/SplitPath.3:
	* doc/Translate.3:
	* doc/Utf.3:
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclEncoding.c:
	* generic/tclEnv.c:
	* generic/tclFileName.c:
	* generic/tclIOUtil.c:
	* generic/tclUtf.c:
	* generic/tclUtil.c:
	* mac/tclMacInit.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixInit.c:
	* unix/tclUnixPipe.c:
	* win/tclWin32Dll.c:
	* win/tclWinFCmd.c:
	* win/tclWinFile.c:
	* win/tclWinInit.c: Partial TIP 27 rollback.  Following routines
	restored to return (char *): Tcl_DStringAppend,
	Tcl_DStringAppendElement, Tcl_JoinPath, Tcl_TranslateFileName,
	Tcl_ExternalToUtfDString, Tcl_UtfToExternalDString,
	Tcl_UniCharToUtfDString, Tcl_GetCwd, Tcl_WinTCharToUtf.  Also
	restored Tcl_WinUtfToTChar to return (TCHAR *) and 
	Tcl_UtfToUniCharDString to return (Tcl_UniChar *).  Modified
	some callers.  This change recognizes that Tcl_DStrings are
	de-facto white-box objects.
d5318 2
a5319 2
	* generic/tclDecls.h:
	* generic/tclPlatDecls.h: make genstubs
d5321 1
a5321 1
	* generic/tclCmdMZ.c: corrected use of C++-style comment.
d5323 2
a5324 1
2002-02-06  Jeff Hobbs  <jeffh@@ActiveState.com>
d5326 1
a5326 14
	* tests/scan.test:
	* generic/tclScan.c (Tcl_ScanObjCmd): corrected scan 0x... %x
	handling that didn't accept the 0x as a prelude to a base 16
	number.  [Bug #495213]

	* generic/tclCompCmds.c (TclCompileRegexpCmd): made early check
	for bad RE to stop checking further.

	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): added special case to
	search for simple 'string map' style regsub calls.
	Delayed creation of resultPtr object until an initial match is
	made, as the input string object can then be reused for no matches.
	(Tcl_StringObjCmd): optimization improvements to the STR_MAP
	algorithm for zero-length and nocase cases.
d5328 3
a5330 2
	* tests/regexp.test:
	* tests/regexpComp.test: extra code coverage tests.
d5332 1
a5332 1
	* tests/string.test: added 10.18 and 10.19 extra tests.
d5334 1
a5334 1
	* generic/regc_locale.c (casecmp): slight performance improvement.
d5336 1
a5336 1
2002-02-05  Don Porter <dgp@@users.sourceforge.net>
d5338 4
a5341 3
	* library/http/http.tcl:
	* library/http/pkgIndex.tcl:  Corrected use of http::error when
	::error was intended.  Bump to http 2.4.2.
d5343 1
a5343 1
2002-02-04  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5345 2
a5346 6
	* unix/tclUnixChan.c (FileOutputProc): Fixed [bug 465765] reported
	  by Dale Talcott <daletalcott@@users.sourceforge.net>. Avoid
	  writing nothing into a file as STREAM based implementations will
	  consider this a EOF (if the file is a pipe). Not done in the
	  generic layer as this type of writing is actually useful to
	  check the state of a socket.
d5348 3
a5350 3
	* doc/open.n: Fixed [Bug 511540], added cross-reference to 'pid'
	  as the command to use to retrieve the pid of a command pipeline
	  created via 'open'.
d5352 1
a5352 1
2002-02-01  Jeff Hobbs  <jeffh@@ActiveState.com>
d5354 2
a5355 2
	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): handle quirky about case
	earlier to avoid shimmering problem.
d5357 1
a5357 1
2002-02-01  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5359 2
a5360 3
	* tests/io.test: io-39.22 split into two tests, one platform
	  dependent, the other not. -eofchar is not empty on the windows
	  platform.
d5362 1
a5362 1
2002-02-01  Vince Darley <vincentdarley@@users.sourceforge.net>
d5364 4
a5367 2
	* generic/tclTest.c: fix to picky windows compiler problem
	  with the 'MainLoop' function declaration.
d5369 1
a5369 1
2002-01-31  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5371 2
a5372 2
	* win/tclWinFCmd.c: TIP 27: Applied patch fixing CONST warnings on
	  behalf of Don Porter <dgp@@users.sourceforge.net>.
d5374 1
a5374 1
2002-01-30  Don Porter <dgp@@users.sourceforge.net>
d5376 1
a5376 41
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclInt.h: For each interface identified in the TIP 27
	  changes below as a POTENTIAL INCOMPATIBILITY, the source of the
	  incompatibility has been parameterized so that it can be
	  removed.  When compiling extension code against the Tcl header
	  files, use the compiler flag -DUSE_NON_CONST to remove the
	  irresolvable source incompatibilities introduced by the TIP 27
	  changes.  Resolvable changes are left for extension authors to
	  resolve.
	* generic/tclDecls.h: make genstubs

2002-01-30  Vince Darley <vincentdarley@@users.sourceforge.net>

	* doc/FileSystem.3: added documentation for 3 public
	functions which had been overlooked.  Fixes [Bug 507701].
	* unix/mkLinks: make mklinks

2002-01-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/regexpComp.test:
	* generic/tclCompCmds.c (TclCompileRegexpCmd): enhanced to support
	-nocase and -- options.

2002-01-28  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tcl.m4 (SC_LOAD_TCLCONFIG):
	* win/tcl.m4 (SC_LOAD_TCLCONFIG): Set TCL_LIB_SPEC,
	TCL_STUB_LIB_SPEC, and TCL_STUB_LIB_PATH to the
	values of TCL_BUILD_LIB_SPEC, TCL_BUILD_STUB_LIB_SPEC,
	and TCL_BUILD_STUB_LIB_PATH when tclConfig.sh is loaded
	from the build directory. A Tcl extension should
	make use of the non-build versions of these variables
	since they will work in both cases. This modification
	was described in TIP 34.

2002-01-28  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinReg.c (regConnectRegistryProc,RecursiveDeleteKey)
	(DeleteKey,GetKeyNames,GetType,GetValue,OpenSubKey,SetValue):
	redid the CONSTification as previous changes caused failing tests.
d5378 1
a5378 11
	* tests/regexpComp.test (new):
	* generic/tclInt.h:
	* generic/tclBasic.c: added TclCompileRegexpCmd entry
	* generic/tclCompCmds.c (TclCompileStringCmd): corrected to return
	TCL_OUT_LINE_COMPILE instead of TCL_ERROR for parsing errors, so
	it only throws the error for runtime compile, in case the user
	modifies 'string'.
	(TclCompileRegexpCmd): first try at a byte-compiled regexp
	command.  It handles static strings and ^$ bounded static strings.
	(TclCompileAppendCmd): made TclPushVarName call always use
	TCL_CREATE_VAR as numWords is always > 2 at that point.
d5380 2
a5381 2
	* generic/tclExecute.c (TclExecuteByteCode:INST_LIST): correct
	possibly dangerous decr in macro call.
d5383 1
a5383 1
	* win/tclWinInit.c (TclpFindVariable): CONSTification touch-up
d5385 1
a5385 2
	* win/tclWinReg.c (OpenSubKey): corrected bug introduced in
	CONSTification that dropped pointer reference.
d5387 1
a5387 3
	* ChangeLog.2000 (new file):
	* ChangeLog: broke changes from 2000 into ChangeLog.2000 to reduce
	  size of the main ChangeLog.
d5389 1
a5389 1
2002-01-28  David Gravereaux <davygrvy@@pobox.com>
d5391 1
a5391 3
	* generic/tclPlatDecls.h:  Added preprocessor logic to force a
	typedef of TCHAR when __STDC__ is defined when using the uncommon
	-Za compiler switch with the microsoft compiler.
d5393 1
a5393 1
2002-01-27  Don Porter <dgp@@users.sourceforge.net>
d5395 1
a5395 2
	* doc/package.n: Documented global namespace context for script
	evaluation by [package require].
d5397 1
a5397 1
2002-01-27  Daniel Steffen  <das@@users.sourceforge.net>
d5399 1
a5399 9
	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* mac/tclMacChan.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacInit.c:
	* mac/tclMacLoad.c:
	* mac/tclMacResource.c:
	* mac/tclMacSock.c: TIP 27 CONSTification induced changes
d5401 5
a5405 3
	* tests/event.test:
	* tests/main.test: added catches/constraints to test that
	use features that don't exist on the mac.
d5407 1
a5407 1
2002-01-25  Mo DeJong  <mdejong@@users.sourceforge.net>
d5409 2
a5410 127
	Make -eofchar and -translation options read only for
	server sockets. [Bug 496733]
	
	* generic/tclIO.c (Tcl_GetChannelOption, Tcl_SetChannelOption):
	Instead of returning nothing for the -translation option
	on a server socket, always return "auto". Return the empty
	string enclosed in quotes for the -eofchar option on
	a server socket. Fixup -eofchar usage message so that
	it matches the implementation.
	* tests/io.test: Add -eofchar tests and -translation tests
	to ensure options are read only on server sockets.
	* tests/socket.test: Update tests to account for -eofchar
	and -translation option changes.

2002-01-25  Don Porter <dgp@@users.sourceforge.net>

	* compat/strstr.c (strstr):
	* generic/tclCmdAH.c (Tcl_FormatObjCmd):
	* generic/tclCmdIL.c (InfoNameOfExecutableCmd):
	* generic/tclEnv.c (ReplaceString):
	* generic/tclFileName.c (ExtractWinRoot):
	* generic/tclIO.c (FlushChannel,Tcl_BadChannelOption):
	* generic/tclStringObj.c (AppendUnicodeToUtfRep):
	* generic/tclThreadTest.c (TclCreateThread):
	* generic/tclUtf.c (Tcl_UtfPrev):
	* mac/tclMacFCmd.c (TclpObjListVolumes):
	* mac/tclMacResource.c (TclMacRegisterResourceFork,
	  BuildResourceForkList):
	* win/tclWinInit.c (AppendEnvironment):  Sought out and eliminated
	instances of CONST-casting that are no longer needed after the
	TIP 27 effort.

	* Following is [Patch 501006]
	* generic/tclInt.decls (Tcl_AddInterpResolvers, Tcl_Export,
	  Tcl_FindNamespace, Tcl_GetInterpResolvers, Tcl_ForgetImport,
	  Tcl_Import, Tcl_RemoveInterpResolvers):
	* generic/tclNamesp.c (Tcl_Export, Tcl_Import, Tcl_ForgetImport,
	  Tcl_FindNamespace):
	* generic/tclResolve.c (Tcl_AddInterpResolvers,Tcl_GetInterpResolvers,
	  Tcl_RemoveInterpResolvers): Updated APIs in generic/tclResolve.c
	and generic/tclNamesp.c according to the guidelines of TIP 27.
	* generic/tclIntDecls.h: make genstubs

	* Following is [Patch 505630]
	* doc/AddErrorInfo.3:
	* generic/tcl.decls (Tcl_LogCommandInfo):
	* generic/tclBasic.c (Tcl_LogCommandInfo): Updated interfaces
	of generic/tclBasic.cc according to TIP 27.
	* generic/tclDecls.h: make genstubs

	* Following is [Patch 506818]
	* doc/Hash.3:
	* generic/tcl.decls (Tcl_HashStats):
	* generic/tclHash.c (Tcl_HashStats):  Updated APIs of generic/tclHash.c
	according to guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs
	* generic/tclVar.c (Tcl_ArrayObjCmd): Updated callers.

	* Following is [Patch 506807]
	* doc/ObjectType.3:
	* generic/tcl.decls (Tcl_GetObjType):
	* generic/tclObj.c (Tcl_GetObjType): Updated APIs of generic/tclObj.c
	according to guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs

	* Following is [Patch 507304]
	* doc/Encoding.3:
	* generic/tcl.decls (Tcl_WinUtfToTChar,Tcl_WinTCharToUtf):
	* win/tclWin32Dll.c (Tcl_WinUtfToTChar,Tcl_WinTCharToUtf):
	Updated interfaces in win/tclWin32Dll.c according to TIP 27.
	* generic/tclPlatDecls.h: make genstubs
	* generic/tclIOUtil.c (TclpNativeToNormalized):
	* win/tclWinFCmd.c (TclpObjNormalizePath):
	* win/tclWinFile.c (TclpFindExecutable,TclpMatchInDirectory,
	  NativeIsExec,NativeStat):
	* win/tclWinLoad.c (TclpLoadFile):
	* win/tclWinPipe.c (TclpOpenFile,ApplicationType):
	* win/tclWinReg.c (regConnectRegistryProc,RecursiveDeleteKey,DeleteKey,
	  GetKeyNames,GetType,GetValue,OpenSubKey,SetValue):
	* win/tclWinSerial.c (SerialSetOptionProc): Update callers.

	* Following is [Patch 505072]
	* doc/Concat.3:
	* doc/Encoding.3:
	* doc/Filesystem.3:
	* doc/Macintosh.3:
	* doc/OpenFileChnl.3
	* doc/SetResult.3:
	* doc/SetVar.3:
	* doc/SplitList.3:
	* doc/SplitPath.3:
	* doc/Translate.3:
	* generic/tcl.h (Tcl_FSMatchInDirectoryProc):
	* generic/tclInt.h (TclpMatchInDirectory):
	* generic/tcl.decls (Tcl_Concat,Tcl_GetStringResult,Tcl_GetVar,
	  Tcl_GetVar2,Tcl_JoinPath,Tcl_Merge,Tcl_OpenCommandChannel,Tcl_SetVar,
	  Tcl_SetVar2,Tcl_SplitList,Tcl_SplitPath,Tcl_TranslateFileName,
	  Tcl_ExternalToUtfDString,Tcl_GetEncodingName,Tcl_UtfToExternalDString,
	  Tcl_GetDefaultEncodingDir,Tcl_SetDefaultEncodingDir,
	  Tcl_FSMatchInDirectory,Tcl_MacEvalResource,Tcl_MacFindResource):
	* generic/tclInt.decls (TclCreatePipeline,TclGetEnv,TclpGetCwd,
	  TclpCreateProcess):
	* mac/tclMacFile.c (TclpGetCwd):
	* generic/tclEncoding.c (Tcl_GetDefaultEncodingDir,
	  Tcl_SetDefaultEncodingDir,Tcl_GetEncodingName,
	  Tcl_ExternalToUtfDString,Tcl_UtfToExternalDString, OpenEncodingFile,
	  LoadEscapeEncoding):
	* generic/tclFileName.c (DoTildeSubst,Tcl_JoinPath,Tcl_SplitPath,
	  Tcl_TranslateFileName): 
	* generic/tclIOUtil.c (Tcl_FSMatchInDirectory):
	* generic/tclPipe.c (FileForRedirect,TclCreatePipeline,
	  Tcl_OpenCommandChannel):
	* generic/tclResult.c (Tcl_GetStringResult):
	* generic/tclUtil.c (Tcl_Concat,Tcl_SplitList,Tcl_Merge):
	* generic/tclVar.c (Tcl_GetVar,Tcl_GetVar2,Tcl_SetVar,Tcl_SetVar2):
	* mac/tclMacResource.c (Tcl_MacEvalResource,Tcl_MacFindResource):
	Updated interfaces of generic/tclEncoding, generic/tclFilename.c,
	generic/tclIOUtil.c, generic/tclPipe.c, generic/tclResult.c,
	generic/tclUtil.c, generic/tclVar.c and mac/tclMacResource.c according
	to TIP 27.  Tcl_TranslateFileName rewritten as wrapper around
	VFS-aware version.
	***POTENTIAL INCOMPATIBILITY*** 
	Includes source incompatibilities: argv arguments of Tcl_Concat,
	Tcl_JoinPath, Tcl_OpenCommandChannel, Tcl_Merge; argvPtr arguments of
	Tcl_SplitList and Tcl_SplitPath.
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs
d5412 1
a5412 52
	* generic/tclCkalloc.c (MemoryCmd):
	* generic/tclClock.c (FormatClock):
	* generic/tclCmdAH.c (Tcl_CaseObjCmd,Tcl_EncodingObjCmd,Tcl_FileObjCmd):
	* generic/tclCmdIL.c (InfoLibraryCmd,InfoPatchLevelCmd,
	  InfoTclVersionCmd):
	* generic/tclCompCmds.c (TclCompileForeachCmd):
	* generic/tclCompCmds.h (TclCompileForeachCmd):
	* generic/tclCompile.c (TclFindCompiledLocal):
	* generic/tclEnv.c (TclSetupEnv,TclSetEnv,Tcl_PutEnv,TclGetEnv,
	  EnvTraceProc):
	* generic/tclEvent.c (Tcl_BackgroundError):
	* generic/tclIO.c (Tcl_BadChannelOption,Tcl_SetChannelOption):
	* generic/tclIOCmd.c (Tcl_ExecObjCmd,Tcl_OpenObjCmd):
	* generic/tclIOSock.c (TclSockGetPort):
	* generic/tclIOUtil.c (SetFsPathFromAny):
	* generic/tclLink.c (LinkTraceProc):
	* generic/tclMain.c (Tcl_Main):
	* generic/tclNamesp.c (TclTeardownNamespace):
	* generic/tclProc.c (TclCreateProc):
	* generic/tclTest.c (TestregexpObjCmd,TesttranslatefilenameCmd,
	  TestchmodCmd,GetTimesCmd,TestsetCmd,TestOpenFileChannelProc1,
	  TestOpenFileChannelProc2,TestOpenFileChannelProc3,AsyncHandlerProc,
	  TestpanicCmd):
	* generic/tclThreadTest.c (ThreadErrorProc,ThreadEventProc):
	* generic/tclUtil.c (TclPrecTraceProc):
	* mac/tclMacFCmd.c (GetFileSpecs):
	* mac/tclMacFile.c (TclpMatchInDirectory):
	* mac/tclMacInit.c (TclpInitLibraryPath,Tcl_SourceRCFile):
	* mac/tclMacOSA.c (tclOSAStore,tclOSALoad):
	* mac/tclMacResource.c (Tcl_MacEvalResource):
	* unix/tclUnixFCmd.c (TclpObjNormalizePath):
	* unix/tclUnixFile.c (TclpMatchInDirectory,TclpGetUserHome,TclpGetCwd,
	  TclpReadLink):
	* unix/tclUnixInit.c (TclpInitLibraryPath,TclpSetVariables,
	  Tcl_SourceRCFile):
	* unix/tclUnixPipe.c (TclpOpenFile,TclpCreateTempFile,
	  TclpCreateProcess):
	* win/tclWinFile.c (TclpGetCwd,TclpMatchInDirectory):
	* win/tclWinInit.c (TclpInitLibraryPath,Tcl_SourceRCFile,
	  TclpSetVariables):
	* win/tclWinPipe.c (TclpCreateProcess): Updated callers.

2002-01-24  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclIOUtil.c (SetFsPathFromAny):  Corrected tilde-substitution
	of pathnames where > 1 separator follows the ~.  [Bug 504950]

2002-01-24  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/http/pkgIndex.tcl:
	* library/http/http.tcl: don't add port in default case to handle
	broken servers.  http bumped to 2.4.1  [Bug #504508]
d5414 1
a5414 1
2002-01-23  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5416 4
a5419 16
	* unix/mkLinks: Regenerated.
	* doc/CrtChannel.3:
	* doc/ChnlStack.3: Moved documentation for 'Tcl_GetTopChannel'
	  from 'CrtChannel' to 'ChnlStack'. Added documentation of
	  'Tcl_GetStackedChannel'. Bug #506147 reported by Mark Patton
	  <msp@@users.sourceforge.net>.

2002-01-23  Don Porter <dgp@@users.sourceforge.net>

	* win/tclWinFile.c (NativeAccess,NativeStat,NativeIsExec,
	  TclpGetUserHome):
	* win/tclWinPort.h (TclWinSerialReopen):
	* win/tclWinSerial.c (TclWinSerialReopen):
	* win/tclWinSock.c (Tcl_OpenTcpServer):  Corrections to earlier
	TIP 27 changes.  Thanks to Andreas Kupries for the feedback.
	* generic/tclPlatDecls.h: make genstubs
d5421 1
a5421 48
	* doc/GetHostName.3:
	* doc/GetOpnFl.3:
	* doc/OpenTcp.3:
	* tcl.decls (Tcl_GetHostName,Tcl_GetOpenFile,Tcl_OpenTcpClient,
	  Tcl_OpenTclServer):
	* mac/tclMacSock.c (CreateSocket,Tcl_OpenTcpClient,Tcl_OpenTcpServer,
	  Tcl_GetHostName,GetHostFromString):
	* unix/tclUnixChan.c (CreateSocket,CreateSocketAddress,
	  Tcl_OpenTcpClient,Tcl_OpenTcpServer,Tcl_GetOpenFile):
	* unix/tclUnixSock.c (Tcl_GetHostName):
	* win/tclWinSock.c (CreateSocket,CreateSocketAddress,
	  Tcl_OpenTcpClient,Tcl_OpenTcpServer,Tcl_GetHostName):
	Updated socket interfaces according to TIP 27.
	* generic/tclCmdIL.c (InfoHostnameCmd): Updated callers.
	* generic/tclDecls.h: make genstubs

2002-01-21  David Gravereaux <davygrvy@@pobox.com>

	* generic/tclLoadNone.c: TclpLoadFile() didn't match proto of
	  typedef Tcl_FSLoadFileProc.  OK'd by vincentdarley.
	  [Patch #502488]

2002-01-21  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIO.c (WriteChars): Fix for SF #506297, reported by
	  Martin Forssen <ruric@@users.sourceforge.net>. The encoding
	  chosen in the script exposing the bug writes out three intro
	  characters when TCL_ENCODING_START is set, but does not consume
	  any input as TCL_ENCODING_END is cleared. As some output was
	  generated the enclosing loop calls UtfToExternal again, again
	  with START set. Three more characters in the out and still no
	  use of input ... To break this infinite loop we remove
	  TCL_ENCODING_START from the set of flags after the first call
	  (no condition is required, the later calls remove an unset flag,
	  which is a no-op). This causes the subsequent calls to
	  UtfToExternal to consume and convert the actual input.

2002-01-21  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclTest.c: Converted declarations of TestReport file system
	  to more portable form.  [Bug 501417].

	* generic/tcl.decls (Tcl_TraceCommand,Tcl_UntraceCommand,
	  Tcl_CommandTraceInfo):
	* generic/tclCmdMZ.c (Tcl_TraceCommand,Tcl_UntraceCommand,
	  Tcl_CommandTraceInfo): Updated APIs in generic/tclCmdMZ.c 
	  according to the guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs
d5423 1
a5423 1
2002-01-18  Don Porter <dgp@@users.sourceforge.net>
d5425 1
a5425 3
	* win/tclWinChan.c:
	* win/tclWinFCmd.c:
	* win/tclWinFile.c: Overlooked callers of Tcl_FSGetNativePath
d5427 1
a5427 2
	* win/tclWinDde.c:
	* win/tclWinReg.c: Overlooked callers of Tcl_GetIndexFromObj
d5429 1
a5429 1
2002-01-18  Daniel Steffen  <das@@users.sourceforge.net>
d5431 3
a5433 31
	* generic/tclThreadTest.c:
	* mac/tclMacChan.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacLoad.c:
	* mac/tclMacResource.c: TIP 27 CONSTification broke the mac
	  build in a number of places.

2002-01-17  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIOCmd.c (Tcl_GetsObjCmd): Fixed bug #504642 as
	  reported by Brian Griffin <bgriffin@@users.sourceforge.net>,
	  using his patch. Before the patch the generic I/O layer held an
	  unannounced reference to the interp result to store the read
	  line into. This unfortunately has disastrous results if the
	  channel driver executes a tcl script to perform its operation,
	  this freeing the interp result. In that case we are
	  dereferencing essentially a dangling reference. It is not truly
	  dangling because the object is in the free list, but this only
	  causes us to smash the free list and have the error occur later
	  somewhere else. The patch simply creates a new object for the
	  line and later sets it into the interp result when we are done
	  with reading.

2002-01-16  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tcl.m4 (SC_LOAD_TCLCONFIG):
	* win/tcl.m4 (SC_LOAD_TCLCONFIG): Subst TCL_DBGX
	into TCL_STUB_LIB_FILE and TCL_STUB_LIB_FLAG
	variables so that an extension does not need
	to subst TCL_DBGX into its makefile. [Tk Bug 504356]
d5435 1
a5435 1
2002-01-16  Don Porter <dgp@@users.sourceforge.net>
d5437 7
a5443 47
	* doc/FileSystem.3:
	* doc/GetCwd.3:
	* doc/GetIndex.3:
	* generic/tcl.decls (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_GetCwd, Tcl_FSFileAttrStrings, Tcl_FSGetNativePath,
	  Tcl_FSGetTranslatedStringPath):
	* generic/tcl.h (Tcl_FSFileAttrStringsProc):
	* generic/tclFCmd.c (TclFileAttrsCmd):
	* generic/tclIOUtil.c (Tcl_GetCwd,NativeFileAttrStrings,
	  Tcl_FSFileAttrStrings,Tcl_FSGetTranslatedStringPath,
	  Tcl_FSGetNativePath):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObj,Tcl_GetIndexFromObjStruct):
	More TIP 27 updates in tclIOUtil.c and tclIndexObj.c that were
	overlooked before.  [Patch 504671]
	***POTENTIAL INCOMPATIBILITY*** 
	Includes a source incompatibility in the tablePtr arguments of
	the Tcl_GetIndexFromObj* routines.
	* generic/tclDecls.h: make genstubs

	* generic/tclBinary.c (Tcl_BinaryObjCmd):
	* generic/tclClock.c (Tcl_ClockObjCmd):
	* generic/tclCmdAH.c (Tcl_EncodingObjCmd, Tcl_FileObjCmd):
	* generic/tclCmdIL.c (Tcl_InfoObjCmd,Tcl_LsearchObjCmd,Tcl_LsortObjCmd):
	* generic/tclCmdMZ.c (Tcl_TraceObjCmd,Tcl_RegexpObjCmd,Tcl_RegsubObjCmd,
	  Tcl_StringObjCmd,Tcl_SubstObjCmd,Tcl_SwitchObjCmd,
	  TclTraceCommandObjCmd,TclTraceVariableObjCmd):
	* generic/tclCompCmds.c (TclCompileStringCmd):
	* generic/tclEvent.c (Tcl_UpdateObjCmd):
	* generic/tclFileName.c (Tcl_GlobObjCmd):
	* generic/tclIO.c (Tcl_FileEventObjCmd):
	* generic/tclIOCmd.c (Tcl_SeekObjCmd,Tcl_ExecObjCmd,Tcl_SocketObjCmd,
	  Tcl_FcopyObjCmd):
	* generic/tclInterp.c (Tcl_InterpObjCmd,SlaveObjCmd):
	* generic/tclNamesp.c (Tcl_NamespaceObjCmd):
	* generic/tclPkg.c (Tcl_PackageObjCmd):
	* generic/tclTest.c (Tcltest_Init,TestencodingObjCmd,TestgetplatformCmd,
	  TestlocaleCmd,TestregexpObjCmd,TestsaveresultCmd,
	  TestGetIndexFromObjStructObjCmd,TestReportFileAttrStrings):
	* generic/tclTestObj.c (TestindexObjCmd,TeststringObjCmd):
	* generic/tclTimer.c (Tcl_AfterObjCmd):
	* generic/tclVar.c (Tcl_ArrayObjCmd):
	* mac/tclMacFCmd.c (SetFileFinderAttributes):
	* unix/tclUnixChan.c (TclpOpenFileChannel):
	* unix/tclUnixFCmd.c (tclpFileAttrStrings):
	* unix/tclUnixFile.c (TclpObjAccess,TclpObjChdir,TclpObjStat,
	  TclpObjLstat):
	* win/tclWinFCmd.c (tclpFileAttrStrings): Updated callers.
d5445 1
a5445 15
	* doc/RegExp.3:
	* doc/Utf.3:
	* generic/tcl.decls:
	* generic/tclInt.decls:
	* generic/tclRegexp.c:
	* generic/tclUtf.c:  Updated APIs in generic/tclUtf.c and
	generic/tclRegexp.c according to the guidelines of TIP 27.
	[Patch 471509]

	* generic/regc_locale.c (element,cclass):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd):
	* generic/tclFileName.c (TclpGetNativePathType,SplitMacPath):
	* generic/tclIO.c (ReadChars):
	* mac/tclMacLoad.c (TclpLoadFile):
	* win/tclWinFile.c (TclpGetUserHome): Updated callers.
d5447 3
a5449 2
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs
d5451 1
a5451 60
	* doc/ParseCmd.3 (Tcl_ParseVar):
	* generic/tcl.decls (Tcl_ParseVar):
	* generic/tclParse.c (Tcl_ParseVar):
	* generic/tclTest.c (TestparsevarObjCmd): Updated APIs in
	generic/tclParse.c according to the guidelines of TIP 27.  Updated
	callers.  [Patch 501046]
	* generic/tclDecls.h: make genstubs

	* generic/tcl.decls (Tcl_RecordAndEval):
	* generic/tclDecls.h: make genstubs
	* generic/tclHistory.c (Tcl_RecordAndEval): Updated APIs in
	generic/tclHistory.c according to the guidelines of TIP 27.
	[Patch 504091]

	* doc/CrtSlave.3:
	* generic/tcl.decls (Tcl_CreateAlias, Tcl_CreateAliasObj,
	  Tcl_CreateSlave, Tcl_GetAlias, Tcl_GetAliasObj, Tcl_GetSlave):
	* generic/tclInterp.c (Tcl_CreateAlias, Tcl_CreateAliasObj,
	  Tcl_CreateSlave, Tcl_GetAlias, Tcl_GetAliasObj, Tcl_GetSlave):
	Updated APIs in the file generic/tclInterp.c according to the
	guidelines of TIP 27.  [Patch 501371]
	***POTENTIAL INCOMPATIBILITY*** 
	Includes a source incompatibility in the targetCmdPtr arguments of
	the Tcl_GetAlias* routines.

	* generic/tclDecls.h: make genstubs

2002-01-15  Don Porter <dgp@@users.sourceforge.net>

	* doc/SetErrno.3 (Tcl_ErrnoMsg): Corrected documentation for
	Tcl_ErrnoMsg; it takes an integer argument.  Thanks to Georgios
	Petasis.  [Bug 468183]

	* doc/AddErrInfo.3 (Tcl_PosixError):
	* doc/Eval.3 (Tcl_EvalFile):
	* doc/FileSystem.c (Tcl_FSOpenFileChannel,Tcl_FSOpenFileChannelProc):
	* doc/OpenFileChnl.3 (Tcl_OpenFileChannel):
	* doc/SetErrno.3 (Tcl_ErrnoId,Tcl_ErrnoMsg):
	* doc/Signal.3 (Tcl_SignalId,Tcl_SignalMsg):
	* generic/tcl.decls (Tcl_ErrnoId,TclErrnoMsg,Tcl_EvalFile,
	  Tcl_OpenFileChannel,Tcl_PosixError,Tcl_SignalId,Tcl_SignalMsg,
	  Tcl_FSOpenFileChannel):
	* generic/tcl.h (Tcl_FSOpenFileChannelProc):
	* generic/tclIO.c (FlushChannel):
	* generic/tclIOUtil.c (Tcl_OpenFileChannel,Tcl_EvalFile,TclGetOpenMode,
	  Tcl_PosixError,Tcl_FSOpenFileChannel):
	* generic/tclInt.decls (TclGetOpenMode):
	* generic/tclInt.h (TclOpenFileChannelProc_,TclGetOpenMode,
	  TclpOpenFileChannel):
	* generic/tclPipe.c (TclCleanupChildren):
	* generic/tclPosixStr.c (Tcl_ErrnoId,Tcl_ErrnoMsg,Tcl_SignalId,
	  Tcl_SignalMsg):
	* generic.tclTest.c (PretendTclpOpenFileChannel,
	  TestOpenFileChannelProc1,TestOpenFileChannelProc2,
	  TestOpenFileChannelProc3,TestReportOpenFileChannel):
	* mac/tclMacChan.c (TclpOpenFileChannel):
	* unix/tclUnixChan.c (TclpOpenFileChannel):
	* win/tclWinChan.c (TclpOpenFileChannel): Updated APIs in
	  generic/tclIOUtil.c and generic/tclPosixStr.c according to the
	  guidelines of TIP 27.  Updated callers.  [Patch 499196]
d5453 2
a5454 2
	* generic/tclDecls.h:
	* generic/tclIntDecls.h: make genstubs
d5456 1
a5456 30
	* doc/CrtChannel.3:
	* doc/OpenFileChnl.3:
	* generic/tcl.decls:
	* generic/tclIO.h:
	* generic/tclIO.c (DoWrite, Tcl_RegisterChannel, Tcl_GetChannel,
	  Tcl_CreateChannel, Tcl_GetChannelName, CloseChannel, Tcl_Write,
	  Tcl_WriteRaw, Tcl_Ungets, Tcl_BadChannelOption, Tcl_GetChannelOption,
	  Tcl_SetChannelOption, Tcl_GetChannelNamesEx, Tcl_ChannelName):
	Updated APIs in the file generic/tclIO.c according to the guidelines
	of TIP 27.  Several minor documentation corrections as well.
	[Patch 503565]
	* generic/tclDecls.h: make genstubs

	* generic/tcl.h (Tcl_DriverOutputProc, Tcl_DriverGetOptionProc,
	  Tcl_DriverSetOptionProc):
	* generic/tclIOGT.c (TransformOutputProc, TransformGetOptionProc,
	  TransformSetOptionProc):
	* mac/tclMacChan.c (FileOutput, StdIOOutput):
	* man/tclMacSock.c (TcpGetOptionProc, TcpOutput):
	* unix/tclUnixChan.c (FileOutputProc, TcpGetOptionProc, TcpOutputProc,
	  TtyGetOptionProc, TtySetOptionProc):
	* unix/tclUnixPipe.c (PipeOuputProc):
	* win/tclWinChan.c (FileOutputProc):
	* win/tclWinConsole.c (ConsleOutputProc):
	* win/tclWinPipe.c (PipeOuputProc):
	* win/tclWinSerial.c (SerialOutputProc, SerialGetOptionProc,
	  SerialSetOptionProc):
	* win/tclWinSock.c (TcpGetOptionProc, TcpOutput): Updated channel
	driver interface according to the guidelines of TIP 27.  See also
	[Bug 500348].
d5458 3
a5460 9
	* doc/CrtChannel.3:
	* generic/tcl.h:
	* generic/tclIO.c:
	* generic/tclIO.h:
	* generic/tclInt.h:
	* tools/checkLibraryDoc.tcl:
	Moved Tcl_EolTranslation enum declaration from generic/tcl.h to
	generic/tclInt.h (renamed to TclEolTranslation).  It is not used
	anywhere in Tcl's public interface.
d5462 1
a5462 1
2002-01-14  Don Porter <dgp@@users.sourceforge.net>
d5464 1
a5464 8
	* doc/GetIndex.3:
	* doc/WrongNumArgs.3:
	* generic/tcl.decls (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_WrongNumArgs):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_WrongNumArgs):  Updated APIs in the file generic/tclIndexObj.c
	according to the guidelines of TIP 27.  [Patch 501491]
	* generic/tclDecls.h: make genstubs
d5466 1
a5466 1
2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d5468 2
a5469 5
	* unix/configure: Regen.
	* unix/configure.in:
	* win/configure: Regen.
	* win/configure.in: Use ${libdir} instead of ${exec_prefix}/lib
	to properly support the --libdir option to configure. [Bug 489370]
d5471 1
a5471 1
2002-01-11  Andreas Kupries  <andreas_kupries@@users.sourceforge.net> 
d5473 1
a5473 105
	* win/tclWinSerial.c (SerialSetOptionProc): Applied patch for SF
	  bug #500348 supplied by Rolf Schroedter
	  <schroedter@@users.sourceforge.net>. The function modified the
	  contents of the the 'value' string and now does not do this
	  anymore. This is a followup to the change made on 2001-12-17.

2002-01-11  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.vc: Removed -GD compiler option.  It was intended
	for future use, but MS is again changing the future at their whim.
	The D4002 warning was harmless though, but someone using VC .NET
	logged it as a concern.  [Bug #501565]

2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Burn Tcl build directory
	into tcltest executable to avoid crashes caused
	by ld loading a previously installed version
	of the tcl shared library. [Bug 218110]

2002-01-10  Don Porter <dgp@@users.sourceforge.net>,
	Kevin Kenny <kennykb@@users.sourceforge.net>
	
	* unix/tclLoadDld.c (TclpLoadFile):  syntax error: unbalanced
	parens.  Kevin notes that it's far from clear that this file is
	ever included in an actual build; Linux without dlopen appears to
	be a nonexistent configuration.
	
2002-01-08  Don Porter <dgp@@users.sourceforge.net>,
	Kevin Kenny <kennykb@@users.sourceforge.net>

	* doc/StaticPkg.3 (Tcl_StaticPackage):
	* generic/tcl.decls (Tcl_StaticPackage):
	* generic/tclDecls.h (Tcl_StaticPackage):
	* generic/tclInt.decls (TclGuessPackageName):
	* generic/tclInt.h (TclGuessPackageName):
	* generic/tclLoad.c (Tcl_StaticPackage):
	* generic/tclLoadNone.c (TclGuessPackageName):
	* mac/tclMacLoad.c (TclGuessPackageName):
	* unix/tclLoadAout.c (TclGuessPackageName):
	* unix/tclLoadDl.c (TclGuessPackageName):
	* unix/tclLoadDld.c (TclGuessPackageName):
	* unix/tclLoadDyld.c (TclGuessPackageName):
	* unix/tclLoadNext.c (TclGuessPackageName):
	* unix/tclLoadOSF.c (TclGuessPackageName):
	* unix/tclLoadShl.c (TclGuessPackageName):
	* win/tclWinLoad.c (TclGuessPackageName):  Updated APIs in 
	the files */tcl*Load*.c according to the guidelines of TIP 27.
	[Patch 501096]

2002-01-09  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclTest.c (MainLoop):
	* tests/main.test (Tcl_Main-1.{3,4,5,6}):  Corrected some non-portable
	tests from the new Tcl_Main changes.  Thanks to Kevin Kenny.

2002-01-07  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclEvent.c (TclInExit):
	* generic/tclIOUtil.c (SetFsPathFromAbsoluteNormalized,
	  SetFsPathFromAny,Tcl_FSNewNativePath,DupFsPathInternalRep):
	* generic/tclListObj.c (TclLsetList,TclLsetFlat):  Added some type
	casts to satisfy picky compilers.

	* generic/tclMain.c:  Bug fix: neglected the NULL case in
	TclGetStartupScriptFileName().  Broke Tk/wish.

2002-01-05  Don Porter <dgp@@users.sourceforge.net>

	* doc/Tcl_Main.3:
	* generic/tclMain.c:  Substantial rewrite and expanded documentation
	of Tcl_Main to correct a number of bugs and flaws:

		* Interactive Tcl_Main can now enter a main loop, exit
		  that loop and continue interactive operations.  The loop
		  may even exit in the midst of interactive command typing
		  without loss of the partial command.  [Bugs 486453, 474131]
		* Tcl_Main now gracefully handles deletion of its master
		  interpreter.
		* Interactive Tcl_Main can now operate with non-blocking stdin
		* Interactive Tcl_Main can now detect EOF on stdin even in
		  mid-command.  [Bug 491341]
		* Added VFS-aware internal routines for managing the
		  startup script selection.
		* Tcl variable 'tcl_interactive' is now linked to C variable
		  'tty' so that one can disable/enable interactive prompts
		  at the script level when there is no startup script.  This
		  is meant for use by the test suite.
		* Consistent use of the Tcl libraries standard channels as
		  returned by Tcl_GetStdChannel(); as opposed to the channels
		  named 'stdin', 'stdout', and 'stderr' in the master interp,
		  which can be different or unavailable.
		* Tcl_Main now calls Tcl_Exit() if evaluation of [exit] in the
		  master interpreter returns, assuring Tcl_Main does not return.
		* Documented Tcl_Main's absence from public stub table
		* Documented that Tcl_Main does not return.
		* Documented Tcl variables set by Tcl_Main.
		* All prompts are done from a single procedure, Prompt.
		* Use of Tcl_Obj-enabled interfaces everywhere.

	* generic/tclInt.decls (TclGetStartupScriptPath,
	  TclSetStartupScriptPath): New internal VFS-aware routines for
	managing the startup script of Tcl_Main.
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c: make genstubs
d5475 1
a5475 5
	* generic/tclTest.c (TestsetmainloopCmd,TestexitmainloopCmd,
	  Tcltest_Init,TestinterpdeleteCmd):
	* tests/main.test (new):  Added new file to test suite that
	thoroughly tests generic/tclMain.c; added some new test commands
	for testing Tcl_SetMainLoop().
a5476 1
2002-01-04  Don Porter <dgp@@users.sourceforge.net>
a5477 62
	* doc/Alloc.3:
	* doc/Concat.3:
	* doc/CrtMathFnc.3:
	* doc/Hash.3:
	* doc/Interp.3:
	* doc/LinkVar.3:
	* doc/ObjectType.3:
	* doc/PkgRequire.3:
	* doc/Preserve.3:
	* doc/SetResult.3:
	* doc/SplitList.3:
	* doc/SplitPath.3:
	* doc/TCL_MEM_DEBUG.3: Updated documentation to describe the ckalloc,
	ckfree, ckrealloc, attemptckalloc, and attemptckrealloc macros, and
	to accurately describe when and how they are used.  [Bug 497459]

	* generic/tclThreadJoin.c (TclRememberJoinableThread,TclJoinThread):
	Replaced Tcl_Alloc and Tcl_Free calls with ckalloc and ckfree so that
	memory debugging is supported.

2002-01-04  Daniel Steffen <das@@users.sourceforge.net>

	* mac/tclMacTime.c (TclpGetTZName): fix for daylight savings TZName bug

2002-01-03  Don Porter <dgp@@users.sourceforge.net>

	* doc/FileSystem.3:
	* generic/tclIOUtil.c: Updated some old uses of "fileName" to
	new VFS terminology, "pathPtr".

2002-01-03  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/basic.test (basic-39.4): Greatly simplified test while
	still leaving it so that it crashes when run without the fix to
	the [foreach] implementation.
	* generic/tclCmdAH.c (Tcl_ForeachObjCmd): Stopped Bug #494348 from
	happening by not trying to be so clever with cacheing; if nothing
	untoward is happening anyway, the less efficient technique will
	only add a few instruction cycles (one function call and a few
	derefs/assigns per list per iteration, with no change in the
	number of tests) and if something odd *is* going on, the code is
	now far more robust.

	* tests/basic.test (basic-39.4): Reproducable script from Bug #494348

2002-01-02  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/util.test (Wrapper_Tcl_StringMatch,util-5.*): Rewrote so
	the test is performed with the right internal function since
	[string match] no longer uses Tcl_StringCaseMatch internally.

	* tests/string.test (string-11.51):
	* generic/tclUtf.c (Tcl_UniCharCaseMatch):
	* generic/tclUtil.c (Tcl_StringCaseMatch): Fault with matching
	case-insensitive non-ASCII patterns containing upper case
	characters.  [Bug #233257]

	******************************************************************
	*** CHANGELOG ENTRIES FOR 2001 IN "ChangeLog.2001"             ***
	*** CHANGELOG ENTRIES FOR 2000 IN "ChangeLog.2000"             ***
	*** CHANGELOG ENTRIES FOR 1999 AND EARLIER IN "ChangeLog.1999" ***
	******************************************************************
@


1.24
log
@        From Mo Dejong  <supermo@@bayarea.net>:
        * win/tclWin32Dll.c (DllMain): Remove unused os
        variable since VC++ treats warnings as errors
        when compiling with symbols.

        * win/tclWinPort.h: Remove undefine of PASCAL
        symbol added on 2001-09-12. It caused
        crashing problems with sockets.
@
text
@@


1.24.2.1
log
@Merge with mainline; merge tag carlton_dictionary-20021011-merge.
@
text
@a0 5
2002-10-05  Christopher Faylor  <cgf@@redhat.com>

	* win/tclWin32Dll.c (tclWinTCharEncoding): Remove 'static' since it is
	declared in header as exportable extern.

@


1.24.2.2
log
@2002-12-23  David Carlton  <carlton@@math.stanford.edu>

	* Merge from mainline; tag is carlton_dictionary-20021223-merge.
@
text
@a0 10
2002-12-19  Christopher Faylor  <cgf@@redhat.com>

	* win/tclWinInit.c (TclpInitLibraryPath): Default to correct location
	for installLib on cygwin.

2002-12-19  Christopher Faylor  <cgf@@redhat.com>

	* cygwin/configure.in: Set TCL_BUILD_LIB_SPEC.
	* cygwin/configure: Regenerate.

@


1.24.2.3
log
@2003-02-07  David Carlton  <carlton@@math.stanford.edu>

	* Merge with mainline; tag is carlton_dictionary-20030207-merge.
@
text
@d1 1
a1 1
2002-10-22  Jeff Hobbs  <jeffh@@ActiveState.com>
d3 2
a4 1
	*** 8.4.1 TAGGED FOR RELEASE ***
d6 1
a6 1
	* changes: updated for 8.4.1 release
d8 2
a9 5
	* win/Makefile.in: removed @@MEM_DEBUG_FLAGS@@ subst.
	* win/configure: regen
	* win/configure.in: removed SC_ENABLE_MEMDEBUG call
	* win/tcl.m4: replaced SC_ENABLE_MEMDEBUG with a more intelligent
	SC_ENABLE_SYMBOLS that takes yes|no|mem|compile|all as options now.
d11 1
a11 1
2002-10-22  Daniel Steffen  <das@@users.sourceforge.net>
d13 2
a14 10
	* library/auto.tcl (tcl_findLibrary):
	* library/package.tcl (tclPkgUnknown): on macosx, search inside the
	Resources/Scripts subdirectory of any potential package directory
	* macosx/Tcl.pbproj/project.pbxproj: add standard Frameworks dirs
	to TCL_PACKAGE_PATH make argument.
	* unix/tclUnixInit.c (TclpSetVariables): on macosx, add embedded
	framework dirs to tcl_pkgPath: @@executable_path/../Frameworks and
	@@executable_path/../PrivateFrameworks (if they exist), as well as
	the dirs in DYLD_FRAMEWORK_PATH (if set). [Patch #624509]
	use standard MAXPATHLEN instead of literal 1024
d16 1
a16 1
2002-10-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d18 4
a21 3
	* doc/StringObj.3, doc/Object.3: Documented that Tcl_Obj's
	standard string form is a modified UTF-8; apparently, this was not
	mentioned anywhere in the main docs, and lead to [Bug 624919].
d23 3
a25 1
2002-10-21  Daniel Steffen  <das@@users.sourceforge.net>
d27 1
a27 3
	* macosx/Tcl.pbproj/project.pbxproj: bumped version to 8.4.1
	* generic/tcl.h: Added reminder comment to edit
	macosx/Tcl.pbproj/project.pbxproj when version number changes.
d29 2
a30 1
2002-10-18  Jeff Hobbs  <jeffh@@ActiveState.com>
d32 23
a54 6
	* library/reg/pkgIndex.tcl:
	* win/configure:
	* win/configure.in:
	* win/Makefile.in:
	* win/makefile.vc:
	* win/makefile.bc:    Updated to reg1.1
d56 2
a57 3
	* doc/registry.n:      Added support for broadcasting changes to
	* tests/registry.test: the registry Environment. Noted proper code
	* win/tclWinReg.c:     in the docs. [Patch #625453]
d59 1
a59 1
	* unix/Makefile.in (dist): add any mac/tcl*.sea.hqx files
d61 2
a62 1
2002-10-17  Don Porter  <dgp@@users.sourceforge.net>
d64 1
a64 2
	* generic/tclVar.c:	Fixed code that check for proper # of args to
	* tests/var.test:	[array names].  Added test.  [Bug 624755]
d66 3
a68 1
2002-10-16  Jeff Hobbs  <jeffh@@ActiveState.com>
d70 1
a70 2
	* win/configure:                 add workaround for cygwin windres
	* win/tcl.m4 (SC_CONFIG_CFLAGS): problem. [Patch #624010] (howell)
d72 3
a74 1
2002-10-15  Jeff Hobbs  <jeffh@@ActiveState.com>
d76 1
a76 1
	* README: added archives.tcl.tk note
d78 45
a122 3
	* unix/configure:
	* unix/tcl.m4: Correct AIX-5 ppc build flags.
	Correct HP 11 64-bit gcc building. [Patch #601051] (martin)
d124 1
a124 1
2002-10-15  Vince Darley  <vincentdarley@@users.sourceforge.net>
d126 39
a164 3
	* generic/tclCmdMZ.c:
	* tests/trace.test: applied patch from Hemang Levana to fix
	[Bug #615043] in execution traces with idle tasks firing.
d166 1
a166 1
2002-10-14  Jeff Hobbs  <jeffh@@ActiveState.com>
d168 13
a180 2
	* generic/tclEnv.c (Tcl_PutEnv): correct possible mem leak.
	[Patch #623269] (brouwers)
d182 1
a182 1
2002-10-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d184 7
a190 3
	* generic/tcl.h: Need a different strategy through the maze of
	#defines to let people building with Cygwin build correctly.  Also
	made some comments less misleading...
d192 1
a192 1
2002-10-10  Jeff Hobbs  <jeffh@@ActiveState.com>
d194 4
a197 1
	* README: fixed minor nits [Bug #607776] (virden)
d199 1
a199 3
	* win/configure:
	* win/tcl.m4: enable USE_THREAD_ALLOC (new threaded allocator) by
	default in cygwin configure on Windows.
d201 2
a202 1
2002-10-10  Don Porter  <dgp@@users.sourceforge.net>
d204 1
a204 4
	* doc/Tcl.n:	Clarified that namespace separators are legal in
			the variable names during $-subtitution. [Bug 615139]
	
	* doc/regexp.n:	Typo correction.  Thanks Ronnie Brunner. [Bug 606826]
d206 5
a210 1
2002-10-10  Vince Darley  <vincentdarley@@users.sourceforge.net>
d212 1
a212 11
	* unix/tclLoadAout.c
	* unix/tclLoadDl.c
	* unix/tclLoadDld.c
	* unix/tclLoadDyld.c
	* unix/tclLoadNext.c
	* unix/tclLoadOSF.c
	* unix/tclLoadShl.c
	* win/tclWinLoad.c: allow either full paths or simply dll names
	to be specified when loading files (the latter will be looked
	up by the OS on your PATH/LD_LIBRARY_PATH as appropriate).
	Fixes [Bug 611108]
d214 7
a220 1
2002-10-09  Jeff Hobbs  <jeffh@@ActiveState.com>
d222 1
a222 6
	* unix/README: doc'ed --enable-symbols options.
	* unix/Makefile.in: removed @@MEM_DEBUG_FLAGS@@ subst.
	* unix/configure: regen
	* unix/configure.in: removed SC_ENABLE_MEMDEBUG call
	* unix/tcl.m4: replaced SC_ENABLE_MEMDEBUG with a more intelligent
	SC_ENABLE_SYMBOLS that takes yes|no|mem|compile|all as options now.
d224 12
a235 1
2002-10-09  Kevin B. Kenny  <kennykb@@acm.org>
d237 1
a237 4
	* win/tclWinTime.c: Added code to set an exit handler that
	terminates the thread that calibrates the performance counter, so
	that the thread won't outlive unloading the Tcl DLL. [Tcl bug
	620735].
d239 3
a241 1
2002-10-09  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d243 1
a243 1
	* doc/binary.n: More clarification of [binary scan]'s behaviour.
d245 11
a255 1
2002-10-09  Daniel Steffen  <das@@users.sourceforge.net>
d257 1
a257 1
	* generic/tclIntDecls.h: fixed botched regen.
d259 3
a261 1
2002-10-09  Daniel Steffen  <das@@users.sourceforge.net>
d263 1
a263 5
	* generic/tclInt.decls: made TclSetPreInitScript() declaration
	generic as it is used on mac & aqua as well.
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c: regen.
	* generic/tclCompile.h: added prototype for TclCompileVariableCmd.
d265 3
a267 6
	* mac/tclMacPort.h: removed incorrect <fcntl.h> definitions
	and obsolete <stat.h> definitions.
	* mac/tclMacChan.c: removed obsolete GetOpenMode() and replaced 
	associated constants with the <fcntl.h> analogues (they existing
	defs were inconsistent with <fcntl.h> which was causing havoc when
	Tcl_GetOpenMode was used instead of private GetOpenMode).
d269 1
a269 2
	* mac/tclMacFCmd.c: removed GenerateUniqueName(), use equivalent
	(and identiaclly named) routine from MoreFiles instead.
d271 21
a291 1
	* mac/tclMacLoad.c: CONSTification, fixes to Vince's last changes.
d293 1
a293 3
	* mac/tclMacFile.c: 
	* mac/tclMacTest.c:
	* mac/tclMacUnix.c: CONSTification.
d295 5
a299 3
	* mac/tclMacOSA.c: CONSTificcation, sprintf fixes, UH 3.4.x changes;
	fix for missing autoname token from TclOSACompileCmd. (bdesgraupes)
	* mac/AppleScript.html(AppleScript delete): doc fix. (bdesgraupes)
d301 1
a301 3
	* mac/tcltkMacBuildSupport.sea.hqx: updated MoreFiles to 1.5.3, 
	updated build instructions for 8.4.
	* mac/tclMacProjects.sea.hqx: rebuilt archive.
d303 31
a333 1
2002-10-09  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d335 1
a335 2
	* doc/Alloc.3: Added a note to mention that attempting to allocate
	a zero-length block can return NULL.  [Tk bug 619544]
d337 5
a341 1
2002-10-04  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d343 1
a343 1
	* doc/binary.n: Doc improvements [Patch 616480]
d345 27
a371 3
	* tests/fCmd.test, tests/winFCmd.test:
	* tools/eolFix.tcl, tools/genStubs.tcl: [file exist] -> [file exists]
	Thanks to David Welton.
d373 1
a373 1
2002-10-03  Don Porter  <dgp@@users.sourceforge.net>
d375 10
a384 1
	* doc/tcltest.n: fixed typo [Bug 618018].  Thanks to "JJM".
d386 1
a386 1
2002-10-03  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d388 35
a422 5
	* tools/man2help2.tcl: 
	* tests/http.test, tests/httpd, tests/httpold.test: 
	* tests/env.test, tests/binary.test, tests/autoMkindex.test: 
	* library/init.tcl, library/http/http.tcl: [info exist] should
	really be [info exists].  [Bug 602566]
d424 1
a424 2
	* doc/lsearch.n: Better specification of what happens when -sorted
	is mixed with other options. [Bug 617816]
d426 4
a429 1
2002-10-01  Jeff Hobbs  <jeffh@@ActiveState.com>
d431 1
a431 3
	* generic/tclProc.c (TclCreateProc): mask out VAR_UNDEFINED for
	precompiled locals to support 8.3 precompiled code.
	(Tcl_ProcObjCmd): correct 2002-09-26 fix to look for tclProcBodyType.
d433 4
a436 1
2002-10-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d438 1
a438 2
	* doc/socket.n: Mentioned that ports may be specified as serivce
	names as well as integers. [Bug 616843]
d440 9
a448 1
2002-09-30  Jeff Hobbs  <jeffh@@ActiveState.com>
d450 1
a450 3
	* generic/tclCompCmds.c (TclCompileRegexpCmd): correct the
	checking for bad re's that didn't terminate the re string.
	Resultant compiles were correct, but much slower than necessary.
d452 4
a455 1
2002-09-29  David Gravereaux <davygrvy@@pobox.com>
d457 1
a457 6
	* win/tclAppInit.c: Added proper exiting conditions using Win32
	console signals.  This handles the existing lack of a Ctrl+C exit
	to call exit handlers when built for thread support.  Also, properly
	handles exits from other conditions such as CTRL_CLOSE_EVENT,
	CTRL_LOGOFF_EVENT, and CTRL_SHUTDOWN_EVENT signals.  In all cases,
	exit handlers will be called.  [Bug 219355]
d459 21
a479 3
	* win/makefile.vc: Added missing tclThreadAlloc.c to the build
	rules and defines USE_THREAD_ALLOC when TCL_THREADS is defined
	to get the new behavior by default.
d481 3
a483 1
2002-09-27  Don Porter  <dgp@@users.sourceforge.net>
d485 1
a485 6
	* README:		Bumped to version 8.4.1 to avoid confusion
	* generic/tcl.h:	of CVS snapshots with the actual 8.4.0
	* tools/tcl.wse.in:	release.
	* unix/configure.in:
	* unix/tcl.spec:
	* win/configure.in:
d487 2
a488 1
	* unix/configure:	autoconf
d490 2
d493 1
a493 1
2002-09-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d495 19
a513 2
	* unix/configure: regen.
	* unix/tcl.m4: improve AIX-4/5 64bit compilation support.
d515 1
a515 2
	* generic/tclProc.c (Tcl_ProcObjCmd): correct overeager
	optimization of noop proc to handle the precompiled case. (sofer)
d517 23
a539 2
	* unix/ldAix (nmopts): add -X32_64 to make it work for 32 or 64bit
	mode compilation.
d541 1
a541 2
	* library/encoding/koi8-u.enc: removed extraneous spaces that
	confused encoding reader. [Bug #615115]
d543 5
a547 2
	* unix/Makefile.in: generate source dists with -src designator and
	do not generate .Z anymore (just .gz and .zip).
d549 1
a549 1
2002-09-18  Mumit Khan <khan@@nanotech.wisc.edu>
d551 3
a553 1
	Added basic Cygwin support.
d555 1
a555 10
	* win/tcl.m4 (SC_PATH_TCLCONFIG): Support one-tree build.
	(SC_PATH_TKCONFIG): Likewise.
	(SC_PROG_TCLSH): Likewise.
	(SC_CONFIG_CFLAGS): Assume real Cygwin port and remove -mno-cygwin 
	flags.  Add -mwin32 to extra_cflags and extra_ldflags.
	Remove ``-e _WinMain@@16'' from LDFLAGS_WINDOW.
	* win/configure.in: Allow Cygwin build.
	(SEH test): Define to be 1 instead of empty value.
	(EXCEPTION_DISPOSITION): Add test.
	* win/configure: Regenerate.
d557 6
a562 50
	* generic/tcl.h: Don't explicitly define __WIN32__ for Cygwin, let
	the user decide whether to use Windows or POSIX personality.
	(TCL_WIDE_INT_TYPE, TCL_LL_MODIFIER, struct Tcl_StatBuf): Define
	for Cygwin.
	* generic/tclEnv.c (Tcl_CygwinPutenv): putenv replacement for
	Cygwin.
	* generic/tclFileName.c (Tcl_TranslateFileName): Convert POSIX 
	to native format.
	(TclDoGlob): Likewise.
	* generic/tclPlatDecls.h (TCHAR): Define for Cygwin.
	* win/tclWinPort.h (putenv, TclpSysAlloc, TclpSysFree, 
	TclpSysRealloc): Define for Cygwin.

2002-09-26  Daniel Steffen  <das@@users.sourceforge.net>

	* macosx/Makefile: preserve environment value of INSTALL_ROOT.
	When embedding only use deployment build. Force relink before
	embedded build to ensure new linker flags are picked up.

	* macosx/Tcl.pbproj/project.pbxproj: add symbolic links to
	debug lib, stub libs and tclConfig.sh in framework toplevel.
	Configure target dependency fix. Fix to 'clean' action. Added
	private tcl headers to framework. Install tclsh symbolic link.
	Html doc build works when no installed tclsh available. Made
	html doc structure in framework more like in Apple frameworks.

2002-09-24  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tcl.m4 (SC_TCL_64BIT_FLAGS): Yet more robust 64-bit value
	detection to close [Bug 613117] on more systems.

	* generic/tclCompile.c (TclPrintSource): More CONSTifying.
	* generic/tclExecute.c (EvalStatsCmd): Object-ify to reduce
	warnings.  Thanks to 'CoderX2' on the chat for bringing this to my
	attention...

	* unix/tcl.m4: Forgot to define TCL_WIDE_INT_IS_LONG at the
	appropriate moment.  I believe this is the cause of [Bug 613117]

	* doc/lset.n: Changed 'list' to 'varName' for consistency with
	lappend documentation.  Thanks to Glenn Jackman [Bug 611719]

2002-09-22  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:  Corrected [puts -nonewline] within
	test bodies.  Thanks to Harald Kirsch.  [Bug 612786, Patch 612788]
	Also corrected reporting of body return code.  Thanks to David
	Taback [Bug 611922]
	* library/tcltest/pkgIndex.tcl: Bump to version 2.2.1.
	* tests/tcltest.test: added tests for these bugs.
d564 1
a564 1
2002-09-15  Mo DeJong  <mdejong@@users.sourceforge.net>
d566 2
a567 5
	* unix/configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Add PEEK_XCLOSEIM
	define under Linux. This is used by Tk to double
	check that an X input context is cleaned up
	before it is closed.
d569 1
a569 1
2002-09-12  David Gravereaux <davygrvy@@pobox.com>
d571 1
a571 2
	* win/coffbase.txt: Added BLT to the virtual base address
	listings table should BLT's build tools decide to use it.
d573 1
a573 1
2002-09-12  Daniel Steffen  <das@@users.sourceforge.net>
d575 1
a575 6
	* generic/tcl.h:
	* mac/tclMacApplication.r:
	* mac/tclMacLibrary.r:
	* mac/tclMacResource.r: unified use of the two equivalent 
	resource compiler header inclusion defines RC_INVOKED and
	RESOURCE_INCLUDED, now use RC_INVOKED throughout. 
d577 1
a577 1
2002-09-10  Mo DeJong  <mdejong@@users.sourceforge.net>
d579 2
a580 3
	* unix/README: Add note about building extensions
	with the same compiler Tcl was built with.
	[Tk Bug 592096]
d582 1
a582 1
2002-09-10  Daniel Steffen  <das@@users.sourceforge.net>
d584 3
a586 2
	* macosx/Tcl.pbproj/project.pbxproj: disabled building html
	documentation during embedded build.
d588 3
a590 1
2002-09-10  Daniel Steffen  <das@@users.sourceforge.net>
d592 1
a592 5
	* unix/Makefile.in: added DYLIB_INSTALL_DIR variable for macosx
	and set it to default value ${LIB_RUNTIME_DIR}
	* unix/tcl.m4 (Darwin): use DYLIB_INSTALL_DIR instead of
	LIB_RUNTIME_DIR in the -install_name argument to ld.
	* unix/configure: regen.
d594 2
a595 7
	* macosx/Tcl.pbproj/project.pbxproj:
	* macosx/Makefile: added support for building Tcl as an embedded
	framework, i.e. using an dyld install_name containing
	@@executable_path/../Frameworks via the new DYLIB_INSTALL_DIR
	unix/Makefile variable.
	
2002-09-10  Jeff Hobbs  <jeffh@@ActiveState.com>
d597 2
a598 1
	*** 8.4.0 TAGGED FOR RELEASE ***
d600 2
a601 1
2002-09-06  Don Porter  <dgp@@users.sourceforge.net>
d603 1
a603 2
	* doc/file.n:  Format correction, and clarified [file normalize]
	returns an absolute path.
d605 1
a605 1
	* doc/tcltest.n:  Added examples section, as long promised.
d607 4
a610 1
2002-09-06  Reinhard Max  <max@@suse.de>
d612 10
a621 1
	* tests/tcltest.test: Added nonRoot flag to tests 8.3, 8.4, and 8.12.
d623 3
a625 1
2002-09-05  Don Porter  <dgp@@users.sourceforge.net>
d627 6
a632 1
	* doc/tcltest.n:  Clarified phrasing.
d634 2
a635 4
	* generic/tclBasic.c (TclRenameCommand,CallCommandTraces):
	* tests/trace.test (trace-27.1): Corrected memory leak when a rename
	trace deleted the command being traced.  Test added.  Thanks to
	Hemang Lavana for the fix.  [Bug 604609]
d637 1
a637 2
	* generic/tclVar.c (TclDeleteVars):  Corrected logic for setting the
	TCL_INTERP_DESTROYED flag when calling variable traces. [Tk Bug 605121]
d639 1
a639 1
2002-09-04  Miguel Sofer  <msofer@@users.sourceforge.net>
d641 2
a642 2
	* generic/tclVar.c (DeleteArray): leak plug [Bug 604239]. Thanks
	to dkf and dgp for the long and difficult discussion in the chat.
d644 2
a645 1
2002-09-03  Jeff Hobbs  <jeffh@@ActiveState.com>
d647 1
a647 1
	* generic/tclVar.c (Tcl_UpVar2): code cleanup to not use goto
d649 2
a650 2
	* unix/configure: remove -pthread from LIBS on FreeBSD in thread
	* unix/tcl.m4:    enabled build. [Bug #602849]
d652 1
a652 1
2002-09-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d654 3
a656 4
	* generic/tclInterp.c (AliasCreate): a Tcl_Obj was leaked on error
	return from TclPreventAliasLoop.
	
2002-09-03  Daniel Steffen  <das@@users.sourceforge.net>
d658 2
a659 2
	* macosx/Tcl.pbproj/project.pbxproj: Bumped version number to
	8.4.0 and updated copyright info.
d661 3
a663 1
2002-09-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d665 2
a666 2
	* generic/tclVar.c (Tcl_UpVar2): a Tcl_Obj was being leaked on
	error return from TclGetFrame.
d668 3
a670 1
2002-09-03  Don Porter  <dgp@@users.sourceforge.net>
d672 2
a673 1
	* changes:  Updated changes for 8.4.0 release.
d675 2
a676 1
2002-09-02  Jeff Hobbs  <jeffh@@ActiveState.com>
d678 3
a680 2
	* unix/tclUnixFile.c (TclpObjLink): removed unnecessary/unfreed
	extra native char*.
d682 3
a684 2
	* unix/tclUnixChan.c (Tcl_MakeTcpClientChannel): make sure to init
	flags field of TcpState ptr to 0.
d686 3
a688 3
	* unix/configure:
	* unix/tcl.m4: added 64-bit gcc compilation support on HP-11.
	[Patch #601051] (martin)
d690 1
a690 9
	* README:		Bumped version number to 8.4.0
	* generic/tcl.h:
	* tools/tcl.wse.in:
	* unix/configure:
	* unix/configure.in:
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure:
	* win/configure.in:
d692 3
a694 3
	* generic/tclInterp.c (SlaveCreate): make sure that the memory and
	checkmem commands are initialized in non-safe slave interpreters
	when TCL_MEM_DEBUG is used. [Bug #583445]
d696 2
a697 3
	* win/tclWinConsole.c (ConsoleCloseProc): only wait on writable
	pipe if there was something to write.  This may prevent infinite
	wait on exit.
d699 1
a699 2
	* tests/exec.test: marked exec-18.1 unixOnly until the Windows
	incompatability (in the test, not the core) can be resolved.
d701 5
a705 2
	* tests/http.test (http-3.11): added close $fp that was causing an
	error on Windows because the file was not closed before deleting.
d707 1
a707 2
	* unix/tclUnixInit.c (Tcl_MacOSXGetLibraryPath): made this static
	function only appear when HAVE_CFBUNDLE is defined.
d709 2
a710 1
2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>
d712 47
a758 2
	* unix/tcl.m4: added TK_SHLIB_LD_EXTRAS analogue of existing
	TCL_SHLIB_LD_EXTRAS for linker settings only used when linking Tk.
d760 2
a761 1
	* unix/configure: regen
d763 24
a786 1
2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>
d788 1
a788 1
	*** macosx-8-4-branch merged into the mainline [tcl patch #602770] ***
d790 1
a790 1
	* generic/tcl.decls: added new macosx specific entry to stubs table.
d792 1
a792 25
	* tools/genStubs.tcl: added generation of platform guards for
	macosx. This is a little more complex than it seems, because MacOS
	X IS "unix" plus a little bit, for the purposes of Tcl. BUT
	unfortunately, Tk uses "unix" to mean X11. So added platform keys
	for macosx (the little added to "unix"), "aqua" and "x11" to
	distinguish these for Tk.
	
	* generic/tcl.h: added a #ifnded RESOURCE_INCLUDED so that tcl.h
	can be passed to the resource compiler.
	
	* generic/tcl.h:
	* generic/tclNotify.c: added a few Notifier procs, to be able to
	modify more bits of the Tcl notifier dynamically. Required to get
	Mac OS X Tk to live on top of the Tcl Unix threaded notifier.
	Changes the size of the Tcl_NotifierProcs structure, but doesn't
	move any elements around.

	* unix/tclUnixNotfy.c: moved the call to Tcl_ConditionNotify till
	AFTER we are done mucking with the pointer swap. Fixes cases where
	the thread waiting on the condition wakes & accesses the
	waitingListPtr before it gets reset, causing a hang.

	* library/auto.tcl (tcl_findLibrary): added checking the
	directories in the tcl_pkgPath for library files on macosx to
	enable support of the standard Mac OSX library locations
d794 4
a797 1
	* unix/Makefile.in:
d799 3
a801 19
	* unix/tcl.m4: added MAC_OSX_DIR.  Added PLAT_OBJS to the OBJS:
	there are some MacOS X specific files now for Tcl, and when I get
	he resource & applescript stuff ported over, and restore support
	for FindFiles, etc, there will be a few more.
	Added LD_LIBRARY_PATH_VAR configure variable to avoid having to set
	all possible LD_LIBRARY_PATH analogues on all platforms.
	LD_LIBRARY_PATH_VAR is "LD_LIBRARY_PATH" by default, "LIBPATH" on
	AIX, "SHLIB_PATH" on HPUX and "DYLD_LIBRARY_PATH" on Mac OSX.
	Added configure option to package Tcl as a framework on Mac OSX.

	* macosx/tclMacOSXBundle.c (new): support for finding Tcl extension
	packaged as 'bundles' in the standard Mac OSX library locations.

	* unix/tclUnixInit.c: added support for findig the tcl script
	library inside Tcl packaged as a framework on Mac OSX.

	* macosx/Tcl.pbproj/jingham.pbxuser (new):
	* macosx/Tcl.pbproj/project.pbxproj (new): project for Apple's
	ProjectBuilder IDE.
d803 3
a805 2
	* macosx/Makefile (new): simple makefile for building the project
	from the command line via the ProjectBuilder tool 'pbxbuild'.
a806 1
	* unix/configure:
d808 41
a848 1
	* generic/tclPlatDecls.h: regen
d850 37
a886 1
2002-08-29  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d888 3
a890 3
	* win/tclWinThrd.c (TclpFinalizeThreadData, TclWinFreeAllocCache):
	  Applied patch for bug #599428, provided by Miguel Sofer
	  <msofer@@users.sourceforge.net>.
d892 16
a907 1
2002-08-28  David Gravereaux <davygrvy@@pobox.com>
d909 1
a909 8
	* generic/tclEnv.c:
	* unix/configure.in:
	* win/tclWinPort.h:  putenv() on some systems copies the buffer
	rather than taking reference to it.  This causes memory leaks
	and is know to effect mswindows (msvcrt) and NetBSD 1.5.2 .  This
	patch tests for this behavior and turns on -DHAVE_PUTENV_THAT_COPIES=1
	when approriate.  Thanks to David Welton for assistance.
	[Bug 414910]
d911 2
a912 1
	* unix/configure: regen'd
d914 1
a914 1
2002-08-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d916 2
a917 1
	* doc/eval.n: Added mention of list command and corrected "SEE ALSO".
d919 1
a919 3
	* unix/configure.in: Cache handling of ac_cv_type_socklen_t was
	wrong. [Bug 600931] reported by John Ellson.  Fixed by putting the
	brackets where they belong.
d921 2
a922 1
2002-08-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d924 1
a924 3
	* generic/tclCompCmds.c: fix for [Bug 599788] (error in element
	name causing segfault), reported by Tom Wilkason. Fixed by copying
	the tokens instead of the source string.
d926 2
a927 1
2002-08-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d929 1
a929 4
	* generic/tclThreadAlloc.c: small optimisation, reducing the
	new allocator's overhead.
	
2002-08-23  Miguel Sofer  <msofer@@users.sourceforge.net>
d931 7
a937 2
	* generic/tclObj.c (USE_THREAD_ALLOC): fixed leak [Bug 597936]. 
	Thanks to Zoran Vasiljevic.
d939 1
a939 1
2002-08-23  Miguel Sofer  <msofer@@users.sourceforge.net>
d941 4
a944 2
	* generic/tclThreadAlloc.c (USE_THREAD_ALLOC): moving objects
	between caches as a block, instead of one-by-one.
d946 1
a946 1
2002-08-22  Miguel Sofer  <msofer@@users.sourceforge.net>
d948 9
a956 3
	* generic/tclBasic.c:
	* generic/tclCmdMZ.c: fix for freed memory r/w in delete traces
	[Bug 589863], patch by Hemang Lavana.
d958 1
a958 1
2002-08-20  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d960 12
a971 8
	* win/Makefile.in (CFLAGS): 
	* unix/Makefile.in (MEM_DEBUG_FLAGS): Added usage of @@MEM_DEBUG_FLAGS@@.
	* win/configure.in:
	* unix/configure.in: Added usage of SC_ENABLE_MEMDEBUG.
	* win/tcl.m4:
	* unix/tcl.m4: Added macro SC_ENABLE_MEMDEBUG. Allows a user of
	  configure to (de)activate memory validation and debugging
	  (TCL_MEM_DEBUG). No need to modify the makefile anymore.
d973 1
a973 1
2002-08-20  Don Porter  <dgp@@users.sourceforge.net>
d975 1
a975 1
	* generic/tclCkalloc.c:	CONSTified MemoryCmd and CheckmemCmd.
d977 2
a978 2
	* README:		Bumped version number to 8.4b3 to distinguish
	* generic/tcl.h:	HEAD from the 8.4b2 release.
d980 1
a980 1
	* unix/configure.in:
d982 14
a995 2
	* win/README.binary:
	* win/configure.in:
d997 1
a997 2
	* unix/configure:	autoconf
	* win/configure:
d999 1
a999 8
	* library/http/http.tcl:	Corrected installation directory of
	* library/msgcat/msgcat.tcl:	the package tcltest 2.2.  Added
	* library/opt/optparse.tcl:	comments in other packages to remind
	* library/tcltest/tcltest.tcl:	that installation directories need 
	* unix/Makefile.in:		updates to match increasing version
	* win/Makefile.in:		numbers. [Bug 597450]
	* win/makefile.bc:
	* win/makefile.vc:
d1001 3
a1003 1
2002-08-19  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d1005 1
a1005 2
	* unix/tclUnixTest.c (TestfilehandlerCmd): Changed
	  readable/writable to the more common readable|writable.
d1007 2
a1008 2
	  Fixes SF #596034 reported by Larry Virden
	  <lvirden@@users.sourceforge.net>.
d1010 2
a1011 12
2002-08-16  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/fCmd.test: Added test to make sure that the cause of the
	problem is detectable with an unpatched Tcl.
	* doc/ObjectType.3: Added note on the root cause of this problem
	to the documentation, since it is possible for user code to
	trigger this sort of behaviour too.
	* generic/tclIOUtil.c (SetFsPathFromAny): Objects should only have
	their old representation deleted when we know that we are about to
	install a new one.  This stops a weird TclX bug under Linux with
	certain kinds of memory debugging enabled which essentally came
	down to a double-free of a string.
d1013 2
a1014 1
2002-08-14  Miguel Sofer  <msofer@@users.sourceforge.net>
d1016 1
a1016 9
	* generic/tclInt.h:
	* generic/tclObj.c: (code cleanup) factored the parts in the macros 
	TclNewObj() / TclDecrRefCount() into a common part for all
	memory allocators and two new macros TclAllocObjStorage() /
	TclFreeObjStorage() that are specific to each allocator and fully
	describe the differences. Removed allocator-specific code from
	tclObj.c by using the macros.
	
2002-08-12  Miguel Sofer  <msofer@@users.sourceforge.net>
d1018 3
a1020 3
	* generic/tclCmdMZ.c: fixing UMR in delete traces, [Bug 589863].
	
2002-08-08  David Gravereaux <davygrvy@@pobox.com>
d1022 1
a1022 2
	* tools/man2help.tcl: Fixed $argv handling bug where if -bitmap
	wasn't specified $argc was off by one.
d1024 1
a1024 1
2002-08-08  Miguel Sofer  <msofer@@users.sourceforge.net>
d1026 2
a1027 2
	* tests/uplevel.test: added 6.1 to test [uplevel] with shadowed
	commands [Bug 524383]
d1029 12
a1040 1
	* tests/subst.test: added 5.8-10 as further tests for [Bug 495207] 
d1042 1
a1042 1
2002-08-08  Don Porter  <dgp@@users.sourceforge.net>
d1044 2
a1045 1
	* tests/README: Noted removal of defs.tcl.
d1047 1
a1047 1
2002-08-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d1049 8
a1056 1
	* doc/lsearch.n: corrected lsearch docs to use -inline in examples.
d1058 1
a1058 1
	*** 8.4b2 TAGGED FOR RELEASE ***
d1060 4
a1063 10
	* tests/fCmd.test:
	* tests/unixFCmd.test: updated tests for new link copy behavior.
	* generic/tclFCmd.c (CopyRenameOneFile): changed the behavior to
	follow links to endpoints and copy that file/directory instead of
	just copying the surface link.  This means that trying to copy a
	link that has no endpoint (danling link) is an error.
	[Patch #591647] (darley)
	(CopyRenameOneFile): this is currently disabled by default until
	further issues with such behavior (like relative links) can be
	handled correctly.
d1065 1
a1065 1
	* tests/README: slight wording improvements
d1067 3
a1069 1
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>
d1071 1
a1071 7
	* docs/BoolObj.3: added description of valid string reps for a
	boolean object [Bug 584794]
	* generic/tclObj.c: optimised Tcl_GetBooleanFromObj and
	SetBooleanFromAny to avoid parsing the string rep when it can be
	avoided [Bugs 584650, 472576]
	
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>
d1073 5
a1077 5
	* generic/tclCompile.h:
	* generic/tclObj.c: making tclCmdNameType static ([Bug 584567],
	Don Porter).
	
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>
d1079 1
a1079 5
	* generic/tclObj.c (Tcl_NewObj): added conditional code for
	USE_THREAD_ALLOC; objects allocated through Tcl_NewObj() were
	otherwise being leaked. [Bug 587488] reported by Sven Sass.
	
2002-08-06  Daniel Steffen  <das@@users.sourceforge.net>
d1081 1
a1081 9
	* generic/tclInt.decls:
	* unix/tclUnixThrd.c: Added stubs and implementations for
	non-threaded build for the tclUnixThrd.c procs TclpReaddir,
	TclpLocaltime, TclpGmtime and TclpInetNtoa.
	Fixes link errors in stubbed & threaded extensions that include
	tclUnixPort.h and use any of the procs readdir, localtime, 
	gmtime or inet_ntoa (e.g. TclX 8.4) [Bug 589526]
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c: Regen.
d1083 2
a1084 1
2002-08-05  Don Porter  <dgp@@users.sourceforge.net>
d1086 1
a1086 110
	* library/tcltest/tcltest.tcl:	The setup and cleanup scripts are now
	* library/tcltest/pkgIndex.tcl:	skipped when a test is skipped, fixing
	* tests/tcltest.test:		[Bug 589859].  Test for bug added, and
	corrected tcltest package bumped to version 2.2.

	* generic/tcl.decls:	Restored Tcl_Concat to return (char *).  Like
	* generic/tclDecls.h:	Tcl_Merge, it transfers ownership of a dynamic
	* generic/tclUtil.c:	allocated string to the caller.

2002-08-04  Don Porter  <dgp@@users.sourceforge.net>

	* doc/CmdCmplt.3:	Applied Patch 585105 to fully CONST-ify
	* doc/Concat.3:		all remaining public interfaces of Tcl.
	* doc/CrtCommand.3:	Notably, the parser no longer writes on 
	* doc/CrtSlave.3:	the string it is parsing, so it is no
	* doc/CrtTrace.3:	longer necessary for Tcl_Eval() to be
	* doc/Eval.3:		given a writable string.  Also, the
	* doc/ExprLong.3:	refactoring of the Tcl_*Var* routines
	* doc/LinkVar.3:	by Miguel Sofer is included, so that the
	* doc/ParseCmd.3:	"part1" argument for them no longer needs
	* doc/SetVar.3:		to be writable either.
	* doc/TraceVar.3:
	* doc/UpVar.3:		Compatibility support has been enhanced so
	* generic/tcl.decls	that a #define of USE_NON_CONST will remove
	* generic/tcl.h		all possible source incompatibilities with
	* generic/tclBasic.c	the 8.3 version of the header file(s).
	* generic/tclCmdMZ.c	The new #define of USE_COMPAT_CONST now does
	* generic/tclCompCmds.c	what USE_NON_CONST used to do -- disable
	* generic/tclCompExpr.c only those new CONST's that introduce
	* generic/tclCompile.c	irreconcilable incompatibilities.
	* generic/tclCompile.h
	* generic/tclDecls.h	Several bugs are also fixed by this patch.
	* generic/tclEnv.c	[Bugs 584051,580433] [Patches 585105,582429]
	* generic/tclEvent.c	
	* generic/tclInt.decls
	* generic/tclInt.h
	* generic/tclIntDecls.h
	* generic/tclInterp.c
	* generic/tclLink.c
	* generic/tclObj.c
	* generic/tclParse.c
	* generic/tclParseExpr.c
	* generic/tclProc.c
	* generic/tclTest.c
	* generic/tclUtf.c
	* generic/tclUtil.c
	* generic/tclVar.c
	* mac/tclMacTest.c
	* tests/expr-old.test
	* tests/parseExpr.test
	* unix/tclUnixTest.c
	* unix/tclXtTest.c
	* win/tclWinTest.c

2002-08-01  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: bugfix (reading freed memory). Testsuite
	passed on linux/i386, compile-13.1 hung on linux/alpha.

2002-08-01  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: added a reference count for the complete
	execution stack, instead of Tcl_Preserve/Tcl_Release. 

2002-08-01  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tclCkalloc.c (TclFinalizeMemorySubsystem):
	Don't lock the ckalloc mutex before invoking the
	Tcl_DumpActiveMemory function since it also
	locks the same mutex. This code is only executed
	when "memory onexit filename" has been executed
	and Tcl is compiled with -DTCL_MEM_DEBUG.

2002-08-01  Reinhard Max  <max@@suse.de>

	* win/tclWinPort.h: The windows headers don't provide socklen_t,
	so we have to do it.

2002-07-31  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInt.h (USE_THREAD_ALLOC): for unshared objects,
	TclDecrRefCount now frees the internal rep before the string rep -
	just like the non-macro Tcl_DecrRefCount/TclFreeObj [Bug 524802]. 
	For the other allocators the fix was done on 2002-03-06.

2002-07-31  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInterp.c: signed/unsigned comparison warning fixed
	(Vince Darley).

2002-07-31  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tcl.m4 (SC_BUGGY_STRTOD): Enabled caching of test results.

	* unix/tcl.m4 (SC_BUGGY_STRTOD): Solaris 2.8 still has a buggy
	strtod() implementation; make sure we detect it.

	* tests/expr.test (expr-22.*): Marked as non-portable because it
	seems that these tests have an annoying tendency to fail in
	unexpected ways.  [Bugs 584825, 584950, 585986]

2002-07-30  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tests/io.test: 
	* generic/tclIO.c (WriteChars): Added flag to break out of loop if
	  nothing of the input is consumed at all, to prevent infinite
	  looping of called with a non-UTF-8 string. Fixes Bug 584603
	  (partially). Added new test "io-60.1". Might need additional
	  changes to Tcl_Main so that unprintable results are printed as
	  binary data.
d1088 7
a1094 1
2002-07-29  Mo DeJong  <mdejong@@users.sourceforge.net>
d1096 1
a1096 8
	* unix/Makefile.in: Use CC_SEARCH_FLAGS instead of
	LD_SEARCH_FLAGS when linking with ${CC}.
	* unix/configure: Regen.
	* unix/configure.in: Don't subst CC_SEARCH_FLAGS or
	LD_SEARCH_FLAGS since this is now done in tcl.m4.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Document and
	set CC_SEARCH_FLAGS whenever LD_SEARCH_FLAGS is set.
	[Tcl patch 588290]
d1098 16
a1113 1
2002-07-29  Reinhard Max  <max@@suse.de>
d1115 1
a1115 6
	* unix/tcl.m4 (SC_SERIAL_PORT): Fixed detection for cases when
                                        configure's stdin is not a tty.
	
	* unix/tclUnixPort.h: 
	* generic/tclIOSock.c:          Changed size_t to socklen_t in
                                        socket-related function calls.
d1117 5
a1121 4
	* unix/configure.in:            Added test and fallback definition
                                        for socklen_t.
	
	* unix/configure:               generated.
d1123 1
a1123 1
2002-07-29  Miguel Sofer  <msofer@@users.sourceforge.net>
d1125 4
a1128 1
	* generic/tclObj.c: fixed a comment
d1130 1
a1130 19
	* generic/tcl.h: 
	* generic/tclBasic.c: 
	* generic/tclInterp.c: added the new flag TCL_EVAL_INVOKE to
	the interface of the Tcl_Eval* functions, removing the
	TCL_EVAL_NO_TRACEBACK added yesterday: alias invocations not only 
	require no tracebacks, but also look up the command name in the
	global scope - see new test interp-9.4
	* tests/interp.test: added 9.3 to test for safety of aliases to
	hidden commands, 9.4 to test for correct command lookup scope.

2002-07-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/regc_locale.c (cclass): [[:xdigit:]] is only a defined
	concept on western characters, so should not allow any unicode
	digit, and hence number of ranges in [[:xdigit:]] is fixed.
	* tests/reg.test: Added test to detect the bug.
	* generic/regc_cvec.c (newcvec): Corrected initial size value in
	character vector structure.  [Bug 578363]  Many thanks to
	pvgoran@@users.sf.net for tracking this down.
d1132 2
a1133 1
2002-07-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d1135 2
a1136 37
	* generic/tcl.h: 
	* generic/tclBasic.c: added the new flag TCL_EVAL_NO_TRACEBACK to
	the interface of the Tcl_Eval* functions. Modified the error
	message for too many nested evaluations.
	* generic/tclInterp.h: changed the Alias struct to be of variable
	length and store the prefix arguments directly (instead of a
	pointer to a Tcl_Obj list). Made AliasObjCmd call Tcl_EvalObjv
	instead of TclObjInvoke - thus making aliases trigger execution
	traces [Bug 582522].
	* tests/interp.test:
	* tests/stack.test: adapted to the new error message.
	* tests/trace.test: added tests for aliases firing the exec
	traces. 

2002-07-27  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Revert fix for Tcl bug 529801
	since it was incorrect and broke the build on
	other systems. Fix Tcl bug 587299.
	Add MAJOR_VERSION, MINOR_VERSION, PATCH_LEVEL,
	SHLIB_LD_FLAGS, SHLIB_LD_LIBS, CC_SEARCH_FLAGS,
	LD_SEARCH_FLAGS, and LIB_FILE variables to support
	more generic library build/install rules.
	* unix/configure: Regen.
	* unix/configure.in: Move AC_PROG_RANLIB into
	tcl.m4. Move shared build test and setting
	of MAKE_LIB and MAKE_STUB_LIB into tcl.m4.
	Move subst of a number of variables into
	tcl.m4 where they are defined.
	* unix/tcl.m4 (SC_ENABLE_SYMBOLS, SC_CONFIG_CFLAGS):
	Subst vars where they are defined. Add MAKE_LIB,
	MAKE_STUB_LIB, INSTALL_LIB, and INSTALL_STUB_LIB
	rules to deal with the ugly details of running
	ranlib on static libs at build and install time.
	Replace TCL_SHLIB_LD_EXTRAS with SHLIB_LD_FLAGS
	and use it when building a shared library.
	* unix/tclConfig.sh.in: Add TCL_CC_SEARCH_FLAGS.
d1138 24
a1161 1
2002-07-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d1163 1
a1163 4
	* generic/tclExecute.c: fixed Tcl_Obj leak in code corresponding
	to the macro NEXT_INST_V(x, 0, 1) [Bug 587495].
	
2002-07-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d1165 2
a1166 2
	* generic/tclVar.c (TclObjLookupVar): leak fix and improved
	comments. 
d1168 3
a1170 1
2002-07-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d1172 1
a1172 3
	* generic/tclVar.c (TclLookupVar): removed early returns that
	prevented the parens from being restored. also removed goto label
	as it was not necessary.
d1174 1
a1174 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d1176 1
a1176 3
	* generic/tclExecute.c: 
	* tests/expr-old.test: fix for erroneous error messages in [expr],
	[Bug  587140] reported by Martin Lemburg.
d1178 2
a1179 3
2002-07-25  Joe English  <jenglish@@users.sourceforge.net>
	* generic/tclProc.c: fix for Tk Bug #219218 "error handling 
	with bgerror in Tk"
d1181 1
a1181 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d1183 5
a1187 2
	* generic/tclExecute.c: restoring full TCL_COMPILE_DEBUG
	functionality.
d1189 1
a1189 1
2002-07-24  Don Porter  <dgp@@users.sourceforge.net>
d1191 2
a1192 2
	* tests/unixInit.test: relaxed unixInit-3.1 to accept iso8859-15
	as a valid C encoding.  [Bug 575336]
d1194 5
a1198 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d1200 2
a1201 4
	* generic/tclExecute.c: restoring the tcl_traceCompile
	functionality while I repair tcl_traceExec. The core now compiles
	and runs also under TCL_COMPILE_DEBUG, but execution in the
	bytecode engine can still not be traced.
d1203 1
a1203 1
2002-07-24  Daniel Steffen  <das@@users.sourceforge.net>
d1205 8
a1212 6
	* unix/Makefile.in:
	* unix/configure.in: corrected fix for [Bug 529801]: ranlib
	only needed for static builds on Mac OS X.
	* unix/configure: Regen.
	* unix/tclLoadDyld.c: fixed small bugs introduced by Vince,
	implemented library unloading correctly (needs OS X 10.2).
d1214 1
a1214 1
2002-07-23  Joe English  <jenglish@@users.sourceforge.net>
d1216 2
a1217 6
	* doc/OpenFileChnl.3: (Updates from Larry Virden)
	* doc/open.n:
	* doc/tclsh.1: Fix section numbers in Unix man page references.
	* doc/lset.n:  In EXAMPLES section, include command to set the 
	initial value used in subsequent examples.
	* doc/http.n: Package version updated to 2.4.
d1219 1
a1219 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d1221 4
a1224 4
	* unix/configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Enable 64 bit compilation
	when using the native compiler on a 64 bit version of IRIX.
	[Tcl bug 219220]
d1226 1
a1226 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d1228 2
a1229 2
	* unix/Makefile.in: Combine ranlib tests and
	avoid printing unless ranlib is actually run.
d1231 3
a1233 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d1235 4
a1238 3
	* unix/tcl.m4 (SC_PATH_X): Set XINCLUDES to "" instead
	of "# no special path needed" or "# no include files found"
	when x headers cannot be located.
d1240 3
a1242 1
2002-07-22  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1244 3
a1246 14
	* generic/tclIOUtil.c: made tclNativeFilesystem static
	(since 07-19 changes removed its usage elsewhere), and
	added comments about its usage.
	* generic/tclLoad.c:
	* generic/tcl.h:
	* generic/tcl.decls: 
	* doc/FileSystem.3: converted last load-related ClientData
	parameter to Tcl_LoadHandle opaque structure, removing a 
	couple of casts in the process.
	
	* generic/tclInt.h: removed tclNativeFilesystem declaration
	since it is now static again.
	
2002-07-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d1248 3
a1250 6
	* tests/expr.test (expr-22.*): Added tests to help detect the
	corrected handling.
	* generic/tclExecute.c (IllegalExprOperandType): Improved error
	message generated when attempting to manipulate Inf and NaN values.
	* generic/tclParseExpr.c (GetLexeme): Allowed parser to recognise
	'Inf' as a floating-point number. [Bug 218000]
d1252 1
a1252 1
2002-07-21  Don Porter  <dgp@@users.sourceforge.net>
d1254 2
a1255 1
	* tclIOUtil.c: Silence compiler warning. [Bug 584408].
d1257 5
a1261 1
2002-07-19  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1263 3
a1265 4
	* generic/tclIOUtil.c: fix to GetFilesystemRecord
	* win/tclWinFile.c:
	* unix/tclUnixFile.c: fix to subtle problem with links shown
	up by latest tclkit builds.
d1267 1
a1267 1
2002-07-19  Mo DeJong  <mdejong@@users.sourceforge.net>
d1269 2
a1270 32
	* unix/configure:
	* unix/configure.in:
	* win/configure:
	* win/configure.in: Add AC_PREREQ(2.13) in an attempt
	to make it more clear that the configure scripts
	must be generated with autoconf version 2.13.
	[Bug 583573]

2002-07-19  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* unix/Makefile.in: fix to build on MacOS X [Bug 529801], bug
	report and fix from jcw.

2002-07-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* win/tclWinSerial.c (no_timeout): Made this variable static.

	* generic/tclExecute.c, generic/tclCompile.c, generic/tclBasic.c: 
	* generic/tclCompile.h (builtinFuncTable, instructionTable): Added
	prefix to these symbols because they are visible outside the Tcl
	library.

	* generic/tclCompExpr.c (operatorTable): 
	* unix/tclUnixTime.c (tmKey):
	* generic/tclIOUtil.c (theFilesystemEpoch, filesystemWantToModify,
	filesystemIteratorsInProgress, filesystemOkToModify): Made these
	variables static.

	* unix/tclUnixFile.c:		Renamed nativeFilesystem to
	* win/tclWinFile.c:		tclNativeFilesystem and declared
	* generic/tclIOUtil.c:		it properly in tclInt.h
	* generic/tclInt.h: 
d1272 2
a1273 1
	* generic/tclUtf.c (totalBytes): Made this array static and const.
d1275 3
a1277 3
	* generic/tclParse.c (typeTable): Made this array static and const.
	(Tcl_ParseBraces): Simplified error handling case so that scans
	are only performed when needed, and flags are simpler too.
d1279 1
a1279 2
	* license.terms: Added AS to list of copyright holders; it's only
	fair for the current gatekeepers to be listed here!
d1281 5
a1285 3
	* tests/cmdMZ.test: Renamed constraint for clarity. [Bug#583427]
	Added tests for the [time] command, which was previously only
	indirectly tested!
d1287 1
a1287 1
2002-07-18  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1289 5
a1293 4
	* generic/tclInt.h:
	* generic/tcl.h:
	* */*Load*.c: added comments on changes of 07/17 and 
	replaced clientData with Tcl_LoadHandle in all locations.
d1295 1
a1295 11
	* generic/tclFCmd.c:
	* tests/fileSystem.test: fixed a 'knownBug' with 'file
	attributes ""'
	* tests/winFCmd.test: 
	* tests/winPipe.test:
	* tests/fCmd.test:
	* tessts/winFile.test: added 'pcOnly' constraint to some
	tests to make for more useful 'tests skipped' log from 
	running all tests on non-Windows platforms.
	
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d1297 7
a1303 3
	* generic/tclBasic.c (CallCommandTraces): delete traces now
	receive the FQ old name of the command. 
	[Bug 582532] (Don Porter)
d1305 1
a1305 1
2002-07-18  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1307 2
a1308 4
	* tests/ioUtil.test: added constraints to 1.4,2.4 so they
	don't run outside of tcltest. [Bugs 583276,583277]
	
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d1310 2
a1311 2
	* generic/tclVar.c (DupParsedVarName): nasty bug fixed, reported
	by Vince Darley.
d1313 2
a1314 1
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d1316 3
a1318 5
	* generic/tclVar.c (TclPtrIncrVar): missing CONST in declarations,
	inconsistent with tclInt.h. Thanks to Vince Darley for reporting,
	boo to gcc for not complaining.
	
2002-07-17  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1320 2
a1321 21
	* generic/tclInt.h:
	* generic/tclIOUtil.c:
	* generic/tclLoadNone.c:
	* unix/tclLoadAout.c:
	* unix/tclLoadDl.c:
	* unix/tclLoadDld.c:
	* unix/tclLoadDyld.c:
	* unix/tclLoadNext.c:
	* unix/tclLoadOSF.c:
	* unix/tclLoadShl.c:
	* mac/tclMacLoad.c:
	* win/tclWinLoad.c: modified to move more functionality
	to the generic code and avoid duplication.  Partial replacement
	of internal uses of clientData with opaque Tcl_LoadHandle.  A
	little further work still needed, but significant changes are done.

2002-07-17  D. Richard Hipp    <drh@@hwaci.com>

	* library/msgcat/msgcat.tcl: fix a comment that was causing
	problems for programs (ex: mktclapp) that embed the initialization
	scripts in strings.
d1323 3
a1325 1
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d1327 3
a1329 23
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c: removing the now redundant functions to access
	indexed variables: Tcl(Get|Set|Incr)IndexedScalar() and
	Tcl(Get|Set|Incr)ElementOfIndexedArray(). 

2002-07-17  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclExecute.c (TclExecuteByteCode): Minor fixes to make
	this file compile with SunPro CC...

2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: modified to do variable lookup explicitly,
	and then either inlining the variable access or else calling the new
	TclPtr(Set|Get|Incr)Var functions in tclVar.c
	* generic/tclInt.h: declare some functions previously local to
	tclVar.c for usage by TEBC.
	* generic/tclVar.c: removed local declarations; moved all special
	accessor functions for indexed variables to the end of the file -
	they are unused and ready for removal, but left there for the time
	being as they are in the internal stubs table.
d1331 1
a1331 4
	** WARNING FOR BYTECODE MAINTAINERS **
	TCL_COMPILE_DEBUG is currently not functional; will be fixed ASAP.
	
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d1333 1
a1333 3
	* unix/Makefile.in:
	* win/Makefile.in: Add a more descriptive warning
	in the event `make genstubs` needs to be rerun.
d1335 2
a1336 1
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d1338 4
a1341 6
	* unix/Makefile.in: Use dltest.marker file
	to keep track of when the dltest package
	is up to date. This fixes [Tcl bug 575768]
	since tcltest is no longer linked every time.
	* unix/dltest/Makefile.in: Create ../dltest.marker
	after a successful `make all` run in dltest.
d1343 1
a1343 1
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d1345 2
a1346 2
	* unix/configure: Regen.
	* unix/configure.in: Remove useless subst of TCL_BIN_DIR.
d1348 2
a1349 1
2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d1351 1
a1351 3
	* generic/tclVar.c: inaccurate comment fixed
	
2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d1353 1
a1353 24
	* generic/tclBasic.c (Tcl_AddObjErrorInfo):
	* generic/tclExecute.c (TclUpdateReturnInfo):
	* generic/tclInt.h:	
	* generic/tclProc.c: 
	Added two Tcl_Obj to the ExecEnv structure to hold the fully
	qualified names "::errorInfo" and "::errorCode" to cache the
	addresses of the corresponding variables. The two most frequent
	setters of these variables now profit from the new variable name
	caching. 

2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclVar.c: refactorisation to reuse already looked-up Var
	pointers; definition of three new Tcl_Obj types to cache variable
	name parsing and lookup for later reuse; modification of internal
	functions to profit from the caching. 
	
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclNamesp.c: adding CONST qualifiers to variable names
	passed to Tcl_FindNamespaceVar and to variable resolvers; adding
	CONST qualifier to the 'msg' argument to TclLookupVar. Needed to
	avoid code duplication in the new tclVar.c code.
d1355 3
a1357 3
	* tests/set-old.test:
	* tests/var.test: slight modification of error messages due to the
	modifications in the tclVar.c code.
d1359 1
a1359 1
2002-07-15  Don Porter  <dgp@@users.sourceforge.net>
d1361 3
a1363 2
	* tests/unixInit.test:	Improved constraints to protect /tmp.	
	  [Bug 581403]
d1365 2
a1366 1
2002-07-15  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1368 8
a1375 10
	* tests/winFCmd.test: renamed 'win2000' and 'notWin2000' to
	more appropriate constraint names.
	* win/tclWinFile.c: updated comments to reflect 07-11 changes.
	* win/tclWinFCmd.c: made ConvertFileNameFormat static again,
	since no longer used in tclWinFile.c
	* mac/tclMacFile.c: completed TclpObjLink implementation which
	was previously lacking.
	* generic/tclIOUtil.c: comment cleanup and code speedup.
	
2002-07-14  Don Porter  <dgp@@users.sourceforge.net>
d1377 1
a1377 5
	* generic/tclInt.h:	Removed declarations that duplicated entries
	  in the (internal) stub table.
	
	* library/tcltest/tcltest.tcl:  Corrected errors in handling of
	  configuration options -constraints and -limitconstraints.
d1379 2
a1380 7
	* README:		Bumped HEAD to version 8.4b2 so we can
	* generic/tcl.h:	distinguish it from the 8.4b1 release.
	* tools/tcl.wse.in:
	* unix/configure*:
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure*:
d1382 5
a1386 1
2002-07-11  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1388 2
a1389 6
	* doc/file.n:
	* win/tclWinFile.c: on Win 95/98/ME the long form of the path
	is used as a normalized form.  This is required because short
	forms are not a robust representation.  The file normalization
	function has been sped up, but more performance gains might be
	possible, if speed is still an issue on these platforms.
d1391 4
a1394 1
2002-07-11  Don Porter  <dgp@@users.sourceforge.net>
d1396 1
a1396 2
	* library/tcltest/tcltest.tcl: Corrected reaction to existing but
	false ::tcl_interactive.
d1398 3
a1400 1
	* doc/Hash.3: Overlooked CONST documentation update.
d1402 2
a1403 1
2002-07-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d1405 1
a1405 3
	* generic/tclCkalloc.c: ckalloc() and friends take the block size
	as an unsigned, so we should use %ud when reporting it in fprintf()
	and panic().
d1407 10
a1416 1
2002-07-11  Miguel Sofer  <msofer@@users.sourceforge.net>
d1418 1
a1418 4
	* generic/tclCompile.c: now setting local vars undefined at
	compile time, instead of waiting until the proc is initialized. 
	* generic/tclProc.c: use macro TclSetVarUndefined instead of
	directly etting the flag.
d1420 1
a1420 1
2002-07-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d1422 4
a1425 2
	* tests/cmdAH.test: [file attr -perm] is Unix-only, so add [catch]
	when not inside a suitably-protected test.
d1427 2
a1428 1
2002-07-10  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d1430 1
a1430 4
	* tests/unixFCmd.test, tests/fileName.test: 
	* tests/fCmd.test: Removed [exec] of Unix utilities that have
	equivalents in standard Tcl.  [Bug 579268]  Also simplified some
	of unixFCmd.test while I was at it.
d1432 2
a1433 1
2002-07-10  Don Porter  <dgp@@users.sourceforge.net>
d1435 3
a1437 4
	* tests/tcltest.test:  Greatly reduced the number of [exec]s, using
	slave interps instead.
	* library/tcltest/tcltest.tcl:  Fixed bug uncovered in the conversion
	where a message was written to stdout instead of [outputChannel].
d1439 1
a1439 15
	* tests/basic.test:	Cleaned up, constrained, and reduced the
	* tests/compile.test:	amount of [exec] usage in the test suite.
	* tests/encoding.test:
	* tests/env.test:
	* tests/event.test:
	* tests/exec.test:
	* tests/io.test:
	* tests/ioCmd.test:
	* tests/regexp.test:
	* tests/regexpComp.test:
	* tests/socket.test:
	* tests/tcltest.test:
	* tests/unixInit.test:
	* tests/winDde.test:
	* tests/winPipe.test:
d1441 3
a1443 1
2002-07-10  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d1445 1
a1445 1
	* tests/cmdAH.test: Removed [exec] of Unix utilities. [Bug 579211]
d1447 7
a1453 3
	* tests/expr.test: Added tests to make sure that this works.
	* generic/tclExecute.c (ExprCallMathFunc): Functions should also
	be able to return wide-ints.  [Bug 579284]
d1455 1
a1455 1
2002-07-08  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d1457 3
a1459 4
	* tests/socket.test: Fixed bug #578164. The original reason for
	  the was a DNS outage while running the testsuite. Changed [info
	  hostname] to 127.0.0.1 to bypass DNS, knowing that we operate on
	  the local host.
d1461 3
a1463 1
2002-07-08  Don Porter  <dgp@@users.sourceforge.net>
d1465 1
a1465 3
	* doc/tcltest.n:		Fixed incompatibility in [viewFile].
	* library/tcltest/tcltest.tcl:	Corrected docs.  Bumped to 2.2.1.
	* library/tcltest/pkgIndex.tcl: [Bug 578163]
d1467 5
a1471 1
2002-07-08  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1473 1
a1473 59
	* tests/cmdAH.test:
	* tests/fCmd.test:
	* tests/fileName.test: tests which rely on 'file link' need a
	constraint so they don't run on older Windows OS. [Bug 578158]
	* generic/tclIOUtil.c:
	* generic/tcl.h:
	* generic/tclInt.h:
	* generic/tclTest.c:
	* mac/tclMacChan.c:
	* unix/tclUnixChan.c:
	* win/tclWinChan.c:
	* doc/FileSystem.3: cleaned up internal handling of
	Tcl_FSOpenFileChannel to remove duplicate code, and make
	writing external vfs's clearer and easier.  No
	functionality change.  Also clarify that objects with refCount
	zero should not be passed in to the Tcl_FS API, and prevent
	segfaults from occuring on such user errors. [Bug 578617]
	
2002-07-06  Don Porter  <dgp@@users.sourceforge.net>

	* tests/pkgMkIndex.test:  Constrained tests of [load] package indexing
	to those platforms where the testing shared libraries have been built.
	[Bug 578166].

2002-07-05  Don Porter  <dgp@@users.sourceforge.net>
	* changes: added recent changes

2002-07-05  Reinhard Max  <max@@suse.de>

	* generic/tclClock.c (FormatClock): Convert the format string to
	UTF8 before calling TclpStrftime, so that non-ASCII characters
	don't get mangled when the result string is being converted back.
	* tests/clock.test: Added a test for that.

2002-07-05  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/Makefile.in (ro-test,ddd,GDB,DDD): Created new targets to
	allow running the test suite with a read-only current directory,
	running under ddd instead of gdb, and factored out some executable
	names for broken sites (like mine) where gdb and ddd are installed
	with non-standard names...

	* tests/httpold.test: Altered test names to httpold-* to avoid
	clashes with http.test, and stopped tests from failing when the
	current directory is not writable...

	* tests/event.test:		Stop these tests from failing
	* tests/ioUtil.test:		when the current directory is
	* tests/regexp.test:		not writable...
	* tests/regexpComp.test: 
	* tests/source.test: 
	* tests/unixFile.test: 
	* tests/unixNotfy.test: 

	* tests/unixFCmd.test:		Trying to make these test-files
	* tests/macFCmd.test:		not bomb out with an error when
	* tests/http.test:		the current directory is not
	* tests/fileName.test:		writable...
	* tests/env.test:
d1475 9
a1483 1
2002-07-05  Jeff Hobbs  <jeffh@@ActiveState.com>
d1485 4
a1488 1
	*** 8.4b1 TAGGED FOR RELEASE ***
d1490 5
a1494 1
2002-07-04  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d1496 1
a1496 3
	* tests/cmdMZ.test (cmdMZ-1.4): 
	* tests/cmdAH.test: More fixing of writable-current-dir
	assumption. [Bug 575824]
d1498 6
a1503 1
2002-07-04  Miguel Sofer  <msofer@@users.sourceforge.net>
d1505 1
a1505 3
	* tests/basic.test: Same issue as below; fixed [Bug 575817]
	
2002-07-04  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d1507 5
a1511 4
	* tests/socket.test: 
	* tests/winPipe.test: 
	* tests/pid.test: Fixed SF Bug #575848. See below for a
	  description the general problem.
d1513 1
a1513 2
	* All the bugs below are instances of the same problem: The
	  testsuite assumes [pwd] = [temporaryDirectory] and writable.
d1515 3
a1517 4
	* tests/iogt.test: Fixed bug #575860.
	* tests/io.test:   Fixed bug #575862.
	* tests/exec.test: 
	* tests/ioCmd.test: Fixed bug #575836.
d1519 2
a1520 1
2002-07-03  Don Porter  <dgp@@users.sourceforge.net>
d1522 3
a1524 4
	* tests/pkg1/direct1.tcl: removed
	* tests/pkg1/pkgIndex.tcl: removed
	* tests/pkgMkIndex.test:  Imported auxilliary files from tests/pkg1
	  into the test file pkgMkIndex.test itself.  Formatting fixes.
d1526 2
a1527 1
	* unix/Makefile.in: removed tests/pkg/* from `make dist`
d1529 1
a1529 20
	* tests/pkg/circ1.tcl: removed
	* tests/pkg/circ2.tcl: removed
	* tests/pkg/circ3.tcl: removed
	* tests/pkg/global.tcl: removed
	* tests/pkg/import.tcl: removed
	* tests/pkg/pkg1.tcl: removed
	* tests/pkg/pkg2_a.tcl: removed
	* tests/pkg/pkg2_b.tcl: removed
	* tests/pkg/pkg3.tcl: removed
	* tests/pkg/pkg4.tcl: removed
	* tests/pkg/pkg5.tcl: removed
	* tests/pkg/pkga.tcl: removed
	* tests/pkg/samename.tcl: removed
	* tests/pkg/simple.tcl: removed
	* tests/pkg/spacename.tcl: removed
	* tests/pkg/std.tcl: removed
	* tests/pkgMkIndex.test: Fixed [Bug 575857] where this test file
	  expected to be able to write to [file join [testsDirectory]
	  pkg].  Part of the fix was to import several auxilliary files
	  into the test file itself.
d1531 1
a1531 2
	* tests/main.test:	Cheap fix for [Bugs 575851, 575858].  Avoid
	* tests/tcltest.test:	non-writable . by [cd [temporaryDirectory]].
d1533 4
a1536 3
	* library/auto.tcl: Fix [tcl_findLibrary] to be sure it sets
	  $varName only if a successful library script is found.
	  [Bug 577033]
d1538 1
a1538 1
2002-07-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d1540 1
a1540 3
	* generic/tclCompCmds.c (TclCompileCatchCmd): return
	  TCL_OUT_LINE_COMPILE instead of TCL_ERROR: let the failure
	  happen at runtime so that it can be caught [Bug 577015].
d1542 2
a1543 1
2002-07-02  Joe English  <jenglish@@users.sourceforge.net>
d1545 1
a1545 1
	* doc/tcltest.n: Markup fixes, spellcheck.
d1547 1
a1547 1
2002-07-02  Don Porter  <dgp@@users.sourceforge.net>
d1549 1
a1549 1
	* doc/tcltest.n: more refinements of the documentation.
d1551 1
a1551 2
	* library/tcltest/tcltest.tcl: Added trace to be sure the stdio
	  constraint is updated whenever the [interpreter] changes.
d1553 4
a1556 6
	* doc/tcltest.n:		Reverted [makeFile] and [viewFile] to
	* library/tcltest/tcltest.tcl:	their former behavior, and documented
	* tests/cmdAH.test:		it.  Corrected misspelling of hook
	* tests/event.test:		procedure.  Restored tests.
	* tests/http.test:
	* tests/io.test:
d1558 1
a1558 3
	* library/tcltest/tcltest.tcl: Simplified logic of
	  [GetMatchingFiles] and [GetMatchingDirectories], removing
	  special case processing.
d1560 4
a1563 2
	* doc/tcltest.n: More documentation updates.  Reference sections
	  are complete.  Only examples need adding.
d1565 2
a1566 1
2002-07-02  Vince Darley  <vincentdarley@@users.sourceforge.net>
d1568 1
a1568 3
	* tests/fCmd.test: 
	* generic/tclCmdAH.c: clearer error msgs for 'file link',
	as per the man page.
d1570 1385
a2954 1
2002-07-01  Joe English  <jenglish@@users.sourceforge.net>
a2955 16
	* doc/Access.3:
	* doc/AddErrInfo.3:
	* doc/Alloc.3:
	* doc/Backslash.3:
	* doc/CrtChannel.3:
	* doc/CrtSlave.3:
	* doc/Encoding.3:
	* doc/Eval.3:
	* doc/FileSystem.3:
	* doc/Notifier.3:
	* doc/OpenFileChnl.3:
	* doc/ParseCmd.3:
	* doc/RegExp.3:
	* doc/Tcl_Main.3:
	* doc/Thread.3:
	* doc/TraceCmd.3:
d2957 228
a3184 8
	* doc/WrongNumArgs.3:
	* doc/binary.n:
	* doc/clock.n:
	* doc/expr.n:
	* doc/fconfigure.n:
	* doc/glob.n:
	* doc/http.n:
	* doc/interp.n:
d3186 562
a3747 9
	* doc/lset.n:
	* doc/msgcat.n:
	* doc/packagens.n:
	* doc/pkgMkIndex.n:
	* doc/registry.n:
	* doc/resource.n:
	* doc/safe.n:
	* doc/scan.n:
	* doc/tclvars.n:  Spell-check, fixed typos (Updates from Larry Virden).
d3749 3
a3751 1
2002-07-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3753 1
a3753 5
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Made Solaris use gcc for linking
	when building with gcc to resolve problems with undefined symbols
	being present when tcl library used with non-gcc linker at later
	stage. Symbols were compiler-generated, so it is the compiler's
	business to define them. [Bug #541181] 
d3755 5
a3759 1
2002-07-01  Don Porter  <dgp@@users.sourceforge.net>
d3761 1
a3761 1
	* doc/tcltest.n: more work in progress updating tcltest docs.
d3763 2
a3764 4
	* library/tcltest/tcltest.tcl: Change [configure -match] to
	stop treating an empty list as a list of the single pattern "*".
	Changed the default value to [list *] so default operation
	remains the same.
d3766 2
a3767 1
	* tests/pkg/samename.tcl: restored.  needed by pkgMkIndex.test.
d3769 4
a3772 2
	* library/tcltest/tcltest.tcl: restored writeability testing of
	-tmpdir, augmented by a special exception for the deafault value.
d3774 2
a3775 1
2002-07-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3777 1
a3777 1
	* doc/concat.n: Documented the *real* behaviour of [concat]!
d3779 4
a3782 1
2002-06-30  Don Porter  <dgp@@users.sourceforge.net>
d3784 7
a3790 1
	* doc/tcltest.n: more work in progress updating tcltest docs.
d3792 1
a3792 6
	* tests/README:		Updated the instructions on running and
	* tests/cmdMZ.test:	adding to the test suite.  Also updated
	* tests/encoding.test:	several tests, mostly to correctly create
	* tests/fCmd.test:	and destroy any temporary files in the
	* tests/info.test:	[temporaryDirectory] of tcltest.
	* tests/interp.test:
d3794 1
a3794 54
	* library/tcltest/tcltest.tcl:	Stopped checking for writeability
	of -tmpdir value because no default directory can be guaranteed to
	be writeable.

	* tests/autoMkindex.tcl: removed.
	* tests/pkg/samename.tcl: removed.
	* tests/pkg/magicchar.tcl: removed.
	* tests/pkg/magicchar2.tcl: removed.
	* tests/autoMkindex.test: Updated auto_mkIndex tests to use
	[makeFile] and [removeFile] so tests are done in [temporaryDirecotry]
	where write access is guaranteed.

	* library/tcltest/tcltest.tcl:	Fixed [makeFile] and [viewFile] to
	* tests/cmdAH.test:		accurately reflect a file's contents.
	* tests/event.test:		Updated tests that depended on buggy
	* tests/http.test:		behavior.  Also added warning messages
	* tests/io.test:		to "-debug 1" operations to debug test
	* tests/iogt.test:		calls to (make|remove)(File|Directory).

	* unix/mkLinks: `make mklinks` on 6-27 commits.

2002-06-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.h: modified the macro TclEmitPush to not
	call its first argument repeatedly or pass it to other macros,
	[Bug 575194] reported by Peter Spjuth.

2002-06-28  Don Porter  <dgp@@users.sourceforge.net>

	* docs/tcltest.n:	Doc revisions in progress.
	* library/tcltest/tcltest.tcl: Corrected -testdir default value.
	Was not reliable, and disagreed with docs!  Thanks to Hemang Lavana.
	[Bug 575150]

2002-06-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tclUnixThrd.c:	Renamed the Tcl_Platform* #defines to
	* unix/tclUnixPipe.c:	TclOS* because they are only used
	* unix/tclUnixFile.c:	internally.  Also stopped double-#def
	* unix/tclUnixFCmd.c:	of TclOSlstat [Bug #566099, post-rename]
	* unix/tclUnixChan.c:
	* unix/tclUnixPort.h:

	* doc/string.n: Improved documentation for [string last] along
	lines described in Bug #574799 so it indicates that the supplied
	index marks the end of the search space.

2002-06-27  Don Porter  <dgp@@users.sourceforge.net>

	* doc/dde.n:		Work in progress updating the documentation
	* doc/http.n:		of the packages that come bundled with
	* doc/msgcat.n:		the Tcl source distribution, notably tcltest.
	* doc/registry.n:
	* doc/tcltest.n:
d3796 2
a3797 2
	* library/tcltest/tcltest.tcl:  Made sure that the TCLTEST_OPTIONS
	environment variablle configures tcltest at package load time.
d3799 3
a3801 1
2002-06-26  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3803 2
a3804 7
	* tests/fileSystem.test: 
	* generic/tclIOUtil.c: fix to handling of empty paths ""
	which are not claimed by any filesystem (Bug #573758).
	Ensure good error messages are given in all cases.
	* tests/cmdAH.test:
	* unix/tclUnixFCmd.c: fix to bug reported as part of
	(Patch #566669).  Thanks to Taguchi, Takeshi for the report.
d3806 1
a3806 1
2002-06-26  Reinhard Max  <max@@suse.de>
d3808 21
a3828 2
	* unix/tclUnixTime.c: Make [clock format] respect locale settings.
	* tests/clock.test:   Bug #565880. ***POTENTIAL INCOMPATIBILITY***
d3830 1
a3830 1
2002-06-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d3832 7
a3838 3
	* doc/CrtInterp.3:
	* doc/StringObj.3: clarifications by Don Porter, bugs #493995 and
	#500930. 
d3840 99
a3938 1
2002-06-24  Don Porter  <dgp@@users.sourceforge.net>
d3940 1
a3940 3
	* library/tcltest/tcltest.tcl:	Corrected suppression of -verbose skip
	* tests/tcltest.test:		and start by [test -output].  Also
	corrected test suite errors exposed by corrected code.  [Bug 564656]
d3942 2
a3943 1
2002-06-25  Reinhard Max  <max@@suse.de>
d3945 3
a3947 4
	* unix/tcl.m4:       New macro SC_CONFIG_MANPAGES.
	* unix/configure.in: Added support for symlinks and compression
	* unix/Makefile.in:  when installing the manpages. [Patch 518052]
	* unix/mkLinks.tcl:  Default is still hardlinks and no compression.
d3949 11
a3959 2
	* unix/mkLinks:      generated
	* unix/configure:
d3961 1
a3961 1
	* unix/README:       Added documentation for the new features.
d3963 4
a3966 2
	* unix/tcl.m4 (SC_PATH_TCLCONFIG): Replaced ${exec_prefix}/lib by
	${libdir}.
d3968 1
a3968 1
2002-06-25  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3970 66
a4035 40
	* generic/tclUtil.c (TclGetIntForIndex): Fix of critical bug
	#533364 generated when the index is bad and the result is a shared
	object.  The T_ASTO(T_GOR, ...) idiom likely exists elsewhere
	though.  Also removed some cruft that just complicated things to
	no advantage.
	(SetEndOffsetFromAny): Same fix, though this wasn't on the path
	excited by the bug.

2002-06-24  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:	Implementation of TIP 101.  Adds
	* tests/parseOld.test:		and exports a [configure] command
	* tests/tcltest.test:		from tcltest.

2002-06-22  Don Porter  <dgp@@users.sourceforge.net>

	* changes: updated changes file for 8.4b1 release.

	* library/tcltest/tcltest.tcl:	Corrections to tcltest and the
	* tests/basic.test:		Tcl test suite so that a test
	* tests/cmdInfo.test:		with options -constraints knownBug
	* tests/compile.test:		-limitConstraints 1 only tests the
	* tests/encoding.test:		knownBug tests.  Mostly involves
	* tests/env.test:		replacing direct access to the
	* tests/event.test:		testConstraints array with calls
	* tests/exec.test:		to the testConstraint command
	* tests/execute.test:		(which requires tcltest version 2)
	* tests/fCmd.test:
	* tests/format.test:
	* tests/http.test:
	* tests/httpold.test:
	* tests/ioUtil.test:
	* tests/link.test:
	* tests/load.test:
	* tests/namespace.test:
	* tests/pkgMkIndex.test:
	* tests/reg.test:
	* tests/result.test:
	* tests/scan.test:
	* tests/stack.test:
d4037 1
a4037 1
2002-06-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4039 39
a4077 3
	* tools/tcl.wse.in (Disk Label), unix/tcl.spec (version): 
	* win/README.binary, README, win/configure.in, unix/configure.in: 
	* generic/tcl.h (TCL_RELEASE_*, TCL_PATCH_LEVEL): Bump to beta1.
d4079 4
a4082 1
2002-06-21  Joe English  <jenglish@@users.sourceforge.net>
d4084 1
a4084 3
	* generic/tclCompExpr.c:
	* generic/tclParseExpr.c: LogSyntaxError() should reset 
	the interpreter result [Bug 550142 "Tcl_ExprObj -> abort"] 
d4086 3
a4088 1
2002-06-21  Don Porter  <dgp@@users.sourceforge.net>
d4090 8
a4097 4
	* unix/Makefile.in:	Updated all package install directories
	* win/Makefile.in:	to match current Major.minor versions
	* win/makefile.bc:	of the packages.  Added tcltest package
	* win/makefile.vc:	to installation on Windows.
d4099 1
a4099 2
	* library/init.tcl:  Corrected comments and namespace style
	issues.  Thanks to Bruce Stephens. [Bug 572025]
d4101 2
a4102 1
2002-06-21  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4104 1
a4104 15
	* tests/cmdAH.test:          Added TIP#99 implementation
	* tests/fCmd.test:           of 'file link'.  Supports creation
	* tests/fileName.test:       of symbolic and hard links in the
	* tests/fileSystem.test:     native filesystems and in vfs's,
	* generic/tclTest.c:         when the individual filesystem
	* generic/tclCmdAH.c:        supports the concept.
	* generic/tclIOUtil.c:       
	* generic/tcl.h:
	* generic/tcl.decls:
	* doc/FileSystem.3:
	* doc/file.n:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: Also enhanced speed of 'file normalize' on
	Windows.
d4106 2
a4107 1
2002-06-20  Miguel Sofer  <msofer@@users.sourceforge.net>
d4109 5
a4113 3
	* generic/tclBasic.c (TclEvalObjvInternal): fix for [Bug 571385]
	in the implementation of TIP#62 (command tracing). Vince Darley,
	Hemang Lavana & Don Porter: thanks.
d4115 5
a4119 1
2002-06-20  Miguel Sofer  <msofer@@users.sourceforge.net>
d4121 1
a4121 2
	* generic/tclExecute.c (TclCompEvalObj): clarified and simplified
	the logic for compilation/recompilation.
d4123 3
a4125 2
2002-06-19  Joe English  <jenglish@@users.sourceforge.net>
	* doc/file.n: Fixed indentation.  No substantive changes.
d4127 3
a4129 1
2002-06-19  Jeff Hobbs  <jeffh@@ActiveState.com>
d4131 11
a4141 3
	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): get the resultPtr again
	as the Tcl_ObjSetVar2 may cause the result to change.
	[Patch #558324] (watson)
d4143 1
a4143 1
2002-06-19  Miguel Sofer  <msofer@@users.sourceforge.net>
d4145 18
a4162 2
	* generic/tclExecute.c (TEBC): removing unused "for(;;)" loop;
	improved comments; re-indentation.
d4164 2
a4165 1
2002-06-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4167 2
a4168 12
	* generic/tclExecute.c (TEBC): 
	- elimination of duplicated code in the non-immediate INST_INCR
	  instructions. 
	- elimination of 103 (!) TclDecrRefCount macros. The different
	  instructions now jump back to a common "DecrRefCount zone" at
	  the top of the loop. The macro "ADJUST_PC" was replaced by two
	  macros "NEXT_INST_F" and "NEXT_INST_V" that take three params
	  (pcAdjustment, # of stack objects to discard, resultObjPtr
	  handling flag). The only instructions that retain a
	  TclDecrRefCount are INST_POP (for speed), the common code for
	  the non-immediate INST_INCR, INST_FOREACH_STEP and the two
	  INST_LSET.
d4170 1
a4170 3
	The object size of tclExecute.o was reduced by approx 20% since
	the start of the consolidation drive, while making room for some
	peep-hole optimisation at runtime.
d4172 18
a4189 1
2002-06-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4191 1
a4191 2
	* generic/tclExecute.c (TEBC, INST_DONE): small bug in the panic
	code for tcl-stack corruption.
d4193 4
a4196 1
2002-06-17  David Gravereaux <davygrvy@@pobox.com>
d4198 5
a4202 2
	Trims to support the removal of RESOURCE_INCLUDED from rc
	scripts	from FR #565088.
d4204 3
a4206 2
	* generic/tcl.h: moved the #ifndef RC_INVOKED start block up in
	the file.  rc scripts don't need to know thread mutexes.
d4208 6
a4213 3
	* win/tcl.rc:
	* win/tclsh.rc: removed the #define RESOURCE_INCLUDED to let the
	built-in -DRC_INVOKED to the work.
d4215 3
a4217 1
2002-06-17  Jeff Hobbs  <jeffh@@ActiveState.com>
d4219 2
a4220 13
	* doc/CrtTrace.3:        Added TIP#62 implementation of command
	* doc/trace.n:           execution tracing [FR #462580] (lavana).
	* generic/tcl.h:         This includes enter/leave tracing as well
	* generic/tclBasic.c:    as inter-procedure stepping.
	* generic/tclCmdMZ.c:
	* generic/tclCompile.c:
	* generic/tclExecute.c:
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c:
	* tests/trace.test:
d4222 5
a4226 1
2002-06-17  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d4228 1
a4228 4
	* win/tclWinPipe.c (BuildCommandLine): Fixed bug #554068 ([exec]
	  on windows did not treat { in filenames well.). Bug reported by
	  Vince Darley <vincentdarley@@users.sourceforge.net>, patch
	  provided by Vince too.
d4230 6
a4235 1
2002-06-17  Joe English  <jenglish@@users.sourceforge.net>
d4237 2
a4238 3
	* generic/tcl.h: #ifdef logic for K&R C backwards compatibility
	changed to assume modern C by default.  See SF FR #565088 for
	full details.
d4240 4
a4243 1
2002-06-17  Don Porter  <dgp@@users.sourceforge.net>
d4245 17
a4261 2
	* doc/msgcat.n: Corrected en_UK references to en_GB.  UK is not
	a country designation recognized in ISO 3166.
d4263 26
a4288 2
	* library/msgcat/msgcat.tcl:  More Windows Registry locale codes
	from Bruno Haible.
d4290 3
a4292 10
	* doc/msgcat.n:
	* library/msgcat/msgcat.tcl:
	* library/msgcat/pkgIndex.tcl:
	* tests/msgcat.test:  Revised locale initialization to interpret
	environment variable locale values according to XPG4, and to
	recognize the LC_ALL and LC_MESSAGES values over that of LANG.
	Also added many Windows Registry locale values to those 
	recognized by msgcat.  Revised tests and docs.  Bumped to
	version 1.3.  Thanks to Bruno Haible for the report and
	assistance crafting the solution.  [Bug 525522, 525525]
d4294 2
a4295 1
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>
d4297 2
a4298 2
	* generic/tclCompile.c (TclCompileTokens): a better algorithm for
	the previous bug fix.
d4300 12
a4311 1
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>
d4313 5
a4317 5
	* generic/tclCompile.c (TclCompileTokens): 
	* tests/compile.test: [Bug 569438] in the processing of dollar
	variables; report by Georgios Petasis. 
	
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>
d4319 7
a4325 4
	* generic/tclExecute.c: bug in the consolidation of the
	INCR_..._STK instructions; the bug could not be exercised as the
	(faulty) instruction INST_INCR_ARRAY_STK was never compiled-in
	(related to [Bug 569438]).
d4327 4
a4330 1
2002-06-14  Miguel Sofer  <msofer@@users.sourceforge.net>
d4332 7
a4338 8
	* generic/tclExecute.c (TclExecuteByteCode): runtime peep-hole
	optimisation of variables (INST_STORE, INST_INCR) and commands
	(INST_INVOKE); faster check for the existence of a catch.
	(TclExecuteByteCode): runtime peep-hole optimisation of
	comparisons.
	(TclExecuteByteCode): runtime peep-hole optimisation of
	INST_FOREACH - relies on peculiarities of the code produced by the
	bytecode compiler.
d4340 3
a4342 1
2002-06-14  David Gravereaux <davygrvy@@pobox.com>
d4344 3
a4346 3
	* win/rules.vc: The test for compiler optimizations was in error.
	Thanks goes to Roy Terry <royterry@@earthlink.net> for his
	assistance with this.
d4348 1
a4348 1
2002-06-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4350 12
a4361 4
	* doc/trace.n, tests/trace.test: 
	* generic/tclCmdMZ.c (Tcl_TraceObjCmd,TclTraceCommandObjCmd)
	(TclTraceVariableObjCmd): Changed references to "trace list" to
	"trace info" as mandated by TIP#102.
d4363 7
a4369 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4371 1
a4371 2
	* generic/tclExecute.c (TclExecuteByteCode): consolidated code for
	the conditional branch instructions.
d4373 1
a4373 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4375 21
a4395 2
	* generic/tclExecute.c (TclExecuteByteCode): fixed the previous
	patch - wouldn't compile with TCL_COMPILE_DEBUG set.
d4397 2
a4398 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4400 10
a4409 4
	* generic/tclExecute.c (TclExecuteByteCode): consolidated the
	handling of exception returns to INST_INVOKE and INST_EVAL, as
	well as most of the code for INST_CONTINUE and INST_BREAK, in the
	new jump target "processExceptionReturn".
d4411 60
a4470 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4472 2
a4473 7
	* generic/tclExecute.c (TclExecuteByteCode): consolidated variable
	handling opcodes, replaced redundant code with some 'goto'. All
	store/append/lappend opcodes on the same data type now share the
	main code; same with incr opcodes.
	* generic/tclVar.c: added the bit TCL_TRACE_READS to the possible
	flags to Tcl_SetVar2Ex - it causes read traces to be fired prior
	to setting the variable. This is used in the core for [lappend].
d4475 1
a4475 6
	***NOTE*** the usage of TCL_TRACE_READS in Tcl_(Obj)?GetVar.* is
	not documented; there, it causes the call to create the variable
	if it does not exist. The new usage in Tcl_(Obj)?SetVar.* remains
	undocumented too ...
	
2002-06-13  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4477 1
a4477 4
	* tests/fCmd.test:
	* tests/winFile.test:
	* tests/fileSystem.test:
	* generic/tclTest.c:
d4479 5
d4485 11
a4495 26
	* doc/FileSystem.3:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: fixed up further so both compiles and
	actually works with VC++ 5 or 6.
	* win/tclWinInt.h: 
	* win/tclWin32Dll.c: cleaned up code and vfs tests and
	added tests for the internal changes of 2002-06-12, to see
	whether WinTcl on NTFS can coexist peacefully with links
	in the filesystem.  Added new test command 'testfilelink'
	to enable the newer code to be tested.
	* tests/fCmd.test: (made certain tests of 'testfilelink' not
	run on unix).

2002-06-12  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tclBasic.c (Tcl_DeleteTrace): fixed [Bug 568123] (thanks to
	Hemang Lavana)
	
2002-06-12  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinFile.c: corrected the symbolic link handling code to
	allow it to compile.  Added real definition of REPARSE_DATA_BUFFER
	(found in winnt.h).  Most of the added definitions appear to have
	correct, cross-Win-version equivalents in winnt.h and should be
	removed, but just making things "work" for now.
d4497 1
a4497 1
2002-06-12  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4499 1
a4499 7
	* generic/tclIOUtil.c:
	* generic/tcl.decls:
	* generic/tclDecls.h: made code for Tcl_FSNewNativePath
	agree with man pages.
	
	* doc/FileSystem.3: clarified the circumstances under which
	certain functions are called in the presence of symlinks.
d4501 3
a4503 11
	* win/tclWinFile.c:
	* win/tclWinPort.h: 
	* win/tclWinInt.h: 
	* win/tclWinFCmd.c:  Fix for Windows to allow 'file lstat', 
	'file type', 'glob -type l', 'file copy', 'file delete', 
	'file normalize', and all VFS code to work correctly in the 
	presence of symlinks (previously Tcl's behaviour was not very 
	well defined).  This also fixes possible serious problems in 
	all versions of WinTcl where 'file delete' on a NTFS symlink 
	could delete the original, not the symlink.
	Note: symlinks cannot yet be created in pure Tcl.
d4505 1
a4505 21
2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c: 
	* generic/tclCompCmds.c:
	* generic/tclInt.h: reverted the new compilation functions;
	replaced by a more general approach described below.

	* generic/tclCompCmds.c:
	* generic/tclCompile.c: made *all* compiled variable access
	attempts create an indexed variable - even get or incr without
	previous set. This allows indexed access to local variables that
	are created and set at runtime, for example by [global], [upvar],
	[variable], [regexp], [regsub].

2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/global.n:
	* doc/info.n:
	* test/info.test:
	* generic/tclCmdIL.c: fix for [Bug 567386], [info locals] was
	reporting some linked variables.
d4507 1
a4507 6
	* generic/tclBasic.c: 
	* generic/tclCompCmds.c:
	* generic/tclInt.h: added compile functions for [global],
	[variable] and [upvar]. They just declare the new local variables,
	the commands themselves are not compiled-in. This gives a notably
	faster read access to these linked variables.
d4509 1
a4509 1
2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>
d4511 2
a4512 2
	* generic/tclExecute.c: optimised algorithm for exception range
	lookup; part of [Patch 453709].
d4514 2
a4515 1
2002-06-10  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4517 1
a4517 6
	* unix/tclUnixFCmd.c: fixed [Bug #566669]
	* generic/tclIOUtil.c: improved and sped up handling of
	native paths (duplication and conversion to normalized paths),
	particularly on Windows.
	* modified part of above commit, due to problems on Linux. 
	Will re-examine bug report and evaluate more closely.
d4519 1
a4519 1
2002-06-07  Don Porter  <dgp@@users.sourceforge.net>
d4521 1
a4521 2
	* tests/tcltest.test:  More corrections to test suite so that tests
	of failing [test]s don't show up themselves as failing tests.
d4523 2
a4524 1
2002-06-07  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4526 1
a4526 4
	* generic/tclExecute.c: Tidied up headers in relation to float.h
	to cut the cruft and ensure DBL_MAX is defined since doubles seem
	to be the same size everywhere; if the assumption isn't true, the
	variant platforms had better have run configure...
d4528 1
a4528 7
	* unix/tclUnixPort.h (EOVERFLOW): Added code to define it if it
	wasn't previously defined.  Also some other general tidying and
	adding of comments.  [Tcl bugs 563122, 564595]
	* compat/tclErrno.h: Added definition for EOVERFLOW copied from
	Solaris headers; I've been unable to find any uses of EFTYPE,
	which was the error code previously occupying the slot, in Tcl, or
	any definition of it in the Solaris headers.
d4530 7
a4536 1
2002-06-06  Mo DeJong  <mdejong@@users.sourceforge.net>
d4538 1
a4538 3
	* unix/dltest/Makefile.in: Remove hard coded CFLAGS=-g
	and add CFLAGS_DEBUG, CFLAGS_OPTIMIZE, and
	CFLAGS_DEFAULT varaibles. [Tcl bug 565488]
d4540 3
a4542 1
2002-06-06  Don Porter  <dgp@@users.sourceforge.net>
d4544 1
a4544 2
	* tests/tcltest.test:  Corrections to test suite so that tests
	of failing [test]s don't show up themselves as failing tests.
d4546 9
a4554 2
	* tests/io.test: Fixed up namespace variable resolution issues
	revealed by running test suite with "-singleproc 1".
d4556 1
a4556 46
	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test: Several updates to tcltest.
	  1) changed to lazy initialization of test constraints
	  2) deprecated [initConstraintsHook]
	  3) repaired badly broken [limitConstraints].
	  4) deprecated [threadReap] and [mainThread]
	[Patch 512214, Bug 558742, Bug 461000, Bug 534903]

2002-06-06  Daniel Steffen  <das@@users.sourceforge.net>

	* unix/tclUnixThrd.c (TclpReaddir, TclpLocaltime, TclpGmtime):
	added mutex wrapped calls to readdir, localtime & gmtime in
	case their thread-safe *_r counterparts are not available.
	* unix/tcl.m4: added configure check for readdir_r
	* unix/tcl.m4 (Darwin): set TCL_DEFAULT_ENCODING to utf-8 on
	MacOSX (where posix file apis expect utf-8, not iso8859-1).   
	* unix/configure: regen
	* unix/Makefile.in: set DYLD_LIBRARY_PATH in parallel       
	to LD_LIBRARY_PATH for MacOSX dynamic linker.
	* generic/tclEnv.c (TclSetEnv): fix env var setting on
	MacOSX (adapted from patch #524352 by jkbonfield).

2002-06-05  Don Porter  <dgp@@users.sourceforge.net>

	* doc/Tcl_Main.3: Documented $tcl_rcFileName and added more
	clarifications about the intended use of Tcl_Main(). [Bug 505651]

2002-06-05  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclFileName.c (TclGlob): mac specific fix to
	recent changes in 'glob -tails' handling.
	* mac/tclMacPort.h:
	* mac/tclMacChan.c: fixed TIP#91 bustage.
	* mac/tclMacResource.c (Tcl_MacConvertTextResource): added utf
	conversion of text resource contents.
	* tests/macFCmd.test (macFCmd-1.2): allow CWIE creator.

2002-06-04  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:
	* tests/init.test:
	* tests/tcltest.test:	Added more TIP 85 tests from Arjen Markus.
	Converted tcltest.test to use a private namespace.  Fixed bugs in
	[tcltest::Eval] revealed by calling [tcltest::test] from a non-global
	namespace, and namespace errors in init.test.
d4558 6
a4563 1
2002-06-04  Mo DeJong  <mdejong@@users.sourceforge.net>
d4565 2
a4566 1
	* win/README: Update msys+mingw URL.
d4568 10
a4577 1
2002-06-03  Don Porter  <dgp@@users.sourceforge.net>
d4579 2
a4580 8
	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* library/tcltest/pkgIndex.tcl:
	* tests/tcltest.test:  Implementation of TIP 85.  Allows tcltest
	users to add new legal values of the -match option to [test],
	associating each with a Tcl command that does the matching of
	expected results with actual results of tests.  Thanks to
	Arjen Markus.  => tcltest 2.1 [Patch 521362]
d4582 1
a4582 1
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d4584 1
a4584 2
	* doc/namespace.n: added description of [namepace forget]
	behaviour for unqualified patterns [Bug 559268]
d4586 2
a4587 1
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d4589 3
a4591 4
	* generic/tclExecute.c: reverting an accidental modification in
	the last commit.
	
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d4593 1
a4593 2
	* doc/Tcl.n: clarify the empty variable name issue ([Bug 549285]
	reported by Tom Krehbiel, patch by Don Porter).
d4595 2
a4596 1
2002-05-31  Don Porter  <dgp@@users.sourceforge.net>
d4598 1
a4598 2
	* library/package.tcl:  Fixed leak of slave interp in [pkg_mkIndex].
	Thanks to Helmut for report.  [Bug 550534]
d4600 3
a4602 3
	* tests/io.test:
	* tests/main.test:  Use the "stdio" constraint to control whether
	an [open "|[interpreter]"] is attempted.
d4604 1
a4604 67
	* generic/tclExecute.c (TclMathInProgress,TclExecuteByteCode
		ExprCallMathFunc):
	* generic/tclInt.h (TclMathInProgress):
	* unix/Makefile.in (tclMtherr.*):
	* unix/configure.in (NEED_MATHERR):
	* unix/tclAppInit.c (matherr):
	* unix/tclMtherr.c (removed file):
	* win/tclWinMtherr.c (_matherr): Removed internal routine
	TclMathInProgress and Unix implementation of matherr().  These
	are now obsolete, dealing with very old versions of the C math
	library.  Windows version is retained in case Borland compilers
	require it, but it is inactive.  Thanks to Joe English.
	[Bug 474335, Patch 555635].
	* unix/configure: regen

2002-05-30  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompExpr.c:
	* generic/tclCompile.c:
	* generic/tclCompile.h: removed exprIsJustVarRef and
	exprIsComparison from the ExprInfo and CompileEnv structs. These
	were set, but not used since dec 1999 [Bug 562383].

2002-05-30  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c (TclGlob): fix to longstanding
	'knownBug' in fileName tests 15.2-15.4, and fix to a new
	Tcl 8.4 bug in certain uses of 'glob -tails'.
	* tests/fileName.test: removed 'knownBug' flag from some tests,
	added some new tests for above bugs.
	
2002-05-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure: regen'ed
	* unix/configure.in: replaced bigendian check with autoconf
	standard AC_C_BIG_ENDIAN, which defined WORDS_BIGENDIAN on
	bigendian systems.
	* generic/tclUtf.c (Tcl_UniCharNcmp): 
	* generic/tclInt.h (TclUniCharNcmp): use WORDS_BIGENDIAN instead of
	TCL_OPTIMIZE_UNICODE_COMPARE to enable memcmp alternative.

	* generic/tclExecute.c (TclExecuteByteCode INST_STR_CMP):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): changed the case for
	choosing the Tcl_UniCharNcmp compare to when both objs are of
	StringType, as benchmarks show that is the optimal check (both
	bigendian and littleendian systems).

2002-05-29  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclMain.c: Removed "dummy" reference to Tcl_LinkVar.
	It is no longer needed since Tcl_Main() now actually calls
	Tcl_LinkVar().  Thanks to Joe English for pointing that out.

2002-05-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclExecute.c (TclExecuteByteCode): 
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): Use the macro version.
	* generic/tclInt.h (TclUniCharNcmp): Optimised still further with
	a macro for use in sensitive places like tclExecute.c

	* generic/tclUtf.c (Tcl_UniCharNcmp): Use new flag to figure out
	when we can use an optimal comparison scheme, and default to the
	old scheme in other cases which is at least safe.
	* unix/configure.in (TCL_OPTIMIZE_UNICODE_COMPARE): New optional
	flag that indicates when we can use memcmp() to compare Unicode
	strings (i.e. when the high-byte of a Tcl_UniChar precedes the
	low-byte.)
d4606 1
a4606 1
2002-05-29  Jeff Hobbs  <jeffh@@ActiveState.com>
d4608 3
a4610 21
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclUtf.c: added TclpUtfNcmp2 private command that
	mirrors Tcl_UtfNcmp, but takes n in bytes, not utf-8 chars.  This
	provides a faster alternative for comparing utf strings	internally.
	(Tcl_UniCharNcmp, Tcl_UniCharNcasecmp): removed the explicit end
	of string check as it wasn't correct for the function (by doc and
	logic).

	* generic/tclCmdMZ.c (Tcl_StringObjCmd): reworked the string equal
	comparison code to use TclpUtfNcmp2 as well as short-circuit for
	equal objects or unequal length strings in the equal case.
	Removed the use of goto and streamlined the other parts.

	* generic/tclExecute.c (TclExecuteByteCode): added check for
	object equality in the comparison instructions.  Added
	short-circuit for != length strings in INST_EQ, INST_NEQ and
	INST_STR_CMP.  Reworked INST_STR_CMP to use TclpUtfNcmp2 where
	appropriate, and only use Tcl_UniCharNcmp when at least one of the
	objects is a Unicode obj with no utf bytes.
d4612 1
a4612 2
	* generic/tclCompCmds.c (TclCompileStringCmd): removed error
	creation in code that no longer throws an error.
d4614 2
a4615 2
	* tests/string.test:
	* tests/stringComp.test: added more string comparison checks.
d4617 2
a4618 1
	* tests/clock.test: better qualified 9.1 constraint check for %s.
d4620 2
a4621 1
2002-05-28  Jeff Hobbs  <jeffh@@ActiveState.com>
d4623 1
a4623 2
	* generic/tclThreadAlloc.c (TclpRealloc, TclpFree): protect
	against the case when NULL is based.
d4625 1
a4625 67
	* tests/clock.test: added clock-9.1
	* compat/strftime.c:
	* generic/tclClock.c:
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* unix/tclUnixTime.c: fix for Windows msvcrt mem leak caused by
	using an env(TZ) setting trick for in clock format -gmt 1.  This
	also makes %s seem to work correctly with -gmt 1 as well as
	making it a lot faster by avoid the env(TZ) hack.  TclpStrftime
	now takes useGMT as an arg.  [Bug #559376]

2002-05-28  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclIOUtil.c: fixes to Tcl_FSLoadFile when called on
	a file inside a vfs.  This should avoid leaving temporary 
	files sitting around on exit. [Bug #545579]
	
2002-05-27  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* win/tclWinError.c: Added comment on conversion of
	ERROR_NEGATIVE_SEEK because that is a mapping that really belongs,
	and not a catch-all case.
	* win/tclWinPort.h (EOVERFLOW): Should be either EFBIG or EINVAL
	* generic/tclPosixStr.c (Tcl_ErrnoId, Tcl_ErrnoMsg): EOVERFLOW can
	potentially be a synonym for EINVAL.

2002-05-24  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	=== Changes due to TIP#91 ===

	* win/tclWinPort.h: Added declaration of EOVERFLOW.
	* doc/CrtChannel.3: Added documentation of wideSeekProc.
	* generic/tclIOGT.c (TransformSeekProc, TransformWideSeekProc):
	Adapted to use the new channel mechanism.
	* unix/tclUnixChan.c (FileSeekProc, FileWideSeekProc): Renamed
	FileSeekProc to FileWideSeekProc and created new FileSeekProc
	which has the old-style interface and which errors out with
	EOVERFLOW when the returned file position can't fit into the
	return type (int for historical reasons.)
	* win/tclWinChan.c (FileSeekProc, FileWideSeekProc): Renamed
	FileSeekProc to FileWideSeekProc and created new FileSeekProc
	which has the old-style interface and which errors out with
	EOVERFLOW when the returned file position can't fit into the
	return type (int for historical reasons.)
	* mac/tclMacChan.c (FileSeek): Reverted to old interface; Macs
	lack large-file support because I can't see how to add it.
	* generic/tclIO.c (Tcl_Seek, Tcl_Tell): Given these functions
	knowledge of the new arrangement of channel types.
	(Tcl_ChannelVersion): Added recognition of new version code.
	(HaveVersion): New function to do version checking.
	(Tcl_ChannelBlockModeProc, Tcl_ChannelFlushProc)
	(Tcl_ChannelHandlerProc): Made these functions use HaveVersion for
	ease of future maintainability.
	(Tcl_ChannelBlockModeProc): Obvious lookup function.
	* generic/tcl.h (Tcl_ChannelType): New wideSeekProc field, and
	seekProc type restored to old interpretation.
	(TCL_CHANNEL_VERSION_3): New channel version.

2002-05-24  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
	
	* tests/winPipe.test: Applied patch for SF Tcl Bug #549617. Patch
	  and bug report by Kevin Kenny <kennykb@@users.sourceforge.net>.

	* win/tclWinSock.c (TcpWatchProc): Fixed SF Tcl Bug #557878. We
	  are not allowed to mess with the watch mask if the socket is a
	  server socket. I believe that the original reporter is George
	  Peter Staplin.
d4627 2
a4628 1
2002-05-21  Mo DeJong  <mdejong@@users.sourceforge.net>
d4630 1
a4630 7
	* unix/configure: Regen.
	* unix/configure.in: Invoke SC_ENABLE_SHARED before
	calling SC_CONFIG_CFLAGS so that the SHARED_BUILD
	variable can be checked inside SC_CONFIG_CFLAGS.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Pass -non_shared
	instead of -shared to ld when configured with
	--disable-shared under OSF. [Tcl bug 540390]
d4632 2
a4633 1
2002-05-20  Daniel Steffen  <das@@users.sourceforge.net>
d4635 1
a4635 3
	* generic/tclInt.h: added prototype for TclpFilesystemPathType().
	* mac/tclMacChan.c: use MSL provided creator type if available
	instead of the default 'MPW '.
d4637 2
a4638 1
2002-05-16  Joe English  <jenglish@@users.sf.net>
d4640 1
a4640 3
	* doc/CrtObjCmd.3: 
	Added Tcl_GetCommandFromObj, Tcl_GetCommandFullName
	(Tcl Bug #547987, #414921)
d4642 4
a4645 1
2002-05-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4647 1
a4647 3
	* unix/tclUnixChan.c (TtyOutputProc): #if/#endif-ed this function
	out to stop compiler warnings.  Also much general tidying of
	comments in this file and removal of whitespace from blank lines.
d4649 3
a4651 1
2002-05-13  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4653 1
a4653 4
	* unix/tclUnixChan.c (SETBREAK): Solaris thinks ioctl() takes a
	signed second argument, and Linux thinks ioctl() takes an unsigned
	second argument.  So need a longer definition of this macro to get
	neither to spew warnings...
d4655 3
a4657 1
2002-05-13  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4659 1
a4659 8
	* generic/tclEvent.c: 
	* generic/tclIOUtil.c:
	* generic/tclInt.h: clean up all memory allocated by the
	filesystem, via introduction of 'TclFinalizeFilesystem'.
	Move TclFinalizeLoad into TclFinalizeFilesystem so we can
	be sure it is called at just the right time.
	Fix bad comment also.  [Bug #555078 and 'fs' part of #543549]
	* win/tclWinChan.c: fix comment referring to wrong function.
d4661 1
a4661 1
2002-05-10  Don Porter  <dgp@@users.sourceforge.net>
d4663 4
a4666 5
	* tests/load.test:
	* tests/safe.test:
	* tests/tcltest.test: Corrected some list-quoting issues and
	other matters that cause tests to fail when the patch includes
	special characters.  Report from Vince Darley.  [Bug 554068].
d4668 1
a4668 1
2002-05-08    David Gravereaux <davygrvy@@pobox.com>
d4670 3
a4672 15
	* doc/file.n:
	* tools/man2tcl.c:
	* tools/man2help2.tcl:  Thanks to Peter Spjuth
	<peter.spjuth@@space.se>, again.  My prior fix for
	single-quote macro mis-understanding was wrong.	 Reverted to
	reimpliment the 'macro2' proc which handles single-quote macros
	and restored file.n text arrangement to avoid single-quotes on
	the first line.  Sorry for all the confusion.

2002-05-08  David Gravereaux <davygrvy@@pobox.com>

	* tools/man2tcl.c:
	* tools/man2help2.tcl: Proper source of macro error mis-
	understanding single-quote as the leading macro command found
	and repaired.
d4674 1
a4674 2
	* doc/file.n: Reverted to prior state before I messed with
	it.
d4676 2
a4677 1
2002-05-08  Don Porter  <dgp@@users.sourceforge.net>
d4679 1
a4679 17
	* library/tcltest/tcltest.tcl: Corrected [uplevel] quoting when
	[source]-ing test script in subdirectories.
	* tests/fileName.test:
	* tests/load.test:
	* tests/main.test:
	* tests/tcltest.test: 
	* tests/unixInit.test: Fixes to test suite when there's a space
	in the working path.  Thanks to Kevin Kenny.

2002-05-07  David Gravereaux <davygrvy@@pobox.com>

	-- Changes from Peter Spjuth <peter.spjuth@@space.se>
	* tools/man2tcl.c: Increased line buffer size and a bail-out if
	that should ever be over-run.
	* tools/man2help.tcl: Include Courier New font in rtf header.
	* tools/man2help2.tcl: Improved handling of CS/CE fields.  Use
	Courier New for code samples and indent better.
d4681 3
a4683 5
	* doc/file.n:
	* doc/TraceCmd.3:  winhelp conversion tools where understanding
	a ' as the first character on a line to be an unknown macro.
	Not knowing how to repair tools/man2tcl.c, I decided to rearrange
	the text in the docs instead.
d4685 1
a4685 1
2002-05-07  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4687 6
a4692 40
	* generic/tclFileName.c: fix to similar segfault when using 
	'glob -types nonsense -dir dirname -join * *'. [Bug 553320]
	
	* doc/FileSystem.3: further documentation on vfs.
	* tests/cmdAH.test:
	* tests/fileSystem.test:
	* tests/pkgMkindex.test: Fix to testsuite bugs when running out
	of directory whose name contains '{' or '['.

2002-05-07  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/basic.test: Fix for [Bug 549607]
	* tests/encoding.test: Fix for [Bug 549610]
	These are testsuite bugs that caused failures when the filename
	contained spaces. Report & fix by Kevin Kenny.

2002-05-02  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c: fix to freeing a bad object 
	(i.e. segfault) when using 'glob -types nonsense -dir dirname'.
	* generic/tclWinFile.c: fix to [Bug 551306], also wrapped some 
	long lines.
	* tests/fileName.test: added several tests for the above bugs.
	* doc/FileSystem.3: clarified documentation on refCount
	requirements of the object returned by the path type function.
	* generic/tclIOUtil.c:
	* win/tclWinFile.c:
	* unix/tclUnixFile.c:
	* mac/tclMacFile.c: moved TclpFilesystemPathType to the
	platform specific directories, so we can add missing platform-
	specific implementations.  On Windows, 'file system' now returns 
	useful results like "native NTFS", "native FAT" for that system.  
	Unix and MacOS still only return "native".
	* doc/file.n: clarified documentation.
	* tests/winFile.test: test for 'file system' returning correct
	values.
	* tests/fileSystem.test: test for 'file system' returning correct
	values.  Clean up after failed previous test run.
	
2002-04-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d4694 1
a4694 3
	* unix/configure:
	* unix/tcl.m4: change HP-11 SHLIB_LD_LIBS from "" to ${LIBS} so
	that the .sl knows its dependent libs.
d4696 2
a4697 1
2002-04-26  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4699 1
a4699 4
	* tests/obj.test (obj-11.[56]): Test conversion to boolean more
	thoroughly.
	* generic/tclObj.c (SetBooleanFromAny): Was not calling an integer
	parsing function on native 64-bit platforms!  [Bug 548686]
d4701 7
a4707 1
2002-04-24  Jeff Hobbs  <jeffh@@ActiveState.com>
d4709 1
a4709 3
	* generic/tclInt.h: corrected TclRememberJoinableThread decl to
	use VOID instead of void.
	* generic/tclThreadJoin.c: noted that this code isn't needed on Unix.
d4711 2
a4712 1
2002-04-23  Jeff Hobbs  <jeffh@@ActiveState.com>
d4714 1
a4714 2
	* doc/exec.n: 
	* doc/tclvars.n: doc updates [Patch #509426] (gravereaux)
d4716 2
a4717 1
2002-04-24  Daniel Steffen  <das@@users.sourceforge.net>
d4719 1
a4719 4
	* mac/tclMacResource.r: added check of
	TCLTK_NO_LIBRARY_TEXT_RESOURCES #define to allow disabling the
	inclusion of the tcl library code in the resource fork of Tcl
	executables and shared libraries.
d4721 1
a4721 1
2002-04-23  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4723 1
a4723 2
	* doc/TraceCmd.3: New file that documents Tcl_CommandTraceInfo,
	Tcl_TraceCommand and Tcl_UntraceCommand [Bug 414927]
d4725 1
a4725 1
2002-04-22  Jeff Hobbs  <jeffh@@ActiveState.com>
d4727 1
a4727 17
	* generic/tclAlloc.c:
	* generic/tclInt.h:
	* generic/tclThreadAlloc.c (new):
	* unix/Makefile.in:
	* unix/tclUnixThrd.c:
	* win/Makefile.in:
	* win/tclWinInt.h:
	* win/tclWinThrd.c: added new threaded allocator contributed by
	AOL that significantly reduces lock contention when multiple
	threads are in use.  Only Windows and Unix implementations are
	ready, and the Windows one may need work.  It is only used by
	default on Unix for now, and requires that USE_THREAD_ALLOC be
	defined (--enable-threads on Unix will define this).

	* generic/tclIOUtil.c (Tcl_FSRegister, Tcl_FSUnregister):
	corrected calling of Tcl_ConditionWait to ensure that there would
	be a condition to wait upon.
d4729 1
a4729 1
	* generic/tclCmdAH.c (Tcl_FileObjCmd): added cast in FILE_SIZE.
d4731 1
a4731 2
	* win/tclWinFCmd.c (DoDeleteFile): check return of setattr API
	calls in file deletion for correct Win32 API handling.
d4733 3
a4735 2
	* win/Makefile.in: correct dependencies for shell, gdb, runtest
	targets.
d4737 1
a4737 19
	* doc/clock.n:
	* compat/strftime.c (_fmt): change strftime to correctly handle
	localized %c, %x and %X on Windows.  Added some notes about how
	the other values could be further localized.

2002-04-19  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclMain.c (Tcl_Main):  Free the memory allocated for the
	startup script path.  [Bug 543549]

	* library/msgcat/msgcat.tcl:  [mcmax] wasn't using the caller's
	namespace when determining the max translated length.  Also
	made revisions for better use of namespace variables and more
	efficient [uplevel]s.

	* doc/msgcat.n:
	* library/msgcat/msgcat.tcl:
	* library/msgcat/pkgIndex.tcl:  Added [mcload] to the export list
	of msgcat; bumped to 1.2.3.  [Bug 544727]
d4739 1
a4739 1
2002-04-20  Daniel Steffen  <das@@users.sourceforge.net>
d4741 2
a4742 17
	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacUtil.c: Modified TclpObjNormalizePath to be alias
	file aware, and replaced various calls to FSpLocationFrom*Path
	by calls to new alias file aware versions FSpLLocationFrom*Path.
	The alias file aware routines don't resolve the last component of
	a path if it is an alias. This allows [file copy/delete] etc. to
	act correctly on alias files. (c.f. discussion in Bug #511666)

2002-04-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/lindex.test (lindex-3.7): 
	* generic/tclUtil.c (TclGetIntForIndex): Stopped indexes from
	hitting wide ints.  [Bug #526717]
d4744 1
a4744 1
2002-04-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4746 4
a4749 3
	* generic/tclNamesp.c:
	* tests/info.test: [Bug 545325] info level didn't report
	namespace eval, bug report by Richard Suchenwirth.
d4751 1
a4751 1
2002-04-18  Don Porter  <dgp@@users.sourceforge.net>
d4753 10
a4762 3
	* doc/subst.n:  Clarified documentation on handling unusual return
	codes during substitution, and on variable substitutions implied
	by command substitution, and vice versa.  [Bug 536838]
d4764 1
a4764 1
2002-04-18  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4766 3
a4768 3
	* generic/tclCmdIL.c (InfoBodyCmd): 
	* tests/info.test (info-2.6): Proc bodies without string reps
	would report as empty [Bug #545644]
d4770 3
a4772 4
	* generic/tclCmdMZ.c (Tcl_SubstObj): More clarification for
	comment on behaviour when substitutions are not well-formed,
	prompted by [Bug #536831]; alas, removing the ill-defined
	behaviour is a lot of work.
d4774 5
a4778 1
2002-04-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4780 7
a4786 4
	* generic/tclExecute.c:
	* tests/expr-old.test: fix for [Bug #542588] (Phil Ehrens), where
	"too large integers" were reported as "floating-point value" in
	[expr] error messages.
d4788 1
a4788 1
2002-04-17  Jeff Hobbs  <jeffh@@ActiveState.com>
d4790 3
a4792 4
	* generic/tclEncoding.c (EscapeFromUtfProc): 
	* generic/tclIO.c (WriteChars, Tcl_Close): corrected the handling
	of outputting end escapes for escape-based encodings.
	[Bug #526524] (yamamoto)
d4794 3
a4796 1
2002-04-17  Don Porter  <dgp@@users.sourceforge.net>
d4798 1
a4798 4
	* doc/tcltest.n:  Removed [saveState] and [restoreState] from
	tcltest 2 documentation, effectively deprecating them.  [Bug 495660]
	* library/tcltest/tcltest.tcl: Made separate export for commands
	kept only for tcltest 1 compatibility.
d4800 2
a4801 3
	* tests/iogt.test: Revised to run tests in a namespace, rather than
	use the useless and buggy [saveState] and [restoreState] commands
	of tcltest.  Updated to use tcltest 2 as well.  [Patch 544911]
d4803 4
a4806 1
2002-04-16  Don Porter  <dgp@@users.sourceforge.net>
d4808 1
a4808 3
	* tests/io.test: Revised to run tests in a namespace, rather than
	use the useless and buggy [saveState] and [restoreState] commands
	of tcltest.  Updated to use tcltest 2 as well.  [Patch 544546]
d4810 3
a4812 1
2002-04-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d4814 1
a4814 4
	* generic/tclProc.c:
	* tests/proc-old.test: Improved stack trace for TCL_BREAK and
	TCL_CONTINUE returns from procs. Patch by Don Porter
	[Bug 536955]. 
d4816 25
a4840 4
	* generic/tclExecute.c:
	* tests/compile.test: made bytecodes check for a catch before
	  returning; the compiled [return] is otherwise non-catchable. 
	  [Bug 542142] reported by Andreas Kupries.
d4842 1
a4842 1
2002-04-15  Don Porter  <dgp@@users.sourceforge.net>
d4844 1
a4844 2
	* tests/socket.test:  Increased timeout values so that tests have
	time to successfully complete even on slow/busy machines.  [Bug 523470]
d4846 3
a4848 41
	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test:  Revised [tcltest::test] to return errors
	when called with invalid syntax and to accept exactly two arguments
	as documented.  Improved error messages.  [Bug 497446, Patch 513983]
	***POTENTIAL INCOMPATIBILITY***: Incompatible with previous
	tcltest 2.* releases, found only in alpha releases of Tcl 8.4.

2002-04-11  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclNotify.c (TclFinalizeNotifier): remove remaining
	unserviced events on finalization.

	* win/tcl.m4: Enabled COFF as well as CV style debug info with
	--enable-symbols to allow Dr. Watson users to see function info.
	More info on debugging levels can be obtained at:
	http://msdn.microsoft.com/library/en-us/dnvc60/html/gendepdebug.asp

	* tests/ioCmd.test: fixed iocmd-8.15 to have mac and unixPc variants.

	* generic/tclParse.c (Tcl_ParseVar): conditionally incr obj
	refcount to prevent possible mem leak.

2002-04-08  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tcl.h: no <sys/types.h> on mac.
	* mac/tclMacFile.c: minor fixes to Vince's changes from 03-24.
	* mac/tclMacOSA.c:
	* mac/tclMacResource.c: added missing Tcl_UtfToExternalDString
	conversions of resource file names.
	* mac/tclMacSock.c (TcpGetOptionProc): fixed bug introduced
	by Andreas on 02-25; changed strcmp's to strncmp's so that
	option comparison behaves like on other platforms.
	* mac/tcltkMacBuildSupport.sea.hqx (CW Pro6 changes): added
	support to allow Tk to hookup C library stderr/stdout to TkConsole.
	* tests/basic.test:
	* tests/cmdAH.test:
	* tests/encoding.test:
	* tests/fileSystem.test:
	* tests/ioCmd.test: fixed tests failing on mac: check for 
	existence of [exec], changed some result strings.
d4850 1
a4850 1
2002-04-06  Jeff Hobbs  <jeffh@@ActiveState.com>
d4852 2
a4853 5
	* unix/tclUnixFCmd.c (Realpath): added a little extra code to
	initialize a realpath arg when compiling in PURIFY mode in order
	to prevent spurious purify warnings.  We should really create our
	own realpath implementation, but this will at least quiet purify
	for now.
d4855 1
a4855 1
2002-04-05  Don Porter  <dgp@@users.sourceforge.net>
d4857 3
a4859 5
	* generic/tclCmdMZ.c (Tcl_SubstObj):
	* tests/subst.test:  Corrected [subst] so that return codes
	TCL_BREAK and TCL_CONTINUE returned by variable substitution
	have the same effect as when those codes are returned by command
	substitution.  [Bug 536879]
d4861 1
a4861 1
2002-04-03  Jeff Hobbs  <jeffh@@ActiveState.com>
d4863 1
a4863 2
	* library/tcltest/tcltest.tcl: added getMatchingFiles back (alias
	to GetMatchingFiles), which was a public function in tcltest 1.0.
d4865 1
a4865 1
2002-04-01  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4867 2
a4868 48
	* generic/tclEnv.c:
	* generic/tclIOUtil.c: invalidate filesystem cache when the
	user changes env(HOME).  Fixes [Bug #535621].  Also cleaned up
	some of the documentation.
	* tests/fileSystem.test: added test for bug just fixed.
	
2002-04-01  Kevin Kenny  <kennykb@@acm.org>

	* win/tclWinTime.c (Tcl_GetTime): made the checks of clock
	frequency more permissive to cope with the fact that Win98SE
	is observed to return 1.19318 in place of 1.193182 for the
	performance counter frequency.
	
2002-03-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclCmdMZ.c (Tcl_TraceObjCmd, TraceVarProc)
	(TraceCommandProc, TclTraceCommandObjCmd):  corrected
	potential double-free of traces on variables by flagging in
	Trace*Proc that it will free the var in case the eval wants to
	delete the var trace as well. [Bug #536937]
	Also converted Tcl_UntraceVar -> Tcl_UntraceVar2 and Tcl_Eval to
	Tcl_EvalEx in Trace*Proc for slight efficiency improvement.

2002-03-29  Don Porter  <dgp@@users.sourceforge.net>

	* doc/AllowExc.3:
	* generic/tclBasic.c (Tcl_EvalObjv,Tcl_EvalEx,Tcl_EvalObjEx):
	* generic/tclCompile.h (TclCompEvalObj):
	* generic/tclExecute.c (TclCompEvalObj,TclExecuteByteCode):
	* tests/basic.test: Corrected problems with Tcl_AllowExceptions
	having influence over the wrong scope of Tcl_*Eval* calls.  Patch
	from Miguel Sofer.  Report from Jean-Claude Wippler.  [Bug 219181]

2002-03-28  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclVar.c: Refactored CallTraces to collect repeated
	handling of its returned value into CallTraces itself.

2002-03-28  David Gravereaux <davygrvy@@pobox.com>

	* tools/feather.bmp:
	* tools/man2help.tcl:
	* tools/man2help2.tcl:
	* win/makefile.vc: More winhelp target fixups.  Added a feather
	bitmap to the non-scrollable area and changed the color to be
	yellow from a plain white.  The colors can be whatever we want
	them to be, but thought I would start with something bold.
	[Bug 527941]
d4870 4
a4873 3
	* doc/SetVar.3:
	* doc/TraceVar.3:
	* doc/UpVar.3:  .AP macro syntax repair.
d4875 1
a4875 1
2002-03-27  David Gravereaux <davygrvy@@pobox.com>
d4877 2
a4878 25
	* tools/man2help.tcl:
	* win/makefile.vc:  winhelp target now copies all needed files
	from tools/ to a workarea under $(OUT_DIR) and builds it from
	there.  No build cruft is left in tools/ anymore.  All paths
	used in man2help.tcl are now relative to where the script is.
	[Bug 527941]

2002-03-27  David Gravereaux <davygrvy@@pobox.com>

	* win/.cvsignore:
	* win/buildall.vc.bat:
	* win/coffbase.txt:
	* win/makefile.vc:
	* win/nmakehlp.c (new):
	* win/rules.vc:  First draft fix for [Bug 527941].  More changes
	need to done to the makehelp target to get to stop leaving build
	files in the tools/ directory.  This does not address the syntax
	errors in the man files.  Having the contents of tcl.hpj(.in)
	inside makefile.vc allows for version numbers to be replaced with
	macros.
	
	The new nmakehlp.c is built by rules.vc in preprocessing and removes
	the need to use tricky shell syntax that wasn't compatible on Win9x
	systems.  Clean targets made Win9x complient.  This is a first draft
	repair for [Bug 533862].
d4880 1
a4880 1
2002-03-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d4882 4
a4885 2
	* generic/tclBasic.c (Tcl_EvalEx): passing the correct commandSize
	to TclEvalObjvInternal. [Bug 219362], fix by David Knoll.
d4887 1
a4887 1
2002-03-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d4889 4
a4892 3
	* generic/tclBasic.c (Tcl_EvalEx):
	* tests/basic.test: avoid exceptional returns at level 0 
	[Bug 219181] 
d4894 2
a4895 1
2002-03-27  Don Porter  <dgp@@users.sourceforge.net>
d4897 1
a4897 5
	* doc/tcltest.n ([mainThread]):
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test:  Major code cleanup to deal with whitespace,
	coding conventions, and namespace issues, with several minor bugs
	fixed in the process.
d4899 2
a4900 1
	* tests/main.test: Added missing [after cancel]s.
d4902 2
a4903 1
2002-03-25  Don Porter  <dgp@@users.sourceforge.net>
d4905 1
a4905 1
	* tests/main.test: Removed workarounds for Bug 495977.
d4907 2
a4908 8
	* library/tcltest/tcltest.tcl:  Keep the value of $::auto_path
	unchanged, so that the tcltest package can test code that depends
	on auto-loading.  If a testing application needs $::auto_path pruned,
	it should do that itself.  [Bug 495726]
	Improve the processing of the -constraints option to [test] so that
	constraint lists can have arbitrary whitespace, and non-lists don't
	blow things up.  [Bug 495977]
	Corrected faulty variable initialization. [Bug 534845]
d4910 7
a4916 1
2002-03-25  Miguel Sofer  <msofer@@users.sourceforge.net>
d4918 1
a4918 3
	* doc/CrtTrace.3: small doc correction
	* generic/tclBasic.c (Tcl_DeleteTrace): Allow NULL callback on
	trace deletions [Bug 534728] (Hemang Lavana).
d4920 2
a4921 1
2002-03-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d4923 2
a4924 2
	* generic/tclBasic.c (Tcl_EvalObjv): replaced obscure, incorrect
	code as described in [Bug 533907] (Don Porter).
d4926 1
a4926 1
2002-03-24  Don Porter  <dgp@@users.sourceforge.net>
d4928 3
a4930 2
	* library/tcltest/tcltest.tcl:  Use [interpreter] to set/query the
	executable currently running the tcltest package.  [Bug 454050]
d4932 2
a4933 2
	* library/tcltest/tcltest.tcl:  Allow non-proc commands to be used
	as the customization hooks.  [Bug 495662]
d4935 2
a4936 1
2002-03-24  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4938 1
a4938 53
	* generic/tclFilename.c:
	* generic/tclFCmd.c:
	* generic/tclTest.c:
	* generic/tcl.h:
	* generic/tclIOUtil.c:
	* win/tclWinFile.c:
	* win/tclWinFCmd.c:
	* win/tclWinPipe.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixFCmd.c:
	* mac/tclMacFile.c:
	* doc/FileSystem.3:
	* doc/file.n:
	* tests/cmdAH.test:
	* tests/fileName.test:
	* tests/fileSystem.test: (new file)	
	* tests/winFCmd.test: fix [Bug 511666] and [Bug 511658],
	and improved documentation of some aspects of the filesystem,
	particularly 'Tcl_FSMatchInDirectory' which now might match
	a single file/directory only, and 'file normalize' which
	wasn't very clear before.  Removed inconsistency betweens
	docs and the Tcl_Filesystem structure.  Also fixed 
	[Bug 523217] and corrected file normalization on Unix so that 
	it expands symbolic links.  Added some new tests of the 
	filesystem code (in the new file 'fileSystem.test'), and 
	some extra tests for correct handling of symbolic links.
	Fix to [Bug 530960] which shows up on Win98.  Made comparison
	with ".com" case insensitive in tclWinPipe.c
	
	***POTENTIAL INCOMPATIBILITY***: But only between alpha
	releases (users of the new Tcl_Filesystem lookup table in Tcl
	8.4a4 need to handle the new way in which Tcl may call
	Tcl_FSMatchInDirectory, and 'file normalize' on unix now
	behaves correctly).  Only known impact is with the 'tclvfs'
	extension.

2002-03-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/basic.test (basic-46.1): adding test for [Bug 533758],
	fixed earlier today.
	
2002-03-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinInt.h: moved undef of TCL_STORAGE_CLASS. [Bug #478579]

2002-03-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_EvalObjEx):
	* generic/tclExecute.c (TclCompEvalObj): fixed the errorInfo for
	return codes other than (TCL_OK, TCL_ERROR) to runLevel 0 
	[Bug 533758]. Removed the static RecordTracebackInfo(), as its
	functionality is easily replicated by Tcl_LogCommandInfo. Bug
	and redundancy noted by Don Porter.
d4940 2
a4941 1
2002-03-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4943 5
a4947 1
	* doc/expr.n: Improved documentation for ceil and floor [Bug 530535]
d4949 1
a4949 1
2002-03-20  Don Porter  <dgp@@users.sourceforge.net>
d4951 24
a4974 21
	* doc/SetVar.3:
	* doc/TraceVar.3:
	* doc/UpVar.3:
	* generic/tcl.h (Tcl_VarTraceProc):
	* generic/tcl.decls (Tcl_GetVar2, Tcl_SetVar2, Tcl_TraceVar2,
	  Tcl_UnsetVar2, Tcl_UntraceVar2, Tcl_UpVar2, Tcl_VarTraceInfo2,
	  Tcl_GetVar2Ex, TclSetVar2Ex):
	* generic/tclCmdMZ.c (TraceVarProc):
	* generic/tclEnv.c (EnvTraceProc):
	* generic/tclEvent.c (VwaitVarProc):
	* generic/tclInt.decls (TclLookupVar,TclPrecTraceProc):
	* generic/tclLink.c (LinkTraceProc):
	* generic/tclUtil.c (TclPrecTraceProc):
	* generic/tclVar.c (CallTraces, MakeUpvar, VarErrMsg, TclLookupVar,
	  Tcl_GetVar2, Tcl_SetVar2, Tcl_TraceVar2, Tcl_UnsetVar2,
	  Tcl_UntraceVar2, Tcl_UpVar2, Tcl_VarTraceInfo2, Tcl_GetVar2Ex,
	  TclSetVar2Ex): Updated interfaces of generic/tclVar.c according
	to TIP 27.  In particular, the "part2" arguments were CONSTified.
	[Patch 532642]
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs
d4976 3
a4978 1
2002-03-15  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4980 1
a4980 3
	* tests/compile.test (compile-12.3): Test to detect bug 530320.
	* generic/tclCompile.c (TclCompileTokens): Fixed buffer overrun
	reported in bug 530320.
d4982 2
a4983 1
2002-03-14  Mo DeJong  <mdejong@@users.sourceforge.net>
d4985 2
a4986 12
	* win/configure: Regen.
	* win/configure.in: Add configure time test for SEH
	support in the compiler.
	* win/tclWin32Dll.c (ESP, EBP, TclpCheckStackSpace,
	_except_checkstackspace_handler):
	* win/tclWinChan.c (ESP, EBP, Tcl_MakeFileChannel,
	_except_makefilechannel_handler):
	* win/tclWinFCmd.c (ESP, EBP, DoRenameFile,
	_except_dorenamefile_handler,
	DoCopyFile, _except_docopyfile_handler):
	Implement SEH support under gcc using inline asm.
	Tcl and Tk should now compile with Mingw 1.1. [Patch 525746]
d4988 1
a4988 1
2002-03-14  Mo DeJong  <mdejong@@users.sourceforge.net>
d4990 2
a4991 6
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile): Handle
	an SEH exception with EXCEPTION_EXECUTE_HANDLER instead
	of restarting the faulting instruction with
	EXCEPTION_CONTINUE_EXECUTION. Bug 466102 provides an
	example of how restarting could send Tcl into an
	infinite loop. [Patch 525746]
d4993 1
a4993 1
2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d4995 3
a4997 4
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile, DoDeleteFile,
	DoRemoveJustDirectory): Make sure we don't pass NULL or ""
	as a path name to Win32 API functions since this was
	crashing under Windows 98.
d4999 2
a5000 1
2002-03-11  Don Porter  <dgp@@users.sourceforge.net>
d5002 1
a5002 2
	* library/tcltest/tcltest.tcl:
	* library/tcltest/pkgIndex.tcl: Bumped tcltest package to 2.0.2.
d5004 3
a5006 1
2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d5008 1
a5008 3
	* library/tcltest/tcltest.tcl (getMatchingFiles): Pass
	a proper list to foreach to avoid munging a Windows
	patch like D:\Foo\Bar into D:FooBar before the glob.
d5010 7
a5016 1
2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d5018 1
a5018 6
	* generic/tclEncoding.c: Fix typo in comment.
	* generic/tclIO.c (DoReadChars, ReadBytes, ReadChars):
	Use NULL value instead of pointer set to NULL to make
	things more clear. Reorder arguments so that they
	match the function signatures. Cleanup little typos
	and add more descriptive comment.
d5020 6
a5025 1
2002-03-08  Mo DeJong  <mdejong@@users.sourceforge.net>
d5027 1
a5027 4
	* win/README: Update to indicate that Mingw 1.1 is
	required to build Tcl. Add section describing new
	msys based build process. Update Cygwin build
	instructions so users know where to find Mingw 1.1.
d5029 1
a5029 1
2002-03-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d5031 8
a5038 1
	* win/tclWinFCmd.c (DoCopyFile): correctly set retval to TCL_OK.
d5040 1
a5040 1
2002-03-07  Mo DeJong  <mdejong@@users.sourceforge.net>
d5042 3
a5044 5
	* win/tclWin32Dll.c (TclpCheckStackSpace):
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile): Replace
	hard coded constants with Win32 symbolic names.
	Move control flow statements out of __try blocks
	since the documentation indicates it is frowned upon.
d5046 1
a5046 1
2002-03-07  Don Porter  <dgp@@users.sourceforge.net>
d5048 2
a5049 6
	* doc/interp.n:
	* generic/tclInterp.c(Tcl_InterpObjCmd,SlaveObjCmd,SlaveRecursionLimit):
	* generic/tclTest.c:
	* tests/interp.test: Added the [interp recursionlimit] command to
	set/query the recursion limit of an interpreter.  Proposal and
	implementation from Stephen Trier. [TIP 87, Patch 522849]
d5051 1
a5051 1
2002-03-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5053 1
a5053 5
	* generic/tcl.h, tools/tcl.wse.in, unix/configure.in,
	* unix/tcl.spec, win/README.binary, win/configure.in, README:
	Bumped patchlevel; this might need to change in the future, but it
	will help us distinguish between the CVS version and the most
	recent released version.
d5055 2
a5056 1
2002-03-06  Miguel Sofer  <msofer@@users.sourceforge.net>
d5058 1
a5058 3
	* generic/tclInt.h: for unshared objects, TclDecrRefCount now
	frees the internal rep before the string rep - just like the
	non-macro Tcl_DecrRefCount/TclFreeObj [Bug 524802]. 
d5060 3
a5062 1
2002-03-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5064 1
a5064 4
	* doc/lsearch.n: Documentation of new features, plus examples.
	* tests/lsearch.test: Tests of new features.
	* generic/tclCmdIL.c (Tcl_LsearchObjCmd): TIP#80 support.  See
	http://purl.org/tcl/tip/80 for details.
d5066 2
a5067 1
2002-03-05  Jeff Hobbs  <jeffh@@ActiveState.com>
d5069 9
a5077 1
	*** 8.4a4 TAGGED FOR RELEASE ***
d5079 1
a5079 4
	* unix/tclUnixChan.c: initial remedy for [Bug #525783] flush
	problem introduced by TIP #35.  This may not satisfy true serial
	channels, but it restores the correct flushing of std* channels on
	exit.
d5081 9
a5089 1
	* unix/README: added --enable-langinfo doc.
d5091 1
a5091 2
	* unix/tcl.spec:
	* tools/tcl.wse.in: fixed URL refs to use www.tcl.tk or SF.
d5093 1
a5093 1
2002-03-04  Jeff Hobbs  <jeffh@@ActiveState.com>
d5095 1
a5095 6
	* README:
	* mac/README:
	* unix/Makefile.in:
	* unix/README:
	* win/README:
	* win/README.binary: updated to use www.tcl.tk URL.
d5097 3
a5099 1
	* unix/Makefile.in: added older ChangeLogs to dist target.
d5101 1
a5101 7
	* tests/io.test:
	* tests/encoding.test: corrected iso2022 encoding results.
	added encoding-24.*
	* generic/tclEncoding.c (EscapeFromUtfProc): corrected output of
	escape codes as per RFC 1468. [Patch #474358] (taguchi)
	(TclFinalizeEncodingSubsystem): corrected potential double-free
	when encodings were finalized on exit. [Bug #219314, #524674]
d5103 2
a5104 1
2002-03-01  Jeff Hobbs  <jeffh@@ActiveState.com>
d5106 1
a5106 5
	* library/encoding/iso2022-jp.enc: 
	* library/encoding/iso2022.enc: 
	* tools/encoding/iso2022-jp.esc:
	* tools/encoding/iso2022.esc: gave <ESC>$B precedence over <ESC>$@@,
	based on comments (point 1) in [Bug #219283] (rfc 1468)
d5108 16
a5123 5
	* tests/encoding.test: added encoding-23.* tests
	* generic/tclIO.c (FilterInputBytes): reset the TCL_ENCODING_START
	flags in the ChannelState when using 'gets'. [Bug #523988]
	Also reduced the value of ENCODING_LINESIZE from 30 to 20 as this
	seems to improve the performance of 'gets' according to tclbench.
d5125 1
a5125 1
2002-02-28  Jeff Hobbs  <jeffh@@ActiveState.com>
d5127 2
a5128 3
	* generic/tclCmdMZ.c (TraceCommandProc): ensure that TraceCommandInfo
	structure was also deleted when a command was deleted to prevent a
	mem leak.
d5130 1
a5130 2
	* generic/tclBasic.c (Tcl_CreateObjTrace): set tracePtr->flags
	correctly.
d5132 1
a5132 2
	* generic/tclTimer.c (TimerExitProc): remove remaining events in
	tls on thread exit.
d5134 1
a5134 1
2002-02-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d5136 3
a5138 3
	* generic/tclNamesp.c: allow cached fully-qualified namespace
	names to be usable from different namespaces within the same
	interpreter without forcing a new lookup [Patch 458872]. 
d5140 1
a5140 1
2002-02-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d5142 1
a5142 2
	* generic/tclExecute.c: Replaced a few direct stack accesses 
	with the POP_OBJECT() macro [Bug 507181] (Don Porter).
d5144 1
a5144 1
2002-02-27  Don Porter  <dgp@@users.sourceforge.net>
d5146 1
a5146 8
	* doc/GetIndex.3:
	* generic/tcl.decls (Tcl_GetIndexFromObjStruct):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObjStruct):  Revised the
	prototype of the Tcl_GetIndexFromObjStruct to take its struct
	table as a (CONST VOID *) argument, better describing what it is,
	maintaining source compatibility, and adding CONST correctness
	according to TIP 27.  Thanks to Joe English for an elegant
	solution. [Bug 520304]
d5148 1
a5148 1
	* generic/tclDecls.h: make genstubs
d5150 1
a5150 3
	* generic/tclMain.c (Tcl_Main,StdinProc):  Corrected some reference
	count management errors on the interactive command Tcl_Obj found by
	Purify.  Thanks to Jeff Hobbs for the report and assistance.
d5152 1
a5152 1
2002-02-27  Jeff Hobbs  <jeffh@@ActiveState.com>
d5154 3
a5156 2
	* generic/tclBasic.c (Tcl_EvalTokensStandard): corrected mem leak
	in error case.
d5158 1
a5158 1
	* generic/tclTest.c (TestStatProc[123]): correct harmless UMRs.
d5160 2
a5161 1
	* generic/tclLink.c (Tcl_LinkVar): correct mem leak in error case.
d5163 1
a5163 1
2002-02-27  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5165 2
a5166 3
	* tests/socket.test (2.7): Accepted and applied patch for Tcl SF
	  bug #523470 provided by Don Porter <dgp@@users.sourceforge.net>
	  to avoid timing problems in that test.
d5168 1
a5168 8
	* unix/tclUnixChan.c (TclpOpenFileChannel): Added code to regonize
	  "/dev/tty" (by name) and to not handle it as tty / serial
	  line. This is the controlling terminal and is special. Setting
	  it into raw mode as is done for other tty's is a bad idea. This
	  is a hackish fix for expect SGF Bug #520624. The fix has
	  limitation: Tcl_MakeFileChannel handles tty's specially too, but
	  is unable to recognize /dev/tty as it only gets a file
	  descriptor, and no name for it.
d5170 1
a5170 1
2002-02-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d5172 1
a5172 1
	* generic/tclCmdAH.c (StoreStatData): corrected mem leak.
d5174 2
a5175 2
	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): prevent obj leak in
	  remedial regsub case.
d5177 1
a5177 2
	* generic/tclFileName.c (Tcl_TranslateFileName): decr refcount for
	  error case to prevent mem leak.
d5179 1
a5179 1
	* generic/tclVar.c (Tcl_ArrayObjCmd): removed extra obj allocation.
d5181 2
a5182 3
	* unix/tclUnixSock.c (Tcl_GetHostName): added an extra
	  gethostbyname check to guard against failure with truncated
	  names returned by uname.
d5184 1
a5184 3
	* unix/configure:
	* unix/tcl.m4 (SC_SERIAL_PORT): added sys/modem.h check and defined
	  _XOPEN_SOURCE_EXTENDED for HP-11 to get updated header decls.
d5186 2
a5187 2
	* unix/tclUnixChan.c: added Unix implementation of TIP #35, serial
	  port support. [Patch #438509] (schroedter)
d5189 1
a5189 1
2002-02-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d5191 3
a5193 4
	* generic/tclCmpCmds.c: (bugfix to the bugfix, hopefully the last)
	  Bugfix to the new [for] compiling code: was setting a
	  exceptArray parameter using another param which wasn't yet
	  initialised, thus filling it with noise.
d5195 1
a5195 1
2002-02-25  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5197 2
a5198 3
	* mac/tclMacSock.c (TcpGetOptionProc): Changed to recognize the
	  option "-error". Essentially ignores the option, always
	  returning an empty string.
d5200 1
a5200 1
2002-02-25  Jeff Hobbs  <jeffh@@ActiveState.com>
d5202 2
a5203 8
	* doc/Alloc.3:
	* doc/LinkVar.3:
	* doc/ObjectType.3:
	* doc/PkgRequire.3:
	* doc/Preserve.3:
	* doc/TCL_MEM_DEBUG.3: Updated documentation to describe the ckalloc,
	ckfree, ckrealloc, attemptckalloc, and attemptckrealloc macros, and
	to accurately describe when and how they are used. [Bug #497459] (dgp)
d5205 1
a5205 6
	* generic/tclHash.c (AllocArrayEntry, AllocStringEntry):
	Before invoking ckalloc when creating a Tcl_HashEntry,
	check that the amount of memory being allocated is
	at least as large as sizeof(Tcl_HashEntry). The previous
	code was allocating memory regions that were one
	or two bytes short. [Bug #521950] (dejong)
d5207 1
a5207 1
2002-02-25  Miguel Sofer  <msofer@@users.sourceforge.net>
d5209 1
a5209 4
	* generic/tclBasic.c (Tcl_EvalEx): avoiding a buffer overrun
	reported by Joe English, and restoring tcl7.6 behaviour for
	[subst]: badly terminated nested scripts will raise an error
	and not be evaluated. [Bug #495207]
d5211 1
a5211 1
2002-02-25  Don Porter  <dgp@@users.sourceforge.net>
d5213 1
a5213 4
	* unix/tclUnixPort.h: corrected strtoll prototype mismatch on Tru64.
	* compat/strtod.c (strtod): simplified #includes
	* compat/strtol.c (strtol): gather result in a long before returning
	as a long: necessary on platforms where sizeof(int) != sizeof(long).
d5215 1
a5215 1
2002-02-25  Daniel Steffen  <das@@users.sourceforge.net>
d5217 1
a5217 2
	* unix/tclLoadDyld.c: updated to use Mac OS X 10.1 dyld APIs that
	have more libdl-like semantics. (bug #514392)
d5219 1
a5219 1
2002-02-25  Miguel Sofer  <msofer@@users.sourceforge.net>
d5221 1
a5221 9
	* generic/tclCompCmds: fixing a bug in patch dated 2002-02-22, in
	the code for [for] and [while]. Under certain conditions, for long
	bodies, the exception range parameters were badly computed. Tests
	forthcoming: I still can't reproduce the conditions in the
	testsuite (!), although the bug (with assorted segfault or panic!)
	can be triggered from the console or with the new parse.bench in  
	tclbench.
	
2002-02-25  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5223 1
a5223 2
	* compat/strtoul.c, compat/strtol.c, compat/strtod.c: Added UCHAR,
	CONST and #includes to clean up GCC output.
d5225 1
a5225 1
2002-02-23  Don Porter  <dgp@@users.sourceforge.net>
d5227 2
a5228 5
	* compat/strtoull.c (strtoull):
	* compat/strtoll.c (strtoll):
	* compat/strtoul.c (strtoul): Fixed failure to handle leading
	sign symbols '+' and '-' and '0X' and raise overflow errors.
	[Bug 440916]  Also corrects prototype and errno problems.
d5230 1
a5230 1
2002-02-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d5232 2
a5233 4
	* configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Link with -n32
	instead of -32 when building on IRIX64-6.* system.
	[Tcl bug 521707]
d5235 3
a5237 1
2002-02-22  Don Porter <dgp@@users.sourceforge.net>
d5239 1
a5239 5
	* generic/tclInt.h:
	* generic/tclObj.c: renamed global variable emptyString ->
	tclEmptyString because it is no longer static.
	* generic/tclPkg.c: Fix for panic when library is loaded on a
	platform without backlinking without proper use of stubs. [Bug 476537]
d5241 3
a5243 1
2002-02-22  Jeff Hobbs  <jeffh@@ActiveState.com>
d5245 1
a5245 2
	* tests/regexpComp.test: updated regexp-11.[1-4] to match changes
	in regexp.test for new regsub syntax
d5247 2
a5248 3
	* unix/configure:
	* unix/tcl.m4: added --enable-64bit support for AIX-4 (using -q64
	flag) when using IBM's xlc compiler.
d5250 1
a5250 58
	* tests/safe.test: updated safe-8.5 and safe-8.7
	* library/safe.tcl (CheckFileName): removed the limit on
	sourceable file names (was only *.tcl or tclIndex files with no
	more than one dot and 14 chars).  There is enough internal
	protection in a safe interpreter already.  Fixes [Tk Bug #521560].

2002-02-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompCmds: [FR 465811]. Optimising [if], [for] and
	[while] for constant conditions; in addition, [for] and [while]
	are now compiled with the "loop rotation" optimisation (thanks to
	Kevin Kenny). 

2002-02-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	--- TIP#76 CHANGES ---
	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): Final-argument-less
	[regsub] returns the modified string.
	* doc/regsub.n: Updated docs.
	* tests/regexp.test: Updated and added tests.

	* compat/strtoll.c (strtoll): 
	* compat/strtoull.c (strtoull): 
	* unix/tclUnixPort.h:
	* win/tclWinPort.h: Const-ing 64-bit compatability declarations.
	Note that the return pointer is non-const because it is entirely
	legal for the functions to be called from somewhere that owns the
	string being passed.  Fixes problem reported by Larry Virden.

2002-02-21  David Gravereaux <davygrvy@@pobox.com>

	* win/mkd.bat (removed):
	* win/coffbase.txt (new):
	* win/makefile.bc:
	* win/makefile.vc:  Changed the 'setup' target to stop using
	the mkd.bat file and just make the directory right in the rule.
	Same change to makefile.bc.  configure.in nor Makefile.in use
	it.

	coffbase.txt will be the master list for our "prefered base
	addresses" set by the linker.  This should improve load-time
	(NT only) by avoiding relocations.  Submissions to the list
	by extension authors are encouraged.

	Added a 'tidy' target to compliment 'clean' and 'hose' to remove
	just the outputs. Also removed the $(winlibs) macro as it wasn't
	being used.

	Stuff left to do:
	1) get the winhelp target to stop building in the tools/
	directory.
	2) stop using rmd.bat
	3) add more dependacy rules.

	* win/tclAppInit.c:  Reverted back to -r1.6, as the header file
	change to tclPort.h won't allow for easy embedded support
	outside of the source dist.  Thanks to Don Porter for pointing
	this out to me.
d5252 1
a5252 1
2002-02-21  David Gravereaux <davygrvy@@pobox.com>
d5254 1
a5254 4
	* win/makefile.vc:
	* win/rules.vc:  Added a new "loimpact" option that sets the
	-ws:aggressive linker option.  Off by default.  It's said to
	keep the heap use low at the expense of alloc speed.
d5256 1
a5256 5
	* win/tclAppInit.c: Changed #include "tcl.h" to be tclPort.h to
	remove the raw windows.h include.  tclPort.h brings in windows.h
	already and lessens the pre-compiled-header mush and the randomly
	useless	#pragma comment (lib,...) references throughout the big
	windows.h tree (as observed at high linker warning levels).
d5258 2
a5259 1
2002-02-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5261 1
a5261 2
	* generic/tcl.h: Better guessing of LP64/ILP32 architecture, but
	now sensitive to presence of (suitable) <limits.h>
d5263 1
a5263 1
2002-02-20  Don Porter <dgp@@users.sourceforge.net>
d5265 1
a5265 5
	* generic/tcl.decls (Tcl_RegExpRange,Tcl_GetIndexFromObjStruct):
	Overlooked a few source incompatibilities.  Now using CONST84.
	* generic/tclDecls.h: make genstubs
	* generic/tcl.h (Tcl_CmdObjTraceProc): silence warning from Sun
	Workshop compiler.
d5267 1
a5267 1
2002-02-20  David Gravereaux <davygrvy@@pobox.com>
d5269 1
a5269 12
	* win/buildall.vc.bat:
	* win/makefile.vc:
	* win/rules.vc: General clean-ups.  Added compiler and linker tests
	for a) the pentium 0x0F errata, b) optimizing (not all have this),
	and c) linker v6 section alignment confusion.  All these are tested
	first to make sure any D4002 or LNK1117 warnings aren't displayed.
	The pentium 0x0F errata is a recommended switch.  The v5 linker's
	section alignment default is 512, but the v6 linker was changed
	to 4096 in an attempt to speed loading on Win98.  I changed the
	default to always be 512 across both linkers, unless linking
	statically, then 4096 is used for the claimed speed effect. Using
	a 512 alignment saves 12k bytes of dead space in the DLL.
d5271 3
a5273 1
	Added IA64 B-stepping errata switch when the compiler supports it.
d5275 1
a5275 2
	Added profiling to $(lflags) when requested and also removed the
	explict -entry option as the default works fine as is.
d5277 2
a5278 3
	Removed win/tclWinInit.c from the special case section to let it
	use the common implicit rule as the $(EXTFLAGS) macro it had was
	never referenced anywhere.
d5280 3
a5282 1
2002-02-20  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5284 1
a5284 3
	* generic/tcl.h: Added code to guess the correct settings for
	TCL_WIDE_INT_IS_LONG and TCL_WIDE_INT_TYPE when configure doesn't
	tell us them, as can happen with extensions.
d5286 7
a5292 1
2002-02-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5294 1
a5294 5
	* doc/format.n: Updated docs to list the specification.
	* generic/tclCmdAH.c (Tcl_FormatObjCmd): Made behaviour on 64-bit
	platforms correctly meet the specification, that %d works with the
	native word-sized integer, instead of trying to guess (wrongly)
	from the value being passed.
d5296 2
a5297 1
2002-02-19  Don Porter <dgp@@users.sourceforge.net>
d5299 1
a5299 1
	* changes: First draft of updated changes for 8.4a4 release.
d5301 2
a5302 1
2002-02-15  Jeff Hobbs  <jeffh@@ActiveState.com>
d5304 1
a5304 2
	* unix/tclUnixPort.h: add strtoll/strtoull declarations for
	platforms that do not define them.
d5306 2
a5307 2
	* generic/tclIndexObj.c (STRING_AT): removed ptrdiff_t cast and
	use of VOID* in default case (GNU-ism).
d5309 1
a5309 1
2002-02-15  Kevin Kenny  <kennykb@@acm.org>
d5311 2
a5312 109
	* compat/strtoll.c:
	* compat/strtoul.c:
	* compat/strtoull.c:
	* generic/tclIOUtil.c:
	* generic/tclPosixStr.c:
	* generic/tclTest.c:
	* generic/tclTestObj.c:
	* tests/get.test:
	* win/Makefile.vc: Further tweaks to the TIP 72 patch to make it
	compile under VC++.
	
2002-02-15  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tclExecute.c:
	* tclIOGT.c:
	* tclIndexObj.c: Touchups to the TIP 72 patch to make it
	  compileable under Windows again. The changes are not complete,
	  there is one nasty regarding _stati64

2002-02-15  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	+----------------------+
	| TIP #72 IMPLEMENTED. |
	+----------------------+

	There are a lot of changes from this TIP, so please see
	http://purl.org/tcl/tip/72.html for discussion of
	backward-compatability issues, but the main ones modifications are
	in:

	* generic/tcl.h: New types.
	* generic/tcl.decls: New public functions.
	* generic/tclExecute.c: 64-bit aware bytecode engine.
	* generic/tclBinary.c: 64-bit handling in [binary] command.
	* generic/tclScan.c: 64-bit handling in [scan] command.
	* generic/tclCmdAH.c: 64-bit handling in [file] and [format]
	commands.
	* generic/tclBasic.c: New "wordSize" entry in ::tcl_platform.
	* generic/tclFCmd.c: Large-file support (with many consequences.)
	* generic/tclIO.c: Large-file support (with many consequences.)
	* compat/strtoll.c, compat/strtoull.c: New support functions.
	* unix/tcl.m4, unix/configure: 64-bit support and greatly enhanced
	cacheing.

	Most other changes, including all those in doc/* and test/* as
	well as the majority in the platform directories, follow on from
	these.

	Also coming out of the woodwork:
	* generic/tclIndex.c: Better support for Cray PVP.
	* win/tclWinMtherr.c: Better Borland support.

	Note that, in a number of places through the Unix part of the
	platform support, there are Tcl_Platform* references.  These are
	expanded into the correct way to call that particular underlying
	function, i.e. with or without a '64' suffix, and should be used
	by people working on the core in preference to the API functions
	they overlay so that the code remains portable depending on the
	presence or absence of 64-bit support on the underlying platform.

	***POTENTIAL INCOMPATIBILITY***: Extracted from the TIP

	SUMMARY OF INCOMPATIBILITIES AND FIXES 
	======================================

	The behaviour of expressions containing constants that appear
	positive but which have a negative internal representation will
	change, as these will now usually be interpreted as wide
	integers. This is always fixable by replacing the constant with
	int(constant).

	Extensions creating new channel types will need to be altered as
	different types are now in use in those areas. The change to the
	declaration of Tcl_FSStat and Tcl_FSLstat (which are the new
	preferred API in any case) are less serious as no non-alpha
	releases have been made yet with those API functions.

	Scripts that are lax about the use of the l modifier in format and
	scan will probably need to be rewritten. This should be very
	uncommon though as previously it had absolutely no effect.

	Extensions that create new math functions that take more than one
	argument will need to be recompiled (the size of Tcl_Value
	changes), and functions that accept arguments of any type
	(TCL_EITHER) will need to be rewritten to handle wide integer
	values. (I do not expect this to affect many extensions at all.)

2002-02-14  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIOCmd.c (Tcl_GetsObjCmd): Trivial fix for bug
	  #517503, a memory leak reported by Miguel Sofer
	  <msofer@@users.sourceforge.net>. The leak happens if an error
	  occurs for "set var [gets $chan]" and leak one empty object.

2002-02-12  David Gravereaux <davygrvy@@pobox.com>

	* djgpp/ (new directory)
	* djgpp/Makefile (new):
	* unix/tclAppInit.c:
	* unix/tclMtherr.c:
	* unix/tclUnixFCmd.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixInit.c:
	* unix/tclUnixPort.h:  Early stage of DJGPP support for building
	Tcl on DOS.  Dynamic loading isn't working, yet.  Requires watt32
	for the TCP/IP stack.  No autoconf, yet.  Barely tested, but
	makes a working exe that runs Tcl in protected-mode, flat memory.
	[exec] and pipes will need the most work as multi-tasking on DOS
	has to be carefully.
d5314 1
a5314 1
2002-02-10  Kevin Kenny  <kennykb@@acm.org>
d5316 1
a5316 10
	* doc/CrtObjCmd.3:
	* doc/CrtTrace.3:
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclBasic.c:
	* generic/tclInt.h:
	* generic/tclTest.c:
	* tests/basic.test: Added Tcl_CreateObjTrace,
	Tcl_GetCommandInfoFromToken and Tcl_SetCommandInfoFromToken.
	(TIPs #32 and #79.)
d5318 1
a5318 4
	* generic/tclDecls.h:
	* generic/tclStubInit.c: Regenerated Stubs tables.
	
2002-02-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d5320 6
a5325 8
	* unix/configure:
	* unix/tcl.m4: added -pthread for FreeBSD to EXTRA_CFLAGS and
	LDFLAGS.  Also triggered nodots only for FreeBSD-3.
	Added AC_DEFINE(_POSIX_PTHREAD_SEMANTICS) for Solaris.

	* unix/tclUnixPort.h:
	* unix/tclUnixThrd.c: added thread-safe versions of readdir,
	localtime, gmtime and inet_ntoa for threaded build. (jgdavidson)
d5327 1
a5327 2
	* generic/tclScan.c (Tcl_ScanObjCmd): prevented ckfree being
	called on a pointer to NULL.
d5329 1
a5329 1
2002-02-07  Don Porter <dgp@@users.sourceforge.net>
d5331 1
a5331 30
	* doc/DString.3:
	* doc/Encoding.3:
	* doc/GetCwd.3:
	* doc/SplitPath.3:
	* doc/Translate.3:
	* doc/Utf.3:
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclEncoding.c:
	* generic/tclEnv.c:
	* generic/tclFileName.c:
	* generic/tclIOUtil.c:
	* generic/tclUtf.c:
	* generic/tclUtil.c:
	* mac/tclMacInit.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixInit.c:
	* unix/tclUnixPipe.c:
	* win/tclWin32Dll.c:
	* win/tclWinFCmd.c:
	* win/tclWinFile.c:
	* win/tclWinInit.c: Partial TIP 27 rollback.  Following routines
	restored to return (char *): Tcl_DStringAppend,
	Tcl_DStringAppendElement, Tcl_JoinPath, Tcl_TranslateFileName,
	Tcl_ExternalToUtfDString, Tcl_UtfToExternalDString,
	Tcl_UniCharToUtfDString, Tcl_GetCwd, Tcl_WinTCharToUtf.  Also
	restored Tcl_WinUtfToTChar to return (TCHAR *) and 
	Tcl_UtfToUniCharDString to return (Tcl_UniChar *).  Modified
	some callers.  This change recognizes that Tcl_DStrings are
	de-facto white-box objects.
d5333 2
a5334 2
	* generic/tclDecls.h:
	* generic/tclPlatDecls.h: make genstubs
d5336 1
a5336 1
	* generic/tclCmdMZ.c: corrected use of C++-style comment.
d5338 2
a5339 1
2002-02-06  Jeff Hobbs  <jeffh@@ActiveState.com>
d5341 1
a5341 14
	* tests/scan.test:
	* generic/tclScan.c (Tcl_ScanObjCmd): corrected scan 0x... %x
	handling that didn't accept the 0x as a prelude to a base 16
	number.  [Bug #495213]

	* generic/tclCompCmds.c (TclCompileRegexpCmd): made early check
	for bad RE to stop checking further.

	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): added special case to
	search for simple 'string map' style regsub calls.
	Delayed creation of resultPtr object until an initial match is
	made, as the input string object can then be reused for no matches.
	(Tcl_StringObjCmd): optimization improvements to the STR_MAP
	algorithm for zero-length and nocase cases.
d5343 3
a5345 2
	* tests/regexp.test:
	* tests/regexpComp.test: extra code coverage tests.
d5347 1
a5347 1
	* tests/string.test: added 10.18 and 10.19 extra tests.
d5349 1
a5349 1
	* generic/regc_locale.c (casecmp): slight performance improvement.
d5351 1
a5351 1
2002-02-05  Don Porter <dgp@@users.sourceforge.net>
d5353 4
a5356 3
	* library/http/http.tcl:
	* library/http/pkgIndex.tcl:  Corrected use of http::error when
	::error was intended.  Bump to http 2.4.2.
d5358 1
a5358 1
2002-02-04  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5360 2
a5361 6
	* unix/tclUnixChan.c (FileOutputProc): Fixed [bug 465765] reported
	  by Dale Talcott <daletalcott@@users.sourceforge.net>. Avoid
	  writing nothing into a file as STREAM based implementations will
	  consider this a EOF (if the file is a pipe). Not done in the
	  generic layer as this type of writing is actually useful to
	  check the state of a socket.
d5363 3
a5365 3
	* doc/open.n: Fixed [Bug 511540], added cross-reference to 'pid'
	  as the command to use to retrieve the pid of a command pipeline
	  created via 'open'.
d5367 1
a5367 1
2002-02-01  Jeff Hobbs  <jeffh@@ActiveState.com>
d5369 2
a5370 2
	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): handle quirky about case
	earlier to avoid shimmering problem.
d5372 1
a5372 1
2002-02-01  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5374 2
a5375 3
	* tests/io.test: io-39.22 split into two tests, one platform
	  dependent, the other not. -eofchar is not empty on the windows
	  platform.
d5377 1
a5377 1
2002-02-01  Vince Darley <vincentdarley@@users.sourceforge.net>
d5379 4
a5382 2
	* generic/tclTest.c: fix to picky windows compiler problem
	  with the 'MainLoop' function declaration.
d5384 1
a5384 1
2002-01-31  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5386 2
a5387 2
	* win/tclWinFCmd.c: TIP 27: Applied patch fixing CONST warnings on
	  behalf of Don Porter <dgp@@users.sourceforge.net>.
d5389 1
a5389 1
2002-01-30  Don Porter <dgp@@users.sourceforge.net>
d5391 1
a5391 41
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclInt.h: For each interface identified in the TIP 27
	  changes below as a POTENTIAL INCOMPATIBILITY, the source of the
	  incompatibility has been parameterized so that it can be
	  removed.  When compiling extension code against the Tcl header
	  files, use the compiler flag -DUSE_NON_CONST to remove the
	  irresolvable source incompatibilities introduced by the TIP 27
	  changes.  Resolvable changes are left for extension authors to
	  resolve.
	* generic/tclDecls.h: make genstubs

2002-01-30  Vince Darley <vincentdarley@@users.sourceforge.net>

	* doc/FileSystem.3: added documentation for 3 public
	functions which had been overlooked.  Fixes [Bug 507701].
	* unix/mkLinks: make mklinks

2002-01-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/regexpComp.test:
	* generic/tclCompCmds.c (TclCompileRegexpCmd): enhanced to support
	-nocase and -- options.

2002-01-28  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tcl.m4 (SC_LOAD_TCLCONFIG):
	* win/tcl.m4 (SC_LOAD_TCLCONFIG): Set TCL_LIB_SPEC,
	TCL_STUB_LIB_SPEC, and TCL_STUB_LIB_PATH to the
	values of TCL_BUILD_LIB_SPEC, TCL_BUILD_STUB_LIB_SPEC,
	and TCL_BUILD_STUB_LIB_PATH when tclConfig.sh is loaded
	from the build directory. A Tcl extension should
	make use of the non-build versions of these variables
	since they will work in both cases. This modification
	was described in TIP 34.

2002-01-28  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinReg.c (regConnectRegistryProc,RecursiveDeleteKey)
	(DeleteKey,GetKeyNames,GetType,GetValue,OpenSubKey,SetValue):
	redid the CONSTification as previous changes caused failing tests.
d5393 1
a5393 11
	* tests/regexpComp.test (new):
	* generic/tclInt.h:
	* generic/tclBasic.c: added TclCompileRegexpCmd entry
	* generic/tclCompCmds.c (TclCompileStringCmd): corrected to return
	TCL_OUT_LINE_COMPILE instead of TCL_ERROR for parsing errors, so
	it only throws the error for runtime compile, in case the user
	modifies 'string'.
	(TclCompileRegexpCmd): first try at a byte-compiled regexp
	command.  It handles static strings and ^$ bounded static strings.
	(TclCompileAppendCmd): made TclPushVarName call always use
	TCL_CREATE_VAR as numWords is always > 2 at that point.
d5395 2
a5396 2
	* generic/tclExecute.c (TclExecuteByteCode:INST_LIST): correct
	possibly dangerous decr in macro call.
d5398 1
a5398 1
	* win/tclWinInit.c (TclpFindVariable): CONSTification touch-up
d5400 1
a5400 2
	* win/tclWinReg.c (OpenSubKey): corrected bug introduced in
	CONSTification that dropped pointer reference.
d5402 1
a5402 3
	* ChangeLog.2000 (new file):
	* ChangeLog: broke changes from 2000 into ChangeLog.2000 to reduce
	  size of the main ChangeLog.
d5404 1
a5404 1
2002-01-28  David Gravereaux <davygrvy@@pobox.com>
d5406 1
a5406 3
	* generic/tclPlatDecls.h:  Added preprocessor logic to force a
	typedef of TCHAR when __STDC__ is defined when using the uncommon
	-Za compiler switch with the microsoft compiler.
d5408 1
a5408 1
2002-01-27  Don Porter <dgp@@users.sourceforge.net>
d5410 1
a5410 2
	* doc/package.n: Documented global namespace context for script
	evaluation by [package require].
d5412 1
a5412 1
2002-01-27  Daniel Steffen  <das@@users.sourceforge.net>
d5414 1
a5414 9
	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* mac/tclMacChan.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacInit.c:
	* mac/tclMacLoad.c:
	* mac/tclMacResource.c:
	* mac/tclMacSock.c: TIP 27 CONSTification induced changes
d5416 5
a5420 3
	* tests/event.test:
	* tests/main.test: added catches/constraints to test that
	use features that don't exist on the mac.
d5422 1
a5422 1
2002-01-25  Mo DeJong  <mdejong@@users.sourceforge.net>
d5424 2
a5425 127
	Make -eofchar and -translation options read only for
	server sockets. [Bug 496733]
	
	* generic/tclIO.c (Tcl_GetChannelOption, Tcl_SetChannelOption):
	Instead of returning nothing for the -translation option
	on a server socket, always return "auto". Return the empty
	string enclosed in quotes for the -eofchar option on
	a server socket. Fixup -eofchar usage message so that
	it matches the implementation.
	* tests/io.test: Add -eofchar tests and -translation tests
	to ensure options are read only on server sockets.
	* tests/socket.test: Update tests to account for -eofchar
	and -translation option changes.

2002-01-25  Don Porter <dgp@@users.sourceforge.net>

	* compat/strstr.c (strstr):
	* generic/tclCmdAH.c (Tcl_FormatObjCmd):
	* generic/tclCmdIL.c (InfoNameOfExecutableCmd):
	* generic/tclEnv.c (ReplaceString):
	* generic/tclFileName.c (ExtractWinRoot):
	* generic/tclIO.c (FlushChannel,Tcl_BadChannelOption):
	* generic/tclStringObj.c (AppendUnicodeToUtfRep):
	* generic/tclThreadTest.c (TclCreateThread):
	* generic/tclUtf.c (Tcl_UtfPrev):
	* mac/tclMacFCmd.c (TclpObjListVolumes):
	* mac/tclMacResource.c (TclMacRegisterResourceFork,
	  BuildResourceForkList):
	* win/tclWinInit.c (AppendEnvironment):  Sought out and eliminated
	instances of CONST-casting that are no longer needed after the
	TIP 27 effort.

	* Following is [Patch 501006]
	* generic/tclInt.decls (Tcl_AddInterpResolvers, Tcl_Export,
	  Tcl_FindNamespace, Tcl_GetInterpResolvers, Tcl_ForgetImport,
	  Tcl_Import, Tcl_RemoveInterpResolvers):
	* generic/tclNamesp.c (Tcl_Export, Tcl_Import, Tcl_ForgetImport,
	  Tcl_FindNamespace):
	* generic/tclResolve.c (Tcl_AddInterpResolvers,Tcl_GetInterpResolvers,
	  Tcl_RemoveInterpResolvers): Updated APIs in generic/tclResolve.c
	and generic/tclNamesp.c according to the guidelines of TIP 27.
	* generic/tclIntDecls.h: make genstubs

	* Following is [Patch 505630]
	* doc/AddErrorInfo.3:
	* generic/tcl.decls (Tcl_LogCommandInfo):
	* generic/tclBasic.c (Tcl_LogCommandInfo): Updated interfaces
	of generic/tclBasic.cc according to TIP 27.
	* generic/tclDecls.h: make genstubs

	* Following is [Patch 506818]
	* doc/Hash.3:
	* generic/tcl.decls (Tcl_HashStats):
	* generic/tclHash.c (Tcl_HashStats):  Updated APIs of generic/tclHash.c
	according to guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs
	* generic/tclVar.c (Tcl_ArrayObjCmd): Updated callers.

	* Following is [Patch 506807]
	* doc/ObjectType.3:
	* generic/tcl.decls (Tcl_GetObjType):
	* generic/tclObj.c (Tcl_GetObjType): Updated APIs of generic/tclObj.c
	according to guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs

	* Following is [Patch 507304]
	* doc/Encoding.3:
	* generic/tcl.decls (Tcl_WinUtfToTChar,Tcl_WinTCharToUtf):
	* win/tclWin32Dll.c (Tcl_WinUtfToTChar,Tcl_WinTCharToUtf):
	Updated interfaces in win/tclWin32Dll.c according to TIP 27.
	* generic/tclPlatDecls.h: make genstubs
	* generic/tclIOUtil.c (TclpNativeToNormalized):
	* win/tclWinFCmd.c (TclpObjNormalizePath):
	* win/tclWinFile.c (TclpFindExecutable,TclpMatchInDirectory,
	  NativeIsExec,NativeStat):
	* win/tclWinLoad.c (TclpLoadFile):
	* win/tclWinPipe.c (TclpOpenFile,ApplicationType):
	* win/tclWinReg.c (regConnectRegistryProc,RecursiveDeleteKey,DeleteKey,
	  GetKeyNames,GetType,GetValue,OpenSubKey,SetValue):
	* win/tclWinSerial.c (SerialSetOptionProc): Update callers.

	* Following is [Patch 505072]
	* doc/Concat.3:
	* doc/Encoding.3:
	* doc/Filesystem.3:
	* doc/Macintosh.3:
	* doc/OpenFileChnl.3
	* doc/SetResult.3:
	* doc/SetVar.3:
	* doc/SplitList.3:
	* doc/SplitPath.3:
	* doc/Translate.3:
	* generic/tcl.h (Tcl_FSMatchInDirectoryProc):
	* generic/tclInt.h (TclpMatchInDirectory):
	* generic/tcl.decls (Tcl_Concat,Tcl_GetStringResult,Tcl_GetVar,
	  Tcl_GetVar2,Tcl_JoinPath,Tcl_Merge,Tcl_OpenCommandChannel,Tcl_SetVar,
	  Tcl_SetVar2,Tcl_SplitList,Tcl_SplitPath,Tcl_TranslateFileName,
	  Tcl_ExternalToUtfDString,Tcl_GetEncodingName,Tcl_UtfToExternalDString,
	  Tcl_GetDefaultEncodingDir,Tcl_SetDefaultEncodingDir,
	  Tcl_FSMatchInDirectory,Tcl_MacEvalResource,Tcl_MacFindResource):
	* generic/tclInt.decls (TclCreatePipeline,TclGetEnv,TclpGetCwd,
	  TclpCreateProcess):
	* mac/tclMacFile.c (TclpGetCwd):
	* generic/tclEncoding.c (Tcl_GetDefaultEncodingDir,
	  Tcl_SetDefaultEncodingDir,Tcl_GetEncodingName,
	  Tcl_ExternalToUtfDString,Tcl_UtfToExternalDString, OpenEncodingFile,
	  LoadEscapeEncoding):
	* generic/tclFileName.c (DoTildeSubst,Tcl_JoinPath,Tcl_SplitPath,
	  Tcl_TranslateFileName): 
	* generic/tclIOUtil.c (Tcl_FSMatchInDirectory):
	* generic/tclPipe.c (FileForRedirect,TclCreatePipeline,
	  Tcl_OpenCommandChannel):
	* generic/tclResult.c (Tcl_GetStringResult):
	* generic/tclUtil.c (Tcl_Concat,Tcl_SplitList,Tcl_Merge):
	* generic/tclVar.c (Tcl_GetVar,Tcl_GetVar2,Tcl_SetVar,Tcl_SetVar2):
	* mac/tclMacResource.c (Tcl_MacEvalResource,Tcl_MacFindResource):
	Updated interfaces of generic/tclEncoding, generic/tclFilename.c,
	generic/tclIOUtil.c, generic/tclPipe.c, generic/tclResult.c,
	generic/tclUtil.c, generic/tclVar.c and mac/tclMacResource.c according
	to TIP 27.  Tcl_TranslateFileName rewritten as wrapper around
	VFS-aware version.
	***POTENTIAL INCOMPATIBILITY*** 
	Includes source incompatibilities: argv arguments of Tcl_Concat,
	Tcl_JoinPath, Tcl_OpenCommandChannel, Tcl_Merge; argvPtr arguments of
	Tcl_SplitList and Tcl_SplitPath.
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs
d5427 1
a5427 52
	* generic/tclCkalloc.c (MemoryCmd):
	* generic/tclClock.c (FormatClock):
	* generic/tclCmdAH.c (Tcl_CaseObjCmd,Tcl_EncodingObjCmd,Tcl_FileObjCmd):
	* generic/tclCmdIL.c (InfoLibraryCmd,InfoPatchLevelCmd,
	  InfoTclVersionCmd):
	* generic/tclCompCmds.c (TclCompileForeachCmd):
	* generic/tclCompCmds.h (TclCompileForeachCmd):
	* generic/tclCompile.c (TclFindCompiledLocal):
	* generic/tclEnv.c (TclSetupEnv,TclSetEnv,Tcl_PutEnv,TclGetEnv,
	  EnvTraceProc):
	* generic/tclEvent.c (Tcl_BackgroundError):
	* generic/tclIO.c (Tcl_BadChannelOption,Tcl_SetChannelOption):
	* generic/tclIOCmd.c (Tcl_ExecObjCmd,Tcl_OpenObjCmd):
	* generic/tclIOSock.c (TclSockGetPort):
	* generic/tclIOUtil.c (SetFsPathFromAny):
	* generic/tclLink.c (LinkTraceProc):
	* generic/tclMain.c (Tcl_Main):
	* generic/tclNamesp.c (TclTeardownNamespace):
	* generic/tclProc.c (TclCreateProc):
	* generic/tclTest.c (TestregexpObjCmd,TesttranslatefilenameCmd,
	  TestchmodCmd,GetTimesCmd,TestsetCmd,TestOpenFileChannelProc1,
	  TestOpenFileChannelProc2,TestOpenFileChannelProc3,AsyncHandlerProc,
	  TestpanicCmd):
	* generic/tclThreadTest.c (ThreadErrorProc,ThreadEventProc):
	* generic/tclUtil.c (TclPrecTraceProc):
	* mac/tclMacFCmd.c (GetFileSpecs):
	* mac/tclMacFile.c (TclpMatchInDirectory):
	* mac/tclMacInit.c (TclpInitLibraryPath,Tcl_SourceRCFile):
	* mac/tclMacOSA.c (tclOSAStore,tclOSALoad):
	* mac/tclMacResource.c (Tcl_MacEvalResource):
	* unix/tclUnixFCmd.c (TclpObjNormalizePath):
	* unix/tclUnixFile.c (TclpMatchInDirectory,TclpGetUserHome,TclpGetCwd,
	  TclpReadLink):
	* unix/tclUnixInit.c (TclpInitLibraryPath,TclpSetVariables,
	  Tcl_SourceRCFile):
	* unix/tclUnixPipe.c (TclpOpenFile,TclpCreateTempFile,
	  TclpCreateProcess):
	* win/tclWinFile.c (TclpGetCwd,TclpMatchInDirectory):
	* win/tclWinInit.c (TclpInitLibraryPath,Tcl_SourceRCFile,
	  TclpSetVariables):
	* win/tclWinPipe.c (TclpCreateProcess): Updated callers.

2002-01-24  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclIOUtil.c (SetFsPathFromAny):  Corrected tilde-substitution
	of pathnames where > 1 separator follows the ~.  [Bug 504950]

2002-01-24  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/http/pkgIndex.tcl:
	* library/http/http.tcl: don't add port in default case to handle
	broken servers.  http bumped to 2.4.1  [Bug #504508]
d5429 1
a5429 1
2002-01-23  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5431 4
a5434 16
	* unix/mkLinks: Regenerated.
	* doc/CrtChannel.3:
	* doc/ChnlStack.3: Moved documentation for 'Tcl_GetTopChannel'
	  from 'CrtChannel' to 'ChnlStack'. Added documentation of
	  'Tcl_GetStackedChannel'. Bug #506147 reported by Mark Patton
	  <msp@@users.sourceforge.net>.

2002-01-23  Don Porter <dgp@@users.sourceforge.net>

	* win/tclWinFile.c (NativeAccess,NativeStat,NativeIsExec,
	  TclpGetUserHome):
	* win/tclWinPort.h (TclWinSerialReopen):
	* win/tclWinSerial.c (TclWinSerialReopen):
	* win/tclWinSock.c (Tcl_OpenTcpServer):  Corrections to earlier
	TIP 27 changes.  Thanks to Andreas Kupries for the feedback.
	* generic/tclPlatDecls.h: make genstubs
d5436 1
a5436 48
	* doc/GetHostName.3:
	* doc/GetOpnFl.3:
	* doc/OpenTcp.3:
	* tcl.decls (Tcl_GetHostName,Tcl_GetOpenFile,Tcl_OpenTcpClient,
	  Tcl_OpenTclServer):
	* mac/tclMacSock.c (CreateSocket,Tcl_OpenTcpClient,Tcl_OpenTcpServer,
	  Tcl_GetHostName,GetHostFromString):
	* unix/tclUnixChan.c (CreateSocket,CreateSocketAddress,
	  Tcl_OpenTcpClient,Tcl_OpenTcpServer,Tcl_GetOpenFile):
	* unix/tclUnixSock.c (Tcl_GetHostName):
	* win/tclWinSock.c (CreateSocket,CreateSocketAddress,
	  Tcl_OpenTcpClient,Tcl_OpenTcpServer,Tcl_GetHostName):
	Updated socket interfaces according to TIP 27.
	* generic/tclCmdIL.c (InfoHostnameCmd): Updated callers.
	* generic/tclDecls.h: make genstubs

2002-01-21  David Gravereaux <davygrvy@@pobox.com>

	* generic/tclLoadNone.c: TclpLoadFile() didn't match proto of
	  typedef Tcl_FSLoadFileProc.  OK'd by vincentdarley.
	  [Patch #502488]

2002-01-21  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIO.c (WriteChars): Fix for SF #506297, reported by
	  Martin Forssen <ruric@@users.sourceforge.net>. The encoding
	  chosen in the script exposing the bug writes out three intro
	  characters when TCL_ENCODING_START is set, but does not consume
	  any input as TCL_ENCODING_END is cleared. As some output was
	  generated the enclosing loop calls UtfToExternal again, again
	  with START set. Three more characters in the out and still no
	  use of input ... To break this infinite loop we remove
	  TCL_ENCODING_START from the set of flags after the first call
	  (no condition is required, the later calls remove an unset flag,
	  which is a no-op). This causes the subsequent calls to
	  UtfToExternal to consume and convert the actual input.

2002-01-21  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclTest.c: Converted declarations of TestReport file system
	  to more portable form.  [Bug 501417].

	* generic/tcl.decls (Tcl_TraceCommand,Tcl_UntraceCommand,
	  Tcl_CommandTraceInfo):
	* generic/tclCmdMZ.c (Tcl_TraceCommand,Tcl_UntraceCommand,
	  Tcl_CommandTraceInfo): Updated APIs in generic/tclCmdMZ.c 
	  according to the guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs
d5438 1
a5438 1
2002-01-18  Don Porter <dgp@@users.sourceforge.net>
d5440 1
a5440 3
	* win/tclWinChan.c:
	* win/tclWinFCmd.c:
	* win/tclWinFile.c: Overlooked callers of Tcl_FSGetNativePath
d5442 1
a5442 2
	* win/tclWinDde.c:
	* win/tclWinReg.c: Overlooked callers of Tcl_GetIndexFromObj
d5444 1
a5444 1
2002-01-18  Daniel Steffen  <das@@users.sourceforge.net>
d5446 3
a5448 31
	* generic/tclThreadTest.c:
	* mac/tclMacChan.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacLoad.c:
	* mac/tclMacResource.c: TIP 27 CONSTification broke the mac
	  build in a number of places.

2002-01-17  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIOCmd.c (Tcl_GetsObjCmd): Fixed bug #504642 as
	  reported by Brian Griffin <bgriffin@@users.sourceforge.net>,
	  using his patch. Before the patch the generic I/O layer held an
	  unannounced reference to the interp result to store the read
	  line into. This unfortunately has disastrous results if the
	  channel driver executes a tcl script to perform its operation,
	  this freeing the interp result. In that case we are
	  dereferencing essentially a dangling reference. It is not truly
	  dangling because the object is in the free list, but this only
	  causes us to smash the free list and have the error occur later
	  somewhere else. The patch simply creates a new object for the
	  line and later sets it into the interp result when we are done
	  with reading.

2002-01-16  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tcl.m4 (SC_LOAD_TCLCONFIG):
	* win/tcl.m4 (SC_LOAD_TCLCONFIG): Subst TCL_DBGX
	into TCL_STUB_LIB_FILE and TCL_STUB_LIB_FLAG
	variables so that an extension does not need
	to subst TCL_DBGX into its makefile. [Tk Bug 504356]
d5450 1
a5450 1
2002-01-16  Don Porter <dgp@@users.sourceforge.net>
d5452 7
a5458 47
	* doc/FileSystem.3:
	* doc/GetCwd.3:
	* doc/GetIndex.3:
	* generic/tcl.decls (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_GetCwd, Tcl_FSFileAttrStrings, Tcl_FSGetNativePath,
	  Tcl_FSGetTranslatedStringPath):
	* generic/tcl.h (Tcl_FSFileAttrStringsProc):
	* generic/tclFCmd.c (TclFileAttrsCmd):
	* generic/tclIOUtil.c (Tcl_GetCwd,NativeFileAttrStrings,
	  Tcl_FSFileAttrStrings,Tcl_FSGetTranslatedStringPath,
	  Tcl_FSGetNativePath):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObj,Tcl_GetIndexFromObjStruct):
	More TIP 27 updates in tclIOUtil.c and tclIndexObj.c that were
	overlooked before.  [Patch 504671]
	***POTENTIAL INCOMPATIBILITY*** 
	Includes a source incompatibility in the tablePtr arguments of
	the Tcl_GetIndexFromObj* routines.
	* generic/tclDecls.h: make genstubs

	* generic/tclBinary.c (Tcl_BinaryObjCmd):
	* generic/tclClock.c (Tcl_ClockObjCmd):
	* generic/tclCmdAH.c (Tcl_EncodingObjCmd, Tcl_FileObjCmd):
	* generic/tclCmdIL.c (Tcl_InfoObjCmd,Tcl_LsearchObjCmd,Tcl_LsortObjCmd):
	* generic/tclCmdMZ.c (Tcl_TraceObjCmd,Tcl_RegexpObjCmd,Tcl_RegsubObjCmd,
	  Tcl_StringObjCmd,Tcl_SubstObjCmd,Tcl_SwitchObjCmd,
	  TclTraceCommandObjCmd,TclTraceVariableObjCmd):
	* generic/tclCompCmds.c (TclCompileStringCmd):
	* generic/tclEvent.c (Tcl_UpdateObjCmd):
	* generic/tclFileName.c (Tcl_GlobObjCmd):
	* generic/tclIO.c (Tcl_FileEventObjCmd):
	* generic/tclIOCmd.c (Tcl_SeekObjCmd,Tcl_ExecObjCmd,Tcl_SocketObjCmd,
	  Tcl_FcopyObjCmd):
	* generic/tclInterp.c (Tcl_InterpObjCmd,SlaveObjCmd):
	* generic/tclNamesp.c (Tcl_NamespaceObjCmd):
	* generic/tclPkg.c (Tcl_PackageObjCmd):
	* generic/tclTest.c (Tcltest_Init,TestencodingObjCmd,TestgetplatformCmd,
	  TestlocaleCmd,TestregexpObjCmd,TestsaveresultCmd,
	  TestGetIndexFromObjStructObjCmd,TestReportFileAttrStrings):
	* generic/tclTestObj.c (TestindexObjCmd,TeststringObjCmd):
	* generic/tclTimer.c (Tcl_AfterObjCmd):
	* generic/tclVar.c (Tcl_ArrayObjCmd):
	* mac/tclMacFCmd.c (SetFileFinderAttributes):
	* unix/tclUnixChan.c (TclpOpenFileChannel):
	* unix/tclUnixFCmd.c (tclpFileAttrStrings):
	* unix/tclUnixFile.c (TclpObjAccess,TclpObjChdir,TclpObjStat,
	  TclpObjLstat):
	* win/tclWinFCmd.c (tclpFileAttrStrings): Updated callers.
d5460 1
a5460 15
	* doc/RegExp.3:
	* doc/Utf.3:
	* generic/tcl.decls:
	* generic/tclInt.decls:
	* generic/tclRegexp.c:
	* generic/tclUtf.c:  Updated APIs in generic/tclUtf.c and
	generic/tclRegexp.c according to the guidelines of TIP 27.
	[Patch 471509]

	* generic/regc_locale.c (element,cclass):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd):
	* generic/tclFileName.c (TclpGetNativePathType,SplitMacPath):
	* generic/tclIO.c (ReadChars):
	* mac/tclMacLoad.c (TclpLoadFile):
	* win/tclWinFile.c (TclpGetUserHome): Updated callers.
d5462 3
a5464 2
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs
d5466 1
a5466 60
	* doc/ParseCmd.3 (Tcl_ParseVar):
	* generic/tcl.decls (Tcl_ParseVar):
	* generic/tclParse.c (Tcl_ParseVar):
	* generic/tclTest.c (TestparsevarObjCmd): Updated APIs in
	generic/tclParse.c according to the guidelines of TIP 27.  Updated
	callers.  [Patch 501046]
	* generic/tclDecls.h: make genstubs

	* generic/tcl.decls (Tcl_RecordAndEval):
	* generic/tclDecls.h: make genstubs
	* generic/tclHistory.c (Tcl_RecordAndEval): Updated APIs in
	generic/tclHistory.c according to the guidelines of TIP 27.
	[Patch 504091]

	* doc/CrtSlave.3:
	* generic/tcl.decls (Tcl_CreateAlias, Tcl_CreateAliasObj,
	  Tcl_CreateSlave, Tcl_GetAlias, Tcl_GetAliasObj, Tcl_GetSlave):
	* generic/tclInterp.c (Tcl_CreateAlias, Tcl_CreateAliasObj,
	  Tcl_CreateSlave, Tcl_GetAlias, Tcl_GetAliasObj, Tcl_GetSlave):
	Updated APIs in the file generic/tclInterp.c according to the
	guidelines of TIP 27.  [Patch 501371]
	***POTENTIAL INCOMPATIBILITY*** 
	Includes a source incompatibility in the targetCmdPtr arguments of
	the Tcl_GetAlias* routines.

	* generic/tclDecls.h: make genstubs

2002-01-15  Don Porter <dgp@@users.sourceforge.net>

	* doc/SetErrno.3 (Tcl_ErrnoMsg): Corrected documentation for
	Tcl_ErrnoMsg; it takes an integer argument.  Thanks to Georgios
	Petasis.  [Bug 468183]

	* doc/AddErrInfo.3 (Tcl_PosixError):
	* doc/Eval.3 (Tcl_EvalFile):
	* doc/FileSystem.c (Tcl_FSOpenFileChannel,Tcl_FSOpenFileChannelProc):
	* doc/OpenFileChnl.3 (Tcl_OpenFileChannel):
	* doc/SetErrno.3 (Tcl_ErrnoId,Tcl_ErrnoMsg):
	* doc/Signal.3 (Tcl_SignalId,Tcl_SignalMsg):
	* generic/tcl.decls (Tcl_ErrnoId,TclErrnoMsg,Tcl_EvalFile,
	  Tcl_OpenFileChannel,Tcl_PosixError,Tcl_SignalId,Tcl_SignalMsg,
	  Tcl_FSOpenFileChannel):
	* generic/tcl.h (Tcl_FSOpenFileChannelProc):
	* generic/tclIO.c (FlushChannel):
	* generic/tclIOUtil.c (Tcl_OpenFileChannel,Tcl_EvalFile,TclGetOpenMode,
	  Tcl_PosixError,Tcl_FSOpenFileChannel):
	* generic/tclInt.decls (TclGetOpenMode):
	* generic/tclInt.h (TclOpenFileChannelProc_,TclGetOpenMode,
	  TclpOpenFileChannel):
	* generic/tclPipe.c (TclCleanupChildren):
	* generic/tclPosixStr.c (Tcl_ErrnoId,Tcl_ErrnoMsg,Tcl_SignalId,
	  Tcl_SignalMsg):
	* generic.tclTest.c (PretendTclpOpenFileChannel,
	  TestOpenFileChannelProc1,TestOpenFileChannelProc2,
	  TestOpenFileChannelProc3,TestReportOpenFileChannel):
	* mac/tclMacChan.c (TclpOpenFileChannel):
	* unix/tclUnixChan.c (TclpOpenFileChannel):
	* win/tclWinChan.c (TclpOpenFileChannel): Updated APIs in
	  generic/tclIOUtil.c and generic/tclPosixStr.c according to the
	  guidelines of TIP 27.  Updated callers.  [Patch 499196]
d5468 2
a5469 2
	* generic/tclDecls.h:
	* generic/tclIntDecls.h: make genstubs
d5471 1
a5471 30
	* doc/CrtChannel.3:
	* doc/OpenFileChnl.3:
	* generic/tcl.decls:
	* generic/tclIO.h:
	* generic/tclIO.c (DoWrite, Tcl_RegisterChannel, Tcl_GetChannel,
	  Tcl_CreateChannel, Tcl_GetChannelName, CloseChannel, Tcl_Write,
	  Tcl_WriteRaw, Tcl_Ungets, Tcl_BadChannelOption, Tcl_GetChannelOption,
	  Tcl_SetChannelOption, Tcl_GetChannelNamesEx, Tcl_ChannelName):
	Updated APIs in the file generic/tclIO.c according to the guidelines
	of TIP 27.  Several minor documentation corrections as well.
	[Patch 503565]
	* generic/tclDecls.h: make genstubs

	* generic/tcl.h (Tcl_DriverOutputProc, Tcl_DriverGetOptionProc,
	  Tcl_DriverSetOptionProc):
	* generic/tclIOGT.c (TransformOutputProc, TransformGetOptionProc,
	  TransformSetOptionProc):
	* mac/tclMacChan.c (FileOutput, StdIOOutput):
	* man/tclMacSock.c (TcpGetOptionProc, TcpOutput):
	* unix/tclUnixChan.c (FileOutputProc, TcpGetOptionProc, TcpOutputProc,
	  TtyGetOptionProc, TtySetOptionProc):
	* unix/tclUnixPipe.c (PipeOuputProc):
	* win/tclWinChan.c (FileOutputProc):
	* win/tclWinConsole.c (ConsleOutputProc):
	* win/tclWinPipe.c (PipeOuputProc):
	* win/tclWinSerial.c (SerialOutputProc, SerialGetOptionProc,
	  SerialSetOptionProc):
	* win/tclWinSock.c (TcpGetOptionProc, TcpOutput): Updated channel
	driver interface according to the guidelines of TIP 27.  See also
	[Bug 500348].
d5473 3
a5475 9
	* doc/CrtChannel.3:
	* generic/tcl.h:
	* generic/tclIO.c:
	* generic/tclIO.h:
	* generic/tclInt.h:
	* tools/checkLibraryDoc.tcl:
	Moved Tcl_EolTranslation enum declaration from generic/tcl.h to
	generic/tclInt.h (renamed to TclEolTranslation).  It is not used
	anywhere in Tcl's public interface.
d5477 1
a5477 1
2002-01-14  Don Porter <dgp@@users.sourceforge.net>
d5479 1
a5479 8
	* doc/GetIndex.3:
	* doc/WrongNumArgs.3:
	* generic/tcl.decls (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_WrongNumArgs):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_WrongNumArgs):  Updated APIs in the file generic/tclIndexObj.c
	according to the guidelines of TIP 27.  [Patch 501491]
	* generic/tclDecls.h: make genstubs
d5481 1
a5481 1
2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d5483 2
a5484 5
	* unix/configure: Regen.
	* unix/configure.in:
	* win/configure: Regen.
	* win/configure.in: Use ${libdir} instead of ${exec_prefix}/lib
	to properly support the --libdir option to configure. [Bug 489370]
d5486 1
a5486 1
2002-01-11  Andreas Kupries  <andreas_kupries@@users.sourceforge.net> 
d5488 1
a5488 105
	* win/tclWinSerial.c (SerialSetOptionProc): Applied patch for SF
	  bug #500348 supplied by Rolf Schroedter
	  <schroedter@@users.sourceforge.net>. The function modified the
	  contents of the the 'value' string and now does not do this
	  anymore. This is a followup to the change made on 2001-12-17.

2002-01-11  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.vc: Removed -GD compiler option.  It was intended
	for future use, but MS is again changing the future at their whim.
	The D4002 warning was harmless though, but someone using VC .NET
	logged it as a concern.  [Bug #501565]

2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Burn Tcl build directory
	into tcltest executable to avoid crashes caused
	by ld loading a previously installed version
	of the tcl shared library. [Bug 218110]

2002-01-10  Don Porter <dgp@@users.sourceforge.net>,
	Kevin Kenny <kennykb@@users.sourceforge.net>
	
	* unix/tclLoadDld.c (TclpLoadFile):  syntax error: unbalanced
	parens.  Kevin notes that it's far from clear that this file is
	ever included in an actual build; Linux without dlopen appears to
	be a nonexistent configuration.
	
2002-01-08  Don Porter <dgp@@users.sourceforge.net>,
	Kevin Kenny <kennykb@@users.sourceforge.net>

	* doc/StaticPkg.3 (Tcl_StaticPackage):
	* generic/tcl.decls (Tcl_StaticPackage):
	* generic/tclDecls.h (Tcl_StaticPackage):
	* generic/tclInt.decls (TclGuessPackageName):
	* generic/tclInt.h (TclGuessPackageName):
	* generic/tclLoad.c (Tcl_StaticPackage):
	* generic/tclLoadNone.c (TclGuessPackageName):
	* mac/tclMacLoad.c (TclGuessPackageName):
	* unix/tclLoadAout.c (TclGuessPackageName):
	* unix/tclLoadDl.c (TclGuessPackageName):
	* unix/tclLoadDld.c (TclGuessPackageName):
	* unix/tclLoadDyld.c (TclGuessPackageName):
	* unix/tclLoadNext.c (TclGuessPackageName):
	* unix/tclLoadOSF.c (TclGuessPackageName):
	* unix/tclLoadShl.c (TclGuessPackageName):
	* win/tclWinLoad.c (TclGuessPackageName):  Updated APIs in 
	the files */tcl*Load*.c according to the guidelines of TIP 27.
	[Patch 501096]

2002-01-09  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclTest.c (MainLoop):
	* tests/main.test (Tcl_Main-1.{3,4,5,6}):  Corrected some non-portable
	tests from the new Tcl_Main changes.  Thanks to Kevin Kenny.

2002-01-07  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclEvent.c (TclInExit):
	* generic/tclIOUtil.c (SetFsPathFromAbsoluteNormalized,
	  SetFsPathFromAny,Tcl_FSNewNativePath,DupFsPathInternalRep):
	* generic/tclListObj.c (TclLsetList,TclLsetFlat):  Added some type
	casts to satisfy picky compilers.

	* generic/tclMain.c:  Bug fix: neglected the NULL case in
	TclGetStartupScriptFileName().  Broke Tk/wish.

2002-01-05  Don Porter <dgp@@users.sourceforge.net>

	* doc/Tcl_Main.3:
	* generic/tclMain.c:  Substantial rewrite and expanded documentation
	of Tcl_Main to correct a number of bugs and flaws:

		* Interactive Tcl_Main can now enter a main loop, exit
		  that loop and continue interactive operations.  The loop
		  may even exit in the midst of interactive command typing
		  without loss of the partial command.  [Bugs 486453, 474131]
		* Tcl_Main now gracefully handles deletion of its master
		  interpreter.
		* Interactive Tcl_Main can now operate with non-blocking stdin
		* Interactive Tcl_Main can now detect EOF on stdin even in
		  mid-command.  [Bug 491341]
		* Added VFS-aware internal routines for managing the
		  startup script selection.
		* Tcl variable 'tcl_interactive' is now linked to C variable
		  'tty' so that one can disable/enable interactive prompts
		  at the script level when there is no startup script.  This
		  is meant for use by the test suite.
		* Consistent use of the Tcl libraries standard channels as
		  returned by Tcl_GetStdChannel(); as opposed to the channels
		  named 'stdin', 'stdout', and 'stderr' in the master interp,
		  which can be different or unavailable.
		* Tcl_Main now calls Tcl_Exit() if evaluation of [exit] in the
		  master interpreter returns, assuring Tcl_Main does not return.
		* Documented Tcl_Main's absence from public stub table
		* Documented that Tcl_Main does not return.
		* Documented Tcl variables set by Tcl_Main.
		* All prompts are done from a single procedure, Prompt.
		* Use of Tcl_Obj-enabled interfaces everywhere.

	* generic/tclInt.decls (TclGetStartupScriptPath,
	  TclSetStartupScriptPath): New internal VFS-aware routines for
	managing the startup script of Tcl_Main.
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c: make genstubs
d5490 1
a5490 5
	* generic/tclTest.c (TestsetmainloopCmd,TestexitmainloopCmd,
	  Tcltest_Init,TestinterpdeleteCmd):
	* tests/main.test (new):  Added new file to test suite that
	thoroughly tests generic/tclMain.c; added some new test commands
	for testing Tcl_SetMainLoop().
a5491 1
2002-01-04  Don Porter <dgp@@users.sourceforge.net>
a5492 62
	* doc/Alloc.3:
	* doc/Concat.3:
	* doc/CrtMathFnc.3:
	* doc/Hash.3:
	* doc/Interp.3:
	* doc/LinkVar.3:
	* doc/ObjectType.3:
	* doc/PkgRequire.3:
	* doc/Preserve.3:
	* doc/SetResult.3:
	* doc/SplitList.3:
	* doc/SplitPath.3:
	* doc/TCL_MEM_DEBUG.3: Updated documentation to describe the ckalloc,
	ckfree, ckrealloc, attemptckalloc, and attemptckrealloc macros, and
	to accurately describe when and how they are used.  [Bug 497459]

	* generic/tclThreadJoin.c (TclRememberJoinableThread,TclJoinThread):
	Replaced Tcl_Alloc and Tcl_Free calls with ckalloc and ckfree so that
	memory debugging is supported.

2002-01-04  Daniel Steffen <das@@users.sourceforge.net>

	* mac/tclMacTime.c (TclpGetTZName): fix for daylight savings TZName bug

2002-01-03  Don Porter <dgp@@users.sourceforge.net>

	* doc/FileSystem.3:
	* generic/tclIOUtil.c: Updated some old uses of "fileName" to
	new VFS terminology, "pathPtr".

2002-01-03  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/basic.test (basic-39.4): Greatly simplified test while
	still leaving it so that it crashes when run without the fix to
	the [foreach] implementation.
	* generic/tclCmdAH.c (Tcl_ForeachObjCmd): Stopped Bug #494348 from
	happening by not trying to be so clever with cacheing; if nothing
	untoward is happening anyway, the less efficient technique will
	only add a few instruction cycles (one function call and a few
	derefs/assigns per list per iteration, with no change in the
	number of tests) and if something odd *is* going on, the code is
	now far more robust.

	* tests/basic.test (basic-39.4): Reproducable script from Bug #494348

2002-01-02  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/util.test (Wrapper_Tcl_StringMatch,util-5.*): Rewrote so
	the test is performed with the right internal function since
	[string match] no longer uses Tcl_StringCaseMatch internally.

	* tests/string.test (string-11.51):
	* generic/tclUtf.c (Tcl_UniCharCaseMatch):
	* generic/tclUtil.c (Tcl_StringCaseMatch): Fault with matching
	case-insensitive non-ASCII patterns containing upper case
	characters.  [Bug #233257]

	******************************************************************
	*** CHANGELOG ENTRIES FOR 2001 IN "ChangeLog.2001"             ***
	*** CHANGELOG ENTRIES FOR 2000 IN "ChangeLog.2000"             ***
	*** CHANGELOG ENTRIES FOR 1999 AND EARLIER IN "ChangeLog.1999" ***
	******************************************************************
@


1.24.2.4
log
@2003-03-05  David Carlton  <carlton@@math.stanford.edu>

	* Merge with mainline.  Tag is carlton_dictionary-20030305-merge.
@
text
@a0 41
2003-02-11  Martin M. Hunt  <hunt@@redhat.com>
	From Mumit Khan  <khan@@nanotech.wisc.edu>

	* generic/tclIOUtil.c (SetFsPathFromAny): Add Cygwin specific
	code to convert POSIX filename to native format.
	* generic/tclFileName.c (Tcl_TranslateFileName): And remove
	from here.
	(TclDoGlob): Adjust.
	* win/tclWinFile.c (TclpObjChdir): Use chdir on Cygwin.


2003-02-06  Martin M. Hunt  <hunt@@redhat.com>

	* win/tcl.m4 (SC_CONFIG_CFLAGS): Don't default to -O.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Don't default to -O.	
	CFLAGS gets set to "-O2" by default in top level
	configure. Adding "-O" here causes the "-O2" to be
	ignored, but only when the user types "make" within
	the tcl subdirectory. This caused some confusion.
	* win/configure: Rebuilt.
	* unix/configure: Rebuilt.

	* generic/tclEnv.c (TclUnsetEnv): Cast arg to unsigned.

	Import from latest tcl sources to fix a bug with
	"file copy"
	2003-01-25  Mo DeJong  <mdejong@@users.sourceforge.net>	
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile, squelch_warnings):
	Re-implement inline ASM SEH handlers for gcc.
	The esp and ebp registers are now saved on the
	stack instead of in global variables so that
	the code is thread safe. Add additional checks
	when TCL_MEM_DEBUG is defined to be sure the
	values were recovered from the stack properly.
	Remove squelch_warnings functions and add
	a dummy call in the handler methods to squelch
	compiler warnings.
	* win/tclWinReg.c: Add casts to avoid compiler
	warning. Fix assignment in if expression bug.


@


1.24.2.5
log
@2004-01-26  David Carlton  <carlton@@kealia.com>

	* Merge with mainline; tag is carlton_dictionary-20040126-merge.
@
text
@a0 7
2004-01-21  Keith Seitz  <kseitz@@uglyboxes.com>

	From tcl repository:
	2003-10-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
	* generic/tclCmdAH.c (Tcl_FileObjCmd): Changed FILE_ prefix to FCMD_
	to stop symbol/#def clashes on Cygwin/Mingw32 on NT.

@


1.23
log
@        * generic/tclIntDecls.h (TclIntStubs): Do not include definitions
        for tclpAlloc, tclpFree, or pRealloc on cygwin.

        * win/tcl.hpj.in: Copied here from tools/tcl.hpj.in.

        * win/tcl.m4 (SC_CONFIG_CFLAGS): Add TCL_DLL_BASE, DDE_DLL_BASE,
        and REG_DLL_BASE variables to define DLL image bases on cygwin.
        Do not link with "-e _WinMain@@16" on cygwin.
        * win/configure.in (TCL_DLL_BASE): Substitute into makefile.
        (DDE_DLL_BASE): Likewise.
        (REG_DLL_BASE): Likewise.
        * win/configure: Regenerated.
        * win/Makefile.in: Use TCL_DLL_BASE, DDE_DLL_BASE, and
        REG_DLL_BASE to build DLLs.
@
text
@d1 11
@


1.22
log
@        From Mo DeJong  <supermo@@bayarea.net>
        * cygwin/configure: Regenerated.
        * cygwin/configure.in: Emit a tclConfig.sh file
        so that expect can load it at configure time.
        * win/configure: Regenerated.
        * win/configure.in: Don't emit a ../unix/tclConfig.sh
        file, this was a hack to get expect to build.
@
text
@d1 17
@


1.21
log
@        * test/iOUtil.test: Removed. Conflicted with real ioUtil.test
        file.
@
text
@d1 10
@


1.21.4.1
log
@Merge with kseitz_interps-20020809-merge of CVS head.
@
text
@a0 27
2002-07-31  Keith Seitz  <keiths@@redhat.com>

	* generic/tclIntDecls.h (TclIntStubs): Do not include definitions
	for tclpAlloc, tclpFree, or pRealloc on cygwin.

	* win/tcl.hpj.in: Copied here from tools/tcl.hpj.in.
	
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Add TCL_DLL_BASE, DDE_DLL_BASE,
	and REG_DLL_BASE variables to define DLL image bases on cygwin.
	Do not link with "-e _WinMain@@16" on cygwin.
	* win/configure.in (TCL_DLL_BASE): Substitute into makefile.
	(DDE_DLL_BASE): Likewise.
	(REG_DLL_BASE): Likewise.
	* win/configure: Regenerated.
	* win/Makefile.in: Use TCL_DLL_BASE, DDE_DLL_BASE, and
	REG_DLL_BASE to build DLLs.

2002-07-30  Keith Seitz  <keiths@@redhat.com>

	From Mo DeJong  <supermo@@bayarea.net>
	* cygwin/configure: Regenerated.
	* cygwin/configure.in: Emit a tclConfig.sh file
	so that expect can load it at configure time.
	* win/configure: Regenerated.
	* win/configure.in: Don't emit a ../unix/tclConfig.sh
	file, this was a hack to get expect to build.

@


1.21.4.2
log
@Merge with kseitz_interps-20020930-merge.
@
text
@a0 11
2002-09-13  Keith Seitz  <keiths@@redhat.com>

	From Mo Dejong  <supermo@@bayarea.net>:
	* win/tclWin32Dll.c (DllMain): Remove unused os
	variable since VC++ treats warnings as errors
	when compiling with symbols.

	* win/tclWinPort.h: Remove undefine of PASCAL
	symbol added on 2001-09-12. It caused
	crashing problems with sockets.

@


1.21.4.3
log
@merge from main line
@
text
@a0 5
2002-10-05  Christopher Faylor  <cgf@@redhat.com>

	* win/tclWin32Dll.c (tclWinTCharEncoding): Remove 'static' since it is
	declared in header as exportable extern.

@


1.20
log
@* cygwin/configure.in: Check for cygwin host rather than cygwin target.
* cygwin/configure: Regenerate.
@
text
@d1 5
@


1.19
log
@* win/configure.in: Modify 2001-10-05 change to check for cygwin host rather
than cygwin target.
* win/configure: Regenerate.
@
text
@d3 5
@


1.18
log
@* win/configure.in: Add detection for -mwin32 option requirement under cygwin.
* win/configure: Regenerate.
@
text
@d1 6
@


1.17
log
@	* generic/tclStubInit.tcl: Export tclAlloc functions
	if __MINGW32__ is defined.
	* generic/tclAlloc.c: Revert changes from 2001-09-12.
	* generic/tcl.h: Use tclAlloc function if __WIN32__
	is defined.
	* win/tclWinPort.h: Fixed typer __MWIN32 should read
	__WIN32__.
@
text
@d1 6
@


1.16
log
@
	* Makefile.in: Add 'cygwin' subdirectory to 'make all'
	target.
	* configure.in: Configure 'cygwin' and 'win' directory
	for a cygwin host.
	* configure: Regenerated.
	* cygwin/configure.in: Change version number to 8.3.
	* cygwin/configure: Regenerated.
	* cygwin/Makefile.am: Added/removed files to be build
	for Tcl8.3.
	* cygwin/Makefile.in: Regenerated.
	* generic/tcl.h: Don't define __WIN32__ for cygwin or
	mwing32 builds.  Don't define USE_TCLALLOC when building
	for cygwin.  Don't use __declspec unless building Tcl or
	tk or build with USE_TCL_STUBS.
	* generic/tclAlloc.c: For cygwin hosts, don't using
	anything in this file unless build with __TCL_UNIX_VARIANT.
	* generic/tclClock.c: Declare 'timezone' as an int, if it
	hasn't been #defined.
	* generic/tclStubInit.c: Don't export any tclAlloc function
	when build for a cygwin host.
	* win/configure.in: Set DL_LIBS and MATH_LIBS.  Create
	unix/tclConfig.sh.
	* win/configure: Regenerated.
	* win/tclWinPort.h: Added missing #endif.
	* win/tclWinFile.c (TclpChdir): Don't invert change
	directory results on cygwin.
@
text
@d1 10
@


1.15
log
@touched all Tcl files to ease next import.
@
text
@d1 29
@


1.14
log
@Tcl8.3 upgrade merge.
@
text
@@


1.13
log
@* sid build tree testing fix

2001-07-17  Frank Ch. Eigler  <fche@@redhat.com>

        * generic/tclInitScript.h (initScript): Check that nameofexecutable
        is valid (file exists) before traversing it as a possible link.
@
text
@d1 84
d90 323
d427 368
d819 1665
a2483 5
	'\'s.
	(TclDoGlob): Ditto.
	* win/tclWinFile.c (TclMatchFiles): Ditto.
	* generic/tclInitScript.h: Look in "../bin/usr/share" as well as
	"../bin/share".
d2485 1
d2487 3
d2491 1
d2495 3
d2499 1
d2501 3
d2505 1
d2511 5
d2517 5
d2525 3
d2529 1
d2531 126
d2658 1
d2661 4
d2666 1
d2681 957
d3639 1
a3639 1
1999-10-20  DJ Delorie  <dj@@cygnus.com>
d3641 5
a3645 1
	* Makefile.in: temporarily disable second subdirectory
d3647 1
a3647 1
1999-10-19  DJ Delorie  <dj@@cygnus.com>
d3649 2
a3650 7
	* Makefile.in: support two subdirectories
	* configure[.in]: for Cygwin, build both win and unix variants
	* generic/tclEnv.c: include windows.h for cygwin
	* generic/tclPort.h: If building the unix variant for cygwin,
	pretend we're a unix machine instead of a windows machine.
	* unix/Makefile.in: don't list -lc; it breaks on cygwin.
	* unix/tclUnixFCmd.c: don't support fifos on cygwin
d3652 2
a3653 1
1999-08-05  DJ Delorie  <dj@@cygnus.com>
d3655 741
a4395 1
	* win/tclWinInit.c (TclPlatformInit): add tcl_pkgPath hack
d4397 9
a4405 1
1999-05-18  Fred Fish  <fnf@@cygnus.com>
d4407 1
a4407 3
	* generic/tclPosixStr.c	(Tcl_ErrnoId): Avoid duplicate case when
	ENOTSUP and EOPNOTSUPP are defined to the same thing.
	(Tcl_ErrnoMsg): Ditto.
d4409 2
a4410 1
Fri Feb 26 17:40:55 1999  Geoffrey Noer  <noer@@cygnus.com>
d4412 11
a4422 4
        * win/configure.in: change "cygwin32*" to "cygwin*"
        * win/configure: Regenerated.
        * configure.in: Change "cygwin32*" to "cygwin*"
        * configure: Regenerate.
d4426 3
a4428 2
	* unix/configure.in: Forgot to AC_SUBST TCL_LIB_FULL_PATH
	* unix/configure: Regenerated.
d4430 1
a4430 1
1999-02-10  Syd Polk  <spolk@@cygnus.com>
d4432 1
d4435 3
d4439 2
d4442 1
a4442 1
1999-01-27  James Ingham  <jingham@@cygnus.com>
d4444 6
a4449 2
	* generic/tclInitScript.h: Added two missing \n\'s to initScript
	*generic/tclCmdIL.c: Fixed #ifdef that was giving gcc warning.
d4451 2
a4452 1
1999-01-20  James Ingham  <jingham@@cygnus.com>
d4454 1
d4461 47
d4509 1
a4509 1
Tue Nov 24 18:27:40 1998  Jim Ingham    jingham@@cygnus.com
d4511 1
a4511 1
        * Import of Tcl8.0.4 from Scriptics.
d4513 2
a4514 1
Thu Sep 17 17:03:18 1998  Martin M. Hunt  <hunt@@cygnus.com>
d4516 1
a4516 2
	* configure: Rebuilt
	* unix/configure: Rebuilt
d4518 2
a4519 1
Tue Aug 25 18:13:30 1998  Jim Ingham    <jingham@@cygnus.com>
d4521 1
a4521 3
        * init.tcl (tcl_findLibrary): Added an argument determining
        whether to source a packages init file into the TclPro
        debugger or not.
d4523 2
a4524 1
Thu Aug 20 14:32:59 1998  Jim Ingham    jingham@@cygnus.com
d4526 1
a4526 3
	* Import of Tcl 8.0.3 from Scriptics, with our modifications.
	I also changed the Sciptics startup code so it can find our
        libraries whether in the build tree or the install tree.
d4528 4
a4531 1
1998-07-03  Ben Elliston  <bje@@cygnus.com>
d4533 1
a4533 3
	Patches from Ian Roxborough <irox@@cygnus.com>.
	* generic/tclCmdIL.c (Tcl_LsearchObjCmd): Additional test when
	compiling with Microsoft Visual C++.
d4535 3
a4537 1
	* win/configure.in: Add AC_OBJEXT macro invocation.
d4539 64
d4605 7
a4611 1
	* win/Makefile.in: Don't assume object files end in `.o'.
d4613 1
a4613 2
	* win/tclWinPort.h (PASCAL): Define when compiling with Microsoft
	Visual C++.
d4615 1
a4615 3
	* win/tclWinSock.c (PASCAL): Likewise.
	
Tue Jun 30 18:56:27 1998 Jim Ingham <jingham@@cygnus.com>
d4617 1
a4617 4
	* generic/tclListObj.c (Tcl_SetListObj, SetListFromAny) Import a 
	change to the list code from tcl8.1 which prevents a crash 
	when you do Tcl_SetListObj(obj, 0, NULL) on an object which 
	has been created with Tcl_NewObj, but never written into.
d4619 1
a4619 1
Thu Jun 18 10:25:00 1998  Syd Polk  <spolk@@cygnus.com>
d4621 1
a4621 3
	* The import from Tcl 8.1a2 created all of the files that wer
	in the Tcl 8.1a2 distribution but not in devo. Since they
	are on their own branch, I removed them from devo.
d4623 1
a4623 1
Fri Jun 12 11:42:30 1998  Ian Lance Taylor  <ian@@cygnus.com>
d4625 1
a4625 1
	* win/install-sh: Remove.
d4627 2
a4628 1
Fri Jun 12 11:42:10 1998  Mumit Khan  <khan@@xraylith.wisc.edu>
d4630 1
a4630 14
	* configure.in (*-*-mingw32*): Support.
	* win/Makefile.in (TCL_ALLOC_OBJ, DLL_LDLIBS, DLL_LDFLAGS): New 
	variables.
	(TCLOBJS): Use TCL_ALLOC_OBJ.
	($(TMPDIR)/tclcyg.def): Ignore errors.
	($(TMPDIR)/tclplugin.def): Likewise.
	($(TCLDLL),$(TCLPLUGINDLL,$(TCLREGDLL)): Cleanup DLL build flags 
	and use TCL_ALLOC_OBJ, DLL_LDLIBS and DLL_LDFLAGS.
	* win/configure.in: Call AC_CANONICAL_HOST.
	(TCL_ALLOC_OBJ, DLL_LDLIBS, DLL_LDFLAGS): Define and substitute.
	(TCL_PATCH_LEVEL): Bump to p2.
	* win/tclWinPort.h (environ, hypot, exception): Define for Mingw32.
	(EDEADLOCK): Undefine for Mingw32.
	* win/configure: Rebuild.
d4632 23
a4654 1
Fri May 29 17:11:01 1998  Ian Lance Taylor  <ian@@cygnus.com>
d4656 3
a4658 2
	* win/Makefile.in (install-minimal): Don't create
	INCLUDE_INSTALL_DIR.
d4660 5
a4664 1
Sun May 24 11:18:28 1998  Khamis Abuelkomboz  <khamis@@mxbig.multix.de>
d4666 13
a4678 2
	* generic/tclCmdIL.c (Tcl_LsearchObjCmd): using strnicmp for MSVC,
	strncasecmp otherwise.
d4680 3
a4682 6
Fri May 22 16:56:53 1998  Khamis Abuelkomboz  <khamis@@mxbig.multix.de>

	* generic/tclCmdIL.c (NOCASE): let lsearch accept "-nocase"
	(DICTIONARY): likewise, a synonym for "nocase".
	So you can call lsearch with a "-nocase" or "-dictionary" flag to
	use strcasecmp to find an item.
d5377 1
@


1.12
log
@Fixes for newer cygwin gccs.
Use modern Cygwin conditional.
@
text
@d1 5
@


1.11
log
@*** empty log message ***
@
text
@d1 14
@


1.10
log
@2000-12-13  Syd Polk  <spolk@@redhat.com>

	* unix/configure.in: Stop calculating TCL_BIN_DIR.
	* unix/configure: Regenerate.
@
text
@a30 6
2000-05-23  Syd Polk  <spolk@@redhat.com>

	* unix/Makefile.in: Calculate TCL_BIN_DIR.
	* win/Makefile.in: Calculate TCL_BIN_DIR.
	* unix/tclConfig.sh.in: Export TCL_BIN_DIR.

@


1.9
log
@2000-05-23  Syd Polk  <spolk@@redhat.com>

	* unix/Makefile.in: Calculate TCL_BIN_DIR.
	* win/Makefile.in: Calculate TCL_BIN_DIR.
	* unix/tclConfig.sh.in: Export TCL_BIN_DIR.
@
text
@a0 6
2000-05-23  Syd Polk  <spolk@@redhat.com>

	* unix/Makefile.in: Calculate TCL_BIN_DIR.
	* win/Makefile.in: Calculate TCL_BIN_DIR.
	* unix/tclConfig.sh.in: Export TCL_BIN_DIR.

d30 6
@


1.8
log
@* win/tclWinFile.c (TclMatchFiles): Revert Mon Jun 5 18:48:32 2000 Christopher
Faylor <cgf@@cygnus.com>.  Fails on Windows 95.
@
text
@d1 6
@


1.7
log
@Change various Makefile.in to use standard autoconf variables.
@
text
@d1 5
@


1.6
log
@* generic/tclFilename.c (Tcl_TranslateFileName): Reinstate Mon Jun 5 18:18:32
2000 Christopher Faylor <cgf@@cygnus.com> minus a typo.
@
text
@d1 5
@


1.5
log
@Revert part of Mon Jun 5 18:48:32 2000 Christopher Faylor
<cgf@@cygnus.com>, didn't compile.
@
text
@d1 5
@


1.4
log
@* generic/tclFileName.c (Tcl_TranslateFileName): Cygwin paths (and Windows in
general, actually) do not need to have '/'s translated into '\'s.
(TclDoGlob): Ditto.
* win/tclWinFile.c (TclMatchFiles): Ditto.
* generic/tclInitScript.h: Look in "../bin/usr/share" as well as
"../bin/share".
@
text
@d1 5
@


1.3
log
@From Alexandre Oliva <aoliva@@cygnus.com>
* generic/tclPosixStr.c (Tcl_SignalId, Tcl_SignalMsg): Do not
issue SIGPWR case if it's the same as SIGLOST.
@
text
@d1 10
@


1.2
log
@2000-02-06  Jason Molenda  (jsm@@bugshack.cygnus.com)

	* ChangeLog: Whitespace change to test logging.
	* bfd/ChangeLog, dejagnu/ChangeLog, include/ChangeLog, tcl/ChangeLog: Same.
@
text
@d1 6
@


1.2.2.1
log
@From Alexandre Oliva <aoliva@@cygnus.com>
* generic/tclPosixStr.c (Tcl_SignalId, Tcl_SignalMsg): Do not
issue SIGPWR case if it's the same as SIGLOST.
@
text
@a0 6
Thu Apr 20 17:01:19 2000  Andrew Cagney  <cagney@@b1.cygnus.com>

	From Alexandre Oliva <aoliva@@cygnus.com>
	* generic/tclPosixStr.c (Tcl_SignalId, Tcl_SignalMsg): Do not
	issue SIGPWR case if it's the same as SIGLOST.

@


1.1
log
@Initial revision
@
text
@d1 17
d71 1
a71 1
	* unix/configure.in unix/tclConfig.sh.in: Export TCL_LIB_FULL_PATH 
d87 1
a87 1
	undone. 
@


1.1.1.1
log
@import dejagnu-1999-11-08 snapshot
@
text
@@


1.1.1.2
log
@import dejagnu-1999-11-15 snapshot
@
text
@a0 5
1999-11-09  DJ Delorie  <dj@@cygnus.com>

	* cygwin/*: redone with automake for cygwin-specific info (from cgf)
	to support cross-host builds

@


1.1.1.3
log
@import dejagnu-2000-01-17 snapshot
@
text
@a0 6
2000-01-17  Drew Moseley  <dmoseley@@cygnus.com>

	* cygwin/configure.in: Fixed bug in setting of shell variable which
	caused it to be interpreted as a subcommand rather than a variable.
	* cygwin/configure: Regenerated.

@


1.1.1.4
log
@import dejagnu-2000-01-31 snapshot
@
text
@a0 6
2000-01-26  DJ Delorie  <dj@@cygnus.com>

	* win/tclWin32Dll.c (DllMain): Use standard _imp__reent_data,
	not old-style __imp_reent_data
	* generic/tclEnv.c (environ): ditto for _imp____cygwin_environ

@


1.1.1.5
log
@Tcl 8.3 upgrade
@
text
@d1 1
a1 1
2001-08-08  Mo DeJong  <mdejong@@redhat.com>
d3 3
a5 2431
	* cygtcl.m4 (TCL_TOOL_PATH, TCL_TOOL_SHARED_LIB_LONGNAME):
	Raise an error if the CYGPATH variable is not defined when
	TCL_TOOL_PATH is invoked. Add cygwin to the list of hosts
	that do not use a "lib" prefix for shared library names.
	* unix/configure: Regen.
	* win/configure: Regen.

2001-08-06  Mo DeJong  <mdejong@@redhat.com>

	* cygtcl.m4 (TCL_TOOL_STATIC_LIB_LONGNAME,
	TCL_TOOL_SHARED_LIB_LONGNAME,
	TCL_TOOL_LIB_SHORTNAME): Use TCL_VENDOR_PREFIX instead
	of VENDORPREFIX to support using these macros in
	extensions that load tclConfig.sh.
	* unix/configure: Regen.
	* unix/configure.in: Subst VENDORPREFIX into tclConfig.sh.
	* unix/tclConfig.sh.in: Add TCL_VENDOR_PREFIX.
	* win/configure: Regen.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Set vendor prefix to "rh"
	instead of "sn" when compiling with VC++ or gcc. When
	compiling with Cygwin set the prefix to "cyg". Set the
	TCL_VENDOR_PREFIX to support the tcl tool macros in Tcl.
	* win/tclConfig.sh.in: Add TCL_VENDOR_PREFIX.

2001-08-06  Mo DeJong  <mdejong@@redhat.com>

	* win/Makefile.in: Subst DDE_DLL_FILE, DDE_LIB_FILE, REG_DLL_FILE,
	REG_LIB_FILE, and PIPE_DLL_FILE from the configure script instead
	of figuring them out in the Makefile.
	* win/configure: Regen.
	* win/configure.in: Use TCL_TOOL_STATIC_LIB_LONGNAME and
	TCL_TOOL_SHARED_LIB_LONGNAME macros to figure out values for
	DDE_DLL_FILE, DDE_LIB_FILE, REG_DLL_FILE, REG_LIB_FILE, and
	PIPE_DLL_FILE and subst them into the Makefile.

2001-08-01  Mo DeJong  <mdejong@@redhat.com>

	* cygtcl.m4 (TCL_TOOL_STATIC_LIB_LONGNAME,
	TCL_TOOL_SHARED_LIB_LONGNAME): Rename
	TCL_TOOL_LIB_LONGNAME to TCL_TOOL_STATIC_LIB_LONGNAME.
	Add new TCL_TOOL_SHARED_LIB_LONGNAME to construct
	shared library names in a cross platform way.
	* unix/configure: Regen.
	* unix/configure.in: Use TCL_TOOL_SHARED_LIB_LONGNAME
	and TCL_TOOL_STATIC_LIB_LONGNAME to generate lib names.
	* win/configure: Regen.
	* win/configure.in: Use TCL_TOOL_SHARED_LIB_LONGNAME
	and TCL_TOOL_STATIC_LIB_LONGNAME to generate lib names.

2001-07-24  Mo DeJong  <mdejong@@redhat.com>

	* win/configure:
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Don't pass explicit
	Cygwin libs on the command line since linking is now
	done using $CC and not $LD.

2001-07-24  Mo DeJong  <mdejong@@redhat.com>

	* win/tclWinThrd.c (Tcl_CreateThread, TclpThreadExit):
	When building under Cygwin, call CreateThread instead
	of _beginthreadex and call ExitThread instead of
	_endthreadex. Cygwin does not support these msvcrt
	methods and does not suffer from the memory leak
	problems that prompted their use.

2001-07-24  Mo DeJong  <mdejong@@redhat.com>

	* win/configure: Regen.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Check for bug in
	Cygwin version of windres and work around that
	case by passing a POSIX path instead of a Windows
	native path. One can't always pass a POSIX path
	because the mingw native toolchain accepts only
	Windows native paths.

2001-07-24  Mo DeJong  <mdejong@@redhat.com>

	* win/tclWinThrd.c (Tcl_CreateThread): Close Windows
	HANDLE returned by _beginthreadex. The MS documentation
	states that this handle is not closed by a later call to
	_endthreadex.

2001-07-16  Mo DeJong  <mdejong@@redhat.com>

	* generic/tcl.h: Define __WIN32__ when
	__CYGWIN__ or __MINGW32__ is defined.
	* generic/tclAlloc.c: Define caddr_t when
	compiling with VC++ or mingw. This type is
	already defined when compiling with Cygwin.

2001-07-16  Mo DeJong  <mdejong@@redhat.com>

	* win/tclWinConsole.c:
	* win/tclWinPipe.c:
	* win/tclWinPort.h:
	* win/tclWinThrd.c:
	Remove unnecessary #includes of dos.h, direct.h,
	and tchar.h. This will help the Cygwin porting
	effort since these headers do not exist under Cygwin.

2001-07-12  Mo DeJong  <mdejong@@redhat.com>

	* unix/Makefile.in:
	* unix/configure: Regen.
	* unix/configure.in:
	* unix/tcl.m4:
	* win/Makefile.in:
	* win/configure: Regen.
	* win/configure.in:
	* win/tcl.m4:
	Revert ill-conceived EXTRA_CFLAGS changes made on 2001-07-09.
	The change ended up causing big problems with the
	tclConfig.sh file since	it exported EXTRA_CFLAGS and did
	not deal with the debug/non-debug case.

2001-07-11  Mo DeJong  <mdejong@@redhat.com>

	* unix/configure: Regen.
 	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Avoid using AC_CHECK_TOOL
	since Tcl's configure script is not setup properly.

2001-07-11  Mo DeJong  <mdejong@@redhat.com>

	* unix/Makefile.in: Add AR variable for use in STLIB_LD.
	* unix/configure: Regen.
	* unix/configure.in: Use STLIB_LD when defining MAKE_LIB
	and MAKE_STUB_LIB. Subst RANLIB and AR.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Add doc comment about
	STLIB_LD command. Check ${AR} env var when setting
	STLIB_LD and delay evaluation until make time.
	* win/configure: Regen.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Pass AR arguments in
	STLIB_LD to better match the Unix implementation. Don't
	bother defining AR when using VC++ since it is not used.

2001-07-10  Mo DeJong  <mdejong@@redhat.com>

	* win/configure:
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Use STLIB_LD in MAKE_LIB instead
	of AR which can be overridden on the make command line.

2001-07-09  Mo DeJong  <mdejong@@redhat.com>

	* win/configure:
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Fix quoting of CYGPATH
	argument to AC_CHECK_PROG.

2001-07-09  Mo DeJong  <mdejong@@redhat.com>

	* unix/Makefile.in: Add EXTRA_CFLAGS_DEBUG and EXTRA_CFLAGS_OPTIMIZE
	variables. These two do not actually differ in the unix version
	but are there to keep in sync with the Windows version.
	* unix/configure: Regen.
	* unix/configure.in: Don't subst EXTRA_CFLAGS. Subst EXTRA_CFLAGS_DEFAULT,
	EXTRA_CFLAGS_DEBUG, and EXTRA_CFLAGS_OPTIMIZE.
	* unix/tcl.m4 (SC_ENABLE_SYMBOLS, SC_CONFIG_CFLAGS): Define
	EXTRA_CFLAGS_DEFAULT based on the --enable-smbols option.
	Set EXTRA_CFLAGS_DEBUG instead of EXTRA_CFLAGS and then set
	EXTRA_CFLAGS_OPTIMIZE to the value of EXTRA_CFLAGS_DEBUG since
	they are the same under Unix.
	* win/Makefile.in: Add EXTRA_CFLAGS_DEBUG and EXTRA_CFLAGS_OPTIMIZE
	variables. This is needed so that the proper runtime lib gets linked
	into VC++ produced .obj files when CFLAGS is reset on the command line.
	* win/configure: Regen.
	* win/configure.in: Don't subst EXTRA_CFLAGS. Subst EXTRA_CFLAGS_DEFAULT,
	EXTRA_CFLAGS_DEBUG, and EXTRA_CFLAGS_OPTIMIZE.
	* win/tcl.m4 :(SC_ENABLE_SYMBOLS, SC_CONFIG_CFLAGS): Define
	EXTRA_CFLAGS_DEFAULT based on the --enable-smbols option. Set
	EXTRA_CFLAGS_DEBUG and EXTRA_CFLAGS_OPTIMIZE based on the runtime
	option when compiled with VC++.

2001-07-06  Mo DeJong  <mdejong@@redhat.com>

	* win/configure: Regen.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Pass -e _WinMain@@16 in
	addition to the -mwindows flag to work around a problem
	with ld when it incorrectly uses main() as the executable
	entry point when both WinMain() and main() are available.

2001-07-06  Mo DeJong  <mdejong@@redhat.com>

	* unix/configure: Regen.
	* unix/configure.in: Replace call to SC_ENABLE_GCC with
	AC_PROG_CC so that CC passed in from the caller is respected.
	* unix/tcl.m4: Remove the unused SC_ENABLE_GCC macro.
	* win/configure: Regen.
	* win/configure.in: Replace call to SC_ENABLE_GCC with
	AC_PROG_CC so that CC passed in from the caller is respected.
	* win/tcl.m4: Remove unused SC_ENABLE_GCC macro.

2001-07-06  Mo DeJong  <mdejong@@redhat.com>

	* win/Makefile.in: Subst DEPARG directly instead
        of relying on a variable. This will make Cygwin
        builds faster since an extra exec will be avoided.
	* win/configure: Regen.
	* win/configure.in: Subst DEPARG.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Set DEPARG based
	on CYGPATH.

2001-06-26  Mo DeJong  <mdejong@@redhat.com>

	* cygtcl.m4 (TCL_TOOL_PATH): Use CYGPATH variable instead of
	invoking cygpath directly. Handle cross compile by not
	using CYGPATH when set to echo.
	* unix/configure: Regen.
	* win/Makefile.in: Remove PATHTYPE variable.
	* win/configure: regen.
	* win/configure.in: Remove PATHTYPE subst + extra CYGPATH subst.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Remove PATHTYPE variable. Search
	for cygpath in the PATH and set CYGPATH="cygpath -w" if found.
	Remove old cross compiling hack.

2001-06-26  Mo DeJong  <mdejong@@redhat.com>

	* win/Makefile.in: Don't use VPSEP in the VPATH,
	just use : as the spearator.
	* win/configure: Regen.
	* win/configure.in: Don't subst VPSEP.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Remove VPSEP.

2001-06-25  Mo DeJong  <mdejong@@redhat.com>

	* win/configure: Regen.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): When building with
	gcc, don't attempt to link with LD or support dllwrap.
	Simply require a recent version of Cygwin gcc or Mingw
	gcc that supports -shared. When linking, use gcc instead
	of ld since gcc automatically includes libs like -lmsvcrt.

2001-06-22  Mo DeJong  <mdejong@@redhat.com>

	* unix/Makefile.in: Set CFLAGS to @@CFLAGS@@ and @@CFLAGS_DEFAULT@@.
	Set LDFLAGS to @@LDFLAGS@@ and @@LDFLAGS_DEFAULT@@. Add LDFLAGS_DEBUG
	and LDFLAGS_OPTIMIZE to match the way CFLAGS_DEFAULT works.
	This will support user set CFLAGS or LDFLAGS at configure time.
	* unix/configure: Regen.
	* unix/configure.in: Don't set CFLAGS to CFLAGS_DEFAULT, instead
	subst CFLAGS_DEFAULT into the Makefile. Add AC_SUBST for CFLAGS_DEFAULT,
	LDFLAGS_DEFAULT, LDFLAGS_DEBUG, and LDFLAGS_OPTIMIZE.
	* unix/tcl.m4 (SC_ENABLE_SYMBOLS): Modify LDFLAGS_DEFAULT so that
	it uses a Makefile variable just like CFLAGS_DEFAULT.
	* win/Makefile.in: Set CFLAGS to @@CFLAGS@@ and @@CFLAGS_DEFAULT@@.
	Set LDFLAGS to @@LDFLAGS@@ and @@LDFLAGS_DEFAULT@@.
	This will support user set CFLAGS or LDFLAGS at configure time.
	* win/configure: Regen.
	* win/configure.in: Don't set CFLAGS or LDFLAGS, instead subst
	CFLAGS_DEFAULT and LDFLAGS_DEFAULT into the Makefile.
	* win/tcl.m4 (SC_ENABLE_SYMBOLS): Modify LDFLAGS_DEFAULT so that
	it uses a Makefile variable just like CFLAGS_DEFAULT.

2001-06-22  Mo DeJong  <mdejong@@redhat.com>

	* configure: Regen.
	* configure.in: When a windows32 host is detected
	configure in the win subdirectory.
	* cygtcl.m4 (TCL_TOOL_PATH, TCL_TOOL_LIB_LONGNAME,
	TCL_TOOL_LIB_SHORTNAME, TCL_TOOL_LIB_SPEC):
	Add support for mingw32 and windows32 hosts. Remove
	check for cygwin since we are really cross compiling
	when building win32 executables.
	* unix/configure: Regen.
	* win/configure: Regen.

2001-06-22  Mo DeJong  <mdejong@@redhat.com>

	* win/configure:
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Don't set LDFLAGS_DEBUG
	to -g or LDFLAGS_OPTIMIZE to -O when compiling with gcc.
	These flags are not needed and can cause problems with
	the Cygwin version of ld.

2001-06-20  Mo DeJong  <mdejong@@redhat.com>

	* generic/tcl.h: Define __WIN32__ when __MINGW32__
	is defined to support building under Cygwin gcc
	with the -mno-cygwin flag.

2001-06-14  Mo DeJong  <mdejong@@redhat.com>

	* unix/Makefile.in: Avoid burning install TCL_LIBRARY into
	tclUnixInit.o at compile time.
	* unix/tclUnixInit.c (TclpInitLibraryPath): Fix location
	independence by searching for Tcl library in share/tclX.X
	instead of lib/tclX.X. This logic is no longer effected by a
	burned in TCL_LIBRARY.
	* win/tclWinInit.c (TclpInitLibraryPath): Search for Tcl library
	in share/tclX.X instead of lib/tclX.X. Remove a couple of
	Cygnus local hacks since they were not doing anything useful.

2001-06-08  Mo DeJong  <mdejong@@redhat.com>

	* win/Makefile.in: Set TCL_LIBRARY to
	$INSTALL/share/tcl8.3 instead of
	$INSTALL/lib/tcl8.3.

2001-06-08  Mo DeJong  <mdejong@@redhat.com>

	* win/tclConfig.sh.in: Correct the definition
	of TCL_LIB_FULL_PATH. It was inclosed in `
	characters instead of ' characters.

2001-06-05  Mo DeJong  <mdejong@@redhat.com>

	* unix/configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Add a TCL_LIB_SUFFIX variable
	to make the TCL_TOOL_LIB_SHORTNAME macro happy.
	* unix/tclConfig.sh.in: Add TCL_LIB_SUFFIX variable.

2001-06-05  Mo DeJong  <mdejong@@redhat.com>

	* cygtcl.m4 (TCL_TOOL_LIB_PATH): Call TCL_TOOL_PATH so that a
	Windows native path is generated for PATH variables.
	* unix/configure: Regen.
	* win/configure: Regen.

2001-06-01  Mo DeJong  <mdejong@@redhat.com>

	* cygtcl.m4 (TCL_TOOL_PATH, TCL_TOOL_LIB_SHORTNAME): Check that argument to
	TCL_TOOL_PATH is not "". Use new TCL_LIB_SUFFIX variable in the
	TCL_TOOL_LIB_SHORTNAME macro under Windows.
	* unix/configure: Regen.
	* win/configure: Regen.
	* win/configure.in: Don't subst SHLIB_SUFFIX.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Set TCL_LIB_SUFFIX so that Tcl
	sees the same variable name that an extension will.
	* win/tclConfig.sh.in: Set the TCL_SHLIB_SUFFIX and TCL_LIB_SUFFIX vars.

2001-05-30  Mo DeJong  <mdejong@@redhat.com>

	* unix/configure: Regen.
	* unix/tcl.m4 (SC_PATH_TCLCONFIG, SC_PATH_TKCONFIG):
	Check in win subdirectory in addition to unix subdirectory for
	tclConfig.sh and tkConfig.sh files.

2001-05-30  Mo DeJong  <mdejong@@redhat.com>

	* cygtcl.m4: Add FIXME note.
	* unix/configure: Regen.
	* unix/tcl.m4 (SC_PATH_TCLCONFIG, SC_PATH_TKCONFIG):
	Generate an error instead of a warning if the Tcl, or Tk
	configuration files cannot be found.

2001-05-26  Mo DeJong  <mdejong@@redhat.com>

	* cygtcl.m4 (TCL_TOOL_PATH, TCL_TOOL_LIB_LONGNAME,
	TCL_TOOL_LIB_SHORTNAME, TCL_TOOL_LIB_SPEC): Create cross
	platform versions of the TCL_TOOL* macros.
	* unix/aclocal.m4: Include ../cygtcl.m4.
	* unix/configure: Regen.
	* unix/tcl.m4 (TCL_TOOL_PATH, TCL_TOOL_LIB_LONGNAME,
	TCL_TOOL_LIB_SHORTNAME, TCL_TOOL_LIB_SPEC): Remove macros.
	* win/aclocal.m4: Include ../cygtcl.m4.
	* win/configure: Regen.
	* win/tcl.m4 (TCL_TOOL_PATH, TCL_TOOL_LIB_LONGNAME,
	TCL_TOOL_LIB_SHORTNAME, TCL_TOOL_LIB_SPEC): Remove macros.
	
2001-05-24  Mo DeJong  <mdejong@@redhat.com>

	* unix/configure: Regen.
	* unix/configure.in: Add missing TCL_LIB_FULL_PATH
	variable.

2001-05-11  Mo DeJong  <mdejong@@redhat.com>

	* unix/configure:
	* unix/tcl.m4 (SC_ENABLE_SYMBOLS):
	* win/configure:
	* win/tcl.m4 (SC_ENABLE_SYMBOLS): Back port of CFLAGS_DEFAULT fix
	from Tcl 8.4. A Makefile variable name is now used for the CFLAGS.

2001-05-09  Mo DeJong  <mdejong@@redhat.com>

	* win/tcl.m4 (TCL_TOOL_PATH): Assign literal macro
	value to a tmp variable before running cygpath
	thus avoiding a problem with a quoted argument.

2001-05-09  Mo DeJong  <mdejong@@redhat.com>

	* unix/Makefile.in: Use TCL_STUB_LIB_FILE instead of
	STUB_LIB_FILE subst when defining STUB_LIB_FILE.
	* unix/configure: Regen.
	* unix/configure.in: Use new path macros.
	* unix/tcl.m4 (TCL_TOOL_LIB_LONGNAME, TCL_TOOL_LIB_SHORTNAME,
	TCL_TOOL_LIB_SPEC, TCL_TOOL_LIB_PATH): Add macros
	to deal with library path translations.
	* win/Makefile.in: Add FIXME note.
	* win/configure: Regen.
	* win/configure.in: Use new path macros.
	* win/tcl.m4 (TCL_TOOL_LIB_LONGNAME, TCL_TOOL_LIB_SHORTNAME,
	TCL_TOOL_LIB_SPEC, TCL_TOOL_LIB_PATH): Add macros
	to deal with library path translations.

2001-04-09  Mo DeJong  <mdejong@@redhat.com>

	* unix/configure: Regen.
	* unix/tcl.m4: Add placeholder TCL_TOOL_PATH macro.
	* win/configure: Regen.
	* win/configure.in: Set TCL_LIB_FLAG, TCL_BUILD_LIB_SPEC,
	TCL_LIB_SPEC, TCL_LIB_FULL_PATH and subst them.
	* win/tcl.m4: Add TCL_TOOL_PATH macro, it will call
	cygpath -w and replace \ with / to create a native
	Windows path that VC++ will understand.
	* win/tclConfig.sh.in: Add TCL_LIB_FULL_PATH variable.

2001-04-05  Mo DeJong  <mdejong@@redhat.com>

	* win/configure: Regen.
	* win/configure.in: Subst the TCL_LIB_VERSIONS_OK variable.
	* win/tcl.m4: Add Cygnus local search for tcl8.1/win directory. Add
	TCL_LIB_VERSIONS_OK variable, it will get substituted into the
	tclConfig.sh file. Remve the SC_PROG_TCLSH macro.

2001-04-05  Mo DeJong  <mdejong@@redhat.com>

	* generic/tclAlloc.c:
	* win/tclWinPort.h:
	Check for #define of WIN32 instead of VC++ specific symbol.

2001-03-31  Mo DeJong  <mdejong@@redhat.com>

	* unix/Makefile.in: Remove second
	assignment to SCRIPT_INSTALL_DIR
	variable. This seems to have been
	a merge error. It was installing
	Tcl lib files in the lib directory
	instead of share/tcl8.3.

2001-03-28  Ian Roxborough  <irox@@redhat.com>

	* unix/tclConfig.sh.in: Set TCL_CFLAGS to CFLAGS,
	otherwise tclConfig.sh won't work correctly.

2000-09-15  Syd Polk  <spolk@@redhat.com>

	* Updated for the 8.3.2 release.

2000-08-08  Jeff Hobbs  <hobbs@@ajubasolutions.com>

	8.3.2 RELEASE finalized

	* changes: updated for release notes version of ChangeLog

	* library/msgcat1.0/pkgIndex.tcl: 
	* library/msgcat1.0/msgcat.tcl: bumped msgcat version to 1.1.

2000-08-07  Jeff Hobbs  <hobbs@@ajubasolutions.com>

	* doc/ChnlStack.3:
	* doc/CrtChannel.3: updated the docs to be aware of the
	TCL_CHANNEL_VERSION_2 style of Tcl channels.

	* generic/tclIO.c (Tcl_CreateChannel): added assertion to verify
	that the new channel versioning will be binary compatible with
	older channel drivers.

	* BACKPORTED FROM 8.4 (HEAD) BRANCH:

	* doc/memory.n: Man page for Tcl "memory" command, which is
	created when TCL_MEM_DEBUG is defined at compile time.

	* doc/TCL_MEM_DEBUG.3: Man page with overall information about
	TCL_MEM_DEBUG usage.

	* doc/DumpActiveMemory.3: Man page for Tcl_DumpActiveMemory,
	Tcl_InitMemory, and Tcl_ValidateAllMemory [Bug: 1816, 1835].

	* doc/Init.3: Man page for Tcl_Init [Bug: 1820].

	* unix/Makefile.in: add tclsh.ico and tcl.spec to dist target

	* unix/mkLinks: Regen'd with new mkLinks.tcl.
	* unix/mkLinks.tcl: Fixed indentation, made link setup more
	intelligent (only do one existance test per man page, instead of
	one per function).

	* doc/AddErrInfo.3:
	* doc/ChnlStack.3:
	* doc/Exit.3:
	* doc/GetIndex.3:
	* doc/Notifier.3:
	* doc/Object.3:
	* doc/RegExp.3:
	* doc/SetResult.3:
	* doc/SplitList.3:
	* doc/Thread.3:  Added missing entries to NAME section.

	* doc/AddErrInfo.3:
	* doc/CrtObjCmd.3:
	* doc/RecEvalObj.3: Changed Tcl_EvalObj to Tcl_EvalObjEx

	* doc/library.n: Added entries for auto_qualify and auto_import
	[Bug: 1271].
	* doc/library.n: Fixed .SH NAME macro to include each function
	documented on the page, so that mkLinks will know about the
	functions listed there, and so that the Windows help file index
	will get set up correctly [Bug: 1898, 5273].

	* doc/expr.n: Added documentation for each of the math library
	functions that expr supports [Bug: 1054].

	* doc/regsub.n: correct regsub docs [Bug: 5346]

	* doc/scan.n: minor doc fixes [Bug: 5396]

	* doc/RegExp.3: Replaced instances of "Tcl_GetRegExpInfo" with
	"Tcl_RegExpGetInfo", the correct name of the function [Bug: 5901].

	* doc/package.n: Corrected information about [package forget]
	arguments [Bug: 5418].

	* generic/tclCkalloc.c: Fixed some function headers.

	* tests/clock.test: Added test for "2 days 2 hours ago" style
	specifications.

	* generic/tclDate.c: Regenerated from tclGetDate.y.

	* generic/tclGetDate.y: Tweaked grammar to properly handle the
	"ago" keyword when it follows multiple relative unit specifiers,
	as in "2 days 2 hours ago".  [Bug: 5497].

	* generic/tclClock.c (FormatClock): correct code to handle locale
	specific return values from strftime, if any. [Bug: 3345]

	* unix/tclUnixInit.c (TclpSetInitialEncodings): attempt to
	correct setlocale calls for XIM support and locale issues.
	[BUG: 5422 3345 4236 2522 2521]

	* library/init.tcl (auto_import): added check to see if a valid
	pattern was coming in, to avoid simple error cases [Bug: 3326]

	* library/history.tcl: Corrected an off-by-one error in HistIndex,
	which was causing [history redo] to start its search at the wrong
	event index. [Bug: 1269].

	* generic/tclPosixStr.c (Tcl_SignalMsg): clarified #defines for
	Linux on Sparc to compile correctly. [Bug: 5364]

	* generic/tclEnv.c: cast cleanup [Bug: 5624]
	* win/tclWinFCmd.c: cast cleanup [Bug: 5627]

	* generic/tclIndexObj.c (Tcl_GetIndexFromObjStruct): Corrected
	caching of the index ptr to account for offsets != sizeof(char *).
	[Bug: 5153]

	* tests/opt.test:
	* library/opt0.4/optparse.tcl: Applied patch from [Bug: 5922], which 
	corrected an incorrect use of [string match].

	* tests/stringObj.test: Tweaked tests to avoid hardcoded
	high-ASCII characters (which will fail in multibyte locales);
	instead used \uXXXX syntax. [Bug: 3842].

2000-08-05  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclIOGT.c (TclChannelTransform): fixed segfault that
	would occur when transforming a channel with a proc that did not
	yet exist. (Kupries)

	* generic/tclTest.c (TestChannelCmd): added some lint init'ing of
	statePtr and chan vars.

2000-07-28  Mo DeJong  <mdejong@@redhat.com>

	* win/Makefile.in:
	* win/configure.in:
	* win/tcl.m4:
	* win/tclConfig.sh.in: Back port of gcc for windows
	build system from 8.4.

2000-07-26  Jeff Hobbs  <hobbs@@scriptics.com>

	* merged core-8-3-1-io-rewrite back into core-8-3-1-branch.
	The core-8-3-1-io-rewrite branch should now be considered defunct.

	* generic/tclStubInit.c:
	* generic/tclDecls.h:
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclIO.c: moved the Tcl_Channel* macros from tcl.h to
	tclIO.c and made them proper stubbed functions.  These are:
	Tcl_ChannelName, Tcl_ChannelVersion, Tcl_ChannelBlockModeProc,
	Tcl_ChannelCloseProc, Tcl_ChannelClose2Proc, Tcl_ChannelInputProc,
	Tcl_ChannelOutputProc, Tcl_ChannelSeekProc, Tcl_ChannelSetOptionProc,
	Tcl_ChannelGetOptionProc, Tcl_ChannelWatchProc,
	Tcl_ChannelGetHandleProc, Tcl_ChannelFlushProc,
	and Tcl_ChannelHandlerProc.  These should be used to access the
	Tcl_ChannelType structure instead of direct pointer dereferencing.

	* unix/Makefile.in: undid 07-25 Makefile.in changes because we
	don't really want to force all private makefiles on everyone.
	This needs to be addressed again in the future.  Best possible
	solution is to create a tcl/ subdir in the installing include dir
	(as is done already with the lib dir).

	* tests/iogt.test: added RCS string, marked tests 2.* to be
	unixOnly due to underlying system differences.

	* tests/all.tcl: corrected additional sets by Kupries for testing.

2000-07-26  Syd Polk  <spolk@@redhat.com>

	* win/tcl.m4: Building libraries is significantly different on Cygwin
	now; rewhacked.
	* win/configure.in: Ditto.
	* win/Makefile.in: Ditto.
	* win/configure: Regenerated.
	* win/tclWinPort.h: tchar.h and direct.h are not defined on Cygwin,
	nor or they needed.


2000-07-25 Brent Welch	<welch@@ajubasolutions.com>

	* unix/Makefile.in: Need to install all the Tcl headers because
	Itcl depends on internal headers.

2000-07-25 Andreas Kupries <a.kupries@@westend.com>

	* tests/iogt.test: (line 866f) New tests iogt-6.[01], highlighting
 	  buffering trouble when stacking and unstacking transformations.
	  iogt-6.0 is solved, see the changes below. iogt-6.1 remains, for
 	  now, due to the perceived complexity of solutions.

	* generic/tclIO.h: (line 139f) struct Channel, added a buffer
	  queue, to hold data pushed back when stacking a transformation.

	* generic/tclIO.c:
	  (line 91f, line 7434f) New internal function 'CopyBuffer'.
	  Derived from 'CopyAndTranslateBuffer', with translation
	  removed.
	  (line 1025f, line 1212f): Initialization of new queue.
	  (line 1164f, Tcl_StackChannel): Pushback of input queue.
	  (line 1293f, Tcl_UnstackChannel): Discard input and pushback.
	  (line 3748f, Tcl_ReadRaw): Modified to use data in the push back
	  area before going to the driver. Uses 'CopyBuffer', s.a.
	  (line 4702f, GetInput): Modified to use data in the push back
	  area before going to the driver.
 	  (line 4867f, Tcl_Seek): Modified to take pushback of the topmost
	  channel in a stack into account.
	  (line 5620f, Tcl_InputBuffered): See above. Added
	  'Tcl_ChannelBuffered'. Analogue to 'Tcl_InputBuffered' but for
	  the buffer area in the channel.

	* generic/tcl.decls: New public API 'Tcl_ChannelBuffered'. S.a.

2000-07-19  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/socket.test: removed doTestsWithRemoteServer constraint
	from socket-12.*.  It requires 'exec', not a remote server.
	Cleaned up some coding errors.

2000-07-18 Brent Welch	<welch@@ajubasolutions.com>

	* win/Makefile.in: Added rules for static tcldde and tclreg libraries.

2000-07-17  Jeff Hobbs  <hobbs@@scriptics.com>

	* README:
	* win/README:
	* win/README.binary:
	* win/configure.in:
	* unix/configure.in:
	* unix/tcl.spec:
	* tools/tcl.wse.in:
	* generic/tcl.h (TCL_RELEASE_SERIAL): updated to patchlevel 8.3.2

	* unix/Makefile.in:
	* win/Makefile.in:
	* win/makefile.vc: added tclIOGT.c to objects list to compile.

	* generic/tclStubInit.c:
	* generic/tclIntDecls.h:
	* generic/tclInt.decls: commented out internal decls for
	TclTestChannelCmd and TclTestChannelEventCmd as they were moved to
	tclTest.c.  Added new decls for TclChannelEventScriptInvoker and
	TclChannelTransform.

	* generic/tclIO.h: new file that contains the main internal
	structures of Tcl_Channel code to allow for multiple files to
	access them.
	* generic/tclTest.c:
	* generic/tclIO.c: broke into 3 files - tclIO.c core code, tclIO.h
	header code, and tclIOGT.c - the giot test code from Kupries.  The
	channel test code also moved to tclTest.c.
	* generic/tclIO.c (CloseChannel): stopped masking out of the
	TCL_READABLE|TCL_WRITABLE bits from the state flags in
	CloseChannel, instead adding extra intelligence to
	CheckChannelErrors with a new CHANNEL_RAW_MODE bit for special
	behavior when called from Raw channel APIs.

2000-07-13  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclIO.c (StackSetBlockMode): moved set of chanPtr
	outside of blockModeProc check to avoid infinite loop when
	blockModeProc was NULL (Kupries).  updated TransformSeekProc to
	not call Tcl_Seek directly (Kupries).

	* win/tclWinChan.c: updated fileChannelType to v2 channel struct
	* win/tclWinConsole.c: updated consoleChannelType to v2 channel struct
	* win/tclWinPipe.c: updated pipeChannelType to v2 channel struct
	* win/tclWinSerial.c: updated serialChannelType to v2 channel struct
	* win/tclWinSock.c: updated tcpChannelType to v2 channel struct

2000-07-11  Brent Welch	<welch@@ajubasolutions.com>

	* win/tclConfig.sh.in: Cleaned up unix-specific autoconf variables.

2000-07-11  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/iogt.test: made tests [345].0 not run by default as they
	were failing in the new design, but I'm not convinced that the
	returned result isn't correct.

	* generic/tclDecls.h:
	* generic/tclStubInit.c:
	* generic/tcl.decls: added Tcl_GetTopChannel C API that returns
	the current top channel of a channel stack.  Tcl_GetChannel was
	changed earlier to return the bottommost channel of a stack
	because that is the one that is guaranteed to stay around the
	longest, and this was needed to compensate for certain
	operations that want to look at the state of the main channel.
	Most channel APIs already compensate for grabbing the top, so it
	shouldn't be needed often.

	* generic/tclIO.c (Tcl_StackChannel, Tcl_UnstackChannel): Added
	flushing of buffers (Kupries), removed use of DownChannel macro,
	added Tcl_GetTopChannel public API to get to the top channel of
	the channel stack (necessary for TLS).  Rewrote Tcl_NotifyChannel
	for new channel design (Kupries).  Did some code cleanup in the
	transform code.  tclIO.c must still be broken into bits (separate
	out test code and giot code, create tclIO.h).

2000-07-10  Andreas Kupries <a.kupries@@westend.com>

	* tests/iogt.test: Reverted some earlier changes as a fix by Jeff
	  revived the original and correct behaviour. IOW, the tests showed
	  a genuine error and I didn't see it :(.

	* generic/tclIO.c (Tcl_Read|Write_Raw): Changed to directly use
 	  the drivers and not DoRead|DoWrite. The latter use the buffering
 	  system, encoding and eol-translation and this wreaks havoc with
 	  the data going through the transformations. Both procedures use
 	  CheckForchannelErrors and let it believe that there is no
 	  background copy in progress or else stacked channels could not
	  be used for that.

	* generic/tclIO.c (TclCopyChannel, CopyData): Moved access to the
 	  topmost channel from the first to the second procedure to make
 	  the decision about that at the last possible time (Callbacks can
 	  change the stacking).

	test suite: failures of iogt-[345].0
	
2000-07-06  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/iogt.test: new tests for stacked channel stuff based off
	new 'testchannel transform|unstack' code (Kupries IOGT extension).
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclDecls.h:
	* generic/tclStubsInit.c:
	* generic/tclIO.c: complete rewrite of Tcl Channel code for
	stacked channels.  Channels are now designed to work in a more
	stacked fashion with a shared ChannelState data structure.

2000-06-16  Syd Polk  <spolk@@redhat.com>

	* generic/tclEnv.c win/tclWin32Dll.c: Fix impurePtr to work with
	modern Cygwin.
	* win/tcl.m4: Use --compat-implib.
	* win/configure: Regenerate.

2000-06-02  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclIO.c (CloseChannel): removed the &ing out of
	(TCL_READABLE|TCL_WRITABLE) from the flags, as CloseChannel does
	this on the next pass through for the top channel, and it appeared
	to be causing hangs by not allowing the final flush.

2000-06-01  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclIO.c (CloseChannel): Rewrote CloseChannel code to
	unstack a channel during the close process.  Fixed a refcount bug
	in Tcl_UnstackChannel.  [Bug: 5623]
	(CloseChannel): further extended CloseChannel in the stacked case
	to effect certain operations on the next channel that would have
	been done in Tcl_Close.  Also added CHANNEL_CLOSED and removed
	(TCL_READABLE|TCL_WRITABLE) bits from chanPtr->flags.  Changed
	final reset of the WatchProc to check the chanDownPtr's (next)
	interestMask.

2000-05-29  Sandeep Tamhankar <sandeep@@scriptics.com>

	* tests/http.test
	* doc/http.n
	* library/http2.3/http.tcl: Fixed bug 5741, where unsuccessful
	geturl calls sometimes leaked memory and resources (sockets).  
	Also, switched around some of the logic so that http::wait never 
	throws an exception.  This is because in an asynchronous geturl, 
	the command callback will probably end up doing all the error 
	handling anyway, and in an asynchronous situation, the user
	expects to check the state when the transaction completes, as
	opposed to being thrown an exception.	For the http package, this
	menas the user can check http::status for "error" and http::error
	for the error message after doing the http::wait.

2000-04-26  Jeff Hobbs  <hobbs@@scriptics.com>

	8.3.1 RELEASE

	* README:
	* mac/README:
	* tools/tcl.wse.in:
	* unix/README:
	* unix/tcl.spec:
	* win/README:
	* win/README.binary: Updating URLs to reference dev.scriptics.com

2000-04-25  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/Makefile.in:
	* win/Makefile.in:
	* win/makefile.vc: updated for http change and some cleanup
	* library/http2.[13]: moved dir http2.1 to http2.3 to match version

	* doc/Utf.3: clarified docs for Tcl_(UniChar|Utf)AtIndex

	* unix/tclUnixThrd.c: removed {}s around PTHREAD_MUTEX_INITIALIZER
	[Bug: 5254]

	* unix/tclLoadDyld.c (TclpLoadFile): removed use of interp->result

2000-04-25  Eric Melski  <ericm@@scriptics.com>

	* unix/mkLinks: 
	* doc/AddErrInfo.3: Added information about Tcl_LogCommandInfo
	[Bug: 1818].

2000-04-24  Eric Melski  <ericm@@scriptics.com>

	* unix/mkLinks: 
	* doc/OpenFileChnl.3: Added man entry for Tcl_Ungets [Bug: 1834].

	* unix/mkLinks: 
	* doc/SourceRCFile.3: Man page for Tcl_SourceRCFile [Bug: 1833].

	* unix/mkLinks: 
	* doc/ParseCmd.3: Added documentation for Tcl_ParseVar [Bug: 1828].

2000-04-24  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/tclUnixNotfy.c (Tcl_FinalizeNotifier, NotifierThreadProc):
	added write of 'q' into triggerPipe for notifier in threaded case,
	so that Tcl doesn't hang when children are still running [Bug: 4139]

	* unix/tclUnixThrd.c (Tcl_MutexLock): minor comment fixes.

2000-04-23  Jim Ingham  <jingham@@cygnus.com>

	These changes make some error handling marginally better for Mac
	sockets.  It is still somewhat flakey, however.

	* mac/tclMacSock.c (TcpClose): Add timeouts to the close - these
	don't seem to be honored, however.
	Use a separate PB for the release, since an async connect socket
	will still be using the original buffer.
	Make sure TCPRelease returns noErr before freeing the recvBuff.
	If the call returns an error, then the buffer is not right.
	* mac/tclMacSock.c (CreateSocket): Add timeouts to the async
	create. These don't seem to trigger, however.  Sigh...
	* mac/tclMacSock.c (WaitForSocketEvent): If an TCP_ASYNC_CONNECT
	socket errors out, then return EWOULDBLOCK & error out.
	* mac/tclMacSock.c (NotifyRoutine): Added a NotifyRoutine for
	experimenting with MacTCP.

2000-04-22  Jim Ingham <jingham@@cygnus.com>

	* library/package.tcl (tclPkgUnknown): Fixed a typo in the Mac package
	search part of tclPkgUnknown.

2000-04-21  Sandeep Tamhankar <sandeep@@scriptics.com>

	* library/http2.1/http.tcl: Fixed a newly introduced bug where if
	there's a -command callback and something goes wrong, geturl threw
	an exception, called the callback, and unset the token.  I changed
	it so that it will not call the callback when throwing an
	exception (so the caller only finds out about a given error from
	one place).  Also, fixed http::ncode so that it actually gives you
	back the http return code (i.e. 200, 404, etc.) instead of the
	first digit of the version of HTTP being used (i.e. 1).

2000-04-21  Brent Welch <welch@@scriptics.com>

	* library/http2.1/http.tcl: More thrashing with the "server closes
	without reading post data" scenario.  Reverted to the previous
	filevent configuratiuon, which seems to work better with small
	amounts of post data.  

2000-04-20  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclAlloc.c: wrapped caddr_t define to not be done on Unix
	* unix/tclUnixPort.h: added Tclp*Alloc defines to allow the use of
	USE_TCLALLOC on Unix. [Bug: 4731]

2000-04-19  Jeff Hobbs  <hobbs@@scriptics.com>

	* library/dde1.1/pkgIndex.tcl:
	* library/reg1.0/pkgIndex.tcl:
	* win/tclWinChan.c:
	* win/tclWinThrd.c: converted CRLF to LF the */tcl.hpj.in files
	were not converted, as it confuses hcw locally. [Bug: 5096]

	* win/Makefile.in: expanded cleanup target for help files

	* doc/Thread.3: minor macro cleanup

	* generic/tclFileName.c (SplitUnixPath): added support for QNX
	node ids.

2000-04-18  Jeff Hobbs  <hobbs@@scriptics.com>

	* README:
	* generic/tcl.h:
	* tools/tcl.wse.in:
	* unix/configure.in:
	* unix/tcl.spec:
	* win/configure.in:
	* win/README.binary: bumped version to 8.3.1

	* win/tcl.hpj.in: updated copyright date

	* generic/tclEnv.c: environment support for Mac OS/X
	* unix/tclUnixPort.h: environment support for Mac OS/X
	* unix/tclLoadDyld.c: new file for Mac OS/X dl functions
	* unix/Makefile.in: added install-strip target; bindir, libdir,
	mandir, includedir vars; tclLoadDyld.c target [Bug: 2527]

	* unix/tclUnixChan.c (CreateSocket): force a socket back into
	blocking mode (default state) after a -async connect succeeds.
	[Bug: 4388]

	* generic/tclEvent.c (TclInitSubsystems): Moved tclLibraryPath to
	thread-local storage to prevent thread-related race condition.
	[Bug: 5033]
	* unix/tclAppInit.c (main): removed #ifdef TCL_TEST that sets the
	library path as it was unnecessary and conflicts with move of
	tclLibraryPath to thread-local storage.

2000-04-18  Scott Redman  <redman@@scriptics.com>

	* win/Makefile.in:
	* win/tcl.rc:
	* win/tclsh.rc:
	* win/tclsh.ico:  Modified copyright dates in Windows resource
	files.  Added an icon for tclsh.exe.

2000-04-17  Brent Welch <welch@@scriptics.com>

	* generic/tcl.h, generic/tclThreadTest.c, unix/tclUnixThrd.c,
	win/tclWinThread.c, mac/tclMacThread.c:
	Added Tcl_CreateThreadType and TCL_RETURN_THREAD_TYPE
	macros for declaring the NewThread callback proc.

2000-04-14  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/tclUnixChan.c (TtyParseMode): Only allow setting mark/space
	parity on platforms that support it [Bug: 5089]

	* generic/tclBasic.c (Tcl_GetVersion): adjusted use of major/minor
	to not conflict with global decl on some systems [Bug: 2882]

	* doc/AppInit.3:
	* doc/Async.3:
	* doc/BackgdErr.3:
	* doc/CrtChannel.3:
	* doc/CrtInterp.3:
	* doc/CrtMathFnc.3:
	* doc/DString.3:
	* doc/Eval.3:
	* doc/ExprLong.3:
	* doc/GetInt.3:
	* doc/GetOpnFl.3:
	* doc/Interp.3:
	* doc/LinkVar.3:
	* doc/OpenFileChnl.3:
	* doc/OpenTcp.3:
	* doc/PkgRequire.3:
	* doc/RecordEval.3:
	* doc/SetResult.3:
	* doc/SplitList.3:
	* doc/StaticPkg.3:
	* doc/TraceVar.3:
	* doc/Translate.3:
	* doc/UpVar.3:
	* doc/load.n: removed or updated references to interp->result use.

2000-04-13  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/regexp.n: doc clarification [Bug: 5037]
	* doc/update.n: typo fix [Bug: 4996]

	* unix/tcl.m4 (SC_ENABLE_THREADS): enhanced the detection of
	pthread_mutex_init [Bug: 4359] and (SC_CONFIG_CFLAGS) added
	--enable-64bit-vis switch for Sparc VIS compilation [Bug: 4995]

2000-04-12  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/dde.n: corrected dde poke docs. [Bug: 4991]

2000-04-11  Eric Melski  <ericm@@scriptics.com>

	* win/tclWinPipe.c: Added "CONST" keyword to declaration of char
	*native in TclpCreateTempFile, to supress compiler warnings.

2000-04-10  Brent Welch <welch@@scriptics.com>

	* generic/tcl.h: Fixed Tcl_CreateThread declaration.
	* library/tcltest1.0/tcltest.tcl: Fixed the "mainThread"
	initialization to work with either testthread or the thread extension
	* unix/tclUnixThrd.c: Fixed compiler warning when compiling
	with -DTCL_THREADS

2000-04-10  Eric Melski  <ericm@@scriptics.com>

	* win/tclWinPipe.c (TclpCreateTempFile): Added conversion of
	contents string from UTF to native encoding [Bug: 4030].

	* tests/regexp.test: Added tests for infinite looping in [regexp
	-all].
	
	* generic/tclCmdMZ.c: Fixed infinite loop bug with [regexp -all]
	[Bug: 4981].

	* tests/*.test: Changed all occurances of "namespace import
	::tcltest" to "namespace import -force ::tcltest" [Bug: 3948].

2000-04-09  Brent Welch <welch@@scriptics.com>

	* lib/httpd2.1/http.tcl: Worked on the "server closes before
	reading post data" case, which unfortunately causes different
	error cases on Solaris, which can read the reply, and Linux
	and Windows, which cannot read anything.  This is all in the
	loop-back case - client and server on the same host.  Also
	unified the error handling so the "ioerror" status goes away
	and errors are reflected in a more uniform way. Updated the
	man page to document the behavior.

2000-04-09  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/reg.test (matchexpected): corrected tests to use tcltest
	constraint types to skip certain tests.

	* generic/tclBasic.c (Tcl_SetCommandInfo): comment fix

	* unix/tclUnixThrd.c (Tcl_CreateThread): moved TCL_THREADS ifdef
	inside of func as it is declared for non-threads builds as well.
	In the non-threads case, it always returns TCL_ERROR (couldn't
	create thread).

2000-04-08  Andreas Kupries <a.kupries@@westend.com>

	* Overall change: Definition of a public API for the creation of
	  new threads.

	* generic/tclInt.h (line 1802f): Removed the definition of
	'TclpThreadCreate'. (line 793f) Removed the definition of
	'Tcl_ThreadCreateProc'.

	* generic/tcl.h (line 388f): Readded the definition of
	  'Tcl_ThreadCreateProc'. Added Win32 stuff send in by David
	  Graveraux <davygrvy@@bigfoot.com> to that too (__stdcall,
	  ...). Added macros for the default stacksize and allowed flags.

	* generic/tcl.decls (line 1356f): Added definition of
	  'Tcl_CreateThread', slot 393 of the stub table. Two new
	  arguments in the public API, for stacksize and flags.

	* win/tclWinThrd.c:
	* mac/tclMacThrd.c: Renamed TclpThreadCreate to Tcl_CreateThread,
	  added handling of the stacksize. Flags are currently ignored.

	* unix/tclUnixThrd.c: See above, but handles joinable
	  flag. Ignores the specified stacksize if the macro
	  HAVE_PTHREAD_ATTR_SETSTACKSIZE is not defined.

	* generic/tclThreadTest.c (line 363): See below.

	* unix/tclUnixNotfy.c (line 210): Adapted to the changes
	  above. Uses default stacksize and no flags now.

	* unic/tcl.m4 (line 382f): Added a check for
	  'pthread_attr_setstacksize' to detect platforms not implementing
	  this feature of pthreads. If it is implemented, configure will
	  define the macro HAVE_PTHREAD_ATTR_SETSTACKSIZE (See
	  unix/tclUnixThrd.c too).

	* doc/Thread.3: Added Tcl_CreateThread and its arguments to the
	  list of described functions. Removed stuff about not providing a
	  public C-API for thread-creation.

2000-04-07  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/binary.n: clarified docs on sign extension in binary scan
	[Bug: 3466]

	* library/tcltest1.0/tcltest.tcl (initConstraints): removed win32s
	references (no longer supported)

	* tests/fCmd.test: marked test 8.1 knownBug because it is
	dangerous on poorly configured systems [Bug: 3881]
	and added 8.2 to keep essence of 8.1 tested.

2000-04-05  Andreas Kupries <a.kupries@@westend.com>

	* generic/tclIO.c (Tcl_UnstackChannel, line 1831): Forcing
	interest mask to the correct value after an unstack and
	re-initialization of the notifier via the watchProc. Without this
	the first fileevent after an unstack will come through and be
	processed, but no more. [Bug: ??].

2000-03-04  Brent Welch  <welch@@scriptics.com>

	* {win,unix}/Makefile.in: added dependency of tclStubInit.c on
	tcl.decls and tclInt.decls
	* generic/tclThread.c: Tweak so this compiles w/out TCL_THREADS
	* generic/{tcl.decls,tclStubInit.c}:  Just touched the tcl.decls and
	regenerated the tclStubInit.c file

2000-03-29  Sandeep Tamhankar <sandeep@@scriptics.com>

	* library/http2.1/http.tcl: For the -querychannel option,
	fconfigure the socket to be binary so that we don't translate
	anything while reading the data.  This is because we determine the
	content length of the data on the channel by using seek (to the end
	of the file) and tell on the file handle, and we need the
	content-length to match the amount of data actually sent, and
	translation can affect the number of bytes posted.

2000-04-03  Andreas Kupries <a.kupries@@westend.com>

	* Overall change: Definition of public API's for the finalization
	of conditions and mutexes. [Bug: 4199].

	* generic/tclInt.h: Removed definitions of TclFinalizeMutex and
	TclFinalizeCondition.

	* generic/tcl.decls: Added declarations of Tcl_MutexFinalize and
	Tcl_ConditionFinalize.

	* generic/tclThread.c: Renamed TclFinalizeMutex to
	Tcl_MutexFinalize. Renamed TclFinalizeCondition to
	Tcl_ConditionFinalize.

	* generic/tclNotify.c: Changed usage of TclFinalizeMutex to
	Tcl_MutexFinalize.

	* unix/tclUnixNotfy.c: 
	* generic/tclThreadTest.c: Changed usages of TclFinalizeCondition to
	Tcl_ConditionFinalize.

	* generic/tcl.h: Added empty macros for Tcl_MutexFinalize and
	Tcl_ConditionFinalize, to be used when the core is compiled
	without threads. 

	* doc/Thread.3:	Added description the new API's.

2000-04-03  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclCmdIL.c (InfoVarsCmd): checked for non-NULL procPtr
	to prevent itcl info override crash [Bug: 4064]

	* tests/foreach.test:
	* tests/namespace.test:
	* tests/var.test: Added lsorts to avoid random sorted return
	problems. [Bug: 2682]

	* tests/fileName.test: fixed 14.1 test fragility [Bug: 1482]

	* tools/man2help2.tcl: fixed winhelp cross-linking error [Bug: 4156]
	improved translation to winhelp [Bug: 3679]

	* unix/Makefile.in (MAN_INSTALL_DIR): patch to accept --mandir
	correctly [Bug: 4085]

	* unix/dltest/pkg[a-e].c: Cleaned up test packages [Bug: 2293]

2000-04-03  Eric Melski  <ericm@@scriptics.com>

	* unix/tclUnixFCmd.c (SetGroupAttribute): 
	* unix/tclUnixFCmd.c (SetOwnerAttribute): Added (uid_t) and (gid_t) 
	casts to avoid compiler warnings.

2000-03-31  Eric Melski  <ericm@@scriptics.com>

	* generic/tclGet.c (Tcl_GetDouble): Added additional conditions to
	error test (previously only errno was checked, but the return
	value of strtod() should be checked as well).  [Bug: 4118].

	* tests/exec.test: Added test for proper conversion of UTF data
	when used with "<< $dataWithUTF" on exec's.

	* unix/tclUnixPipe.c (TclpCreateTempFile): Added
	Tcl_UtfToExternalDString call, so that if there is UTF content in
	the string it will be properly converted to the system encoding
	before being written [Bug: 4030].
	(TclpCreateTempFile): Added a check on the return value of tmpnam;
	some systems (Linux, for example) will start to return NULL after
	tmpnam has been called TMP_MAX times; not checking for this can
	have bad results (overwriting temp files, core dumps, etc.)

2000-03-30  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclBasic.c (Tcl_DeleteCommandFromToken): Added comments
	noting the need to pair ckalloc with ckfree. [Bug: 4262]

	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c:
	* win/tclWin32Dll.c: removed TclWinSynchSpawn (vestige of Win32s
	support).

	* win/tclWinReg.c: made use of TclWinGetPlatformId instead of
	getting info again

	* win/tclWinPort.h:
	* win/Makefile.in:
	* win/configure.in:
	* win/tcl.m4: Added support for gcc/mingw on Windows [Bug: 4234]

2000-03-29  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclCompile.c (TclCleanupByteCode): made ByteCode cleanup
	more aware of TCL_BYTECODE_PRECOMPILED flagged structs (gen'd by
	tbcload), to correctly clean them up.

	* generic/tclClock.c (FormatClock): moved check for empty format
	earlier, commented 0 result return value

2000-03-29  Sandeep Tamhankar <sandeep@@scriptics.com>

	* library/http2.1/http.tcl: Removed an unnecessary fileevent
	statement from the error processing part of the Write method.
	Also, fixed two potential memory leaks in wait and reset, in which
	the state array wasn't being unset before throwing an exception.
	Prior to this version, Brent checked in a fix to catch a
	fileevent statement that was sometimes causing a stack trace when
	geturl was called with -timeout.  I believe Brent's fix is
	necessary because TLS closes bad sockets for secure connections,
	and the fileevent was trying to act on a socket that no longer
	existed.

2000-03-27  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/httpd: removed unnecessary 'puts stderr "Post Dispatch"'

	* tests/namespace.test:
	* generic/tclNamesp.c (Tcl_Export): added a uniq'ing test to the
	export list so only one instance of each export pattern would
	exist in the list.

	* generic/tclExecute.c (TclExecuteByteCode): optimized case for
	the empty string in ==/!= comparisons

2000-03-27  Eric Melski  <ericm@@scriptics.com>

	* unix/tclUnixChan.c: Added (off_t) type casts in lseek() call
	[Bug: 4409].

	* unix/tclLoadAout.c: 
	* unix/tclUnixPipe.c: Added (off_t) type casts in lseek() calls
	[Bug: 4410].

2000-03-22  Sandeep Tamhankar <sandeep@@scriptics.com>

	* library/http2.1/http.tcl: Fixed a bug where string query data
	that was bigger than queryblocksize would get duplicate characters
	at block boundaries.

2000-03-22  Sandeep Tamhankar <sandeep@@scriptics.com>

	* library/http2.1/http.tcl: Fixed bug 4463, where we were getting
	a stack trace if we tried to publish a project to a good host but
	a port where there was no server listening.  It turned out the
	problem was a stray fileevent that needed to be cleared.  Also,
	fixed a bug where http::code could stack trace if called on a bad
	token (one which didn't represent a successful geturl) by adding
	an http element to the state array in geturl.

2000-03-21  Eric Melski  <ericm@@scriptics.com>

	* tests/clock.test: Modified some tests that were not robust with
	respect to the time zone in which they were run and were thus
	failing.

	* doc/clock.n: Clarified meaning of -gmt with respect to -base
	when used with [clock scan] (-gmt does not affect the
	interpretation of -base).

2000-03-19  Sandeep Tamhankar <sandeep@@scriptics.com>

	* library/http2.1/http.tcl: geturl used to throw an exception when
	the connection failed; I accidentally returned a token with the
	error info, breaking backwards compatibility.  I changed it back
	to throwing an exception, but unsetting the state array first
	(thus still eliminating the original memory leak problem).

2000-03-19  Sandeep Tamhankar <sandeep@@scriptics.com>

	* library/http2.1/http.tcl: Added -querychannel option and altered
	some of Brent's modifications to allow asynchronous posts (via
	-command).  Also modified -queryprogress so that it calls the
	query callback as <callback> <token> <total size> <current size>
	to be consistent with -progress.  Added -queryblocksize option
	with default 8192 bytes for post blocksize.  Fixed a bunch of
	potential memory leaks for the case when geturl receives bad args
	or can't open a socket, etc.  Overall, the package really rocks
	now.

	* doc/http.n: Added -queryblocksize, -querychannel, and
	-queryprogress.  Also, changed the description of -blocksize,
	which states that the -progress callback will be called for each
	block, to now qualify that with an "if -progress is specified".

	* tests/http.test: Added a querychannel test for synchronous and
	asynchronous posts, altered the queryprogress test such that the
	callback conforms to the -progress format.  Also, had to use the
	-queryblocksize option to do the post 16K at a time to match
	Brent's expected results (and to test that -queryblocksize works).

2000-03-15  Brent Welch <welch@@scriptics.com>

	* library/http2.1/http.tcl: Added -queryprogress callback to
	http::geturl and also changed it so that writing the post data
	is event driven if the queryprogress callback or a timeout is given.
	This allows a timeout to occur when writing lots of post data.
	The queryprogress callback is called after each block of query
	data is posted.  It has the same signature as the -progress callback.

2000-03-06  Eric Melski  <ericm@@scriptics.com>

	* library/package.tcl: Applied patch from Bug: 2570; rather than
	setting geometry of slave interp to 0x0 when Tk was loaded, it now
	does "wm withdraw .".  Both remove the main window from the
	display, but the former caused some internal structures to get
	initialized to zero, which caused crashes with some extensions.

2000-03-02  Jeff Hobbs  <hobbs@@scriptics.com>

	* library/package.tcl (tclPkgUnknown): extended to allow
	recognizes changes in the auto_path while sourcing in other
	pkgIndex.tcl files

	* doc/FindExec.3: fixed doc for declaration of Tcl_FindExecutable
	[Bug: 4275]

	* generic/tclFileName.c (Tcl_TranslateFileName): Applied patch
	from Newman to significantly speedup file split/join on Windows
	(replaces regexp with custom parser).  [Bug: 2867]

	* win/README.binary: change mailing lists from @@consortium.org
	to @@scriptics.com [Bug: 4173]

2000-02-28  Eric Melski  <ericm@@scriptics.com>

	* tests/clock.test: Added test for ISO bases < 100000

	* generic/tclDate.c: (generated on Solaris)
	* generic/tclGetDate.y: Changed condition for deciding if a number
	is an ISO 8601 base from number >= 100000 to numberOfDigits >= 6.
	Previously it would fail to recognize 000000 as an ISO base.

2000-02-14  Eric Melski  <ericm@@scriptics.com>

	* unix/Makefile.in: Added rpm target to generate Tcl binary RPM.

	* unix/tcl.spec: RPM specification file for a Tcl binary RPM for
	Linux.

2000-02-10  Jeff Hobbs  <hobbs@@scriptics.com>

	8.3.0 RELEASE

	* changes: updated for 8.3.0 release

	* doc/load.n: added notes about dll load errors on Windows

	* unix/README:
	* unix/Makefile.in (dist): removed porting.notes and porting.old
	from distribution and CVS.  The information was very outdated.  Now
	refer to http://dev.scriptics.com/services/support/platforms.html

	* tests/unixInit.test: fixed japanese LANG encoding test [Bug: 3549]

	* unix/configure.in:
	* unix/tcl.m4: correct CFLAG_WARNING setting,
	fixed gcc config for AIX,
	added -export-dynamic to LDFLAGS for FreeBSD-3+ [Bug: 2998]

	* win/tclWinLoad.c (TclpLoadFile): improved error message for load
	failures, could perhaps be even more intelligent.

2000-02-09  Jim Ingham	 <jingham@@cygnus.com>

	* mac/tclMacSock.c: Don't panic when you get an error closing an async 
	socket.	 This doesn't seem to hurt anything, and we return the error so
	the caller can do the right thing.

	New Files:
	* mac/MW_TclHeader.h:
	* mac/MW_TclTestHeader.h:
	* mac/MW_TclTestHeader.pch:
	* mac/MW_TclAppleScriptHeader.h: More convenient to use .h prefix files
	in the preference panels...

	The above are curtesy of Daniel Steffen (steffen@@math.mq.edu.au)

2000-02-08  Eric Melski  <ericm@@scriptics.com>

	* tests/clock.test: Added tests for "next monthname" constructs.
	* generic/tclDate.c: 
	* generic/tclGetDate.y (Message): Added a grammar rule for "next
	monthname" so that we can handle "next january" and similar
	constructs (bug #4146).

2000-02-08  Jeff Hobbs  <hobbs@@scriptics.com>

	* README:
	* tools/tcl.wse.in:
	* unix/configure.in:
	* win/configure.in:
	* win/README:
	* win/README.binary:
	* generic/tcl.h (TCL_RELEASE_SERIAL): Moved to 8.3.0 patchlevel

	* doc/library.n:
	* library/auto.tcl: fixed crufty puts code and docs [Bug: 4122]

	* library/tcltest1.0/tcltest.tcl: correctly protected searchDirectory
	list to allow dirnames with spaces

	* unix/tcl.m4: changed all -fpic to -fPIC

	* generic/tclDecls.h:
	* generic/tcl.decls: change Tcl_GetOpenFile to use decl of 'int
	forWriting' instead of 'int write' to avoid shadowing [Bug: 4121]

	* tests/httpold.test: changed test script to source in the httpd
	server procs from httpd instead of having its own set.

	* tests/httpd: improved query support in test httpd to handle fix
	in http.tcl. [Bug: 4089 change 2000-02-01]

	* unix/README: fixed notes about --enable-shared and add note
	about --disable-shared.

2000-02-07  Eric Melski  <ericm@@scriptics.com>

	* tests/package.test: 
	* library/tclIndex: 
	* library/package.tcl: Renamed ::package namespace to ::pkg.

2000-02-03  Eric Melski <ericm@@scriptics.com>

	* doc/Package.n:
	* doc/packagens.n: Renamed Package.n -> packagens.n because Windows 
	can't deal with case-sensitive names.

2000-02-02  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/regexp.test: added tests for -all and -inline switches
	* doc/regexp.n: added docs for -all and -inline switches
	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): added extra comments for
	new -all and -inline switches to regexp command

2000-02-01  Eric Melski  <ericm@@scriptics.com>

	* library/init.tcl: Applied patch from rfe 1734 regarding
	auto_load errors not setting error message and errorInfo properly.

2000-02-01  Jeff Hobbs  <hobbs@@scriptics.com>

	* win/Makefile.in (install-*): reduced verbosity of install

	* generic/tclFileName.c (Tcl_JoinPath): improved support for special
	QNX node id prefixes in pathnames [Bug: 4053]

	* library/http1.0/http.tcl:
	* library/http2.1/http.tcl: The query data POSTed was newline
	terminated when it shouldn't be altered [Bug: 4089]

2000-01-31  Eric Melski  <ericm@@scriptics.com>

	* tests/package.test: 
	* library/tclIndex: 
	* library/package.tcl: Added ::package namespace and
	::package::create function.

	* library/init.tcl: Fixed problem with auto_load and determining
	if commands were loaded.

	* library/auto.tcl: "Fixed" issues with $ in files to be auto indexed.

	* doc/Package.n: New man page for package::create function.

	* doc/pkgMkIndex.n: Added additional information.

	* doc/library.n: Added additional qualification regarding auto_mkindex.

2000-01-28  Eric Melski  <ericm@@scriptics.com>

	* tests/pkg/magicchar2.tcl: 
	* tests/autoMkindex.test: Test for auto loader fix (bug #2480).

	* library/init.tcl: auto_load was using [info commands $name] to
	determine if a given command was available; if the command name
	had * or [] it, this would fail because info commands uses
	glob-style matching.  This is fixed.  (Bug #2480).

	* tests/pkg/spacename.tcl: 
	* tests/pkgMkIndex.test: Tests for fix for bug #2360.

	* library/package.tcl: Fixed to extract only the first element of
	the list returned by auto_qualify (bug #2360).

	* tests/pkg/magicchar.tcl: 
	* tests/autoMkindex.test: Test for fix for bug #2611.

	* library/auto.tcl: Fixed the regular expression that performs $
	escaping before sourcing a file to index.  It was erroneously
	adding \ escapes even to $'s that were already escaped,
	effectively "un-escaping" those $'s.  (bug #2611).

2000-01-27  Eric Melski  <ericm@@scriptics.com>

	* tests/autoMkindex.test: 
	* library/auto.tcl: Applied patch (with slight modification) from
	bug #2701:  auto_mkIndex uses platform dependent file paths.
	Added test for fix.

2000-01-27  Jennifer Hom  <jenn@@scriptics.com>

	* library/tcltest1.0/tcltest.tcl: Changed NormalizePath to
	normalizePath and exported it as a public proc.  This proc 
	creates an absolute path given the name of the variable containing
	the path to modify.  The path is modified in place.
	* library/tcltest1.0/pkgIndex.tcl: Added normalizePath.
	* tests/all.tcl: Changed code to use normalizePath.

2000-01-27  Eric Melski  <ericm@@scriptics.com>

	* tests/pkg/samename.tcl: test file for bug #1983
	
	* tests/pkgMkIndex.test: 
	* doc/pkgMkIndex.n: 
	* library/package.tcl: Per rfe #4097, optimized creation of direct
	load packages to bypass computing the list of commands added by
	the new package.  Also made direct loading the default, and added
	a -lazy option.
	Fixed bug #1983, dealing with pkg_mkIndex incorrectly handling
	situations with two procs by the same name but in different
	namespaces (ie, foo::baz and bar::baz).

2000-01-26  Eric Melski  <ericm@@scriptics.com>

	* generic/tclNamesp.c: Undid fix for #956, which broke backwards
	compatibility.

	* doc/variable.n: 
	* doc/trace.n: 
	* doc/namespace.n: 
	* doc/info.n: Added further information about differences between
	"namespace which" and "info exists".

	* doc/SetErrno.3: Added descriptions of ErrnoId() and ErrnoMsg()
	functions.

2000-01-25  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/tcl.m4: modified EXTRA_CFLAGS to add -DHAVE_TZSET for
	OSF1-V* and ULTRIX-4.* when not using gcc.  Also added higher min
	stack size for OSF1-V* when building with threads. [Bug: 4063]

	* generic/tclClock.c (FormatClock): inlined resultPtr, as it
	conflicted with var creation for HAVE_TZSET #def [Bug: 4063]

	* generic/tclCmdIL.c (Tcl_LsortObjCmd): fixed potential leak
	when calling lsort -command with bad command [Bug: 4067]

	* generic/tclFileName.c (Tcl_JoinPath): added support for special
	QNX node id prefixes in pathnames [Bug: 4053]

	* doc/ListObj.3: clarified Tcl_ListObjGetElements docs [Bug: 4080]

	* doc/glob.n: clarified Mac path separator determination docs.

	* win/makefile.vc: added some support for building helpfile on Windows

2000-01-23  Jeff Hobbs  <hobbs@@scriptics.com>

	* library/init.tcl (auto_execok): added 'start' to list of
	recognized built-in commands for COMSPEC on NT. [Bug: 2858]

	* unix/tclUnixPort.h: moved include of <utime.h> lower since some
	systems (UTS) require sys/types.h to be included first [Bug: 4031]

	* unix/tclUnixChan.c (CreateSocketAddress): changed comparison
	with -1 to 0xFFFFFFFF, to ensure 32 bit comparison even on 64 bit
	systems. [Bug: 3878]

	* generic/tclFileName.c: improved guessing of path separator
	for the Mac. (Darley)

	* generic/tclInt.h:
	* generic/tcl.decls: moved Tcl_ProcObjCmd to stubs table [Bug: 3827]
	and removed 'register' from stub definition of
	Tcl_AppendUnicodeToObj [Bug: 4038]

2000-01-21  Eric Melski  <ericm@@scriptics.com>

	* unix/mkLinks: 
	* doc/GetHostName.3: Man page for Tcl_GetHostName (bug #1817).

	* doc/lreplace.n: Corrected man page with respect to treatment of
	empty lists, and "prettied up" the page. (bug #1705).

2000-01-20  Eric Melski  <ericm@@scriptics.com>

	* tests/namespace.test: Added test for undefined variables with
	namespace which (bug #956).

	* generic/tclNamesp.c: Added check for undefined variables in
	NamespaceWhichCmd (bug #956).

	* tests/var.test: Added tests for corrected variable behavior 
	(bug #981).

	* doc/upvar.n: Expanded explanation of upvar behavior with respect to
	variable traces.  (bugs 3917 1433 2110).

	* generic/tclVar.c: Changed behavior of variable command when name
	refers to an element in an array (ie, "variable foo(x)") to always
	return an error, regardless of existance of that element in the
	array (now behavior is consistant with docs too) (bug #981).

2000-01-20  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclCmdIL.c (InfoBodyCmd): made [info body] return a
	string if the body has been bytecompiled.
	* generic/tclBasic.c (Tcl_EvalObjEx): added pedantic check for
	originating proc body of bytecompiled code, #def'd out as the
	change for [info body] should make it unnecessary

	* unix/tclUnixNotfy.c (Tcl_InitNotifier): added cast for tsdPtr

	* tests/set.test: added test for complex array elem name compiling
	* generic/tclCompCmds.c (TclCompileSetCmd): Fixed parsing of array
	elements during compiling, and slightly optimised same [Bug: 3889]

	* doc/tclvars.n: added definitions for tcl_(non)wordchars

	* doc/vwait.n: added notes about requirement for vwait var being
	globally scoped [Bug: 3329]

	* library/word.tcl: changed tcl_(non)wordchars settings to use
	new unicode regexp char class escapes instead of char sequences

2000-01-14  Eric Melski  <ericm@@scriptics.com>

	* tests/var.test: Added a test for the array multiple delete
	protection in Tcl_UnsetVar2.

	* generic/tclVar.c: Added protection in Tcl_UnsetVar2 against
	attempts to multiply delete arrays when unsetting them (bug
	#3453).  This could happen if there was an unset trace on an array
	element and the trace proc made a global or upvar link to the
	array, and then the array was unset at the global level.  See the
	bug reference for more information.

	* unix/tclUnixTime.c: New clock format format.

	* compat/strftime.c: New clock format format.

	* generic/tclGetDate.y: New clock scan format.

2000-01-13  Jeff Hobbs  <hobbs@@scriptics.com>

	* changes: updated changes file to reflect 8.3b2 mods

	* README:
	* generic/tcl.h:
	* tools/tcl.wse.in:
	* unix/configure.in:
	* unix/tcl.m4:
	* win/README.binary:
	* win/configure.in: updated to patchlevel 8.3b2

	* generic/regexec.c: added var initialization to prevent compiler
	warning

2000-01-13  Eric Melski  <ericm@@scriptics.com>

	* tests/cmdIL.test: Added tests for lsort -dictionary with
	characters that occur between Z and a in ASCII.

	* generic/tclCmdIL.c: Modified DictionaryCompare function (used by
	lsort -dictionary) to do upper/lower case equivalency before doing
	character comparisons, instead of after.  This fixes bug #1357, in
	which lsort -dictionary [list ` AA c CC] and lsort -dictionary
	[list AA c ` CC] gave different (and both wrong) results.

2000-01-12  Eric Melski  <ericm@@scriptics.com>

	* tests/clock.test: Added tests for "next <day-of-week>" and
	"<day-of-week>"
	Added tests for "monday 1 week ago", etc, from RFE #3671.

	* doc/tests/clock.test: Added numerous tests for clock scan.

	* doc/generic/tclGetDate.y: Fixed some shift/reduce conflicts in
	clock grammar.

	* doc/doc/clock.n: Added documentation for new supported clock
	scan formats and additional explanation of daylight savings time
	correction algorithm.

2000-01-12  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/file.n:
	* tests/unixFCmd.test:
	* unix/tclUnixFCmd.c: added support for symbolic permissions
	setting in SetPermissionsAttribute (file attr $file -perm ...)
	[Bug: 3970]

	* generic/tclClock.c: fixed support for 64bit handling of clock
	values [Bug: 1806]

	* generic/tclThreadTest.c: upped a buffer size to hold double

	* tests/info.test:
	* generic/tclCmdIL.c: fixed 'info procs ::namesp::*' behavior (Dejong)

	* generic/tclNamesp.c: made imported commands also import their
	compile proc [Bug: 2100]

	* tests/expr.test:
	* unix/Makefile.in:
	* unix/configure.in:
	* unix/tcl.m4: recognize strtod bug on Tru64 v5.0 [Bug: 3378]
	and added tests to prevent unnecessary chmod +x in sources while
	installing, as well as more intelligent setsockopt/gethostbyname
	checks [Bug: 3366, 3389]

	* unix/tclUnixThrd.c: added compile time support (through use of
	the TCL_THREAD_STACK_MIN define) for increasing the default stack
	size for a thread. [Bug: 3797, 1966]

2000-01-11  Eric Melski  <ericm@@scriptics.com>

	* generic/tclGetDate.y: Added comments for the Convert function.
	Added a fix for daylight savings time handling for relative time
	spans of days, weeks or fortnights. (bug 3441, 3868).

	* generic/tclDate.c: Fixed compiler warning issues.

2000-01-10  Jeff Hobbs  <hobbs@@scriptics.com>

	* compat/waitpid.c: use pid_t type instead of int [Bug: 3999]

	* tests/utf.test: fixed test that allowed \8 as octal value
	* generic/tclUtf.c: changed Tcl_UtfBackslash to not allow
	non-octal digits (8,9) in \ooo substs. [Bug: 3975]

	* generic/tcl.h: noted need to change win/tcl.m4 and
	tools/tclSplash.bmp for minor version changes

	* library/http2.1/http.tcl: trim value for $state(meta) key

	* unix/tclUnixFile.c: fixed signature style on functions

	* unix/Makefile.in: made sure tcl.m4 would be installed with dist

	* unix/tcl.m4: added ELF support for NetBSD [Bug: 3959]

2000-01-10  Eric Melski  <ericm@@scriptics.com>

	* generic/tclGetDate.y: Added rules for ISO 8601 formats (BUG #847):
	CCYY-MM-DD
	CCYYMMDD
	YY-MM-DD
	YYMMDD
	CCYYMMDDTHHMMSS
	CCYYMMDD HHMMSS
	CCYYMMDDTHH:MM:SS
	Fixed "clock scan <number>" to scan the number as an hour for the
	current day, rather than a minute after 00:00 for the current day
	(bug #2732).
	

2000-01-07  Eric Melski  <ericm@@scriptics.com>

	* generic/tclClock.c: Changed switch in Tcl_ClockObjCmd to use
	enumerated values instead of constants. (ie, COMMAND_SCAN instead
	of 3).

1999-12-22  Jeff Hobbs  <hobbs@@scriptics.com>

	* changes: updated changes file
	* tools/tclSplash.bmp: updated to show 8.3

1999-12-21  Jeff Hobbs  <hobbs@@scriptics.com>

	* README:
	* generic/tcl.h:
	* mac/README:
	* unix/configure.in:
	* tools/tcl.wse.in:
	* win/README.binary:
	* win/configure.in: updated to patch level 8.3b1

	* unix/Makefile.in: added -srcdir=... for 'make html'

	* doc/Hash.3: fixed reference to ckfree [Bug: 3912]
	* doc/RegExp.3: fixed calling params for Tcl_RegExecFromObj
	* doc/open.n: fixed minor formatting errors
	* doc/string.n: fixed minor formatting errors

	* doc/lsort.n: added -unique docs
	* tests/cmdIL.test:
	* generic/tclCmdIL.c: added -unique option to lsort

	* generic/tclThreadTest.c: changed thread ids to longs [Bug: 3902]

	* mac/tclMacOSA.c: fixed applescript for I18N [Bug: 3644]

	* win/mkd.bat:
	* win/rmd.bat: removed necessity of tag.txt [Bug: 3874]

	* win/tclWinThrd.c: changed CreateThread to _beginthreadex and
	ExitThread to _endthreadex

1999-12-12  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/glob.n:
	* tests/fileName.test:
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclEncoding.c:
	* generic/tclFileName.c:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: enhanced the glob command with the new options
	-types -path -directory and -join.  Deprecated TclpMatchFiles with
	TclpMatchFilesTypes, extended TclGlob and TclDoGlob and added
	GlobTypeData structure. [Bug: 2363]

1999-12-10  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/var.test:
	* generic/tclCompile.c: fixed problem where setting to {} array
	would intermittently not work. (Fontaine) [Bug: 3339]

	* generic/tclCmdMZ.c:
	* generic/tclExecute.c: optimized INST_TRY_CVT_TO_NUMERIC to
	recognize boolean objects. (Spjuth) [Bug: 2815]

	* tests/info.test:
	* tests/parseOld.test:
	* generic/tclCmdAH.c:
	* generic/tclProc.c: changed Tcl_UplevelObjCmd (uplevel) and
	Tcl_EvalObjCmd (eval) to use TCL_EVAL_DIRECT in the single arg
	case as well, to take advantage	of potential pure list input
	optimization.  This means that it won't get byte compiled though,
	which should be acceptable.
	* generic/tclBasic.c: made Tcl_EvalObjEx pure list object aware in
	the TCL_EVAL_DIRECT case for efficiency.
	* generic/tclUtil.c: made Tcl_ConcatObj pure list object aware,
	and return a list object in that case [Bug: 2098 2257]

	* generic/tclMain.c: changed Tcl_Main to not constantly reuse the
	commandPtr object (interactive case) as it could be shared. (Fellows)

	* unix/configure.in:
	* unix/tcl.m4:
	* unix/tclUnixPipe.c: removed checking for compatible vfork
	function and use of the vfork function.  Modern VM systems rarely
	suffer any performance degradation when fork is used, and it
	solves multiple problems with vfork.  Users that still want vfork
	can add -Dfork=vfork to the compile flags. [Bug: 942 2228 1312]

1999-12-09  Jeff Hobbs  <hobbs@@scriptics.com>

	* win/aclocal.m4: made it just include tcl.m4

	* doc/exec.n:
	* doc/open.n:
	* win/tclWin32Dll.c:
	* win/tclWinChan.c:
	* win/tclWinFCmd.c:
	* win/tclWinInit.c:
	* win/tclWinPipe.c:
	* win/tclWinSock.c: removed all code that supported Win32s.  It
	was no longer officially supported, and likely didn't work anyway.
	* win/makefile.vc: removed 16 bit stuff, cleaned up.

	* win/tcl16.rc:
	* win/tclWin16.c:
	* win/winDumpExts.c: these files have been removed from the
	source tree (no longer necessary to build)

1999-12-07  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/io.test: removed 'knownBug' tests that were for
	unsupported0, which is now fcopy (that already has tests)

	* mac/tclMacPort.h: added utime.h include

	* generic/tclDate.c:
	* unix/Makefile.in: fixed make gendate to swap const with CONST
	so it uses the Tcl defined CONST type [Bug: 3521]

	* generic/tclIO.c: removed panic that could occur in FlushChannel
	when a "blocking" channel would receive EAGAIN, instead treating
	it the same as non-blocking. [Bug: 3773]

	* generic/tclUtil.c: fixed Tcl_ScanCountedElement to not step
	beyond the end of the counted string [Bug: 3336]

1999-12-03  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/load.n: added note about NT's buggy handling of './' with
	LoadLibrary

	* library/http2.1/http.tcl: fixed error handling in http::Event
	[Bug: 3752]

	* tests/env.test: removed knownBug limitation from working test
	* tests/all.tcl: ensured that ::tcltest::testsDirectory would be
	set to an absolute path

	* tests/expr-old.test:
	* tests/parseExpr.test:
	* tests/string.test:
	* generic/tclGet.c:
	* generic/tclInt.h:
	* generic/tclObj.c:
	* generic/tclParseExpr.c:
	* generic/tclUtil.c:
	* generic/tclExecute.c: added TclCheckBadOctal routine to enhance
	error message checking for when users use invalid octal numbers
	(like 08), as well as replumbed the Expr*Funcs with a new
	VerifyExprObjType to simplify type handling. [Bug: 2467]

	* tests/expr.test:
	* generic/tclCompile.c: fixed 'bad code length' error for
	'expr + {[incr]}' case, with new test case [Bug: 3736]
	and seg fault on 'expr + {[error]}' (different cause) that
	was caused by a correct optimization that didn't correctly
	track how it was modifying the source string in the opt.
	The optimization was removed, which means that:
		expr 1 + {[string length abc]}
	will be not be compiled inline as before, but this should be
	written:
		expr {1 + [string length abc]}
	which will be compiled inline for speed.  This prevents
		expr 1 + {[mindless error]}
	from seg faulting, and only affects optimizations for
	degenerate cases [Bug: 3737]

1999-12-01  Scott Redman <redman@@scriptics.com>

	* generic/tcl.decls :
	* generic/tclMain.c :
	* unix/tclAppInit.c: 
	* win/tclAppInit.c: Added two new internal functions,
	TclSetStartupScriptFileName() and TclGetStartupScriptFileName()
	and added hooks into the main() code for supporting TclPro and
	other "big" shells more easily without requiring a copy of the
	main() code.
	
	* generic/tclEncoding.c:
	* generic/tclEvent.c:  Moved encoding-related startup code from
	tclEvent.c into the more appropriate tclEncoding.c.
	
1999-11-30  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclIO.c: fix from Kupries for	Tcl_UnstackChannel that
	correctly handles resetting translation and encoding.

	* generic/tclLoad.c: #def'd out the unloading of DLLs at finalize
	time for Unix in TclFinalizeLoad. [Bug: 2560 3373]  Should be
	parametrized to allow for user to specify unload or not.

	* win/tclWinTime.c: fixed handling of %Z on NT for time zones
	that don't have DST.

1999-11-29  Jeff Hobbs  <hobbs@@scriptics.com>

	* library/dde1.1/pkgIndex.tcl:
	* library/reg1.0/pkgIndex.tcl: added supported for debugged
	versions of the libraries

	* unix/tclUnixPipe.c: fixed PipeBlockModeProc to properly set
	isNonBlocking flag on pipe. [Bug: 1356 710]
	removed spurious fcntl call from PipeBlockModeProc

	* tests/scan.test:
	* generic/tclScan.c: fixed scan where %[..] didn't match anything
	and added test case [Bug: 3700]

1999-11-24  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/open.n:
	* win/tclWinSerial.c: adopted patch from Schroedter to handle
	fconfigure $sock -lasterror on Windows. [RFE: 3368]

	* generic/tclCmdIL.c: made SORTMODE_INTEGER work with Longs
	[Bug: 3652]

1999-11-23  Scott Stanton  <stanton@@scriptics.com>

	* library/tcltest1.0/tcltest.tcl: Fixed bug where tcltest output
	went to stdout instead of the specified output file in some
	cases.

1999-11-19  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclProc.c: backed out change from 1999-11-18 as it
	could affect return string from upvar as well.

	* tools/tcl.wse.in: added tcltest1.0 library to distribution list

	* doc/http.n:
	* library/http2.1/http.tcl:
	* library/http2.1/pkgIndex.tcl: updated http package to 2.2

1999-11-18  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/tcl.m4: added defined for _THREAD_SAFE in --enable-threads
	case; added check for pthread_mutex_init in libc; in AIX case,
	with --enable-threads ${CC}_r is used; fixed flags when using gcc
	on SCO

	* generic/tclProc.c: corrected error reporting for default case
	at the global level for uplevel command.

	* generic/tclIOSock.c: changed int to size_t type for len
	in TclSockMinimumBuffers.

	* generic/tclCkalloc.c: fixed Tcl_DbCkfree to return a value
	on NULL input. [Bug: 3400]

	* generic/tclStringObj.c: fixed support for passing in negative
	length to Tcl_SetUnicodeObj, et al handling routines. [Bug: 3380]

	* doc/scan.n:
	* tests/scan.test:
	* generic/tclScan.c: finished support for inline scan by
	supporting XPG identifiers.

	* doc/http.n:
	* library/http2.1/http.tcl: added register and unregister
	commands to http:: package (better support for tls/SSL),
	as well as -type argument to http::geturl. [RFE: 2617]

	* generic/tclBasic.c: removed extra decr of numLevels in
	Tcl_EvalObjEx that could cause seg fault. (mjansen@@wendt.de)

	* generic/tclEvent.c: fixed possible lack of MutexUnlock in
	Tcl_DeleteExitHandler [Bug: 3545]

	* unix/tcl.m4: Added better pthreads library check and inclusion
	of _THREAD_SAFE in --enable-threads case
	Added support for gcc config on SCO

	* doc/glob.n: added note about ..../ glob behavior on Win9*
	* doc/tcltest.n: fixed minor example errors [Bug: 3551]

1999-11-17 Brent Welch <welch@@scriptics.com>
	* library/http2.1/http.tcl: Correctly fixed the -timeout
	problem mentioned in the 10-29 change.  Also added error
	handling for failed writes on the socket during the protocol.

1999-11-09  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/open.n: corrected docs for 'a' open mode.

	* generic/tclIOUtil.c: changed Tcl_Alloc to ckalloc

	* generic/tclInt.h:
	* generic/tclObj.c: rolled back changes from 1999-10-29
	Purify noted new leaks with that code

	* generic/tclParse.c: added code in Tcl_ParseBraces to test for
	possible unbalanced open brace in a comment

	* library/init.tcl: removed the installed binary directory from
	the auto_path variable

	* tools/tcl.wse.in: updated to 8.3a1, fixed install of twind.tcl
	and koi8-r.enc files

	* unix/tcl.m4: added recognition of pthreads library for AIX

1999-10-29  Brent Welch <welch@@scriptics.com>
	* generic/tclInt.h: Modified the TclNewObj and TclDecrRefCount
	in two ways.  First, in the case of TCL_THREADS, we do not use
	the special Tcl_Obj allocator because that is a source of 
	lock contention.  Second, general code cleanup to eliminate
	duplicated code. In particular, TclDecrRefCount now uses
	TclFreeObj instead of duplicating that code, so it is now
	identical to Tcl_DecrRefCount.

	* generic/tclObj.c: Changed Tcl_NewObj so it uses the
	TclNewObj macro instead of duplicating the code.  Adjusted
	TclFreeObj so it understands the TCL_THREADS case described
	above.

	* library/http2.1/http.tcl: Fixed a bug in the handling of
	the state(status) variable when the -timeout flag is specified.
	Previously it was possible to leave the status undefined
	instead of empty, which caused errors in http::status

1999-10-28  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/aclocal.m4: made it just include tcl.m4

	* library/tcltest1.0/tcltest.tcl: updated makeFile to return
	full pathname of file created

	* generic/tclStringObj.c: fixed Tcl_AppendStringsToObjVA so it only
	iterates once over the va_list (avoiding a memcpy of it,
	which is not portable).

	* generic/tclEnv.c: fixed possible ABR error in environ array

	* tests/scan.test:
	* generic/tclScan.c: added support for use of inline scan,
	XPG3 currently not included

	* tests/incr.test:
	* tests/set.test:
	* generic/tclCompCmds.c: fixed improper bytecode handling of
	'eval {set array($unknownvar) 5}' (also for incr) [Bug: 3184]

	* win/tclWinTest.c: added testvolumetype command, as atime is
	completely ignored for Windows FAT file systems
	* win/tclWinPort.h: added sys/utime.h to includes
	* unix/tclUnixPort.h: added utime.h to includes
	* doc/file.n:
	* tests/cmdAH.test:
	* generic/tclCmdAH.c: added time arguments to atime and mtime
	file command methods (support 'touch' functionality)

1999-10-20  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/tclUnixNotfy.c: fixed event/io threading problems by
	making triggerPipe non-blocking [Bug: 2792]

	* library/tcltest1.0/tcltest.tcl:
	* generic/tclThreadTest.c: fixed mem leaks in threads

	* generic/tclResult.c: fixed Tcl_AppendResultVA so it only
	iterates once over the va_list (avoiding a memcpy of it,
	which is not portable).

	* generic/regc_color.c: fixed mem leak and assertion, from HS

	* generic/tclCompile.c: removed savedChar trick that appeared to
	be causing a segv when the literal table was released

	* tests/string.test:
	* generic/tclCmdMZ.c: fixed [string index] to return ByteArrayObj
	when indexing into one (test case string-5.16) [Bug: 2871]

	* library/http2.1/http.tcl: protected gets with catch [Bug: 2665]

1999-10-19  Jennifer Hom  <jenn@@scriptics.com>

	* tests/tcltest.test:
	* doc/tcltest.n:
	* library/tcltest1.0/tcltest.tcl: Removed the extra return at the
	end of the tcltest.tcl file, added version information about tcl.

	Applied patches sent in by Andreas Kupries to add helper procs for
	debug output, add 3 new flags (-testsdir, -load, -loadfile), and
	internally refactors common code for dealing with paths into
	separate procedures. [Bug: 2838, 2842]

	Merged code from core-8-2-1 branch that changes the checks for the
	value of tcl_interactive to also incorporate a check for the
	existence of the variable.

	* tests/autoMkindex.test:
	* tests/pkgMkIndex.test: Explicitly cd to
	::tcltest::testsDirectory at the beginning of the test run

	* tests/basic.test: Use version information defined in tcltest
	instead of hardcoded version number

	* tests/socket.test: package require tcltest before attempting to
	use variable defined in tcltest namespace

	* tests/unixInit.test: 
	* tests/unixNotfy.test: Added explicit exits needed to avoid
	problems when the tests area run in wish.
	
1999-10-12  Jim Ingham  <jingham@@scriptics.com>

	* mac/tclMacLoad.c: Stupid bug - we converted the filename to
	external, but used the unconverted version.
	* mac/tclMacFCmd.c: Fix a merge error in the bug fix for [Bug: 2869]

1999-10-12  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/regc_color.c:
	* generic/regc_cvec.c:
	* generic/regc_lex.c:
	* generic/regc_locale.c:
	* generic/regcomp.c:
	* generic/regcustom.h:
	* generic/regerrs.h:
	* generic/regex.h:
	* generic/regexec.c:
	* generic/regguts.h:
	* generic/tclRegexp.c:
	* generic/tclTest.c:
	* tests/reg.test: updated to Henry Spencer's new regexp engine
	(mid-Sept 99).  Should greatly reduce stack space reqs.

	* library/tcltest1.0/pkgIndex.tcl: fixed procs in pkgIndex.tcl file

	* generic/tclEnv.c: fixed mem leak with putenv and DStrings
	* doc/Encoding.3: corrected docs
	* tests/basic.test: updated test cases for 8.3
	* tests/encoding.test: fixed test case that change system
	encoding to a double-byte one (this causes a bogus mem read
	error for purify)
	* unix/Makefile.in: purify has to use -best-effort to instrument
	* unix/tclAppInit.c: identified potential mem leak when compiling
	tcltest (not critical)
	* unix/tclUnixPipe.c: fixed mem leak in TclpCreateProcess when
	doing alloc between vfork and execvp.
	* unix/tclUnixTest.c: fixed mem leak in findexecutable test command

1999-10-05  Jeff Hobbs  <hobbs@@scriptics.com>

	* {win,mac,unix,tools,}/README:
	* win/README.binary:
	* win/makefile.vc:
	* {win,unix}/configure.in:
	* generic/tcl.h:
	* library/init.tcl: updated to 8.3a1 from 8.2.0.

	* library/http2.1/http.tcl: fixed possible use of global c var.

	* win/tclWinReg.c: fixed registry command to properly 'get'
	HKEY_PERFORMANCE_DATA root key data.  Needs more work.
	
	* generic/tclNamesp.c:
	* generic/tclVar.c:
	* generic/tclCmdIL.c: fixed comment typos

	* mac/tclMacFCmd.c: fixed filename stuff to support UTF-8 [Bug: 2869]

	* win/tclWinSerial.c: changed SerialSetOptionProc to return
	TCL_OK by default. (patch from Rolf Schroedter)

1999-09-21  Jennifer Hom  <jenn@@scriptics.com>

	* library/tcltest1.0/tcltest.tcl: Applied patches sent in by
	Andreas Kupries to fix typos in comments and ::tcltest::grep,
	fix hook redefinition problems, and change "string compare" to
	"string equal." [Bug: 2836, 2837, 2839, 2840]

1999-09-20  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/env.test:
	* unix/Makefile.in: added support for AIX LIBPATH env var [Bug:	2793]
	removed second definition of INCLUDE_INSTALL_DIR (the one that
	referenced @@includedir@@) [Bug: 2805]
	* unix/dltest/Makefile.in: added -lc to LIBS [Bug: 2794]

1999-09-16  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/timer.test: changed after delay in timer test 6.29 from
	1 to 10. [Bug: 2796]

	* tests/pkg.test:
	* generic/tclPkg.c: fixed package version check to disallow 1.2..3
	[Bug: 2539]

	* unix/Makefile.in: fixed gendate target - this never worked
	since RCS was intro'd.
	* generic/tclGetDate.y: updated to reflect previous changes
	to tclDate.c (leap year calc) and added CEST and UCT time zone
	recognition.  Fixed 4 missing UCHAR() casts. [Bug: 2717, 954,
	1245, 1249]

	* generic/tclCkalloc.c: changed Tcl_DumpActiveMemory to really
	dump to stderr and close it [Bug: 725] and changed Tcl_Ckrealloc
	and Tcl_Ckfree to not bomb when NULL was passed in [Bug: 1719]
	and changed Tcl_Alloc, et al to not panic when a alloc request
	for zero came through and NULL was returned (valid on AIX, Tru64)
	[Bug: 2795, etc]

	* tests/clock.test:
	* doc/clock.n:
	* generic/tclClock.c: added -milliseconds switch to clock clicks
	to guarantee that the return value of clicks is in the millisecs
	granularity [Bug: 2682, 1332]

1999-09-15  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclIOCmd.c: fixed potential core dump in conjunction
	with stacked channels with result obj manipulation in
	Tcl_ReadChars [Bug: 2623]

	* tests/format.test:
	* generic/tclCmdAH.c: fixed translation of %0#s in format [Bug: 2605]

	* doc/msgcat.n: fixed \\ bug in example [Bug: 2548]

	* unix/tcl.m4:
	* unix/aclocal.m4: added fix for FreeBSD-[1-2] recognition
	[Bug: 2070] and fix for IRIX SHLIB_LB_LIBS. [Bug: 2610]

	* doc/array.n:
	* tests/var.test:
	* tests/set.test:
	* generic/tclVar.c: added an array unset operation, with docs
	and tests.  Variation of [Bug: 1775].  Added fix in TclArraySet
	to check when trying to set in a non-existent namespace. [Bug: 2613]

1999-09-14  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/linsert.test:
	* doc/linsert.n:
	* generic/tclCmdIL.c: fixed end-int interpretation of linsert
	to correctly calculate value for end, added test and docs [Bug: 2693]

	* doc/regexp.n:
	* doc/regsub.n:
	* tests/regexp.test:
	* generic/tclCmdMZ.c: add -start switch to regexp and regsub
	with docs and tests

	* doc/switch.n: added proper use of comments to example.
	* generic/tclCmdMZ.c: changed switch to complain when an error
	occurs that seems to be due to a misplaced comment.

	* generic/tclCmdMZ.c: fixed illegal ref for \[0-9] substitutions
	in regsub [Bug: 2723]

	* generic/tclCmdMZ.c: changed [string equal] to return an Int
	type object (was a Boolean)

1999-09-01  Jennifer Hom  <jenn@@scriptics.com>

	* library/tcltest1.0/tcltest.tcl: Process command-line arguments
	only ::tcltest doesn't have a child namespace (requires that
	command-line args are processed in that namespace)

1999-09-01  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclParseExpr.c: changed '"' to '\"' to make FreeBSD
	happy [Bug: 2625]
	* generic/tclProc.c: moved static buf to better location and
	changed static msg that would overflow in ProcessProcResultCode
	[Bug: 2483] and added Tcl_DStringFree to Tcl_ProcObjCmd.
	Also reworked size of static buffers.
	* tests/stringObj.test: added test 9.11
	* generic/tclStringObj.c: changed Tcl_AppendObjToObj to
	properly handle the 1-byte dest and mixed src case where
	both had had Unicode string len checks made on them.  [Bug: 2678]
	* unix/aclocal.m4:
	* unix/tcl.m4: adjusted fix from 8-21 to add -bnoentry to the
	AIX-* case and readjusted the range

1999-08-31  Jennifer Hom  <jenn@@scriptics.com>

	* library/tcltest1.0/tcltest.tcl:
	* doc/tcltest.n:
	* tests/README: Modified testConstraints variable so that it isn't
	unset every time ::tcltest::initConstraints is called and cleaned up
	documentation in the README file and the man page.

1999-08-27  Jennifer Hom  <jenn@@scriptics.com>

	* tests/env.test:
	* tests/exec.test:
	* tests/io.test:
	* tests/event.test:
	* tests/tcltest.test: Added 'exit' calls to scripts that the tests 
	themselves write, and removed accidental checkin of knownBugThreaded
	constraints for Solaris and Linux.
	
	* library/tcltest1.0/tcltest.tcl:  Modified tcltest so that
	variables are only initialized to their default values if they did
	not previously exist. 

1999-08-26  Jennifer Hom  <jenn@@scriptics.com>

	* tests/tcltest.test:
	* library/tcltest1.0/tcltest.tcl:  Added a -args flag that sets a
	variable named ::tcltest::parameters based on whatever's being
	sent in as the argument to the -args flag. 

1999-08-23  Jennifer Hom  <jenn@@scriptics.com>

	* tests/tcltest.test: Added additional tests for -tmpdir, marked
	all tests that use exec as unixOrPc.

	* tests/encoding.test:
	* tests/interp.test: 
	* tests/macFCmd.test:
	* tests/parseOld.test:
	* tests/regexp.test: Applied patches from Jim Ingham to add
	encoding to a Mac only interp test, change an error message in
	macFCmd.tet, put a comment in parseOld.test, fix tests using the
	testencoding path command, and put unixOrPc constraints on tests
	that use exec. 

1999-08-21  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/aclocal.m4: Changed AIX-4.[2-9] check to AIX-4.[1-9]
	[Bug: 1909]

1999-08-20  Jeff Hobbs  <hobbs@@scriptics.com>
d7 1
a7 1
	* generic/tclPosixStr.c: fixed typo [Bug: 2592]
d9 3
a11 1
	* doc/*: fixed various nroff bugs in man pages [Bug: 2503 2588]
d13 1
a13 1
1999-08-19  Jeff Hobbs  <hobbs@@scriptics.com>
d15 2
a16 7
	* win/README.binary: fixed version info and some typos [Bug: 2561]
	
	* doc/interp.n: updated list of commands available in a safe
	interpreter [Bug: 2526]

	* generic/tclIO.c: changed Tcl_GetChannelNames* to use style guide
	headers (pleases HP cc)
d18 1
a18 1
1999-08-18  Jeff Hobbs  <hobbs@@scriptics.com>
d20 6
a25 124
	* doc/Eval.3: fixed doc on input args [Bug: 2114]

	* doc/OpenFileChnl.3:
	* doc/file.n:
	* tests/cmdAH.test:
	* tclIO.c:
	* tclCmdAH.c: added "file channels ?pattern?" tcl command, with
	associated Tcl_GetChannelNames and Tcl_GetChannelNamesEx public
	C APIs (added to tcl.decls as well), with docs and tests.

	* tests/expr.test:
	* generic/tclCompile.c: add TCL_TOKEN_VARIABLE to the part types
	that cause differed compilation for exprs, to correct the expr
	double-evaluation problem for vars.  Added test cases.
	Related to [Bug: 732]

	* unix/Makefile.in: changed the dependency structure so that
	install-* is dependent on * (ie - install-binaries is dependent
	on binaries).
	
	* library/auto.tcl:
	* library/init.tcl:
	* library/ldAout.tcl:
	* library/package.tcl:
	* library/safe.tcl:
	* library/word.tcl:
	* library/http2.1/http.tcl:
	* library/msgcat1.0/msgcat.tcl: updated libraries to better
	Tcl style guide (no more string comparisons with == or !=, spacing
	changes).

1999-08-05  Jim Ingham  <jingham@@cygnus.com>

	* mac/tclMacProjects.sea.hqx: Rearrange the projects so that the build
	directory is separate from the sources.	 Much more convenient!

1999-08-13  Scott Redman <redman@@scriptics.com>

	* /: 8.2.0 tagged for final release

1999-08-12  Scott Stanton  <stanton@@scriptics.com>

	* win/Makefile.in: Added COMPILE_DEBUG_FLAGS macro to make it
	easier to turn on compiler tracing.

	* tests/parse.test: 
	* generic/tclParse.c: Fixed bug in Tcl_EvalEx where the termOffset
	was not being updated in cases where the evaluation returned a non
	TCL_OK error code. [Bug: 2535]

1999-08-12  Scott Redman  <redman@@scriptics.com>

	* win/tclWinSerial.c: Applied patch from Petteri Kettunen to
	remove compiler warning.

1999-08-10  Scott Redman  <redman@@scriptics.com>

	* generic/tclAlloc.c:
	* generic/tclCmdIL.c:
	* generic/tclIO.c:
	* generic/tclThread.c:
	* win/tclWinThrd.c:
	* unix/tclUnixThrd.c: Fixed Brent's changes so that they work on
	Windows (and he fixed the bug in the Unix thread implementation).

1999-08-09  Brent Welch  <welch@@scriptics.com>
        
	* generic/tcl.decls:
	* generic/tclAlloc.c:
	* generic/tclCkalloc.c:
	* generic/tclCmdIL.c:
	* generic/tclDecls.h: 
	* generic/tclIO.c:
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c:
	* mac/tclMacThrd.c:
	* unix/tclUnixThrd.c:
	* win/tclWinThrd.c: Added use of Tcl_GetAllocMutex to tclAlloc.c
	and tclCkalloc.c so they can be linked against alternate thread
	packages. Added Tcl_GetChannelNames to tclIO.c.	Added
	TclVarTraceExists hook so "info exists" triggers read traces
	exactly like it did in Tcl 7.6. Stubs table changes to reflect new
	internal and external APIs.

1999-08-09  Jeff Hobbs  <hobbs@@scriptics.com>

	* tests/string.test: added largest_int proc to adapt for >32 bit
	machines and int overflow testing.
	* tests/tcltest.test: fixed minor error in 8.2 result (from dgp)

	* doc/Object.3: clarified Tcl_DecrRefCount docs [Bug: 1952]
	* doc/array.n: clarified array pattern docs [Bug: 1330]
	* doc/clock.n: fixed clock docs [Bug: 693]
	* doc/lindex.n: clarified to account for new end-int behavior.
	* doc/string.n: fixed formatting errors [Bug: 2188 2189]
	* doc/tclvars.n: fixed doc error [Bug: 2042]
	* library/init.tcl: fixed path handling in auto_execok (it could
	miss including the normal path on some Windows machines) [Bug: 1276]

1999-08-05  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/tclvars.n: Made it clear that tcl_pkgPath was not set
	for Windows (already mentioned in init.tcl) [Bug: 2455]
	* generic/tclLiteral.c: fixed reference to bytes that might
	not be null terminated (using objPtr->bytes, which is) [Bug: 2496]
	* library/http2.1/http.tcl: Made use of "i" in init section use
	local var and start at 0 (was 1). [Bug: 2502]

1999-08-04  Scott Stanton  <stanton@@scriptics.com>

	* tests/reg.test: Added test for REG_EXPECT bug fixed by Henry's
	patch.

	* generic/regc_nfa.c: 
	* generic/regcomp.c: 
	* generic/rege_dfa.c:
	* generic/regexec.c: 
	* generic/regguts.h: Applied patches supplied by Henry Spencer to
	greatly enhance the performance of certain classes of regular
	expressions. [Bug: 2440, 2447]

1999-08-03  Scott Redman  <redman@@scriptics.com>
d27 1
a27 2
	* win/tclWinInt.h: Remove function declarations in header that was
	moved to tclInt.decls file in previous changes.
d29 3
a31 1573
1999-08-02  Scott Redman  <redman@@scriptics.com>

	* unix/configure.in:
	* win/configure.in: Change beta level to b2.
	
	* generic/tcl.h:
	* generic/tcl.decls:
	* generic/tclDecls.h:
	* generic/tclInt.h:
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclRegexp.h:
	* generic/tclStubInit.c: Move some exported public and internal
	functions to the stub tables.  Removed functions that are in the
	stub tables (from this and previous changes) from the original
	header files.

1999-08-01  Scott Redman  <redman@@scriptics.com>

	* win/tclWinSock.c: Added comment block to SocketThread()
	function.  Added code to avoid calling TerminateThread(), but
	instead to send a message to the socket event window to tell it to
	terminate its thread.

1999-07-30  Jennifer Hom  <jenn@@scriptics.com>

	* tests/tcltest.test:
	* library/tcltest1.0/tcltest.tcl: Exit with non-zero status if
	there were problems with the way the test suite was started
	(e.g. wrong # arguments).  

1999-07-30  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tclInt.decls: added declaractions necessary for the
	Tcl test code to work wth stubs [Bug: 2445]

1999-07-30    <redman@@scriptics.com>

	* win/tclWinPipe.c:
	* win/Makefile.in: Fixing launching of 16-bit apps on Win9x from
	wish.  The command line was primed with tclpip82.dll, but it was
	ignored.  Fixed that, then fixed the gmake makefile to build
	tclpip82.dll as an executable.

	* win/tclWinSock.c: Applied small patch to get thread-specific
	data after initializing the socket driver.

	* unix/tclUnixThrd.c: Applied patch to fix threads on Irix 6.5.
	Patch from James Dennett.  [Bug: 2450]

	* tests/info.test: Enable test for tclParse.c change (info
	complete).
	
1999-07-30    <hobbs@@scriptics.com>

	* tclIO.c: added fix for Kupries' trf patch [Bug: 2386]

	* tclParse.c: fixed bug in info complete regarding nested square
	brackets [Bug: 2382, 2466]
	
1999-07-29    <redman@@scriptics.com>

	* win/tclWinChan.c: Allow tcl to open CON and NUL, even for std
	channels.  Checking for bad/unusable std channels was moved to Tk
	since its only purpose was to check whether to use the Tk Console
	Window for the std channels.  [Bug: 2393 2392 2209 2458]

	* unix/mkLinks.tcl: Applied patch to avoid linking pack.n to
	pack-old.n.  Patch from Don Porter. [Bug: 2469]

	* doc/Encoding.n: Applied patch to fix typo in .SH NAME line.
	Patch from Don Porter.  [Bug: 2451]
	
	* win/tclWinSock.c:  Free Win32 Event handles when destroying
	the socket helper thread.

1999-07-28    <jenn@@scriptics.com>

	* tests/tcltest.test:
	* library/tcltest1.0/tcltest.tcl: Fixed the condition under which
	::tcltest::PrintError had an infinite loop problem and added a
	test case for it.  Added an optional argument to
	::tcltest::getMatchingFiles telling it where to search for test
	files. 

1999-07-27    <redman@@scriptics.com>

	* tools/tclSplash.bmp:  Updated Windows installer bitmap
	to ready Tcl/Tk Version 8.2.

1999-07-26    <redman@@scriptics.com>

	* tests/tcltest.test:  Need to close the new core file, there
	seems to be a hang in threaded WinNT if the file isn't closed.
	Open issue, need to fix that hang.

	* tests/httpold.test:  Add time delay in response from Http server
	so that test cases can properly detect timeout conditions with
	threads enabled on multi-CPU WinNT.

	* tests/winFCmd.test:  Test case winFcmd-1.33 was looking for
	c:\windows, which may not exist.  Instead, create a new directory
	on c:\ and use it for the test.

	* win/tclWinConsole.c:
	* win/tclWinPipe.c:
	* win/tclWinSock.c:  Fix terminating helper threads by holding any
	mutexes from the primary thread while waiting for the helper
	thread to terminate.  Without these changes, the test suite hangs
	on WinNT with 2 CPUs and threads enabled.  Open issue, seems to be
	a sporadic hang on dual CPU systems still (very rare).

1999-07-26  Jennifer Hom  <jenn@@scriptics.com>

	* tests/tcltest.test:
	* library/tcltest1.0/tcltest.tcl:
	* doc/tcltest.n: Cleaned up code in ::tcltest::PrintError, revised
	documentation, and added tests for the tcltest package.

1999-07-23    <redman@@scriptics.com>

	* tests/info.test:
	* generic/tclParse.c:  Removed patch for info command, breaks test
	cases on Unix.  Patch was bad and needs to be redone
	properly. [Bug: 2382]

1999-07-22    <redman@@scriptics.com>

	* Changed version to 8.2b2.

	* win/tclWinSock.c: Fixed hang with threads enabled, fixed
	semaphores with threads disabled.

	* win/safe.test: Fixed safe-6.3 with threads enabled.
	
	* win/Makefile.in:  Fixed calling of tcltest to fix safe.test
	failures due to path TCL_LIBRARY path.

	* win/tclWinPort.h: Block out include of sys/*.h in order to
	build extensions with MetroWerks compiler for Win32. [Bug: 2385]
	
	* generic/tclCmdMZ.c:
	* generic/tclIO.c: Fix ANSI-style prototypes based on patch from
	Ulrich Ring.  [Bug: 2391]
	
	* unix/Makefile.in: Need to make install-sh executable before
	calling (with chmod +x).  [Bug: 2413]
	
	* tests/var.test:
	* generic/tclVar.c:  Fixed bug that caused a seg. fault when using
	"array set a(b) {}", which is a bad array name anyway.  Now the
	"array set" command will return an error in this case.  Added test
	case and fixed existing test. [Bug: 2427]

1999-07-21    <redman@@scriptics.com>

	* tests/info.test:
	* generic/tclParse.c:  Applied patch to fix "info complete"
	for the string {[a [b]}.  Patch from Peter Spjuth. [Bug: 2382]

	* doc/Utf.3:
	* generic/tcl.decls:
	* generic/tclDecls.h:
	* generic/tclUtf.c: Changed function declarations in
	non-platform-specific public APIs to use "unsigned long" instead of
	"size_t", which may not be defined on certain compilers (rather
	than include sys/types.h, which may not exist).
	
	* unix/Makefile.in: Added the Windows configure script to the
	distribution file list, already shipping configure.in and the .m4
	files, but needed the configure script itself.
	
	* win/makefile.vc: Changed version number of DDE package in VC++
	makefile to use 1.1 instead of 1.0.

	* doc/open.n: Added documentation of \\.\comX notation for opening
	serial ports on Windows (alternative to comX:).
	
	* tests/ioCmd.test:
	* doc/open.n:
	* win/tclWinSerial.c: Applied patch from Rolf Schroedter to add
	-pollinterval option to fconfigure to modify the maxblocktime used
	in the fileevent polling. Added documentation and fixed the test
	case as well.
	
	* win/tclWinSock.c: Modified 8.1.0 version of the Win32 socket
	driver to move the handling of the socket event window in a
	separate thread.  It also turned out that Win95 & Win98 were, in
	some cases, getting multiple FD_ACCEPTs but only handling one.
	Added a count for the FD_ACCEPT to take care of this.  Tested on
	NT4 SP3, NT4 SP4, Win95, and Win98.
	[Bug: 2178 2256 2259 2329 2323 2355]

1999-07-21    <jpeek@@scriptics.com>

	* README: Small tweaks to clean up typos and wording.

1999-07-20  Melissa Hirschl  <hershey@@matisse.scriptics.com>

	* generic/tclInitScript.h: 
	* unix/tclUnixInit.c: merged code with 8.0.5.  We now use an
	intermediate global tcl var "tclDefaultLibrary" to keep the
	"tcl_library" var from being set by the default value in the
	Makefile.  Also fixed a bug in which caused the value of
	TCL_LIBRARY env var to be ignored.
	* unix/tclWinInit.c: just updated some comments.

1999-07-19  Melissa Hirschl  <hershey@@matisse.scriptics.com>

	* library/http2.1/http.tcl: updated -useragent text to say version
	2.1.

1999-07-16    <redman@@scriptics.com>

	* generic/tcl.decls:
	* generic/tclDecls.h:
	* generic/tclStubInit.c:  Add Tcl_SetNotifier to stub table.
	[Bug: 2364]
	
	* unix/aclocal.m4:
	* unix/tcl.m4:  Add check for Alpha/Linux to correct the IEEE
	floating flag to the compiler, should be -mieee.  Patch from Don
	Porter.
	
	* tools/tcl.hpj.in: Change version number of .cnt file referenced
	in .HPJ file.

1999-07-15    <redman@@scriptics.com>
	
	* tools/tcl.wse.in: Fixed naming of target files for Windows.

1999-07-14    <jpeek@@scriptics.com>

	* doc/re_syntax.n: Deleted sentence as suggested by Scott S.

1999-07-12    <jpeek@@scriptics.com>

	* doc/re_syntax.n: Removed two notes to myself (oops), cleaned
	up wording, fixed changebars, made two examples easier to read.

1999-07-11    <redman@@scriptics.com>

	* win/makefile.vc: Since the makefile.vc should continue to work
	while we're working out bugs/issues in the new TEA-style
	autoconf/configure/gmake build mechanism for Windows, the version
	numbers of the Tcl libraries need to remain in sync.  Modified the
	version numbers in the makefile to reflect the change to 8.2b1.

1999-07-09    <redman@@scriptics.com>

	* win/configure.in: Eval DLLSUFFIX, LIBSUFFIX, and EXESUFFIX in
	the configure script so that substitutions get expanded before
	being placed in the Makefile.  The "d" portion for debug libraries
	and DLLs was not being set properly.
	
1999-07-08    <stanton@@scriptics.com>

	* tests/string.test: 
	* generic/tclCmdMZ.c: Fixed bug in string range bounds checking
	code.

1999-07-08  Jennifer Hom  <jenn@@scriptics.com>

	* doc/tcltest.n:
	* library/tcltest1.0/tcltest.tcl: Removed -asidefromdir and
	-relateddir flags, removed unused ::tcltest::dotests proc, cleaned
	up implementation of core file checking, and fixed the code that
	checks for 1-letter flag abbreviations.

1999-07-08    <stanton@@scriptics.com>

	* win/Makefile.in: Added tcltest target so runtest works
	properly.  Added missing names to the clean/distclean targets.

	* tests/reg.test: 
	* generic/rege_dfa.c: Applied fix supplied by Henry Spencer for
	bug in DFA state caching under lookahead conditions.  [Bug: 2318]

1999-07-07    <stanton@@scriptics.com>

	* doc/fconfigure.n: Clarified default buffering behavior for the
	standard channels. [Bug: 2335]

1999-07-06    <redman@@scriptics.com>

	* win/tclWinSerial.c:  New implementation of serial port driver
	from Rolf Shroedter (Rolf.Schroedter@@dlr.de) that allows more than
	one byte to be read from the port.  Implemented using polling
	instead of threads, there is a max. 10ms latency between checking the
	port for file events.  [Bug: 1980 2217]

1999-07-06    <welch@@scriptics.com>

	* library/http2.0/http.tcl: Fixed the -timeout option so it
	handles timeouts that occur during connection attempts to
	hosts that are down (the only case that really matters!)

1999-07-03    <welch@@scriptics.com>

	* doc/ChnlStack.3:
	* generic/tcl.decls:
	* generic/tclIO.c: Added a new variant of the "Trf patch"
	from Andreas Kupres that adds new C APIs Tcl_StackChannel,
	Tcl_UnstackChannel, and Tcl_GetStackedChannel.

1999-07-03    <welch@@scriptics.com>

	* generic/tclNotify.c:
	* unix/tclUnixNotfy.c:
	* unix/tclXtTest.c:
	* unix/tclXtNotify.c:
	* win/tclWinNotify.c:
	* mac/tclMacNotify.c: Added Tcl_SetNotifier and the associated
	hook points in the notifiers to be able to replace the notifier
	calls at runtime  The Xt notifier and test program use this hook.

1999-07-03    <welch@@scriptics.com>

	* generic/tclParse.c: Changed parsing of variable names to
	allow empty array names.  Now "$(foo)" is a variable reference!
	Previous you had to use something like $::(foo), which is slower.
	This change is requested by Jean-Luc Fontaine for his STOOOP
	package.

1999-07-01    <redman@@scriptics.com>

	* generic/tclCmdAH.c:
	* generic/tclFCmd.c: Call TclStat instead of TclpStat in order to
	allow Tcl_Stat hooks to work properly.

1999-06-29  Jennifer Hom  <jenn@@scriptics.com>

	* library/tcltest1.0/pkgIndex.tcl:
	* library/tcltest1.0/tcltest.tcl:
	* doc/tcltest.n:
	* tests/all.tcl: Added -preservecore, -limitconstraints, -help,
	-file, -notfile, -relateddir and -asidefromdir flags to the
	tcltest package along with exported proc
	::tcltest::getMatchingFiles.  The documentation was modified to
	match and all.tcl was modified to use the new functionality
	instead of implementing -file itself. 

1999-06-28    <redman@@scriptics.com>

	* generic/tclIndexObj.c:
	* doc/GetIndex.3:
	* tests/binary.test:
	* tests/winDde.test: Applied patch from Peter Hardie (with
	changes) to fix problem with Tcl_GetIndexFromObj() when the key
	being passed is the empty string.  It used to match "" and return
	TCL_OK, but it should have returned TCL_ERROR instead.  Added test
	case to "binary" and "dde" commands to check the behavior.  Added
	documentation note as well.

1999-06-26    <redman@@scriptics.com>

	* win/tclWinDde.c: Applied patch from Peter Hardie to add poke
	command to dde.  Also rev'd version of dde package to 1.1.
	[Bug: 1738]

1999-06-25  Jennifer Hom  <jenn@@scriptics.com>

	* unix/Makefile.in:
	* win/Makefile.in:
	* library/tcltest1.0/pkgIndex.tcl:
	* library/tcltest1.0/tcltest.tcl:
	* library/tcltest1.0: Added initial implementation of the Tcl test
	harness package.  This package was based on the defs.tcl file that
	was part of the tests directory. Reversed the way that tests were
	evaluated to fix a problem with false passes.

	* doc/tcltest.n: Added documentation for the tcltest package.

	* tests/README:
	* tests/defs.tcl:
	* tests/all.tcl: Modified all test files (tests/*.test) and
	all.tcl to use the new tcltest package and removed references to
	the defs.tcl file. Modified the README file to point to the man
	page for tcltest. 
	
1999-06-25    <stanton@@scriptics.com>

	* tests/reg.test: 
	* generic/regexec.c: Fixed bugs in non-greedy quantifiers.

1999-06-23    <jpeek@@scriptics.com>

	* doc/re_syntax.n:
	* doc/switch.n:
	* doc/lsearch.n:
	* doc/RegExp.3:
	* doc/regexp.n:
	* doc/regsub.n: Moved information about syntax of 8.1 regular
	expressions from regexp(n) manpage into new re_syntax(n) page.
	Added pointers from other manpages to new re_syntax(n) page.

1999-06-23    <stanton@@scriptics.com>

	* unix/Makefile.in: Changed install-doc to install-man.

	* tools/uniParse.tcl: 
	* tools/uniClass.tcl: 
	* tools/README: 
	* tests/string.test: 
	* generic/regc_locale.c: 
	* generic/tclUniData.c: 
	* generic/tclUtf.c: 
	* doc/string.n: Updated Unicode character tables to reflect latest
	Unicode 2.1 data.  Also rationalized "regexp" and "string is"
	definitions of character classes.

1999-06-21    <stanton@@scriptics.com>

	* unix/tclUnixThrd.c (TclpThreadCreate): Fixed memory leak where
	thread attributes were not being released. [Bug: 2254]

1999-06-17    <stanton@@scriptics.com>

	* tests/regexp.test: 
	* generic/tclCmdMZ.c: 
	* generic/tclCmdIL.c: Changed to use new regexp interfaces.  Added
	-expanded, -line, -linestop, and -lineanchor switches to regsub.

	* doc/RegExp.3: Documented the new regexp interfaces and
	the compile/execute flags.
	
	* generic/tclTest.c: 
	* generic/tclRegexp.h:
	* generic/tclRegexp.c: 
	* generic/tcl.h: 
	* generic/tcl.decls: Renamed Tcl_RegExpMatchObj to
	Tcl_RegExpExecObj and added a new Tcl_RegExpMatchObj that is
	equivalent to Tcl_RegExpMatch.  Added public macros for the regexp
	compile/execute flags.  Changed to store either an object pointer
	or a string pointer in the TclRegexp structure.  Changed to avoid
	adding a reference to the object or copying the string.

	* generic/regcomp.c: lint

	* tests/reg.test: 
	* generic/regex.h: 
	* generic/regc_lex.c: Added REG_BOSONLY flag to allow Expect to
	iterate through a string an only find matches that start at the
	current position within the string.

1999-06-16  <wart@@scriptics.com>

	* unix/configure.in:
	* unix/Makefile.in:
	* unix/tcl.m4:
	* unix/aclocal.m4: Numerous build changes to make Tcl conform to the
	proposed TEA spec

1999-06-16  Melissa Hirschl  <hershey@@matisse.scriptics.com>

	* generic/tclVar.c (Tcl_VariableObjCmd): fixed premature increment
	in loop that was causing out-of-bounds reads on array "varName".

1999-06-16    <stanton@@scriptics.com>

	* tests/execute.test:
	* generic/tclExecute.c (TclExecuteByteCode): Fixed crash caused by
	a bug in INST_LOAD_SCALAR1 where the scalar index was read as
	a signed 1 byte value instead of unsigned.  [Bug: 2243]

1999-06-14  Melissa Hirschl  <hershey@@matisse.scriptics.com>

	* doc/StringObj.3
	* test/stringObj.test
	* unix/Makefile.in
	* win/Makefile.in
	* win/makefile.vc
	* generic/tclStringObj.c:
	Merged String and Unicode object types.  Added new functions to
	the puplic API:  Tcl_NewUnicodeObj, Tcl_SetUnicodeObj,
	Tcl_GetUnicode, Tcl_GetUniChar, Tcl_GetCharLength, Tcl_GetRange,
	Tcl_AppendUnicodeToObj.

1999-06-09    <stanton@@scriptics.com>

	* generic/tclUnicodeObj.c: Lots of cleanup and simplification.
	Fixed several memory bugs.  Added TclAppendUnicodeToObj.  

	* generic/tclInt.h: Added declarations for various Unicode string
	functions.  

	* generic/tclRegexp.c: 
	* generic/tclCmdMZ.c: Changed to use new Unicode string interfaces
	for better performance. 
	
	* generic/tclRegexp.h: 
	* generic/tclRegexp.c: 
	* generic/tcl.h: 
	* generic/tcl.decls: Added Tcl_RegExpMatchObj and
	Tcl_RegExpGetInfo calls to access lower level regexp API.  These
	features are needed by Expect.  This is a preliminary
	implementation pending final review and cleanup.

	* generic/tclCmdMZ.c:
	* tests/string.test: Fixed bug where string map failed on null
	strings. 

	* generic/regexec.c: 
	* unix/tclUnixNotfy.c: lint

	* tools/genStubs.tcl: Changed to always write output in LF mode.

1999-06-08    <stanton@@scriptics.com>

	* win/tclWinSock.c: Rolled back to the 8.1.0 implementation
	because of serious problems with the new driver.  Basically no
	incoming socket connections would be reported to a server port.
	The 8.1.1 code needs to be redesigned and fixed correctly.

1999-06-07  Melissa Hirschl  <hershey@@matisse.scriptics.com>

	* tests/string.test: 
	* generic/tclVar.c (Tcl_SetVar2Ex):
	* generic/tclStringObj.c (Tcl_AppendObjToObj):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): optimized the string
	index, string length, string range, and append command in cases
	where the object's internal rep is a bytearray.  Objects with
	other internal reps are converted to have the new unicode internal
	rep.  

	* unix/Makefile.in: 
	* win/Makefile.in: 
	* win/Makefile.vc: 
	* tests/unicode.test: 
	* generic/tclInt.h:
	* generic/tclObj.c:
	* generic/tclUnicodeObj.c: added a new object type to store the
	unicode representation of a string.

	* generic/tclTestObj.c: added the objtype option to the testobj
	command.  This option returns the name of the type of internal rep
	an object has.

1999-06-04    <stanton@@scriptics.com>

	* win/configure.in: 
	* win/Makefile.in: Windows build now handles static/dynamic
	debug/nodebug builds and supports the standard targets using
	Cygwin user tools plus GNU make and autoconf.

1999-06-03    <stanton@@scriptics.com>

	* generic/tclCmdMZ.c (Tcl_StringObjCmd): 
	* tests/string.test: Fixed bug where string equal/compare -nocase
	reported wrong result on null strings. [Bug: 2138]

1999-06-02    <stanton@@scriptics.com>

	* generic/tclUtf.c (Tcl_UtfNcasecmp): Fixed incorrect computation
	of relative ordering. [Bug: 2135]

1999-06-01    <stanton@@scriptics.com>

	* unix/configure.in: Fixed various small configure.in patches
	submitted by Jan Nijtmans. [Bug: 2121]

	* tests/reg.test: 
	* generic/regc_color.c: 
	* generic/regc_cvec.c: 
	* generic/regc_lex.c: 
	* generic/regc_locale.c: 
	* generic/regc_nfa.c: 
	* generic/regcomp.c: 
	* generic/regcustom.h: 
	* generic/rege_dfa.c: 
	* generic/regerror.c: 
	* generic/regerrs.h: 
	* generic/regex.h: 
	* generic/regexec.c: 
	* generic/regfree.c: 
	* generic/regfronts.c: 
	* generic/regguts.h: 
	* generic/tclCmdMZ.c: 
	* generic/tclRegexp.c: 
	* generic/tclRegexp.h: 
	* generic/tclTest.c: Applied Henry Spencer's latest regexp patches
	that fix an infinite loop bug and add support for testing whether
	a string could match with additional input.  [Bug: 2117]

1999-05-28    <stanton@@scriptics.com>

	* generic/tclObj.c: Changed to eliminate use of isupper/tolower in
	favor of the Unicode versions.

	* win/Makefile.in:
	* win/configure.in: Added preliminary TEA implementation.

	* win/tclWinDde.c: Fixed bug where dde calls were being passed an
	invalid dde handle because Initialize had not been called.
	[Bug: 2124]

1999-05-26    <redman@@scriptic.com>

	* generic/tclThreadTest.c: Fixed race condition in testthread
	code that showed up in the WinNT test suite intermittently.

	* win/tclWinSock.c: Fixed a hang in the WinNT socket driver, wake
	up the socket thread every 100ms to check for events on the
	sockets that did not wake up the thread (race condition).

1999-05-24    <stanton@@scriptics.com>

	* tools/genStubs.tcl: Changed to allow a list of platforms instead
	of just one at a time.

	* generic/tcl.decls: 
	* generic/tclCmdMZ.c: 
	* generic/tclDecls.h: 
	* generic/tclInt.decls: 
	* generic/tclIntDecls.h: 
	* generic/tclPort.h: 
	* generic/tclStubInit.c: 
	* generic/tclStubLib.c: Various header file related changes and other
	lint to try to get the Mac builds working.

1999-05-21    <redman@@scriptics.com>

	* win/tclWinPipe.c: Fix bug when launching command.com on
	Win95/98.  Need to wait for the procInfo.hProcess of the process that
	was created, not the hProcess of the current process.  [Bug: 2105]

1999-05-20    <redman@@scriptics.com>

	* library/init.tcl: Add the directory where the executable is, and
	the ../lib directory relative to that, to the auto_path variable.
	
1999-05-19    <stanton@@scriptics.com>

	Merged in various changes submitted by Jeff Hobbs:
	
	* generic/tcl.decls: 
	* generic/tclUtf.c: Added Tcl_UniCharIs* functions for control,
	graph, print, and punct classes.

	* generic/tclUtil.c:
	* doc/StrMatch.3: Added Tcl_StringCaseMatch() implementation to
	support case-insensitive globbing.
	
	* doc/string.n: 
	* unix/mkLinks: 
	* tests/string.test: 
	* generic/tclCmdMZ.c: Added additional character class tests,
	added -nocase switch to "string match", changed string first/last
	to use offsets.

1999-05-19    <redman@@scriptics.com>

	* generic/tcl.h: Add extern "C" block around entire header file for
	C++ compilers to fix linkage issues.  Submitted by Don Porter and
	Paul Duffin.

	* generic/tclRegexp.c: Fix bug when the regexp cache is empty
	and an empty pattern is used in regexp ( such as {} or "" ).

1999-05-18    <stanton@@scriptics.com>

	* win/tclWinChan.c: Modified initialization code to avoid
	inherenting closed or invalid channels.  If the standard input is
	anything other than a console, file, serial port, or pipe, then we
	fall back to the standard Tk window console.

1999-05-14    <stanton@@scriptics.com>

	* generic/tclCmdAH.c (Tcl_ForObjCmd): Fixed crash caused by
	failure to reset the result before evaluating the test
	expression. 

1999-05-14    <surles@@scriptics.com>

	* generic/tclBasic.c (Tcl_CreateInterp): Added introspection
	variable for threaded interps.  If the interp was compiled with
	threads enabled, the tcl_platform(threaded) variable will exist.

1999-05-14    <redman@@scriptics.com>

	* generic/tclDate.c: Applied patch to fix 100-year and 400-year
	boundaries in leap year code, from Isaac Hollander.  [Bug: 2066]

1999-05-13    <stanton@@scriptics.com>

	* unix/Makefile.in:
	* unix/tclAppInit.c: Minor cleanup related to Xt notifier.
	
	* unix/tclUnixInit.c (TclpSetInitialEncodings): Tcl now looks for
	an encoding subfield in the LANG/LC_ALL variables in cases where
	the locale is not found in the locale table.  Ensure that
	setlocale() is called at least once so X11 will initialize
	properly.  Also, forces the LC_NUMERIC locale to be "C" so numeric
	processing in scripts is not affected by the current locale
	setting. [Bug: 1989]

	* generic/tclRegexp.c: Increased per-thread regexp cache to 30
	slots.  This seems to be about the right number for larger
	applications like exmh.  [Bug: 1063]

1999-05-12    <stanton@@scriptics.com>

	* doc/tclsh.1: Updated references to rc script names to accurately
	reflect the platform differences on Windows.

	* tests/regexp.test: 
	* generic/tclInt.h: 
	* generic/tclBasic.c: 
	* generic/tclRegexp.h:
	* generic/tclRegexp.c: Replaced the per-interpreter regexp cache
	with a per-thread cache.  Changed the Regexp object to take
	advantage of this extra cache.  Added a reference count to the
	TclRegexp type so regexps can be shared by multiple objects.
	Removed the per-interp regexp cache from the interpreter.  Now
	regexps can be used with no need for an interpreter. [Bug: 1063]

	* win/tclWinInit.c (TclpSetVariables): Avoid calling GetUserName
	if the value can be determined from the USERNAME environment
	variable.  GetUserName is very slow.

1999-05-07    <stanton@@scriptics.com>

	* win/winDumpExts.c: 
	* win/makefile.vc: Removed incorrect patch. [Bug: 1998]
	
	* generic/tcl.decls: Replaced const with CONST.

	* generic/tclResult.c (Tcl_AppendResultVA): 
	* generic/tclStringObj.c (Tcl_AppendStringsToObjVA): Fixed to copy
	arglist using memcpy instead of assignment so it works properly on
	OS/390. [Bug: 1997]

	* generic/tclLoadNone.c: Updated to use current interfaces, added
	TclpUnloadFile. [Bug: 2003]

	* win/winDumpExts.c: 
	* win/makefile.vc: Changed to emit library name in defs
	file. [Bug: 1998]

	* unix/configure.in: Added fix for OS/390. [Bug: 1976]

1999-05-06    <stanton@@scriptics.com>

	* tests/string.test: 
	* generic/tclCmdMZ.c: 
	* doc/string.n: Fixed bug in string equal/compare code when using
	-length option.  Cleaned up docs a bit more.

	* tests/http.test: Unset "data" array before running tests to
	avoid failures due to previous tests.

	* doc/string.n: 
	* tests/cmdIL.test: 
	* tests/cmdMZ.test: 
	* tests/error.test: 
	* tests/ioCmd.test: 
	* tests/lindex.test: 
	* tests/linsert.test: 
	* tests/lrange.test: 
	* tests/lreplace.test: 
	* tests/string.test: 
	* tests/cmdIL.test: 
	* generic/tclUtil.c: 
	* generic/tclCmdMZ.c: Replaced "string icompare/iequal" with
	-nocase and -length switches to "string compare/equal".  Added a
	-nocase option to "string map".  Changed index syntax to allow
	integer or end?-integer? instead of a full expression.  This is
	much simpler with safeTcl scripts since it avoids double
	substitution issues.

	* doc/Utf.3: 
	* generic/tclStubInit.c: 
	* generic/tclDecls.h: 
	* generic/tclUtf.c:
	* generic/tcl.decls: Added Tcl_UtfNcmp and Tcl_UtfNcasecmp.

1999-05-05    <stanton@@scriptics.com>

	* win/makefile.vc: Added encoding directory to install-libraries
	target.

1999-05-03    <stanton@@scriptics.com>

	* doc/string.n: 
	* tests/cmdMZ.test: 
	* tests/string.test: 
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): Changed "string length"
	to avoid regenerating the string rep of a ByteArray object.
	
	* tests/cmdIL.test: 
	* tests/cmdMZ.test: 
	* tests/error.test: 
	* tests/lindex.test:
	* tests/linsert.test: 
	* tests/lrange.test: 
	* tests/lreplace.test: 
	* tests/string.test: 
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): 
	* generic/tclUtil.c (TclGetIntForIndex): Applied Jeff Hobbs's
	string patch which includes the following changes [Bug: 1845]:
	
	    - string compare now takes optional length arg (for strncmp
		behavior)
                            
            - added string equal (just a few lines of code blended
                in with string compare)
            
            - added string icompare/iequal for case-insensitive comparisons
            
            - string index's index can now be ?end[+-]?expression
                I made this change in the private TclGetIntForIndex,
                which means that the list commands also benefit, as
                well as string range, et al.
            
            - added [string repeat string count]
                Repeats given string  number of times
            
            - added string replace, string equiv to lreplace
              (quasi opposite of string range):
                        string replace first last ?string?
                Example of use, replacing end of string with ...
                should the string be more than 16 chars long:
                        string replace $string 16 end "..."
                This just returns the string len < 16, so it
                will only affect the long strings.
            
            - added optional first and last args to string to*
                This allows you to just affect certain regions of
                a string with the command (like just capping the
                first letter).  I found the original totitle to
                be too draconian to be useful.
            
            - added [string map charMap string]
                where charMap is a {from to from to} list that equates to
                what one might get from [array get].  Each  and 
                can be multiple chars (or none at all).  For Tcl/CGI users,
                this is a MAJOR speed booster.
	
	* generic/tclParse.c (Tcl_ParseCommand): Changed to avoid
	modifying eval'ed strings that are already null terminated.
	[Bug: 1793] 

	* tests/binary.test: 
	* generic/tclBinary.c (DupByteArrayInternalRep): Fixed bug where
	type was not being set in duplicated object. [Bug: 1975, 2047]

1999-04-30    <stanton@@scriptics.com>
	
	* Changed version to 8.1.1.
	
1999-04-30    <stanton@@scriptics.com>

	* Merged changes from 8.1.0 branch:

	* generic/tclParse.c: Fixed memory leak in CommandComplete.

	* generic/tclPlatDecls.h: 
	* generic/tclIntPlatDecls.h: 
	* generic/tclIntDecls.h: 
	* generic/tclDecls.h: 
	* tools/genStubs.tcl: Added 'extern "C" {}' block around the stub
	table pointer declaration so the stub library can be used from
	C++. [Bug: 1934]

	* Lots of documentation and other release engineering fixes.

1999-04-28    <stanton@@scriptics.com>

	* mac/tclMacResource.c: 
	* generic/tclListObj.c: 
	* generic/tclObj.c: 
	* generic/tclStringObj.c: Changed to avoid freeing the string
	representation before freeing the internal rep.  This helps with
	debugging since the string rep will still be valid when the free
	proc is invoked.

1999-04-27    <stanton@@scriptics.com>

	* generic/tclLiteral.c (TclHideLiteral): Fixed so hidden literals
	get duplicated to avoid accidental sharing in the global object
	table. 

1999-04-23    <stanton@@scriptics.com>

	* generic/tclStubInit.c: 
	* tools/genStubs.tcl: Changed to avoid the need for forward
	declarations in stub initializers.

1999-04-23    <stanton@@scriptics.com>

	* library/encoding/koi8-r.enc:
	* tools/encoding/koi8-r.txt: Added support for the koi8-r Cyrillic
	encoding. [Bug: 1771]

1999-04-22    <stanton@@scriptics.com>

	* win/tclWinFCmd.c:
	* win/tclWin32Dll.c: Changed uses of "try" to "__try", since that
	is the actual keyword.  This eliminates the need for some -D flags
	from the makefile.

	* generic/tclPort.h: Added include of tcl.h since it defines
	various Windows macros that are needed before deciding which
	platform porting file to use.

	* generic/tclEvent.c: lint

	* win/tclWinInit.c (TclpInitPlatform): Added call to TclWinInit
	when building a static library since DllMain will not be invoked.
	This could break old code that explicitly called TclWinInit, but
	should be simpler in the long run.

1999-04-22  Scott Stanton  <stanton@@scriptics.com>

	* generic/tclInt.h: 
	* generic/tclInt.decls: 
	* generic/tclCompile.c: Added TclSetByteCodeFromAny that takes a
	hook procedure to invoke after compilation but before the byte
	codes are emitted.  This makes it possible to do postprocessing on
	the compiled byte codes before the ByteCode is generated.

	* generic/tclLiteral.c: Added TclHideLiteral and TclAddLiteralObj
	to make it possible to create local unshared literal objects.
	
	* win/tclWinInit.c:
	* unix/tclUnixInit.c: Changed initial search path to match that
	found used by tcl_findLibrary.

1999-04-22    <redman@@scriptics.com>

	* win/tclWinPort.h:
	* win/tclWinSock.c: Added code to use WinSock 2.0 API on NT to
	avoid creating a window to handle sockets.  API not available on
	Win95 and needs to be fixed on Win98, until then continue to use
	the older (window-based) scheme on those two OSes.
	
1999-04-15    <stanton@@scriptics.com>

	* Merged 8.1 back into the main trunk

1999-04-13    <stanton@@scriptics.com>

	* library/encoding/gb2312.enc:
	* library/encoding/euc-cn.enc:
	* tools/encoding/gb2312.txt:
	* tools/encoding/cp950.txt:
	* tools/encoding/Makefile: Restored the double byte definition of
	GB2312 and added the EUC-CN encoding.  EUC-CN is a variant of
	GB2312 that shifts the characters into bytes with the high bit set
	and includes ASCII as a subset. [Bug: 632]

1999-04-13    <redman@@scriptics.com>

	* win/tclWinSock.c: Apply patch to allow write access to a socket
	if FD_WRITE is sent but FD_CONNECT is not.  Some strange problem
	with either Win32 or a socket driver.  [Bug: 1664 1776]

1999-04-09    <redman@@scriptics.com>

	* unix/tclUnixNotfy.c: Fixed notifier deadlock situation when the
	pipe used to talk back notifier thread is filled with data.  When
	calling the write() function to feed data down that pipe, unlock
	the notifierMutex to allow the notifier to wake up again.  Found
	as a result of the focus.test for Tk hanging. [Bug: 1700]

1999-04-06    <stanton@@scriptics.com>

	* tests/unixNotfy.test: Fixed hang in tests when built with thread
	support. 

	* tests/httpold.test: Fixed broken test that didn't wait long
	enough for events to arrive.

	* tests/unixInit.test: Fixed race condition in test.
	
	* tests/unixInit.test: 
	* tests/fileName.test: Minor test nits.

	* unix/tclUnixInit.c (TclpSetInitialEncodings): Fixed bad initial
	encoding string.

1999-04-06    <surles@@scriptics.com>

	* generic/tclVar.c: 
	* generic/tclEnv.c: Moved the "array set" C level code into a
	common routine (TclArraySet).  The TclSetupEnv routine now uses
	this API to create an env array w/ no elements.

	* generic/tclEnv.c:
	* generic/tclWinInit.h:
	* generic/tclUnixInit.h:
	* generic/tclInt.h: Made the Env module I18N compliant.  Changed the
	FindVariable routine to TclpFindVariable, that now does a case
	insensitive string comparison on Windows, and not on UNIX. [Bug:
	1299, 1500]

1999-04-05    <stanton@@scriptics.com>

	* tests/io.test: Minor test cleanup.

	* generic/tclEncoding.c (Tcl_CreateEncoding): Minor lint to make
	it easier to compile on Digital-unix. [Bug: 1659]

	* unix/configure.in: 
	* unix/tclUnixPort.h: Applied patch for OS/390 to handle lack of
	sys/param.h. [Bug: 1725]

	* unix/configure.in: Fixed BSD/OS 4.* configuration to support
	shared libraries properly. [Bug: 1730]
	
1999-04-05    <redman@@scriptics.com>

	* win/tclWinDde.c: decrease timeout value for DDE calls to 30k
	[Bug: 1639]

	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclDecls.h:
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclUtil.c: Added more functions to the Tcl stubs table,
	including all Tcl_ functions not already in it (except Cmd
	functions) and Tcl_GetCwd() and Tcl_Chdir() (new functions).
	
	* tests/safe.test:
	* doc/safe.n:
	* generic/tclBasic.c:
	* library/safe.tcl: The encoding command is not safe as-is, so
	create a safe alias to mask out the "encoding system <name>" but
	allow all other uses including "encoding system". Added test cases
	and updated the man page for Safe Tcl.

1999-04-05    <stanton@@scriptics.com>

	* tests/winTime.test: 
	* win/tclWinTime.c: Fixed crash in clock command that occurred
	when manipulating negative time values in timezones east of
	GMT. [Bug: 1142, 1458]
	
	* tests/platform.test: 
	* tests/fileName.test: Fixed broken tests.
	
	* generic/tclFileName.c: Moved global regexps into thread local
	storage.

	* tests/socket.test: Changed so tests don't reuse sockets,
	since Windows is slow to release sockets.

	* win/tclWinConsole.c: 
	* win/tclWinPipe.c: 
	* win/tclWinSerial.c: Fixed race condition where background
	threads were terminated while they still held a lock in the
	notifier. 

1999-04-02    <stanton@@scriptics.com>

	* tests/http.test: Fixed bad test initialization code.

	* generic/tclThreadTest.c (ThreadExitProc): Fixed bug where static
	memory was being returned instead of a dynamically allocated
	result in error cases.

1999-04-02    <redman@@scriptics.com>

	* doc/dde.n:
	* tools/tcl.wse.in:
	* win/makefile.vc:
	* win/pkgIndex.tcl:
	* win/tclWinDde.c:  Add new DDE package, code removed from Tk now
	separated into its own package.  Changed DDE-based send code into
	"dde eval" command.  Can be loaded into tclsh (not just wish).
	Windows only.

1999-04-02    <stanton@@scriptics.com>

	* tests/expr.test: 
	* tests/for-old.test: 
	* tests/for.test: 
	* tests/foreach.test: 
	* tests/format.test: 
	* tests/httpold.test: 
	* tests/if.test: 
	* tests/init.test: 
	* tests/interp.test: 
	* tests/while.test:  Added some tests for known bugs (marked with
	knownBug constraint), and cleaned up a few bad tests.

	* generic/regc_locale.c: 
	* generic/regcustom.h: 
	* generic/tcl.decls: 
	* generic/tclCmdIL.c: 
	* generic/tclCmdMZ.c: 
	* generic/tclInt.h: 
	* generic/tclRegexp.c: 
	* generic/tclScan.c: 
	* generic/tclTest.c:
	* generic/tclUtf.c: 
	* win/tclWinFCmd.c: 
	* win/tclWinFile.c: Made various Unicode utility functions
	public. The following functions were made public and added to the
	stubs table: 
		Tcl_UtfToUniCharDString, Tcl_UniCharToUtfDString,
		Tcl_UniCharLen, Tcl_UniCharNcmp, Tcl_UniCharIsAlnum,
		Tcl_UniCharIsAlpha, Tcl_UniCharIsDigit, Tcl_UniCharIsLower,
		Tcl_UniCharIsSpace, Tcl_UniCharIsUpper, Tcl_UniCharIsWordChar

1999-04-01    <stanton@@scriptics.com>

	* tests/registry.test: 
	* win/tclWinReg.c: Internationalized the registry code.  It now
	uses Unicode interfaces on NT. [Bug: 1197]

	* tests/parse.test: 
	* generic/tclParse.c: Fixed crash due to multiple frees in parser
	during error cleanup when parsing commands with more tokens than
	will fit in the static area of the parse structure. [Bug: 1681]

	* generic/tclInt.h: Removed duplicate declarations.

	* generic/tclInt.decls: 
	* generic/tcl.decls: Added Tcl_WinUtfToTChar and Tcl_WinTCharToUtf
	to the tclPlat table.

1999-04-01    <redman@@scriptics.com>

	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclBasic.c:
	* generic/tclDecls.h:
	* generic/StubInit.c:
	* tools/genStubs.tcl:
	* unix/Makefile.in:
	* win/makefile.vc: Applied patch from Jan Nijtmans to fix Ultrix
	multiple symbol definition problem.  Now, even Tcl includes a copy
	of the Tcl stub library.  Also fixed TCL_MEM_DEBUG mode (for Tk).

1999-03-31    <redman@@scriptics.com>

	* win/tclWinConsole.c: WinNT has a bug when reading a single
	character from the console.  Rewrote the code for the console to
	read an entire line at a time using the reader thread.

1999-03-30    <stanton@@scriptics.com>

	* unix/Makefile.in: Removed trailing backslash that broke the
	"depend" target.

	* unix/tclUnixInit.c (TclpSetInitialEncodings): Changed to avoid
	calling setlocale().  We now look directly at env(LANG) and
	env(LC_CTYPE) instead. [Bug: 1636]

	* generic/tclFileName.c: 
	* generic/tclDecls.h: 
	* generic/tcl.decls: Removed CONST from Tcl_JoinPath and
	Tcl_TranslateFileName because it changes the signature of
	Tcl_JoinPath in an incompatible manner.

	* generic/tclInt.h: 
	* generic/tclLoad.c (TclFinalizeLoad): 
	* generic/tclEvent.c (Tcl_Finalize): Defer unloading of loadable
	modules until all exit handlers have been invoked.
	[Bug: 998, 1273, 1573, 1593]

1999-03-29    <stanton@@scriptics.com>

	* generic/tclFileName.c: 
	* generic/tclDecls.h: 
	* generic/tcl.decls: Added CONST to Tcl_JoinPath and
	Tcl_TranslateFileName.

1999-03-29    <redman@@scriptics.com>

	* tools/genStubs.tcl:
	* unix/configure.in:
	* unix/Makefile.in:
	* win/makefile.vc:
	* generic/tcl.h:
	* generic/tclBasic.c:
	* generic/tclDecls.h:
	* generic/tclIntDecls.h:
	* generic/tclPlatDecls.h:
	* generic/tclIntPlatDecls.h: Removed the stub functions and
	changed the stub macros to just use the name without params. Pass
	&tclStubs into the interp (don't use tclStubsPtr because of
	collisions with the stubs on Solaris).
	
1999-03-27    <redman@@scriptics.com>

	* win/makefile.bc: Removed makefile for Borland compiler, no
	longer supported.

1999-03-26    <redman@@scriptics.com>

	* win/tclWinSerial.c:
	* win/tclWinConsole.c:
	* win/tclWinPipe.c: Don't close the Win32 handle for a channel if
	it's a stdio handle (GetStdHandle()) during shutdown of a thread
	to prevent it from destroying the stdio of other threads.

1999-03-26    <suresh@@scriptics.com>

	* unix/configure.in
	--nameble-shared is now the default and build Tcl as a shared
	library; specify --disable-shared to build a static Tcl library
	and shell.

1999-03-25    <stanton@@scriptics.com>

	* tests/interp.test: 
	* generic/tclInterp.c (AliasObjCmd): Changed so aliases are
	invoked at current scope in the target interpreter instead of at
	the global scope.  This was an incompatibility introduced in 8.1
	that is being removed. [Bug: 1153, 1556]
	
	* library/encoding/big5.enc:
	* library/encoding/gb2312.enc:
	* tools/encoding/big5.enc:
	* tools/encoding/gb2312.enc: Added ASCII to big5 and gb2312
	encodings. [Bug: 632]
	
	* generic/tclPkg.c (Tcl_PkgRequireEx): Fixed broken clientData
	initialization in package code.

	* unix/Makefile.in (dist): Added tcl.decls and tclInt.decls to
	source distribution. [Bug: 1571]

	* doc/Thread.3: Updated documentation of Tcl_MutexLock to indicate
	that the recursive locking behavior is undefined.  On Windows, it
	does not block, on Unix it deadlocks. [Bug: 1275]

1999-03-24    <stanton@@scriptics.com>

	* tests/execute.test: 
	* generic/tclExecute.c (TclExecuteByteCode): Fixed expression code
	that incorrectly returned floating point values for integers if
	the internal rep happened to be a double.  Now we check to see if
	the object has a string rep that looks like an integer before
	using the double internal rep. [Bug: 1516]

1999-03-24    <redman@@scriptics.com>

	* generic/tclAlloc.c:
	* generic/tclEncoding.c:
	* generic/tclProc.c:
	* unix/tclUnixTime.c:
	* win/tclWinSerial.c: Fixed compilation warnings/errors for VC++
	5.0 and 6.0 and HP-UX native compiler without -Aa or -Ae. 
	[Bug: 1323 1518 1324 1583 1585 1586]

	* win/tclWinSock.c: Make sockets thread-safe on Windows. The
	current implementation uses windows to handle events on the
	socket, one for each thread (thread local storage). Previously,
	there was only one window shared between threads, which didn't
	work. [Bug: 1326]

1999-03-23    <stanton@@scriptics.com>

	* tools/tcl.wse: Fixed file association to look in the right place
	for the wish icon. [Bug: 1544]

	* tests/winNotify.test: 
	* tests/ioCmd.test: 
	* tests/event.test: Changed to use new style conditionals.

	* tests/encoding.test: Fixed nonportable test.

	* unix/dltest/configure.in: 
	* unix/dltest/Makefile.in: Added missing DBGX macros. [Bug: 1564]

	* tests/winNotify.test: 
	* mac/tclMacNotify.c: 
	* win/tclWinNotify.c: 
	* unix/tclUnixNotfy.c:
	* generic/tclNotify.c: Added a new Tcl_ServiceModeHook interface
	that is invoked whenever the service mode changes.  This is needed
	to allow the Windows notifier to create a communication window the
	first time Tcl is about to enter an external modal event loop
	instead of at startup time.  This will avoid the various problems
	that people have been seeing where the system hangs when tclsh
	is running outside of the event loop. [Bug: 783]

	* generic/tclInt.h: 
	* generic/tcl.decls: Renamed TclpAlertNotifier back to
	Tcl_AlertNotifier since it is part of the public notifier driver
	API.

1999-03-23    <redman@@scriptics.com>

	* win/tclWinSerial.c: Fixed problem with fileevent on the serial
	port and nonblocking mode.  Gets no longer hangs, fileevents fire
	whenever there is any character data on the port.
	
	* tests/winConsole.test:
	* win/tclWinConsole.c: Fixed problem with fileevents and gets from
	a console stdin.  Previously, fileevents were firing before an
	entire line was available for reading, which meant that when you
	did a gets or read, it blocked (even in nonblocking mode). Now, it
	should work the same as Unix: fileevents fire when an entire line
	is ready, and gets and read do not block in non-blocking mode.
	Added an interactive test case to check for this.

1999-03-22    <stanton@@scriptics.com>

	* tests/reg.test: 
	* generic/regc_color.c: Applied regexp bug fix from Henry Spencer.

1999-03-19    <redman@@scriptics.com>

	* generic/tclCmdIL.c: Fixed the initialization of an array so that
 	the Sun 5.0 C compiler wouldn't complain.

	* unix/configure.in: Added support for --enable-64bit.  For now,
 	this is only supported on Solaris 7 64bit (SunOS 5.7) using the Sun 
	compiler (not gcc).
	
1999-03-18    <stanton@@scriptics.com>

	* win/tclWinChan.c (TclpOpenFileChannel, Tcl_MakeFileChannel):
	Changed to only test for console or comm handles when the type is
	FILE_TYPE_CHAR to avoid useless tests on simple files.  Also
	reordered tests so consoles are tested first as this is more
	common.

	* win/makefile.vc: Regularized usage of mkd and rmd and rm.

	* library/encoding/shiftjis.enc: 
	* tools/encoding/shiftjis.txt: Missing/incorrect characters in
	shift-jis table. [Bug: 1008, 1526]

	* generic/tclInt.decls:
	* generic/tcl.decls: Eliminated use of "string" and "list" from
	argument lists to avoid conflicts with C++ STL. [Bug: 1181]

	* win/tclWinFile.c (TclpMatchFiles): Changed to ignore the
	FS_CASE_IS_PRESERVED bit and always return exactly what we get
	from the system.

1999-03-17    <stanton@@GASPODE>

	* win/README.binary: 
	* win/README: 
	* unix/configure.in: 
	* generic/tcl.h: 
	* README: Updated version to 8.1b3.

1999-03-14    <stanton@@GASPODE>

	* win/tclWinConsole.c: 
	* win/tclWinPipe.c: 
	* win/tclWinSerial.c: Changed so channel drivers wait for the
	reader/writer threads to exit before returning during a close
	operation.  This ensures that the main thread is the last thread
	to exit, so the process return value is set properly.

	* generic/tclIntDecls.h: 
	* generic/tclIntPlatDecls.h: 
	* generic/tclIntPlatStubs.c: 
	* generic/tclIntStubs.c: 
	* generic/tclPlatDecls.h: 
	* generic/tclPlatStubs.c: 
	* generic/tclStubInit.c: 
	* generic/tclStubs.c: Fixed bad eol characters.
	
	* generic/tclInt.decls: Changed "const" to "CONST" in
	declarations for better portability.

	* generic/tcl.decls: Renamed panic and panicVA to Tcl_Panic and
	Tcl_PanicVA in the stub files.

	* generic/tclInterp.c (Tcl_MakeSafe): Remove tcl_platform(user)
	from safe interps.

1999-03-11    <stanton@@GASPODE>

	* unix/Makefile.in:
	* unix/configure.in: Include compat files in the stub library in
	addition to the main library.  Compat files are now built for
	dynamic use in all cases.
	
	* generic/tcl.h: Changed magic number so it doesn't match the plus
	patch, at Jan's request.
	
	* unix/tclConfig.sh.in:
	* unix/dltest/Makefile.in:
	* unix/dltest/configure.in:
	* unix/dltest/pkga.c:
	* unix/dltest/pkgb.c:
	* unix/dltest/pkgc.c:
	* unix/dltest/pkgd.c:
	* unix/dltest/pkge.c:
	* unix/dltest/pkgf.c: Changed package tests to build against the
	stubs library.

1999-03-10    <stanton@@GASPODE>

	* generic/tcl.h: 
	* generic/tcl.decls: Changed Tcl_ReleaseType from an enum to
	macros so it can be used in .rc files.
	Added Tcl_GetString.

	* mac/tclMacNotify.c:
	* generic/tclNotify.c:
	* generic/tclInt.h: 
	* win/tclWinNotify.c: 
	* generic/tcl.h: Renamed Tcl_AlertNotifier to TclpAlertNotifier.

	* generic/tclInt.decls: Added TclWinAddProcess to make it possible
	for expect to use Tcl_WaitForPid().  This patch is from Gordon
	Chaffee. 

	* mac/tclMacPort.h: 
	* win/tclWinInit.c: 
	* unix/tclUnixPort.h: 
	* generic/tclAsync.c: Added TclpAsyncMark to fix bug in async
	handling on Windows where async events don't wake up the event
	loop.  This patch comes from Gordon Chaffee.

	* generic/tcl.decls: Fixed declarations of reserved slots.
	
1999-03-10    <redman@@scriptic.com>

	* generic/tclCompile.h: Ensure that the ByteCode struct is binary
	compatible with the version in 8.0.6.

	* generic/tcl.h:
	* generic/tclBasic.c: Add Tcl_GetVersion() function to the public
	C API to allow programs to check the version number of the Tcl
	library at runtime.  Also added an enum to clarify the release
	level (alpha, beta, final).

1999-03-09    <stanton@@GASPODE>

	* Integrated changes from Tcl 8.0 including:
		stubs mechanism
		configure patches from Jan Nijtmans
		rename of panic to Tcl_Panic
	
1999-03-08    <lfb@@scriptics.com>

	* win/tclWin32Dll.c: Removed Dll instance from thread-local
	storage.

1999-03-08    <stanton@@GASPODE>
	
	* generic/tcl.h: Moved Tcl_Mutex, etc. macros above the inclusion
	of tclDecls.h to avoid macro conflicts.

	* generic/tclInt.h:
	* generic/regc_color.c: 
	* generic/regcomp.c:
	* generic/tclCmdIL.c:
	* generic/tclCmdAH.c:
	* generic/tclIOCmd.c:
	* generic/tclParse.c:
	* generic/tclStringObj.c:
	* unix/tclUnixNotfy.c: Cleaned up various compiler warnings,
	eliminated UCHAR bugs.
	
	* unix/tclUnixNotfy.c:
	* unix/tclUnixThrd.c:
	* generic/tclThreadTest.c:
	* mac/tclMacThrd.c: Changed TclpCondition*() to Tcl_Condition*().
	
	* INTEGRATED PATCHES FROM 8.0.6:

	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclBasic.c: 
	* generic/tclDecls.h:
	* generic/tclInt.decls:
	* generic/tclInt.h: 
	* generic/tclIntDecls.h:
	* generic/tclIntPlatDecls.h:
	* generic/tclIntPlatStubs.c:
	* generic/tclIntStubs.c:
	* generic/tclPlatDecls.h:
	* generic/tclPlatStubs.c:
	* generic/tclStubInit.c:
	* generic/tclStubLib.c:
	* generic/tclStubs.c:
	* tools/genStubs.tcl:
	* unix/configure.in:
	* unix/Makefile.in:
	* unix/tclConfig.sh.in:
	* win/makefile.vc:  
	* win/tclWinPort.h: Added Tcl stubs implementation.  There are
	now two new macros USE_TCL_STUBS and USE_TCL_STUB_PROCS that
	enable use of stubs and disable stub macros respectively.  All of
	the public and private function declarations from tcl.h and
	tclInt.h have moved into the *.decls files and the *Stubs.c and
	*Decls.h files are generated using the genStubs.tcl script.

	* unix/Makefile.in:
	* unix/configure.in: 
	* unix/ldAix: Enhanced AIX shared library support.

	* win/tclWinSock.c: Removed a bunch of extraneous PASCAL FAR
	attributes from internal functions.

	* win/tclWinReg.c: Changed registry package to use stubs mechanism
	so it no longer depends on the specific version of Tcl.

	* doc/AddErrInfo.3: 
	* doc/Eval.3: 
	* doc/PkgRequire.3: 
	* doc/SetResult.3: 
	* doc/StringObj.3: 
	* generic/tcl.h:
	* generic/tclBasic.c: 
	* generic/tclPanic.c:
	* generic/tclStringObj.c:
	* generic/tclUtil.c:
	* unix/mkLinks: Added va_list versions of all VARARGS
	functions so they can be invoked from the stub functions.

	* doc/package.n: 
	* doc/PkgRequire.3: 
	* generic/tclPkg.c: Added Tcl_PkgProvideEx, Tcl_RequireEx,
	Tcl_PresentEx, and Tcl_PkgPresent.  Added "package present"
	command.

	* generic/tclFileName.c: 
	* mac/tclMacFile.c: 
	* mac/tclMacShLib.exp: 
	* unix/tclUnixFile.c: 
	* win/tclWinFile.c: Changed so TclGetUserHome is defined on
	all platforms, even though it is currently a noop on mac and
	windows, and renamed it to TclpGetUserHome.

	* generic/tclPanic.c:
	* generic/panic.c: Renamed panic to Tcl_Panic.
	
1999-02-25    <redman@@scriptics.com>

	* win/makefile.vc: Added tclWinConsole.c and tclWinSerial.c
	
	* win/tclWinConsole.c: New code to properly deal with fileevents
	and nonblocking mode on consoles.
	
	* win/tclWinSerial.c: New code to properly deal with fileevents
	and nonblocking mode on serial ports.

	* win/tclWinPipe.c: 
	* win/tclWinPort.h: Exported functions to allow creation of pipe
	channels from tclWinChan.c

	* win/tclWinChan.c: Check the type of a channel, including for the
	standard (stdin/stdout/stderr), and use the correct channel type
	to create the channel (file, serial, console, or pipe).

1999-02-11    <stanton@@GASPODE>

	* README: 
	* generic/tcl.h: 
	* win/README.binary: 
	* win/README: 
	* unix/configure.in: 
	* mac/README: Updated version numbers to 8.1b2.

1999-02-10    <stanton@@GASPODE>

	* library/auto.tcl: Fixed auto_mkindex so it handles .tbc files.
	Did some general cleanup to handle bad eval statements that didn't
	use "list".

	* unix/mkLinks:
	* doc/SetVar.3:
	* generic/tcl.h:
	* generic/tclVar.c: Restored Tcl_ObjGetVar2 and Tcl_ObjSetVar2
	from 8.0. Renamed Tcl_Get/SetObjVar2 to Tcl_GetVar2Ex and
	Tcl_SetVar2Ex.
d33 1
a33 1
1999-02-10    <stanton@@GASPODE>
d35 1
a35 1
	INTEGRATED PATCHES FROM 8.0.5b2: 
d37 1
a37 129
	* test/winPipe.test: Changed to remove echoArgs.tcl temporary file
	when done.
	
	* tests/cmdAH.test:
	* generic/tclFileName.c (TclGetExtension): Changed behavior so the
	split happens at the last period in the name instead of the first
	period of the last run of periods.  So, "foo..o" is split into
	"foo." and ".o" now. [Bug: 1126]
	
	* win/makefile.vc: Added better support for paths with spaces in
	the name. Added .lib and support .dlls to the install-binaries
	target.  Added generate of a pkgIndex.tcl script to the
	install-libraries target.

	* win/tclAppInit.c: 
	* unix/tclAppInit.c: 
	* mac/tclMacAppInit.c: 
	* generic/tclTest.c: Changed some EXTERN declarations to extern
	since they are not defining exported interfaces.  This avoids
	generating useless declspec() attributes and makes the windows
	makefile simpler.

	* generic/tcl.h: Moved Tcl_AppInit declaration to end and cleared
	out TCL_STORAGE_CLASS so it is not declared with a declspec().

	* tests/interp.test:
	* generic/tclInterp.c (DeleteAlias): Changed to use
	Tcl_DeleteCommandFromToken so we handle renames properly. This
	avoids senseless panic. [Bug: 736]

	* unix/tclUnixChan.c: 
	* win/tclWinSock.c: 
	* doc/socket.n: Applied Gordon Chaffee's patch to handle failures
	during asynchronous socket connection operations.  This adds a new
	"-error" fconfgure option to socket channels. [Bug: 893]

	* generic/tclProc.c:
	* generic/tclNamesp.c:
	* generic/tclInt.h: 
	* generic/tclCmdIL.c: 
	* generic/tclBasic.c: 
	* generic/tclVar.c: Applied patch from Viktor Dukhovni to
	rationalize TCL_LEAVE_ERR_MSG behavior when creating variables.
	
	* generic/tclVar.c: Fixed bug in namespace tail computation.
	Fixed bug where upvar could resurrect a namespace variable whose
	namespace had been deleted.

	* generic/tclCompile.c (TclCompileExprCmd): Eliminated yet another
	bogus optimization in expression compilation.

	* unix/configure.in: Added branch for BSD/OS-4* to shared library
	case statement. [Bug: 975]
	Fixed to correctly handle IRIX 6.5 n32 library support. [Bug: 1117]
	
	* win/winDumpExts.c: Patched to be pickier about stripping
	@@'s. [Bug: 920]

	* library/http2.0/http.tcl: Added catch around eof test in
	CopyDone since the user may have already called http::reset.
	[Bug: 1108] 

	* unix/configure.in: Changed Linux and IRIX to set SHLIB_LIBS to
	LIBS so shared libraries are linked with the system
	libraries. [Bug: 1018]

	* generic/tclCompile.c (CompileExprWord): Fixed exception stack
	overflow bug caused by missing statement. [Bug: 928]

	* generic/tclIOCmd.c: 
	* generic/tclBasic.c: Objectified the "open" command. [Bug: 1113] 

	* generic/tclPosixStr.c (Tcl_ErrnoId, Tcl_ErrnoMsg): When using
	egcs, ENOTSUP and EOPNOTSUPP are the same, so now we handle that
	case. [Bug: 1137]

	* library/init.tcl: Various small changes requested by Jan Nijtmans.
	- If the variable $tcl_library contains the empty string, this
	empty string will be put in $auto_path. This is not useful at all,
	it only slows down later package processing.
	- If the variable tcl_pkgPath is not set, the "unset __dir"
	fails. Thich makes init.tcl totally unusable. Better put a "catch"
	around it. 
	- In the function tcl_findLibraries, the "string match" function
	only works correctly if $tcl_patchLevel is in one of the forms
	"?.?a?", "?.?b?" or "?.?.?". Could a "regexp" be used instead,
	then it allows anything to be appended to the patchLevel
	string. And it is more efficient.
	- The tclPkgSetup function assumes that if $type != "load" then
	the type must be "source". This needn't be true. Some users want
	to add their own setup types.
	[RFE: 1138] [Bug: 978]

	* win/tclWinReg.c: 
	* doc/registry.n: Added support for HKEY_PERFORMANCE_DATA and
	HKEY_DYN_DATA keys. [Bug: 1109]

	* win/tclWinInit.c (TclPlatformInit): Added code to ensure
	tcl_pkgPath is set to "" when no registry entry is found. [Bug: 978]

1999-02-01    <stanton@@GASPODE>

	* generic/tclBasic.c:
	* generic/tclCmdAH.c:
	* generic/tclCmdIL.c:
	* generic/tclCmdMZ.c:
	* generic/tclExecute.c:
	* generic/tclHistory.c:
	* generic/tclIO.c:
	* generic/tclIOUtil.c:
	* generic/tclInterp.c:
	* generic/tclMain.c:
	* generic/tclNamesp.c:
	* generic/tclParse.c:
	* generic/tclProc.c:
	* generic/tclTest.c:
	* generic/tclTimer.c:
	* generic/tcl.h: Made eval interfaces compatible with 8.0 by
	renaming Tcl_EvalObj to Tcl_EvalObjEx, renaming Tcl_Eval2 to
	Tcl_EvalEx and restoring Tcl_EvalObj and Tcl_GlobalEvalObj
	interfaces so they match Tcl 8.0.

1999-01-28    <stanton@@GASPODE>

	* Merged Tcl 8.0.5b1 changes.
	
	* generic/tclUtil.c (Tcl_DStringSetLength): Changed so the buffer
	overallocates in a manner similar to Tcl_DStringAppend.  This
	should improve performance for TclUniCharToUtfDString.
d39 7
a45 8
1998-12-11    === Tcl 8.1b1 Release ===
	
1998-12-10    <stanton@@GASPODE>

2000-03-21  Syd Polk  <spolk@@cygnus.com>

	* configure.in: Check for cygwin, not cygwin32.
	* configure: Regenerate.
d47 1
a47 2
	* generic/tclInitScript.h: Added newline at end of file to make
	current gcc happy.
d49 1
a49 1
1999-12-06  Mo DeJong <mdejong@@cygnus.com>
d51 1
a51 1
	* win/Makefile.in: added cl flags needed for VC++ 6.0
d53 3
a55 1
1999-06-21  Syd Polk  <spolk@@cygnus.com>
d57 1
a57 2
	* generic/tclIO.c: Bug fixes from Scriptics to get exit status
	correct on pipe channels.
d59 4
a62 11
1999-04-22  Syd Polk  <spolk@@cygnus.com>

	* unix/Makefile.in: Don't install tcl.h for install-libaries.

1999-02-16  Syd Polk  <spolk@@cygnus.com>
    
	* win/configure.in: TCL_SRC_DIR needs to have forward slashes
	for the MS build.
	* win/configure: Regenerate.
	* win/tclWinInit.c: Stupid Visual C++ compiler has limit on
	number of characters in string constant.
d66 2
a67 3
	* generic/tclInitScript.h: The tclInit proc that Jim Ingham wrote
	blew MS's string buffer away, so I hacked the original in for the
	Microsoft build, which only SN is using anyway. Yuck.
d69 1
a69 1
1999-02-08  Syd Polk  <spolk@@cygnus.com>
d71 2
a72 1
	* unix/configure.in: Fixed problem with test in --enable-symbols.
a73 2
	* library/auto.tcl: Fixed a problem with the regsub inside of
	auto_mkindex since the regsub semantics changed.
d75 1
a75 1
1999-02-04  James Ingham  <jingham@@cygnus.com>	
d77 2
a78 6
	* generic/tclInitScript.h: Change the tclInit proc to find the Tcl 
	library in both build & install trees.
	* library/auto.tcl (tcl_findLibrary): Change tcl_findLibrary to
	search around the executible for the tclConfig.sh, and then use
	this to find the source tree.  This works in many more cases than
	the Scriptics version.
d80 1
a80 2
	* configure.in: If no value is given for --enable-symbols, use the 
	value from AC_PROG_CC, this adds -g for gcc.
d82 6
a87 1
1999-01-19  Ben Elliston  <bje@@cygnus.com>
d89 1
a89 2
	* tools/encoding/shiftjis.txt: Map tilde in ShiftJIS to tilde in
	Unicode.
d91 1
a91 1
	* library/encoding/shiftjis.enc: Regenerate.
d93 1
a93 1
1998-12-21  Syd Polk  <spolk@@cygnus.com>
d95 2
a96 2
	* generic/tclCompExpr.c: Remove another instance of string
	blasting.
d98 1
a98 3
	* generic/tclLiteral.c (TclDeleteLiteralTable): Make code 
	that detects infinite loops exit gracefully in production
	build and panic in development build.
d100 3
a102 1
1998-12-21  Khamis Abuelkomboz  <khamis@@cygnus.com>
d104 1
a104 2
	* generic/tclLiteral.c (TclDeleteLiteralTable): added a daemon to catch
	a hanging bug by deleteing a literal.
d106 3
a108 1
1998-12-19  Syd Polk  <spolk@@cygnus.com>
d110 1
a110 3
        * generic/tclCompile.c (tclCompileScript): Localize modifying 
	the compiled string to the call which needs it. This prevents 
	the string getting hashed incorrectly later.
d112 3
a114 1
	* generic/tclAlloc.c: Latest patch from Scriptics.
d116 1
a116 1
1998-12-16  Syd Polk  <spolk@@cygnus.com>
d118 1
a118 3
	* tools/encoding/shiftjis.txt: Unicode character 0xFF5E
	was missing from the shiftjis table.
	* library/encoding/shiftjis.enc: Regnerated.
d120 1
a120 1
1998-12-16  Ben Elliston  <bje@@sanguine.cygnus.com>
d122 2
a123 2
	* generic/tclBasic.c (builtInCmds): Add `encoding'. Patch from
	Scriptics.
d125 3
a127 17
	* generic/tclCmdAH.c (Tcl_EncodingObjCmd): New function. Patch
	from Scriptics.

	* generic/tclEncoding.c: Changed at the same time as the rest of
	these files, so it might be important. Patch from Scriptics.

	* doc/encoding.n: New file. From Scriptics.

1998-12-03  Syd Polk  <spolk@@cygnus.com>

	* generic/tclIO.c: Integrated more complete fix to
	channel problem from Scott Stanton at Scriptics.

1998-12-02  Syd Polk  <spolk@@cygnus.com>

	* generic/tclIO.c: Fixed problem when writing out to a
	channel set to -crlf translations.
d129 4
a132 1
1998-12-02  Ian Roxborough  <irox@@cygnus.com>
d134 1
a134 23
	* win/tclWinChan.c: Merged in WishCon0.1 Changes to
	support pipe IO at console level of a WishShell.

1998-11-24  Syd Polk  <spolk@@cygnus.com>

	* win/Makefile.in: Under MSVC, use the Tcl dumpexts method
	to generate exports.
	* win/tclWinPort.h tclWinSock.c: Do not #define PASCAL away. 
	It is needed in calls to DLLs.

1998-11-18  Syd Polk  <spolk@@cygnus.com>

	* generic/tclAlloc.c: Made sure that blocks are allocated on
	eight-byte boundaries.
	* unix/tclUnixPort.h: Added a CYGNUS LOCAL comment.

1998-11-09  Ben Elliston  <bje@@cygnus.com>

	* generic/tclVar.c (TclGetIndexedScalar): Fix a general problem
	with compiled local variables that are upvar'ed. Contributed by
	Scott Stanton <stanton@@scriptics.com>.

1998-11-04  Ian Roxborough  <irox@@cygnus.com>
d136 3
a138 1
	* win/tclWinPort.h: #endif in the wrong place and missing ')'.
d140 1
a140 1
1998-11-06  Syd Polk  <spolk@@cygnus.com>
d142 1
a142 2
	* win/tclWinPort.h: Updated from Scriptics. Tcl_Realloc no longer
	fails with blocks that are more than 64K.
d144 1
a144 1
1998-11-04  Ian Roxborough  <irox@@cygnus.com>
d146 14
a159 3
	* generic/panic.c (panic): Removed a #define _DEBUG,
	under MSVC if you want an exception Breakpoint instead
	of a panic dialog, CFLAGS must contain -D_DEBUG.
d161 1
a161 1
1998-11-03  Ian Roxborough  <irox@@cygnus.com>
d163 2
a164 2
	* generic/panic.c (panic): If compiling with Microsoft, have this
	generate an exception Breakpoint.
d166 1
a166 1
1998-11-03  Syd Polk  <spolk@@cygnus.com>
d168 2
a169 3
	* generic/panic.c: If compiling with Microsoft, have this generate
	a core dump so that we can actually see where it is happening when
	we have co stdout/stderr.
d171 1
a171 1
1998-10-29  Syd Polk  <spolk@@cygnus.com>
d173 4
a176 110
	* win/configure.in: Removed check for caddr_t. This configure.in
	is not really ready for autoheader and the other garbage.
	* win/configure: Regenerated.
	* generic/tclAlloc.c: Put declaration of caddr_t inside of 
	#ifdef _MSC_VER. It appears that this is the only compiler that
	is missing this typedef.

1998-10-29  Syd Polk  <spolk@@cygnus.com>

	* win/Makefile.in: The directory for encodings is called 'encoding',
	not 'encodings'.

1998-10-29  Syd Polk  <spolk@@cygnus.com>

	* unix/configure.in: Fix merge problem with socket libraries. Run
	autoconf test for caddr_t.
	* unix/configure: Regenerate.
	* win/configure.in Run autoconf test for caddr_t.
	* win/configure: Regnerate.
	* generic/tclAlloc.c: Remove declaration of caddr_t. Should be
	provided by configure now.

1998-10-28  Syd Polk  <spolk@@cygnus.com>

	* unix/Makefile.in: Install encodings from make install.
	* win/Makefile.in: Install encodings from make install.

1998-10-28  Ben Elliston  <bje@@cygnus.com>

	* win/configure.in (TCL_BUILD_INCLUDES): Remove. Do not subst.
	* win/configure: Regenerate.

1998-10-26  Syd Polk  <spolk@@cygnus.com>

	* win/Makefile.in: Fix references to old opt0.1 library.

1998-10-20  Syd Polk  <spolk@@cygnus.com>

	* unix/Makefile.in: Fix references to old opt0.1 library.

1998-10-19  Ben Elliston  <bje@@cygnus.com>

	* unix/configure.in: Compute a value for @@TCL_BUILD_INCLUDES@@.

	* unix/configure: Regenerate.

	* unix/tclConfig.sh.in (TCL_BUILD_INCLUDES): Set.
	
	* win/configure.in: Compute a value for @@TCL_BUILD_INCLUDES@@.

	* win/configure: Regenerate.

1998-10-14  Syd Polk  <spolk@@cygnus.com>

	* win/configure.in Makefile.in: More fixes for the tcl8.l build
	* win/configure: Regenerated

1998-10-14  Syd Polk  <spolk@@cygnus.com>

	* generic/tclCmdIL.c (SortCompare}: Support as much of the old
	comparison semantics as possible. It is now possible to do
	lsort -command {foo bar} {1 3 45}.
	* tests/cmdIL.test (cmdIL-3.16}: Restore test.

1998-10-08  Syd Polk  <spolk@@cygnus.com>

	* generic/tclCmdIL.c (SortCompare): Make the comparison callback
	object based for performance.
	* tests/cmdIL.test (cmdIL-3.16): Test relied on incorrect behavior
	of old string based comparison callback, which was a bug. Corrected
	test.
	* unix/configure.in: Minor fixes for gcc
	* unix/configure: Regenerated
	* unix/dltest/configure.in: GCC needs -f writeable-strings
	* unix/dltest/Makefile.in: Fixed invalid TCL_CFLAGS reference
	* unix/dltest/configure: Regenerated.

1998-10-01  Ben Elliston  <bje@@cygnus.com>

	* generic/tclCmdIL.c (InfoEncodingsCmd): New function. Implement a
	Tcl ``info encodings'' command.
	(Tcl_InfoObjCmd): Detect ``encodings'' subcommand.

	* doc/info.n: Update documentation.
	
1998-09-29  Syd Polk  <spolk@@cygnus.com>

	* win/Makefile.in: Still some hard-coded references to 8.0.
	Fix problems with try and except
	* win/configure.in: Likewise
	* win/configure: Regenerated
	* win/tclWin32Dll.c: try and except not supported under gcc.

1998-09-28  Syd Polk  <spolk@@cygnus.com>
	
	* generic/tclClock.c: timezone needs to be declared somewhere
	* win/Makefile.in: Fixed OBJEXT problems
	* win/tclWinFile.c win/tclWinInit.c: Fixed merge problems
	* win/tclWinPipe.c: Removed Cygnus thread stuff to use the tcl 8.1
	thread stuff instead.

1998-09-28  Syd Polk  <spolk@@cygnus.com>

        * win/configure.in: Merged from 4.2 branch
        * win/configure: Regenerated
	* win/Makefile.in: Updated for tcl8.1.

Wed Aut 19 17:48:00 PDT 1998  Syd Polk  <spolk@@cygnus.com>
	
	* 8.1 integration continues.
a870 1

@


1.1.1.6
log
@import tcl 8.4.0
@
text
@d1 1
a1 1
2002-09-10  Daniel Steffen  <das@@users.sourceforge.net>
d3 2090
a2092 5
	* unix/Makefile.in: added DYLIB_INSTALL_DIR variable for macosx
	and set it to default value ${LIB_RUNTIME_DIR}
	* unix/tcl.m4 (Darwin): use DYLIB_INSTALL_DIR instead of
	LIB_RUNTIME_DIR in the -install_name argument to ld.
	* unix/configure: regen.
d2094 9
a2102 7
	* macosx/Tcl.pbproj/project.pbxproj:
	* macosx/Makefile: added support for building Tcl as an embedded
	framework, i.e. using an dyld install_name containing
	@@executable_path/../Frameworks via the new DYLIB_INSTALL_DIR
	unix/Makefile variable.
	
2002-09-10  Jeff Hobbs  <jeffh@@ActiveState.com>
d2104 2
a2105 1
	*** 8.4.0 TAGGED FOR RELEASE ***
d2107 1
a2107 1
2002-09-06  Don Porter  <dgp@@users.sourceforge.net>
d2109 8
a2116 2
	* doc/file.n:  Format correction, and clarified [file normalize]
	returns an absolute path.
d2118 4
a2121 1
	* doc/tcltest.n:  Added examples section, as long promised.
d2123 4
a2126 1
2002-09-06  Reinhard Max  <max@@suse.de>
d2128 1
a2128 1
	* tests/tcltest.test: Added nonRoot flag to tests 8.3, 8.4, and 8.12.
d2130 1
a2130 1
2002-09-05  Don Porter  <dgp@@users.sourceforge.net>
d2132 2
a2133 1
	* doc/tcltest.n:  Clarified phrasing.
d2135 3
a2137 4
	* generic/tclBasic.c (TclRenameCommand,CallCommandTraces):
	* tests/trace.test (trace-27.1): Corrected memory leak when a rename
	trace deleted the command being traced.  Test added.  Thanks to
	Hemang Lavana for the fix.  [Bug 604609]
d2139 1
a2139 2
	* generic/tclVar.c (TclDeleteVars):  Corrected logic for setting the
	TCL_INTERP_DESTROYED flag when calling variable traces. [Tk Bug 605121]
d2141 3
a2143 1
2002-09-04  Miguel Sofer  <msofer@@users.sourceforge.net>
d2145 13
a2157 2
	* generic/tclVar.c (DeleteArray): leak plug [Bug 604239]. Thanks
	to dkf and dgp for the long and difficult discussion in the chat.
d2159 1
a2159 1
2002-09-03  Jeff Hobbs  <jeffh@@ActiveState.com>
d2161 2
a2162 1
	* generic/tclVar.c (Tcl_UpVar2): code cleanup to not use goto
d2164 2
a2165 2
	* unix/configure: remove -pthread from LIBS on FreeBSD in thread
	* unix/tcl.m4:    enabled build. [Bug #602849]
d2167 3
a2169 1
2002-09-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d2171 1
a2171 4
	* generic/tclInterp.c (AliasCreate): a Tcl_Obj was leaked on error
	return from TclPreventAliasLoop.
	
2002-09-03  Daniel Steffen  <das@@users.sourceforge.net>
d2173 2
a2174 2
	* macosx/Tcl.pbproj/project.pbxproj: Bumped version number to
	8.4.0 and updated copyright info.
d2176 3
a2178 1
2002-09-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d2180 1
a2180 2
	* generic/tclVar.c (Tcl_UpVar2): a Tcl_Obj was being leaked on
	error return from TclGetFrame.
d2182 1
a2182 1
2002-09-03  Don Porter  <dgp@@users.sourceforge.net>
d2184 4
a2187 1
	* changes:  Updated changes for 8.4.0 release.
d2189 45
a2233 1
2002-09-02  Jeff Hobbs  <jeffh@@ActiveState.com>
d2235 1
a2235 2
	* unix/tclUnixFile.c (TclpObjLink): removed unnecessary/unfreed
	extra native char*.
d2237 12
a2248 2
	* unix/tclUnixChan.c (Tcl_MakeTcpClientChannel): make sure to init
	flags field of TcpState ptr to 0.
d2250 1
a2250 3
	* unix/configure:
	* unix/tcl.m4: added 64-bit gcc compilation support on HP-11.
	[Patch #601051] (martin)
d2252 4
a2255 1
	* README:		Bumped version number to 8.4.0
d2257 65
a2321 7
	* tools/tcl.wse.in:
	* unix/configure:
	* unix/configure.in:
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure:
	* win/configure.in:
d2323 2
a2324 3
	* generic/tclInterp.c (SlaveCreate): make sure that the memory and
	checkmem commands are initialized in non-safe slave interpreters
	when TCL_MEM_DEBUG is used. [Bug #583445]
d2326 1
a2326 3
	* win/tclWinConsole.c (ConsoleCloseProc): only wait on writable
	pipe if there was something to write.  This may prevent infinite
	wait on exit.
d2328 17
a2344 2
	* tests/exec.test: marked exec-18.1 unixOnly until the Windows
	incompatability (in the test, not the core) can be resolved.
d2346 5
a2350 2
	* tests/http.test (http-3.11): added close $fp that was causing an
	error on Windows because the file was not closed before deleting.
d2352 31
a2382 2
	* unix/tclUnixInit.c (Tcl_MacOSXGetLibraryPath): made this static
	function only appear when HAVE_CFBUNDLE is defined.
d2384 1
a2384 1
2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>
d2386 5
a2390 2
	* unix/tcl.m4: added TK_SHLIB_LD_EXTRAS analogue of existing
	TCL_SHLIB_LD_EXTRAS for linker settings only used when linking Tk.
d2392 1
a2392 1
	* unix/configure: regen
d2394 11
a2404 1
2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>
d2406 1
a2406 1
	*** macosx-8-4-branch merged into the mainline [tcl patch #602770] ***
d2408 4
a2411 1
	* generic/tcl.decls: added new macosx specific entry to stubs table.
d2413 1
a2413 25
	* tools/genStubs.tcl: added generation of platform guards for
	macosx. This is a little more complex than it seems, because MacOS
	X IS "unix" plus a little bit, for the purposes of Tcl. BUT
	unfortunately, Tk uses "unix" to mean X11. So added platform keys
	for macosx (the little added to "unix"), "aqua" and "x11" to
	distinguish these for Tk.
	
	* generic/tcl.h: added a #ifnded RESOURCE_INCLUDED so that tcl.h
	can be passed to the resource compiler.
	
	* generic/tcl.h:
	* generic/tclNotify.c: added a few Notifier procs, to be able to
	modify more bits of the Tcl notifier dynamically. Required to get
	Mac OS X Tk to live on top of the Tcl Unix threaded notifier.
	Changes the size of the Tcl_NotifierProcs structure, but doesn't
	move any elements around.

	* unix/tclUnixNotfy.c: moved the call to Tcl_ConditionNotify till
	AFTER we are done mucking with the pointer swap. Fixes cases where
	the thread waiting on the condition wakes & accesses the
	waitingListPtr before it gets reset, causing a hang.

	* library/auto.tcl (tcl_findLibrary): added checking the
	directories in the tcl_pkgPath for library files on macosx to
	enable support of the standard Mac OSX library locations
d2415 2
a2416 21
	* unix/Makefile.in:
	* unix/configure.in:
	* unix/tcl.m4: added MAC_OSX_DIR.  Added PLAT_OBJS to the OBJS:
	there are some MacOS X specific files now for Tcl, and when I get
	he resource & applescript stuff ported over, and restore support
	for FindFiles, etc, there will be a few more.
	Added LD_LIBRARY_PATH_VAR configure variable to avoid having to set
	all possible LD_LIBRARY_PATH analogues on all platforms.
	LD_LIBRARY_PATH_VAR is "LD_LIBRARY_PATH" by default, "LIBPATH" on
	AIX, "SHLIB_PATH" on HPUX and "DYLD_LIBRARY_PATH" on Mac OSX.
	Added configure option to package Tcl as a framework on Mac OSX.

	* macosx/tclMacOSXBundle.c (new): support for finding Tcl extension
	packaged as 'bundles' in the standard Mac OSX library locations.

	* unix/tclUnixInit.c: added support for findig the tcl script
	library inside Tcl packaged as a framework on Mac OSX.

	* macosx/Tcl.pbproj/jingham.pbxuser (new):
	* macosx/Tcl.pbproj/project.pbxproj (new): project for Apple's
	ProjectBuilder IDE.
d2418 9
a2426 2
	* macosx/Makefile (new): simple makefile for building the project
	from the command line via the ProjectBuilder tool 'pbxbuild'.
d2428 1
a2428 3
	* unix/configure:
	* generic/tclStubInit.c:
	* generic/tclPlatDecls.h: regen
d2430 2
a2431 1
2002-08-29  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d2433 1
a2433 3
	* win/tclWinThrd.c (TclpFinalizeThreadData, TclWinFreeAllocCache):
	  Applied patch for bug #599428, provided by Miguel Sofer
	  <msofer@@users.sourceforge.net>.
d2435 1
a2435 1
2002-08-28  David Gravereaux <davygrvy@@pobox.com>
d2437 1
a2437 8
	* generic/tclEnv.c:
	* unix/configure.in:
	* win/tclWinPort.h:  putenv() on some systems copies the buffer
	rather than taking reference to it.  This causes memory leaks
	and is know to effect mswindows (msvcrt) and NetBSD 1.5.2 .  This
	patch tests for this behavior and turns on -DHAVE_PUTENV_THAT_COPIES=1
	when approriate.  Thanks to David Welton for assistance.
	[Bug 414910]
d2439 1
a2439 1
	* unix/configure: regen'd
d2441 4
a2444 1
2002-08-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d2446 2
a2447 1
	* doc/eval.n: Added mention of list command and corrected "SEE ALSO".
d2449 1
a2449 3
	* unix/configure.in: Cache handling of ac_cv_type_socklen_t was
	wrong. [Bug 600931] reported by John Ellson.  Fixed by putting the
	brackets where they belong.
d2451 1
a2451 1
2002-08-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d2453 7
a2459 3
	* generic/tclCompCmds.c: fix for [Bug 599788] (error in element
	name causing segfault), reported by Tom Wilkason. Fixed by copying
	the tokens instead of the source string.
d2461 5
a2465 1
2002-08-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d2467 3
a2469 2
	* generic/tclThreadAlloc.c: small optimisation, reducing the
	new allocator's overhead.
d2471 21
a2491 1
2002-08-23  Miguel Sofer  <msofer@@users.sourceforge.net>
d2493 2
a2494 2
	* generic/tclObj.c (USE_THREAD_ALLOC): fixed leak [Bug 597936]. 
	Thanks to Zoran Vasiljevic.
d2496 4
a2499 1
2002-08-23  Miguel Sofer  <msofer@@users.sourceforge.net>
d2501 1
a2501 2
	* generic/tclThreadAlloc.c (USE_THREAD_ALLOC): moving objects
	between caches as a block, instead of one-by-one.
d2503 2
a2504 1
2002-08-22  Miguel Sofer  <msofer@@users.sourceforge.net>
d2506 9
a2514 3
	* generic/tclBasic.c:
	* generic/tclCmdMZ.c: fix for freed memory r/w in delete traces
	[Bug 589863], patch by Hemang Lavana.
d2516 57
a2572 1
2002-08-20  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d2574 1
a2574 8
	* win/Makefile.in (CFLAGS): 
	* unix/Makefile.in (MEM_DEBUG_FLAGS): Added usage of @@MEM_DEBUG_FLAGS@@.
	* win/configure.in:
	* unix/configure.in: Added usage of SC_ENABLE_MEMDEBUG.
	* win/tcl.m4:
	* unix/tcl.m4: Added macro SC_ENABLE_MEMDEBUG. Allows a user of
	  configure to (de)activate memory validation and debugging
	  (TCL_MEM_DEBUG). No need to modify the makefile anymore.
d2576 2
a2577 1
2002-08-20  Don Porter  <dgp@@users.sourceforge.net>
d2579 1
a2579 1
	* generic/tclCkalloc.c:	CONSTified MemoryCmd and CheckmemCmd.
a2580 3
	* README:		Bumped version number to 8.4b3 to distinguish
	* generic/tcl.h:	HEAD from the 8.4b2 release.
	* tools/tcl.wse.in:
d2582 22
a2603 3
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure.in:
d2605 4
a2608 2
	* unix/configure:	autoconf
	* win/configure:
d2610 1
a2610 8
	* library/http/http.tcl:	Corrected installation directory of
	* library/msgcat/msgcat.tcl:	the package tcltest 2.2.  Added
	* library/opt/optparse.tcl:	comments in other packages to remind
	* library/tcltest/tcltest.tcl:	that installation directories need 
	* unix/Makefile.in:		updates to match increasing version
	* win/Makefile.in:		numbers. [Bug 597450]
	* win/makefile.bc:
	* win/makefile.vc:
d2612 2
a2613 1
2002-08-19  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d2615 1
a2615 2
	* unix/tclUnixTest.c (TestfilehandlerCmd): Changed
	  readable/writable to the more common readable|writable.
d2617 5
a2621 2
	  Fixes SF #596034 reported by Larry Virden
	  <lvirden@@users.sourceforge.net>.
d2623 2
a2624 12
2002-08-16  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/fCmd.test: Added test to make sure that the cause of the
	problem is detectable with an unpatched Tcl.
	* doc/ObjectType.3: Added note on the root cause of this problem
	to the documentation, since it is possible for user code to
	trigger this sort of behaviour too.
	* generic/tclIOUtil.c (SetFsPathFromAny): Objects should only have
	their old representation deleted when we know that we are about to
	install a new one.  This stops a weird TclX bug under Linux with
	certain kinds of memory debugging enabled which essentally came
	down to a double-free of a string.
d2626 2
a2627 1
2002-08-14  Miguel Sofer  <msofer@@users.sourceforge.net>
d2629 2
a2630 7
	* generic/tclInt.h:
	* generic/tclObj.c: (code cleanup) factored the parts in the macros 
	TclNewObj() / TclDecrRefCount() into a common part for all
	memory allocators and two new macros TclAllocObjStorage() /
	TclFreeObjStorage() that are specific to each allocator and fully
	describe the differences. Removed allocator-specific code from
	tclObj.c by using the macros.
d2632 1
a2632 1
2002-08-12  Miguel Sofer  <msofer@@users.sourceforge.net>
d2634 4
a2637 1
	* generic/tclCmdMZ.c: fixing UMR in delete traces, [Bug 589863].
d2639 1
a2639 1
2002-08-08  David Gravereaux <davygrvy@@pobox.com>
d2641 4
a2644 2
	* tools/man2help.tcl: Fixed $argv handling bug where if -bitmap
	wasn't specified $argc was off by one.
d2646 2
a2647 1
2002-08-08  Miguel Sofer  <msofer@@users.sourceforge.net>
d2649 5
a2653 2
	* tests/uplevel.test: added 6.1 to test [uplevel] with shadowed
	commands [Bug 524383]
d2655 1
a2655 1
	* tests/subst.test: added 5.8-10 as further tests for [Bug 495207] 
d2657 6
a2662 1
2002-08-08  Don Porter  <dgp@@users.sourceforge.net>
d2664 1
a2664 1
	* tests/README: Noted removal of defs.tcl.
d2666 2
a2667 1
2002-08-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d2669 1
a2669 1
	* doc/lsearch.n: corrected lsearch docs to use -inline in examples.
d2671 3
a2673 1
	*** 8.4b2 TAGGED FOR RELEASE ***
d2675 3
a2677 10
	* tests/fCmd.test:
	* tests/unixFCmd.test: updated tests for new link copy behavior.
	* generic/tclFCmd.c (CopyRenameOneFile): changed the behavior to
	follow links to endpoints and copy that file/directory instead of
	just copying the surface link.  This means that trying to copy a
	link that has no endpoint (danling link) is an error.
	[Patch #591647] (darley)
	(CopyRenameOneFile): this is currently disabled by default until
	further issues with such behavior (like relative links) can be
	handled correctly.
d2679 3
a2681 1
	* tests/README: slight wording improvements
d2683 7
a2689 1
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>
d2691 1
a2691 7
	* docs/BoolObj.3: added description of valid string reps for a
	boolean object [Bug 584794]
	* generic/tclObj.c: optimised Tcl_GetBooleanFromObj and
	SetBooleanFromAny to avoid parsing the string rep when it can be
	avoided [Bugs 584650, 472576]
	
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>
d2693 4
a2696 5
	* generic/tclCompile.h:
	* generic/tclObj.c: making tclCmdNameType static ([Bug 584567],
	Don Porter).
	
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>
d2698 1
a2698 5
	* generic/tclObj.c (Tcl_NewObj): added conditional code for
	USE_THREAD_ALLOC; objects allocated through Tcl_NewObj() were
	otherwise being leaked. [Bug 587488] reported by Sven Sass.
	
2002-08-06  Daniel Steffen  <das@@users.sourceforge.net>
d2700 4
a2703 9
	* generic/tclInt.decls:
	* unix/tclUnixThrd.c: Added stubs and implementations for
	non-threaded build for the tclUnixThrd.c procs TclpReaddir,
	TclpLocaltime, TclpGmtime and TclpInetNtoa.
	Fixes link errors in stubbed & threaded extensions that include
	tclUnixPort.h and use any of the procs readdir, localtime, 
	gmtime or inet_ntoa (e.g. TclX 8.4) [Bug 589526]
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c: Regen.
d2705 1
a2705 1
2002-08-05  Don Porter  <dgp@@users.sourceforge.net>
d2707 1
a2707 110
	* library/tcltest/tcltest.tcl:	The setup and cleanup scripts are now
	* library/tcltest/pkgIndex.tcl:	skipped when a test is skipped, fixing
	* tests/tcltest.test:		[Bug 589859].  Test for bug added, and
	corrected tcltest package bumped to version 2.2.

	* generic/tcl.decls:	Restored Tcl_Concat to return (char *).  Like
	* generic/tclDecls.h:	Tcl_Merge, it transfers ownership of a dynamic
	* generic/tclUtil.c:	allocated string to the caller.

2002-08-04  Don Porter  <dgp@@users.sourceforge.net>

	* doc/CmdCmplt.3:	Applied Patch 585105 to fully CONST-ify
	* doc/Concat.3:		all remaining public interfaces of Tcl.
	* doc/CrtCommand.3:	Notably, the parser no longer writes on 
	* doc/CrtSlave.3:	the string it is parsing, so it is no
	* doc/CrtTrace.3:	longer necessary for Tcl_Eval() to be
	* doc/Eval.3:		given a writable string.  Also, the
	* doc/ExprLong.3:	refactoring of the Tcl_*Var* routines
	* doc/LinkVar.3:	by Miguel Sofer is included, so that the
	* doc/ParseCmd.3:	"part1" argument for them no longer needs
	* doc/SetVar.3:		to be writable either.
	* doc/TraceVar.3:
	* doc/UpVar.3:		Compatibility support has been enhanced so
	* generic/tcl.decls	that a #define of USE_NON_CONST will remove
	* generic/tcl.h		all possible source incompatibilities with
	* generic/tclBasic.c	the 8.3 version of the header file(s).
	* generic/tclCmdMZ.c	The new #define of USE_COMPAT_CONST now does
	* generic/tclCompCmds.c	what USE_NON_CONST used to do -- disable
	* generic/tclCompExpr.c only those new CONST's that introduce
	* generic/tclCompile.c	irreconcilable incompatibilities.
	* generic/tclCompile.h
	* generic/tclDecls.h	Several bugs are also fixed by this patch.
	* generic/tclEnv.c	[Bugs 584051,580433] [Patches 585105,582429]
	* generic/tclEvent.c	
	* generic/tclInt.decls
	* generic/tclInt.h
	* generic/tclIntDecls.h
	* generic/tclInterp.c
	* generic/tclLink.c
	* generic/tclObj.c
	* generic/tclParse.c
	* generic/tclParseExpr.c
	* generic/tclProc.c
	* generic/tclTest.c
	* generic/tclUtf.c
	* generic/tclUtil.c
	* generic/tclVar.c
	* mac/tclMacTest.c
	* tests/expr-old.test
	* tests/parseExpr.test
	* unix/tclUnixTest.c
	* unix/tclXtTest.c
	* win/tclWinTest.c

2002-08-01  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: bugfix (reading freed memory). Testsuite
	passed on linux/i386, compile-13.1 hung on linux/alpha.

2002-08-01  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: added a reference count for the complete
	execution stack, instead of Tcl_Preserve/Tcl_Release. 

2002-08-01  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tclCkalloc.c (TclFinalizeMemorySubsystem):
	Don't lock the ckalloc mutex before invoking the
	Tcl_DumpActiveMemory function since it also
	locks the same mutex. This code is only executed
	when "memory onexit filename" has been executed
	and Tcl is compiled with -DTCL_MEM_DEBUG.

2002-08-01  Reinhard Max  <max@@suse.de>

	* win/tclWinPort.h: The windows headers don't provide socklen_t,
	so we have to do it.

2002-07-31  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInt.h (USE_THREAD_ALLOC): for unshared objects,
	TclDecrRefCount now frees the internal rep before the string rep -
	just like the non-macro Tcl_DecrRefCount/TclFreeObj [Bug 524802]. 
	For the other allocators the fix was done on 2002-03-06.

2002-07-31  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInterp.c: signed/unsigned comparison warning fixed
	(Vince Darley).

2002-07-31  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tcl.m4 (SC_BUGGY_STRTOD): Enabled caching of test results.

	* unix/tcl.m4 (SC_BUGGY_STRTOD): Solaris 2.8 still has a buggy
	strtod() implementation; make sure we detect it.

	* tests/expr.test (expr-22.*): Marked as non-portable because it
	seems that these tests have an annoying tendency to fail in
	unexpected ways.  [Bugs 584825, 584950, 585986]

2002-07-30  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tests/io.test: 
	* generic/tclIO.c (WriteChars): Added flag to break out of loop if
	  nothing of the input is consumed at all, to prevent infinite
	  looping of called with a non-UTF-8 string. Fixes Bug 584603
	  (partially). Added new test "io-60.1". Might need additional
	  changes to Tcl_Main so that unprintable results are printed as
	  binary data.
d2709 2
a2710 1
2002-07-29  Mo DeJong  <mdejong@@users.sourceforge.net>
d2712 4
a2715 8
	* unix/Makefile.in: Use CC_SEARCH_FLAGS instead of
	LD_SEARCH_FLAGS when linking with ${CC}.
	* unix/configure: Regen.
	* unix/configure.in: Don't subst CC_SEARCH_FLAGS or
	LD_SEARCH_FLAGS since this is now done in tcl.m4.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Document and
	set CC_SEARCH_FLAGS whenever LD_SEARCH_FLAGS is set.
	[Tcl patch 588290]
d2717 21
a2737 1
2002-07-29  Reinhard Max  <max@@suse.de>
d2739 11
a2749 2
	* unix/tcl.m4 (SC_SERIAL_PORT): Fixed detection for cases when
                                        configure's stdin is not a tty.
d2751 2
a2752 3
	* unix/tclUnixPort.h: 
	* generic/tclIOSock.c:          Changed size_t to socklen_t in
                                        socket-related function calls.
d2754 2
a2755 2
	* unix/configure.in:            Added test and fallback definition
                                        for socklen_t.
d2757 30
a2786 1
	* unix/configure:               generated.
d2788 2
a2789 1
2002-07-29  Miguel Sofer  <msofer@@users.sourceforge.net>
d2791 1
a2791 1
	* generic/tclObj.c: fixed a comment
d2793 16
a2808 19
	* generic/tcl.h: 
	* generic/tclBasic.c: 
	* generic/tclInterp.c: added the new flag TCL_EVAL_INVOKE to
	the interface of the Tcl_Eval* functions, removing the
	TCL_EVAL_NO_TRACEBACK added yesterday: alias invocations not only 
	require no tracebacks, but also look up the command name in the
	global scope - see new test interp-9.4
	* tests/interp.test: added 9.3 to test for safety of aliases to
	hidden commands, 9.4 to test for correct command lookup scope.

2002-07-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/regc_locale.c (cclass): [[:xdigit:]] is only a defined
	concept on western characters, so should not allow any unicode
	digit, and hence number of ranges in [[:xdigit:]] is fixed.
	* tests/reg.test: Added test to detect the bug.
	* generic/regc_cvec.c (newcvec): Corrected initial size value in
	character vector structure.  [Bug 578363]  Many thanks to
	pvgoran@@users.sf.net for tracking this down.
d2810 1
a2810 1
2002-07-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d2812 1
a2812 37
	* generic/tcl.h: 
	* generic/tclBasic.c: added the new flag TCL_EVAL_NO_TRACEBACK to
	the interface of the Tcl_Eval* functions. Modified the error
	message for too many nested evaluations.
	* generic/tclInterp.h: changed the Alias struct to be of variable
	length and store the prefix arguments directly (instead of a
	pointer to a Tcl_Obj list). Made AliasObjCmd call Tcl_EvalObjv
	instead of TclObjInvoke - thus making aliases trigger execution
	traces [Bug 582522].
	* tests/interp.test:
	* tests/stack.test: adapted to the new error message.
	* tests/trace.test: added tests for aliases firing the exec
	traces. 

2002-07-27  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Revert fix for Tcl bug 529801
	since it was incorrect and broke the build on
	other systems. Fix Tcl bug 587299.
	Add MAJOR_VERSION, MINOR_VERSION, PATCH_LEVEL,
	SHLIB_LD_FLAGS, SHLIB_LD_LIBS, CC_SEARCH_FLAGS,
	LD_SEARCH_FLAGS, and LIB_FILE variables to support
	more generic library build/install rules.
	* unix/configure: Regen.
	* unix/configure.in: Move AC_PROG_RANLIB into
	tcl.m4. Move shared build test and setting
	of MAKE_LIB and MAKE_STUB_LIB into tcl.m4.
	Move subst of a number of variables into
	tcl.m4 where they are defined.
	* unix/tcl.m4 (SC_ENABLE_SYMBOLS, SC_CONFIG_CFLAGS):
	Subst vars where they are defined. Add MAKE_LIB,
	MAKE_STUB_LIB, INSTALL_LIB, and INSTALL_STUB_LIB
	rules to deal with the ugly details of running
	ranlib on static libs at build and install time.
	Replace TCL_SHLIB_LD_EXTRAS with SHLIB_LD_FLAGS
	and use it when building a shared library.
	* unix/tclConfig.sh.in: Add TCL_CC_SEARCH_FLAGS.
d2814 1
a2814 1
2002-07-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d2816 2
a2817 4
	* generic/tclExecute.c: fixed Tcl_Obj leak in code corresponding
	to the macro NEXT_INST_V(x, 0, 1) [Bug 587495].
	
2002-07-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d2819 1
a2819 2
	* generic/tclVar.c (TclObjLookupVar): leak fix and improved
	comments. 
d2821 5
a2825 1
2002-07-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d2827 1
a2827 3
	* generic/tclVar.c (TclLookupVar): removed early returns that
	prevented the parens from being restored. also removed goto label
	as it was not necessary.
d2829 6
a2834 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d2836 3
a2838 3
	* generic/tclExecute.c: 
	* tests/expr-old.test: fix for erroneous error messages in [expr],
	[Bug  587140] reported by Martin Lemburg.
d2840 1
a2840 3
2002-07-25  Joe English  <jenglish@@users.sourceforge.net>
	* generic/tclProc.c: fix for Tk Bug #219218 "error handling 
	with bgerror in Tk"
d2842 5
a2846 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d2848 1
a2848 2
	* generic/tclExecute.c: restoring full TCL_COMPILE_DEBUG
	functionality.
d2850 2
a2851 1
2002-07-24  Don Porter  <dgp@@users.sourceforge.net>
d2853 3
a2855 2
	* tests/unixInit.test: relaxed unixInit-3.1 to accept iso8859-15
	as a valid C encoding.  [Bug 575336]
d2857 1
a2857 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d2859 2
a2860 4
	* generic/tclExecute.c: restoring the tcl_traceCompile
	functionality while I repair tcl_traceExec. The core now compiles
	and runs also under TCL_COMPILE_DEBUG, but execution in the
	bytecode engine can still not be traced.
d2862 1
a2862 1
2002-07-24  Daniel Steffen  <das@@users.sourceforge.net>
d2864 5
a2868 6
	* unix/Makefile.in:
	* unix/configure.in: corrected fix for [Bug 529801]: ranlib
	only needed for static builds on Mac OS X.
	* unix/configure: Regen.
	* unix/tclLoadDyld.c: fixed small bugs introduced by Vince,
	implemented library unloading correctly (needs OS X 10.2).
d2870 1
a2870 1
2002-07-23  Joe English  <jenglish@@users.sourceforge.net>
d2872 3
a2874 6
	* doc/OpenFileChnl.3: (Updates from Larry Virden)
	* doc/open.n:
	* doc/tclsh.1: Fix section numbers in Unix man page references.
	* doc/lset.n:  In EXAMPLES section, include command to set the 
	initial value used in subsequent examples.
	* doc/http.n: Package version updated to 2.4.
d2876 1
a2876 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d2878 24
a2901 4
	* unix/configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Enable 64 bit compilation
	when using the native compiler on a 64 bit version of IRIX.
	[Tcl bug 219220]
d2903 1
a2903 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d2905 3
a2907 2
	* unix/Makefile.in: Combine ranlib tests and
	avoid printing unless ranlib is actually run.
d2909 1
a2909 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d2911 9
a2919 3
	* unix/tcl.m4 (SC_PATH_X): Set XINCLUDES to "" instead
	of "# no special path needed" or "# no include files found"
	when x headers cannot be located.
d2921 1
a2921 1
2002-07-22  Vince Darley  <vincentdarley@@users.sourceforge.net>
d2923 15
a2937 14
	* generic/tclIOUtil.c: made tclNativeFilesystem static
	(since 07-19 changes removed its usage elsewhere), and
	added comments about its usage.
	* generic/tclLoad.c:
	* generic/tcl.h:
	* generic/tcl.decls: 
	* doc/FileSystem.3: converted last load-related ClientData
	parameter to Tcl_LoadHandle opaque structure, removing a 
	couple of casts in the process.
	
	* generic/tclInt.h: removed tclNativeFilesystem declaration
	since it is now static again.
	
2002-07-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d2939 1
a2939 6
	* tests/expr.test (expr-22.*): Added tests to help detect the
	corrected handling.
	* generic/tclExecute.c (IllegalExprOperandType): Improved error
	message generated when attempting to manipulate Inf and NaN values.
	* generic/tclParseExpr.c (GetLexeme): Allowed parser to recognise
	'Inf' as a floating-point number. [Bug 218000]
d2941 19
a2959 1
2002-07-21  Don Porter  <dgp@@users.sourceforge.net>
d2961 2
a2962 1
	* tclIOUtil.c: Silence compiler warning. [Bug 584408].
d2964 1
a2964 1
2002-07-19  Vince Darley  <vincentdarley@@users.sourceforge.net>
d2966 57
a3022 4
	* generic/tclIOUtil.c: fix to GetFilesystemRecord
	* win/tclWinFile.c:
	* unix/tclUnixFile.c: fix to subtle problem with links shown
	up by latest tclkit builds.
d3024 1
a3024 1
2002-07-19  Mo DeJong  <mdejong@@users.sourceforge.net>
a3025 1
	* unix/configure:
d3027 4
a3030 30
	* win/configure:
	* win/configure.in: Add AC_PREREQ(2.13) in an attempt
	to make it more clear that the configure scripts
	must be generated with autoconf version 2.13.
	[Bug 583573]

2002-07-19  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* unix/Makefile.in: fix to build on MacOS X [Bug 529801], bug
	report and fix from jcw.

2002-07-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* win/tclWinSerial.c (no_timeout): Made this variable static.

	* generic/tclExecute.c, generic/tclCompile.c, generic/tclBasic.c: 
	* generic/tclCompile.h (builtinFuncTable, instructionTable): Added
	prefix to these symbols because they are visible outside the Tcl
	library.

	* generic/tclCompExpr.c (operatorTable): 
	* unix/tclUnixTime.c (tmKey):
	* generic/tclIOUtil.c (theFilesystemEpoch, filesystemWantToModify,
	filesystemIteratorsInProgress, filesystemOkToModify): Made these
	variables static.

	* unix/tclUnixFile.c:		Renamed nativeFilesystem to
	* win/tclWinFile.c:		tclNativeFilesystem and declared
	* generic/tclIOUtil.c:		it properly in tclInt.h
	* generic/tclInt.h: 
d3032 1
a3032 1
	* generic/tclUtf.c (totalBytes): Made this array static and const.
d3034 2
a3035 3
	* generic/tclParse.c (typeTable): Made this array static and const.
	(Tcl_ParseBraces): Simplified error handling case so that scans
	are only performed when needed, and flags are simpler too.
d3037 1
a3037 2
	* license.terms: Added AS to list of copyright holders; it's only
	fair for the current gatekeepers to be listed here!
d3039 4
a3042 3
	* tests/cmdMZ.test: Renamed constraint for clarity. [Bug#583427]
	Added tests for the [time] command, which was previously only
	indirectly tested!
d3044 1
a3044 1
2002-07-18  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3046 10
a3055 4
	* generic/tclInt.h:
	* generic/tcl.h:
	* */*Load*.c: added comments on changes of 07/17 and 
	replaced clientData with Tcl_LoadHandle in all locations.
d3057 1
a3057 11
	* generic/tclFCmd.c:
	* tests/fileSystem.test: fixed a 'knownBug' with 'file
	attributes ""'
	* tests/winFCmd.test: 
	* tests/winPipe.test:
	* tests/fCmd.test:
	* tessts/winFile.test: added 'pcOnly' constraint to some
	tests to make for more useful 'tests skipped' log from 
	running all tests on non-Windows platforms.
	
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d3059 2
a3060 3
	* generic/tclBasic.c (CallCommandTraces): delete traces now
	receive the FQ old name of the command. 
	[Bug 582532] (Don Porter)
d3062 2
a3063 1
2002-07-18  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3065 3
a3067 2
	* tests/ioUtil.test: added constraints to 1.4,2.4 so they
	don't run outside of tcltest. [Bugs 583276,583277]
d3069 7
a3075 1
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d3077 3
a3079 2
	* generic/tclVar.c (DupParsedVarName): nasty bug fixed, reported
	by Vince Darley.
d3081 2
a3082 1
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d3084 1
a3084 5
	* generic/tclVar.c (TclPtrIncrVar): missing CONST in declarations,
	inconsistent with tclInt.h. Thanks to Vince Darley for reporting,
	boo to gcc for not complaining.
	
2002-07-17  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3086 22
d3109 53
a3161 20
	* generic/tclIOUtil.c:
	* generic/tclLoadNone.c:
	* unix/tclLoadAout.c:
	* unix/tclLoadDl.c:
	* unix/tclLoadDld.c:
	* unix/tclLoadDyld.c:
	* unix/tclLoadNext.c:
	* unix/tclLoadOSF.c:
	* unix/tclLoadShl.c:
	* mac/tclMacLoad.c:
	* win/tclWinLoad.c: modified to move more functionality
	to the generic code and avoid duplication.  Partial replacement
	of internal uses of clientData with opaque Tcl_LoadHandle.  A
	little further work still needed, but significant changes are done.

2002-07-17  D. Richard Hipp    <drh@@hwaci.com>

	* library/msgcat/msgcat.tcl: fix a comment that was causing
	problems for programs (ex: mktclapp) that embed the initialization
	scripts in strings.
d3163 1
a3163 25
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c: removing the now redundant functions to access
	indexed variables: Tcl(Get|Set|Incr)IndexedScalar() and
	Tcl(Get|Set|Incr)ElementOfIndexedArray(). 

2002-07-17  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclExecute.c (TclExecuteByteCode): Minor fixes to make
	this file compile with SunPro CC...

2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: modified to do variable lookup explicitly,
	and then either inlining the variable access or else calling the new
	TclPtr(Set|Get|Incr)Var functions in tclVar.c
	* generic/tclInt.h: declare some functions previously local to
	tclVar.c for usage by TEBC.
	* generic/tclVar.c: removed local declarations; moved all special
	accessor functions for indexed variables to the end of the file -
	they are unused and ready for removal, but left there for the time
	being as they are in the internal stubs table.
d3165 2
a3166 4
	** WARNING FOR BYTECODE MAINTAINERS **
	TCL_COMPILE_DEBUG is currently not functional; will be fixed ASAP.
	
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d3168 2
a3169 3
	* unix/Makefile.in:
	* win/Makefile.in: Add a more descriptive warning
	in the event `make genstubs` needs to be rerun.
d3171 3
a3173 1
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d3175 1
a3175 6
	* unix/Makefile.in: Use dltest.marker file
	to keep track of when the dltest package
	is up to date. This fixes [Tcl bug 575768]
	since tcltest is no longer linked every time.
	* unix/dltest/Makefile.in: Create ../dltest.marker
	after a successful `make all` run in dltest.
d3177 2
a3178 1
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d3180 3
a3182 2
	* unix/configure: Regen.
	* unix/configure.in: Remove useless subst of TCL_BIN_DIR.
d3184 1
a3184 1
2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d3186 2
a3187 3
	* generic/tclVar.c: inaccurate comment fixed
	
2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d3189 9
a3197 24
	* generic/tclBasic.c (Tcl_AddObjErrorInfo):
	* generic/tclExecute.c (TclUpdateReturnInfo):
	* generic/tclInt.h:	
	* generic/tclProc.c: 
	Added two Tcl_Obj to the ExecEnv structure to hold the fully
	qualified names "::errorInfo" and "::errorCode" to cache the
	addresses of the corresponding variables. The two most frequent
	setters of these variables now profit from the new variable name
	caching. 

2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclVar.c: refactorisation to reuse already looked-up Var
	pointers; definition of three new Tcl_Obj types to cache variable
	name parsing and lookup for later reuse; modification of internal
	functions to profit from the caching. 
	
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclNamesp.c: adding CONST qualifiers to variable names
	passed to Tcl_FindNamespaceVar and to variable resolvers; adding
	CONST qualifier to the 'msg' argument to TclLookupVar. Needed to
	avoid code duplication in the new tclVar.c code.
d3199 1
a3199 3
	* tests/set-old.test:
	* tests/var.test: slight modification of error messages due to the
	modifications in the tclVar.c code.
d3201 3
a3203 1
2002-07-15  Don Porter  <dgp@@users.sourceforge.net>
d3205 1
a3205 2
	* tests/unixInit.test:	Improved constraints to protect /tmp.	
	  [Bug 581403]
d3207 4
a3210 1
2002-07-15  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3212 1
a3212 8
	* tests/winFCmd.test: renamed 'win2000' and 'notWin2000' to
	more appropriate constraint names.
	* win/tclWinFile.c: updated comments to reflect 07-11 changes.
	* win/tclWinFCmd.c: made ConvertFileNameFormat static again,
	since no longer used in tclWinFile.c
	* mac/tclMacFile.c: completed TclpObjLink implementation which
	was previously lacking.
	* generic/tclIOUtil.c: comment cleanup and code speedup.
d3214 3
a3216 1
2002-07-14  Don Porter  <dgp@@users.sourceforge.net>
d3218 3
a3220 2
	* generic/tclInt.h:	Removed declarations that duplicated entries
	  in the (internal) stub table.
d3222 6
a3227 2
	* library/tcltest/tcltest.tcl:  Corrected errors in handling of
	  configuration options -constraints and -limitconstraints.
d3229 1
a3229 7
	* README:		Bumped HEAD to version 8.4b2 so we can
	* generic/tcl.h:	distinguish it from the 8.4b1 release.
	* tools/tcl.wse.in:
	* unix/configure*:
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure*:
d3231 3
a3233 1
2002-07-11  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3235 2
a3236 6
	* doc/file.n:
	* win/tclWinFile.c: on Win 95/98/ME the long form of the path
	is used as a normalized form.  This is required because short
	forms are not a robust representation.  The file normalization
	function has been sped up, but more performance gains might be
	possible, if speed is still an issue on these platforms.
d3238 1
a3238 1
2002-07-11  Don Porter  <dgp@@users.sourceforge.net>
d3240 4
a3243 2
	* library/tcltest/tcltest.tcl: Corrected reaction to existing but
	false ::tcl_interactive.
d3245 1
a3245 1
	* doc/Hash.3: Overlooked CONST documentation update.
d3247 3
a3249 1
2002-07-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3251 1
a3251 3
	* generic/tclCkalloc.c: ckalloc() and friends take the block size
	as an unsigned, so we should use %ud when reporting it in fprintf()
	and panic().
d3253 3
a3255 1
2002-07-11  Miguel Sofer  <msofer@@users.sourceforge.net>
d3257 1
a3257 4
	* generic/tclCompile.c: now setting local vars undefined at
	compile time, instead of waiting until the proc is initialized. 
	* generic/tclProc.c: use macro TclSetVarUndefined instead of
	directly etting the flag.
d3259 2
a3260 1
2002-07-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3262 1
a3262 2
	* tests/cmdAH.test: [file attr -perm] is Unix-only, so add [catch]
	when not inside a suitably-protected test.
d3264 14
a3277 1
2002-07-10  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3279 1
a3279 4
	* tests/unixFCmd.test, tests/fileName.test: 
	* tests/fCmd.test: Removed [exec] of Unix utilities that have
	equivalents in standard Tcl.  [Bug 579268]  Also simplified some
	of unixFCmd.test while I was at it.
d3281 2
a3282 1
2002-07-10  Don Porter  <dgp@@users.sourceforge.net>
d3284 64
a3347 4
	* tests/tcltest.test:  Greatly reduced the number of [exec]s, using
	slave interps instead.
	* library/tcltest/tcltest.tcl:  Fixed bug uncovered in the conversion
	where a message was written to stdout instead of [outputChannel].
d3349 5
a3353 15
	* tests/basic.test:	Cleaned up, constrained, and reduced the
	* tests/compile.test:	amount of [exec] usage in the test suite.
	* tests/encoding.test:
	* tests/env.test:
	* tests/event.test:
	* tests/exec.test:
	* tests/io.test:
	* tests/ioCmd.test:
	* tests/regexp.test:
	* tests/regexpComp.test:
	* tests/socket.test:
	* tests/tcltest.test:
	* tests/unixInit.test:
	* tests/winDde.test:
	* tests/winPipe.test:
d3355 1
a3355 1
2002-07-10  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3357 2
a3358 1
	* tests/cmdAH.test: Removed [exec] of Unix utilities. [Bug 579211]
d3360 1
a3360 3
	* tests/expr.test: Added tests to make sure that this works.
	* generic/tclExecute.c (ExprCallMathFunc): Functions should also
	be able to return wide-ints.  [Bug 579284]
d3362 80
a3441 1
2002-07-08  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d3443 1
a3443 4
	* tests/socket.test: Fixed bug #578164. The original reason for
	  the was a DNS outage while running the testsuite. Changed [info
	  hostname] to 127.0.0.1 to bypass DNS, knowing that we operate on
	  the local host.
d3445 1
a3445 1
2002-07-08  Don Porter  <dgp@@users.sourceforge.net>
d3447 7
a3453 3
	* doc/tcltest.n:		Fixed incompatibility in [viewFile].
	* library/tcltest/tcltest.tcl:	Corrected docs.  Bumped to 2.2.1.
	* library/tcltest/pkgIndex.tcl: [Bug 578163]
d3455 1
a3455 1
2002-07-08  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3457 3
a3459 59
	* tests/cmdAH.test:
	* tests/fCmd.test:
	* tests/fileName.test: tests which rely on 'file link' need a
	constraint so they don't run on older Windows OS. [Bug 578158]
	* generic/tclIOUtil.c:
	* generic/tcl.h:
	* generic/tclInt.h:
	* generic/tclTest.c:
	* mac/tclMacChan.c:
	* unix/tclUnixChan.c:
	* win/tclWinChan.c:
	* doc/FileSystem.3: cleaned up internal handling of
	Tcl_FSOpenFileChannel to remove duplicate code, and make
	writing external vfs's clearer and easier.  No
	functionality change.  Also clarify that objects with refCount
	zero should not be passed in to the Tcl_FS API, and prevent
	segfaults from occuring on such user errors. [Bug 578617]
	
2002-07-06  Don Porter  <dgp@@users.sourceforge.net>

	* tests/pkgMkIndex.test:  Constrained tests of [load] package indexing
	to those platforms where the testing shared libraries have been built.
	[Bug 578166].

2002-07-05  Don Porter  <dgp@@users.sourceforge.net>
	* changes: added recent changes

2002-07-05  Reinhard Max  <max@@suse.de>

	* generic/tclClock.c (FormatClock): Convert the format string to
	UTF8 before calling TclpStrftime, so that non-ASCII characters
	don't get mangled when the result string is being converted back.
	* tests/clock.test: Added a test for that.

2002-07-05  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/Makefile.in (ro-test,ddd,GDB,DDD): Created new targets to
	allow running the test suite with a read-only current directory,
	running under ddd instead of gdb, and factored out some executable
	names for broken sites (like mine) where gdb and ddd are installed
	with non-standard names...

	* tests/httpold.test: Altered test names to httpold-* to avoid
	clashes with http.test, and stopped tests from failing when the
	current directory is not writable...

	* tests/event.test:		Stop these tests from failing
	* tests/ioUtil.test:		when the current directory is
	* tests/regexp.test:		not writable...
	* tests/regexpComp.test: 
	* tests/source.test: 
	* tests/unixFile.test: 
	* tests/unixNotfy.test: 

	* tests/unixFCmd.test:		Trying to make these test-files
	* tests/macFCmd.test:		not bomb out with an error when
	* tests/http.test:		the current directory is not
	* tests/fileName.test:		writable...
	* tests/env.test:
d3461 1
a3461 1
2002-07-05  Jeff Hobbs  <jeffh@@ActiveState.com>
d3463 3
a3465 1
	*** 8.4b1 TAGGED FOR RELEASE ***
d3467 1
a3467 1
2002-07-04  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3469 3
a3471 3
	* tests/cmdMZ.test (cmdMZ-1.4): 
	* tests/cmdAH.test: More fixing of writable-current-dir
	assumption. [Bug 575824]
d3473 1
a3473 1
2002-07-04  Miguel Sofer  <msofer@@users.sourceforge.net>
d3475 15
a3489 3
	* tests/basic.test: Same issue as below; fixed [Bug 575817]
	
2002-07-04  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d3491 1
a3491 4
	* tests/socket.test: 
	* tests/winPipe.test: 
	* tests/pid.test: Fixed SF Bug #575848. See below for a
	  description the general problem.
d3493 6
a3498 2
	* All the bugs below are instances of the same problem: The
	  testsuite assumes [pwd] = [temporaryDirectory] and writable.
d3500 6
a3505 4
	* tests/iogt.test: Fixed bug #575860.
	* tests/io.test:   Fixed bug #575862.
	* tests/exec.test: 
	* tests/ioCmd.test: Fixed bug #575836.
d3507 1
a3507 1
2002-07-03  Don Porter  <dgp@@users.sourceforge.net>
d3509 7
a3515 4
	* tests/pkg1/direct1.tcl: removed
	* tests/pkg1/pkgIndex.tcl: removed
	* tests/pkgMkIndex.test:  Imported auxilliary files from tests/pkg1
	  into the test file pkgMkIndex.test itself.  Formatting fixes.
d3517 1
a3517 1
	* unix/Makefile.in: removed tests/pkg/* from `make dist`
d3519 1
a3519 20
	* tests/pkg/circ1.tcl: removed
	* tests/pkg/circ2.tcl: removed
	* tests/pkg/circ3.tcl: removed
	* tests/pkg/global.tcl: removed
	* tests/pkg/import.tcl: removed
	* tests/pkg/pkg1.tcl: removed
	* tests/pkg/pkg2_a.tcl: removed
	* tests/pkg/pkg2_b.tcl: removed
	* tests/pkg/pkg3.tcl: removed
	* tests/pkg/pkg4.tcl: removed
	* tests/pkg/pkg5.tcl: removed
	* tests/pkg/pkga.tcl: removed
	* tests/pkg/samename.tcl: removed
	* tests/pkg/simple.tcl: removed
	* tests/pkg/spacename.tcl: removed
	* tests/pkg/std.tcl: removed
	* tests/pkgMkIndex.test: Fixed [Bug 575857] where this test file
	  expected to be able to write to [file join [testsDirectory]
	  pkg].  Part of the fix was to import several auxilliary files
	  into the test file itself.
d3521 8
a3528 2
	* tests/main.test:	Cheap fix for [Bugs 575851, 575858].  Avoid
	* tests/tcltest.test:	non-writable . by [cd [temporaryDirectory]].
d3530 1
a3530 3
	* library/auto.tcl: Fix [tcl_findLibrary] to be sure it sets
	  $varName only if a successful library script is found.
	  [Bug 577033]
d3532 3
a3534 1
2002-07-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d3536 1
a3536 3
	* generic/tclCompCmds.c (TclCompileCatchCmd): return
	  TCL_OUT_LINE_COMPILE instead of TCL_ERROR: let the failure
	  happen at runtime so that it can be caught [Bug 577015].
d3538 5
a3542 1
2002-07-02  Joe English  <jenglish@@users.sourceforge.net>
d3544 1
a3544 1
	* doc/tcltest.n: Markup fixes, spellcheck.
d3546 2
a3547 1
2002-07-02  Don Porter  <dgp@@users.sourceforge.net>
d3549 2
a3550 1
	* doc/tcltest.n: more refinements of the documentation.
d3552 4
a3555 2
	* library/tcltest/tcltest.tcl: Added trace to be sure the stdio
	  constraint is updated whenever the [interpreter] changes.
d3557 2
a3558 6
	* doc/tcltest.n:		Reverted [makeFile] and [viewFile] to
	* library/tcltest/tcltest.tcl:	their former behavior, and documented
	* tests/cmdAH.test:		it.  Corrected misspelling of hook
	* tests/event.test:		procedure.  Restored tests.
	* tests/http.test:
	* tests/io.test:
d3560 1
a3560 3
	* library/tcltest/tcltest.tcl: Simplified logic of
	  [GetMatchingFiles] and [GetMatchingDirectories], removing
	  special case processing.
d3562 4
a3565 2
	* doc/tcltest.n: More documentation updates.  Reference sections
	  are complete.  Only examples need adding.
d3567 7
a3573 1
2002-07-02  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3575 1
a3575 3
	* tests/fCmd.test: 
	* generic/tclCmdAH.c: clearer error msgs for 'file link',
	as per the man page.
d3577 1
a3577 1
2002-07-01  Joe English  <jenglish@@users.sourceforge.net>
d3579 2
a3580 35
	* doc/Access.3:
	* doc/AddErrInfo.3:
	* doc/Alloc.3:
	* doc/Backslash.3:
	* doc/CrtChannel.3:
	* doc/CrtSlave.3:
	* doc/Encoding.3:
	* doc/Eval.3:
	* doc/FileSystem.3:
	* doc/Notifier.3:
	* doc/OpenFileChnl.3:
	* doc/ParseCmd.3:
	* doc/RegExp.3:
	* doc/Tcl_Main.3:
	* doc/Thread.3:
	* doc/TraceCmd.3:
	* doc/Utf.3:
	* doc/WrongNumArgs.3:
	* doc/binary.n:
	* doc/clock.n:
	* doc/expr.n:
	* doc/fconfigure.n:
	* doc/glob.n:
	* doc/http.n:
	* doc/interp.n:
	* doc/lsearch.n:
	* doc/lset.n:
	* doc/msgcat.n:
	* doc/packagens.n:
	* doc/pkgMkIndex.n:
	* doc/registry.n:
	* doc/resource.n:
	* doc/safe.n:
	* doc/scan.n:
	* doc/tclvars.n:  Spell-check, fixed typos (Updates from Larry Virden).
d3582 3
a3584 1
2002-07-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3586 4
a3589 5
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Made Solaris use gcc for linking
	when building with gcc to resolve problems with undefined symbols
	being present when tcl library used with non-gcc linker at later
	stage. Symbols were compiler-generated, so it is the compiler's
	business to define them. [Bug #541181] 
d3591 2
a3592 1
2002-07-01  Don Porter  <dgp@@users.sourceforge.net>
d3594 18
a3611 1
	* doc/tcltest.n: more work in progress updating tcltest docs.
d3613 1
a3613 4
	* library/tcltest/tcltest.tcl: Change [configure -match] to
	stop treating an empty list as a list of the single pattern "*".
	Changed the default value to [list *] so default operation
	remains the same.
d3615 10
a3624 1
	* tests/pkg/samename.tcl: restored.  needed by pkgMkIndex.test.
d3626 2
a3627 2
	* library/tcltest/tcltest.tcl: restored writeability testing of
	-tmpdir, augmented by a special exception for the deafault value.
d3629 5
a3633 1
2002-07-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3635 1
a3635 1
	* doc/concat.n: Documented the *real* behaviour of [concat]!
d3637 1
a3637 1
2002-06-30  Don Porter  <dgp@@users.sourceforge.net>
d3639 3
a3641 1
	* doc/tcltest.n: more work in progress updating tcltest docs.
d3643 1
a3643 6
	* tests/README:		Updated the instructions on running and
	* tests/cmdMZ.test:	adding to the test suite.  Also updated
	* tests/encoding.test:	several tests, mostly to correctly create
	* tests/fCmd.test:	and destroy any temporary files in the
	* tests/info.test:	[temporaryDirectory] of tcltest.
	* tests/interp.test:
d3645 22
a3666 54
	* library/tcltest/tcltest.tcl:	Stopped checking for writeability
	of -tmpdir value because no default directory can be guaranteed to
	be writeable.

	* tests/autoMkindex.tcl: removed.
	* tests/pkg/samename.tcl: removed.
	* tests/pkg/magicchar.tcl: removed.
	* tests/pkg/magicchar2.tcl: removed.
	* tests/autoMkindex.test: Updated auto_mkIndex tests to use
	[makeFile] and [removeFile] so tests are done in [temporaryDirecotry]
	where write access is guaranteed.

	* library/tcltest/tcltest.tcl:	Fixed [makeFile] and [viewFile] to
	* tests/cmdAH.test:		accurately reflect a file's contents.
	* tests/event.test:		Updated tests that depended on buggy
	* tests/http.test:		behavior.  Also added warning messages
	* tests/io.test:		to "-debug 1" operations to debug test
	* tests/iogt.test:		calls to (make|remove)(File|Directory).

	* unix/mkLinks: `make mklinks` on 6-27 commits.

2002-06-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.h: modified the macro TclEmitPush to not
	call its first argument repeatedly or pass it to other macros,
	[Bug 575194] reported by Peter Spjuth.

2002-06-28  Don Porter  <dgp@@users.sourceforge.net>

	* docs/tcltest.n:	Doc revisions in progress.
	* library/tcltest/tcltest.tcl: Corrected -testdir default value.
	Was not reliable, and disagreed with docs!  Thanks to Hemang Lavana.
	[Bug 575150]

2002-06-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tclUnixThrd.c:	Renamed the Tcl_Platform* #defines to
	* unix/tclUnixPipe.c:	TclOS* because they are only used
	* unix/tclUnixFile.c:	internally.  Also stopped double-#def
	* unix/tclUnixFCmd.c:	of TclOSlstat [Bug #566099, post-rename]
	* unix/tclUnixChan.c:
	* unix/tclUnixPort.h:

	* doc/string.n: Improved documentation for [string last] along
	lines described in Bug #574799 so it indicates that the supplied
	index marks the end of the search space.

2002-06-27  Don Porter  <dgp@@users.sourceforge.net>

	* doc/dde.n:		Work in progress updating the documentation
	* doc/http.n:		of the packages that come bundled with
	* doc/msgcat.n:		the Tcl source distribution, notably tcltest.
	* doc/registry.n:
	* doc/tcltest.n:
d3668 35
a3702 2
	* library/tcltest/tcltest.tcl:  Made sure that the TCLTEST_OPTIONS
	environment variablle configures tcltest at package load time.
d3704 1
a3704 1
2002-06-26  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3706 10
a3715 9
	* tests/fileSystem.test: 
	* generic/tclIOUtil.c: fix to handling of empty paths ""
	which are not claimed by any filesystem (Bug #573758).
	Ensure good error messages are given in all cases.
	* tests/cmdAH.test:
	* unix/tclUnixFCmd.c: fix to bug reported as part of
	(Patch #566669).  Thanks to Taguchi, Takeshi for the report.
	
2002-06-26  Reinhard Max  <max@@suse.de>
d3717 1
a3717 2
	* unix/tclUnixTime.c: Make [clock format] respect locale settings.
	* tests/clock.test:   Bug #565880. ***POTENTIAL INCOMPATIBILITY***
d3719 3
a3721 1
2002-06-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d3723 1
a3723 5
	* doc/CrtInterp.3:
	* doc/StringObj.3: clarifications by Don Porter, bugs #493995 and
	#500930. 
	
2002-06-24  Don Porter  <dgp@@users.sourceforge.net>
d3725 2
a3726 3
	* library/tcltest/tcltest.tcl:	Corrected suppression of -verbose skip
	* tests/tcltest.test:		and start by [test -output].  Also
	corrected test suite errors exposed by corrected code.  [Bug 564656]
d3728 3
a3730 1
2002-06-25  Reinhard Max  <max@@suse.de>
d3732 5
a3736 4
	* unix/tcl.m4:       New macro SC_CONFIG_MANPAGES.
	* unix/configure.in: Added support for symlinks and compression
	* unix/Makefile.in:  when installing the manpages. [Patch 518052]
	* unix/mkLinks.tcl:  Default is still hardlinks and no compression.
d3738 5
a3742 2
	* unix/mkLinks:      generated
	* unix/configure:
d3744 1
a3744 1
	* unix/README:       Added documentation for the new features.
d3746 4
a3749 2
	* unix/tcl.m4 (SC_PATH_TCLCONFIG): Replaced ${exec_prefix}/lib by
	${libdir}.
d3751 1
a3751 1
2002-06-25  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3753 66
a3818 40
	* generic/tclUtil.c (TclGetIntForIndex): Fix of critical bug
	#533364 generated when the index is bad and the result is a shared
	object.  The T_ASTO(T_GOR, ...) idiom likely exists elsewhere
	though.  Also removed some cruft that just complicated things to
	no advantage.
	(SetEndOffsetFromAny): Same fix, though this wasn't on the path
	excited by the bug.

2002-06-24  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:	Implementation of TIP 101.  Adds
	* tests/parseOld.test:		and exports a [configure] command
	* tests/tcltest.test:		from tcltest.

2002-06-22  Don Porter  <dgp@@users.sourceforge.net>

	* changes: updated changes file for 8.4b1 release.

	* library/tcltest/tcltest.tcl:	Corrections to tcltest and the
	* tests/basic.test:		Tcl test suite so that a test
	* tests/cmdInfo.test:		with options -constraints knownBug
	* tests/compile.test:		-limitConstraints 1 only tests the
	* tests/encoding.test:		knownBug tests.  Mostly involves
	* tests/env.test:		replacing direct access to the
	* tests/event.test:		testConstraints array with calls
	* tests/exec.test:		to the testConstraint command
	* tests/execute.test:		(which requires tcltest version 2)
	* tests/fCmd.test:
	* tests/format.test:
	* tests/http.test:
	* tests/httpold.test:
	* tests/ioUtil.test:
	* tests/link.test:
	* tests/load.test:
	* tests/namespace.test:
	* tests/pkgMkIndex.test:
	* tests/reg.test:
	* tests/result.test:
	* tests/scan.test:
	* tests/stack.test:
d3820 1
a3820 1
2002-06-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d3822 39
a3860 3
	* tools/tcl.wse.in (Disk Label), unix/tcl.spec (version): 
	* win/README.binary, README, win/configure.in, unix/configure.in: 
	* generic/tcl.h (TCL_RELEASE_*, TCL_PATCH_LEVEL): Bump to beta1.
d3862 4
a3865 1
2002-06-21  Joe English  <jenglish@@users.sourceforge.net>
d3867 1
a3867 3
	* generic/tclCompExpr.c:
	* generic/tclParseExpr.c: LogSyntaxError() should reset 
	the interpreter result [Bug 550142 "Tcl_ExprObj -> abort"] 
d3869 3
a3871 1
2002-06-21  Don Porter  <dgp@@users.sourceforge.net>
d3873 8
a3880 4
	* unix/Makefile.in:	Updated all package install directories
	* win/Makefile.in:	to match current Major.minor versions
	* win/makefile.bc:	of the packages.  Added tcltest package
	* win/makefile.vc:	to installation on Windows.
d3882 1
a3882 2
	* library/init.tcl:  Corrected comments and namespace style
	issues.  Thanks to Bruce Stephens. [Bug 572025]
d3884 2
a3885 1
2002-06-21  Vince Darley  <vincentdarley@@users.sourceforge.net>
d3887 1
a3887 15
	* tests/cmdAH.test:          Added TIP#99 implementation
	* tests/fCmd.test:           of 'file link'.  Supports creation
	* tests/fileName.test:       of symbolic and hard links in the
	* tests/fileSystem.test:     native filesystems and in vfs's,
	* generic/tclTest.c:         when the individual filesystem
	* generic/tclCmdAH.c:        supports the concept.
	* generic/tclIOUtil.c:       
	* generic/tcl.h:
	* generic/tcl.decls:
	* doc/FileSystem.3:
	* doc/file.n:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: Also enhanced speed of 'file normalize' on
	Windows.
d3889 2
a3890 1
2002-06-20  Miguel Sofer  <msofer@@users.sourceforge.net>
d3892 5
a3896 3
	* generic/tclBasic.c (TclEvalObjvInternal): fix for [Bug 571385]
	in the implementation of TIP#62 (command tracing). Vince Darley,
	Hemang Lavana & Don Porter: thanks.
d3898 5
a3902 1
2002-06-20  Miguel Sofer  <msofer@@users.sourceforge.net>
d3904 1
a3904 2
	* generic/tclExecute.c (TclCompEvalObj): clarified and simplified
	the logic for compilation/recompilation.
d3906 3
a3908 2
2002-06-19  Joe English  <jenglish@@users.sourceforge.net>
	* doc/file.n: Fixed indentation.  No substantive changes.
d3910 3
a3912 1
2002-06-19  Jeff Hobbs  <jeffh@@ActiveState.com>
d3914 11
a3924 3
	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): get the resultPtr again
	as the Tcl_ObjSetVar2 may cause the result to change.
	[Patch #558324] (watson)
d3926 1
a3926 1
2002-06-19  Miguel Sofer  <msofer@@users.sourceforge.net>
d3928 18
a3945 2
	* generic/tclExecute.c (TEBC): removing unused "for(;;)" loop;
	improved comments; re-indentation.
d3947 2
a3948 1
2002-06-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d3950 2
a3951 12
	* generic/tclExecute.c (TEBC): 
	- elimination of duplicated code in the non-immediate INST_INCR
	  instructions. 
	- elimination of 103 (!) TclDecrRefCount macros. The different
	  instructions now jump back to a common "DecrRefCount zone" at
	  the top of the loop. The macro "ADJUST_PC" was replaced by two
	  macros "NEXT_INST_F" and "NEXT_INST_V" that take three params
	  (pcAdjustment, # of stack objects to discard, resultObjPtr
	  handling flag). The only instructions that retain a
	  TclDecrRefCount are INST_POP (for speed), the common code for
	  the non-immediate INST_INCR, INST_FOREACH_STEP and the two
	  INST_LSET.
d3953 1
a3953 3
	The object size of tclExecute.o was reduced by approx 20% since
	the start of the consolidation drive, while making room for some
	peep-hole optimisation at runtime.
d3955 18
a3972 1
2002-06-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d3974 1
a3974 2
	* generic/tclExecute.c (TEBC, INST_DONE): small bug in the panic
	code for tcl-stack corruption.
d3976 4
a3979 1
2002-06-17  David Gravereaux <davygrvy@@pobox.com>
d3981 5
a3985 2
	Trims to support the removal of RESOURCE_INCLUDED from rc
	scripts	from FR #565088.
d3987 3
a3989 2
	* generic/tcl.h: moved the #ifndef RC_INVOKED start block up in
	the file.  rc scripts don't need to know thread mutexes.
d3991 6
a3996 3
	* win/tcl.rc:
	* win/tclsh.rc: removed the #define RESOURCE_INCLUDED to let the
	built-in -DRC_INVOKED to the work.
d3998 3
a4000 1
2002-06-17  Jeff Hobbs  <jeffh@@ActiveState.com>
d4002 2
a4003 13
	* doc/CrtTrace.3:        Added TIP#62 implementation of command
	* doc/trace.n:           execution tracing [FR #462580] (lavana).
	* generic/tcl.h:         This includes enter/leave tracing as well
	* generic/tclBasic.c:    as inter-procedure stepping.
	* generic/tclCmdMZ.c:
	* generic/tclCompile.c:
	* generic/tclExecute.c:
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c:
	* tests/trace.test:
d4005 5
a4009 1
2002-06-17  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d4011 1
a4011 4
	* win/tclWinPipe.c (BuildCommandLine): Fixed bug #554068 ([exec]
	  on windows did not treat { in filenames well.). Bug reported by
	  Vince Darley <vincentdarley@@users.sourceforge.net>, patch
	  provided by Vince too.
d4013 6
a4018 1
2002-06-17  Joe English  <jenglish@@users.sourceforge.net>
d4020 2
a4021 3
	* generic/tcl.h: #ifdef logic for K&R C backwards compatibility
	changed to assume modern C by default.  See SF FR #565088 for
	full details.
d4023 4
a4026 1
2002-06-17  Don Porter  <dgp@@users.sourceforge.net>
d4028 17
a4044 2
	* doc/msgcat.n: Corrected en_UK references to en_GB.  UK is not
	a country designation recognized in ISO 3166.
d4046 26
a4071 2
	* library/msgcat/msgcat.tcl:  More Windows Registry locale codes
	from Bruno Haible.
d4073 3
a4075 10
	* doc/msgcat.n:
	* library/msgcat/msgcat.tcl:
	* library/msgcat/pkgIndex.tcl:
	* tests/msgcat.test:  Revised locale initialization to interpret
	environment variable locale values according to XPG4, and to
	recognize the LC_ALL and LC_MESSAGES values over that of LANG.
	Also added many Windows Registry locale values to those 
	recognized by msgcat.  Revised tests and docs.  Bumped to
	version 1.3.  Thanks to Bruno Haible for the report and
	assistance crafting the solution.  [Bug 525522, 525525]
d4077 2
a4078 1
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>
d4080 2
a4081 2
	* generic/tclCompile.c (TclCompileTokens): a better algorithm for
	the previous bug fix.
d4083 12
a4094 1
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>
d4096 5
a4100 5
	* generic/tclCompile.c (TclCompileTokens): 
	* tests/compile.test: [Bug 569438] in the processing of dollar
	variables; report by Georgios Petasis. 
	
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>
d4102 7
a4108 4
	* generic/tclExecute.c: bug in the consolidation of the
	INCR_..._STK instructions; the bug could not be exercised as the
	(faulty) instruction INST_INCR_ARRAY_STK was never compiled-in
	(related to [Bug 569438]).
d4110 4
a4113 1
2002-06-14  Miguel Sofer  <msofer@@users.sourceforge.net>
d4115 7
a4121 8
	* generic/tclExecute.c (TclExecuteByteCode): runtime peep-hole
	optimisation of variables (INST_STORE, INST_INCR) and commands
	(INST_INVOKE); faster check for the existence of a catch.
	(TclExecuteByteCode): runtime peep-hole optimisation of
	comparisons.
	(TclExecuteByteCode): runtime peep-hole optimisation of
	INST_FOREACH - relies on peculiarities of the code produced by the
	bytecode compiler.
d4123 3
a4125 1
2002-06-14  David Gravereaux <davygrvy@@pobox.com>
d4127 3
a4129 3
	* win/rules.vc: The test for compiler optimizations was in error.
	Thanks goes to Roy Terry <royterry@@earthlink.net> for his
	assistance with this.
d4131 1
a4131 1
2002-06-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4133 12
a4144 4
	* doc/trace.n, tests/trace.test: 
	* generic/tclCmdMZ.c (Tcl_TraceObjCmd,TclTraceCommandObjCmd)
	(TclTraceVariableObjCmd): Changed references to "trace list" to
	"trace info" as mandated by TIP#102.
d4146 6
a4151 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4153 1
a4153 2
	* generic/tclExecute.c (TclExecuteByteCode): consolidated code for
	the conditional branch instructions.
d4155 1
a4155 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4157 21
a4177 2
	* generic/tclExecute.c (TclExecuteByteCode): fixed the previous
	patch - wouldn't compile with TCL_COMPILE_DEBUG set.
d4179 2
a4180 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4182 10
a4191 4
	* generic/tclExecute.c (TclExecuteByteCode): consolidated the
	handling of exception returns to INST_INVOKE and INST_EVAL, as
	well as most of the code for INST_CONTINUE and INST_BREAK, in the
	new jump target "processExceptionReturn".
d4193 60
a4252 1
2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>
d4254 2
a4255 7
	* generic/tclExecute.c (TclExecuteByteCode): consolidated variable
	handling opcodes, replaced redundant code with some 'goto'. All
	store/append/lappend opcodes on the same data type now share the
	main code; same with incr opcodes.
	* generic/tclVar.c: added the bit TCL_TRACE_READS to the possible
	flags to Tcl_SetVar2Ex - it causes read traces to be fired prior
	to setting the variable. This is used in the core for [lappend].
d4257 1
a4257 6
	***NOTE*** the usage of TCL_TRACE_READS in Tcl_(Obj)?GetVar.* is
	not documented; there, it causes the call to create the variable
	if it does not exist. The new usage in Tcl_(Obj)?SetVar.* remains
	undocumented too ...
	
2002-06-13  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4259 1
a4259 4
	* tests/fCmd.test:
	* tests/winFile.test:
	* tests/fileSystem.test:
	* generic/tclTest.c:
d4261 5
d4267 11
a4277 26
	* doc/FileSystem.3:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: fixed up further so both compiles and
	actually works with VC++ 5 or 6.
	* win/tclWinInt.h: 
	* win/tclWin32Dll.c: cleaned up code and vfs tests and
	added tests for the internal changes of 2002-06-12, to see
	whether WinTcl on NTFS can coexist peacefully with links
	in the filesystem.  Added new test command 'testfilelink'
	to enable the newer code to be tested.
	* tests/fCmd.test: (made certain tests of 'testfilelink' not
	run on unix).

2002-06-12  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tclBasic.c (Tcl_DeleteTrace): fixed [Bug 568123] (thanks to
	Hemang Lavana)
	
2002-06-12  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinFile.c: corrected the symbolic link handling code to
	allow it to compile.  Added real definition of REPARSE_DATA_BUFFER
	(found in winnt.h).  Most of the added definitions appear to have
	correct, cross-Win-version equivalents in winnt.h and should be
	removed, but just making things "work" for now.
d4279 1
a4279 1
2002-06-12  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4281 1
a4281 4
	* generic/tclIOUtil.c:
	* generic/tcl.decls:
	* generic/tclDecls.h: made code for Tcl_FSNewNativePath
	agree with man pages.
d4283 3
a4285 16
	* doc/FileSystem.3: clarified the circumstances under which
	certain functions are called in the presence of symlinks.
	
	* win/tclWinFile.c:
	* win/tclWinPort.h: 
	* win/tclWinInt.h: 
	* win/tclWinFCmd.c:  Fix for Windows to allow 'file lstat', 
	'file type', 'glob -type l', 'file copy', 'file delete', 
	'file normalize', and all VFS code to work correctly in the 
	presence of symlinks (previously Tcl's behaviour was not very 
	well defined).  This also fixes possible serious problems in 
	all versions of WinTcl where 'file delete' on a NTFS symlink 
	could delete the original, not the symlink.
	Note: symlinks cannot yet be created in pure Tcl.

2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>
d4287 1
a4287 19
	* generic/tclBasic.c: 
	* generic/tclCompCmds.c:
	* generic/tclInt.h: reverted the new compilation functions;
	replaced by a more general approach described below.

	* generic/tclCompCmds.c:
	* generic/tclCompile.c: made *all* compiled variable access
	attempts create an indexed variable - even get or incr without
	previous set. This allows indexed access to local variables that
	are created and set at runtime, for example by [global], [upvar],
	[variable], [regexp], [regsub].

2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/global.n:
	* doc/info.n:
	* test/info.test:
	* generic/tclCmdIL.c: fix for [Bug 567386], [info locals] was
	reporting some linked variables.
d4289 1
a4289 6
	* generic/tclBasic.c: 
	* generic/tclCompCmds.c:
	* generic/tclInt.h: added compile functions for [global],
	[variable] and [upvar]. They just declare the new local variables,
	the commands themselves are not compiled-in. This gives a notably
	faster read access to these linked variables.
d4291 1
a4291 1
2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>
d4293 2
a4294 2
	* generic/tclExecute.c: optimised algorithm for exception range
	lookup; part of [Patch 453709].
d4296 2
a4297 1
2002-06-10  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4299 1
a4299 6
	* unix/tclUnixFCmd.c: fixed [Bug #566669]
	* generic/tclIOUtil.c: improved and sped up handling of
	native paths (duplication and conversion to normalized paths),
	particularly on Windows.
	* modified part of above commit, due to problems on Linux. 
	Will re-examine bug report and evaluate more closely.
d4301 1
a4301 1
2002-06-07  Don Porter  <dgp@@users.sourceforge.net>
d4303 1
a4303 2
	* tests/tcltest.test:  More corrections to test suite so that tests
	of failing [test]s don't show up themselves as failing tests.
d4305 2
a4306 1
2002-06-07  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4308 1
a4308 4
	* generic/tclExecute.c: Tidied up headers in relation to float.h
	to cut the cruft and ensure DBL_MAX is defined since doubles seem
	to be the same size everywhere; if the assumption isn't true, the
	variant platforms had better have run configure...
d4310 1
a4310 7
	* unix/tclUnixPort.h (EOVERFLOW): Added code to define it if it
	wasn't previously defined.  Also some other general tidying and
	adding of comments.  [Tcl bugs 563122, 564595]
	* compat/tclErrno.h: Added definition for EOVERFLOW copied from
	Solaris headers; I've been unable to find any uses of EFTYPE,
	which was the error code previously occupying the slot, in Tcl, or
	any definition of it in the Solaris headers.
d4312 7
a4318 1
2002-06-06  Mo DeJong  <mdejong@@users.sourceforge.net>
d4320 1
a4320 3
	* unix/dltest/Makefile.in: Remove hard coded CFLAGS=-g
	and add CFLAGS_DEBUG, CFLAGS_OPTIMIZE, and
	CFLAGS_DEFAULT varaibles. [Tcl bug 565488]
d4322 3
a4324 1
2002-06-06  Don Porter  <dgp@@users.sourceforge.net>
d4326 1
a4326 2
	* tests/tcltest.test:  Corrections to test suite so that tests
	of failing [test]s don't show up themselves as failing tests.
d4328 4
a4331 2
	* tests/io.test: Fixed up namespace variable resolution issues
	revealed by running test suite with "-singleproc 1".
d4333 1
a4333 46
	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test: Several updates to tcltest.
	  1) changed to lazy initialization of test constraints
	  2) deprecated [initConstraintsHook]
	  3) repaired badly broken [limitConstraints].
	  4) deprecated [threadReap] and [mainThread]
	[Patch 512214, Bug 558742, Bug 461000, Bug 534903]

2002-06-06  Daniel Steffen  <das@@users.sourceforge.net>

	* unix/tclUnixThrd.c (TclpReaddir, TclpLocaltime, TclpGmtime):
	added mutex wrapped calls to readdir, localtime & gmtime in
	case their thread-safe *_r counterparts are not available.
	* unix/tcl.m4: added configure check for readdir_r
	* unix/tcl.m4 (Darwin): set TCL_DEFAULT_ENCODING to utf-8 on
	MacOSX (where posix file apis expect utf-8, not iso8859-1).   
	* unix/configure: regen
	* unix/Makefile.in: set DYLD_LIBRARY_PATH in parallel       
	to LD_LIBRARY_PATH for MacOSX dynamic linker.
	* generic/tclEnv.c (TclSetEnv): fix env var setting on
	MacOSX (adapted from patch #524352 by jkbonfield).

2002-06-05  Don Porter  <dgp@@users.sourceforge.net>

	* doc/Tcl_Main.3: Documented $tcl_rcFileName and added more
	clarifications about the intended use of Tcl_Main(). [Bug 505651]

2002-06-05  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclFileName.c (TclGlob): mac specific fix to
	recent changes in 'glob -tails' handling.
	* mac/tclMacPort.h:
	* mac/tclMacChan.c: fixed TIP#91 bustage.
	* mac/tclMacResource.c (Tcl_MacConvertTextResource): added utf
	conversion of text resource contents.
	* tests/macFCmd.test (macFCmd-1.2): allow CWIE creator.

2002-06-04  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:
	* tests/init.test:
	* tests/tcltest.test:	Added more TIP 85 tests from Arjen Markus.
	Converted tcltest.test to use a private namespace.  Fixed bugs in
	[tcltest::Eval] revealed by calling [tcltest::test] from a non-global
	namespace, and namespace errors in init.test.
d4335 6
a4340 1
2002-06-04  Mo DeJong  <mdejong@@users.sourceforge.net>
d4342 2
a4343 1
	* win/README: Update msys+mingw URL.
d4345 1
a4345 1
2002-06-03  Don Porter  <dgp@@users.sourceforge.net>
d4347 2
a4348 8
	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* library/tcltest/pkgIndex.tcl:
	* tests/tcltest.test:  Implementation of TIP 85.  Allows tcltest
	users to add new legal values of the -match option to [test],
	associating each with a Tcl command that does the matching of
	expected results with actual results of tests.  Thanks to
	Arjen Markus.  => tcltest 2.1 [Patch 521362]
d4350 1
a4350 1
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d4352 1
a4352 2
	* doc/namespace.n: added description of [namepace forget]
	behaviour for unqualified patterns [Bug 559268]
d4354 2
a4355 1
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d4357 3
a4359 4
	* generic/tclExecute.c: reverting an accidental modification in
	the last commit.
	
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d4361 1
a4361 2
	* doc/Tcl.n: clarify the empty variable name issue ([Bug 549285]
	reported by Tom Krehbiel, patch by Don Porter).
d4363 2
a4364 1
2002-05-31  Don Porter  <dgp@@users.sourceforge.net>
d4366 1
a4366 2
	* library/package.tcl:  Fixed leak of slave interp in [pkg_mkIndex].
	Thanks to Helmut for report.  [Bug 550534]
d4368 3
a4370 3
	* tests/io.test:
	* tests/main.test:  Use the "stdio" constraint to control whether
	an [open "|[interpreter]"] is attempted.
d4372 1
a4372 67
	* generic/tclExecute.c (TclMathInProgress,TclExecuteByteCode
		ExprCallMathFunc):
	* generic/tclInt.h (TclMathInProgress):
	* unix/Makefile.in (tclMtherr.*):
	* unix/configure.in (NEED_MATHERR):
	* unix/tclAppInit.c (matherr):
	* unix/tclMtherr.c (removed file):
	* win/tclWinMtherr.c (_matherr): Removed internal routine
	TclMathInProgress and Unix implementation of matherr().  These
	are now obsolete, dealing with very old versions of the C math
	library.  Windows version is retained in case Borland compilers
	require it, but it is inactive.  Thanks to Joe English.
	[Bug 474335, Patch 555635].
	* unix/configure: regen

2002-05-30  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompExpr.c:
	* generic/tclCompile.c:
	* generic/tclCompile.h: removed exprIsJustVarRef and
	exprIsComparison from the ExprInfo and CompileEnv structs. These
	were set, but not used since dec 1999 [Bug 562383].

2002-05-30  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c (TclGlob): fix to longstanding
	'knownBug' in fileName tests 15.2-15.4, and fix to a new
	Tcl 8.4 bug in certain uses of 'glob -tails'.
	* tests/fileName.test: removed 'knownBug' flag from some tests,
	added some new tests for above bugs.
	
2002-05-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure: regen'ed
	* unix/configure.in: replaced bigendian check with autoconf
	standard AC_C_BIG_ENDIAN, which defined WORDS_BIGENDIAN on
	bigendian systems.
	* generic/tclUtf.c (Tcl_UniCharNcmp): 
	* generic/tclInt.h (TclUniCharNcmp): use WORDS_BIGENDIAN instead of
	TCL_OPTIMIZE_UNICODE_COMPARE to enable memcmp alternative.

	* generic/tclExecute.c (TclExecuteByteCode INST_STR_CMP):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): changed the case for
	choosing the Tcl_UniCharNcmp compare to when both objs are of
	StringType, as benchmarks show that is the optimal check (both
	bigendian and littleendian systems).

2002-05-29  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclMain.c: Removed "dummy" reference to Tcl_LinkVar.
	It is no longer needed since Tcl_Main() now actually calls
	Tcl_LinkVar().  Thanks to Joe English for pointing that out.

2002-05-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclExecute.c (TclExecuteByteCode): 
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): Use the macro version.
	* generic/tclInt.h (TclUniCharNcmp): Optimised still further with
	a macro for use in sensitive places like tclExecute.c

	* generic/tclUtf.c (Tcl_UniCharNcmp): Use new flag to figure out
	when we can use an optimal comparison scheme, and default to the
	old scheme in other cases which is at least safe.
	* unix/configure.in (TCL_OPTIMIZE_UNICODE_COMPARE): New optional
	flag that indicates when we can use memcmp() to compare Unicode
	strings (i.e. when the high-byte of a Tcl_UniChar precedes the
	low-byte.)
d4374 1
a4374 1
2002-05-29  Jeff Hobbs  <jeffh@@ActiveState.com>
d4376 3
a4378 21
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclUtf.c: added TclpUtfNcmp2 private command that
	mirrors Tcl_UtfNcmp, but takes n in bytes, not utf-8 chars.  This
	provides a faster alternative for comparing utf strings	internally.
	(Tcl_UniCharNcmp, Tcl_UniCharNcasecmp): removed the explicit end
	of string check as it wasn't correct for the function (by doc and
	logic).

	* generic/tclCmdMZ.c (Tcl_StringObjCmd): reworked the string equal
	comparison code to use TclpUtfNcmp2 as well as short-circuit for
	equal objects or unequal length strings in the equal case.
	Removed the use of goto and streamlined the other parts.

	* generic/tclExecute.c (TclExecuteByteCode): added check for
	object equality in the comparison instructions.  Added
	short-circuit for != length strings in INST_EQ, INST_NEQ and
	INST_STR_CMP.  Reworked INST_STR_CMP to use TclpUtfNcmp2 where
	appropriate, and only use Tcl_UniCharNcmp when at least one of the
	objects is a Unicode obj with no utf bytes.
d4380 1
a4380 2
	* generic/tclCompCmds.c (TclCompileStringCmd): removed error
	creation in code that no longer throws an error.
d4382 2
a4383 2
	* tests/string.test:
	* tests/stringComp.test: added more string comparison checks.
d4385 2
a4386 1
	* tests/clock.test: better qualified 9.1 constraint check for %s.
d4388 2
a4389 1
2002-05-28  Jeff Hobbs  <jeffh@@ActiveState.com>
d4391 1
a4391 2
	* generic/tclThreadAlloc.c (TclpRealloc, TclpFree): protect
	against the case when NULL is based.
d4393 1
a4393 67
	* tests/clock.test: added clock-9.1
	* compat/strftime.c:
	* generic/tclClock.c:
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* unix/tclUnixTime.c: fix for Windows msvcrt mem leak caused by
	using an env(TZ) setting trick for in clock format -gmt 1.  This
	also makes %s seem to work correctly with -gmt 1 as well as
	making it a lot faster by avoid the env(TZ) hack.  TclpStrftime
	now takes useGMT as an arg.  [Bug #559376]

2002-05-28  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclIOUtil.c: fixes to Tcl_FSLoadFile when called on
	a file inside a vfs.  This should avoid leaving temporary 
	files sitting around on exit. [Bug #545579]
	
2002-05-27  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* win/tclWinError.c: Added comment on conversion of
	ERROR_NEGATIVE_SEEK because that is a mapping that really belongs,
	and not a catch-all case.
	* win/tclWinPort.h (EOVERFLOW): Should be either EFBIG or EINVAL
	* generic/tclPosixStr.c (Tcl_ErrnoId, Tcl_ErrnoMsg): EOVERFLOW can
	potentially be a synonym for EINVAL.

2002-05-24  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	=== Changes due to TIP#91 ===

	* win/tclWinPort.h: Added declaration of EOVERFLOW.
	* doc/CrtChannel.3: Added documentation of wideSeekProc.
	* generic/tclIOGT.c (TransformSeekProc, TransformWideSeekProc):
	Adapted to use the new channel mechanism.
	* unix/tclUnixChan.c (FileSeekProc, FileWideSeekProc): Renamed
	FileSeekProc to FileWideSeekProc and created new FileSeekProc
	which has the old-style interface and which errors out with
	EOVERFLOW when the returned file position can't fit into the
	return type (int for historical reasons.)
	* win/tclWinChan.c (FileSeekProc, FileWideSeekProc): Renamed
	FileSeekProc to FileWideSeekProc and created new FileSeekProc
	which has the old-style interface and which errors out with
	EOVERFLOW when the returned file position can't fit into the
	return type (int for historical reasons.)
	* mac/tclMacChan.c (FileSeek): Reverted to old interface; Macs
	lack large-file support because I can't see how to add it.
	* generic/tclIO.c (Tcl_Seek, Tcl_Tell): Given these functions
	knowledge of the new arrangement of channel types.
	(Tcl_ChannelVersion): Added recognition of new version code.
	(HaveVersion): New function to do version checking.
	(Tcl_ChannelBlockModeProc, Tcl_ChannelFlushProc)
	(Tcl_ChannelHandlerProc): Made these functions use HaveVersion for
	ease of future maintainability.
	(Tcl_ChannelBlockModeProc): Obvious lookup function.
	* generic/tcl.h (Tcl_ChannelType): New wideSeekProc field, and
	seekProc type restored to old interpretation.
	(TCL_CHANNEL_VERSION_3): New channel version.

2002-05-24  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
	
	* tests/winPipe.test: Applied patch for SF Tcl Bug #549617. Patch
	  and bug report by Kevin Kenny <kennykb@@users.sourceforge.net>.

	* win/tclWinSock.c (TcpWatchProc): Fixed SF Tcl Bug #557878. We
	  are not allowed to mess with the watch mask if the socket is a
	  server socket. I believe that the original reporter is George
	  Peter Staplin.
d4395 2
a4396 1
2002-05-21  Mo DeJong  <mdejong@@users.sourceforge.net>
d4398 1
a4398 7
	* unix/configure: Regen.
	* unix/configure.in: Invoke SC_ENABLE_SHARED before
	calling SC_CONFIG_CFLAGS so that the SHARED_BUILD
	variable can be checked inside SC_CONFIG_CFLAGS.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Pass -non_shared
	instead of -shared to ld when configured with
	--disable-shared under OSF. [Tcl bug 540390]
d4400 2
a4401 1
2002-05-20  Daniel Steffen  <das@@users.sourceforge.net>
d4403 1
a4403 3
	* generic/tclInt.h: added prototype for TclpFilesystemPathType().
	* mac/tclMacChan.c: use MSL provided creator type if available
	instead of the default 'MPW '.
d4405 2
a4406 1
2002-05-16  Joe English  <jenglish@@users.sf.net>
d4408 1
a4408 3
	* doc/CrtObjCmd.3: 
	Added Tcl_GetCommandFromObj, Tcl_GetCommandFullName
	(Tcl Bug #547987, #414921)
d4410 4
a4413 1
2002-05-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4415 1
a4415 3
	* unix/tclUnixChan.c (TtyOutputProc): #if/#endif-ed this function
	out to stop compiler warnings.  Also much general tidying of
	comments in this file and removal of whitespace from blank lines.
d4417 3
a4419 1
2002-05-13  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4421 1
a4421 4
	* unix/tclUnixChan.c (SETBREAK): Solaris thinks ioctl() takes a
	signed second argument, and Linux thinks ioctl() takes an unsigned
	second argument.  So need a longer definition of this macro to get
	neither to spew warnings...
d4423 3
a4425 1
2002-05-13  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4427 1
a4427 8
	* generic/tclEvent.c: 
	* generic/tclIOUtil.c:
	* generic/tclInt.h: clean up all memory allocated by the
	filesystem, via introduction of 'TclFinalizeFilesystem'.
	Move TclFinalizeLoad into TclFinalizeFilesystem so we can
	be sure it is called at just the right time.
	Fix bad comment also.  [Bug #555078 and 'fs' part of #543549]
	* win/tclWinChan.c: fix comment referring to wrong function.
d4429 1
a4429 1
2002-05-10  Don Porter  <dgp@@users.sourceforge.net>
d4431 4
a4434 5
	* tests/load.test:
	* tests/safe.test:
	* tests/tcltest.test: Corrected some list-quoting issues and
	other matters that cause tests to fail when the patch includes
	special characters.  Report from Vince Darley.  [Bug 554068].
d4436 1
a4436 1
2002-05-08    David Gravereaux <davygrvy@@pobox.com>
d4438 3
a4440 15
	* doc/file.n:
	* tools/man2tcl.c:
	* tools/man2help2.tcl:  Thanks to Peter Spjuth
	<peter.spjuth@@space.se>, again.  My prior fix for
	single-quote macro mis-understanding was wrong.	 Reverted to
	reimpliment the 'macro2' proc which handles single-quote macros
	and restored file.n text arrangement to avoid single-quotes on
	the first line.  Sorry for all the confusion.

2002-05-08  David Gravereaux <davygrvy@@pobox.com>

	* tools/man2tcl.c:
	* tools/man2help2.tcl: Proper source of macro error mis-
	understanding single-quote as the leading macro command found
	and repaired.
d4442 1
a4442 2
	* doc/file.n: Reverted to prior state before I messed with
	it.
d4444 2
a4445 1
2002-05-08  Don Porter  <dgp@@users.sourceforge.net>
d4447 1
a4447 17
	* library/tcltest/tcltest.tcl: Corrected [uplevel] quoting when
	[source]-ing test script in subdirectories.
	* tests/fileName.test:
	* tests/load.test:
	* tests/main.test:
	* tests/tcltest.test: 
	* tests/unixInit.test: Fixes to test suite when there's a space
	in the working path.  Thanks to Kevin Kenny.

2002-05-07  David Gravereaux <davygrvy@@pobox.com>

	-- Changes from Peter Spjuth <peter.spjuth@@space.se>
	* tools/man2tcl.c: Increased line buffer size and a bail-out if
	that should ever be over-run.
	* tools/man2help.tcl: Include Courier New font in rtf header.
	* tools/man2help2.tcl: Improved handling of CS/CE fields.  Use
	Courier New for code samples and indent better.
d4449 3
a4451 5
	* doc/file.n:
	* doc/TraceCmd.3:  winhelp conversion tools where understanding
	a ' as the first character on a line to be an unknown macro.
	Not knowing how to repair tools/man2tcl.c, I decided to rearrange
	the text in the docs instead.
d4453 1
a4453 1
2002-05-07  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4455 6
a4460 40
	* generic/tclFileName.c: fix to similar segfault when using 
	'glob -types nonsense -dir dirname -join * *'. [Bug 553320]
	
	* doc/FileSystem.3: further documentation on vfs.
	* tests/cmdAH.test:
	* tests/fileSystem.test:
	* tests/pkgMkindex.test: Fix to testsuite bugs when running out
	of directory whose name contains '{' or '['.

2002-05-07  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/basic.test: Fix for [Bug 549607]
	* tests/encoding.test: Fix for [Bug 549610]
	These are testsuite bugs that caused failures when the filename
	contained spaces. Report & fix by Kevin Kenny.

2002-05-02  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c: fix to freeing a bad object 
	(i.e. segfault) when using 'glob -types nonsense -dir dirname'.
	* generic/tclWinFile.c: fix to [Bug 551306], also wrapped some 
	long lines.
	* tests/fileName.test: added several tests for the above bugs.
	* doc/FileSystem.3: clarified documentation on refCount
	requirements of the object returned by the path type function.
	* generic/tclIOUtil.c:
	* win/tclWinFile.c:
	* unix/tclUnixFile.c:
	* mac/tclMacFile.c: moved TclpFilesystemPathType to the
	platform specific directories, so we can add missing platform-
	specific implementations.  On Windows, 'file system' now returns 
	useful results like "native NTFS", "native FAT" for that system.  
	Unix and MacOS still only return "native".
	* doc/file.n: clarified documentation.
	* tests/winFile.test: test for 'file system' returning correct
	values.
	* tests/fileSystem.test: test for 'file system' returning correct
	values.  Clean up after failed previous test run.
	
2002-04-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d4462 1
a4462 3
	* unix/configure:
	* unix/tcl.m4: change HP-11 SHLIB_LD_LIBS from "" to ${LIBS} so
	that the .sl knows its dependent libs.
d4464 2
a4465 1
2002-04-26  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4467 1
a4467 4
	* tests/obj.test (obj-11.[56]): Test conversion to boolean more
	thoroughly.
	* generic/tclObj.c (SetBooleanFromAny): Was not calling an integer
	parsing function on native 64-bit platforms!  [Bug 548686]
d4469 7
a4475 1
2002-04-24  Jeff Hobbs  <jeffh@@ActiveState.com>
d4477 1
a4477 3
	* generic/tclInt.h: corrected TclRememberJoinableThread decl to
	use VOID instead of void.
	* generic/tclThreadJoin.c: noted that this code isn't needed on Unix.
d4479 2
a4480 1
2002-04-23  Jeff Hobbs  <jeffh@@ActiveState.com>
d4482 1
a4482 2
	* doc/exec.n: 
	* doc/tclvars.n: doc updates [Patch #509426] (gravereaux)
d4484 2
a4485 1
2002-04-24  Daniel Steffen  <das@@users.sourceforge.net>
d4487 1
a4487 4
	* mac/tclMacResource.r: added check of
	TCLTK_NO_LIBRARY_TEXT_RESOURCES #define to allow disabling the
	inclusion of the tcl library code in the resource fork of Tcl
	executables and shared libraries.
d4489 1
a4489 1
2002-04-23  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4491 1
a4491 2
	* doc/TraceCmd.3: New file that documents Tcl_CommandTraceInfo,
	Tcl_TraceCommand and Tcl_UntraceCommand [Bug 414927]
d4493 1
a4493 1
2002-04-22  Jeff Hobbs  <jeffh@@ActiveState.com>
d4495 1
a4495 17
	* generic/tclAlloc.c:
	* generic/tclInt.h:
	* generic/tclThreadAlloc.c (new):
	* unix/Makefile.in:
	* unix/tclUnixThrd.c:
	* win/Makefile.in:
	* win/tclWinInt.h:
	* win/tclWinThrd.c: added new threaded allocator contributed by
	AOL that significantly reduces lock contention when multiple
	threads are in use.  Only Windows and Unix implementations are
	ready, and the Windows one may need work.  It is only used by
	default on Unix for now, and requires that USE_THREAD_ALLOC be
	defined (--enable-threads on Unix will define this).

	* generic/tclIOUtil.c (Tcl_FSRegister, Tcl_FSUnregister):
	corrected calling of Tcl_ConditionWait to ensure that there would
	be a condition to wait upon.
d4497 1
a4497 1
	* generic/tclCmdAH.c (Tcl_FileObjCmd): added cast in FILE_SIZE.
d4499 1
a4499 2
	* win/tclWinFCmd.c (DoDeleteFile): check return of setattr API
	calls in file deletion for correct Win32 API handling.
d4501 3
a4503 2
	* win/Makefile.in: correct dependencies for shell, gdb, runtest
	targets.
d4505 1
a4505 19
	* doc/clock.n:
	* compat/strftime.c (_fmt): change strftime to correctly handle
	localized %c, %x and %X on Windows.  Added some notes about how
	the other values could be further localized.

2002-04-19  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclMain.c (Tcl_Main):  Free the memory allocated for the
	startup script path.  [Bug 543549]

	* library/msgcat/msgcat.tcl:  [mcmax] wasn't using the caller's
	namespace when determining the max translated length.  Also
	made revisions for better use of namespace variables and more
	efficient [uplevel]s.

	* doc/msgcat.n:
	* library/msgcat/msgcat.tcl:
	* library/msgcat/pkgIndex.tcl:  Added [mcload] to the export list
	of msgcat; bumped to 1.2.3.  [Bug 544727]
d4507 1
a4507 1
2002-04-20  Daniel Steffen  <das@@users.sourceforge.net>
d4509 2
a4510 17
	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacUtil.c: Modified TclpObjNormalizePath to be alias
	file aware, and replaced various calls to FSpLocationFrom*Path
	by calls to new alias file aware versions FSpLLocationFrom*Path.
	The alias file aware routines don't resolve the last component of
	a path if it is an alias. This allows [file copy/delete] etc. to
	act correctly on alias files. (c.f. discussion in Bug #511666)

2002-04-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/lindex.test (lindex-3.7): 
	* generic/tclUtil.c (TclGetIntForIndex): Stopped indexes from
	hitting wide ints.  [Bug #526717]
d4512 1
a4512 1
2002-04-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4514 4
a4517 3
	* generic/tclNamesp.c:
	* tests/info.test: [Bug 545325] info level didn't report
	namespace eval, bug report by Richard Suchenwirth.
d4519 1
a4519 1
2002-04-18  Don Porter  <dgp@@users.sourceforge.net>
d4521 10
a4530 3
	* doc/subst.n:  Clarified documentation on handling unusual return
	codes during substitution, and on variable substitutions implied
	by command substitution, and vice versa.  [Bug 536838]
d4532 1
a4532 1
2002-04-18  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4534 3
a4536 3
	* generic/tclCmdIL.c (InfoBodyCmd): 
	* tests/info.test (info-2.6): Proc bodies without string reps
	would report as empty [Bug #545644]
d4538 3
a4540 4
	* generic/tclCmdMZ.c (Tcl_SubstObj): More clarification for
	comment on behaviour when substitutions are not well-formed,
	prompted by [Bug #536831]; alas, removing the ill-defined
	behaviour is a lot of work.
d4542 5
a4546 1
2002-04-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d4548 7
a4554 4
	* generic/tclExecute.c:
	* tests/expr-old.test: fix for [Bug #542588] (Phil Ehrens), where
	"too large integers" were reported as "floating-point value" in
	[expr] error messages.
d4556 1
a4556 1
2002-04-17  Jeff Hobbs  <jeffh@@ActiveState.com>
d4558 3
a4560 4
	* generic/tclEncoding.c (EscapeFromUtfProc): 
	* generic/tclIO.c (WriteChars, Tcl_Close): corrected the handling
	of outputting end escapes for escape-based encodings.
	[Bug #526524] (yamamoto)
d4562 3
a4564 1
2002-04-17  Don Porter  <dgp@@users.sourceforge.net>
d4566 1
a4566 4
	* doc/tcltest.n:  Removed [saveState] and [restoreState] from
	tcltest 2 documentation, effectively deprecating them.  [Bug 495660]
	* library/tcltest/tcltest.tcl: Made separate export for commands
	kept only for tcltest 1 compatibility.
d4568 2
a4569 3
	* tests/iogt.test: Revised to run tests in a namespace, rather than
	use the useless and buggy [saveState] and [restoreState] commands
	of tcltest.  Updated to use tcltest 2 as well.  [Patch 544911]
d4571 4
a4574 1
2002-04-16  Don Porter  <dgp@@users.sourceforge.net>
d4576 1
a4576 3
	* tests/io.test: Revised to run tests in a namespace, rather than
	use the useless and buggy [saveState] and [restoreState] commands
	of tcltest.  Updated to use tcltest 2 as well.  [Patch 544546]
d4578 3
a4580 1
2002-04-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d4582 1
a4582 4
	* generic/tclProc.c:
	* tests/proc-old.test: Improved stack trace for TCL_BREAK and
	TCL_CONTINUE returns from procs. Patch by Don Porter
	[Bug 536955]. 
d4584 25
a4608 4
	* generic/tclExecute.c:
	* tests/compile.test: made bytecodes check for a catch before
	  returning; the compiled [return] is otherwise non-catchable. 
	  [Bug 542142] reported by Andreas Kupries.
d4610 1
a4610 1
2002-04-15  Don Porter  <dgp@@users.sourceforge.net>
d4612 1
a4612 2
	* tests/socket.test:  Increased timeout values so that tests have
	time to successfully complete even on slow/busy machines.  [Bug 523470]
d4614 3
a4616 41
	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test:  Revised [tcltest::test] to return errors
	when called with invalid syntax and to accept exactly two arguments
	as documented.  Improved error messages.  [Bug 497446, Patch 513983]
	***POTENTIAL INCOMPATIBILITY***: Incompatible with previous
	tcltest 2.* releases, found only in alpha releases of Tcl 8.4.

2002-04-11  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclNotify.c (TclFinalizeNotifier): remove remaining
	unserviced events on finalization.

	* win/tcl.m4: Enabled COFF as well as CV style debug info with
	--enable-symbols to allow Dr. Watson users to see function info.
	More info on debugging levels can be obtained at:
	http://msdn.microsoft.com/library/en-us/dnvc60/html/gendepdebug.asp

	* tests/ioCmd.test: fixed iocmd-8.15 to have mac and unixPc variants.

	* generic/tclParse.c (Tcl_ParseVar): conditionally incr obj
	refcount to prevent possible mem leak.

2002-04-08  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tcl.h: no <sys/types.h> on mac.
	* mac/tclMacFile.c: minor fixes to Vince's changes from 03-24.
	* mac/tclMacOSA.c:
	* mac/tclMacResource.c: added missing Tcl_UtfToExternalDString
	conversions of resource file names.
	* mac/tclMacSock.c (TcpGetOptionProc): fixed bug introduced
	by Andreas on 02-25; changed strcmp's to strncmp's so that
	option comparison behaves like on other platforms.
	* mac/tcltkMacBuildSupport.sea.hqx (CW Pro6 changes): added
	support to allow Tk to hookup C library stderr/stdout to TkConsole.
	* tests/basic.test:
	* tests/cmdAH.test:
	* tests/encoding.test:
	* tests/fileSystem.test:
	* tests/ioCmd.test: fixed tests failing on mac: check for 
	existence of [exec], changed some result strings.
d4618 1
a4618 1
2002-04-06  Jeff Hobbs  <jeffh@@ActiveState.com>
d4620 2
a4621 5
	* unix/tclUnixFCmd.c (Realpath): added a little extra code to
	initialize a realpath arg when compiling in PURIFY mode in order
	to prevent spurious purify warnings.  We should really create our
	own realpath implementation, but this will at least quiet purify
	for now.
d4623 1
a4623 1
2002-04-05  Don Porter  <dgp@@users.sourceforge.net>
d4625 3
a4627 5
	* generic/tclCmdMZ.c (Tcl_SubstObj):
	* tests/subst.test:  Corrected [subst] so that return codes
	TCL_BREAK and TCL_CONTINUE returned by variable substitution
	have the same effect as when those codes are returned by command
	substitution.  [Bug 536879]
d4629 1
a4629 1
2002-04-03  Jeff Hobbs  <jeffh@@ActiveState.com>
d4631 1
a4631 2
	* library/tcltest/tcltest.tcl: added getMatchingFiles back (alias
	to GetMatchingFiles), which was a public function in tcltest 1.0.
d4633 1
a4633 1
2002-04-01  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4635 2
a4636 48
	* generic/tclEnv.c:
	* generic/tclIOUtil.c: invalidate filesystem cache when the
	user changes env(HOME).  Fixes [Bug #535621].  Also cleaned up
	some of the documentation.
	* tests/fileSystem.test: added test for bug just fixed.
	
2002-04-01  Kevin Kenny  <kennykb@@acm.org>

	* win/tclWinTime.c (Tcl_GetTime): made the checks of clock
	frequency more permissive to cope with the fact that Win98SE
	is observed to return 1.19318 in place of 1.193182 for the
	performance counter frequency.
	
2002-03-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclCmdMZ.c (Tcl_TraceObjCmd, TraceVarProc)
	(TraceCommandProc, TclTraceCommandObjCmd):  corrected
	potential double-free of traces on variables by flagging in
	Trace*Proc that it will free the var in case the eval wants to
	delete the var trace as well. [Bug #536937]
	Also converted Tcl_UntraceVar -> Tcl_UntraceVar2 and Tcl_Eval to
	Tcl_EvalEx in Trace*Proc for slight efficiency improvement.

2002-03-29  Don Porter  <dgp@@users.sourceforge.net>

	* doc/AllowExc.3:
	* generic/tclBasic.c (Tcl_EvalObjv,Tcl_EvalEx,Tcl_EvalObjEx):
	* generic/tclCompile.h (TclCompEvalObj):
	* generic/tclExecute.c (TclCompEvalObj,TclExecuteByteCode):
	* tests/basic.test: Corrected problems with Tcl_AllowExceptions
	having influence over the wrong scope of Tcl_*Eval* calls.  Patch
	from Miguel Sofer.  Report from Jean-Claude Wippler.  [Bug 219181]

2002-03-28  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclVar.c: Refactored CallTraces to collect repeated
	handling of its returned value into CallTraces itself.

2002-03-28  David Gravereaux <davygrvy@@pobox.com>

	* tools/feather.bmp:
	* tools/man2help.tcl:
	* tools/man2help2.tcl:
	* win/makefile.vc: More winhelp target fixups.  Added a feather
	bitmap to the non-scrollable area and changed the color to be
	yellow from a plain white.  The colors can be whatever we want
	them to be, but thought I would start with something bold.
	[Bug 527941]
d4638 4
a4641 3
	* doc/SetVar.3:
	* doc/TraceVar.3:
	* doc/UpVar.3:  .AP macro syntax repair.
d4643 1
a4643 1
2002-03-27  David Gravereaux <davygrvy@@pobox.com>
d4645 2
a4646 25
	* tools/man2help.tcl:
	* win/makefile.vc:  winhelp target now copies all needed files
	from tools/ to a workarea under $(OUT_DIR) and builds it from
	there.  No build cruft is left in tools/ anymore.  All paths
	used in man2help.tcl are now relative to where the script is.
	[Bug 527941]

2002-03-27  David Gravereaux <davygrvy@@pobox.com>

	* win/.cvsignore:
	* win/buildall.vc.bat:
	* win/coffbase.txt:
	* win/makefile.vc:
	* win/nmakehlp.c (new):
	* win/rules.vc:  First draft fix for [Bug 527941].  More changes
	need to done to the makehelp target to get to stop leaving build
	files in the tools/ directory.  This does not address the syntax
	errors in the man files.  Having the contents of tcl.hpj(.in)
	inside makefile.vc allows for version numbers to be replaced with
	macros.
	
	The new nmakehlp.c is built by rules.vc in preprocessing and removes
	the need to use tricky shell syntax that wasn't compatible on Win9x
	systems.  Clean targets made Win9x complient.  This is a first draft
	repair for [Bug 533862].
d4648 1
a4648 1
2002-03-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d4650 4
a4653 2
	* generic/tclBasic.c (Tcl_EvalEx): passing the correct commandSize
	to TclEvalObjvInternal. [Bug 219362], fix by David Knoll.
d4655 1
a4655 1
2002-03-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d4657 4
a4660 3
	* generic/tclBasic.c (Tcl_EvalEx):
	* tests/basic.test: avoid exceptional returns at level 0 
	[Bug 219181] 
d4662 2
a4663 1
2002-03-27  Don Porter  <dgp@@users.sourceforge.net>
d4665 1
a4665 5
	* doc/tcltest.n ([mainThread]):
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test:  Major code cleanup to deal with whitespace,
	coding conventions, and namespace issues, with several minor bugs
	fixed in the process.
d4667 2
a4668 1
	* tests/main.test: Added missing [after cancel]s.
d4670 2
a4671 1
2002-03-25  Don Porter  <dgp@@users.sourceforge.net>
d4673 1
a4673 1
	* tests/main.test: Removed workarounds for Bug 495977.
d4675 2
a4676 8
	* library/tcltest/tcltest.tcl:  Keep the value of $::auto_path
	unchanged, so that the tcltest package can test code that depends
	on auto-loading.  If a testing application needs $::auto_path pruned,
	it should do that itself.  [Bug 495726]
	Improve the processing of the -constraints option to [test] so that
	constraint lists can have arbitrary whitespace, and non-lists don't
	blow things up.  [Bug 495977]
	Corrected faulty variable initialization. [Bug 534845]
d4678 7
a4684 1
2002-03-25  Miguel Sofer  <msofer@@users.sourceforge.net>
d4686 1
a4686 3
	* doc/CrtTrace.3: small doc correction
	* generic/tclBasic.c (Tcl_DeleteTrace): Allow NULL callback on
	trace deletions [Bug 534728] (Hemang Lavana).
d4688 2
a4689 1
2002-03-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d4691 2
a4692 2
	* generic/tclBasic.c (Tcl_EvalObjv): replaced obscure, incorrect
	code as described in [Bug 533907] (Don Porter).
d4694 1
a4694 1
2002-03-24  Don Porter  <dgp@@users.sourceforge.net>
d4696 3
a4698 2
	* library/tcltest/tcltest.tcl:  Use [interpreter] to set/query the
	executable currently running the tcltest package.  [Bug 454050]
d4700 2
a4701 2
	* library/tcltest/tcltest.tcl:  Allow non-proc commands to be used
	as the customization hooks.  [Bug 495662]
d4703 2
a4704 1
2002-03-24  Vince Darley  <vincentdarley@@users.sourceforge.net>
d4706 1
a4706 53
	* generic/tclFilename.c:
	* generic/tclFCmd.c:
	* generic/tclTest.c:
	* generic/tcl.h:
	* generic/tclIOUtil.c:
	* win/tclWinFile.c:
	* win/tclWinFCmd.c:
	* win/tclWinPipe.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixFCmd.c:
	* mac/tclMacFile.c:
	* doc/FileSystem.3:
	* doc/file.n:
	* tests/cmdAH.test:
	* tests/fileName.test:
	* tests/fileSystem.test: (new file)	
	* tests/winFCmd.test: fix [Bug 511666] and [Bug 511658],
	and improved documentation of some aspects of the filesystem,
	particularly 'Tcl_FSMatchInDirectory' which now might match
	a single file/directory only, and 'file normalize' which
	wasn't very clear before.  Removed inconsistency betweens
	docs and the Tcl_Filesystem structure.  Also fixed 
	[Bug 523217] and corrected file normalization on Unix so that 
	it expands symbolic links.  Added some new tests of the 
	filesystem code (in the new file 'fileSystem.test'), and 
	some extra tests for correct handling of symbolic links.
	Fix to [Bug 530960] which shows up on Win98.  Made comparison
	with ".com" case insensitive in tclWinPipe.c
	
	***POTENTIAL INCOMPATIBILITY***: But only between alpha
	releases (users of the new Tcl_Filesystem lookup table in Tcl
	8.4a4 need to handle the new way in which Tcl may call
	Tcl_FSMatchInDirectory, and 'file normalize' on unix now
	behaves correctly).  Only known impact is with the 'tclvfs'
	extension.

2002-03-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/basic.test (basic-46.1): adding test for [Bug 533758],
	fixed earlier today.
	
2002-03-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinInt.h: moved undef of TCL_STORAGE_CLASS. [Bug #478579]

2002-03-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_EvalObjEx):
	* generic/tclExecute.c (TclCompEvalObj): fixed the errorInfo for
	return codes other than (TCL_OK, TCL_ERROR) to runLevel 0 
	[Bug 533758]. Removed the static RecordTracebackInfo(), as its
	functionality is easily replicated by Tcl_LogCommandInfo. Bug
	and redundancy noted by Don Porter.
d4708 2
a4709 1
2002-03-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4711 5
a4715 1
	* doc/expr.n: Improved documentation for ceil and floor [Bug 530535]
d4717 1
a4717 1
2002-03-20  Don Porter  <dgp@@users.sourceforge.net>
d4719 24
a4742 21
	* doc/SetVar.3:
	* doc/TraceVar.3:
	* doc/UpVar.3:
	* generic/tcl.h (Tcl_VarTraceProc):
	* generic/tcl.decls (Tcl_GetVar2, Tcl_SetVar2, Tcl_TraceVar2,
	  Tcl_UnsetVar2, Tcl_UntraceVar2, Tcl_UpVar2, Tcl_VarTraceInfo2,
	  Tcl_GetVar2Ex, TclSetVar2Ex):
	* generic/tclCmdMZ.c (TraceVarProc):
	* generic/tclEnv.c (EnvTraceProc):
	* generic/tclEvent.c (VwaitVarProc):
	* generic/tclInt.decls (TclLookupVar,TclPrecTraceProc):
	* generic/tclLink.c (LinkTraceProc):
	* generic/tclUtil.c (TclPrecTraceProc):
	* generic/tclVar.c (CallTraces, MakeUpvar, VarErrMsg, TclLookupVar,
	  Tcl_GetVar2, Tcl_SetVar2, Tcl_TraceVar2, Tcl_UnsetVar2,
	  Tcl_UntraceVar2, Tcl_UpVar2, Tcl_VarTraceInfo2, Tcl_GetVar2Ex,
	  TclSetVar2Ex): Updated interfaces of generic/tclVar.c according
	to TIP 27.  In particular, the "part2" arguments were CONSTified.
	[Patch 532642]
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs
d4744 3
a4746 1
2002-03-15  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4748 1
a4748 3
	* tests/compile.test (compile-12.3): Test to detect bug 530320.
	* generic/tclCompile.c (TclCompileTokens): Fixed buffer overrun
	reported in bug 530320.
d4750 2
a4751 1
2002-03-14  Mo DeJong  <mdejong@@users.sourceforge.net>
d4753 2
a4754 12
	* win/configure: Regen.
	* win/configure.in: Add configure time test for SEH
	support in the compiler.
	* win/tclWin32Dll.c (ESP, EBP, TclpCheckStackSpace,
	_except_checkstackspace_handler):
	* win/tclWinChan.c (ESP, EBP, Tcl_MakeFileChannel,
	_except_makefilechannel_handler):
	* win/tclWinFCmd.c (ESP, EBP, DoRenameFile,
	_except_dorenamefile_handler,
	DoCopyFile, _except_docopyfile_handler):
	Implement SEH support under gcc using inline asm.
	Tcl and Tk should now compile with Mingw 1.1. [Patch 525746]
d4756 1
a4756 1
2002-03-14  Mo DeJong  <mdejong@@users.sourceforge.net>
d4758 2
a4759 6
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile): Handle
	an SEH exception with EXCEPTION_EXECUTE_HANDLER instead
	of restarting the faulting instruction with
	EXCEPTION_CONTINUE_EXECUTION. Bug 466102 provides an
	example of how restarting could send Tcl into an
	infinite loop. [Patch 525746]
d4761 1
a4761 1
2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d4763 3
a4765 4
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile, DoDeleteFile,
	DoRemoveJustDirectory): Make sure we don't pass NULL or ""
	as a path name to Win32 API functions since this was
	crashing under Windows 98.
d4767 2
a4768 1
2002-03-11  Don Porter  <dgp@@users.sourceforge.net>
d4770 1
a4770 2
	* library/tcltest/tcltest.tcl:
	* library/tcltest/pkgIndex.tcl: Bumped tcltest package to 2.0.2.
d4772 3
a4774 1
2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d4776 1
a4776 3
	* library/tcltest/tcltest.tcl (getMatchingFiles): Pass
	a proper list to foreach to avoid munging a Windows
	patch like D:\Foo\Bar into D:FooBar before the glob.
d4778 7
a4784 1
2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d4786 1
a4786 6
	* generic/tclEncoding.c: Fix typo in comment.
	* generic/tclIO.c (DoReadChars, ReadBytes, ReadChars):
	Use NULL value instead of pointer set to NULL to make
	things more clear. Reorder arguments so that they
	match the function signatures. Cleanup little typos
	and add more descriptive comment.
d4788 6
a4793 1
2002-03-08  Mo DeJong  <mdejong@@users.sourceforge.net>
d4795 1
a4795 4
	* win/README: Update to indicate that Mingw 1.1 is
	required to build Tcl. Add section describing new
	msys based build process. Update Cygwin build
	instructions so users know where to find Mingw 1.1.
d4797 1
a4797 1
2002-03-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d4799 8
a4806 1
	* win/tclWinFCmd.c (DoCopyFile): correctly set retval to TCL_OK.
d4808 1
a4808 1
2002-03-07  Mo DeJong  <mdejong@@users.sourceforge.net>
d4810 3
a4812 5
	* win/tclWin32Dll.c (TclpCheckStackSpace):
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile): Replace
	hard coded constants with Win32 symbolic names.
	Move control flow statements out of __try blocks
	since the documentation indicates it is frowned upon.
d4814 1
a4814 1
2002-03-07  Don Porter  <dgp@@users.sourceforge.net>
d4816 2
a4817 6
	* doc/interp.n:
	* generic/tclInterp.c(Tcl_InterpObjCmd,SlaveObjCmd,SlaveRecursionLimit):
	* generic/tclTest.c:
	* tests/interp.test: Added the [interp recursionlimit] command to
	set/query the recursion limit of an interpreter.  Proposal and
	implementation from Stephen Trier. [TIP 87, Patch 522849]
d4819 1
a4819 1
2002-03-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4821 1
a4821 5
	* generic/tcl.h, tools/tcl.wse.in, unix/configure.in,
	* unix/tcl.spec, win/README.binary, win/configure.in, README:
	Bumped patchlevel; this might need to change in the future, but it
	will help us distinguish between the CVS version and the most
	recent released version.
d4823 2
a4824 1
2002-03-06  Miguel Sofer  <msofer@@users.sourceforge.net>
d4826 1
a4826 3
	* generic/tclInt.h: for unshared objects, TclDecrRefCount now
	frees the internal rep before the string rep - just like the
	non-macro Tcl_DecrRefCount/TclFreeObj [Bug 524802]. 
d4828 3
a4830 1
2002-03-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4832 1
a4832 4
	* doc/lsearch.n: Documentation of new features, plus examples.
	* tests/lsearch.test: Tests of new features.
	* generic/tclCmdIL.c (Tcl_LsearchObjCmd): TIP#80 support.  See
	http://purl.org/tcl/tip/80 for details.
d4834 2
a4835 1
2002-03-05  Jeff Hobbs  <jeffh@@ActiveState.com>
d4837 9
a4845 1
	*** 8.4a4 TAGGED FOR RELEASE ***
d4847 1
a4847 4
	* unix/tclUnixChan.c: initial remedy for [Bug #525783] flush
	problem introduced by TIP #35.  This may not satisfy true serial
	channels, but it restores the correct flushing of std* channels on
	exit.
d4849 9
a4857 1
	* unix/README: added --enable-langinfo doc.
d4859 1
a4859 2
	* unix/tcl.spec:
	* tools/tcl.wse.in: fixed URL refs to use www.tcl.tk or SF.
d4861 1
a4861 1
2002-03-04  Jeff Hobbs  <jeffh@@ActiveState.com>
d4863 1
a4863 6
	* README:
	* mac/README:
	* unix/Makefile.in:
	* unix/README:
	* win/README:
	* win/README.binary: updated to use www.tcl.tk URL.
d4865 3
a4867 1
	* unix/Makefile.in: added older ChangeLogs to dist target.
d4869 1
a4869 7
	* tests/io.test:
	* tests/encoding.test: corrected iso2022 encoding results.
	added encoding-24.*
	* generic/tclEncoding.c (EscapeFromUtfProc): corrected output of
	escape codes as per RFC 1468. [Patch #474358] (taguchi)
	(TclFinalizeEncodingSubsystem): corrected potential double-free
	when encodings were finalized on exit. [Bug #219314, #524674]
d4871 2
a4872 1
2002-03-01  Jeff Hobbs  <jeffh@@ActiveState.com>
d4874 1
a4874 5
	* library/encoding/iso2022-jp.enc: 
	* library/encoding/iso2022.enc: 
	* tools/encoding/iso2022-jp.esc:
	* tools/encoding/iso2022.esc: gave <ESC>$B precedence over <ESC>$@@,
	based on comments (point 1) in [Bug #219283] (rfc 1468)
d4876 16
a4891 5
	* tests/encoding.test: added encoding-23.* tests
	* generic/tclIO.c (FilterInputBytes): reset the TCL_ENCODING_START
	flags in the ChannelState when using 'gets'. [Bug #523988]
	Also reduced the value of ENCODING_LINESIZE from 30 to 20 as this
	seems to improve the performance of 'gets' according to tclbench.
d4893 1
a4893 1
2002-02-28  Jeff Hobbs  <jeffh@@ActiveState.com>
d4895 2
a4896 3
	* generic/tclCmdMZ.c (TraceCommandProc): ensure that TraceCommandInfo
	structure was also deleted when a command was deleted to prevent a
	mem leak.
d4898 1
a4898 2
	* generic/tclBasic.c (Tcl_CreateObjTrace): set tracePtr->flags
	correctly.
d4900 1
a4900 2
	* generic/tclTimer.c (TimerExitProc): remove remaining events in
	tls on thread exit.
d4902 1
a4902 1
2002-02-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d4904 3
a4906 3
	* generic/tclNamesp.c: allow cached fully-qualified namespace
	names to be usable from different namespaces within the same
	interpreter without forcing a new lookup [Patch 458872]. 
d4908 1
a4908 1
2002-02-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d4910 1
a4910 2
	* generic/tclExecute.c: Replaced a few direct stack accesses 
	with the POP_OBJECT() macro [Bug 507181] (Don Porter).
d4912 1
a4912 1
2002-02-27  Don Porter  <dgp@@users.sourceforge.net>
d4914 1
a4914 8
	* doc/GetIndex.3:
	* generic/tcl.decls (Tcl_GetIndexFromObjStruct):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObjStruct):  Revised the
	prototype of the Tcl_GetIndexFromObjStruct to take its struct
	table as a (CONST VOID *) argument, better describing what it is,
	maintaining source compatibility, and adding CONST correctness
	according to TIP 27.  Thanks to Joe English for an elegant
	solution. [Bug 520304]
d4916 1
a4916 1
	* generic/tclDecls.h: make genstubs
d4918 1
a4918 3
	* generic/tclMain.c (Tcl_Main,StdinProc):  Corrected some reference
	count management errors on the interactive command Tcl_Obj found by
	Purify.  Thanks to Jeff Hobbs for the report and assistance.
d4920 1
a4920 1
2002-02-27  Jeff Hobbs  <jeffh@@ActiveState.com>
d4922 3
a4924 2
	* generic/tclBasic.c (Tcl_EvalTokensStandard): corrected mem leak
	in error case.
d4926 1
a4926 1
	* generic/tclTest.c (TestStatProc[123]): correct harmless UMRs.
d4928 2
a4929 1
	* generic/tclLink.c (Tcl_LinkVar): correct mem leak in error case.
d4931 1
a4931 1
2002-02-27  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d4933 2
a4934 3
	* tests/socket.test (2.7): Accepted and applied patch for Tcl SF
	  bug #523470 provided by Don Porter <dgp@@users.sourceforge.net>
	  to avoid timing problems in that test.
d4936 1
a4936 8
	* unix/tclUnixChan.c (TclpOpenFileChannel): Added code to regonize
	  "/dev/tty" (by name) and to not handle it as tty / serial
	  line. This is the controlling terminal and is special. Setting
	  it into raw mode as is done for other tty's is a bad idea. This
	  is a hackish fix for expect SGF Bug #520624. The fix has
	  limitation: Tcl_MakeFileChannel handles tty's specially too, but
	  is unable to recognize /dev/tty as it only gets a file
	  descriptor, and no name for it.
d4938 1
a4938 1
2002-02-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d4940 1
a4940 1
	* generic/tclCmdAH.c (StoreStatData): corrected mem leak.
d4942 2
a4943 2
	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): prevent obj leak in
	  remedial regsub case.
d4945 1
a4945 2
	* generic/tclFileName.c (Tcl_TranslateFileName): decr refcount for
	  error case to prevent mem leak.
d4947 1
a4947 1
	* generic/tclVar.c (Tcl_ArrayObjCmd): removed extra obj allocation.
d4949 2
a4950 3
	* unix/tclUnixSock.c (Tcl_GetHostName): added an extra
	  gethostbyname check to guard against failure with truncated
	  names returned by uname.
d4952 1
a4952 3
	* unix/configure:
	* unix/tcl.m4 (SC_SERIAL_PORT): added sys/modem.h check and defined
	  _XOPEN_SOURCE_EXTENDED for HP-11 to get updated header decls.
d4954 2
a4955 2
	* unix/tclUnixChan.c: added Unix implementation of TIP #35, serial
	  port support. [Patch #438509] (schroedter)
d4957 1
a4957 1
2002-02-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d4959 3
a4961 4
	* generic/tclCmpCmds.c: (bugfix to the bugfix, hopefully the last)
	  Bugfix to the new [for] compiling code: was setting a
	  exceptArray parameter using another param which wasn't yet
	  initialised, thus filling it with noise.
d4963 1
a4963 1
2002-02-25  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d4965 2
a4966 3
	* mac/tclMacSock.c (TcpGetOptionProc): Changed to recognize the
	  option "-error". Essentially ignores the option, always
	  returning an empty string.
d4968 1
a4968 1
2002-02-25  Jeff Hobbs  <jeffh@@ActiveState.com>
d4970 2
a4971 8
	* doc/Alloc.3:
	* doc/LinkVar.3:
	* doc/ObjectType.3:
	* doc/PkgRequire.3:
	* doc/Preserve.3:
	* doc/TCL_MEM_DEBUG.3: Updated documentation to describe the ckalloc,
	ckfree, ckrealloc, attemptckalloc, and attemptckrealloc macros, and
	to accurately describe when and how they are used. [Bug #497459] (dgp)
d4973 1
a4973 6
	* generic/tclHash.c (AllocArrayEntry, AllocStringEntry):
	Before invoking ckalloc when creating a Tcl_HashEntry,
	check that the amount of memory being allocated is
	at least as large as sizeof(Tcl_HashEntry). The previous
	code was allocating memory regions that were one
	or two bytes short. [Bug #521950] (dejong)
d4975 1
a4975 1
2002-02-25  Miguel Sofer  <msofer@@users.sourceforge.net>
d4977 1
a4977 4
	* generic/tclBasic.c (Tcl_EvalEx): avoiding a buffer overrun
	reported by Joe English, and restoring tcl7.6 behaviour for
	[subst]: badly terminated nested scripts will raise an error
	and not be evaluated. [Bug #495207]
d4979 1
a4979 1
2002-02-25  Don Porter  <dgp@@users.sourceforge.net>
d4981 1
a4981 4
	* unix/tclUnixPort.h: corrected strtoll prototype mismatch on Tru64.
	* compat/strtod.c (strtod): simplified #includes
	* compat/strtol.c (strtol): gather result in a long before returning
	as a long: necessary on platforms where sizeof(int) != sizeof(long).
d4983 1
a4983 1
2002-02-25  Daniel Steffen  <das@@users.sourceforge.net>
d4985 1
a4985 2
	* unix/tclLoadDyld.c: updated to use Mac OS X 10.1 dyld APIs that
	have more libdl-like semantics. (bug #514392)
d4987 1
a4987 1
2002-02-25  Miguel Sofer  <msofer@@users.sourceforge.net>
d4989 1
a4989 9
	* generic/tclCompCmds: fixing a bug in patch dated 2002-02-22, in
	the code for [for] and [while]. Under certain conditions, for long
	bodies, the exception range parameters were badly computed. Tests
	forthcoming: I still can't reproduce the conditions in the
	testsuite (!), although the bug (with assorted segfault or panic!)
	can be triggered from the console or with the new parse.bench in  
	tclbench.
	
2002-02-25  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d4991 1
a4991 2
	* compat/strtoul.c, compat/strtol.c, compat/strtod.c: Added UCHAR,
	CONST and #includes to clean up GCC output.
d4993 1
a4993 1
2002-02-23  Don Porter  <dgp@@users.sourceforge.net>
d4995 2
a4996 5
	* compat/strtoull.c (strtoull):
	* compat/strtoll.c (strtoll):
	* compat/strtoul.c (strtoul): Fixed failure to handle leading
	sign symbols '+' and '-' and '0X' and raise overflow errors.
	[Bug 440916]  Also corrects prototype and errno problems.
d4998 1
a4998 1
2002-02-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d5000 2
a5001 4
	* configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Link with -n32
	instead of -32 when building on IRIX64-6.* system.
	[Tcl bug 521707]
d5003 3
a5005 1
2002-02-22  Don Porter <dgp@@users.sourceforge.net>
d5007 1
a5007 5
	* generic/tclInt.h:
	* generic/tclObj.c: renamed global variable emptyString ->
	tclEmptyString because it is no longer static.
	* generic/tclPkg.c: Fix for panic when library is loaded on a
	platform without backlinking without proper use of stubs. [Bug 476537]
d5009 3
a5011 1
2002-02-22  Jeff Hobbs  <jeffh@@ActiveState.com>
d5013 1
a5013 2
	* tests/regexpComp.test: updated regexp-11.[1-4] to match changes
	in regexp.test for new regsub syntax
d5015 2
a5016 3
	* unix/configure:
	* unix/tcl.m4: added --enable-64bit support for AIX-4 (using -q64
	flag) when using IBM's xlc compiler.
d5018 1
a5018 58
	* tests/safe.test: updated safe-8.5 and safe-8.7
	* library/safe.tcl (CheckFileName): removed the limit on
	sourceable file names (was only *.tcl or tclIndex files with no
	more than one dot and 14 chars).  There is enough internal
	protection in a safe interpreter already.  Fixes [Tk Bug #521560].

2002-02-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompCmds: [FR 465811]. Optimising [if], [for] and
	[while] for constant conditions; in addition, [for] and [while]
	are now compiled with the "loop rotation" optimisation (thanks to
	Kevin Kenny). 

2002-02-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	--- TIP#76 CHANGES ---
	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): Final-argument-less
	[regsub] returns the modified string.
	* doc/regsub.n: Updated docs.
	* tests/regexp.test: Updated and added tests.

	* compat/strtoll.c (strtoll): 
	* compat/strtoull.c (strtoull): 
	* unix/tclUnixPort.h:
	* win/tclWinPort.h: Const-ing 64-bit compatability declarations.
	Note that the return pointer is non-const because it is entirely
	legal for the functions to be called from somewhere that owns the
	string being passed.  Fixes problem reported by Larry Virden.

2002-02-21  David Gravereaux <davygrvy@@pobox.com>

	* win/mkd.bat (removed):
	* win/coffbase.txt (new):
	* win/makefile.bc:
	* win/makefile.vc:  Changed the 'setup' target to stop using
	the mkd.bat file and just make the directory right in the rule.
	Same change to makefile.bc.  configure.in nor Makefile.in use
	it.

	coffbase.txt will be the master list for our "prefered base
	addresses" set by the linker.  This should improve load-time
	(NT only) by avoiding relocations.  Submissions to the list
	by extension authors are encouraged.

	Added a 'tidy' target to compliment 'clean' and 'hose' to remove
	just the outputs. Also removed the $(winlibs) macro as it wasn't
	being used.

	Stuff left to do:
	1) get the winhelp target to stop building in the tools/
	directory.
	2) stop using rmd.bat
	3) add more dependacy rules.

	* win/tclAppInit.c:  Reverted back to -r1.6, as the header file
	change to tclPort.h won't allow for easy embedded support
	outside of the source dist.  Thanks to Don Porter for pointing
	this out to me.
d5020 1
a5020 1
2002-02-21  David Gravereaux <davygrvy@@pobox.com>
d5022 1
a5022 4
	* win/makefile.vc:
	* win/rules.vc:  Added a new "loimpact" option that sets the
	-ws:aggressive linker option.  Off by default.  It's said to
	keep the heap use low at the expense of alloc speed.
d5024 1
a5024 5
	* win/tclAppInit.c: Changed #include "tcl.h" to be tclPort.h to
	remove the raw windows.h include.  tclPort.h brings in windows.h
	already and lessens the pre-compiled-header mush and the randomly
	useless	#pragma comment (lib,...) references throughout the big
	windows.h tree (as observed at high linker warning levels).
d5026 2
a5027 1
2002-02-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5029 1
a5029 2
	* generic/tcl.h: Better guessing of LP64/ILP32 architecture, but
	now sensitive to presence of (suitable) <limits.h>
d5031 1
a5031 1
2002-02-20  Don Porter <dgp@@users.sourceforge.net>
d5033 1
a5033 5
	* generic/tcl.decls (Tcl_RegExpRange,Tcl_GetIndexFromObjStruct):
	Overlooked a few source incompatibilities.  Now using CONST84.
	* generic/tclDecls.h: make genstubs
	* generic/tcl.h (Tcl_CmdObjTraceProc): silence warning from Sun
	Workshop compiler.
d5035 1
a5035 1
2002-02-20  David Gravereaux <davygrvy@@pobox.com>
d5037 1
a5037 12
	* win/buildall.vc.bat:
	* win/makefile.vc:
	* win/rules.vc: General clean-ups.  Added compiler and linker tests
	for a) the pentium 0x0F errata, b) optimizing (not all have this),
	and c) linker v6 section alignment confusion.  All these are tested
	first to make sure any D4002 or LNK1117 warnings aren't displayed.
	The pentium 0x0F errata is a recommended switch.  The v5 linker's
	section alignment default is 512, but the v6 linker was changed
	to 4096 in an attempt to speed loading on Win98.  I changed the
	default to always be 512 across both linkers, unless linking
	statically, then 4096 is used for the claimed speed effect. Using
	a 512 alignment saves 12k bytes of dead space in the DLL.
d5039 3
a5041 1
	Added IA64 B-stepping errata switch when the compiler supports it.
d5043 1
a5043 2
	Added profiling to $(lflags) when requested and also removed the
	explict -entry option as the default works fine as is.
d5045 2
a5046 3
	Removed win/tclWinInit.c from the special case section to let it
	use the common implicit rule as the $(EXTFLAGS) macro it had was
	never referenced anywhere.
d5048 3
a5050 1
2002-02-20  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5052 1
a5052 3
	* generic/tcl.h: Added code to guess the correct settings for
	TCL_WIDE_INT_IS_LONG and TCL_WIDE_INT_TYPE when configure doesn't
	tell us them, as can happen with extensions.
d5054 7
a5060 1
2002-02-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5062 1
a5062 5
	* doc/format.n: Updated docs to list the specification.
	* generic/tclCmdAH.c (Tcl_FormatObjCmd): Made behaviour on 64-bit
	platforms correctly meet the specification, that %d works with the
	native word-sized integer, instead of trying to guess (wrongly)
	from the value being passed.
d5064 2
a5065 1
2002-02-19  Don Porter <dgp@@users.sourceforge.net>
d5067 1
a5067 1
	* changes: First draft of updated changes for 8.4a4 release.
d5069 2
a5070 1
2002-02-15  Jeff Hobbs  <jeffh@@ActiveState.com>
d5072 1
a5072 2
	* unix/tclUnixPort.h: add strtoll/strtoull declarations for
	platforms that do not define them.
d5074 2
a5075 2
	* generic/tclIndexObj.c (STRING_AT): removed ptrdiff_t cast and
	use of VOID* in default case (GNU-ism).
d5077 1
a5077 1
2002-02-15  Kevin Kenny  <kennykb@@acm.org>
d5079 2
a5080 109
	* compat/strtoll.c:
	* compat/strtoul.c:
	* compat/strtoull.c:
	* generic/tclIOUtil.c:
	* generic/tclPosixStr.c:
	* generic/tclTest.c:
	* generic/tclTestObj.c:
	* tests/get.test:
	* win/Makefile.vc: Further tweaks to the TIP 72 patch to make it
	compile under VC++.
	
2002-02-15  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tclExecute.c:
	* tclIOGT.c:
	* tclIndexObj.c: Touchups to the TIP 72 patch to make it
	  compileable under Windows again. The changes are not complete,
	  there is one nasty regarding _stati64

2002-02-15  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	+----------------------+
	| TIP #72 IMPLEMENTED. |
	+----------------------+

	There are a lot of changes from this TIP, so please see
	http://purl.org/tcl/tip/72.html for discussion of
	backward-compatability issues, but the main ones modifications are
	in:

	* generic/tcl.h: New types.
	* generic/tcl.decls: New public functions.
	* generic/tclExecute.c: 64-bit aware bytecode engine.
	* generic/tclBinary.c: 64-bit handling in [binary] command.
	* generic/tclScan.c: 64-bit handling in [scan] command.
	* generic/tclCmdAH.c: 64-bit handling in [file] and [format]
	commands.
	* generic/tclBasic.c: New "wordSize" entry in ::tcl_platform.
	* generic/tclFCmd.c: Large-file support (with many consequences.)
	* generic/tclIO.c: Large-file support (with many consequences.)
	* compat/strtoll.c, compat/strtoull.c: New support functions.
	* unix/tcl.m4, unix/configure: 64-bit support and greatly enhanced
	cacheing.

	Most other changes, including all those in doc/* and test/* as
	well as the majority in the platform directories, follow on from
	these.

	Also coming out of the woodwork:
	* generic/tclIndex.c: Better support for Cray PVP.
	* win/tclWinMtherr.c: Better Borland support.

	Note that, in a number of places through the Unix part of the
	platform support, there are Tcl_Platform* references.  These are
	expanded into the correct way to call that particular underlying
	function, i.e. with or without a '64' suffix, and should be used
	by people working on the core in preference to the API functions
	they overlay so that the code remains portable depending on the
	presence or absence of 64-bit support on the underlying platform.

	***POTENTIAL INCOMPATIBILITY***: Extracted from the TIP

	SUMMARY OF INCOMPATIBILITIES AND FIXES 
	======================================

	The behaviour of expressions containing constants that appear
	positive but which have a negative internal representation will
	change, as these will now usually be interpreted as wide
	integers. This is always fixable by replacing the constant with
	int(constant).

	Extensions creating new channel types will need to be altered as
	different types are now in use in those areas. The change to the
	declaration of Tcl_FSStat and Tcl_FSLstat (which are the new
	preferred API in any case) are less serious as no non-alpha
	releases have been made yet with those API functions.

	Scripts that are lax about the use of the l modifier in format and
	scan will probably need to be rewritten. This should be very
	uncommon though as previously it had absolutely no effect.

	Extensions that create new math functions that take more than one
	argument will need to be recompiled (the size of Tcl_Value
	changes), and functions that accept arguments of any type
	(TCL_EITHER) will need to be rewritten to handle wide integer
	values. (I do not expect this to affect many extensions at all.)

2002-02-14  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIOCmd.c (Tcl_GetsObjCmd): Trivial fix for bug
	  #517503, a memory leak reported by Miguel Sofer
	  <msofer@@users.sourceforge.net>. The leak happens if an error
	  occurs for "set var [gets $chan]" and leak one empty object.

2002-02-12  David Gravereaux <davygrvy@@pobox.com>

	* djgpp/ (new directory)
	* djgpp/Makefile (new):
	* unix/tclAppInit.c:
	* unix/tclMtherr.c:
	* unix/tclUnixFCmd.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixInit.c:
	* unix/tclUnixPort.h:  Early stage of DJGPP support for building
	Tcl on DOS.  Dynamic loading isn't working, yet.  Requires watt32
	for the TCP/IP stack.  No autoconf, yet.  Barely tested, but
	makes a working exe that runs Tcl in protected-mode, flat memory.
	[exec] and pipes will need the most work as multi-tasking on DOS
	has to be carefully.
d5082 1
a5082 1
2002-02-10  Kevin Kenny  <kennykb@@acm.org>
d5084 1
a5084 10
	* doc/CrtObjCmd.3:
	* doc/CrtTrace.3:
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclBasic.c:
	* generic/tclInt.h:
	* generic/tclTest.c:
	* tests/basic.test: Added Tcl_CreateObjTrace,
	Tcl_GetCommandInfoFromToken and Tcl_SetCommandInfoFromToken.
	(TIPs #32 and #79.)
d5086 1
a5086 4
	* generic/tclDecls.h:
	* generic/tclStubInit.c: Regenerated Stubs tables.
	
2002-02-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d5088 6
a5093 8
	* unix/configure:
	* unix/tcl.m4: added -pthread for FreeBSD to EXTRA_CFLAGS and
	LDFLAGS.  Also triggered nodots only for FreeBSD-3.
	Added AC_DEFINE(_POSIX_PTHREAD_SEMANTICS) for Solaris.

	* unix/tclUnixPort.h:
	* unix/tclUnixThrd.c: added thread-safe versions of readdir,
	localtime, gmtime and inet_ntoa for threaded build. (jgdavidson)
d5095 1
a5095 2
	* generic/tclScan.c (Tcl_ScanObjCmd): prevented ckfree being
	called on a pointer to NULL.
d5097 1
a5097 1
2002-02-07  Don Porter <dgp@@users.sourceforge.net>
d5099 1
a5099 30
	* doc/DString.3:
	* doc/Encoding.3:
	* doc/GetCwd.3:
	* doc/SplitPath.3:
	* doc/Translate.3:
	* doc/Utf.3:
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclEncoding.c:
	* generic/tclEnv.c:
	* generic/tclFileName.c:
	* generic/tclIOUtil.c:
	* generic/tclUtf.c:
	* generic/tclUtil.c:
	* mac/tclMacInit.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixInit.c:
	* unix/tclUnixPipe.c:
	* win/tclWin32Dll.c:
	* win/tclWinFCmd.c:
	* win/tclWinFile.c:
	* win/tclWinInit.c: Partial TIP 27 rollback.  Following routines
	restored to return (char *): Tcl_DStringAppend,
	Tcl_DStringAppendElement, Tcl_JoinPath, Tcl_TranslateFileName,
	Tcl_ExternalToUtfDString, Tcl_UtfToExternalDString,
	Tcl_UniCharToUtfDString, Tcl_GetCwd, Tcl_WinTCharToUtf.  Also
	restored Tcl_WinUtfToTChar to return (TCHAR *) and 
	Tcl_UtfToUniCharDString to return (Tcl_UniChar *).  Modified
	some callers.  This change recognizes that Tcl_DStrings are
	de-facto white-box objects.
d5101 2
a5102 2
	* generic/tclDecls.h:
	* generic/tclPlatDecls.h: make genstubs
d5104 1
a5104 1
	* generic/tclCmdMZ.c: corrected use of C++-style comment.
d5106 2
a5107 1
2002-02-06  Jeff Hobbs  <jeffh@@ActiveState.com>
d5109 1
a5109 14
	* tests/scan.test:
	* generic/tclScan.c (Tcl_ScanObjCmd): corrected scan 0x... %x
	handling that didn't accept the 0x as a prelude to a base 16
	number.  [Bug #495213]

	* generic/tclCompCmds.c (TclCompileRegexpCmd): made early check
	for bad RE to stop checking further.

	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): added special case to
	search for simple 'string map' style regsub calls.
	Delayed creation of resultPtr object until an initial match is
	made, as the input string object can then be reused for no matches.
	(Tcl_StringObjCmd): optimization improvements to the STR_MAP
	algorithm for zero-length and nocase cases.
d5111 3
a5113 2
	* tests/regexp.test:
	* tests/regexpComp.test: extra code coverage tests.
d5115 1
a5115 1
	* tests/string.test: added 10.18 and 10.19 extra tests.
d5117 1
a5117 1
	* generic/regc_locale.c (casecmp): slight performance improvement.
d5119 1
a5119 1
2002-02-05  Don Porter <dgp@@users.sourceforge.net>
d5121 4
a5124 3
	* library/http/http.tcl:
	* library/http/pkgIndex.tcl:  Corrected use of http::error when
	::error was intended.  Bump to http 2.4.2.
d5126 1
a5126 1
2002-02-04  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5128 2
a5129 6
	* unix/tclUnixChan.c (FileOutputProc): Fixed [bug 465765] reported
	  by Dale Talcott <daletalcott@@users.sourceforge.net>. Avoid
	  writing nothing into a file as STREAM based implementations will
	  consider this a EOF (if the file is a pipe). Not done in the
	  generic layer as this type of writing is actually useful to
	  check the state of a socket.
d5131 3
a5133 3
	* doc/open.n: Fixed [Bug 511540], added cross-reference to 'pid'
	  as the command to use to retrieve the pid of a command pipeline
	  created via 'open'.
d5135 1
a5135 1
2002-02-01  Jeff Hobbs  <jeffh@@ActiveState.com>
d5137 2
a5138 2
	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): handle quirky about case
	earlier to avoid shimmering problem.
d5140 1
a5140 1
2002-02-01  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5142 2
a5143 3
	* tests/io.test: io-39.22 split into two tests, one platform
	  dependent, the other not. -eofchar is not empty on the windows
	  platform.
d5145 1
a5145 1
2002-02-01  Vince Darley <vincentdarley@@users.sourceforge.net>
d5147 4
a5150 2
	* generic/tclTest.c: fix to picky windows compiler problem
	  with the 'MainLoop' function declaration.
d5152 1
a5152 1
2002-01-31  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5154 2
a5155 2
	* win/tclWinFCmd.c: TIP 27: Applied patch fixing CONST warnings on
	  behalf of Don Porter <dgp@@users.sourceforge.net>.
d5157 1
a5157 1
2002-01-30  Don Porter <dgp@@users.sourceforge.net>
d5159 1
a5159 41
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclInt.h: For each interface identified in the TIP 27
	  changes below as a POTENTIAL INCOMPATIBILITY, the source of the
	  incompatibility has been parameterized so that it can be
	  removed.  When compiling extension code against the Tcl header
	  files, use the compiler flag -DUSE_NON_CONST to remove the
	  irresolvable source incompatibilities introduced by the TIP 27
	  changes.  Resolvable changes are left for extension authors to
	  resolve.
	* generic/tclDecls.h: make genstubs

2002-01-30  Vince Darley <vincentdarley@@users.sourceforge.net>

	* doc/FileSystem.3: added documentation for 3 public
	functions which had been overlooked.  Fixes [Bug 507701].
	* unix/mkLinks: make mklinks

2002-01-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/regexpComp.test:
	* generic/tclCompCmds.c (TclCompileRegexpCmd): enhanced to support
	-nocase and -- options.

2002-01-28  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tcl.m4 (SC_LOAD_TCLCONFIG):
	* win/tcl.m4 (SC_LOAD_TCLCONFIG): Set TCL_LIB_SPEC,
	TCL_STUB_LIB_SPEC, and TCL_STUB_LIB_PATH to the
	values of TCL_BUILD_LIB_SPEC, TCL_BUILD_STUB_LIB_SPEC,
	and TCL_BUILD_STUB_LIB_PATH when tclConfig.sh is loaded
	from the build directory. A Tcl extension should
	make use of the non-build versions of these variables
	since they will work in both cases. This modification
	was described in TIP 34.

2002-01-28  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinReg.c (regConnectRegistryProc,RecursiveDeleteKey)
	(DeleteKey,GetKeyNames,GetType,GetValue,OpenSubKey,SetValue):
	redid the CONSTification as previous changes caused failing tests.
d5161 1
a5161 11
	* tests/regexpComp.test (new):
	* generic/tclInt.h:
	* generic/tclBasic.c: added TclCompileRegexpCmd entry
	* generic/tclCompCmds.c (TclCompileStringCmd): corrected to return
	TCL_OUT_LINE_COMPILE instead of TCL_ERROR for parsing errors, so
	it only throws the error for runtime compile, in case the user
	modifies 'string'.
	(TclCompileRegexpCmd): first try at a byte-compiled regexp
	command.  It handles static strings and ^$ bounded static strings.
	(TclCompileAppendCmd): made TclPushVarName call always use
	TCL_CREATE_VAR as numWords is always > 2 at that point.
d5163 2
a5164 2
	* generic/tclExecute.c (TclExecuteByteCode:INST_LIST): correct
	possibly dangerous decr in macro call.
d5166 1
a5166 1
	* win/tclWinInit.c (TclpFindVariable): CONSTification touch-up
d5168 1
a5168 2
	* win/tclWinReg.c (OpenSubKey): corrected bug introduced in
	CONSTification that dropped pointer reference.
d5170 1
a5170 3
	* ChangeLog.2000 (new file):
	* ChangeLog: broke changes from 2000 into ChangeLog.2000 to reduce
	  size of the main ChangeLog.
d5172 1
a5172 1
2002-01-28  David Gravereaux <davygrvy@@pobox.com>
d5174 1
a5174 3
	* generic/tclPlatDecls.h:  Added preprocessor logic to force a
	typedef of TCHAR when __STDC__ is defined when using the uncommon
	-Za compiler switch with the microsoft compiler.
d5176 1
a5176 1
2002-01-27  Don Porter <dgp@@users.sourceforge.net>
d5178 1
a5178 2
	* doc/package.n: Documented global namespace context for script
	evaluation by [package require].
d5180 1
a5180 1
2002-01-27  Daniel Steffen  <das@@users.sourceforge.net>
d5182 1
a5182 9
	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* mac/tclMacChan.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacInit.c:
	* mac/tclMacLoad.c:
	* mac/tclMacResource.c:
	* mac/tclMacSock.c: TIP 27 CONSTification induced changes
d5184 5
a5188 3
	* tests/event.test:
	* tests/main.test: added catches/constraints to test that
	use features that don't exist on the mac.
d5190 1
a5190 1
2002-01-25  Mo DeJong  <mdejong@@users.sourceforge.net>
d5192 2
a5193 127
	Make -eofchar and -translation options read only for
	server sockets. [Bug 496733]
	
	* generic/tclIO.c (Tcl_GetChannelOption, Tcl_SetChannelOption):
	Instead of returning nothing for the -translation option
	on a server socket, always return "auto". Return the empty
	string enclosed in quotes for the -eofchar option on
	a server socket. Fixup -eofchar usage message so that
	it matches the implementation.
	* tests/io.test: Add -eofchar tests and -translation tests
	to ensure options are read only on server sockets.
	* tests/socket.test: Update tests to account for -eofchar
	and -translation option changes.

2002-01-25  Don Porter <dgp@@users.sourceforge.net>

	* compat/strstr.c (strstr):
	* generic/tclCmdAH.c (Tcl_FormatObjCmd):
	* generic/tclCmdIL.c (InfoNameOfExecutableCmd):
	* generic/tclEnv.c (ReplaceString):
	* generic/tclFileName.c (ExtractWinRoot):
	* generic/tclIO.c (FlushChannel,Tcl_BadChannelOption):
	* generic/tclStringObj.c (AppendUnicodeToUtfRep):
	* generic/tclThreadTest.c (TclCreateThread):
	* generic/tclUtf.c (Tcl_UtfPrev):
	* mac/tclMacFCmd.c (TclpObjListVolumes):
	* mac/tclMacResource.c (TclMacRegisterResourceFork,
	  BuildResourceForkList):
	* win/tclWinInit.c (AppendEnvironment):  Sought out and eliminated
	instances of CONST-casting that are no longer needed after the
	TIP 27 effort.

	* Following is [Patch 501006]
	* generic/tclInt.decls (Tcl_AddInterpResolvers, Tcl_Export,
	  Tcl_FindNamespace, Tcl_GetInterpResolvers, Tcl_ForgetImport,
	  Tcl_Import, Tcl_RemoveInterpResolvers):
	* generic/tclNamesp.c (Tcl_Export, Tcl_Import, Tcl_ForgetImport,
	  Tcl_FindNamespace):
	* generic/tclResolve.c (Tcl_AddInterpResolvers,Tcl_GetInterpResolvers,
	  Tcl_RemoveInterpResolvers): Updated APIs in generic/tclResolve.c
	and generic/tclNamesp.c according to the guidelines of TIP 27.
	* generic/tclIntDecls.h: make genstubs

	* Following is [Patch 505630]
	* doc/AddErrorInfo.3:
	* generic/tcl.decls (Tcl_LogCommandInfo):
	* generic/tclBasic.c (Tcl_LogCommandInfo): Updated interfaces
	of generic/tclBasic.cc according to TIP 27.
	* generic/tclDecls.h: make genstubs

	* Following is [Patch 506818]
	* doc/Hash.3:
	* generic/tcl.decls (Tcl_HashStats):
	* generic/tclHash.c (Tcl_HashStats):  Updated APIs of generic/tclHash.c
	according to guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs
	* generic/tclVar.c (Tcl_ArrayObjCmd): Updated callers.

	* Following is [Patch 506807]
	* doc/ObjectType.3:
	* generic/tcl.decls (Tcl_GetObjType):
	* generic/tclObj.c (Tcl_GetObjType): Updated APIs of generic/tclObj.c
	according to guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs

	* Following is [Patch 507304]
	* doc/Encoding.3:
	* generic/tcl.decls (Tcl_WinUtfToTChar,Tcl_WinTCharToUtf):
	* win/tclWin32Dll.c (Tcl_WinUtfToTChar,Tcl_WinTCharToUtf):
	Updated interfaces in win/tclWin32Dll.c according to TIP 27.
	* generic/tclPlatDecls.h: make genstubs
	* generic/tclIOUtil.c (TclpNativeToNormalized):
	* win/tclWinFCmd.c (TclpObjNormalizePath):
	* win/tclWinFile.c (TclpFindExecutable,TclpMatchInDirectory,
	  NativeIsExec,NativeStat):
	* win/tclWinLoad.c (TclpLoadFile):
	* win/tclWinPipe.c (TclpOpenFile,ApplicationType):
	* win/tclWinReg.c (regConnectRegistryProc,RecursiveDeleteKey,DeleteKey,
	  GetKeyNames,GetType,GetValue,OpenSubKey,SetValue):
	* win/tclWinSerial.c (SerialSetOptionProc): Update callers.

	* Following is [Patch 505072]
	* doc/Concat.3:
	* doc/Encoding.3:
	* doc/Filesystem.3:
	* doc/Macintosh.3:
	* doc/OpenFileChnl.3
	* doc/SetResult.3:
	* doc/SetVar.3:
	* doc/SplitList.3:
	* doc/SplitPath.3:
	* doc/Translate.3:
	* generic/tcl.h (Tcl_FSMatchInDirectoryProc):
	* generic/tclInt.h (TclpMatchInDirectory):
	* generic/tcl.decls (Tcl_Concat,Tcl_GetStringResult,Tcl_GetVar,
	  Tcl_GetVar2,Tcl_JoinPath,Tcl_Merge,Tcl_OpenCommandChannel,Tcl_SetVar,
	  Tcl_SetVar2,Tcl_SplitList,Tcl_SplitPath,Tcl_TranslateFileName,
	  Tcl_ExternalToUtfDString,Tcl_GetEncodingName,Tcl_UtfToExternalDString,
	  Tcl_GetDefaultEncodingDir,Tcl_SetDefaultEncodingDir,
	  Tcl_FSMatchInDirectory,Tcl_MacEvalResource,Tcl_MacFindResource):
	* generic/tclInt.decls (TclCreatePipeline,TclGetEnv,TclpGetCwd,
	  TclpCreateProcess):
	* mac/tclMacFile.c (TclpGetCwd):
	* generic/tclEncoding.c (Tcl_GetDefaultEncodingDir,
	  Tcl_SetDefaultEncodingDir,Tcl_GetEncodingName,
	  Tcl_ExternalToUtfDString,Tcl_UtfToExternalDString, OpenEncodingFile,
	  LoadEscapeEncoding):
	* generic/tclFileName.c (DoTildeSubst,Tcl_JoinPath,Tcl_SplitPath,
	  Tcl_TranslateFileName): 
	* generic/tclIOUtil.c (Tcl_FSMatchInDirectory):
	* generic/tclPipe.c (FileForRedirect,TclCreatePipeline,
	  Tcl_OpenCommandChannel):
	* generic/tclResult.c (Tcl_GetStringResult):
	* generic/tclUtil.c (Tcl_Concat,Tcl_SplitList,Tcl_Merge):
	* generic/tclVar.c (Tcl_GetVar,Tcl_GetVar2,Tcl_SetVar,Tcl_SetVar2):
	* mac/tclMacResource.c (Tcl_MacEvalResource,Tcl_MacFindResource):
	Updated interfaces of generic/tclEncoding, generic/tclFilename.c,
	generic/tclIOUtil.c, generic/tclPipe.c, generic/tclResult.c,
	generic/tclUtil.c, generic/tclVar.c and mac/tclMacResource.c according
	to TIP 27.  Tcl_TranslateFileName rewritten as wrapper around
	VFS-aware version.
	***POTENTIAL INCOMPATIBILITY*** 
	Includes source incompatibilities: argv arguments of Tcl_Concat,
	Tcl_JoinPath, Tcl_OpenCommandChannel, Tcl_Merge; argvPtr arguments of
	Tcl_SplitList and Tcl_SplitPath.
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs
d5195 1
a5195 52
	* generic/tclCkalloc.c (MemoryCmd):
	* generic/tclClock.c (FormatClock):
	* generic/tclCmdAH.c (Tcl_CaseObjCmd,Tcl_EncodingObjCmd,Tcl_FileObjCmd):
	* generic/tclCmdIL.c (InfoLibraryCmd,InfoPatchLevelCmd,
	  InfoTclVersionCmd):
	* generic/tclCompCmds.c (TclCompileForeachCmd):
	* generic/tclCompCmds.h (TclCompileForeachCmd):
	* generic/tclCompile.c (TclFindCompiledLocal):
	* generic/tclEnv.c (TclSetupEnv,TclSetEnv,Tcl_PutEnv,TclGetEnv,
	  EnvTraceProc):
	* generic/tclEvent.c (Tcl_BackgroundError):
	* generic/tclIO.c (Tcl_BadChannelOption,Tcl_SetChannelOption):
	* generic/tclIOCmd.c (Tcl_ExecObjCmd,Tcl_OpenObjCmd):
	* generic/tclIOSock.c (TclSockGetPort):
	* generic/tclIOUtil.c (SetFsPathFromAny):
	* generic/tclLink.c (LinkTraceProc):
	* generic/tclMain.c (Tcl_Main):
	* generic/tclNamesp.c (TclTeardownNamespace):
	* generic/tclProc.c (TclCreateProc):
	* generic/tclTest.c (TestregexpObjCmd,TesttranslatefilenameCmd,
	  TestchmodCmd,GetTimesCmd,TestsetCmd,TestOpenFileChannelProc1,
	  TestOpenFileChannelProc2,TestOpenFileChannelProc3,AsyncHandlerProc,
	  TestpanicCmd):
	* generic/tclThreadTest.c (ThreadErrorProc,ThreadEventProc):
	* generic/tclUtil.c (TclPrecTraceProc):
	* mac/tclMacFCmd.c (GetFileSpecs):
	* mac/tclMacFile.c (TclpMatchInDirectory):
	* mac/tclMacInit.c (TclpInitLibraryPath,Tcl_SourceRCFile):
	* mac/tclMacOSA.c (tclOSAStore,tclOSALoad):
	* mac/tclMacResource.c (Tcl_MacEvalResource):
	* unix/tclUnixFCmd.c (TclpObjNormalizePath):
	* unix/tclUnixFile.c (TclpMatchInDirectory,TclpGetUserHome,TclpGetCwd,
	  TclpReadLink):
	* unix/tclUnixInit.c (TclpInitLibraryPath,TclpSetVariables,
	  Tcl_SourceRCFile):
	* unix/tclUnixPipe.c (TclpOpenFile,TclpCreateTempFile,
	  TclpCreateProcess):
	* win/tclWinFile.c (TclpGetCwd,TclpMatchInDirectory):
	* win/tclWinInit.c (TclpInitLibraryPath,Tcl_SourceRCFile,
	  TclpSetVariables):
	* win/tclWinPipe.c (TclpCreateProcess): Updated callers.

2002-01-24  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclIOUtil.c (SetFsPathFromAny):  Corrected tilde-substitution
	of pathnames where > 1 separator follows the ~.  [Bug 504950]

2002-01-24  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/http/pkgIndex.tcl:
	* library/http/http.tcl: don't add port in default case to handle
	broken servers.  http bumped to 2.4.1  [Bug #504508]
d5197 1
a5197 1
2002-01-23  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5199 4
a5202 16
	* unix/mkLinks: Regenerated.
	* doc/CrtChannel.3:
	* doc/ChnlStack.3: Moved documentation for 'Tcl_GetTopChannel'
	  from 'CrtChannel' to 'ChnlStack'. Added documentation of
	  'Tcl_GetStackedChannel'. Bug #506147 reported by Mark Patton
	  <msp@@users.sourceforge.net>.

2002-01-23  Don Porter <dgp@@users.sourceforge.net>

	* win/tclWinFile.c (NativeAccess,NativeStat,NativeIsExec,
	  TclpGetUserHome):
	* win/tclWinPort.h (TclWinSerialReopen):
	* win/tclWinSerial.c (TclWinSerialReopen):
	* win/tclWinSock.c (Tcl_OpenTcpServer):  Corrections to earlier
	TIP 27 changes.  Thanks to Andreas Kupries for the feedback.
	* generic/tclPlatDecls.h: make genstubs
d5204 1
a5204 48
	* doc/GetHostName.3:
	* doc/GetOpnFl.3:
	* doc/OpenTcp.3:
	* tcl.decls (Tcl_GetHostName,Tcl_GetOpenFile,Tcl_OpenTcpClient,
	  Tcl_OpenTclServer):
	* mac/tclMacSock.c (CreateSocket,Tcl_OpenTcpClient,Tcl_OpenTcpServer,
	  Tcl_GetHostName,GetHostFromString):
	* unix/tclUnixChan.c (CreateSocket,CreateSocketAddress,
	  Tcl_OpenTcpClient,Tcl_OpenTcpServer,Tcl_GetOpenFile):
	* unix/tclUnixSock.c (Tcl_GetHostName):
	* win/tclWinSock.c (CreateSocket,CreateSocketAddress,
	  Tcl_OpenTcpClient,Tcl_OpenTcpServer,Tcl_GetHostName):
	Updated socket interfaces according to TIP 27.
	* generic/tclCmdIL.c (InfoHostnameCmd): Updated callers.
	* generic/tclDecls.h: make genstubs

2002-01-21  David Gravereaux <davygrvy@@pobox.com>

	* generic/tclLoadNone.c: TclpLoadFile() didn't match proto of
	  typedef Tcl_FSLoadFileProc.  OK'd by vincentdarley.
	  [Patch #502488]

2002-01-21  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIO.c (WriteChars): Fix for SF #506297, reported by
	  Martin Forssen <ruric@@users.sourceforge.net>. The encoding
	  chosen in the script exposing the bug writes out three intro
	  characters when TCL_ENCODING_START is set, but does not consume
	  any input as TCL_ENCODING_END is cleared. As some output was
	  generated the enclosing loop calls UtfToExternal again, again
	  with START set. Three more characters in the out and still no
	  use of input ... To break this infinite loop we remove
	  TCL_ENCODING_START from the set of flags after the first call
	  (no condition is required, the later calls remove an unset flag,
	  which is a no-op). This causes the subsequent calls to
	  UtfToExternal to consume and convert the actual input.

2002-01-21  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclTest.c: Converted declarations of TestReport file system
	  to more portable form.  [Bug 501417].

	* generic/tcl.decls (Tcl_TraceCommand,Tcl_UntraceCommand,
	  Tcl_CommandTraceInfo):
	* generic/tclCmdMZ.c (Tcl_TraceCommand,Tcl_UntraceCommand,
	  Tcl_CommandTraceInfo): Updated APIs in generic/tclCmdMZ.c 
	  according to the guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs
d5206 1
a5206 1
2002-01-18  Don Porter <dgp@@users.sourceforge.net>
d5208 1
a5208 3
	* win/tclWinChan.c:
	* win/tclWinFCmd.c:
	* win/tclWinFile.c: Overlooked callers of Tcl_FSGetNativePath
d5210 1
a5210 2
	* win/tclWinDde.c:
	* win/tclWinReg.c: Overlooked callers of Tcl_GetIndexFromObj
d5212 1
a5212 1
2002-01-18  Daniel Steffen  <das@@users.sourceforge.net>
d5214 3
a5216 31
	* generic/tclThreadTest.c:
	* mac/tclMacChan.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacLoad.c:
	* mac/tclMacResource.c: TIP 27 CONSTification broke the mac
	  build in a number of places.

2002-01-17  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIOCmd.c (Tcl_GetsObjCmd): Fixed bug #504642 as
	  reported by Brian Griffin <bgriffin@@users.sourceforge.net>,
	  using his patch. Before the patch the generic I/O layer held an
	  unannounced reference to the interp result to store the read
	  line into. This unfortunately has disastrous results if the
	  channel driver executes a tcl script to perform its operation,
	  this freeing the interp result. In that case we are
	  dereferencing essentially a dangling reference. It is not truly
	  dangling because the object is in the free list, but this only
	  causes us to smash the free list and have the error occur later
	  somewhere else. The patch simply creates a new object for the
	  line and later sets it into the interp result when we are done
	  with reading.

2002-01-16  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tcl.m4 (SC_LOAD_TCLCONFIG):
	* win/tcl.m4 (SC_LOAD_TCLCONFIG): Subst TCL_DBGX
	into TCL_STUB_LIB_FILE and TCL_STUB_LIB_FLAG
	variables so that an extension does not need
	to subst TCL_DBGX into its makefile. [Tk Bug 504356]
d5218 1
a5218 1
2002-01-16  Don Porter <dgp@@users.sourceforge.net>
d5220 7
a5226 47
	* doc/FileSystem.3:
	* doc/GetCwd.3:
	* doc/GetIndex.3:
	* generic/tcl.decls (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_GetCwd, Tcl_FSFileAttrStrings, Tcl_FSGetNativePath,
	  Tcl_FSGetTranslatedStringPath):
	* generic/tcl.h (Tcl_FSFileAttrStringsProc):
	* generic/tclFCmd.c (TclFileAttrsCmd):
	* generic/tclIOUtil.c (Tcl_GetCwd,NativeFileAttrStrings,
	  Tcl_FSFileAttrStrings,Tcl_FSGetTranslatedStringPath,
	  Tcl_FSGetNativePath):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObj,Tcl_GetIndexFromObjStruct):
	More TIP 27 updates in tclIOUtil.c and tclIndexObj.c that were
	overlooked before.  [Patch 504671]
	***POTENTIAL INCOMPATIBILITY*** 
	Includes a source incompatibility in the tablePtr arguments of
	the Tcl_GetIndexFromObj* routines.
	* generic/tclDecls.h: make genstubs

	* generic/tclBinary.c (Tcl_BinaryObjCmd):
	* generic/tclClock.c (Tcl_ClockObjCmd):
	* generic/tclCmdAH.c (Tcl_EncodingObjCmd, Tcl_FileObjCmd):
	* generic/tclCmdIL.c (Tcl_InfoObjCmd,Tcl_LsearchObjCmd,Tcl_LsortObjCmd):
	* generic/tclCmdMZ.c (Tcl_TraceObjCmd,Tcl_RegexpObjCmd,Tcl_RegsubObjCmd,
	  Tcl_StringObjCmd,Tcl_SubstObjCmd,Tcl_SwitchObjCmd,
	  TclTraceCommandObjCmd,TclTraceVariableObjCmd):
	* generic/tclCompCmds.c (TclCompileStringCmd):
	* generic/tclEvent.c (Tcl_UpdateObjCmd):
	* generic/tclFileName.c (Tcl_GlobObjCmd):
	* generic/tclIO.c (Tcl_FileEventObjCmd):
	* generic/tclIOCmd.c (Tcl_SeekObjCmd,Tcl_ExecObjCmd,Tcl_SocketObjCmd,
	  Tcl_FcopyObjCmd):
	* generic/tclInterp.c (Tcl_InterpObjCmd,SlaveObjCmd):
	* generic/tclNamesp.c (Tcl_NamespaceObjCmd):
	* generic/tclPkg.c (Tcl_PackageObjCmd):
	* generic/tclTest.c (Tcltest_Init,TestencodingObjCmd,TestgetplatformCmd,
	  TestlocaleCmd,TestregexpObjCmd,TestsaveresultCmd,
	  TestGetIndexFromObjStructObjCmd,TestReportFileAttrStrings):
	* generic/tclTestObj.c (TestindexObjCmd,TeststringObjCmd):
	* generic/tclTimer.c (Tcl_AfterObjCmd):
	* generic/tclVar.c (Tcl_ArrayObjCmd):
	* mac/tclMacFCmd.c (SetFileFinderAttributes):
	* unix/tclUnixChan.c (TclpOpenFileChannel):
	* unix/tclUnixFCmd.c (tclpFileAttrStrings):
	* unix/tclUnixFile.c (TclpObjAccess,TclpObjChdir,TclpObjStat,
	  TclpObjLstat):
	* win/tclWinFCmd.c (tclpFileAttrStrings): Updated callers.
d5228 1
a5228 15
	* doc/RegExp.3:
	* doc/Utf.3:
	* generic/tcl.decls:
	* generic/tclInt.decls:
	* generic/tclRegexp.c:
	* generic/tclUtf.c:  Updated APIs in generic/tclUtf.c and
	generic/tclRegexp.c according to the guidelines of TIP 27.
	[Patch 471509]

	* generic/regc_locale.c (element,cclass):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd):
	* generic/tclFileName.c (TclpGetNativePathType,SplitMacPath):
	* generic/tclIO.c (ReadChars):
	* mac/tclMacLoad.c (TclpLoadFile):
	* win/tclWinFile.c (TclpGetUserHome): Updated callers.
d5230 3
a5232 2
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs
d5234 1
a5234 60
	* doc/ParseCmd.3 (Tcl_ParseVar):
	* generic/tcl.decls (Tcl_ParseVar):
	* generic/tclParse.c (Tcl_ParseVar):
	* generic/tclTest.c (TestparsevarObjCmd): Updated APIs in
	generic/tclParse.c according to the guidelines of TIP 27.  Updated
	callers.  [Patch 501046]
	* generic/tclDecls.h: make genstubs

	* generic/tcl.decls (Tcl_RecordAndEval):
	* generic/tclDecls.h: make genstubs
	* generic/tclHistory.c (Tcl_RecordAndEval): Updated APIs in
	generic/tclHistory.c according to the guidelines of TIP 27.
	[Patch 504091]

	* doc/CrtSlave.3:
	* generic/tcl.decls (Tcl_CreateAlias, Tcl_CreateAliasObj,
	  Tcl_CreateSlave, Tcl_GetAlias, Tcl_GetAliasObj, Tcl_GetSlave):
	* generic/tclInterp.c (Tcl_CreateAlias, Tcl_CreateAliasObj,
	  Tcl_CreateSlave, Tcl_GetAlias, Tcl_GetAliasObj, Tcl_GetSlave):
	Updated APIs in the file generic/tclInterp.c according to the
	guidelines of TIP 27.  [Patch 501371]
	***POTENTIAL INCOMPATIBILITY*** 
	Includes a source incompatibility in the targetCmdPtr arguments of
	the Tcl_GetAlias* routines.

	* generic/tclDecls.h: make genstubs

2002-01-15  Don Porter <dgp@@users.sourceforge.net>

	* doc/SetErrno.3 (Tcl_ErrnoMsg): Corrected documentation for
	Tcl_ErrnoMsg; it takes an integer argument.  Thanks to Georgios
	Petasis.  [Bug 468183]

	* doc/AddErrInfo.3 (Tcl_PosixError):
	* doc/Eval.3 (Tcl_EvalFile):
	* doc/FileSystem.c (Tcl_FSOpenFileChannel,Tcl_FSOpenFileChannelProc):
	* doc/OpenFileChnl.3 (Tcl_OpenFileChannel):
	* doc/SetErrno.3 (Tcl_ErrnoId,Tcl_ErrnoMsg):
	* doc/Signal.3 (Tcl_SignalId,Tcl_SignalMsg):
	* generic/tcl.decls (Tcl_ErrnoId,TclErrnoMsg,Tcl_EvalFile,
	  Tcl_OpenFileChannel,Tcl_PosixError,Tcl_SignalId,Tcl_SignalMsg,
	  Tcl_FSOpenFileChannel):
	* generic/tcl.h (Tcl_FSOpenFileChannelProc):
	* generic/tclIO.c (FlushChannel):
	* generic/tclIOUtil.c (Tcl_OpenFileChannel,Tcl_EvalFile,TclGetOpenMode,
	  Tcl_PosixError,Tcl_FSOpenFileChannel):
	* generic/tclInt.decls (TclGetOpenMode):
	* generic/tclInt.h (TclOpenFileChannelProc_,TclGetOpenMode,
	  TclpOpenFileChannel):
	* generic/tclPipe.c (TclCleanupChildren):
	* generic/tclPosixStr.c (Tcl_ErrnoId,Tcl_ErrnoMsg,Tcl_SignalId,
	  Tcl_SignalMsg):
	* generic.tclTest.c (PretendTclpOpenFileChannel,
	  TestOpenFileChannelProc1,TestOpenFileChannelProc2,
	  TestOpenFileChannelProc3,TestReportOpenFileChannel):
	* mac/tclMacChan.c (TclpOpenFileChannel):
	* unix/tclUnixChan.c (TclpOpenFileChannel):
	* win/tclWinChan.c (TclpOpenFileChannel): Updated APIs in
	  generic/tclIOUtil.c and generic/tclPosixStr.c according to the
	  guidelines of TIP 27.  Updated callers.  [Patch 499196]
d5236 2
a5237 2
	* generic/tclDecls.h:
	* generic/tclIntDecls.h: make genstubs
d5239 1
a5239 30
	* doc/CrtChannel.3:
	* doc/OpenFileChnl.3:
	* generic/tcl.decls:
	* generic/tclIO.h:
	* generic/tclIO.c (DoWrite, Tcl_RegisterChannel, Tcl_GetChannel,
	  Tcl_CreateChannel, Tcl_GetChannelName, CloseChannel, Tcl_Write,
	  Tcl_WriteRaw, Tcl_Ungets, Tcl_BadChannelOption, Tcl_GetChannelOption,
	  Tcl_SetChannelOption, Tcl_GetChannelNamesEx, Tcl_ChannelName):
	Updated APIs in the file generic/tclIO.c according to the guidelines
	of TIP 27.  Several minor documentation corrections as well.
	[Patch 503565]
	* generic/tclDecls.h: make genstubs

	* generic/tcl.h (Tcl_DriverOutputProc, Tcl_DriverGetOptionProc,
	  Tcl_DriverSetOptionProc):
	* generic/tclIOGT.c (TransformOutputProc, TransformGetOptionProc,
	  TransformSetOptionProc):
	* mac/tclMacChan.c (FileOutput, StdIOOutput):
	* man/tclMacSock.c (TcpGetOptionProc, TcpOutput):
	* unix/tclUnixChan.c (FileOutputProc, TcpGetOptionProc, TcpOutputProc,
	  TtyGetOptionProc, TtySetOptionProc):
	* unix/tclUnixPipe.c (PipeOuputProc):
	* win/tclWinChan.c (FileOutputProc):
	* win/tclWinConsole.c (ConsleOutputProc):
	* win/tclWinPipe.c (PipeOuputProc):
	* win/tclWinSerial.c (SerialOutputProc, SerialGetOptionProc,
	  SerialSetOptionProc):
	* win/tclWinSock.c (TcpGetOptionProc, TcpOutput): Updated channel
	driver interface according to the guidelines of TIP 27.  See also
	[Bug 500348].
d5241 3
a5243 9
	* doc/CrtChannel.3:
	* generic/tcl.h:
	* generic/tclIO.c:
	* generic/tclIO.h:
	* generic/tclInt.h:
	* tools/checkLibraryDoc.tcl:
	Moved Tcl_EolTranslation enum declaration from generic/tcl.h to
	generic/tclInt.h (renamed to TclEolTranslation).  It is not used
	anywhere in Tcl's public interface.
d5245 1
a5245 1
2002-01-14  Don Porter <dgp@@users.sourceforge.net>
d5247 1
a5247 8
	* doc/GetIndex.3:
	* doc/WrongNumArgs.3:
	* generic/tcl.decls (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_WrongNumArgs):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_WrongNumArgs):  Updated APIs in the file generic/tclIndexObj.c
	according to the guidelines of TIP 27.  [Patch 501491]
	* generic/tclDecls.h: make genstubs
d5249 1
a5249 1
2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d5251 2
a5252 5
	* unix/configure: Regen.
	* unix/configure.in:
	* win/configure: Regen.
	* win/configure.in: Use ${libdir} instead of ${exec_prefix}/lib
	to properly support the --libdir option to configure. [Bug 489370]
d5254 1
a5254 1
2002-01-11  Andreas Kupries  <andreas_kupries@@users.sourceforge.net> 
d5256 1
a5256 105
	* win/tclWinSerial.c (SerialSetOptionProc): Applied patch for SF
	  bug #500348 supplied by Rolf Schroedter
	  <schroedter@@users.sourceforge.net>. The function modified the
	  contents of the the 'value' string and now does not do this
	  anymore. This is a followup to the change made on 2001-12-17.

2002-01-11  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.vc: Removed -GD compiler option.  It was intended
	for future use, but MS is again changing the future at their whim.
	The D4002 warning was harmless though, but someone using VC .NET
	logged it as a concern.  [Bug #501565]

2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Burn Tcl build directory
	into tcltest executable to avoid crashes caused
	by ld loading a previously installed version
	of the tcl shared library. [Bug 218110]

2002-01-10  Don Porter <dgp@@users.sourceforge.net>,
	Kevin Kenny <kennykb@@users.sourceforge.net>
	
	* unix/tclLoadDld.c (TclpLoadFile):  syntax error: unbalanced
	parens.  Kevin notes that it's far from clear that this file is
	ever included in an actual build; Linux without dlopen appears to
	be a nonexistent configuration.
	
2002-01-08  Don Porter <dgp@@users.sourceforge.net>,
	Kevin Kenny <kennykb@@users.sourceforge.net>

	* doc/StaticPkg.3 (Tcl_StaticPackage):
	* generic/tcl.decls (Tcl_StaticPackage):
	* generic/tclDecls.h (Tcl_StaticPackage):
	* generic/tclInt.decls (TclGuessPackageName):
	* generic/tclInt.h (TclGuessPackageName):
	* generic/tclLoad.c (Tcl_StaticPackage):
	* generic/tclLoadNone.c (TclGuessPackageName):
	* mac/tclMacLoad.c (TclGuessPackageName):
	* unix/tclLoadAout.c (TclGuessPackageName):
	* unix/tclLoadDl.c (TclGuessPackageName):
	* unix/tclLoadDld.c (TclGuessPackageName):
	* unix/tclLoadDyld.c (TclGuessPackageName):
	* unix/tclLoadNext.c (TclGuessPackageName):
	* unix/tclLoadOSF.c (TclGuessPackageName):
	* unix/tclLoadShl.c (TclGuessPackageName):
	* win/tclWinLoad.c (TclGuessPackageName):  Updated APIs in 
	the files */tcl*Load*.c according to the guidelines of TIP 27.
	[Patch 501096]

2002-01-09  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclTest.c (MainLoop):
	* tests/main.test (Tcl_Main-1.{3,4,5,6}):  Corrected some non-portable
	tests from the new Tcl_Main changes.  Thanks to Kevin Kenny.

2002-01-07  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclEvent.c (TclInExit):
	* generic/tclIOUtil.c (SetFsPathFromAbsoluteNormalized,
	  SetFsPathFromAny,Tcl_FSNewNativePath,DupFsPathInternalRep):
	* generic/tclListObj.c (TclLsetList,TclLsetFlat):  Added some type
	casts to satisfy picky compilers.

	* generic/tclMain.c:  Bug fix: neglected the NULL case in
	TclGetStartupScriptFileName().  Broke Tk/wish.

2002-01-05  Don Porter <dgp@@users.sourceforge.net>

	* doc/Tcl_Main.3:
	* generic/tclMain.c:  Substantial rewrite and expanded documentation
	of Tcl_Main to correct a number of bugs and flaws:

		* Interactive Tcl_Main can now enter a main loop, exit
		  that loop and continue interactive operations.  The loop
		  may even exit in the midst of interactive command typing
		  without loss of the partial command.  [Bugs 486453, 474131]
		* Tcl_Main now gracefully handles deletion of its master
		  interpreter.
		* Interactive Tcl_Main can now operate with non-blocking stdin
		* Interactive Tcl_Main can now detect EOF on stdin even in
		  mid-command.  [Bug 491341]
		* Added VFS-aware internal routines for managing the
		  startup script selection.
		* Tcl variable 'tcl_interactive' is now linked to C variable
		  'tty' so that one can disable/enable interactive prompts
		  at the script level when there is no startup script.  This
		  is meant for use by the test suite.
		* Consistent use of the Tcl libraries standard channels as
		  returned by Tcl_GetStdChannel(); as opposed to the channels
		  named 'stdin', 'stdout', and 'stderr' in the master interp,
		  which can be different or unavailable.
		* Tcl_Main now calls Tcl_Exit() if evaluation of [exit] in the
		  master interpreter returns, assuring Tcl_Main does not return.
		* Documented Tcl_Main's absence from public stub table
		* Documented that Tcl_Main does not return.
		* Documented Tcl variables set by Tcl_Main.
		* All prompts are done from a single procedure, Prompt.
		* Use of Tcl_Obj-enabled interfaces everywhere.

	* generic/tclInt.decls (TclGetStartupScriptPath,
	  TclSetStartupScriptPath): New internal VFS-aware routines for
	managing the startup script of Tcl_Main.
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c: make genstubs
d5258 1
a5258 5
	* generic/tclTest.c (TestsetmainloopCmd,TestexitmainloopCmd,
	  Tcltest_Init,TestinterpdeleteCmd):
	* tests/main.test (new):  Added new file to test suite that
	thoroughly tests generic/tclMain.c; added some new test commands
	for testing Tcl_SetMainLoop().
a5259 1
2002-01-04  Don Porter <dgp@@users.sourceforge.net>
a5260 62
	* doc/Alloc.3:
	* doc/Concat.3:
	* doc/CrtMathFnc.3:
	* doc/Hash.3:
	* doc/Interp.3:
	* doc/LinkVar.3:
	* doc/ObjectType.3:
	* doc/PkgRequire.3:
	* doc/Preserve.3:
	* doc/SetResult.3:
	* doc/SplitList.3:
	* doc/SplitPath.3:
	* doc/TCL_MEM_DEBUG.3: Updated documentation to describe the ckalloc,
	ckfree, ckrealloc, attemptckalloc, and attemptckrealloc macros, and
	to accurately describe when and how they are used.  [Bug 497459]

	* generic/tclThreadJoin.c (TclRememberJoinableThread,TclJoinThread):
	Replaced Tcl_Alloc and Tcl_Free calls with ckalloc and ckfree so that
	memory debugging is supported.

2002-01-04  Daniel Steffen <das@@users.sourceforge.net>

	* mac/tclMacTime.c (TclpGetTZName): fix for daylight savings TZName bug

2002-01-03  Don Porter <dgp@@users.sourceforge.net>

	* doc/FileSystem.3:
	* generic/tclIOUtil.c: Updated some old uses of "fileName" to
	new VFS terminology, "pathPtr".

2002-01-03  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/basic.test (basic-39.4): Greatly simplified test while
	still leaving it so that it crashes when run without the fix to
	the [foreach] implementation.
	* generic/tclCmdAH.c (Tcl_ForeachObjCmd): Stopped Bug #494348 from
	happening by not trying to be so clever with cacheing; if nothing
	untoward is happening anyway, the less efficient technique will
	only add a few instruction cycles (one function call and a few
	derefs/assigns per list per iteration, with no change in the
	number of tests) and if something odd *is* going on, the code is
	now far more robust.

	* tests/basic.test (basic-39.4): Reproducable script from Bug #494348

2002-01-02  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/util.test (Wrapper_Tcl_StringMatch,util-5.*): Rewrote so
	the test is performed with the right internal function since
	[string match] no longer uses Tcl_StringCaseMatch internally.

	* tests/string.test (string-11.51):
	* generic/tclUtf.c (Tcl_UniCharCaseMatch):
	* generic/tclUtil.c (Tcl_StringCaseMatch): Fault with matching
	case-insensitive non-ASCII patterns containing upper case
	characters.  [Bug #233257]

	******************************************************************
	*** CHANGELOG ENTRIES FOR 2001 IN "ChangeLog.2001"             ***
	*** CHANGELOG ENTRIES FOR 2000 IN "ChangeLog.2000"             ***
	*** CHANGELOG ENTRIES FOR 1999 AND EARLIER IN "ChangeLog.1999" ***
	******************************************************************
@


1.1.1.7
log
@import tk 8.4.0
@
text
@d3 1
a3 1
	* unix/Makefile.in: added DYLIB_INSTALL_DIR variable for Darwin
d9 1
a9 1
	* macosx/Wish.pbproj/project.pbxproj:
d19 1
a19 1
2002-09-09  Jeff Hobbs  <jeffh@@ActiveState.com>
d21 2
a22 2
	* macosx/tkMacOSXNotify.c (Tk_MacOSXSetupTkNotifier): corrected
	Mac Jaguar event loop issue.
d24 1
a24 36
	* library/tk.tcl: use command instead of control on Aqua bindings.
	Force dialogs to appear below fixed native Mac menubar.
	* macosx/tkMacOSXKeyEvent.c:
	* macosx/tkMacOSXKeyboard.c: Keypress/release events for pure
	modifier keys were not being passed to Tk.
	Deadkey presses were inserting null characters into text windows.
	Now they do nothing. (Still not ideal, but better than before!)
	* macosx/tkMacOSXMenu.c: Allow more than 200 menus to exist -
	increased to 2000.
	* macosx/tkMacOSXMouseEvent.c: Bad interactions between floating
	windows and ordinary ones.  Ensure that local<->global coordinate
	transformations are wrt to the correct window.
	* macosx/tkMacOSXWm.c: Better error msg for 'wm attributes'.
	Remove crash in 'wm transient'.
	Add 'noActivates' and 'noUpdates' flags to unsupported command.
	[Patch #606658] (darley)

	* library/xmfbox.tcl (::tk::MotifFDialog_ActivateSEnt): corrected
	msgcat code with XPG specifier. [Patch #606719] (miller)

2002-09-06  Don Porter <dgp@@users.sf.net>

	* tests/unixWm.test (unixWm-50.3):  Constrained test that hangs
	on Windows.

2002-09-05  Daniel Steffen  <das@@users.sourceforge.net>

	* macosx/Wish.pbproj/project.pbxproj: added overlooked missing
	TK_PATCH_LEVEL version bump to 8.4.0.

2002-09-04  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* win/Makefile.in (install-libraries): Added code section to
	  install the message catalogs. Copied same section from
	  unix/Makefile.in and adapted it to the slightly different
	  environment.
d26 1
a26 5300
2002-09-03  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/button.tcl: further restrict buttons to not resetting
	the "original" relief if it has changed in the interim.  This
	prevents code that simulated overrelief buttons from not working
	in 8.4.  [Bug #604270]

2002-09-03  Daniel Steffen  <das@@users.sourceforge.net>

	* macosx/Wish.pbproj/project.pbxproj: Bumped version number to
	8.4.0 and updated copyright info.

2002-09-03  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* macosx/tkMacOSXWm.c: fix to 'wm attributes' error-handling bug.
	
2002-09-03  Don Porter <dgp@@users.sf.net>

	* changes: Updated for 8.4.0 release

2002-09-02  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/cursor.test: reverted 2002-08-31 change for OS X to use
	'heart' cursor because 'arrow' on windows has a pre-skewed use
	count. [Bug #602667]

	* tests/button.test: added button-14.1
	* win/tkWinButton.c (TkpComputeButtonGeometry): correct Win button
	sizing to be equal for one-line buttons with -height of 0 or 1, as
	well as -height 0 buttons with empty text and no image, which
	should be the same as single-line text buttons. [Bug #565485]

	* library/button.tcl (::tk::ButtonLeave): correctly restore state
	of button to normal for unix bindings. [Bug #597920]

	* doc/tk.n: added tk windowingsystem docs.

	* tests/wm.test:
	* unix/tkUnixWm.c: remove possible 2-second delay in 'raise'.
	[Patch #601518] (english) TIP #107

	* unix/tcl.m4: add support for 64-bit builds on HP-11 with gcc.
	* unix/configure.in: make sure to substitute LD_LIBRARY_PATH_VAR.
	* unix/configure: regend

	* README:		Bumped version number to 8.4.0
	* generic/tk.h:
	* unix/configure:
	* unix/configure.in:
	* unix/tk.spec:
	* win/configure:
	* win/configure.in:

	* generic/tkCmds.c:
	* generic/tkWindow.c: made 'tk' available in safe interpreters,
	but only the caret and windowingsystem subcommands may be called.
	* tests/safe.test (safe-1.2): noted that tk is now available in
	safe interps, but not the appname/scaling subcommands.

	* tests/tk.test (tk-1.2): noted new tk windowingsystem subcommand

2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>

	* unix/tcl.m4: update from Tcl

	* unix/Makefile.in: import of TK_SHLIB_LD_EXTRAS for Tk library
	specific linker settings. Added use of new LD_LIBRARY_PATH_VAR.

	* unix/configure: regen

2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>

	*** macosx-8-4-branch merged into the mainline [tcl patch #602770] ***

	* generic/tk.decls:
	* generic/tkInt.decls: added new "aqua" specific entries to the
	stubs tables. Changed all "unix" entries to "x11" to allow us to
	distinguish and build both "aqua" on MacOSX and "x11" on MacOSX.

	* generic/tk.h: added a #ifnded RESOURCE_INCLUDED so that tk.h can
	be passed to the resource compiler. 
	
	* generic/tkCmds.c (Tk_TkObjCmd): added [tk windowingsystem]
	subcommand: returns "x11" when running on X11, "win32" on Windows,
	"classic" on MacOS9 and "aqua" on MacOSX Aqua (i.e. Carbon)

	* generic/tkFont.c (TkFontGetFirstTextLayout): new private function
	returning the first chunk of a Tk_TextLayout, i.e. until the first
	font change on the first line (or the whole first line if there is
	no such font change).

	* generic/tkMain.c: made Tcl_ThreadDataKey static

	* library/demos/puzzle.tcl: fixed button metrics for aqua

	* tests/cursor.test: check for presence of arrow cursor instead of
	heart cursor

	* xlib/xcolors.c: changed xColors static initialization to more
	standard C
	
	* macosx/Wish.pbproj/jingham.pbxuser (new):
	* macosx/Wish.pbproj/project.pbxproj (new): project for Apple's
	ProjectBuilder IDE.

	* macosx/Makefile (new): simple makefile for building the project
	from the command line via the ProjectBuilder tool 'pbxbuild'.

	* macosx/tkMacOSXAppInit.c (new): macosx specific AppInit looking
	for a AppMain.tcl file in its bundled Resources/Scripts folder. If
	present, argv[1] is set to that file and the Scripts folder is
	added to the auto_path. This allows tk apps to embed scripts within
	their bundle directory structure.

	* macosx/tkMacOSXInit.c (new): macosx adapted version of
	tkUnixInit.c: we initialize & cache the Carbon native encoding
	(e.g. 'macRoman') and try to find the tk script library files
	inside Tk packaged as a framework.

	* macosx/tkMacOSXNotify.c (new): new macosx specific merged
	Carbon/select-based notifier.

	* macosx/tkMacOSXEvent.c (new):
	* macosx/tkMacOSXEvent.h (new):
	* macosx/tkMacOSXKeyEvent.c (new):
	* macosx/tkMacOSXMouseEvent.c (new):
	* macosx/tkMacOSXWindowEvent.c (new): new macosx specific event
	handling functionality.

	* macosx/tkMacOSX.h (new):
	* macosx/tkMacOSXBitmap.c (new): 
	* macosx/tkMacOSXButton.c (new):
	* macosx/tkMacOSXClipboard.c (new):
	* macosx/tkMacOSXColor.c (new):
	* macosx/tkMacOSXConfig.c (new):
	* macosx/tkMacOSXCursor.c (new):
	* macosx/tkMacOSXDefault.h (new):
	* macosx/tkMacOSXDialog.c (new):
	* macosx/tkMacOSXDraw.c (new):
	* macosx/tkMacOSXEmbed.c (new):
	* macosx/tkMacOSXFont.c (new):
	* macosx/tkMacOSXHLEvents.c (new):
	* macosx/tkMacOSXInt.h (new):
	* macosx/tkMacOSXKeyboard.c (new):
	* macosx/tkMacOSXMenu.c (new):
	* macosx/tkMacOSXMenubutton.c (new):
	* macosx/tkMacOSXMenus.c (new):
	* macosx/tkMacOSXPort.h (new):
	* macosx/tkMacOSXRegion.c (new):
	* macosx/tkMacOSXScale.c (new):
	* macosx/tkMacOSXScrlbr.c (new):
	* macosx/tkMacOSXSubwindows.c (new):
	* macosx/tkMacOSXTest.c (new):
	* macosx/tkMacOSXUtil.c (new):
	* macosx/tkMacOSXUtil.h (new):
	* macosx/tkMacOSXWm.c (new):
	* macosx/tkMacOSXWm.h (new):
	* macosx/tkMacOSXXStubs.c (new): macosx ports of classic mac Tk
	implementation in tk/mac.

	* macosx/tkMacOSXSend.c (new): only send to local interp
	implemented currently.

	* macosx/tkMacOSXDebug.h (new):
	* macosx/tkMacOSXDebug.c (new): new macosx specific functions for
	debugging MacOS events, regions, etc.

	* macosx/tkAboutDlg.r (new):
	* macosx/tkMacOSXApplication.r (new):
	* macosx/tkMacOSXCursors.r (new):
	* macosx/tkMacOSXLibrary.r (new):
	* macosx/tkMacOSXMenu.r (new):
	* macosx/tkMacOSXResource.r (new):
	* macosx/tkMacOSXXCursors.r (new):
	* macosx/tclets.r (new): sources for Rez resource compiler.

	* macosx/Wish.icns (new): Wish application icon.

	* generic/tk.h:
	* generic/default.h:
	* generic/tkBind.c:
	* generic/tkCmds.c:
	* generic/tkGrab.c:
	* generic/tkPointer.c:
	* generic/tkPort.h:
	* generic/tkSelect.c:
	* generic/tkStubLib.c:
	* generic/tkTest.c:
	* generic/tkText.c:
	* generic/tkWindow.c:
	* unix/tkUnix3d.c:
	* xlib/xgc.c:
	* xlib/X11/X.h:
	* xlib/X11/Xlib.h:
	* xlib/X11/Xutil.h: added #includes and #ifdefs for macosx

	* library/bgerror.tcl:
	* library/button.tcl:
	* library/console.tcl:
	* library/dialog.tcl:
	* library/entry.tcl:
	* library/listbox.tcl:
	* library/menu.tcl:
	* library/msgbox.tcl:
	* library/scrlbar.tcl:
	* library/spinbox.tcl:
	* library/text.tcl:
	* library/tk.tcl:
	* library/demos/menu.tcl:
	* library/demos/menubu.tcl:
	* library/demos/widget: check [tk windowingsystem] instead of
	and/or in addition to $tcl_platform(platform).

	* generic/tkInt.h:
	* mac/tkMacBitmap.c:
	* mac/tkMacWm.c: added missing CONSTification

	* generic/tkIntDecls.h:
	* generic/tkIntPlatDecls.h:
	* generic/tkIntXlibDecls.h:
	* generic/tkPlatDecls.h:	
	* generic/tkStubInit.c: regen

2002-08-27  D. Richard Hipp <drh@@hwaci.com>

	* doc/checkbutton.n:      [Bug 582457] Fix the -offrelief option so
	* doc/radiobutton.n:      that when -offrelief is flat and -relief is
	* mac/tkMacButton.c:      sunken and -overrelief is raised, buttons
	* unix/tkUnixButton.c:    work look toolbar buttons under Windows.
	* win/tkWinButton.c:      See also: TIP #82.

2002-08-26  Don Porter <dgp@@users.sf.net>

	* win/Makefile.in:	Removed dependence on the (parts of) the
	* win/winMain.c:	tcltest executable on Windows.  It was not
	used, and the dependency complicated the Makefile.  [Bug 592638].

2002-08-20  Don Porter <dgp@@users.sf.net>

	* README:		Bumped version number to 8.4b3 to distinguish
	* generic/tk.h:		HEAD from the 8.4b2 release.
	* unix/configure.in:
	* win/configure.in:
	* unix/tk.spec:
	
	* unix/configure:	autoconf
	* win/configure:

	* generic/tk.h:	Added compile-time check that the tcl.h header file
	#included by Tk 8.4 is one from Tcl 8.4.  This is needed to be sure
	that new #defines like CONST84 are available. [Bug 597432].

2002-08-16  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/Makefile.in (install-binaries): simplified pkgIndex.tcl
	file created on installation.
	* win/Makefile.in (install-binaries): corrected and simplified
	creation of pkgIndex.tcl file on installation.

2002-08-14  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* win/tkWinDialog.c:
	* win/makefile.vc: broken compilation and link from changes
	Hobbs-08-07 fixed.
	* win/tkWinTest.c: CONST problem resolved.

2002-08-13  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/button.tcl: change the bindings to use Priv($w,relief)
	instead of just Priv(relief).  This ensures that neighboring
	buttons don't confuse (over)relief settings.

2002-08-13  Reinhard Max  <max@@suse.de>

	* unix/tkUnixSend.c (Tk_SetAppName): Fixed a compiler warning.

2002-08-12  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/demos/image2.tcl: Tweaked the behaviour of the directory
	box on resize, as resizing of the overall window tends to be
	common given the sample images.

2002-08-08  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tkUnixWm.c (WmTransientCmd): Apply fix for
	wm transient assertion error that was applied
	to tkWinWm.c for Tk Bug #592201.

2002-08-08  Mo DeJong  <mdejong@@users.sourceforge.net>

	* tests/wm.test: Add deleteWindows at start of
	new transient tests so they do not fail if the
	toplevels already exist.
	* unix/tkUnixWm.c: Revert patch for Tk Bug #592201
	which incorrectly removed numTransients member.

2002-08-08  Joe English  <jenglish@@users.sourceforge.net>

	* unix/tkUnixWm.c:
	* win/tkWinWm.c:
	* tests/wm.test: Fix for Tk Bug #592201 "wm transient fails with two
	  masters"; fixes panic after a transient window is reassigned to
	  new master and either master is subsequently destroyed.

2002-08-08  Don Porter <dgp@@users.sf.net>

	* tests/unixWm.test:  Corrected packaging of unixWm-50.3 so that
	[setupbg] and [cleanupbg] always balance, no matter what tests
	are skipped.

2002-08-08  Reinhard Max  <max@@suse.de>

	* unix/Makefile.in: Fixed typos in DISTNAME, and ZIPNAME.

2002-08-08  Jeff Hobbs  <jeffh@@ActiveState.com>

	*** 8.4b2 TAGGED FOR RELEASE ***

	* generic/tkButton.c (TkButtonWorldChanged): added GCFont handling
	to the disabledGc of buttons when compound != none.  The drawing
	appears to be incorrect across platforms still.  [Bug #477740]

	* generic/tkImgGIF.c (FileReadGIF): fixed -from handling for gifs
	[Bug #467524] (obermeier)

2002-08-07  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tkCanvUtil.c (TkSmoothParseProc): recognize the built-in
	bezier method by name. [Bug #578654]
	* doc/canvas.n: update to note that -smooth really doesn't take
	or return just booleans.

	* win/tkWinMenu.c (TkpSetWindowMenuBar): fixed logic bug in when
	to idle call ReconfigureWindowsMenu.

	* doc/GetBitmap.3: removed doc refs to deprecated
	Tk_GetBitmapFromData. [Bug #590379]

	* generic/tkPanedWindow.c (Tk_PanedWindowObjCmd): 
	* library/panedwindow.tcl: changed class from PanedWindow to
	Panedwindow to not conflict with existing bwidgets, but also to be
	more regular with other names used in the core.

	* tests/panedwindow.test: added -text foobar to some test buttons
	to enable correct testing of panedwindow across platforms.
	[Bug #582370]

	* win/tkWinDialog.c: enabled use of the updated native Windows
	directory browser (tk_chooseDirectory).  This does require
	shell32.dll v4.71 or greater. [Patch #468139]

	* win/configure:
	* win/tcl.m4: added shell32 to libs for updated native Windows
	tk_chooseDirectory dialog.

2002-08-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tkPanedWindow.c (RESIZE_PENDING): Separated out flag for
	indicating that a resize needs to be issued.
	(PanedWindowReqProc): Do the old behaviour when the panedwindow is
	not mapped; easiest way of making the test suite pass while still
	preserving improved behaviour in the face of children whose size
	is not known immediately.

2002-08-06  Don Porter <dgp@@users.sf.net>

	* tests/defs.tcl: removed file.  No longer needed now that Tk is 
	using the tcltest package to do its testing.

2002-08-05  Don Porter <dgp@@users.sf.net>

	* win/tkWinFont.c:	Additional changes to fix CONST warnings on
	* win/tkWinWM.c:	Windows due to latest patch.  Tks Vince Darley.

	* doc/3DBorder.3:	Applied companion patch for Tcl Patch 585105,
	* doc/BindTable.3:	updating Tk to use Tcl 8.4's fully CONST-ified
	* doc/ConfigWidg.3:	interface, and fully CONSTifying Tk at the
	* doc/CrtImgType.3:	same time.
	* doc/CrtWindow.3:
	* doc/DeleteImg.3:	This patch includes purging Tk of its last
	* doc/FindPhoto.3:	direct access to interp->result.  [Bug 589853]
	* doc/GetAnchor.3:
	* doc/GetBitmap.3:	The substantial changes include copying
	* doc/GetCapStyl.3:	event sequence strings into Tcl_DStrings
	* doc/GetClrmap.3:	in tkBind.c, and copying [text] indices into
	* doc/GetColor.3:	Tcl_DStrings because parsing them involved
	* doc/GetCursor.3:	overwriting them.  If this causes performance
	* doc/GetFont.3:	trouble, that can be resolved by further
	* doc/GetImage.3:	converting them to Tcl_Obj's.
	* doc/GetJoinStl.3:
	* doc/GetJustify.3:	The #defines USE_NON_CONST and USE_COMPAT_CONST
	* doc/GetOption.3:	have the same effect for Tk as they do for Tcl.
	* doc/GetRelief.3:	(They actually change tcl.h)
	* doc/GetScroll.3:
	* doc/GetVisual.3:
	* doc/InternAtom.3:
	* doc/NameOfImg.3:
	* doc/SetAppName.3:
	* doc/WindowId.3:
	* generic/tk.decls:
	* generic/tk.h:
	* generic/tk3d.c:
	* generic/tkAtom.c:
	* generic/tkBind.c:
	* generic/tkBitmap.c:
	* generic/tkButton.c:
	* generic/tkCanvArc.c:
	* generic/tkCanvBmap.c:
	* generic/tkCanvImg.c:
	* generic/tkCanvLine.c:
	* generic/tkCanvPoly.c:
	* generic/tkCanvPs.c:
	* generic/tkCanvText.c:
	* generic/tkCanvUtil.c:
	* generic/tkCanvWind.c:
	* generic/tkCanvas.c:
	* generic/tkCanvas.h:
	* generic/tkClipboard.c:
	* generic/tkCmds.c:
	* generic/tkColor.c:
	* generic/tkConfig.c:
	* generic/tkConsole.c:
	* generic/tkCursor.c:
	* generic/tkDecls.h:
	* generic/tkEntry.c:
	* generic/tkFont.c:
	* generic/tkFrame.c:
	* generic/tkGet.c:
	* generic/tkGrid.c:
	* generic/tkImage.c:
	* generic/tkImgBmap.c:
	* generic/tkImgPhoto.c:
	* generic/tkInt.decls:
	* generic/tkInt.h:
	* generic/tkIntDecls.h:
	* generic/tkIntPlatDecls.h:	
	* generic/tkListbox.c:
	* generic/tkMenu.c:
	* generic/tkMenubutton.c:
	* generic/tkMessage.c:
	* generic/tkOldConfig.c:
	* generic/tkOption.c:
	* generic/tkRectOval.c:
	* generic/tkScale.c:
	* generic/tkScrollbar.c:
	* generic/tkSelect.c:
	* generic/tkStyle.c:
	* generic/tkTest.c:
	* generic/tkText.c:
	* generic/tkText.h:
	* generic/tkTextBTree.c:
	* generic/tkTextDisp.c:
	* generic/tkTextImage.c:
	* generic/tkTextIndex.c:
	* generic/tkTextMark.c:
	* generic/tkTextTag.c:
	* generic/tkTextWind.c:
	* generic/tkUtil.c:
	* generic/tkVisual.c:
	* generic/tkWindow.c:
	* mac/tkMacConfig.c:
	* mac/tkMacCursor.c:
	* mac/tkMacEmbed.c:
	* mac/tkMacSend.c:
	* unix/tkUnixConfig.c:
	* unix/tkUnixCursor.c:
	* unix/tkUnixEmbed.c:
	* unix/tkUnixFont.c:
	* unix/tkUnixSelect.c:
	* unix/tkUnixSend.c:
	* unix/tkUnixWm.c:
	* win/tkWinConfig.c:
	* win/tkWinCursor.c:
	* win/tkWinEmbed.c:
	* win/tkWinMenu.c:
	* win/tkWinSend.c:

2002-08-02  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tkPanedWindow.c (DestroyPanedWindow): Idle calls need to
	be deleted on destruction of the window, or things can *really* go
	pear-shaped.

2002-07-31  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tkPanedWindow.c (PanedWindowReqProc): Postpone pane
	arrangement until idle, as is done in other window managers, to
	fix problems with size calculations when the children don't
	already know their sizes anyway.

	* unix/configure: Regen.
	* unix/tcl.m4: Update from Tcl.

2002-07-29  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/configure.in: Remove code that was setting
	CC_SEARCH_FLAGS and LD_SEARCH_FLAGS to try to
	account for cc vs ld linking. Tcl now handles this.
	* unix/tcl.m4: Update from Tcl.

2002-07-27  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Add MAJOR_VERSION, MINOR_VERSION,
	PATCH_LEVEL, INSTALL_LIBRARY, STUB_LIB_FILE, and LIB_FILE
	to support changes in tcl.m4 related to library builds.
	Use MAKE_LIB macro to avoid dealing with RANLIB issues.
	Rename TK_CC_SEARCH_FLAGS to CC_SEARCH_FLAGS and
	rename TK_LD_SEARCH_FLAGS to LD_SEARCH_FLAGS.
	Use new INSTALL_LIB and INSTALL_STUB_LIB substs to
	deal with ranlib issues when install libraries.
	* unix/configure: Regen.
	* unix/configure.in: Remove AC_PROG_RANLIB since
	this is done by tcl.m4 now. Define CC_SEARCH_FLAGS
	instead of TK_CC_SEARCH_FLAGS and so on.
	Use MAKE_LIB and MAKE_STUB_LIB from tcl.m4.
	Remove AC_SUBST calls that are no done in tcl.m4.
	* unix/tcl.m4: Update from Tcl.
	* unix/tkConfig.sh.in: Subst CC_SEARCH_FLAGS and
	LD_SEARCH_FLAGS.

2002-07-25  Peter Spjuth  <peter.spjuth@@space.se>

	* generic/tkInt.h:
	* generic/tkWindow.c:
	* mac/tkMacWm.c:
	* unix/tkUnixWm.c:
	* win/tkWinWm.c:
	* tests/wm.test:
	* tests/winWm.test:
	* tests/unixWm.test: Objectifed wm. [Patch #564521]
	Note: At this point the Mac file is completely untested
	and may not even compile.

2002-07-25  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/spinbox.test: added spinbox-22.[1-3]
	* generic/tkEntry.c (ConfigureEntry): made the textvariable value
	take precedence over changed -from/-to values, unless it must be
	constrained.  [Bug #559078]

	* library/spinbox.tcl (MouseSelect): when not in the entry, just
	return instead of invoking - ButtonUp handles invoking already.
	[Bug #499168]

	* library/tk.tcl (RestoreFocusGrab): handle the case where the
	FocusGrab info is not set. [Bug #553283]

2002-07-24  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/canvas.test: added canvas-14.[1-6]
	* generic/tkCanvas.c (CanvasWidgetCmd): corrected handling of
	'scan' subcommand args.  Also removed early return cases to goto
	done instead where the canvasPtr would be Tcl_Release'd.  This may
	solve other problems with unreleased canvasPtr's. [Bug #581560]

	* win/tkWinButton.c (TkpDisplayButton): corrected display of focus
	ring around the actual text when the button is a compound button.
	[Bug #583691]

	* unix/README: Corrected notes about running user interactive Tk
	tests. [Bug #462320]

	* generic/tkText.c (TextEditUndo): set isDirtyIncrement to -1 when
	reverting to note proper "dirtiness". [Bug #580362] (callewaert)

	* generic/tkEntry.c (DisplayEntry): correct cursor position before
	calling Tk_SetCaretPos. (yamamoto)

2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/tcl.m4: Update from Tcl.

2002-07-22  Mo DeJong  <mdejong@@users.sourceforge.net>

	* library/choosedir.tcl (tk::dialog::file::chooseDir):
	* library/clrpick.tcl (tk::dialog::file::chooseDir):
	* library/msgbox.tcl (tk::MessageBox):
	* library/tkfbox.tcl (tk::dialog::file):
	* library/xmfbox.tcl (tk::MotifFDialog):
	Revert [Tk patch 568278]. The transient window workaround
	is no longer needed since the fix for [Tk bug 570764]
	solved the problem for withdrawn transients.

2002-07-19  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure:
	* unix/configure.in:
	* win/configure:
	* win/configure.in: Add AC_PREREQ(2.13) in an attempt
	to make it more clear that the configure scripts
	must be generated with autoconf version 2.13.
	[Tcl Bug 583573]

2002-07-19  D. Richard Hipp  <drh@@hwaci.com>

	* library/mkpsec.tcl: Fix a bug that was causing postscript generation
	to fail under Win2K.

2002-07-18  Reinhard Max  <max@@suse.de>

	* unix/tkUnixSend.c: Using Tcl_GetTime instead of TclpGetTime.

2002-07-17  Reinhard Max  <max@@suse.de>

	* library/unsupported.tcl: Extended ExposePrivateVariable, and
	ExposePrivateCommand to accept patterns as well.	

2002-07-17  Don Porter <dgp@@users.sf.net>

	* generic/tkFont.c: Corrected reversed logic in assert -> panic
	conversion.  [Bug 582799]

2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tkFont.c (TkFontPkgFree): Call panic instead
	of assert since assert is not used in the rest of Tk.
	[Tk bug 579651]

2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in:
	* win/Makefile.in: Add a more descriptive warning
	in the event `make genstubs` needs to be rerun.

2002-07-16  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* win/tkWinWm.c: 
	* doc/wm.n: fix for part of [Bug 581627], and made iconbitmap
	code on Windows more flexible about reading in icons [Bug
	220800].

2002-07-15  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.bc (new): re-add of the borland makefile.  Submitted
	by Helmut Giese <hgiese@@ratiosoft.com>.  This needs testing, still.

2002-07-15  Don Porter <dgp@@users.sf.net>

	* Fixes for [Bug 581627, 581795].
	* generic/tkTest.c:		Test commands not supported on non-Unix
	  platforms should not be defined there in the first place.
	* tests/constraints.tcl:	Fixed "secureserver" constraint.
	* tests/unixWm.test:		Some tests needed "unix" constraint.
	* win/tkWinWm.c:		Typo in error message.

2002-07-14  Don Porter <dgp@@users.sf.net>

	* tests/event.test:	Fixes to enable testing of only userInteraction
	* tests/visual_bb.test:	tests.

	* README:		Bumped HEAD to version 8.4b2 in order to 
	* generic/tk.h:		distinguish it from the 8.4b1 release.
	* unix/configure*:	Also extended LOCALES to cover all message
	* unix/tk.spec:		catalogs.
	* win/configure*:

	* tests/focustTcl.test:	Conversion bug: Corrected backwards logic.
	* tests/imgPhoto.test:	Conversion bug: overwrote unix/README.

	* tests/all.tcl:		Completed conversion of Tk test suite
	* tests/constraints.tcl:	to use tcltest.
	* tests/[b-v]*.test:
	* unix/Makefile.in:

2002-07-12  Don Porter <dgp@@users.sf.net>

	* tests/constraints.tcl:	Converted more files to tcltest and
	* tests/[g-x]*.test:		factored out common code.

2002-07-11  Don Porter <dgp@@users.sf.net>

	* tests/canvPsImg.tcl:			Converted several files in the
	* tests/constraints.tcl (new file):	Tk test suite for testing by
	* tests/[r-x]*.test:			tcltest 2.1.
	* unix/Makefile.in:

2002-07-11  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tkWinDialog.c (Tk_ChooseDirectoryObjCmd): initialize
	utfTitle to NULL, add a few more notes about limitations of
	possible new Tk_ChooseDirectoryObjCmd function.

2002-07-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/imgPhoto.test (imgPhoto-15.1): Added test of mem-alloc
	failure, but this is non-portable.
	* generic/tkImgPhoto.c (ImgPhotoSetSize): Allowed this function to
	fail when it can't allocate enough memory.  Note that not all the
	places that call it can fail nicely without API changes; some
	still panic but at least some of the potential failures are now
	handled gracefully.

	* tests/visual_bb.test (lpr): Stopped this from relying on
	external files; direct piping is much more flexible for this
	application.

2002-07-09  Don Porter <dgp@@users.sf.net>

	* generic/tkTest.c:	Removed unused dependence on TclThread_Init()
	* tests/defs.tcl:	and [testthread].  [Bug 578165, Tcl Bug 531413]

2002-07-08  David Gravereaux <davygrvy@@pobox.com>

	* unix/Makefile.in: Added missing win/lamp.bmp to the dist
	target.

2002-07-05  Jeff Hobbs  <jeffh@@ActiveState.com>

	*** 8.4b1 TAGGED FOR RELEASE ***

2002-07-04  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/bgerror.tcl (bgerror): Stopped the bgerror dialog from
	getting wider than the screen; in theory really long messages
	could make it become taller than the screen now, but that's much
	less likely to happen.  Also trimmed a little bit of internal
	space so that the icon-message gap is the same as the icon-frame
	and message-frame gaps.

2002-07-01  Don Porter <dgp@@users.sf.net>

	* unix/configure:
	* unix/tcl.m4: Updated to latest tcl.m4 from Tcl.

2002-06-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/msgbox.tcl (MessageBox): Force all non-button widgets to
	have the same background as the containing toplevel.  [Bug #552515]

2002-06-27  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* win/Makefile.in (install-binaries): Fix of troubled Makefile
	quoting introduced by [Patch 521356] causing the installed to
	fail.

2002-06-25  Don Porter <dgp@@users.sf.net>

	* unix/tkUnixFont.c: (Tk_DrawChars) silence compiler warning.

2002-06-26  David Gravereaux <davygrvy@@pobox.com>

	* generic/tkStyle.c: <eol> of the committing cvs client didn't
	match the <eol> of the file itself.  Windows users where getting
	\r\r\n.  Problem fixed.

2002-06-26  Anton Kovalenko <a_kovalenko@@users.sourceforge.net>

	* generic/tkFont.c (TkTextLayoutToPostscript): fixed potential
	buffer overflow which could be intentionally triggered from
	within safe interpreter -- malicious applet could modify 
	tk::psglyphs array.

2002-06-26  Anton Kovalenko <a_kovalenko@@users.sourceforge.net>

	* tests/font.test (font-32.1): updated this test
	to expect the new behavior of canvas postscript.

2002-06-25  Don Porter <dgp@@users.sf.net>

	* unix/Makefile.in:	Expanded install-binaries target to create
	* win/Makefile.in:	and install a pkgIndex.tcl file to enable
	Tk as a loadable package [Patch 521356]

2002-06-25  Anton Kovalenko <a_kovalenko@@users.sourceforge.net>

	* library/mkpsenc.tcl: (added) utilities to generate
	Postscript prolog for current system encoding.
	* generic/tkCanvPs.c (TkCanvPostscriptCmd): now
	uses mkpsenc.tcl to generate Postscript prolog.
	* generic/tkFont.c (TkTextLayoutToPostscript): modified
	according to patch #546910. Now outputs system-encoded
	characters (for unibyte) or Adobe glyph names (for
	multibyte or outside-locale).
	* tests/canvText.test (canvText-17.1): updated this test
	to expect the new behavior of canvas postscript.

2002-06-25  Reinhard Max  <max@@suse.de>

	* unix/tcl.m4:       New macro SC_CONFIG_MANPAGES.
	* unix/configure.in: Added support for symlinks and compression
	* unix/Makefile.in:  when installing the manpages. [Patch 518052]
	                     Default is still hardlinks and no compression.

	* unix/mkLinks:      generated
	* unix/configure:

	* unix/README:       Added documentation for the new features.

	* unix/configure:                  Replaced ${exec_prefix}/lib
	* unix/tcl.m4 (SC_PATH_TCLCONFIG): by ${libdir}.

2002-06-24  Mo DeJong  <mdejong@@users.sourceforge.net>

	* tests/winWm.test: Verify that both an unmapped
	and already mapped toplevel are raised and receive
	the focus when deiconified.
	* tests/wm.test: Add wm deiconify tests. Check that
	a toplevel that has never been mapped is not mapped
	by the deiconify command since it should be done
	at idle by MapFrame.
	* win/tkWinWm.c (Tk_WmCmd): Check the WM_NEVER_MAPPED
	flag while processing the wm deiconify command.
	The WM_UPDATE_PENDING flag should never be set when
	WM_NEVER_MAPPED is set, but double check so that
	the implementation is more explicit and matches
	the comment just above.
	Return without invoking TkWmRestackToplevel or
	TkSetFocusWin on a toplevel that has never been
	mapped. This fixes a bug where a toplevel is mapped
	with the wrong size and is then resized by the
	idle call to MapFrame. [Tk bug 233150]

2002-06-23  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tkWinWm.c (UpdateGeometryInfo): remove the check for a null
	wrapper introduced in r1.41 on 2002-06-15 because it prevented
	geometry setting from taking effect if the window was not on the
	screen.  Another check may go in it's place as IsIconic and
	IsZoomed should not be passed NULL.

2002-06-22  Mo DeJong  <mdejong@@users.sourceforge.net>

	* tests/wm.test: Remove invalid minsize test. Add update
	calls to wm transient tests so that idle handlers get
	run. This is needed to get the tests to pass under Win32.
	* unix/tkUnixWm.c (WmWaitMapProc): Move the special
	transient withdrawn check into the if body to
	make it easier to set a breakpoint on this test
	inside a debugger. No functional changes.
	* win/tkWinWm.c (WmWaitVisibilityOrMapProc): Ditto.

2002-06-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	* doc/wm.n:                   TIP #95 Windows implementation and
	* mac/tkMacWm.c (Tk_WmCmd):   docs with mac and unix stubs.
	* unix/tkUnixWm.c (Tk_WmCmd):
	* win/tkWinWm.c (Tk_WmCmd):
	* tests/unixWm.test:
	* tests/winWm.test: more wm attr tests will be needed.

	* generic/tkGrid.c (GridReqProc): check that gridPtr is not NULL
	(may be when embedded). [Bug #548791] (halliday)

	* generic/tkFont.c (TkFontPkgFree): changed panic on freeing fonts
	to an assert, and wrapped panic in #ifdef PURIFY. [Bug #568701]

	* library/menu.tcl: corrected menus from being posted offscreen
	on Windows. [Bug #464451] (darley)

	* library/console.tcl: corrected the defaultPrompt substitution
	[Bug #553207] and made Tab a default expansion key (like Escape).

	* win/tkWinEmbed.c (EmbedWindowDeleted): added a check for a null
	containerPtr.  The core of this bug is likely elsewhere. [Bug #476176]

	* doc/text.n:                             TIP #93 implementation that
	* generic/tkText.c (TextWidgetCmd):       enhances the text get and
	* generic/tkTextIndex.c (TkTextGetIndex): delete methods to accept
	* tests/text.test:                        multiple range pairs.
	This handles the delete case in an atomic, fixed-index fashion.

2002-06-21  Mo DeJong  <mdejong@@users.sourceforge.net>

	* tests/wm.test: Add tests to make sure a withdrawn
	transient does not get remapped by state changes
	in the master.
	* unix/tkUnixWm.c (Tk_WmCmd, WmWaitMapProc):
	* win/tkWinWm.c (Tk_WmCmd, WmWaitVisibilityOrMapProc):
	Add a WM_TRANSIENT_WITHDRAWN flag that gets set by the
	withdraw, deiconify, or state wm subcommands. Check
	this flag before mapping a transient when processing
	a MapNotify event. [Tk bug 570764]

2002-06-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tk.spec (version), README, win/configure.in, unix/configure.in: 
	* generic/tk.h (TK_RELEASE_*, TK_PATCH_LEVEL): Bumped to beta1.

2002-06-21  Jeff Hobbs  <jeffh@@ActiveState.com>

	* doc/text.n:          TIP #104 implementation which generalizes the
	* generic/tkText.c:    undo/redo stack to not be tied solely to the
	* generic/tkText.h:    text widget.  The APIs are still private.
	* generic/tkUndo.c:    This also adds a stack limiting ability and
	* generic/tkUndo.h:    a -maxundo option to the text widget (in
	* library/text.tcl:    addition to the options from TIP #26) should
	* mac/tkMacDefault.h:  users want to limit the undo/redo stack
	* tests/text.test:     (should not be necessary in most cases).
	* unix/Makefile.in:    [Patch #554763] (callewart)
	* unix/tkUnixDefault.h:
	* win/Makefile.in:
	* win/makefile.vc:
	* win/tkWinDefault.h:

2002-06-21  Don Porter <dgp@@users.sf.net>

	* unix/Makefile.in:	Removed unnecessary dependence of tktest
	* unix/tkAppInit.c:	executable on the tcltest executable on
	Unix.  If there are similar dependencies on other platforms, they
	can probably be removed as well.  [Bug 572134].

2002-06-20  Jeff Hobbs  <jeffh@@ActiveState.com>

	* doc/listbox.n:
	* generic/tkListbox.c (DisplayListbox): 
	* mac/tkMacDefault.h:   TIP #94 implementation adding -activestyle
	* tests/listbox.test:   option to the listbox.  This adds the ability 
	* unix/tkUnixDefault.h: to have listboxes look native on Windows, and
	* win/tkWinDefault.h:   "nicer" elsewhere using the 'dotbox' style.

2002-06-20  Peter Spjuth  <peter.spjuth@@space.se>

	* generic/tkGrid.c: Corrected the test for grid propagate change.
	[Bug #571433]

2002-06-19  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/panedwindow.test:
	* generic/tkPanedWindow.c: ensure that sash index is lower bounds
	checked. [Bug #548727]

2002-06-19  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tkClipboard.c (TkClipCleanup): Add code
	to set dispPtr->clipWindow to NULL, this was
	accidently removed by last commit. Fixes
	a crash while running the tests under win32.

2002-06-19  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tkBind.c (TkBindDeadWindow):
	Handle case where Tk_DestroyWindow is invoked
	on clipboard and send windows.
	* generic/tkClipboard.c (TkClipCleanup):
	Invoke Tk_DestroyWindow to cleanup the
	dispPtr->clipWindow. Call Tcl_Preserve
	and Tcl_Release on the window to avoid an
	invalid memory ref on shutdown.
	* generic/tkEvent.c (Tk_HandleEvent):
	Panic if XCreateIC is invoked twice for
	the same window. This should never happen,
	the check were just added to make sure it
	does not since this could lead to crashes
	in XCloseIM.
	* generic/tkFocus.c (TkFocusDeadWindow):
	Handle case where Tk_DestroyWindow is invoked
	on clipboard and send windows.
	* generic/tkOption.c (TkOptionDeadWindow): Ditto.
	* generic/tkWindow.c (TkCloseDisplay): Move
	deletion of dispPtr->winTable after TkpCloseDisplay
	call since Tk_DestroyWindow uses it and could
	be called by TkpCloseDisplay for clipboard/send windows.
	Also invoke ckfree for the dispPtr instead of
	doing it in TkpCloseDisplay.
	(Tk_DestroyWindow): Check for a null winPtr->mainPtr
	before doing certain cleanup tasks so the we can
	invoke Tk_DestroyWindow on clipboard and send windows.
	We need to do this so that XDestroyIC will get invoked
	for the input contexts of each window.
	* mac/tkMacXStubs.c (TkpCloseDisplay): Don't free
	the displayPtr since this is now done in TkCloseDisplay.
	* unix/tkUnixEvent.c (TkpCloseDisplay, OpenIM): Remove
	conditional compilation around calls to XCloseIM
	since I am confident that the crashes related to
	input contexts has been fixed. Don't free
	the displayPtr since this is now done in TkCloseDisplay.
	* unix/tkUnixSend.c (TkSendCleanup): Invoke the
	Tk_DestroyWindow method to cleanup the special
	send window. This will call XDestroyIC and thereby
	avoid a crash in XCloseIM. The send window needs
	to be Tcl_Preserve and Tcl_Release to avoid an
	invalid memory ref on shutdown.
	* win/tkWinX.c (TkpCloseDisplay): Don't free
	the displayPtr since this is now done in TkCloseDisplay.
	[Tk patch 570902]

2002-06-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tkStyle.c: TIP#48 style engine.
	See http://purl.org/tcl/tip/48.html for details.

	* generic/tkConfig.c (GetOptionFromObj): Split to allow for access
	to option tables via name as well as via object.
	(TkGetOptionSpec): Semi-public interface to GetOption functionality.
	(DoObjConfig, Tk_RestoreSavedOptions, FreeResources)
	(GetObjectForOption): Basic style support for configure.

	* generic/tkWindow.c (TkCreateMainWindow, Tk_DestroyWindow): Added
	calls to set up and tear down the style subsystem.

	* generic/tk.decls, generic/tk.h: Many declarations forming TIP#48
	public interface.

	* generic/tkInt.decls (TkStylePkgInit,TkStylePkgFree): 
	* generic/tkInt.h (TkGetOptionSpec): Supporting declarations.

	* unix/Makefile.in, win/Makefile.in, win/makefile.vc: Added
	tkStyle.c to list of generic source files.

2002-06-18  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/defs.tcl (makeFile): Defined the return value of this
	procedure to be the filename of the created file, as in the real
	tcltest package...

2002-06-17  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tkImage.c (Tk_ImageObjCmd, DeleteImage): Call
	Tcl_Preserve and Tcl_Release for the masterPtr->winPtr
	window to avoid accessing memory that had already
	been deallocated in DeleteImage.

2002-06-17  David Gravereaux <davygrvy@@pobox.com>

	Trims to support the removal of RESOURCE_INCLUDED from rc
	scripts from Tcl's accepted FR #565088.

	* generic/tk.h: Changed RESOURCE_INCLUDED to be RC_INVOKED
	as the RC tool defines this already by default.

	* win/rc/tk.rc:
	* win/rc/wish.rc: removed the #define RESOURCE_INCLUDED lines.

2002-06-17  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/Makefile.in (dist): correct installation of
	wish.exe.manifest to DISTDIR target directory.

	* generic/tkCmds.c (Tk_TkObjCmd): 
	* generic/tkInt.h (struct TkCaret): 
	* mac/tkMacXStubs.c (Tk_SetCaretPos): 
	* unix/tkUnixKey.c (TkpGetString, Tk_SetCaretPos): 
	* win/tkWinX.c (Tk_SetCaretPos): 
	* tests/tk.test:        Added 'tk caret' implementation of TIP#96
	* doc/SetCaret.3 (new): which adds a TkCaret structure element to
	* doc/tk.n:             TkDisplay for maintaining state.

	* unix/tkUnixSend.c (TkSendCleanup): special cleanup of
	inputContext to avoid bug in XCloseIM. (dejong)

2002-06-17  Don Porter <dgp@@users.sf.net>

	* library/msgs/en_gb.msg:  Added catalog for UK English.
	Currently includes only Color -> Colour translation.

2002-06-17  D. Richard Hipp  <drh@@hwaci.com>

	* doc/checkbutton.n:
	* doc/radiobutton.n:
	* generic/tkButton.c:
	* generic/tkButton.h:
	* mac/tkMacButton.c:
	* tests/button.test:
	* unix/tkUnixButton.c:
	* win/tkWinButton.c: Implementation of TIP#82 - Added the
	-offrelief option to checkbutton and radiobutton.

2002-06-14  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tkWindow.c (Tk_DestroyWindow): Set the pathName
	component of a window to NULL after its memory has been
	deallocated to avoid a possible illegal memory access
	as a result of a call to Tk_PathName() on a Tk_Window
	structure of a window that has already been destroyed.
	[Tk bug 521946]

2002-06-14  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tkOption.c (Tk_GetOption): Allocate
	memory with ckalloc not malloc. This keeps
	Tk from erroring out when built with
	TCL_MEM_DEBUG.

2002-06-14  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tkBind.c (HandleEventGenerate): 
	* generic/tkInt.h: changed warpInProgress boolean from int to a
	bit in the flags variable (TK_DISPLAY_IN_WARP)

	* generic/tkCmds.c (Tk_TkObjCmd): 
	* unix/tkUnixKey.c (TkpGetString): 
	* generic/tkEvent.c (Tk_HandleEvent): 
	* generic/tkInt.h: changed useInputMethods boolean from int to a
	bit in the flags variable (TK_DISPLAY_USE_IM)

	* generic/tkInt.h:
	* generic/tkCmds.c (Tk_WmObjCmd): 
	* unix/tkUnixWm.c (Tk_WmCmd): 
	* win/tkWinWm.c (Tk_WmCmd): changed wmTracing from being an int to
	just a bit in the flags variable (TK_DISPLAY_WM_TRACING)

	* generic/tkEvent.c (Tk_HandleEvent): 
	* unix/tkUnixEvent.c (OpenIM): 
	* unix/tkUnixKey.c (TkpGetString): 
	* generic/tkInt.h: added TK_DISPLAY_XIM_SPOT flag bit for TkDisplay
	and used this to allow a runtime check to see if over-the-spot XIM
	is possible.  If not it will try and fallback to the old-style
	input context, which handles things like dead keys input.

	* generic/tk.decls:     added TIP #84 implementation that adds a
	* generic/tkDecls.h:    Tk_CollapseMotionEvents API which controls
	* generic/tkEvent.c:    Tk's collapsing of incoming motion events
	* generic/tkInt.h:      on its windows.  The default remains to do
	* generic/tkStubInit.c: collapsing.  Added a flags parameter to the
	* generic/tkWindow.c:   internal display structure to support this
	* doc/QWinEvent.3:      and be used in the future for other bits.
	                        [Tk patch 564642]

	* unix/mkLinks: updated from current docs

2002-06-14  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tkEvent.c (TkXErrorHandler): Declare static
	function to avoid compiler error with VC++.
	* generic/tkBind.c (ExpandPercents): Cast argument to
	Tk_GetAtomName in order to avoid compiler warning.

2002-06-14  Joe English  <jenglish@@users.sf.net>

	* doc/bind.n:
	* generic/tk.h:
	* generic/tkBind.c:
	* generic/tkCanvWind.c:
	* generic/tkCmds.c:
	* generic/tkEvent.c:
	* generic/tkFocus.c:
	* generic/tkGrab.c:
	* generic/tkGrid.c:
	* generic/tkImage.c:
	* generic/tkPack.c:
	* generic/tkPlace.c:
	* generic/tkPointer.c:
	* generic/tkTextWind.c:
	* generic/tkWindow.c:
	* mac/tkMacSubwindows.c:
	* mac/tkMacWindowMgr.c
	* mac/tkMacWm.c:
	* unix/Makefile.in:
	* unix/tkUnixEmbed.c:
	* unix/tkUnixWm.c:
	* win/tkWinScrlbr.c:
	* win/tkWinWindow.c:
	* win/tkWinWm.c: Implementation of TIP #47 by Neil McKay
	"Modifying Tk to Allow Writing X Window managers".
	Add CirculateRequest, Create, MapRequest, ResizeRequest, 
	and ConfigureRequest event types;
	Split TK_TOPLEVEL flag into TK_TOPLEVEL, TK_HAS_WRAPPER,
	TK_WIN_MANAGED, and TK_TOP_HIERARCHY. [Tk patch 572978]

2002-06-14  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* unix/tkAppInit.c: Removed now unneeded and erroneous reference
	  to 'matherr'. See Tcl ChangeLog entry 2002-05-31 Don Porter.

2002-06-14  David Gravereaux <davygrvy@@pobox.com>

	* win/rules.vc: The test for compiler optimizations was in error.
	Thanks goes to Roy Terry <royterry@@earthlink.net> for his
	assistance with this.

2002-06-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	Implement TIP 98  [Tk patch 566765]
	
	* doc/FindPhoto.3, generic/tk.h, generic/tk.decls:
	* generic/tkImgPhoto.c: Changed *_Old to *_NoComposite and
	USE_OLD_PHOTO_PUT_BLOCK to USE_COMPOSITELESS_PHOTO_PUT_BLOCK
	following a suggestion from Don Porter. 

	* tests/imgPhoto.test: Added tests of -compositingrule

	* doc/photo.n: Added documentation for "-compositingrule".
	* generic/tkImgPhoto.c (ImgPhotoCmd, ParseSubcommandOptions): New
	"-compositingrule" option for [$photo copy] subcommand, using
	OPT_COMPOSITE flag and compositingRule field in SubcommandOptions
	structure.

	* doc/FindPhoto.3: Documented the extra argument for the
	compositing rule and the action to take if anyone wants to
	maintain total backward-compatability.

	* generic/tk.h (TK_PHOTO_COMPOSITE_*): Defined values for use as
	compositing rules. 
	(USE_OLD_PHOTO_PUT_BLOCK): Added a way for users to select the old
	interface to Tk_PhotoPutBlock to provide an easier upgrade path.

	* generic/tk.decls: Alter Tk_PhotoPut*Block to Tk_PhotoPut*Block_Old
	and introduce new slots for the old name of function with an extra
	argument at the end for the compositing rule.

	* generic/tkImgPhoto.c (ImgPhotoCmd): Updated "transparency set"
	subcommand to use TkSubtractRegion().

	* win/tkWinRegion.c (TkSubtractRegion): 
	* mac/tkMacRegion.c (TkSubtractRegion): 
	* generic/tkInt.decls (TkSubtractRegion): 
	* unix/tkUnixPort.h (TkSubtractRegion): Added function to perform
	the set-difference operation on regions; it seems all platforms
	can support it, and it makes removing rectangular bits from
	regions much easier.

	* generic/tkImgPPM.c (FileReadPPM): Reading a PPM/PGM always uses
	the SET compositing rule because it is faster and the format does
	not have any transparency information.

	* generic/tkImgGIF.c (FileReadGIF): Reading a GIF always uses the
	SET compositing rule because GIF files model transparency as a
	single special colour.

	* generic/tkImgPhoto.c (Tk_PhotoPutBlock, Tk_PhotoPutZoomedBlock):
	Added a compositing rule to allow better control over what happens
	to transparent pixels when inserting data into a photo image.

2002-06-13  Mo DeJong  <mdejong@@users.sourceforge.net>

	* tests/winfo.test: Add basic tests for winfo ismapped.

2002-06-13  Mo DeJong  <mdejong@@users.sourceforge.net>

	* tests/unixWm.test:
	* tests/wm.test: Move wm minsize and wm maxsize
	usage tests into the cross platform wm tests.

2002-06-13  Don Porter <dgp@@users.sf.net>

	* tests/cursor.test:  corrected error after cursor-2.2.
	* tests/defs.tcl: Added enhancements to Tk's fake version of
	tcltest required by recent cursor.test changes.

2002-06-13  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/cursor.test (cursor-2.[34]): Tests added to ensure that
	cursor specs really are well-behaved lists.  Also some general
	clean-up...
	* win/tkWinCursor.c (TkGetCursorByName): Undone Jeff's back-off
	and fixed things so that they should work now.  Cursor specs are
	lists first and foremost.

2002-06-12  Mo DeJong  <mdejong@@users.sourceforge.net>

	* changes: Clearly label wm transient changes as
	a POTENTIAL INCOMPATIBILITY. 
	* doc/wm.n: Remove "some window managers will" text
	and explicitly state what behavior a transient
	window will display. Also mention that it is an
	error to make a window a transient of itself.

2002-06-12  Mo DeJong  <mdejong@@users.sourceforge.net>

	* library/choosedir.tcl (tk::dialog::file::chooseDir):
	* library/clrpick.tcl (tk::dialog::file::chooseDir):
	* library/msgbox.tcl (tk::MessageBox):
	* library/tkfbox.tcl (tk::dialog::file):
	* library/xmfbox.tcl (tk::MotifFDialog): Remove the
	transient property on dialogs after they have been
	dismissed to insulate them from further state changes
	in the master. This keeps a withdrawn dialog from
	being mapped when the master is deiconified. [Tk patch 568278]

2002-06-12  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tkWinCursor.c (TkGetCursorByName): reverted fix from
	2002-06-06 because it broke the ability to use built-in cursors
	like left_ptr.

2002-06-12  Mo DeJong  <mdejong@@users.sourceforge.net>

	* library/choosedir.tcl (tk::dialog::file::chooseDir):
	* library/clrpick.tcl (tk::dialog::color):
	* library/dialog.tcl (tk_dialog):
	* library/msgbox.tcl (tk::MessageBox):
	* library/tkfbox.tcl (tk::dialog::file):
	* library/xmfbox.tcl (tk::MotifFDialog_Create):
	Only make the dialog window a transient if
	the master is visible. This check already
	appeared in some of the dialogs. This patch
	just copies the check into those that were
	lacking. [Tk patch 568253]

2002-06-12  Mo DeJong  <mdejong@@users.sourceforge.net>

	* changes: Add note about new transient behavior.
	* tests/unixWm.test: Check that the WM_TRANSIENT_FOR
	property for a transient window is being cleared
	when the master is destroyed.
	* tests/wm.test: Source defs.tcl instead of using
	tcltest to match the rest of Tk's test files.
	Add new tests that ensure that a transient's state
	mirrors the state of the master.
	* unix/tkUnixWm.c (WmInfo, TkWmNewWindow, TkWmMapWindow,
	TkWmDeadWindow, Tk_WmCmd, WmWaitMapProc): Add numTransients
	member to WmInfo structure. Keep state of master and
	transient in sync using a callback that tracks MapNotify
	and UnmapNotify events. When the master is mapped, map
	the transient. When the master is unmapped or iconified,
	withdraw the transient.
	* win/tkWinWm.c (TkWmMapWindow, TkpWmSetState,
	TkWmDeadWindow, Tk_WmCmd, WmWaitVisibilityOrMapProc):
	Keep state of master and transient in sync using a
	callback that tracks MapNotify and UnmapNotify events.
	Move masterPtr check from TkpWmSetState into TkWmMapWindow
	to deal with WM_NEVER_MAPPED transients. Cleanup
	numTransients and the callback in TkWmDeadWindow.
	Cleanup numTransients and the callback only after
	deleting a master in wm transient command to avoid
	deleting the callback when an error is raised.
	Add support for MapNotify and UnmapNotify events
	to the master callback. [Tk patch 561708]

2002-06-11  Joe English  <jenglish@@users.sf.net>

	* library/menu.tcl: fix for bug report #530212 "Bad Window Path 
	  Name in tkMenuFind"

2002-06-10  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.vc: Fixed a win98 issue where the /exclude option
	for xcopy is unsupported.
	Reported by Roy Terry <royterry@@earthlink.net>.

2002-06-10  Anton Kovalenko <a_kovalenko@@users.sourceforge.net>

	* library/tk.tcl: added utility functions to get "-underline" and 
	"-text" for labels and buttons from translatable string containing 
	"magic ampersand" [patch #566605]
	* library/clrpick.tcl:
	* library/msgbox.tcl:
	* library/tkfbox.tcl:
	* library/xmfbox.tcl: some places where msgcat is used to get
	translated label are modified to handle labels with magic ampersand.
	* library/msgs/ru.msg: russian translations added
	* library/msgs/cs.msg:
	* library/msgs/de.msg:
	* library/msgs/el.msg: 
	* library/msgs/es.msg:
	* library/msgs/fr.msg:
	* library/msgs/it.msg:
	* library/msgs/nl.msg: all translation files now have labels with
	'magic ampersand' where appropriate. In el.msg some ampersands are
	missing, as I don't know which underline positions seems natural
	to "el" users.

2002-06-09  Mo DeJong  <mdejong@@users.sourceforge.net>

	* library/bgerror.tcl (tk::dialog::error::bgerror):
	Don't set the bgerror dialog as a transient of
	itself since this operation is ill defined.

2002-06-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* win/tkWinCursor.c (TkGetCursorByName): Fixed so that the reading
	of cursors from a file with a cursor spec was built using [list]
	works when the file has a space in instead of requiring fiddling
	with backslashes.

2002-06-06  Anton Kovalenko <a_kovalenko@@users.sourceforge.net>

	* library/msgbox.tcl (MessageBox): Add -default normal
	when creating non-default buttons for message box.
	They already get -default normal when they're 
	unfocused, and dialog window size used to change suddenly
	in such cases.

2002-06-05  Anton Kovalenko <a_kovalenko@@users.sourceforge.net>

	* unix/tkUnixFont.c (Tk_DrawChars): Don't assume that
	one char is always one byte, and that required 
	subfont for the last character in any string is 
	the same as for the previous character 
	[Bug #559435] [Patch #559437]

2002-05-27  Mo DeJong  <mdejong@@users.sourceforge.net>

	* changes: Document [wm transient .t .t] error.
	* tests/wm.test: Check that setting a window
	as a transient of itself raises an error. Check
	that passing a non-toplevel window to the wm
	transient command uses the enclosing toplevel.
	* unix/tkUnixWm.c (Tk_WmCmd): Raise an error
	if the user tries to make a toplevel a
	transient of itself.
	* win/tkWinWm.c (Tk_WmCmd): Raise an error
	if the user tries to make a toplevel a
	transient of itself. Test for other error
	before checking for the transient self error.

2002-05-27  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tkUnixWm.c (WmInfo, TkWmCleanup, TkWmNewWindow,
	TkWmMapWindow, TkWmDeadWindow, Tk_WmCmd): Replace
	WmInfo's master and masterWindowName members with
	a masterPtr member. This implementation is much
	simpler and mirrors the Win32 implementation. This
	change makes it easy to check the flags of the
	master window. No user visible changes.

2002-05-27  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tkInt.decls: Add unix decl for TkpWmSetState.
	* generic/tkIntPlatDecls.h: Regen.
	* generic/tkStubInit.c: Regen.
	* tests/wm.test: Test state changes between iconic,
	normal, and withdrawn both before and after initial
	mapping.
	* unix/tkUnixWm.c (Tk_WmCmd, TkpWmSetState): Move
	state change code into TkpWmSetState to more closely
	match the Win32 implementation. No user visible changes.

2002-05-27  Mo DeJong  <mdejong@@users.sourceforge.net>

	* tests/embed.test: Added cross platform embed tests.
	Check that window passed to -use has the -container
	option set.
	* tests/wm.test: Remove useless catch call. Deiconify
	. just in case, stackorder tests will not pass unless
	it is in the normal state. Add -container flag to
	embedded stackorder test.
	* unix/tkUnixEmbed.c (TkpUseWindow):
	* win/tkWinEmbed.c (TkpUseWindow): Lookup Tk window
	based on the id passed in as the value for -use.
	Generate an error if the Tk window did not have
	the -container option set.

2002-05-26  Peter Spjuth <peter.spjuth@@space.se>

	* generic/tkButton.c (ConfigureButton): When creating
	a radiobutton with -value "" it was not drawn properly
	if the -variable was created by the radiobutton.
	[Bug #548765]

2002-05-26  Peter Spjuth <peter.spjuth@@space.se>

	* generic/tkCanvText.c (ComputeTextBbox): Negative
	coordinates were rounded badly causing a 1 pixel
	displacement. [Bug #556526]
	
2002-05-24  Mo DeJong  <mdejong@@users.sourceforge.net>

	* mac/tkMacWm.c (Tk_WmCmd):
	* tests/unixWm.test: Move wm transient checks over
	to wm.test so they will be run on all systems.
	* tests/wm.test: Add tests to check for error when
	an iconwindow is passed to the wm transient command.
	* unix/tkUnixWm.c (Tk_WmCmd):
	* win/tkWinWm.c (Tk_WmCmd): Raise an error if one
	of the windows passed to the wm transient command
	is an iconwindow for another toplevel.

2002-05-23  Mo DeJong  <mdejong@@users.sourceforge.net>

	* mac/tkMacWm.c (TkWmStackorderToplevelWrapperMap):
	* tests/wm.test: Add embedded Window test case for
	the stackorder command.
	* unix/tkUnixWm.c (TkWmStackorderToplevelWrapperMap):
	* win/tkWinWm.c (TkWmStackorderToplevelWrapperMap):
	Ignore embedded windows during wm stackorder command.

2002-05-21  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/configure.in: Invoke SC_ENABLE_SHARED before
	calling SC_CONFIG_CFLAGS so that the SHARED_BUILD
	variable can be checked inside SC_CONFIG_CFLAGS.
	* unix/tcl.m4: Update from Tcl.

2002-05-20  Don Porter  <dgp@@users.sourceforge.net>

	* library/tk.tcl:  A little namespace cleanup on Daniel Steffen's
	latest revisions to avoid defining new global commands.

2002-05-20  Daniel Steffen  <das@@users.sourceforge.net>

	* mac/tkMacInit.c:
	* mac/tkMacTclCode.r: include msgcat package in resources
	as bgerror depends on it. Restores ability of mac static
	build to run standalone (except for encoding file issues).

	* mac/tkMacInit.c:
	* library/console.tcl:
	* library/tk.tcl: fix tk.tcl not sourcing library files
	that define bindings at startup on mac. (independent of
	tk library files being in resources or on auto_path)

2002-05-08  Don Porter  <dgp@@users.sourceforge.net>

	* library/bgerror.tcl:
	* library/tclIndex:  Cleaned up namespace usage of the bgerror
	dialog.  Completes soft dependence on msgcat.  [FR 539309]

2002-05-07  David Gravereaux  <davygrvy@@pobox.com>
	* win/makefile.vc: Problem with TCLDIR macro not accepting
	forward slash path seperators resolved.  Added the same logic
	to INSTALLDIR, too. [Bug #553208]

2002-04-26  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure:
	* unix/tcl.m4: change HP-11 SHLIB_LD_LIBS from "" to ${LIBS} so
	that the .sl knows its dependent libs.

2002-04-24  Daniel Steffen  <das@@users.sourceforge.net>

	* mac/tkMacTclCode.r:
	* mac/tkMacResource.r: added check of
	TCLTK_NO_LIBRARY_TEXT_RESOURCES #define to allow disabling the
	inclusion of the tk library code in the resource fork of Tk
	executables and shared libraries.
	Moved tk library code inclusion to separate file like in tcl.
	Added 'panedwindow' resource.

2002-04-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/button.tcl (ButtonLeave): corrected the 3
	implementations of ButtonLeave to check for Priv(relief) existing
	before trying to use it. [Patch #541849]

	* generic/tkTextDisp.c (DisplayLineBackground): 
	* unix/tkUnix3d.c (Tk_3DHorizontalBevel): 
	* unix/tkUnixFont.c (Tk_DrawChars): applied fixes to not overrun
	the X window 16-bit size limit. [Patch #541999] (bonfield)

2002-04-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tkTextDisp.c (GetXView, GetYView): Comparison with
	previous values of scrollbar range are now done in a way that is
	sensitive to the bizarreness of floating-point on architectures
	where IEEE-FP is not used on the processor.  Also increased the
	size of the temporary buffer to take account of the fact that
	TCL_DOUBLE_SPACE is meant to only imply enough space to take a
	printed double and trailing '\0', and no more.  [Bug #223739]
	(FP_EQUAL_SCALE): New macro to help compare floating-point numbers
	for equality in a sane way, used in GetXView and GetYView.

2002-04-12  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tkWindow.c (TkCloseDisplay): Added to centralize where a
	display was closed.  This handles freeing memory associated with a
	display and closing it.
	(DeleteWindowsExitProc): actually close displays.  This would also
	ideally be done in Tk_DestroyWindow when the last window on the
	display has been closed, but that still has unresolved order of
	cleanup problems.
	(Tk_DestroyWindow): added TkFocusFree call.

	* generic/tkStubInit.c:
	* generic/tkIntPlatDecls.h:
	* generic/tkIntDecls.h:
	* generic/tkInt.decls: added TkFocusFree, TkClipCleanup and
	TkGCCleanup generic private procs, and TkWmCleanup, TkSendCleanup
	and TkFreeXId unix private procs.

	* generic/tkInt.h:
	* unix/tkUnixXId.c (TkFreeXId): frees XID resources.
	Made idCleanupScheduled a Tcl_TimerToken (was int) in TkDisplay
	structure to allow us to delete the timer scheduled for it.

	* unix/tkUnixWm.c (TkWmStackorderToplevel): ensure children
	structure is freed.
	(ConfigureEvent, ComputeReparentGeometry): Add extra wm tracing info
	(TkWmRestackToplevel): initialize changes to 0 to prevent UMR.
	Use WaitForConfigureNotify on all windows.  This part still
	requires fixing as it is the root of the 2 second raise delay on
	some window managers (those that use extra wrapper windows of
	their own).

	* unix/tkUnixSend.c (TkSendCleanup): free send-related resources

	* unix/tkUnixEvent.c (TkpCloseDisplay): call TkSendCleanup and
	TkWmCleanup.

	* unix/tkUnixSelect.c (SelRcvIncrProc): added missing Tcl_Release
	of interp

	* generic/tkGet.c (FreeUidThreadExitProc): free thread-specific
	resources on thread exit

	* generic/tkFocus.c (TkFocusFree): frees TkMainInfo data
	* generic/tkClipboard.c (TkClipCleanup): frees TkDisplay data
	* generic/tkGC.c (TkGCCleanup): frees TkDisplay data

	* unix/tkUnixFont.c (FontPkgCleanup): cleanup thread specific font
	resources on thread exit.

	* mac/tkMacXStubs.c (TkpOpenDisplay): memset the initial display
	structures to 0.

	* generic/tkOption.c (OptionThreadExitProc): freed tsd option
	stacks on thread exit.
	(Tk_GetOption): free mem used to get Tk_Uid

	* generic/tkMenu.c (ConfigureMenu): freed saved options in all
	error cases.

	* win/tkWinInt.h: declaration for TkWinGetUnicodeEncoding
	* win/tkWinDialog.c (GetFileNameW): use TkWinGetUnicodeEncoding
	* win/tkWinInit.c (TkpDisplayWarning): use TkWinGetUnicodeEncoding
	* win/tkWinFont.c: use TkWinGetUnicodeEncoding instead of static
	unicodeEncoding.

	* win/tkWinX.c (Tk_SetCaretPos): remove WM_IME_STARTCOMPOSITION
	and place the IME position within Tk_SetCaretPos.  Cache results in
	Tk_SetCaretPos to reduce unnecessary repositioning.  Also call
	DestroyCaret if we receive WM_KILLFOCUS.
	(TkpOpenDisplay): ZeroMemory the initial display structures.
	(TkWinGetUnicodeEncoding): Added so that Windows only needs to
	cache this value one, and then free it in TkWinXCleanup.
	(HandleIMEComposition): add support for Win98 and ATOK13
	IME. (yamamoto)

	* generic/tkConsole.c (ConsoleCmd): correct return that should
	have just set result code.

	* generic/tkImgPhoto.c: Added PhotoFormatThreadExitProc to clean
	up on thread exit. (Tk_PhotoPutBlock) slight code updates

	* generic/tkPanedWindow.c (DestroyPanedWindow, ConfigureSlaves):
	fix mem leaks in not freeing slave info

	* win/configure:
	* win/tcl.m4: Enabled COFF as well as CV style debug info with
	--enable-symbols to allow Dr. Watson users to see function info.
	More info on debugging levels can be obtained at:
	http://msdn.microsoft.com/library/en-us/dnvc60/html/gendepdebug.asp

2002-04-10  Mo DeJong  <mdejong@@users.sourceforge.net>

	* doc/wm.n:
	* mac/tkMacWm.c:
	* tests/wm.test:
	* unix/tkUnixWm.c:
	* win/tkWinWm.c: Update wm stackorder usage message
	to make it clear that either 1 or 3 arguments are
	required. [Bug 540013]

2002-04-08  Daniel Steffen  <das@@users.sourceforge.net>

	* mac/tkMacProjects.sea.hqx: added tkPanedWindow.c to projects
	* mac/tkMacAppInit.c: fixes to MSL stdin/stdout hookup to the
	TkConsole when using shared MSL libraries; fix for crashing
	bug on exit: writing to stdin/sterr when console has already
	been destroyed. (both fixes need support in MSL, see 
	'CW Pro6 changes' in tcl/mac/tcltkMacBuildSupport.sea.hqx)
	* mac/tkMacDialog.c: fixes to Navigation Services Dialog filter.
	* mac/tkMacDraw.c: add panic for overwide TkImages that would
	crash Tk on mac otherwise.

2002-04-05  Jeff Hobbs  <jeffh@@ActiveState.com>

	* mac/tkMacXStubs.c: added Tk_SetCaretPos stub (does nothing).
	* win/tkWinX.c: added Tk_SetCaretPos code to position IME windows
	correctly when WM_IME_STARTCOMPOSITION is received.
	* unix/tkUnixKey.c: added Tk_SetCaretPos and code for setting
	XIM caret in TkpGetString.

	* generic/tkStubInit.c:
	* generic/tkDecls.h:
	* generic/tk.decls: added Tk_SetCaretPos declaration.  This command
	allows users to indicate the cursor position and is used by XIM
	(Unix) or IME (Windows) to place the caret box correctly.  It is
	also part of correct Accessibility style on Windows to make the
	magnifier jump to the focus point.

	* win/tkWinButton.c (TkpDisplayButton): 
	* generic/tkTextMark.c (TkTextInsertDisplayProc):
	* generic/tkCanvText.c (DisplayCanvText):
	* generic/tkEntry.c (DisplayEntry): added Tk_SetCaretPos calls

	* generic/tkInt.h: added TK_XIM_SPOT #define (default 1).
	Added XFontSet attribute to TkDisplay when TK_XIM_SPOT is true.
	* generic/tkEvent.c (Tk_HandleEvent): made sure inputContexts are
	not getting created on DestroyNotify events (for dead windows).
	Added over-the-spot support if TK_XIM_SPOT is defined (default).
	The is the nicer XIM behavior, but uses a bit more memory.

	* unix/tkUnixEvent.c:
	* generic/tkWindow.c: moved OpenIM over to tkUnixEvent.c.
	Removed setting inputContext to null in Tk_MakeWindowExist as it
	was redundant.

	* unix/tkUnixWm.c (CreateWrapper): Removed redundat setting of
	inputContext to null.

	* win/Makefile.in: changed gdb and shell targets to properly build
	all binaries before running (otherwise an error often occured).

2002-03-28  David Gravereaux <davygrvy@@pobox.com>

	* win/.cvsignore (new):
	* win/lamp.bmp (new):
	* win/makefile.vc:
	* win/nmakehlp.c (new):
	* win/rules.vc:  Brought the makefile up-to-date with Tcl's one.
	This now has support for Win9x issues and the winhelp target now
	exists.  Color scheme can be changed.  I'm just imparting a first
	suggestion using orange :)  I'll have to think about the install
	portion of the helpfile as I'll need to do some tricks to insert
	tk's contents file into Tcl's using some special winhlp32.exe
	switches.  [Bug 533862 527941]

	* win/makefile.vc:  Tk helpfile is now installing itself into Tcl's
	contents file as part of the install target and rebuilding the
	contents table as desired.  [Bug 527941]

	* doc/console.n:  Changed topic from "Tcl Built-In Commands" to
	"Tk Built-In Commands"

	* win/buildall.vc.bat:  Update to match Tcl.

2002-03-26  Andreas Kupries  <andreask_kupries@@users.sourceforge.net>

	* unix/tkUnixFont.c: Added inclusion of <arpa/inet.h>. This fixes
	  a GCC/HPUX problem with missing a "htons". See also
	  "tclUnixPort.h" for equivalent code.

2002-03-21  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.vc: Changed optimize flag to -0ti instead of -02.
	[Bug 528441]

2002-03-20  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tkButton.c (ButtonTextVarProc,ButtonVarProc): 
	* generic/tkCmds.c (WaitVariableProc):
	* generic/tkEntry.c (EntryTextVarProc):
	* generic/tkListbox.c (ListboxListVarProc):
	* generic/tkMenu.c (MenuVarProc):
	* generic/tkMenubutton.c (MenuButtonTextVarProc): 
	* generic/tkMessage.c (MessageTextVarProc): 
	* generic/tkScale.c (ScaleVarProc): Updates to handle change in
	type of part2 argument of Tcl_VarTraceProc typedef. [TIP 27]
	[Patch 532644].

2002-03-19  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tkOldConfig.c (Tk_ConfigureValue): prevent leaving
	interp->result as NULL.

2002-03-07  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/text.tcl (TextPasteSelection): Renaming of TextPaste to
	prevent confusion with tk_textPaste.  Stopped code from inserting
	selections twice, which seems to have happened with TIP#26, and
	reorganized code to reduce amount of stuff protected by catch
	which is tricky to maintain.
	(tk_textPaste): Reduce amount of code protected by catch.

2002-03-06  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/tkWinX.c: Define _WIN32_IE as 0x0300
	before including commctrl.h so that we can
	access the InitCommonControlsEx API when
	building Tk with mingw.

2002-03-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* README, generic/tk.h, unix/configure.in, unix/tk.spec:
	* win/configure.in: Bumped patchlevel; this might need to change
	in the future, but it will help us distinguish between the CVS
	version and the most recent released version.

2002-03-05  Jeff Hobbs  <jeffh@@ActiveState.com>

	*** 8.4a4 TAGGED FOR RELEASE ***

	* unix/README: updated --* options docs.

	* unix/tk.spec: fixed URL refs to use www.tcl.tk or SF.

2002-03-04  Jeff Hobbs  <jeffh@@ActiveState.com>

	* README: 
	* mac/README: 
	* unix/README: 
	* win/README: updated to use www.tcl.tk URL.

2002-03-03  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/entry.tcl: added catch around Triple-1 binding use of
	sel.last

2002-02-28  Don Porter  <dgp@@users.sourceforge.net>

	* library/console.tcl (ConsoleBind): Corrected console <<Paste>>
	binding on Unix platforms.

2002-02-26  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure: Regen.
	* unix/tcl.m4: Update from Tcl.

	* generic/tkWindow.c (Tk_MainWindow, Tk_GetNumMainWindows):
	protect against being called before Tcl stubs are init'ed.
	[Bug #220916] (porter)

2002-02-25  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tkText.c (ConfigureText): reenable the blinking cursor
	on state change where necessary. [Bug #503772]

	* tests/listbox.test:
	* generic/tkListbox.c: corrected error handling when setting to an
	invalid listvar value. [Bug #503613]

	* library/scale.tcl: mirror B2 bindings to B3 on Windows to better
	accomodate two button mice. [Patch #493145]

	* library/panedwindow.tcl: improved proxy sash handling. (boudaillier)

2002-02-25  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/filebox.test: Reorganised and fixed so that tests are
	executed fewer times (!) and the automatic extension adding
	behaviour of tk_getSaveFile is tested.

2002-02-23  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/tcl.m4: Update from Tcl.

2002-02-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tkPanedWindow.c (PanedWindowWidgetObjCmd): fixed returns
	that should have been breaks instead.  Corrected .pw configure
	handling for insufficient args.  [Patch #521436] (boudaillier)

	* mac/tkMacDefault.h:
	* unix/tkUnixDefault.h:
	* win/tkWinDefault.h: changed panedwindow default relief to flat,
	a more natural outer relief.

	* library/panedwindow.tcl (ReleaseSash): changed to not pass x and
	y args at all (they aren't used).
	Added proc comments.  Made configuring sash cursor more efficient.
	Added Cursor timer that restores the default cursor when pointer
	is no longer over the sash.  This is necessary because Leave
	events won't be seen when moving into a paned child.

2002-02-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/demos/widget: New section "Paned Windows"
	* library/demos/paned2.tcl, library/demos/paned1.tcl: New files.

	* library/panedwindow.tcl (ReleaseSash): Added missing arguments.
	* library/tk.tcl: Bindings for paned window were not being loaded
	by default.

	* unix/tkUnixMenu.c (GetMenuLabelGeometry,DrawMenuEntryLabel):
	Stop meaningless GCC warnings.

2002-02-21  Jeff Hobbs  <jeffh@@ActiveState.com>

	* doc/panedwindow.n (new):
	* generic/tkPanedWindow.c (new):
	* generic/tkInt.h:
	* generic/tkWindow.c:
	* library/panedwindow.tcl (new):
	* mac/tkMacDefault.h:
	* tests/panedwindow.test (new):
	* unix/Makefile.in:
	* unix/tkUnixDefault.h:
	* win/Makefile.in:
	* win/makefile.vc:
	* win/tkWinDefault.h: added implementation of TIP #41, panedwindow
	widget. [Patch #512503] (melski)

	* generic/tkOption.c (ReadOptionFile): fixed Tcl_Seek casting to
	remove warnings (we expect no option files with be > 2GB).

	* unix/configure: regenerated
	* unix/tcl.m4: updated to sync with Tcl's tcl.m4
	Added --enable-64bit support for AIX-4 using IBM's xlc (-q64 flag).

2002-02-19  Don Porter  <dgp@@users.sourceforge.net>

	* changes: First draft of updated changes for 8.4a4 release.

2002-02-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tkImgPhoto.c (MatchFileFormat):  Tcl_Seek takes
	Tcl_WideInt offset (three places.)
	* generic/tkImgPPM.c (FileReadPPM): Tcl_Seek takes Tcl_WideInt offset.
	* generic/tkFrame.c (ConfigureFrame): Stop GCC warning.

	* generic/tkImgGIF.c: Made file meet the formatting rules from the
	Tcl Engineering Manual better; mostly differences in whitespace.

2002-02-18  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure: regen'd
	* unix/tcl.m4:
	* unix/configure.in: added macros and calls to SC_TCL_EARLY_FLAGS
	and SC_TCL_64BIT_FLAGS, part of TIP #72.

2002-02-14  Mo DeJong  <mdejong@@users.sourceforge.net>

	* library/entry.tcl:
	* library/text.tcl: Adjust <Double-1> and <Triple-1> bindings
	so that no anchor point is set and the insertion cursor is
	set to the last character in the selection. [Bug 220943]
	* tests/event.test: Add test cases for double click and
	drag as well as triple click and drag in the text and
	entry widgets.

2002-02-14  Mo DeJong  <mdejong@@users.sourceforge.net>

	* tests/event.test (_text_ind_to_x_y, _get_selection): Fix
	incorrect use of results from bbox invocation so that
	y center point for a give index is calculated correctly.
	Add new method to return the selection and use it in
	test cases. Always lappend to the result list to avoid
	case where initial result includes a space.

2002-02-07  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tkMain.c:
	* mac/tkMacInit.c:
	* mac/tkMacKeyboard.c:
	* win/tkWinDialog.c:
	* win/tkWinTest.c: modified some callers of Tcl routines that
	were restored to return (char *) pointing into Tcl_DStrings.

2002-02-03  eric melski  <ericm@@interwoven.com>

	* generic/tkImage.c (Tk_ImageObjCmd): Clean up bogus for loop in
	[image inuse] subcommand [Bug #485803].

2002-02-01  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tkCmds.c (Tk_TkObjCmd): don't use 'bool' as an arg as it
	conflicts with the C99 spec. [Bug #511956] (ingham)

2002-02-01  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.vc: unset macro located in the tktest target
	caused a failure to build.  [Bug 511652]

2002-01-30  Don Porter  <dgp@@users.sourceforge.net>

	* win/stubs.c (XSetCommand):  Overlooked CONSTification.

2002-02-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/photo.n: Documented transparency subcommand.
	* tests/imgPhoto.test (imgPhoto-4.40...imgPhoto-4.68): Tests for
	the transparency subcommand.
	* generic/tkImgPhoto.c (ImgPhotoCmd): Added transparency
	subcommand (see TIP #14.)

2002-01-31  Todd Helfter <tmh@@users.sourceforge.net>
	* generic/tkMenu.c (ConfigureMenuCloneEntries)
	* tests/menu.test (menu3.68)
	Correct and test for logic error when cloning menus. [Bug #508988]

2002-01-30  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tk.decls:  The POTENTIAL INCOMPATIBILITY in the changing
	interface of Tk_ParseArgv can now be removed by the -DUSE_NON_CONST
	compiler flag.
	* generic/tkDecls.h: make genstubs

2002-01-29  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* win/tkWinInit.c (TkpGetAppName): TIP 27 fixup. The code now does
	  not write into the CONST path returned by "argv0" and
	  Tcl_SplitPath anymore.

2002-01-28  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/configure.in: Don't set TCL_LIB_SPEC and
	TCL_STUB_LIB_SPEC variables since this breaks
	the AIX build. This was used in the past to
	support linking with Tcl from the build dir
	or the install dir, but it is no longer needed.

2002-01-28  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Remove commented out vars.
	* unix/configure: Regen.
	* unix/configure.in: Don't subst vars that are already
	taken care of in SC_LOAD_TCLCONFIG.
	* unix/tcl.m4: Update from Tcl.
	* win/configure: Regen.
	* win/tcl.m4: Update from Tcl.

2001-01-27  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tkFileFilter.c:
	* mac/tkMacInit.c:
	* mac/tkMacKeyboard.c:
	* mac/tkMacMenus.c: TIP 27 CONSTification induced changes

2002-01-25  Don Porter  <dgp@@users.sourceforge.net>

	* All changes below are Patch 505159

	* doc/AddOption.3:
	* doc/CanvTkWin.3:
	* doc/GetPixels.3:
	* doc/Name.3:
	* doc/ParseArgv.3:
	* generic/tk.decls (Tk_AddOption,Tk_CanvasGetCoord,Tk_GetPixels,
	  Tk_GetScreenMM,Tk_NameToWindow,Tk_ParseArgv):
	* generic/tkArgv.c (Tk_ParseArgv):
	* generic/tkCanvLine.c (ParseArrowShape):
	* generic/tkCanvUtil.c (Tk_CanvasGetCoord,Tk_CanvasTagsParseProc,
	  Tk_CanvasTagsPrintProc,Tk_GetDash):
	* generic/tkCanvas.c (ConfigureCanvas):
	* generic/tkGet.c (Tk_GetPixels,Tk_GetScreenMM):
	* generic/tkImgPhoto.c (ImgPhotoCmd):
	* generic/tkMain.c (Tk_MainEx):
	* generic/tkOldConfig.c (FormatConfigInfo):
	* generic/tkOption.c (Tk_AddOption):
	* generic/tkText.c (TextWidgetCmd,TkTextGetTabs,DumpSegment):
	* generic/tkText.h (TkTextCreateTag):
	* generic/tkTextTag.c (TkTextCreateTag):
	* generic/tkWindow.c (Tk_NameToWindow,Initialize):
	* mac/tkMacCursor.c (FindCursorByName,TkGetCursorByName):
	* mac/tkMacWm.c (Tk_WmCmd):
	* unix/tkUnixCursor.c (TkGetCursorByName):
	* unix/tkUnixSend.c (ValidateName):
	* unix/tkUnixWm.c (Tk_WmCmd):
	* win/tkWinCursor.c (TkGetCursorByName):
	* win/tkWinWm.c (Tk_WmCmd): Updated callers of Tcl_SplitList and
	Tcl_Merge.
	* generic/tkDecls.h: make genstubs
	***POTENTIAL INCOMPATIBILITY***
	Includes a source incompatibility in the argv argument of Tcl_ParseArgv.

	* generic/tkBind.c (DeleteVirtualEvent):
	* generic/tkCanvas.c (ScrollFractions, CanvasWidgetCmd,
	  CanvasUpdateScrollbars):
	* generic/tkTestTag.c (TkTextTagCmd): Updated callers of
	Tcl_GetStringResult.  Rewrote PrintScrollFractions to
	ScrollFractions to stop scribbling directly on interp->result.

	* generic/tkInt.decls (TkGetDefaultScreenName, TkpDisplayWarning,
	  TkpOpenDisplay):
	* generic/tkCanvPs.c (Tk_PostscriptColor, Tk_PostscriptFont):
	* generic/tkEntry.c (EntrySetValue, EntryValidateChange, ExpandPercents,
	  EntryValueChanged, Tk_EntryObjCmd, DestroyEntry, ConfigureEntry,
	  EntryComputeGeometry, InsertChars, DeleteChars, EntryFetchSelection,
	  EntryTextVarProc, Tk_SpinBoxObjCmd, SpinboxWidgetObjCmd):
	* generic/tkMain.c (Prompt):
	* generic/tkMenu.c (MenuVarProc):
	* generic/tkMenubutton.c (ConfigureMenuButton, MenuButtonTextVarProc):
	* generic/tkMessage.c (ConfigureMessage, MessageTextVarProc):
	* generic/tkWindow.c (GetScreen, Initialize):
	* mac/tkMacInit.c (TkpInit, TkpDisplayWarning):
	* mac/tkMacXStubs.c (TkGetDefaultScreenName, TkpOpenDisplay):
	* unix/tkUnix.c (TkGetDefaultScreenName):
	* unix/tkUnixEvent.c (TkpOpenDisplay):
	* unix/tkUnixInit.c (TkpGetAppName, TkpDisplayWarning):
	* unix/tkUnixSend.c (SendEventProc):
	* win/tkWinInit.c (TkpGetAppName, TkpDisplayWarning):
	* win/tkWinX.c (TkGetDefaultScreenName,TkpOpenDisplay): Updated
	callers of Tcl_GetVar, Tcl_GetVar2
	* generic/tkIntDecls.h: make genstubs

	* generic/tkCanvPs.c (TkCanvPostscriptCmd):
	* generic/tkImgBmap.c (TkGetBitmapData):
	* generic/tkOption.c (ReadOptionFile):
	* mac/tkMacInit.c (TkpInit, TkpGetAppName):
	* win/tkWinInit.c (TkpGetAppName): Updated callers of
	Tcl_SplitPath, Tcl_JoinPath, and Tcl_TranslateFileName.

2002-01-18  Mo DeJong  <mdejong@@users.sourceforge.net>

	* tests/wm.test: Rewrite stackorder tests that
	deal with toplevels that have the overrideredirect
	flag set. [Tk bug 492259]

2002-01-18  Don Porter  <dgp@@users.sourceforge.net>

	* win/tkWinDialog.c: Overlooked Tcl_GetIndexFromObj callers.

2001-01-18  Daniel Steffen  <das@@users.sourceforge.net>

	* mac/tkMacDialog.c:
	* mac/tkMacSend.c: TIP 27 CONSTification broke the mac
	build in a few places.

2002-01-16  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tkListbox.c (ChangeListboxOffset): improved tracking
	when scrolling on x axis with entry/text.  [Bug #225025] (voskuil)

2002-01-16  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tk3d.c (Tk_GetReliefFromObj): 
	* generic/tkBind.c (Tk_EventObjCmd,HandleEventGenerate): 
	* generic/tkButton.c (ButtonWidgetObjCmd): 
	* generic/tkCanvas.c (CanvasWidgetCmd,FindItems): 
	* generic/tkClipboard.c (Tk_ClipboardObjCmd): 
	* generic/tkCmds.c (Tk_BellObjCmd, Tk_TkObjCmd, Tk_TkwaitObjCmd,
	  Tk_UpdateObjCmd, Tk_WinfoObjCmd, Tk_WmObjCmd): 
	* generic/tkConfig.c (DoObjConfig): 
	* generic/tkEntry.c (EntryWidgetObjCmd, SpinboxWidgetObjCmd):
	* generic/tkFocus.c (Tk_FocusObjCmd):
	* generic/tkFont.c (Tk_FocusObjCmd, ConfigAttributesObj):
	* generic/tkFrame.c (Tk_FrameObjCmd):
	* generic/tkGet.c (Tk_GetAnchorFromObj, Tk_GetJustifyFromObj):
	* generic/tkGrab.c (Tk_GrabObjCmd):
	* generic/tkGrid.c (Tk_GridObjCmd,GridRowColumnConfigureCommand,
	  GridSlavesCommand, ConfigureSlaves):
	* generic/tkImage.c (Tk_ImageObjCmd):
	* generic/tkImgBmap.c (ImgBmapCmd):
	* generic/tkImgGIF.c (FileReadGIF):
	* generic/tkImgPhoto.c (ImgPhotoCmd):
	* generic/tkListbox.c (ListboxWidgetObjCmd, ListboxSelectionSubCmd,
	  GetListboxIndex):
	* generic/tkMenu.c (MenuWidgetObjCmd, MenuAddOrInsert, MenuCmd,
	  ConfigureMenu, CloneMenu):
	* generic/tkMenubutton.c (MenuButtonWidgetObjCmd): 
	* generic/tkMessage.c (MessageWidgetObjCmd): 
	* generic/tkOption.c (Tk_OptionObjCmd):
	* generic/tkPack.c (Tk_PackObjCmd, ConfigureSlaves):
	* generic/tkPlace.c (Tk_PlaceObjCmd):
	* generic/tkScale.c (ScaleWidgetObjCmd): 
	* generic/tkSelect.c (Tk_SelectionObjCmd): 
	* generic/tkSquare.c (SquareWidgetObjCmd): 
	* generic/tkTest.c (TestobjconfigObjCmd, TrivialConfigObjCmd,
	  TestfontObjCmd): Updates to handle change in type of tablePtr
	argument of Tcl_GetIndexFromObj(Struct) from (char **) to
	(CONST char **).  [TIP 27] [Patch 504705]

	* generic/tkCanvText.c (GetSelText):
	* generic/tkEntry.c (Entry{FetchSelection,Setvalue},ExpandPercents):
	* generic/tkSelect.c (HandleTclCommand):
	* generic/tkText.c (TextSearchCmd):
	* generic/tkTextIndex.c (TkTextMakeByteIndex, TkTextIndexBackChars):
	* mac/tkMacFont.c (Tk_MeasureChars, BreakLine):
	* unix/tkUnixMenu.c (DrawMenuUnderline):
	* win/tkWinMenu.c (GetEntryText, DrawMenuUnderline):  Updated
	callers of Tcl_Utf* and Tcl_Regexp* APIs to reflect TIP 27 API
	changes (see Tcl Patch 471509). [Patch 471513]

2002-01-16  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/tcl.m4: Update from Tcl.
	* win/configure: Regen.
	* win/tcl.m4: Update from Tcl.

2002-01-04  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tkMain.c (Tk_MainEx):  Updated callers of CONSTified
	Tcl interfaces Tcl_EvalFile and TclGetStartupScriptFileName.

	* generic/tkConsole.c (ConsoleOutputProc, TkConsolePrint):  
	* generic/tkInt.h (TkConsolePrint):
	* mac/tkMacAppInit.c (TkConsolePrint): Updated Tk's console to
	CONSTified channel driver interface.  [Tcl Patch 503565, Tk Patch
	503983]

2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	Use ${libdir} instead of ${exec_prefix}/lib. [Tcl bug 489370]
	
	* unix/configure: Regen.
	* unix/configure.in: Define and use libdir.
	* win/configure: Regen.
	* win/configure.in: Define libdir.

2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Burn Tcl and Tk build
	directories into tktest executable to avoid crashes
	caused by ld loading a previously installed version
	of the tcl or tk shared libraries. Remove setting
	of LD_LIBRARY_PATH, LIBPATH, and SHLIB_PATH
	before running tktest since it should no
	longer be required.

2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	Enable use of Tcl stubs when building Tk as
	a shared library. This should fix the build
	under AIX. [Bugs 220858, 220955, 220921]

	* unix/Makefile.in: Add TCL_STUB_LIB_SPEC and
	TCL_STUB_LIB_FLAG variables.
	* unix/configure: Regen.
	* unix/configure.in: Pass TCL_STUB_LIB_SPEC into
	Makefile and use it when linking the tk shared library.
	Define USE_TCL_STUBS when building shared. Subst
	TCL_STUB_LIB_SPEC and TCL_STUB_LIB_FLAG.

2002-01-08  D. Richard Hipp  <drh@@hwaci.com>

	* win/tkWinMenu.c: Fix the following bug: If you select an entry
	on a cascade menu then the next time the parent menu is posted, the
	cascade entry was active.  Also, if you traverse to a disabled entry
	using keystrokes and press ENTER on the disabled entry, then that
	entry appears active the next time the menu is posted.  The same
	patch fixes both problems.

2002-01-04  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tkBind.c (TkBindFree):
	* generic/tkGrid.c (ResolveConstraints,CheckSlotData,DestroyGrid):
	* generic/tkSelect.c (Tk_DeleteSelHandler,TkSelDeadWindow): Replaced
	Tcl_Free calls with ckfree so that memory debugging is fully supported.

2001-12-28  Jeff Hobbs  <jeffh@@ActiveState.com>

	* test/winButton.test:
	* win/tkWinButton.c: added updated patch #463234 which returns the
	default sizing behavior (not so native), but enables native L&F
	with negative sizing (-11 for example).

	* library/text.tcl (tk::TextButton1): made text receive focus even
	in disabled state for Windows to show selection and allow
	mouse-wheel scrolling.

	* win/tkWinInit.c (TkpDisplayWarning): added Tcl_DStringFree's

	* win/tkWinInt.h:
	* win/tkWinX.c: added TkWinProcs that represent a function table
	to switch between unicode and ansi procs on Windows.  This is
	analogous to the TclWinProcs.  Using Tcl_WinUtfToTChar, we can
	easily take advantage of using unicode functions where available
	without having to switch on the platform id each time.

	* win/tkWinWm.c (InitWindowClass): corrected init routines to
	allow unicode in window titles on Windows (for Win2K/XP).
	(TkWmStackorderToplevel): Corrected casts to enable debug compile

	* win/configure: regen'ed
	* win/tcl.m4: added shell32.lib to link libs, as these are
	necessary for new directory chooser (when enabled).

	* win/tkWinDialog.c (Tk_MessageBoxObjCmd): use MessageBoxW for
	proper display of unicode errors.
	Added patch which uses new OLE based directory chooser.  This
	still has some issues, so is disabled by default. [Patch #468139]
	(ColorDlgHookProc) Corrected ability to use unicode chars in
	tk_chooseColor -title.

2001-12-27  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tkWinInit.c (TkpDisplayWarning): Use MessageBoxW in case the
	error displayed has unicode chars. [Bug #485986]

2001-12-27  Daniel Steffen <das@@users.sourceforge.net>

	* mac/tkMacInit.c:
	* mac/tkMacResource.r: synced up tkInit features to unix/win:
	use existing tkInit proc if defined. Added spinbox.tcl resource.
	Used TclGetEnv() instead of Tcl_GetVar2(interp, env)
	* mac/tkMacApplication.r:
	* mac/tkMacLibrary.r: minor version resources cleanup

2001-12-27  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tkButton.c (ButtonTextVarProc): guard against being
	called while the *button/label is being deleted. [Bug #490051]

	* library/entry.tcl: 
	* library/spinbox.tcl: 
	* library/text.tcl: added extra checks against bug #220269 and
	made spinbox reuse more of the entry procedure code.

2001-12-20  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/tcl.m4: Update from Tcl.

2001-12-19  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/tcl.m4: Update from Tcl.

2001-12-18  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/configure.in: Move EXP file changes over from
	Tcl configure script to fix AIX build with gcc. [Bug 220955]

2001-12-18  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in:
	* win/Makefile.in: Use $(MAKE) instead of make
	in the tcltest rule.

2001-12-18  Don Porter  <dgp@@users.sourceforge.net>

	* tests/event.test (event-click-drag-1.2): Corrected test that
	failed on Solaris/CDE due to text scrolling.  [Bug 413735]

2001-12-18  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/spinbox.tcl (ButtonDown): added catch to ignore
	possible error in after cancel when Priv(afterId) isn't defined.

	* doc/spinbox.n: corrected spin(up|down) -> button(up|down)

2001-12-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/getOpenFile.n: Documented change.
	* library/tkfbox.tcl (SetFilter): Added code to guess the correct
	default extension from whatever value was selected in the
	filetypes option menu.  Adapted from code by Chris Nelson
	submitted in Patch #492220.

2001-12-12  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/tkUnixWm.c (TkWmStackorderToplevelWrapperMap): added static

2001-12-05  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tkText.c:
	* generic/tkText.h: changed TkTextEditType enums to be prefaced
	with TK_EDIT_ to prevent name collision.

2001-12-05  Daniel Steffen <das@@users.sourceforge.net>

	* mac/tkMacWm.c: mac implementation of wm stackorder
	(patch 481148, TIP 74)

2001-12-03  Mo DeJong  <mdejong@@users.sourceforge.net>

	Add TK patch 481148 to implement TIP 74, the
	wm stackorder command.

	* doc/winfo.n: Update documentation for the winfo
	children command to indicate that top-level windows
	are not returned in stacking order.
	* doc/wm.n: Add documentation for wm stackorder.
	* generic/tkInt.decls (TkWmStackorderToplevel):
	Add decl for new function.
	* generic/tkIntDecls.h: Regen.
	* generic/tkStubInit.c: Regen.
	* tests/unixWm.test: Add stackorder command to test
	for wm command usage message.
	* tests/wm.test: Add new set of tests for generic
	window manager methods.
	* unix/tkUnixWm.c (Tk_WmCmd,
	TkWmStackorderToplevelWrapperMap,
	TkWmStackorderToplevel): Add unix implementation of
	new wm stackorder command.
	* win/tkWinWm.c (Tk_WmCmd,
	TkWmStackorderToplevelEnumProc,
	TkWmStackorderToplevelWrapperMap,
	TkWmStackorderToplevel): Add windows implementation
	of new wm stackorder command.

2001-12-03  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.vc: install target changes by request from
	Ryan Casey <scfiead@@hotmail.com>.

2001-11-30  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/demos/widget: Further overhauling; shrank fonts, made
	better use of fonts, added an icon, fixed the About box.  Prompted
	by Bug #487442 from Vincent Wartelle.

2001-11-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/palette.tcl (tk_setPalette): Added heuristic to guess
	from the background whether to use black or white for the
	foreground when not told specifically.  Suggested by Chris Nelson,
	this makes the command fit the documentation better!

2001-11-27  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.vc: Fixed CAT32 target.  cat.c is located in the Tcl
	source, not the Tk source.

2001-11-27  D. Richard Hipp <drh@@hwaci.com>

	* library/menu.tcl: Do not allow keyboard traversal of torn-off
	menus to visit the (invisible) tearoff bar.

2001-11-26  D. Richard Hipp <drh@@hwaci.com>

	* win/tkWinMenu.c: disabled menu items show the activebackground
	color in their background.  This change makes menu behavior
	consistent with what native windows does.

2001-11-24  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in: Add comments to better describe
	TCL_EXE and when it should be available. Add
	rule that prints message about running `make genstubs`
	when tkStubInit.c is out of date.
	* win/Makefile.in: Add TCL_TOOL_DIR and TCL_EXE
	variables to better match the Tcl Makefile. Add
	genstubs rule so tkSTubInit.c can be regenerated.

2001-11-24  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/configure: Regen.
	* win/configure.in: Don't AC_SUBST CFLAGS_DEBUG, CFLAGS_OPTIMIZE,
	or CFLAGS_WARNING since it is now done in SC_CONFIG_CFLAGS.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): AC_SUBST DL_LIBS, CFLAGS_DEBUG,
	CFLAGS_OPTIMIZE, and CFLAGS_WARNING.

2001-11-23  Daniel Steffen <das@@users.sourceforge.net>

	Up-port to 8.4 of mac code changes for 8.3.3 & various new
	changes for 8.4, some already backported to 8.3.4 (patch #435660)

	* library/tk.tcl: added <Key-F1> binding for <<Undo>> on the mac (TIP26)

	* library/button.tcl: fixed undefined $Priv(repeated) error for button
	without -repeatdelay support

	* generic/tkConsole.c:
	* library/console.tcl:
	* mac/tkMacInit.c:
	* mac/tkMacResource.r: corrected how mac deals with tcl library
	files present both in resources and in $tk_library directory.

	* generic/tkConsole.c: crashing bug fix when printing to console
	at program exit after the console has already been closed.
	Now setting gStdoutInterp=NULL in ConsoleClose().

	* mac/tkMacInit.c: correct use of Tcl_JoinPath in tk_library
	initialization

	* mac/tkMacMenu.c: special MDEF_PROC_OFFSET only needed for
	exactly one specific version of the MWERKS 68k compiler .

	* mac/tkMacShLib.exp: removed file

	* unix/Makefile.in: removed reference to .exp files

	* mac/MWTkBuildLibHeader.h:
	* mac/MW_TkBuildLibHeader.pch:
	* mac/MW_TkHeaderCommon.h:
	* mac/MW_TkOldImgStaticHeader.h:
	* mac/MW_TkStaticHeader.h:
	* mac/MW_TkStaticHeader.pch: new precompiled header files

	* mac/MW_TkHeader.pch:
	* mac/MW_TkOldImgHeader.h:
	* mac/MW_TkTestHeader.pch: revised precompiled header handling: now
	include a common header file 'MW_TkHeaderCommon.h' from all .pch files,
	the .pch files themselves now only setup #defines (e.g. BUILD_tk,
	STATIC_BUILD, TCL_DEBUG, TCL_THREADS) like in makefiles on other
	platforms.

	* mac/tkMac.h:
	* mac/tkMacPort.h:
	* mac/tkMacInt.h: use of BUILD_tk and TCL_STORAGE_CLASS like on other
	platforms, standardize #include'd files to what's done on other
	platforms, removed use of #pragma export, changed extern to EXTERN
	where appropriate to enable DLL export via the TCL_STORAGE_CLASS
	mechanism.

	* mac/tkMacAppearanceStubs.c: removed use of #pragma export

	* mac/widget.r: new resource file for 'Widget Demos'

	* mac/tkMacProjects.sea.hqx: updated mac build project files:
	build support for CodeWarrior Pro6, UnivIntf 3.4 & shared runtime
	libraries (see Tcl ChangeLog for details).
	changed weak linking so that CFM68k binaries now work on all OS
	versions from the free 7.5.5 onwards, with or without AppearanceMgr
	and/or NavigationMgr installed.
	added target to automatically build 'Widget Demos'
	included XML versions of the projects for CW Pro5 or Pro7 users.
	use compat/strtod.c instead of MSL's strtod()

	* generic/tkInt.decls:
	* generic/tkIntDecls.h:
	* generic/tkIntPlatDecls.h:
	* generic/tkStubInit.c:

	* mac/tkMacInt.h: MAC_TCL tk stub support was badly broken due to
	multiply defined (mac specific) names in tk.decls and tkInt.decls,
	removed the duplicates from the internal unsupported interfaces
	"interface tkInt" and "interface tkIntPlat"; moved declaration of
	TkpIsWindowFloating from tkMacInt.h to tkInt.decls: interface tkIntPlat.
	- these changes to the stub tables might require you to recompile your
	Tk extensions if they turn out to reference one of the removed routines
	in the wrong table (should be unlikely).

	* generic/tkMain.c: MAC_TCL: workaround for broken/non-standard isatty
	on MW Pro6, #include <unistd.h> instead of defining isatty
	
	* generic/tkPointer.c: MAC_TCL: #include tkMacInt.h

	* generic/tkStubLib.c: MAC_TCL: removed obsolete special casing of mac
	headers, standardize #include'd files to what's done on other platforms

	* mac/tclets.r:
	* mac/tkMacWindowMgr.c:
	* mac/tkMacScrlbr.c:
	* mac/tkMacMenu.c:
	* mac/tkMacMenus.c:
	* mac/tkMacFont.c:
	* mac/tkMacDialog.c: 
	* mac/tkMacButton.c: renamed obsolete apple API names to modern
	equivalents; UH3.4 support: added #include <ControlDefinitions.h>;
	fixed munged non-ASCII chars in sources due to bungled latin1<->mac
	roman encoding in CVS repository.

	* mac/tkMacDialog.c: added support for -filetypes option (fix for bug
	tcl #221636); added update event handling for background windows while
	in a NavigationMgr dialog; fixed nasty bug when calling CustomGetFile
	(missing addr operator) (fix for bug tk #220911 & tcl #219367); renamed
	routines conflicting with standard MoreFiles headers (see Tcl ChangeLog
	for details)

	* mac/tkMacApplication.r:
	* mac/tkMacLibrary.r:
	* mac/tkMacResource.r: fixed obsolete copyrights/dates in version
	strings, updated version strings to standard usage, added support for
	'(Support Libraries)' subfolder for shared runtime libraries in
	unmerged binaries, commented out demo setting of "Tcl Environment
	Variables"; reorganized resources among these files to avoid 
	multiple copies in applications and shared libraries, the script
	libraries/Xcursors etc are now no longer duplicated in Wish but are
	only included in the resources of Tk.shlb.

	* mac/tkMacMenu.c: 
	* mac/tkMacMDEF.r: changes to support MW Pro 6 68k (vers 0x2400 only) 
	compiler producing different offset to start of MDEF; fix to static 68k
	presence testing when calling the custom MDEF

	* mac/tkMacWm.c.c:
	* mac/tkMacWindowMgr.c: added/fixed AppearanceMgr checks; override
	AppearanceMgr version detection on static 68k to ensure static 68k Wish
	runs on PPCs with recent AppearanceMgr

	* mac/tkMacButton.c: fixed misplaced/missing variable initialization.

2001-11-20  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tkText.c (TextGetText): reworked to use DString for
	improved speed. (callewaert, darley)
	(DestroyText): plugged mem leak when not clearing stack (callewaert)
	(TextGetText): more efficient string size calculation (darley)

2001-11-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/demos/entry3.tcl: New demo showing off validation and
	password entry.

	* library/demos/widget: Some reorganization to make the code
	simpler, plus a new entry demo.

2001-11-17  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tkWinButton.c (TkpComputeButtonGeometry): corrected the
	default size of Windows buttons to conform to the Windows style.
	This changes the default size of buttons on Windows.
	[Patch #463234] (nelson)
		**** POTENTIAL VISUAL INCOMPATABILITY ****
	
2001-11-16  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/menu.tcl: corrected menu traversal code on Unix to
	better handle entering cascades.  [Patch #481219] (oleinick)

2001-11-16  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.vc:  Install target repaired.

2001-11-15  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/demos/image2.tcl: Many improvements to this
	image-viewing demo; now uses labelframes and tk_chooseDirectory

	* library/palette.tcl (::tk::RecolorTree): Made this work better
	with CDE, which does some extremely annoying things with the
	option database that interact badly with Tk's way of handling
	options.

	* doc/text.n: Overhauled the documentation of undo to make it
	easier to understand.
	* library/tk.tcl (::tk::EventMotifBindings): Added Emacs-like undo
	binding, but not behaviour (we separate undo and redo.)
	* library/demos/text.tcl: Show off our undo capability!

2001-11-12  David Gravereaux <davygrvy@@pobox.com>

	* win/mkd.bat:
	* win/rmd.bat:  Removed -kb CVS attribute and added changes
	from Llyod Lim for better stability.  [Patch #456761]

	* win/rules.vc(new):
	* win/buildall.vc.bat(new):
	* win/makefile.vc:  large rewrite following Tcl's makefile.vc as
	a guide and Patch #456761.  Appears BugFree(tm).

2001-11-12  Jeff Hobbs  <jeffh@@ActiveState.com>

	* doc/text.n:
	* generic/tkText.c:
	* generic/tkText.h:
	* generic/tkTextTag.c:
	* library/text.tcl:
	* library/tk.tcl:
	* mac/tkMacDefault.h:
	* tests/text.test:
	* unix/tkUnixDefault.h:
	* win/tkWinDefault.h: added TIP #26 implementation of simple
	built-in undo/redo of text editing in the text widget.
	[Patch #458879] (callewaert)

2001-11-12  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/demos/menu.tcl: Show off -compound support in menus.

	* library/demos/radio.tcl: Added some code to both show off the
	extra capabilities of the buttons and also show what can be done
	with compound images on the sly.

2001-11-10  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in:
	* win/Makefile.in: Add "make gdb" target. This target
	can run wish inside either gdb or insight.

2001-11-09  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/clrpick.tcl: changed a few parameters so that the full
	0..255 range could be accessed via the mouse. [Bug #478498]

	* unix/configure:
	* unix/tcl.m4: added -lc to AIX libs, fixed path to ldAix

	* win/configure:
	* win/tcl.m4:
	* win/makefile.vc: add comctl32.lib to build libs.
	* win/tkWinX.c (TkWinXInit): added InitCommonControlsEx call.
	* win/rc/tk.rc:
	* win/rc/wish.rc:
	* win/rc/wish.exe.manifest: added resources that specify using v6
	of the MS Common Controls library when available (WinXP+).  This
	enables use of the themeable widgets (like scrollbars) to be used
	in Tk. [Patch #478933]

2001-11-09  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure:
	* unix/tcl.m4: Update from Tcl.

2001-11-08  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/Makefile.in:
	Avoid adding libc to the LIBS and WISH_LIBS
	variables since it is not needed when linking with CC.
	If required when linking with LD it should be done
	on a case by case basis in tcl.m4.

2001-11-05  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/demos/dialog2.tcl: Typo-fix.
	* library/demos/browse, library/demos/ixset, library/demos/rolodex: 
	Installation does version number fixup, so we shouldn't.  Thanks
	to wohnivec@@iol.cz for pointing these (thankfully minor) problems
	out.

2001-10-30  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/demos/widget: Integrated labelframe item into the labels
	section and added a spinbox demo to the (retitled) entry section.

	* library/demos/labelframe.tcl: Adjusted so as to show off the
	labelframe widget to better effect and have a better description.

	* library/demos/spin.tcl: New demo to show off spinbox capabilities.

	* library/demos/rolodex: Changes up-ported from core-8-3-1-branch
	to make the script use more 8.*-isms, but not menus due to the way
	the context help system works.

	* library/demos/ixset: Changed to use the labelframe widget and
	the grid geometry manager.

2001-10-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/demos/browse: Changes up-ported from core-8-3-1-branch
	to make the script much more robust, particularly when neither the
	current version of wish or the script are on the path.

	* library/demos/hello: Added emacs trailing tag-line.

	* library/demos/tcolor: Changes up-ported from core-8-3-1-branch
	to make the script compliant with current good practise, as well
	as extensive use of the new labelframe widget.

	* library/demos/timer: Changes up-ported from core-8-3-1-branch to
	make the script look and work better.

	* library/demos/rmt: Changes up-ported from core-8-3-1-branch to
	use more 8.* features and make the demo script more generally
	useful to people.

2001-10-23  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tkCursor.c (Tk_GetCursorFromData): Fixed uninit nextPtr
	field.  [adapted from Patch 473875]
	(GetCursor): Removed double-assignment to nextPtr field.

2001-10-19  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/console.tcl: removed transpose ability until the console
	can get a proper rewrite of tag handling.

2001-10-18  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/defs.tcl: removed threaded build warning under X.

	* library/console.tcl (ConsoleOutput): fixed undefined widget
	argument.

2001-10-16  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/xmfbox.tcl: fixed filtering in motif file dialog.
	[Patch #469670] (nelson)

	* generic/tkWindow.c (OpenIM): Added simple XIM patch to enable
	basic XIM input on Unix. [Patch #412727] (fabian)

2001-10-15  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure:
	* unix/configure.in:
	* win/configure:
	* win/configure.in:
	* win/tkConfig.sh.in: reworked to be a little cleaner in
	comparison to each other, and to AC_SUBST even empty vars for
	win/tkConfig.sh

2001-10-12  Todd M. Helfter <tmh@@purdue.edu>

	* ChangeLog:
	* doc/menu.n:
	* generic/tkMenu.c:
	* generic/tkMenu.h:
	* generic/tkMenubutton.c:
	* generic/tkMenubutton.h:
	* mac/tkMacDefault.h:
	* mac/tkMacMenu.c:
	* mac/tkMacMenubutton.c:
	* tests/menu.test:
	* unix/tkUnixDefault.h:
	* unix/tkUnixMenu.c:
	* win/makefile.vc:
	* win/tkWinDefault.h:
	* win/tkWinMenu.c:
	* win/tkWinWm.c: Implementation of TIP #63, the addition of
	a -compound option to menu entries allowing text and an image to
	be displayed at the same time.

2001-10-09  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/console.tcl: added more smarts extracted from tkcon to
	the default console.

2001-10-01  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tkWinTest.c: better error reporting from testclipboard

	* win/tkWinDialog.c: minor cast changes to support Win64

	* win/tkWinWindow.c: made use of standard Tk_GetHWND instead of
	older, private TkWinGetHWND.

	* win/configure: regen'ed
	* win/tcl.m4:
	* win/makefile.vc: updated for Win64 SDK RC1 compilation support

2001-09-30  Peter Spjuth <peter.spjuth@@space.se>

	* doc/grid.n:
	* generic/tkGrid.c:
	* tests/grid.test: Added -uniform option to grid's row/column-
	configure. [TIP 37] [Patch 459343]
	
2001-09-26  Peter Spjuth <peter.spjuth@@space.se>

	* win/tkWinFont.c (Tk_DrawChars): Added support for clipping text.

	* doc/frame.n:
	* doc/labelframe.n:
	* doc/toplevel.n:
	* generic/tkFrame.c:
	* generic/tkInt.h:
	* generic/tkWindow.c:
	* library/demos/radio.tcl:
	* library/demos/labelframe.tcl:
	* library/demos/widget:
	* mac/tkMacDefault.h:
	* tests/frame.test:
	* unix/tkUnixDefault.h:
	* win/tkWinDefault.h: Added labelframe widget. Added -padx/y
	options to frame and toplevel.

	* tests/grid.test:
	* tests/pack.test:
	* tests/place.test: Used labelframe to test geometry manager changes.
	[TIP 18] [Patch 429164]
	
2001-09-26  Peter Spjuth <peter.spjuth@@space.se>

	* doc/GeomReq.3:
	* doc/WindowId.3:
	* generic/tk.decls:
	* generic/tk.h:
	* generic/tkDecls.h:
	* generic/tkGeometry.c:
	* generic/tkGrid.c (ArrangeGrid):
	* generic/tkInt.h:
	* generic/tkPack.c (ArrangePacking):
	* generic/tkPlace.c (RecomputePlacement):
	* generic/tkStubInit.c:
	* generic/tkUtil.c (TkComputeAnchor):
	* generic/tkWindow.c (TkAllocWindow):
	* unix/mkLinks: Geometry manager changes to support TIP#18.
	Allows a widget to set different internal border widths on
	different sides, and to set a minimum requested size.
	POTENTIAL INCOMPATIBILITY.  [Patch 429164]
	
2001-09-25  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tkBind.c:
	* generic/tkInt.decls (TkpScanWindowId):
	* unix/tkUnixPort.h (Tkp{Print,Scan}WindowId):
	* unix/tkUnixXId.c (TkpScanWindowId):
	* win/tkWinWindow.c (TkpScanWindowId): Corrected definition of
	TkpScanWindowId to handle situation where types Window and int
	do not have the same number of bits.  CONST-ified too.

	* generic/tkIntPlatDecls.h: 
	* generic/tkStubInit.c: make genstubs

2001-09-24  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tkMain.c (StdinProc): Update to handle change in
	return type of Tcl_DStringAppend() from (char *) to (CONST char *).
	[TIP 27]

2001-09-23  Peter Spjuth  <peter.spjuth@@space.se>
	* generic/tkPack.c (ConfigureSlaves):
	* tests/pack.test:
	* tests/grid.test:  Pack accepted asymmetric values for -ipadx/y.
	Only -padx/y supports asymmetry. [Bug #462348]

2001-09-21  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tkWinWindow.c (TkpPrintWindowId, TkpScanWindowId): fixed to
	work on Win64 with 64bit XIDs.

	* generic/tkWindow.c (Tk_CreateAnonymousWindow): 
	* generic/tkEntry.c (GetSpinboxElement): fixed unreachable returns.

	* win/tkWinX.c (TkGetServerInfo): added recognition of Win64.

	* xlib/X11/X.h: made XID __int64 type for Win64.

	* unix/tkUnixPort.h:
	* mac/tkMacPort.h: add (int*) cast to TkpScanWindowId.
	These may need to be changed to Window* (ulong).

	* generic/tkCmds.c (Tk_WinfoObjCmd):
	* generic/tkBind.c (NameToWindow):
	correct Window id's to be of type Window

	* generic/tkIntDecls.h:
	* generic/tkIntPlatDecls.h:
	* generic/tkInt.decls (TkpScanWindowId): changed decl to use
	Window* instead of int*.

	* xlib/xcolors.c:
	* generic/tkPack.c,tkWindow.c:
	* win/tkWinFont.c,tkWinMenu.c:
	* unix/tkUnixScale.c: minor cast fixes to prevent 64bit warnings.

	* tests/scrollbar.test (scrollbar-6.27): marked knownBug because
	it is skewed by bad dimensions returned by Windows.

	* tests/textDisp.test (textDisp-4.12): corrected test to work
	properly on Windows.

	* tests/id.test,macFont.test,macMenu.test,macscrollbar.test:
	* tests/send.test,winClipboard.test,winDialog.test,winFont.test:
	improved use of test constraints

	* win/tkWinWm.c (WinSetIcon): fixed SetClassLong for 64bit support.

2001-09-20  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure: regen'ed
	* unix/tcl.m4: added --enable-64bit support for HP-11 with the
	64-bit kernel.

2001-09-17  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tkGrid.c (ConfigureSlaves):
	* generic/tkPack.c (PackAfter):  Corrected type definition of
	argument passed to Tcl_GetStringFromObj() from size_t to int.
	Incorrect type broke [pack] and [grid] on systems where
	sizeof(size_t) != sizeof(int).  [Bugs 462375, 462342, 462338]

2001-09-17  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/choosedir.tcl (DblClick): 
	* library/tkfbox.tcl (OkCmd, ListInvoke): Rewrote so as to avoid
	the highly confusing string "text" and to be consistent about what
	is and what is not a list.  [Bug 459895, reported by fandom]

2001-09-14  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tkImgGIF.c:
	* generic/tkImgPPM.c:
	* generic/tkImgPhoto.c:
	* generic/tkMenu.c: Applied patch [461578], provided by Vincent
	  Darley. This fixes several memory leaks in the image code. They
	  happen if there are errors during the initialization of the
	  channel the image is supposed to be read from.

2001-09-12  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure:
	* unix/tcl.m4: Update from Tcl.

2001-09-12  D. Richard Hipp  <drh@@hwaci.com>

	* library/tkfbox.tcl: fixed error that appeared when you would
	click on the canvas while viewing an empty directory.

2001-09-10  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure:
	* unix/tcl.m4: Update from Tcl.

2001-09-09  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/Makefile.in: Fix Windows Makefile so that
	tcltest will automatically be compiled if the
	user tries to build tktest.

2001-09-09  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/Makefile.in: Use TKTEST variable directly
	instead of depending on the tktest alias.

2001-09-08  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/mkd.bat:
	* win/rmd.bat:
	Apply binary property (cvs admin -kb) to files and convert
	to CRLF linefeed format to fix the VC++ build. [Tcl Bug #219409]

2001-08-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/menu.test:
	* tests/send.test:
	* tests/select.test: corrected to use testConfig constraints in
	the TK_ALT_DISPLAY case

	* tests/unixSend.test: removed test file completely identical to
	send.test.  Removed platform specific named file in case somebody
	gets send working on Win/Mac in the future.

	* tests/config.test: added config-14.1 to test namespace import
	evaluation of widgets.
	* generic/tkButton.c (ButtonCreate):
	* generic/tkFrame.c (CreateFrame):
	* generic/tkMenubutton.c (Tk_MenubuttonObjCmd):
	* generic/tkPlace.c (Tk_PlaceObjCmd):
	* generic/tkScale.c (Tk_ScaleObjCmd):
	* generic/tkMessage.c (Tk_MessageObjCmd):
	* generic/tkEntry.c (Tk_EntryObjCmd, Tk_SpinboxObjCmd):
	* generic/tkSquare.c (SquareObjCmd): redid the handling of
	optionTables in widgets to allow them to be imported into other
	namespaces. [Bug #456632]

2001-08-28  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tkWinDialog.c (ChooseDirectoryHookProc): work-around for MS
	bug that caused crashing in tk_chooseDirectory on Win95.
	[Bug #224936] (baker)

	* unix/tkUnixWm.c (TkWmRestackToplevel): reworked how
	ConfigureNotify requests were handled in relation to the parent to
	avoid the problem with potential 'raise' delays on some wms.
	[Bug #220260] (baker) wms that were affected should notice the
	difference in tests unixWm-51.* not failing that failed before.

2001-08-26  Don Porter  <dgp@@users.sourceforge.net>

	* library/text.tcl (<Shift-Up> binding):  Corrected TIP 44 typo
	that broke binding.  Thanks to "Michal" for the fix.
	[Bug 455468]

2001-08-23  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure:
	* unix/tcl.m4: added QNX-6 build support. [Bug #219410] (loverso)

	* doc/CrtPhImgFmt.3: removed bogus note about including tkPhoto.h

2001-08-22  Peter Spjuth  <peter.spjuth@@space.se>

	* generics/tkGrid.c (ConfigureSlaves):
	* tests/grid.test: Fixed a bug where adjacent 'x' and '^' where
	not handled properly. [Bug #452040]
	
2001-08-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tkPack.c (TkParsePadAmount): added lint init for sepChar.

	* tests/dialog.test (HitReturn): fixed failing dialog-2.1 test
	because it wasn't always getting focus properly.

2001-08-21  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/unixFont.test (unixFont-2.[234]): fixed to be more
	sensitive on systems that have more installed fonts.

	* library/dialog.tcl (tk_dialog): changed dialog to show bar on
	Windows as well and added some y padding between the buttons and
	the bar. [Patch #442835] (harrismh)

2001-08-20  Peter Spjuth  <peter.spjuth@@space.se>

	* generic/tkInt.h:
	* generic/tkWindow.c:
	* generic/tkGrid.c:
	* generic/tkPack.c:
	* tests/grid.test:
	* tests/oldpack.test:
	* tests/pack.test: Objectified grid and pack commands.

2001-08-20  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tkObj.c (TkGetWindowFromObj): Rewrote window code to
	reuse a previously worked-out set of window information exactly
	when the reference window is the same and no window deletions have
	occurred since the object was allocated (display has same epoch
	counter.)  Required changing the internal rep of the window quite
	a bit as now need to save three words-worth of information in the
	internal rep (this window, reference window, display epoch.)
	* generic/tkObj.c (SetWindowFromAny, DupWindowInternalRep,
	FreeWindowInternalRep): Code to support new internal rep for
	window objects.
	* generic/tkInt.h: Added epoch counter to TkDisplay structure
	* generic/tkWindow.c (GetScreen, Tk_DestroyWindow): Epoch counter
	is incremented every time a window is deleted.

2001-08-18  Peter Spjuth <peter.spjuth@@space.se>

	* doc/grid.n:
	* tests/grid.test:
	* generic/tkGrid.c: Grid configure rejected initial "x" and "^".
	[Bug #418664]
	
2001-08-17  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tkObj.c (TkGetWindowFromObj): Was failing to reuse
	cached window objects, forcing a call to Tcl_GetStringFromObj and
	Tk_NameToWindow every time.  This fault has been in there for
	nearly three years...

2001-08-15  Don Porter <dgp@@users.sourceforge.net>

	* changes: Labelled the TIP 44 changes as "POTENTIAL INCOMPATIBILITY".
	Although technically internal changes are not incompatible, they'll
	be perceived as such by those who get bitten, and this will help
	them find the cause of their trouble.

2001-08-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tk{Util,Font,Cursor,Color,Bitmap,3d}.c: Modified
	objtype declarations so that they can be picked up in tkObj.c and
	the names are now prefixed with "tk" too.
	* generic/tkObj.c (TkRegisterObjTypes): 
	* generic/tkWindow.c (Initialize): 
	* generic/tkInt.h: Added code to register Tk's object types with
	the Tcl runtime.  [Tcl Bug 450545]

2001-08-12  Mo DeJong  <mdejong@@redhat.com>

	* unix/configure: Regen.
	* unix/tcl.m4: Update from Tcl.

2001-08-10  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/demos/image2.tcl (loadDir): Converted non-portable
	[glob [file join $dirName *]] to [glob -directory $dirName *]
	which is both fully portable and more reliable when directory
	names contain glob-significant characters.  [Bug 223313]

2001-08-08  Don Porter <dgp@@users.sourceforge.net>

	* tests/dialog.test:  New file testing [tk_dialog].

	* library/dialog.tcl:
	* library/tkfbox.tcl: Corrections to problems introduced by
	the TIP 44 changes.  [Bug 449261]

	* README:
	* generic/tk.h:
	* unix/configure:
	* unix/configure.in:
	* unix/tk.spec:
	* win/configure:
	* win/configure.in: Bumped up patchlevel to 8.4a4 to distinguish
	CVS snapshots from the 8.4a3 release.  This does not necessarily
	mean there will be an 8.4a4 release.  [Bug 448938].

2001-08-07  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/Makefile.in (dist): added {unix,win}/tcl.m4 and
	library/msgs/*.msg to dist target.  [Bug: #448802]

2001-08-06  Jeff Hobbs  <jeffh@@ActiveState.com>

	8.4a3 RELEASE

	* changes:
	* README: updated for 8.4a3 release

	* unix/configure: regenerated
	* unix/tcl.m4: added GNU (HURD) configuration target. (brinkmann)
	[Patch: #442974]

2001-08-06  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tkConsole.c:
	* generic/tkWindow.c:
	* library/bgerror.tcl:
	* library/dialog.tcl:
	* library/msgbox.tcl:
	* library/unsupported.tcl:
	* mac/tclets.tcl:
	* mac/tkMacHLEvents.c:
	* mac/tkMacWm.c:  TIP 44 changes specific to the Mac and
	Windows platforms that were overlooked before: tkOpenDocument,
	tkConsoleExit, tkConsoleOutput, unsupported1 out of namespace :: .
	Thanks to Vince Darley for prompting another look.

2001-08-03  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/winMain.c (WishPanic): fixed CONST changes to go with
	CONST-ification in Tcl.

	* win/configure: regenerated
	* win/tcl.m4: fixed DLLSUFFIX definition to always be ${DBGX}.dll.
	This is necessary for TEA compliant builds that build shared
	against a static-built Tk.
	* win/Makefile.in ($(WISH)): added $(TK_STUB_LIB_FILE) to build
	target, otherwise it wouldn't get generated in a static build.

2001-08-01  Don Porter  <dgp@@users.sourceforge.net>

	* doc/console.n:
	* doc/menu.n:
	* doc/text.n:
	* doc/tkvars.n:
	* generic/tkBind.c:
	* generic/tkMenu.c:
	* library/bgerror.tcl:
	* library/button.tcl:
	* library/choosedir.tcl:
	* library/clrpick.tcl:
	* library/comdlg.tcl:
	* library/console.tcl:
	* library/dialog.tcl:
	* library/entry.tcl:
	* library/focus.tcl:
	* library/listbox.tcl:
	* library/menu.tcl:
	* library/msgbox.tcl:
	* library/optMenu.tcl:
	* library/palette.tcl:
	* library/scale.tcl:
	* library/scrlbar.tcl:
	* library/spinbox.tcl:
	* library/tclIndex:
	* library/tearoff.tcl:
	* library/text.tcl:
	* library/tk.tcl:
	* library/tkfbox.tcl:
	* library/unsupported.tcl:
	* library/xmfbox.tcl:
	* mac/tkMacMenu.c:
	* tests/clrpick.test:
	* tests/filebox.test:
	* tests/macMenu.test:
	* tests/menu.test:
	* tests/menuDraw.test:
	* tests/msgbox.test:
	* tests/text.test:
	* tests/unixMenu.test:
	* tests/winMenu.test:
	* tests/xmfbox.test:
	* unix/mkLinks:
	* unix/tkUnixDialog.c: Merged changes from feature branch
	dgp-privates-into-namespace, implementing TIP 44.  All
	Tk commands and variables matching tk[A-Z]* are now in the
	::tk namespace.  See "BRANCH: dgp-privates-into-namespace"
	entries below for details.  [FR 220936]

2001-07-24  Mo DeJong  <mdejong@@redhat.com>

	* generic/default.h: Include tkWinDefault.h
	when built with Cygwin or Mingw.

2001-07-18  Don Porter	<dgp@@users.sourceforge.net>

	BRANCH dgp-privates-into-namespace:
	* doc/console.n:  Updated names of private console commands.

2001-07-16  Don Porter	<dgp@@users.sourceforge.net>

	BRANCH dgp-privates-into-namespace:
	* library/console.tcl:
	* library/unsupported.tcl: Renamed tk::histNum to tk::HistNum
	as directed by the Tcl Style Guide.

2001-07-10  Mo DeJong  <mdejong@@redhat.com>

	* unix/Makefile.in: Add AR and STLIB_LD variables.
	* unix/configure:
	* unix/configure.in: Use STLIB_LD when defining MAKE_LIB
	and MAKE_STUB_LIB. Subst STLIB_LD, RANLIB, and AR.
	* unix/tcl.m4: Update from Tcl.
	* win/configure: Regen.
	* win/tcl.m4: Update from Tcl.

2001-07-06  Mo DeJong  <mdejong@@redhat.com>

	* win/configure: Regen.
	* win/tcl.m4: Update from Tcl.

2001-07-05  Mo DeJong  <mdejong@@redhat.com>

	* win/Makefile.in: Subst DEPARG directly instead
	of relying on a variable. This will make Cygwin
	build faster since an extra exec will be avoided.
	* win/configure: Regen.
	* win/configure.in: Subst DEPARG.
	* win/tcl.m4: Update from Tcl.

2001-07-04  Jeff Hobbs  <jeffh@@ActiveState.com>

	* README:
	* mac/README:
	* unix/README:
	* win/README: updated READMEs with purls

2001-07-03  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/canvas.test:
	* generic/tkCanvPoly.c (PolygonToArea): Added patch that respects
	the polygon difference of including points in the polygon even
	when fill is empty.  [Bug #226357]

2001-07-03  Mo DeJong  <mdejong@@redhat.com>

	* win/Makefile.in: Remove PATHTYPE variable.
	* win/configure: Regen.
	* win/configure.in: Don't subst PATHTYPE.
	* win/tcl.m4: Update from Tcl.

2001-07-03  Mo DeJong  <mdejong@@redhat.com>

	* win/Makefile.in: Don't use VPSEP, instead just use :
	in the VPATH.
	* win/configure: Regen.
	* win/configure.in: Don't subst VPSEP.

2001-07-03  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/xmfbox.tcl (tkMotifFDialog_ActivateSEnt): Added missing
	backslash [Bug #438247]

2001-07-02  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tkWindow.c (Tk_DestroyWindow): changed to use
	Tcl_EventuallyFree instead of ckfree so that widgets that have
	references to a tkwin can use them.

	* generic/tkCanvArc.c:
	* generic/tkCanvBmap.c:
	* generic/tkCanvLine.c:
	* generic/tkCanvPoly.c:
	* generic/tkCanvText.c:
	* generic/tkCanvWind.c:
	* generic/tkRectOval.c: corrected argument handling in
	Create<Item> functions that could lead to ABRs or FMRs and
	corrected names of argc/argv to objc/objv.

	* generic/tkImgGIF.c (Mgetc): corrected screwy use of ternary
	operator and possible FMR.

	* generic/tkEntry.c: corrected missing Tcl_Release that caused
	font not freed complaints when trying valid cleanup calls.
	* generic/tkListbox.c: made use of Tcl_Preserve/Tcl_Release to
	prevent FMR errors in Display functions.

	* unix/tkUnixScale.c (TkpDisplayScale): corrected FMR when scale
	was deleted while calling its command.

	* library/console.tcl:
	* library/entry.tcl:
	* library/spinbox.tcl:
	* library/text.tcl:
	* library/tk.tcl: added private ::tk::GetSelection command to
	handle requesting selection.  This is to support requesting
	UTF8_STRING before generic STRING on Unix.  Changed Text, Spinbox,
	Entry and Console to use this command.

	* tests/select.test:
	* generic/tkSelect.c (Tk_CreateSelHandler, Tk_DeleteSelHandler):
	on Unix, a UTF8_STRING handler will be created when the user
	requests a STRING handler (in addition to the STRING handler).
	This provides implicit support for the new UTF8_STRING selection
	target.
	* unix/tkUnixSelect.c (TkSelEventProc, ConvertSelection): Added
	support for UTF8_STRING target. [RFE #418653, Patch #433283]

	* generic/tkInt.h: added utf8Atom to TkDisplay structure.

	* tests/listbox.test: changed 'darkblue' to 'white' in a test
	because it isn't a portable color name.

	* generic/tkEntry.c (DestroyEntry): used Tcl_EventuallyFree
	instead of ckfree for entryPtr to prevent FMRs. [Bug #413904]

2001-06-26  Mo DeJong  <mdejong@@redhat.com>

	* unix/Makefile.in:
	* win/Makefile.in: Add `make shell` target. This target
	will set the proper env vars before invoking wish
	from the build directory.

2001-06-26  Mo DeJong  <mdejong@@redhat.com>

	* win/configure:
	* win/configure.in: Revert cross compiling change
	accidently added during last checkin.

2001-06-26  Mo DeJong  <mdejong@@redhat.com>

	* unix/configure: Regen.
	* unix/configure.in: Fix last checkin by removing
	export since that only works in bash.
	* win/configure: Regen.
	* win/configure.in: Ditto.

2001-06-26  Mo DeJong  <mdejong@@redhat.com>

	* unix/configure: Regen.
	* unix/configure.in: Set CFLAGS to "" if the user
	did not set CFLAGS in the env. This keeps AC_PROG_CC
	from adding "-g -O2" to the CFLAGS by default.
	* win/configure: Regen.
	* win/configure.in: Ditto.

2001-06-22  Mo DeJong  <mdejong@@redhat.com>

	* win/configure: Regen.
	* win/configure.in: Use RC_DEFINE flag from tcl.m4.
	* win/tcl.m4: Update from Tcl.

2001-06-22  Mo DeJong  <mdejong@@redhat.com>

	* win/configure: Regen.
	* win/tcl.m4: Update from Tcl.

2001-06-22  Mo DeJong  <mdejong@@redhat.com>

	* win/configure: Regen.
	* win/tcl.m4 (SC_CONFIG_CFLAGS): Link to the
	imm32 library when building with mingw gcc.
	* win/tkWinX.c: Include the imm.h header
	to fix compiling with mingw gcc.

2001-06-22  Mo DeJong  <mdejong@@redhat.com>

	* win/configure: Regen.
	* win/configure.in: Add resource compiler fix from
	8.3.3 to fix compiling with mingw.

2001-06-22  Mo DeJong  <mdejong@@redhat.com>

	* win/configure: Regen.
	* win/tcl.m4: Fix silly typo in last checkin.

2001-06-22  Mo DeJong  <mdejong@@redhat.com>

	* unix/Makefile.in: Set CFLAGS to @@CFLAGS@@ and @@CFLAGS_DEFAULT@@.
	Set LDFLAGS to @@LDFLAGS@@ and @@LDFLAGS_DEFAULT@@. Add LDFLAGS_DEBUG
	and LDFLAGS_OPTIMIZE to match the way CFLAGS_DEFAULT works. Use
	new LDFLAGS variable in the Makefile instead of @@LDFLAGS@@.
	* unix/configure: Regen.
	* unix/configure.in: Don't set CFLAGS to CFLAGS_DEFAULT, instead
	subst CFLAGS_DEFAULT into the Makefile. Add AC_SUBST for CFLAGS_DEBUG,
	CFLAGS_OPTIMIZE, LDFLAGS_DEFAULT, LDFLAGS_DEBUG, and LDFLAGS_OPTIMIZE.
	Remove unused LD_FLAGS subst.
	* unix/tcl.m4: Update from Tcl.
	* win/Makefile.in: Set CFLAGS to @@CFLAGS@@ and @@CFLAGS_DEFAULT@@.
	Set LDFLAGS to @@LDFLAGS@@ and @@LDFLAGS_DEFAULT@@.
	* win/configure: Regen.
	* win/configure.in: Don't set CFLAGS or LDFLAGS, instead subst
	CFLAGS_DEFAULT and LDFLAGS_DEFAULT into the Makefile.
	* win/tcl.m4: Update from Tcl.

2001-06-22  Mo DeJong  <mdejong@@redhat.com>

	* win/configure:
	* win/tcl.m4: Update From Tcl.

2001-06-21  eric melski  <ericm@@interwoven.com>

	* doc/colors.n: Corrected bogus documentation with respect to
	several shades of blue, all of which were listed as RGB 0 0 0.
	[Bug #432104].

2001-06-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* library/demos/floor.tcl, library/demos/filebox.tcl,
	* library/demos/clrpick.tcl, library/demos/vscale.tcl,
	* library/demos/twind.tcl, library/demos/ruler.tcl, 
	* library/demos/plot.tcl, library/demos/items.tcl, 
	* library/demos/hscale.tcl, library/demos/ctext.tcl,
	* library/demos/cscroll.tcl, library/demos/arrow.tcl,
	* library/xmfbox.tcl, library/msgbox.tcl,
	* library/clrpick.tcl, library/bgerror.tcl: Braced expressions.

2001-06-06  Mo DeJong  <mdejong@@redhat.com>

	* win/configure: Regen.
	* win/configure.in: Handle the --prefix option correctly
	it should default to /usr/local like the unix version.

2001-06-03  Jeff Hobbs  <jeffh@@ActiveState.com>

	* doc/selection.n: 
	* doc/clipboard.n: added SEE ALSOs to cross-reference selection
	and clipboard, with extra note for clipboard command in selection
	docs.  [Patch #422256]

	* unix/tkUnixFont.c: Corrected support for iso10646 (X11 Unicode)
	fonts on Unix. This adds a ucs-2be (UCS-2 Big Endian) encoding in
	Tk on Unix that is used for those fonts (X11 requires
	big-endianness). (welch) [Patch #406411; Bug #220890 #220899]
	This differs from the 8.3.3 patch by not adding ucs-2be in the
	preferred encodingList (seems works fine without).
	Added alias for jisx0201* fonts to jis0201 encoding. [Bug #414033]

2001-05-30  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tkWinKey.c (TkpSetKeycodeAndState): removed old debug info

2001-05-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tkWinX.c: moved the initialization of tkPlatformId from
	TkWinXInit to TkWinGetPlatformId because static builds could call
	it before it was initialized. [Bug #427278]

2001-05-28  Peter Spjuth  <peter.spjuth@@space.se>

	* generic/tkFrame.c:
	* generic/tkWindow.c:
	* tests/frame.test: Upgraded frame to use the newer TK_OPTION
	style when processing configuration options. Some cleanup of
	bad comments and bad code. [part of patch #420861]

2001-05-23  Mo DeJong  <mdejong@@redhat.com>

	* unix/configure:
	* unix/tcl.m4:
	* win/configure:
	* win/tcl.m4: Sync from Tcl sources.

2001-05-21  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/tcl.m4: sync'ed up wih Tcl tcl.m4. [Bug #419812]

	* doc/TkInitStubs.3:
	* generic/tk.h:
	* generic/tkStubLib.c: CONST'ified Tk_InitStubs to match CONST
	changes to Tcl_PkgRequireEx.

2001-05-21  Todd M. Helfter  <tmh@@purdue.edu>

	* doc/menubutton.n:
	* generic/tkMenubutton.c:
	* generic/tkMenubutton.h:
	* mac/tkMacMenubutton.c:
	* tests/menubut.test:
	* unix/tkUnixMenubu.c: Implementation of TIP #11, the addition of
	a -compound option to the menubutton allowing text and an image to
	be displayed at the same time.  This behavior is identical to the
	behavior of the button widget.

2001-05-16  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/console.n: Added - was erroneously placed in Tcl before...

2001-04-25  Mo DeJong  <mdejong@@redhat.com>

	* unix/configure: Regen.
	* unix/tcl.m4: Update from Tcl.
	* win/configure: Regen.
	* win/tcl.m4: Update from Tcl.

2001-04-25  Mo DeJong  <mdejong@@redhat.com>

	* unix/configure: Regen.
	* unix/configure.in: Use $@@ in MAKE_LIB and MAKE_STUB_LIB
	commands instead of using a delayed subst variable. Replace
	instances of STUB_LIB_FILE with TK_STUB_LIB_FILE.

2001-04-25  Mo DeJong  <mdejong@@redhat.com>

	* unix/Makefile.in: Use TCL_STUB_LIB_FILE instead of STUB_LIB_FILE.
	* unix/configure: Regen.
	* unix/configure.in: Don't subst STUB_LIB_FILE, use TCL_STUB_LIB_FILE
	instead.

2001-04-12  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tkImage.c (Tk_ImageObjCmd,DeleteImage): Better detection
	of deletion when world is falling apart. [Bug #220819]

2001-04-04  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tkWinMenu.c (TkWinHandleMenuEvent): corrected reseting of
	service mode to only occur when it was set. [Bug #220948]

2001-04-03  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/winClipboard.test: improved results for understanding when
	tests fail.

	* tests/winDialog.test: string totitle'd some results that
	expected [pwd] to return a capital drive letter.

	* tests/cursor.test: changed tests to use 'heart' cursor because
	'arrow' on windows has a pre-skewed use count.

	* win/tkWinDialog.c (GetFileNameA): initialize multi to 0.

2001-04-02  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/configure:
	* win/tcl.m4 (SHLIB_LD): added -incremental:no. [Bug #219381]

	* generic/tkMenu.c (TkInvokeMenu): checked for menu deletion
	before calling associated menu entry command.  [Bug #220821]

	* doc/image.n: added warning about names chosen for images.

	* generic/tkImgPhoto.c (ImgPhotoCmd): corrected the src and dest
	values for $imageName put when -format and -to are used.
	[Bug #232741]

	* tests/listbox.test: added test listbox-27.1, delete during
	scrollbar update
	* generic/tkListbox.c (DestroyListbox, ListboxEventProc):
	corrected listbox to make proper use of Tcl_EventuallyFree and
	protect against unusual listbox deletion.

	* tests/entry.test: added tests entry-20.*, delete during widget
	activity
	* generic/tkEntry.c (DestroyEntry, EntryEventProc): fixed the
	entry widget to survive deletion while processing scrollbar
	updates and validation.

	* tests/canvas.test: test of canvas delete during event
	* generic/tkCanvas.c (DestroyCanvas, CanvasEventProc): fixed the
	canvas to survive deletion during event processing. [Bug #228024]

2001-04-01  Jeff Hobbs  <jeffh@@ActiveState.com>

	* README:
	* mac/README: updated patchlevel to 8.4a3 and corrected links and
	notes.

	* generic/tk.h:
	* unix/configure.in (TK_PATCH_LEVEL): 
	* unix/configure:
	* unix/tk.spec:
	* win/configure.in (TK_PATCH_LEVEL): 
	* win/configure: updated patchlevel to 8.4a3

2001-03-30  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/safe.test: added note about correcting failures in
	safe.test.
	* library/tk.tcl: moved package require msgcat inside if case to
	not be used in safe interps.

	* win/makefile.vc:
	* win/configure:
	* win/tcl.m4: added imm32.lib to LIBS_GUI for Tk IME support.
	* win/tkWinInt.h:
	* win/tkWinKey.c:
	* win/tkWinX.c: added support for changing IME on the fly in
	Windows (2000).  (lam) [Patch #402993]
	
	* tests/bind.test (bind-22.18):
	* generic/tkBind.c (NameToWindow): handled the error case where a
	valid-looking but invalid identifier could be passed in certain
	event generate options causing a crash. [Bug #411307]

	* win/tkWinWm.c (UpdateWrapper): ensured that the passed in winPtr
	had an existent window to operate on. [Bug #409172]

	* win/Makefile.in (install-*): improved install-* targets to use
	their base build dependency.

	* generic/tkImage.c (Tk_ImageObjCmd, EventuallyDeleteImage):
	added casts to allow compiling on Windows with debbuging.

2001-03-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/msgs/de.msg: fixed translations. [Patch #403525]

	* doc/canvas.n: Noted ability to specify coords as a list in the
	docs. (techentin) [Patch #403660]

	* tests/canvas.test: added test case to check obj conversion
	* generic/tkObj.c (UpdateStringOfMM, SetMMFromAny): better
	obj-aware screen distances.  (pgbaum, hobbs) [Patch #403327]

	* library/bgerror.tcl (bgerror): allow focus into details window
	for Windows C&P to work. [Bug #220929]

	* library/tk.tcl: put a catch around adding <hpBackTab> to the
	<<PrevWindow>> virtual event as it doesn't seem to work on all HP
	systems. [Bug #411669]

	* library/tkfbox.tcl: fixed selecting directories and single files
	with spaces using tk_getOpenFile -multiple 1. [Bug #411640]

	* win/tkWinDialog.c (GetFileNameA): added support for -multiple to
	ascii-based tk_getOpenFile (Win9*). (haneef) [Patch #403047]
	(GetFileNameW): increased number of files that could be returned
	by tk_getOpenFile -multiple. [Patch #412042]

2001-03-29  Mo DeJong  <mdejong@@redhat.com>

	* library/entry.tcl (tkEntryMouseSelect):
	* library/text.tcl (tkTextSelectTo): When
	the mouse is dragged with the button down,
	move the insertion cursor to the current
	mouse position.
	* tests/event.test: Add a series of tests
	for event generation. Add tests for selection,
	check the position of the insertion cursor.

2001-03-28  Jeff Hobbs  <jeffh@@gimlet.activestate.com>

	* unix/configure:
	* unix/tcl.m4: corrected IRIX-5.x config to not use -n32.
 	(english) [Patch 403626]

2001-03-28  Don Porter  <dgp@@users.sourceforge.net>

	* tests/focus.test (focus-6.1):
	* tests/macEmbed.test (unixEmbed-5.1):
	* tests/macMenu.test (macMenu-21.3):
	* tests/menu.test (menu-27.1):
	* tests/unixEmbed.test (unixEmbed-8.2):
	* tests/unixWm.test (unixWm-50.4):  Replaced all [load {} tk]
	in Tk test suite with [load {} Tk].  [Bug 220940, Patch 411952]

2001-03-12  Don Porter  <dgp@@users.sourceforge.net>

	BRANCH dgp-privates-into-namespace:
	* doc/menu.n:
	* unix/mkLinks: Added documentation for [tk_menuSetFocus].

2001-03-12  Don Porter  <dgp@@users.sourceforge.net>

	BRANCH dgp-privates-into-namespace:
	* doc/text.n:
	* doc/tkvars.n:
	* unix/mkLinks: Added documentation for commands and variables
	matching tk_text*.

2001-03-08  Don Porter  <dgp@@users.sourceforge.net>

	BRANCH dgp-privates-into-namespace:
	* generic/tkTextDisp.c: 
	* library/unsupported.tcl: 
	* tests/textDisp.test: Restored the global variables tk_textRedraw
	and tk_textRelayout.  Since they match tk_*, they should remain
	publicly available until at least Tk 9.

2001-03-01  Don Porter  <dgp@@users.sourceforge.net>

	BRANCH dgp-privates-into-namespace:
	* library/unsupported.tcl: New file for Tk's unsupported
	interfaces.  Contains [tk::unsupported::ExposePrivateCommand]
	and [tk::unsupported::ExposePrivateVariable] that restore the
	availability of an old public name of one of Tk's private
	commands and variables, respectively, for those applications
	and extensions that depend on the old names against advice.

2001-02-28  Don Porter  <dgp@@users.sourceforge.net>

	BRANCH dgp-privates-into-namespace:  Feature branch to move all
	of Tk's private commands and variable into the ::tk namespace
	and its children.

	* doc/tkvars.n:  Documented private variable tkPriv renamed tk::Priv.

	* generic/tkBind.c:
	* generic/tkMenu.c:
	* generic/tkTextDisp.c:
	* library/bgerror.tcl:
	* library/button.tcl:
	* library/choosedir.tcl:
	* library/clrpick.tcl:
	* library/comdlg.tcl:
	* library/console.tcl:
	* library/dialog.tcl:
	* library/entry.tcl:
	* library/focus.tcl:
	* library/listbox.tcl:
	* library/menu.tcl:
	* library/msgbox.tcl:
	* library/optMenu.tcl:
	* library/palette.tcl:
	* library/scale.tcl:
	* library/scrlbar.tcl:
	* library/spinbox.tcl:
	* library/tclIndex:
	* library/tearoff.tcl:
	* library/text.tcl:
	* library/tk.tcl:
	* library/tkfbox.tcl:
	* library/xmfbox.tcl:
	* mac/tkMacMenu.c:
	* tests/clrpick.test:
	* tests/filebox.test:
	* tests/macMenu.test:
	* tests/menu.test:
	* tests/menuDraw.test:
	* tests/msgbox.test:
	* tests/text.test:
	* tests/textDisp.test:
	* tests/unixMenu.test:
	* tests/winMenu.test:
	* tests/xmfbox.test:
	* unix/tkUnixDialog.c:  All Tk commands matching ::tk[A-Z]* and
	all Tk private variables in the global namespace were renamed to
	live in the namespace ::tk or one of its children.  

2001-02-13  Eric Melski  <ericm@@interwoven.com>

	* doc/photo.n: [Bug 132213] Added clarification on interpretation
	of ranges for "photoName data -from" subcommand.

2001-02-12  D. Richard Hipp  <drh@@hwaci.com>

	TIP #21: Asymmetric padding in the pack and grid geometry managers.
	With this changes, you can now say "-padx {10 20}" to put 10 pixels
	of padding on the left and 20 on the right.  Similar rules apply
	for vertical padding.  See the revised documentation for details.

2001-01-02  Andreas Kupries  <a.kupries@@westend.com>

	* Everything below belongs together and implements TIP #8
	  (SF patch #102833).

	* win/tkWinWm.c (line 56f): Added icon structures.
	* win/tkWinWm.c (struct WmInfo, line 242): Added reference to
	  optional icon for titlebar.
	* win/tkWinWm.c (struct ThreadSpecificData, line 335): Added
	  reference to optional default icon for toplevel windows.
	* win/tkWinWm.c (line 387 ... 1169): All the new functions required
	  to deal with icon specifications, 'InitWm' changed.
	* win/tkWinWm.c (TkWmNewWindow, UpdateWrapper, TkWmDeadWindow, Tk_WmCmd):
	  Added initialization and handling of the new fields.
	* doc/wm.n: Documentation updated to explain the newly available
	  functionality. 

2000-12-13  jeff hobbs  <jhobbs@@interwoven.com>

	* generic/tkObj.c (SetMMFromAny): Added ability to recognize
	double type object to speed up canvas coord calculations.
	[Patch 403327]

2000-12-12  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/entry.n: Improved documentation of interplay between the
	  -state and -textvariable options.

2000-11-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/image.test (image-1.10): Improved this test, which
	  previously only worked if the command failed to delete the root
	  window, and caused *major* trouble otherwise...
	* generic/tkImage.c (EventuallyDeleteImage): Created this function
	  so that images that get deleted during the creation of an image
	  won't cause a nasty core dump.  Properly fixes bug #120819.

2000-11-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/image.n: 
	* generic/tkImage.c (Tk_ImageObjCmd): Backed out previous change.
	  Bug #120819 is back again in force.  Left the test in there
	  though.

2000-11-23  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/image.n: 
	* tests/image.test (image-1.10):
	* generic/tkImage.c (Tk_ImageObjCmd): Prohibited image names that
	  start with "." since they can cause some really obscure
	  crashes.  Fixes Bug #120819.

2000-11-21  Eric Melski  <ericm@@ajubasolutions.com>

	Overall change:  Implemented TIP 5, which exports
	TkClassProcs/TkSetClassProcs as Tk_ClassProcs/Tk_SetClassProcs,
	adding a size field to Tk_ClassProcs to allow for future
	expansion, and renaming the geometryProc to worldChangedProc,
	which is more in keeping with the actual use of the callback.

	* unix/mkLinks: Added link for Tk_SetClassProcs.

	* doc/SetClassProcs.3: Documentation for
	Tk_ClassProcs/Tk_SetClassProcs.

	* generic/tkCanvas.c:
	* generic/tkEntry.c:
	* generic/tkFrame.c:
	* generic/tkListbox.c:
	* generic/tkMenu.c:
	* generic/tkMessage.c:
	* generic/tkScale.c:
	* generic/tkText.c: Updated to use Tk_ClassProcs/Tk_SetClassProcs
	instead of TkClassProcs/TkSetClassProcs.

	* generic/tkMenubutton.c:
	* generic/tkScrollbar.c:
	* generic/tkButton.c: Updated to use Tk_SetClassProcs instead of
	TkSetClassProcs.

	* generic/tkMenubutton.h:
	* generic/tkScrollbar.h:
	* generic/tkButton.h:
	* win/tkWinButton.c:
	* win/tkWinScrlbr.c:
	* mac/tkMacButton.c:
	* mac/tkMacMenubutton.c:
	* mac/tkMacScrlbr.c:
	* unix/tkUnixButton.c:
	* unix/tkUnixMenubu.c:
	* unix/tkUnixScrlbr.c: Updated to use Tk_ClassProcs instead of
	TkClassProcs.

	* generic/tkDecls.h:
	* generic/tkStubInit.c:
	* generic/tkIntDecls.h: Regenned from tk.decls, tkInt.decls.
	
	* generic/tk.h: Added declaration of Tk_ClassProcs, with size
	field.  Added typedef's for Tk_ClassCreateProc,
	Tk_ClassWorldChangedProc, Tk_ClassModalProc.  Added definition of
	Tk_GetClassProc macro, shorthand for extracting a member of the
	Tk_ClassProcs structure.

	* generic/tkInt.h: Removed declaration of TkClassProcs,
	TkClassGeometryProc, etc.

	* generic/tkBind.c (Tk_BindEvent): Updated to use Tk_GetClassProc
	macro to extract modalProc; added check that the modalProc is non-NULL.

	* generic/tkFont.c (RecomputeWidgets): Updated to use
	Tk_GetClassProc macro to extract worldChangedProc; added comment
	about the choice of a recursive versus iterative algorithm for
	propagating world changed messages.

	* generic/tkWindow.c (Tk_MakeWindowExist): Updated to use
	Tk_GetClassProc macro to extract createProc from Tk_ClassProcs.

	* generic/tk.decls: Added declaration for Tk_SetClassProcs.

	* generic/tkInt.decls: Commented out declaration for
	TkSetClassProcs, which is made public by this change.  The entry
	is left in place, but commented, so that future developers will
	know not to reuse it's stub number.

2000-11-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/ConfigWidg.3: Added deprecation note from Bug #120944 - use
	Tk_SetOption() instead.

	* generic/tkImgPhoto.c (TkPhotoGetValidRegion): Applied patch to
	create this function and add it to tkInt stubs.  Should now be
	possible to write an extension that accesses the transparency data
	in a photo image.  Bug #120930

2000-11-03  Jeff Hobbs  <hobbs@@ajubasolutions.com>

	8.4a2 RELEASE

	* generic/tkWindow.c (Initialize): added call to Tcl_SetMainLoop.
	This only has effect when tclsh is run (not wish), and then Tk is
	loaded in interactively.

2000-11-02  Jeff Hobbs  <hobbs@@ajubasolutions.com>

	* win/tkWinButton.c:
	* win/tkWinDialog.c:
	* win/tkWinScrlbr.c:
	* win/tkWinWm.c: fixed up code for Win64 support.  This mostly
	remains in _WIN64 #ifdef's, until updated compilers are standard.

	* win/tcl.m4:
	* win/makefile.vc: updated for Win64 compile support

	* unix/configure:
	* win/configure: checked in configure scripts so people doing
	CVS checkouts aren't required to have autoconf.  Changes to
	configure.in in the future will require the corresponding
	configure script to also be re-autoconf'ed and checked in.

	* doc/event.n: added note that key events require window focus.

2000-11-01  Jeff Hobbs  <hobbs@@ajubasolutions.com>

	* win/tkWinDialog.c (GetFileNameW, GetFileNameA,
	Tk_ChooseDirectoryObjCmd): created
	work-around for change in NT5.0/98 that caused no initialdir
	setting to open the browser up in the user's documents dir.

	* tests/color.test: marked color-2.6 nonPortable as we can't
	reliably assume what 'red' maps to.

2000-11-01  Eric Melski  <ericm@@ajubasolutions.com>

	* tests/winDialog.test: Corrected expected results for bad option
	tests (5.2, 5.5) to include -multiple option.

	* win/tkWinDialog.c: Added branch for 0 return from
	CommDlgExtendedError() switches; this was formerly treated as an
	error, but it actually is not, since it just means the user hit
	cancel or closed the dialog.  (GetFileNameW): Added better smarts
	such that -multiple is not considered a valid option for
	tk_getSaveFile.
	Removed CommDlgExtendedError() checks for color and choosedir
	dialogs, and removed all except the explicit invalid filename
	checks for the file dialogs.
	
2000-10-30  David Gravereaux  <davygrvy@@ajubasolutions.com>

	* win/configure.in:
	* win/Makefile.in:
	* win/makefile.vc:
	* win/rc/tk.rc:
	* win/rc/tk_base.rc (new):
	* win/rc/wish.rc: Added logic to derive filenames better in the 
	resource scripts based on compile options along with better
	support for building a static wish shell with cursor resources.

2000-10-27  Jeff Hobbs  <hobbs@@ajubasolutions.com>

	* unix/tcl.m4: added support for AIX-5.

	* tests/tk.test: 
	* doc/tk.n: updated to reflect default on status of useinputmethods.
	* library/tk.tcl: tk useinputmethods is set to 1 by default.  This
	enables Kanji and dead-char input by default.  Intro'd in
	1999-12-16 with default off to avoid some problems with older X
	servers that would slow down widget creation over time.

	* win/Makefile.in (test, winhelp, tktest): corrected the
	TCL_LIBRARY path specification.

2000-10-18  Eric Melski  <ericm@@ajubasolutions.com>

	* win/tkWinDraw.c (RenderObject): Applied patch from [Bug: 6368],
	which corrects rendering of 1-pixel wide stippled lines on Windows.

	* generic/tkCanvLine.c (DisplayLine): Applied patch from 
	[Bug: 6368], corrects bugs relating to use of active- and
	disabledwidth values for displaying lines (disabledwidth was never
	used, and activewidth/disablewidths would only possibly be used
	when greater than default width, rather than when simply not equal
	to default width).

	* library/tkfbox.tcl (OkCmd): Applied patch from [Bug: 6365],
	which adds safety for directory names containing spaces or which
	are non-lists.

	* win/tkWinDialog.c (GetFileNameW, GetFileNameA, 
	Tk_ChooseColorObjCmd, Tk_ChooseDirectoryObjCmd): Added error
	checking for the return value from the common dialog functions, so
	that the commands will not silently fail if the common dialog
	returns an error. [Bug: 6369].

2000-10-10  Eric Melski  <ericm@@ajubasolutions.com>

	* generic/tkConfig.c (Tk_InitOptions): Added
	Tcl_IncrRefCount/Tcl_DecrRefCount calls on valuePtr, to prevent
	memory leaks when the value object comes from the option
	database.  [Bug: 6275].

2000-10-06  Jeff Hobbs  <hobbs@@ajubasolutions.com>

	* win/Makefile.in (cat32.${OBJEXT}): add win/ subdirectory to
	cat32 target to correctly find the source file.

2000-10-05  Eric Melski  <ericm@@ajubasolutions.com>

	* generic/tkCmds.c (Tk_WinfoObjCmd): Added check for
	TK_ANONYMOUS_WINDOW flag in the [winfo children] subcommand; if
	set, the window will not be printed in the list of children.

	* doc/CrtWindow.3: Added entry for Tk_CreateAnonymousWindow.

	* generic/tkWindow.c 
	(Tk_CreateAnonymousWindow): New API for creating anonymous
	windows.  These windows are manipulable from C, but not from Tcl,
	because they have no pathname associated with them.  They are used
	initially by widgets that do rubber-band resizing (panedwindow,
	multi-column listbox, etc.), and may be useful for other widgets
	as well (dropbox, combobox).
	(Tk_DestroyWindow): Added check for TK_ANONYMOUS_WINDOW flag when
	determining whether to generate a DestroyNotify event.

	* generic/tkStubInit.c: 
	* generic/tkDecls.h: Regen'd from tk.decls.

	* generic/tk.decls: Added Tk_CreateAnonymousWindow declaration.

	* generic/tk.h: Added TK_ANONYMOUS_WINDOW flag for Tk_Window's.

2000-10-04  Eric Melski  <ericm@@ajubasolutions.com>

	* doc/MaintGeom.3: Noted that Tk_MaintainGeometry handles direct
	descendants properly.

	* generic/tkGeometry.c (Tk_MaintainGeometry): Added a check for
	the case in which the slave window is a direct descendant of the
	master window.  In this case, we need not set up the additional
	infrastructure normally provide by Tk_MaintainGeometry, because we
	can rely on the parent/child relationship to handle it for us
	implicitly.  In this case, Tk_MaintainGeometry just calls directly
	to Tk_MoveResizeWindow.  This allows geometry managers to simply
	always use Tk_MaintainGeometry to maintain geometry for slaves,
	and avoid doing the direct descendant check themselves.
	(Tk_UnmaintainGeometry): Added a matching check for the direct
	descendant case; in this case, Tk_UnmaintainGeometry simply
	returns immediately.

2000-10-01  Eric Melski  <ericm@@ajubasolutions.com>

	* generic/tkButton.c (ConfigureButton): Added tests for -compound
	option, so that when there is a textvariable and an image, and
	-compound is not none, the button will display both the
	textvariable and the image.

	* doc/SetOptions.3: Added note that restoreProc and freeProc may
	be NULL.

	* generic/tkConfig.c (Tk_RestoreSavedOptions): For custom options,
	added test that the restoreProc is not NULL, to allow for custom
	options that don't care about supporting Tk_RestoreSavedOptions.

2000-09-29  D. Richard Hipp <drh@@hwaci.com>

	* generic/tkBitmap.c: Changes to prevent a BadMatch error from the
	Xserver when the same bitmap is used on two or more screens of the
	same display.

	* tests/menu.test: Print a warning if the TK_ALT_DISPLAY environment
	variable is not configured so as to test for the bug fix above.

	* library/tk.tcl (::tk::SetGrabFocus): "Catch" the grab in case
	another application already holds the grab and the "grab" command
	fails.

2000-09-29  Jeff Hobbs  <hobbs@@scriptics.com>

	* win/Makefile.in: commented use of TESTFLAGS
	* unix/Makefile.in: added TESTFLAGS to test and testlang targets to
	conform with Windows makefile and TEA style.

2000-09-29  Eric Melski  <ericm@@ajubasolutions.com>

	* generic/tkTest.c: Fixed tests to use updated API.

	* doc/SetOptions.3:
	* generic/tk.h: 
	* generic/tkConfig.c: Changed interface for Tk_CustomOptionSetProc
	and Tk_CustomOptionGetProc; these now take a pointer to the start
	of the widget record, and an integer offset to the slot for the
	option value, instead of just a pointer to the slot.  This allows
	more sophisticated options to do interesting things based on other
	data in the widget record.

2000-09-17  Eric Melski  <ericm@@ajubasolutions.com>

	* generic/tk.h: Added declaration of Tk_ObjCustomOption structure,
	used for TK_OPTION_CUSTOM, and typedef's of the functions
	Tk_CustomOptionSetProc, Tk_CustomOptionGetProc,
	Tk_CustomOptionRestoreProc, and Tk_CustomOptionFreeProc, used for
	TK_OPTION_CUSTOM.

	* doc/SetOptions.3: Added documentation of TK_OPTION_CUSTOM, and
	section "CUSTOM OPTION TYPES" explaining how to create and use
	custom options.

	* tests/config.test: Added tests for custom option type.

	* generic/tkTest.c: Added test support for TK_OPTION_CUSTOM to
	TestobjconfigObjCmd.  Added CustomOption* functions to implement a
	test custom option.

	* generic/tkConfig.c: Added new option type TK_OPTION_CUSTOM,
	which allows the definition of custom option types by creating
	parsing, printing, freeing, and restoring procedures for a custom
	option.  This is needed by the text and canvas widgets if they are
	to be fully objectified.

2000-09-07  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/Tk_Init.3:
	* doc/bell.n:
	* doc/loadTk.n: minor doc cleanup

2000-09-06  Eric Melski  <ericm@@ajubasolutions.com>

	* doc/HWNDToWindow.3: 
	* doc/GetHWND.3: Changed synopsis to indicate the tkPlatDecls.h
	should be included, not tk.h.

	* generic/tkPlatDecls.h: Removed #include <windows.h> for Windows,
	a better solution for now is to update the docs and have extension
	authors #include <tkPlatDecls.h>.

	* generic/tk.h: Removed '#include "tkPlatDecls.h"', as the
	incorrect inclusion order between windows.h/tkPlatDecls.h causes
	build conflicts on Windows.

	* generic/tkPlatDecls.h: Added #include <windows.h> for Windows,
	so that HWND, etc., are defined properly.

2000-09-06  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/canvas.n: fixed doc bug (ellson). [Bug: 6218]

	* README:
	* generic/tk.h:
	* unix/configure.in:
	* unix/tk.spec:
	* win/configure.in: updated to patchlevel 8.4a2

	* generic/tkMessage.c (MessageWidgetObjCmd): initialized result to
	avoid pedantic warning.

	* generic/tkGrab.c (Tk_GrabObjCmd): changed len arg from size_t to
	int to fix pedantic warning.

2000-09-01  Eric Melski  <ericm@@ajubasolutions.com>

	* win/makefile.vc (install-libraries): 
	* win/Makefile.in (install-libraries): 
	* unix/Makefile.in (install-libraries): Added tkPlatDecls.h to
	list of header files to install.

	* generic/tk.h: Added #include "tkPlatDecls.h", which declares the
	platform specific component of the public Tk stubs API's.

2000-08-29  Eric Melski  <ericm@@ajubasolutions.com>

	* win/tkWinMenu.c (DrawWindowsSystemBitmap): Use scratchDC
	for determining the source's logical coordinates.  Patch from 
	[Bug: 6134 (Markus Oberhumer)].

	* win/tkWinMenu.c (SetDefaults): Compute the indicatorDimensions[]
	under Windows NT/2000 in the same way as under Windows 95/98.
	Patch from [Bug: 6134 (Markus Oberhumer)].

	* win/tkWinFont.c (GetScreenFont): Added a memset() to
	pacify memory checkers.  Patch from [Bug: 6134 (Markus Oberhumer)].

	* library/tkfbox.tcl (::tk::dialog::file::Update): Corrected
	handling of multi-pattern filters (eg, "* *.*"), which was broken
	by the getOpenFile performance patches applied earlier.

2000-08-24  Eric Melski  <ericm@@ajubasolutions.com>

	* doc/toplevel.n: 
	* doc/spinbox.n: 
	* doc/scrollbar.n: 
	* doc/scale.n: 
	* doc/menubutton.n: 
	* doc/menu.n: 
	* doc/listbox.n: 
	* doc/entry.n: 
	* doc/frame.n: 
	* doc/message.n: 
	* doc/checkbutton.n: 
	* doc/radiobutton.n: 
	* doc/button.n: 
	* doc/label.n: 
	* doc/canvas.n: 
	* doc/text.n: Fixed Standard Options section to make best use of
	new tab settings in man.macros.

2000-08-24  Mo DeJong  <mdejong@@redhat.com>

	* unix/README: Update to account for removal of --enable-gcc.
	* unix/configure.in:
	* unix/tcl.m4 (SC_ENABLE_GCC): Remove --enable-gcc option.
	* win/configure.in: 
	* win/tcl.m4 (SC_ENABLE_GCC): Remove --enable-gcc option.
	Remove quick hack that provided cross compile support for
	windows builds.

2000-08-23  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tkButton.c (ButtonTextVarProc): reversed change below,
	it was not correct.

2000-08-22  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tkButton.c (ButtonTextVarProc): changed order of
	incr/decr of new value object, in case they are equal.

2000-08-18  Eric Melski  <ericm@@ajubasolutions.com>

	* generic/tkImgPhoto.c (ImgPhotoGet): Removed redundant call to
	DitherInstance; this call was formerly being made from
	ImgPhotoGet->ImgPhotoConfigureInstance->DitherInstance, and
	ImgPhotoGet->DitherInstance.  The second call was removed.

2000-08-10  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/SetOptions.3: added missing ')'.

2000-08-09  Eric Melski  <ericm@@ajubasolutions.com>

	* doc/SetOptions.3: Updated documentation to reflect support for
	TK_OPTION_NULL_OK for TK_OPTION_DOUBLE and TK_OPTION_PIXELS.

	* generic/tkConfig.c: Added for TK_OPTION_NULL_OK support for
	TK_OPTION_DOUBLE and TK_OPTION_PIXELS.

	* doc/place.n: Updated, reformatted manual entry.

	* tests/place.test: Added many tests.

	* generic/tkPlace.c (Tk_PlaceObjCmd): Updated to use Tk
	widget-option management facilities to manage place options (-x,
	-y, etc.), which simplifies the placer code.  Added support for
	[place configure pathName] and [place configure pathName -option],
	similar to the behavior of the configure subcommand supported by
	widgets.

2000-08-08  Eric Melski  <ericm@@ajubasolutions.com>

	* tests/place.test: Extended test suite to test error returns from
	[place].

	* generic/tkInt.h: Replaced Tk_PlaceCmd prototype with
	Tk_PlaceObjCmd prototype.

	* generic/tkWindow.c: Updated [place] command entry to use new
	Tcl_Obj interface.

	* generic/tkPlace.c (Tk_PlaceObjCmd): Tcl_Obj'ified [place] command.

2000-08-07  Eric Melski  <ericm@@ajubasolutions.com>

	* generic/tkWindow.c: Updated [selection] command entry to use
	new Tcl_Obj interface.

	* generic/tkInt.h: Replaced Tk_SelectionCmd prototype with
	Tk_SelectionObjCmd prototype.

	* tests/select.test: Updated test suite to recognize standardized
	error messages.

	* generic/tkSelect.c (Tk_SelectionObjCmd): Tcl_Obj'ified
	[selection] command.

2000-08-07  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/cursors.n: changed .SS to more compatible macros.

2000-08-05  Jeff Hobbs  <hobbs@@scriptics.com>

	* library/safetk.tcl: rationalized the setting of tk_library when
	initialized Tk in a safe interpreter.

2000-08-03  Eric Melski  <ericm@@ajubasolutions.com>

	* generic/tkWindow.c: Updated "grab" command entry to use
	Tcl_Obj'ified command.

	* generic/tkInt.h: Replaced Tk_GrabCmd prototype with
	Tk_GrabObjCmd prototype.

	* tests/grab.test: Initial suite of tests for [grab] command.

	* generic/tkGrab.c (Tk_GrabObjCmd): Tcl_Obj'ified [grab] command.

	* generic/tkInt.h: Removed Tk_AfterCmd function prototype; the
	function does not exist (since 4.0p3).  Cleaned up some line
	wrapping.
	
	* generic/tk.h: Removed "#define Tk_AfterCmd Tcl_AfterCmd";
	nothing in the core uses Tk_AfterCmd, and Tcl_AfterCmd doesn't exist
	anymore anyway.

	* generic/tkInt.h: Replace Tk_BindCmd prototype with
	Tk_BindObjCmd prototype.

	* generic/tkWindow.c: Updated "bind" command entry to use
	Tcl_Obj'ified command.

	* generic/tkCmds.c (Tk_BindObjCmd): Tcl_Obj'ified [bind] command.

	* tests/bind.test: Tweaked expected error messages for [bindtags]
	to comply with updated error messages.

	* generic/tkMenu.c (CloneMenu): Replaced calls to Tk_BindtagsCmd
	with equivalent calls to Tk_BindtagsObjCmd.

	* generic/tkInt.h: Replace Tk_BindtagsCmd prototype with
	Tk_BindtagsObjCmd prototype.

	* generic/tkWindow.c: Updated "bindtags" command entry to use
	Tcl_Obj'ified command.

	* generic/tkCmds.c (Tk_BindtagsObjCmd): Tcl_Obj'ified [bindtags]
	command.

2000-08-02  Eric Melski  <ericm@@ajubasolutions.com>

	* generic/tkCmds.c (Tk_TkwaitObjCmd): Tcl_Obj'ified [tkwait] command.

	* generic/tkWindow.c: Updated "tkwait" command entry to use
	Tcl_Obj'ified command.

	* generic/tkInt.h: Replace Tk_TkwaitCmd prototype with
	Tk_TkwaitObjCmd prototype.

	* generic/tkGrid.c (Tk_GridCmd): Split [grid] subcommands into
	separate functions instead of inlining them all in Tk_GridCmd.

2000-08-01  Eric Melski  <ericm@@ajubasolutions.com>

	* generic/tkInt.h: Replaced prototype for Tk_MessageCmd with
	prototype for Tk_MessageObjCmd.

	* generic/tkWindow.c: Marked message command as using the new
	MessageObjCmd instead of the old MessageCmd.

	* tests/message.test: Added tests for the message widget.

	* generic/tkMessage.c: Obj'ified the message widget.

	* generic/tkInt.h: Removed prototype for Tk_ClipboardCmd, added
	prototype for Tk_ClipboardObjCmd.

	* generic/tkWindow.c: Updated function pointers for clipboard
	command to use Tcl_Obj version.

	* tests/clipboard.test: Updated tests to expect standard error
	messages.

	* generic/tkClipboard.c (Tk_ClipboardObjCmd): Obj'ified
	Tk_ClipboardCmd -> Tk_ClipboardObjCmd.

2000-07-28  Eric Melski  <ericm@@ajubasolutions.com>

	* unix/tkUnixButton.c (TkpDisplayButton): Added bits to change
	the indicator color when radio-/check-buttons are disabled.  This
	reduces the visual incongruity when a group of these controls are
	disabled together.

	* win/tkWinMenu.c (ReconfigureWindowsMenu): Added MF_GRAYED bit
	for disabled menu entries, to ensure that those which are drawn by
	the system are shown grayed (such as entries on menubars) [Bug: 4372].

	* doc/label.n: Added -disabledforeground to list of options [Bug:
	6053].

	* mac/tkMacDefault.h: 
	* unix/tkUnixDefault.h: Added default values for listbox
	disabledforeground and state.

	* win/tkWinDefault.h: Changed default listbox background color to
	white and listbox selection borderwidth to 0, in keeping with the
	"Microsoft Windows User Experience"; added default values for
	listbox disabledforeground and listbox state.

	* doc/listbox.n: Added documentation for -state option.

	* generic/tkListbox.c: Added support for -state to listbox. [RFE:
	6052].

	* tests/listbox.test: Tests for listbox disabled state.

2000-07-27  Mo DeJong  <mdejong@@redhat.com>

	* win/configure.in: TCL_STUB_LIB_FLAG and
	TK_STUB_LIB_FLAG should not include ${TCL_DBGX}
	in win/tkConfig.sh, fix that.

2000-07-25  Joe English  <jenglish@@flightlab.com>
	* doc: CanvPsY.3, ConfigWidg.3, CrtImgType.3, CrtItemType.3, 
	FontId.3, GetFont.3, canvas.n, font.n, options.n, text.n:
	Documentation fix: Replaced references to XFontStruct *
	and Tk_FontStruct with Tk_Font.

2000-07-24  Eric Melski  <ericm@@ajubasolutions.com>

	* tests/text.test: Added tests for -regexp -nocase searches with
	backslash character classes.

	* generic/tkText.c (TextSearchCmd): Text search did not work
	properly when -regexp and -nocase were used, in combination with
	backslash character classes represented by capital letters (ie,
	\W, \M); altered implementation of -regexp -nocase searches to use
	new regexp interfaces to fix this problem.  [Bug: 5988].

2000-07-21  Eric Melski  <ericm@@ajubasolutions.com>

	* tests/text.test: Added tests for searching when text is elided.

	* generic/tkText.c (TextSearchCmd): Text search was not returning
	the correct index when the search covered (but did not search)
	elided characters; corrected this by adjusting the match index by
	the number of elided characters preceeding the start of the match,
	just as is done with embedded windows, etc. [Bug: 5470].

2000-07-21  Mo DeJong  <mdejong@@redhat.com>

	* win/configure.in: Add TK_STUB_LIB_FLAG and
	TK_BUILD_STUB_LIB_SPEC. These are needed to build a stub enabled
	extension.

2000-07-20  Eric Melski  <ericm@@ajubasolutions.com>

	* unix/tkUnixDraw.c (TkScrollWindow): Replaced a use of a trinary
	operator with an if/else, to avoid build problems on some
	platforms [Bug: 5819].

	* win/makefile.vc: Applied patch from Don Porter to enhance nmake
	support on NT/Alpha [RFE: 5939].

2000-07-19  Eric Melski  <ericm@@ajubasolutions.com>

	* library/text.tcl: Enhanced <Tab> binding to behave like normal
	<Tab> bindings when the text widget is disabled (ie, it advances
	focus to the next widget).

	* generic/tkText.c (TextSearchCmd): Added a test for a NULL
	segment pointer when doing backwards searches for "" on an empty
	text widget. [Bug: 6007].

2000-07-18  Mo DeJong  <mdejong@@redhat.com>

	* unix/aclocal.m4: Use tcl.m4.

	* unix/configure.in: Properly quote LOCALES variable. Properly quote
	argument to m4 macro.
	
	* unix/tcl.m4: Add updated file from tcl.
	
	* win/tcl.m4: Updated file from tcl.

2000-07-18  Eric Melski  <ericm@@ajubasolutions.com>

	* library/tkfbox.tcl: Fixed keyboard navigation in the iconlist.

	* unix/configure.in (MAKE_LIB): Corrected definition of MAKE_LIB
	for shared builds, with patch from Mike Hopkirk.
	
2000-07-18  Mo DeJong  <mdejong@@redhat.com>

	* win/Makefile.in: Fix TCL_GENERIC_DIR variable
	so that it uses the TK_SRC_DIR in the same way
	as the unix version.

2000-07-17  David Gravereaux  <davygrvy@@ajubasolutions.com>

	* generic/tkConsole.c: Added comments for a Win2K OS bug with
	GetStdHandle(STD_OUTPUT_HANDLE).  No change was done to the code
	as the resulting behaviour of ShouldUseConsoleChannel() was
	correct, anyways. [BUG: 5971]

2000-07-17  Eric Melski  <ericm@@scriptics.com>

	* generic/tkStubImg.c (Tk_InitImageArgs): Applied patch from [Bug:
	5990], from Anselm Lingnau, which correctly sets the value of
	useNewImage to 0 when the new image system is not to be used,
	instead of leaving it at -1, which causes the check to be
	performed more times than is really necessary.
	
	* library/bgerror.tcl: Fixed a typo in one of the bgerror dialog
	label.

	* library/msgs/it.msg: Italian message catalog, from Paolo
	Brutti. [RFE: 6012].

2000-07-07  Eric Melski  <ericm@@ajubasolutions.com>

	* library/msgs/el.msg: Greek message catalog, from George Petasis.

2000-07-07  Mo DeJong  <mdejong@@redhat.com>

	* win/configure.in: Fix subst of TK_SHARED_BUILD
	variable in tkConfig.sh.in. Fix definition of
	TK_SRC_DIR variable so that it matches the
	unix version.

2000-07-05  Mo DeJong  <mdejong@@redhat.com>

	* generic/tkFileFilter.c (AddClause): Cast to match function prototype.
	* win/stubs.c (_XInitImageFuncPtrs): Add return value for function.
	* win/tkWinButton.c (buttonStyles, ButtonBindProc, ComputeStyle):
	Remove unused declarations.
	* win/tkWinColor.c (GetColorByName, GetColorByValue): Remove unused
	function declarations.
	* win/tkWinDialog.c (TrySetDirectory): Remove unused function 
	declaration.
	* win/tkWinEmbed.c (TkWinEmbeddedEventProc): Cast to match function 
	prototype.
	* win/tkWinMenu.c (winMenuMutex, MenuExitProc): Remove unused
	declaration.
	* win/tkWinWindow.c (StackWindow): Remove unused declaration.
	* win/tkWinWm.c (ConfigureEvent): Remove unused declaration.
	* win/tkWinX.c (winXMutex): Remove unused declaration.
	* xlib/ximage.c (XCreateBitmapFromData): Cast to match function 
	prototype.

2000-07-05  Eric Melski  <ericm@@ajubasolutions.com>

	* tests/imgPhoto.test: Added test for GIF writing code [Bug: 5823].

	* generic/tkImgGIF.c: Applied patch from Jan Nijtmans to fix a
	problem with the GIF writing code [Bug:	5823].

	* generic/tkCursor.c: Added initialization for nextPtr field of
	TkCursor, patch from Nijtmans/Howlett.

2000-07-05  Eric Melski  <ericm@@ajubasolutions.com>

	* library/msgs/nl.msg: Dutch message catalog for dialogs, from Jan
	Nijtmans.

2000-06-30  Eric Melski  <ericm@@scriptics.com>

	* doc/keysyms.n: 
	* doc/colors.n: Added extra .CE/.CS pairs to break up the large
	text block, so that the generated Windows help file could
	accomodate the manual entry. [Bug: 5862]

	* tests/filebox.test: Adjusted tests to accomodate -multiple.

	* library/xmfbox.tcl: Adjusted arguments list construction such
	that -multiple is not presented as an option for tk_getSaveFile.

	* library/tk.tcl: Added test for safe interpreter status before
	attempting to load message catalogs (which is impossible in a
	standard safe interpreter).  This means that SafeTk will not have
	localized dialogs, unless a means is found for loading the message
	catalog files.

2000-06-29  Eric Melski  <ericm@@scriptics.com>

	* library/msgs/de.msg: German message catalog.
	
	* library/msgs/en.msg: English message catalog.

	* library/msgs/es.msg: Spanish message catalog.

	* library/msgs/fr.msg: French message catalog.

	* unix/Makefile.in: 
	* unix/configure.in: 
	* library/tk.tcl:
	* library/clrpick.tcl:
	* library/choosedir.tcl:
	* library/console.tcl:
	* library/msgbox.tcl:
	* library/tkfbox.tcl:
	* library/xmfbox.tcl:
	* library/bgerror.tcl: Applied patches from Laurent Duperval to 
	provide localization of Tk dialogs. [RFE: 2671].

2000-06-27  Eric Melski  <ericm@@scriptics.com>

	* generic/tkMenu.c (DeleteMenuCloneEntries): Applied fix from
	[Bug: 5275], which corrected a segfault-causing indexing problem
	when deleting entries from torn-off menus.

2000-06-22  Eric Melski  <ericm@@ajubasolutions.com>

	* doc/getOpenFile.n: Updated with information about -multiple.

	* library/choosedir.tcl: Tweaked to handle modified tkIconList API's.

	* library/tkfbox.tcl: Preliminary implementation of multiple
	selection; based on patch from [RFE: 604].  Some of the tkIconList
	functions changed to support this and to make the dialog faster.

	* library/xmfbox.tcl: Added support for multiple selection, from
	patch in [RFE: 4999].

2000-06-21  Eric Melski  <ericm@@scriptics.com>

	* library/text.tcl: Corrected behavior of text widget with respect
	to this sequence of events:  click, shift-click.  Previously, the
	shift-click just moved the cursor and anchor; now, the shift-click
	will select the text between the click and the shift-click, which
	is the behavior most users expect. [Bug: 5929].

2000-06-19  Eric Melski  <ericm@@scriptics.com>

	* library/bgerror.tcl: Added auto-truncation for long error
	messages (more than 30 characters wide, or more than 4 lines
	long), so that the dialog remains a manageable size. [RFE: 5782]

2000-06-15  Eric Melski  <ericm@@scriptics.com>

	* win/tkWinDialog.c: Patched to support tk_getOpenFile
	-multiple. [RFE: 604].

2000-06-13  Eric Melski  <ericm@@scriptics.com>

	* win/aclocal.m4: 
	* win/configure.in: 
	* win/Makefile.in: Applied patch from [RFE: 5844], to provide
	support for the mingw compile environment for Windows.

2000-06-06  Jeff Hobbs  <hobbs@@scriptics.com>

	8.4a1 RELEASE

2000-06-03  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/CrtCmHdlr.3: new doc for ClientMessage handler procs
	* generic/tk.h: added typdef for Tk_ClientMessageProc
	* generic/tkStubInit.c:
	* generic/tkDecls.h:
	* generic/tk.decls: Added Tk_CreateClientMessageHandler and
	Tk_DeleteClientMessageHandler declarations.
	* generic/tkEvent.c (Tk_HandleEvent): Added
	Tk_CreateClientMessageHandler and Tk_DeleteClientMessageHandler to
	allow adding event handlers that invoke for ClientMessage events.
	This is necessary to support unix dnd protocols.

2000-06-02  Jeff Hobbs  <hobbs@@scriptics.com>

	* canvas.test: added test for 5783.
	* generic/tkCanvPoly.c (DisplayPolygon): added checks for the
	polygon fillGC not being empty to prevent segfault. [Bug: 5783]

2000-05-31  Eric Melski  <ericm@@scriptics.com>

	* library/bgerror.tcl: Improved bgerror based on work by Donal
	K. Fellows; no longer dependant on tk_dialog; features a
	Windows-esque "Details" button, and a customizable extra function
	button that allows the user to (for example) save the stack trace
	to a file.

2000-05-30  Eric Melski  <ericm@@scriptics.com>

	* generic/tkImgGIF.c: Changed defines for GIF87a/GIF89a to be
	static char arrays with integer initialization, to address EBCIDIC
	vs. ASCII encoding issues and to handle compilers that don't deal
	with "\xAB" syntax for specifying hex values in strings.

2000-05-28  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/spinbox.n: (new file) docs for spinbox widget
	* generic/tkInt.h: added Tk_SpinboxObjCmd declaration
	* generic/tkEntry.c: added 'spinbox' widget - an extension of the
	entry widget type.
	* generic/tkWindow.c: added 'spinbox' to core Tk commands
	* library/spinbox.tcl: (new file) binding and helper procs for spinbox
	* library/tk.tcl: added spinbox.tcl to list of files to source
	* tests/entry.test: updated changed error messages
	* tests/spinbox.test: (new file) test suite for spinbox

	* generic/tkPlace.c (Tk_PlaceCmd): reworked place master/slave
	table init'n to prevent seg fault when using place on multiple
	displays.

	* generic/tk.h: added comments ot Tk_FakeWin structure

2000-05-26  Eric Melski  <ericm@@scriptics.com>

	* generic/tkOption.c (Tk_GetOption): Extended Tk_GetOption to
	support a new syntax for option names in option tables.  If the
	option name has an embedded ".", it indicates that the name field
	contains both an option name and an overriding widget class, in
	the form "class.option".  The lookup for the option value will be
	performed as though the widget class is that specified, rather
	than the actual widget class.
	(SetupStacks): Replaced several lines of array element copying
	with a for loop for conciseness.

2000-05-25  Eric Melski  <ericm@@scriptics.com>

	* library/button.tcl: Tweaks for -overrelief handling on Windows.

	* doc/radiobutton.n: Added documentation for -overrelief option.

	* doc/checkbutton.n: Added documentation for -overrelief option.

	* doc/label.n: Added documentation for -state option.

	* generic/tkButton.c: Added -overrelief option for checkbuttons,
	and radiobuttons.

	* library/button.tcl (tkButtonDown, macintosh version): Added
	protection against querying the -repeatdelay option from a widget
	that doesn't support it (ie, checkbuttons, radiobuttons, etc).
	Other platforms use a different binding script for checkbuttons
	and radiobuttons, so they don't have this issue.
	(tkCheckRadioEnter, windows version):  Added code to handle
	-overrelief for check/radiobuttons on windows.

2000-05-22  Eric Melski  <ericm@@scriptics.com>

	* generic/tkButton.c: Added -activeforeground, -activebackground
	for labels, for the -state option.

	* doc/label.n: Added documentation for -state option,
	-activeforeground, -activebackground.

2000-05-22  Jeff Hobbs  <hobbs@@scriptics.com>

	* win/Makefile.in (install-libraries): corrected to install X
	headers [Bug: 5516]

	* doc/bind.n: 
	* doc/canvas.n: 
	* doc/entry.n: 
	* doc/listbox.n: 
	* doc/photo.n: doc fix-ups [Bug: 5396]

2000-05-17  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/bell.n:
	* tests/bell.test:
	* generic/tkCmds.c (Tk_BellObjCmd): added -nice option to
	optionally avoid resetting screen saver [Bug: 4279]

2000-05-15  Jeff Hobbs  <hobbs@@scriptics.com>

	* win/tkWinWm.c (Tk_WmCmd): changed wm deiconify from using idle
	callback to calling restack and focus code immediately.

2000-05-17  Eric Melski  <ericm@@scriptics.com>

	Overall change:  Added "-readonlybackground" option for entries,
	to enable a visual change when state goes to readonly.

	* mac/tkMacDefault.h (DEF_ENTRY_READONLY_BG_COLOR,
	DEF_ENTRY_READONLY_BG_COLOR):
	* win/tkWinDefault.h (DEF_ENTRY_READONLY_BG_COLOR,
	DEF_ENTRY_READONLY_BG_COLOR):
	* unix/tkUnixDefault.h (DEF_ENTRY_READONLY_BG_COLOR,
	DEF_ENTRY_READONLY_BG_COLOR): Added default values for entry
	-readonlybackground option.

	* generic/tkEntry.c: Added -readonlybackground option, cleaned up
	excessive use of graphics contexts.

	* tests/entry.test: Added configuration test for
	-readonlybackground option.

	* doc/entry.n: Added documentation for -readonlybackground option.

	Overall change:  changed implementation of "link" relief for
	buttons.  Instead of a new relief style (-relief link), there is a
	new option, -overrelief, which if set is used when the mouse is
	over the button.

	* doc/SetOptions.3: Added information about TK_OPTION_NULL_OK with
	TK_OPTION_RELIEF.

	* win/tkWinButton.c: Removed bits about TK_RELIEF_LINK.

	* tests/button.test: Added tests for -overrelief; removed tests
	for -relief link.

	* mac/tkMacButton.c: Removed bits about TK_RELIEF_LINK.

	* generic/tkOldConfig.c: Removed bits about TK_RELIEF_LINK.

	* generic/tkConfig.c: Removed bits about TK_RELIEF_LINK; added
	support for TK_OPTION_NULL_OK for TK_OPTION_RELIEF.

	* library/button.tcl: Added binding support for -overrelief.

	* generic/tk3d.c (Tk_GetRelief): Added branch for TK_RELIEF_NULL.

	* generic/tkButton.c: Added -overrelief option; removed
	Enter/Leave EventProc masks and handlers.

	* generic/tk.h: Added TK_RELIEF_NULL definition, removed
	TK_RELIEF_LINK.

	* mac/tkMacDefault.h (DEF_BUTTON_OVER_RELIEF): 
	* win/tkWinDefault.h (DEF_BUTTON_OVER_RELIEF): 
	* unix/tkUnixDefault.h (DEF_BUTTON_OVER_RELIEF): Added default
	value for the -overrelief option.

2000-05-16  Eric Melski  <ericm@@scriptics.com>

	* win/tkWinMenu.c (ReconfigureWindowsMenu): Added code to add the
	MF_SEPARATOR bit for SEPARATOR_ENTRY menu items.  This causes
	separator entries on the system menu to be drawn correctly [Bug: 5451].

2000-05-15  Eric Melski  <ericm@@scriptics.com>

	* doc/image.n: Added documentation for [image inuse] command.

	* tests/image.test: Added tests for [image inuse] command.

	* generic/tkImage.c (Tk_ImageObjCmd): Added [image inuse] command,
	which provides a means for programmers to determine if a given
	image is in use by any widgets. [RFE: 3327].

2000-05-14  Eric Melski  <ericm@@scriptics.com>

	* doc/clipboard.n: Added documentation for "clipboard get".

	* generic/tkClipboard.c (Tk_ClipboardCmd): Added "clipboard get"
	subcommand [RFE: 4628].

	* tests/clipboard.test: Updated to use "clipboard get" instead of
	"selection get -s CLIPBOARD".

	* library/entry.tcl: Adjusted Button-1 binding to set focus to the
	entry when it is readonly or normal.

	* doc/entry.n: Added documentation for readonly state,
	-disabledforeground, -disabledbackground.

	* tests/entry.test: Added tests for readonly state.

	* generic/tkEntry.c: Added support for "readonly" state, and
	redefined "disabled" state.  A disabled entry will display its
	text in a dimmed color and possibly with a different background,
	and will be completely unusable (no selection, no editing).  A
	readonly entry will look like a normal entry, but it will not be
	editable; selection is still allowed. [RFE: 4239].  To support the
	new disabled state properly, "-disabledforeground" and
	"-disabledbackground" options were added.
	*** THIS IS A BACKWARDS INCOMPATIBLE BEHAVIOR CHANGE ***

	* win/tkWinDefault.h:
	* mac/tkMacDefault.h:
	* unix/tkUnixDefault.h: Added DEF_ENTRY_DISABLED_FG,
	DEF_ENTRY_DISABLED_BG_COLOR, DEF_ENTRY_DISABLED_BG_MONO.

2000-05-12  Eric Melski  <ericm@@scriptics.com>

	* unix/tkUnixButton.c (TkpDisplayButton, TkpComputeButtonGeometry): 
	* mac/tkMacButton.c (TkpDisplayButton, TkpComputeButtonGeometry): 
	* win/tkWinButton.c (TkpDisplayButton, TkpComputeButtonGeometry): 
	Added code for drawing compound buttons.

	* tests/button.test: Added configuration tests for -repeatdelay,
	-repeatinterval, -compound.

	* library/button.tcl: Added support for -repeatedelay,
	-repeatinterval options.

	* generic/tkOldConfig.c: Changed handling of link relief so that
	proper error messages are used.

	* generic/tkButton.h: Added -compound, -repeatdelay,
	-repeatinterval options.

	* generic/tkButton.c: Added event watchers for enter/leave events,
	for link relief support.

	* generic/tk3d.c: Changed handling of link relief so that proper
	error messages are used.

	* generic/tk.h: Changed values of
	TK_OPTION_LINK_OK/TK_CONFIG_LINK_OK for link relief support.

2000-05-12  Jeff Hobbs  <hobbs@@scriptics.com>

	* win/tkWinFont.c (LoadFontRanges): improved support for all chars
	in 0-255 range for bitmap ANSI fonts.  May be improved to handle
	bitmap non-ANSI fonts in the future. [Bug: 2172]

	* win/tkWinWm.c (RaiseWinWhenIdle): added TK_DONT_DESTROY_WINDOW
	to flag check to prevent timing related core dump. [Bug: 5438]

2000-05-11  Jeff Hobbs  <hobbs@@scriptics.com>

	* win/tkWinTest.c (TestclipboardObjCmd): ensured CloseClipboard
	would always get called for each OpenClipboard.

	* tests/focus.test (focusSetupAlt): removed wm withdraw from proc
	as it would cause a hang for tkwait visibility

	* tests/menu.test:
	* generic/tk3d.c:
	* generic/tkColor.c:
	* generic/tkCursor.c: corrected handling of 3DBorder, Cursor and
	Color objects on multiple screens. [Bug: 5454]

2000-05-09  Eric Melski  <ericm@@scriptics.com>

	* doc/button.n: Added documentation for link relief.

	* tests/button.test: Added tests for link relief for buttons.

	* generic/tk.h (TK_CONFIG_LINK_OK): Added definition of
	TK_RELIEF_LINK, TK_OPTION_LINK_OK and TK_CONFIG_LINK_OK. [RFE: 4348]

	* generic/tk3d.c: Added support for link relief. [RFE: 4348]

	* mac/tkMacButton.c (TkpDisplayButton): 
	* unix/tkUnixButton.c (TkpDisplayButton): Added support for link
	relief. [RFE: 4348]

	* generic/tkOldConfig.c (Tk_ConfigureWidget): 
	* generic/tkConfig.c (DoObjConfig): Added understanding of link
	relief, which is allowed only for widgets that have
	TK_OPTION_LINK_OK or TK_CONFIG_LINK_OK set for the "-relief"
	option. [RFE: 4348]

	* generic/tkButton.c: Added TK_OPTION_LINK_OK to "-relief" option
	for buttons. [RFE: 4348]

	* win/tkWinWm.c (EX_TRANSIENT_STYLE): Removed WS_EX_TOOLWINDOW
	style bit, so that transient windows have full-size titlebars
	(like the tk_getOpenFile dialog).

	* win/tkWinMenu.c (GetMenuSeparatorGeometry): Tweaked height
	requested for separator bars to be (linespace - (2*descent))
	instead of just (linespace); this makes the separator occupy a
	more correct amount of vertical space. [Bug: 5303].

2000-05-09  Jeff Hobbs  <hobbs@@scriptics.com>

	* library/focus.tcl: fixed calling of takeFocus proc [Bug: 5372]

2000-05-02  Jeff Hobbs  <hobbs@@scriptics.com>

	* README:
	* generic/tk.h:
	* library/tk.tcl:
	* mac/README:
	* unix/README:
	* unix/configure.in:
	* unix/tk.spec:
	* win/README:
	* win/aclocal.m4:
	* win/configure.in:
	* win/makefile.vc: updated patchlevel to 8.4a1

	* unix/Makefile.in: added tk.spec to dist target

2000-04-27  Eric Melski  <ericm@@scriptics.com>

	* doc/Tk_Init.3: Added Tk_SafeInit information [Bug: 1884].

	* doc/keysyms.n: Man page enumerating keysyms [RFE: 1645].

	* doc/colors.n: Man page enumerating valid color names [RFE: 1645].

	* doc/cursors.n: Man page enumerating valid cursor values [RFE: 1645].

	* library/msgbox.tcl: Corrected Unix tk_messageBox implementation
	to make the first button the default when no default is specified
	[Bug: 2218].

	* doc/messageBox.n: Updated documentation with regards to
	selection of default button when none is specified (now it will
	use the first button as the default in that case) [Bug: 2218].

2000-04-26  Jeff Hobbs  <hobbs@@scriptics.com>

	8.3.1 RELEASE

	* README:
	* mac/README:
	* unix/README:
	* unix/tk.spec:
	* win/README: Updating URLs to reference dev.scriptics.com

2000-04-25  Jeff Hobbs  <hobbs@@scriptics.com>

	* unix/Makefile.in:
	* win/Makefile.in: makefile cleanup

2000-04-25  Eric Melski  <ericm@@scriptics.com>

	* generic/tkMain.c: Fixed function header comment for Tk_MainEx.

	* unix/mkLinks: 
	* doc/GetScroll.3: Added information about Tk_GetScrollInfoObj
	[Bug: 1866].

2000-04-24  Eric Melski  <ericm@@scriptics.com>

	* unix/mkLinks: 
	* doc/Grab.3: Man page for Tk_Grab and Tk_Ungrab [Bug: 1868, 1889]

	* unix/mkLinks: 
	* doc/MainWin.3: Added entry for Tk_GetNumMainWindows [Bug: 1865].

	* unix/mkLinks: 
	* doc/GetHINSTANCE.3: Man page for Tk_GetHINSTANCE [Bug: 1862].

2000-04-24  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tkImage.c (Tk_PostscriptImage): added check to create
	necessary prolog for photos
	* generic/tkCanvPs.c: added Tk_PostscriptPhoto that outputs PS for
	photo images
	* generic/tkImgPhoto.c: new func ImgPhotoPostscript and added that
	in as ps proc in tkPhotoImageType.
	* generic/tkStubInit.c:
	* generic/tkDecls.h:
	* generic/tk.decls: added Tk_PostscriptPhoto

	* generic/tkConfig.c (DoObjConfig): removed direct setting of
	interp->result.

	* mac/tkMacWm.c (Tk_WmCmd): initialized gotToplevel in
	colormapwindows case (bug found by Reasoning, Inc's automated code
	testing).

2000-04-24  Eric Melski  <ericm@@scriptics.com>

	* unix/mkLinks: 
	* doc/GetHWND.3: Man page for Tk_GetHWND [Bug: 1863].

	* unix/mkLinks: 
	* doc/HWNDToWindow.3: Man page for Tk_HWNDToWindow [Bug: 1869].

	* unix/mkLinks: 
	* doc/AddOption.3: Man page for Tk_AddOption [Bug: 1854]

2000-04-22  Jim Ingham	<jingham@@cygnus.com>

	* mac/tkMacDialog.c (Tk_MacGetOpenFile): Add empty bodies for the 
	"-initialfile" and "-defaultextension" options.

	* mac/tkMacDialog.c (NavServicesGetFile): Only cons the result up
	into a list if multiple is true.

	* mac/tkMacMenus.c (SourceDialog): Use the "tk_getOpenFile"
	instead of hand-coding the dialog with StandardGetFile.  This way
	we get the Navigation dialogs for free.

	* doc/getOpenFile.n: Document the -multiple and -message flags
	which are only implemented on the Mac.  Also note that the -title
	works on the Mac with Nav Services installed.

2000-04-19  Eric Melski  <ericm@@scriptics.com>

	* doc/WinViewable.3: 
	* unix/mkLinks: Removed docs for Tk_IsViewable.

	* win/tkWinDialog.c: Removed calls to Tk_IsViewable.

	* generic/tkUtil.c: 
	* generic/tkStubInit.c: 
	* generic/tkDecls.h: 
	* generic/tkCmds.c: 
	* generic/tk.decls: Removed Tk_IsViewable function (it was not
	actually needed).

2000-04-19  Jeff Hobbs  <hobbs@@scriptics.com>

	* win/aclocal.m4: made SC_PROG_TCLSH search specifically for
	tclsh*.exe type files to find an executable.

	* win/Makefile.in: fixed up cleanup, winhelp, cat32 targets

	* library/console.tcl: made console use systemfixed font on Win

	* generic/tkEntry.c: removed unnecessary ENTRY_VALIDATE #define

2000-04-19  Eric Melski  <ericm@@scriptics.com>

	* generic/tkRectOval.c (ConfigureRectOval): Added checks for valid
	outline settings before creating of outline GC; this means that it
	is really possible now to have an oval or rectangle with no
	outline.  [Bug: 5029].

2000-04-19  Jeff Hobbs  <hobbs@@scriptics.com>

	* library/choosedir.tcl (::tk::dialog::file::chooseDir::Config):
	* library/tkfbox.tcl (::tk::dialog::file::Config): removed the
	extraneous glob on -initialdir after file isdir already returned 1
	and moved cd trick into this case as the else already uses [pwd].
	[Bug: 5181]

	* win/winMain.c: moved extern call out of WinMain func

	* README:
	* generic/tk.h:
	* unix/configure.in:
	* unix/tk.spec:
	* win/configure.in: bumped to version 8.3.1

	* library/msgbox.tcl (tkMessageBox): changed to use grid in some
	places, realign icon to anchor nw.

	* mac/tkMacScale.c: reverted tkMacScale.c to 1.5 equivalent (it
	was accidentally bumped forward).

2000-04-18  Eric Melski  <ericm@@scriptics.com>

	* win/tkWinPointer.c: Changed Mod2Mask in TkWinGetModifierState to
	ALT_MASK, to fix some event problems [Bugs: 1160, 5088].

	* win/tkWinX.c: Changed Mod2Mask in GetState to ALT_MASK, to fix
	some event problems [Bugs: 1160, 5088].

	* generic/tkInt.h: Moved definition of ALT_MASK and META_MASK here
	so that it would be accessible from other modules than tkBind.c.

	* generic/tkBind.c: Added code in BindEvent to check for ALT_MASK
	and META_MASK in the event state field, as this field may not be
	set up with the correct display modifier mask bits if the XEvent
	structure was created by [event generate] or by the Windows X
	emulation. [Bugs: 1160, 5088].

2000-04-18  Scott Redman  <redman@@HILO>

	* win/tk.rc:
	* win/wish.rc:
	* win/wish.ico:  Modified copyright dates in Windows resource
	files.  Updated the icon for wish.exe.

2000-04-17  Eric Melski  <ericm@@scriptics.com>

	* win/tkWinDialog.c: Added checks for visibility of parent window
	before creating MessageBox and ChooseColor dialogs; this prevents
	the application from locking when the parent is withdrawn and the
	message box is created.  In these cases, the window will be
	created without a parent.

	* unix/mkLinks: Added WinViewable.3.

	* tests/msgbox.test: Added tests for patch from [Bug: 4997].

	* library/msgbox.tcl: 
	* library/dialog.tcl: Applied patch from [Bug: 4997]; detaches
	dialog window from parent if parent is not viewable.

	* library/bgerror.tcl: Removed workaround from [Bug: 4370]; this
	is superceeded by patches to dialog.tcl.

	* generic/tkCmds.c: Changed WinfoObjCmd to use Tk_IsViewable
	function to determine visibility of windows instead of inlining
	the code.

	* generic/tkStubInit.c: 
	* generic/tkDecls.h: 
	* generic/tk.decls: Added Tk_IsViewable declaration.

2000-04-17  Eric Melski  <ericm@@scriptics.com>

	* library/text.tcl: Tweaked double-/triple-click selection;
	previously, anchor and insert marks were placed in unexpected
	locations following a double or triple click.  Now they are placed
	logically.  Also tweaked the extension of selection via
	shift-double-clicks so that it no longer selects the contiguous
	whitespace on the side of the selection opposite the
	double-click. [RFE: 4253].

	* doc/menu.n: Added note regarding rendering of
	checkbuttons/radiobuttons in menubars on different platforms --
	some systems do not draw indicators for check/radiobuttons in
	menubars.

	* library/menu.tcl: Corrected behavior of
	checkbuttons/commands/radiobuttons in menubars [Bug: 630].

	* tests/grid.test: Added test for [grid propagate . 0] to not toggle.
	
	* generic/tkGrid.c: Fixed bogus logic in [grid propagate] that
	caused [grid propagate . 0] to act as a toggle instead of an
	absolute set. [Bug: 2286].

2000-04-16  Jeff Hobbs  <hobbs@@scriptics.com>

	* win/tkWinColor.c (FindSystemColor): correct calculation of
	colors when shifting value. [Bug: 4919]

2000-04-16  Jim Ingham   <jingham@@cygnus.com>

	* mac/tkMacPort.h: protect against strncasecmp already defined -
	it is in the Pro5 version of MSL.

	* mac/tkMacWindowMgr.c (GenerateKeyEvent): Check for a null tkWin.
	If the hidden window we use for double-buffering controls manages
	to percolate to the top (should never happen, but...) this will
	keep us from crashing.

	* mac/tkMacButton.c (InitSampleControls): Hide the
	double-buffering window BEHIND the first "." window you can find.
	This will keep it from ever being the front window, and thus a
	black hole for events.  * mac/tkMacButton.c (ButtonEventProc):
	Disable the controls when the window is in the background.  This
	is required by the MacOS HIG. This doesn't always get called when
	it should, it still needs more work.

	* mac/tkMacDialog.c: Pretty substantial rewrite to include
	Navigation Services support for systems which have it.

2000-04-14  Eric Melski  <ericm@@scriptics.com>

	* win/tkWinKey.c: Added check for ASCII delete character in
	KeycodeToKeysym, to fix [Bug: 5090].  See comment in code for more
	information.

	* generic/ks_names.h: Added Scroll_Lock and Sys_Req definitions.

	* win/tkWinKey.c: Changed implementation of KeycodeToKeysym,
	et. al., to use a keycode table for lookups; this will result in
	faster keycode -> keysym translations for non-ASCII keys like
	Control, Alt, etc.

2000-04-14  Jeff Hobbs  <hobbs@@scriptics.com>

	* win/tkWinWm.c (WmProc): added check in WM_MOUSEACTIVATE so we
	correctly activate native menus when clicking in when we didn't
	have focus [Bug: 2272]

	* generic/tkCanvas.c (CanvasEventProc:2451): corrected cast

	* generic/tkEntry.c (Tk_EntryObjCmd): adjusted finishing error
	cases and changed TK_CONFIG_NULL_OK to TK_OPTION_NULL_OK

	* tests/scale.test:
	* generic/tkScale.c:
	* generic/tkScale.h:
	* unix/tkUnixScale.c:
	* mac/tkMacScale.c: moved (PixelToValue|ValueToPixel|SetScaleValue)
	to tkScale.c.  Caused an associated variable to be immediately set
	[Bug: 4833]

	* library/scale.tcl (tkScaleActivate): reduced number of scale
	redisplays by checking current value of state before setting it
	again.  [Bug: 4191]

	* tests/winDialog.test: tk_chooseDirectory seems to get a noop
	from GetOpenFileName in the static build, hanging some tests.
	The tests were fixed to timeout (noop cause unknown).

	* unix/aclocal.m4 (SC_ENABLE_THREADS): enhanced the detection of
	pthread_mutex_init [Bug: 4359] and (SC_CONFIG_CFLAGS) added
	--enable-64bit-vis switch for Sparc VIS compilation [Bug: 4995]

2000-04-13  Eric Melski  <ericm@@scriptics.com>

	* win/tkWinKey.c: Added smarts to check whether the left or right
	Control, Shift, or Alt key was pressed.  [Bug: 870].

	* win/tkWinMenu.c: Corrected code that created separator items on
	menus; originally, it requested that the system be responsible for
	drawing those items, so it would ignore configuration items like
	the widget background.  Now, we draw the separators ourselves (as
	we do with every other kind of menu item already). [Bug: 1166].

	* win/tkWin3d.c: 
	* unix/tkUnix3d.c: Applied patch from [RFE: 2501]: adds more
	sophisticated smarts to TkpGetShadows, so that the highlight of a
	very bright color is actually distinguishable from the color, and
	the shadow of a very dark color is similarly distinguishable from
	the color.

	* generic/tkCanvas.c: Applied patch from [Bug: 4202]; adds a check
	for NULL tkwin in Tk_CanvasEventuallyRedraw.

2000-04-12  Jeff Hobbs  <hobbs@@scriptics.com>

	* test/winClipboard.test:
	* win/tkWinInt.h:
	* win/tkWinClipboard.c (UpdateClipboard):
	* win/tkWinX.c (GenerateXEvent): added updatingClipboard tsd and
	TkWinUpdatingClipboard accessor function to allow us to flag
	ourselves when we are the ones updating the clipboard.  This
	corrected inability to create our own clipboard types within a Tk
	application.  [Bug: 2338 4318]
	* win/tkWinTest.c (TestclipboardCmd): improved TestclipboardCmd
	with better error handling and obj'ification
d28 1
a28 1
2000-04-11  Eric Melski  <ericm@@scriptics.com>
d30 1
a30 1
	* msgcat.n: Added docs for new behavior from patch in [Bug: 4158].
d32 1
a32 10
	* msgcat.test: Added tests for new behavior from patch in [Bug:
	4158].
	
	* msgcat.tcl: Applied patch from [Bug: 4158], which enables
	msgcat::mc to search the entire namespace ancestry chain for
	message translations (ie, first it checks the current namespace,
	then the parent, then the parent's parent, etc).  Also allows the
	specification of additional args for msgcat::mc; if extra args are
	given, the [format] command is used to substitute the additional
	args in the translated message.
d34 4
a37 2
	* library/bgerror.tcl: Moved check for withdrawn state after check
	for tkerror; this was causing problems when tkerror was used.
d39 2
a40 1
2000-04-10  Eric Melski  <ericm@@scriptics.com>
d42 1
a42 5
	* library/bgerror.tcl: Added check for withdrawn state of . and
	unsetting of transient bit for .bgerrorDialog if . is not
	viewable; this protects against the application hanging on systems
	like Windows, where transient windows are withdrawn with their
	parents. [Bug: 4370].
d44 2
a45 2
	* tests/event.test: Added test for [event generate $widget
	<Alt-z>] [Bug: 4611].
d47 1
a47 2
	* tests/choosedir.test: Changed "namespace import ::tcltest" to
	"namespace import -force ::tcltest".
d49 1
a49 4
	* win/tkWinKey.c: 
	* unix/tkUnixKey.c: 
	* mac/tkMacKeyboard.c: Changed InitKeymapInfo to
	TkpInitKeymapInfo. [Bug: 4611].
d51 2
a52 2
	* generic/tkStubInit.c: 
	* generic/tkIntDecls.h: Re-gen'd from tkInt.decls.
d54 1
a54 2
	* generic/tkInt.decls: Added TkpInitKeymapInfo to list of function
	decls.
d56 4
a59 5
	* generic/tkBind.c (HandleEventGenerate): Added code to initialize
	keymap info if necessary, and to correctly set modifier bits in
	XEvent structure create to handle [event generate] calls.
	Previously, the alt/meta bits were not set correctly, so [event
	generate $widget <Alt-z>] would always fail. [Bug: 4611]
d61 2
a62 1
2000-04-07  Jeff Hobbs  <hobbs@@scriptics.com>
d64 1
a64 2
	* generic/tkGrid.c (InitMasterData): fixed uninit'd data in
	GridMaster struct [Bug: 4387]
d66 2
a67 2
	* library/safetk.tcl (disallowTk): made disallowTk work in the
	simple case.
d69 1
a69 2
	* library/comdlg.tcl (tkFocusGroup_In): fixed key navigation
	problems in dialogs under CDE [Bug: 2960]
d71 1
a71 1
	* tests/winDialog.test: removed knownBug constraint from 5.16
d73 1
a73 2
	* win/tkWinFont.c (GetScreenFont): corrected adjustment against
	LC_FACESIZE limitation for NT [Bug: 4931]
d75 2
a76 3
	* win/makefile.vc (TKTEST_OBJS):
	* win/Makefile.in (TKTEST_OBJS): moved tkWinTest.c from normal
	objs to TKTEST_OBJS where it belonged.
d78 2
a79 1
2000-04-03  Jeff Hobbs  <hobbs@@scriptics.com>
d81 3
a83 2
	* generic/tkTest.c: fixed incorrect platform inclusion for
	TkplatformtestInit (it would never get called).
d85 9
a93 2
	* unix/Makefile.in (MAN_INSTALL_DIR): patch to accept --mandir
	correctly [Bug: 4085]
d95 7
a101 2
	* library/clrpick.tcl (tkColorDialog_Config): error now thrown
	when -initialcolor "" specified. [Bug: 4198]
d103 2
a104 1
2000-03-31  Jeff Hobbs  <hobbs@@scriptics.com>
d106 2
a107 1
	* doc/DrawFocHlt.3: doc name correction
d109 2
a110 2
	* generic/tkEntry.c: set TK_OPTION_NULL_OK bit on -invcmd option
	and removed #ifdef ENTRY_VALIDATE expressions
d112 1
a112 2
	* library/menu.tcl (tkMenuInvoke): corrected naming of tearoffs
	[Bug: 4506]
d114 2
a115 3
	* library/tkfbox.tcl (tkIconList_Goto): caused browsecmd to be
	called in tkIconList_Select.  This causes the entry to be set
	properly when using the type-in-name-in-listbox bindings.
d117 1
a117 1
	* win/tkWinDialog.c: added unicode-aware open/save file dialogs
d119 1
a119 2
	* win/tkWinFont.c (TkpFontPkgInit): move private ref to platformId
	to TkWinGetPlatformId
d121 1
a121 3
	* win/tkWinMenu.c (SetDefaults): moved private use of versionInfo
	to TkWinGetPlatformId and removed all code for
	(versionInfo.dwMajorVersion < 4) (== Win32s)
d123 1
a123 4
	* win/tkWinX.c:
	* win/tkWin32Dll.c: moved TkWinGetPlatformId to tkWinX.c
	* win/tkWinInit.c: added TkWinXInit to TkpInit to ensure that its
	called for static Windows shells. [Bug: 3647]
d125 25
a149 4
	* win/tkWinInt.h:
	* win/tkWinX.c:
	* win/tkWinDraw.c (SetUpGraphicsPort): 
	* win/tkWinScrlbr.c (UpdateScrollbar): removed use of tkpIsWin32s
d151 11
a161 3
	* win/tkWinInt.h (TkWinDCState struct): added bkmode value
	* win/tkWinDraw.c (TkWinGetDrawableDC, et al): added support for
	properly transparent dashed lines on Windows. [Bug: 4617]
d163 2
a164 1
2000-03-30  Eric Melski  <ericm@@scriptics.com>
d166 2
a167 3
	* generic/tkImgGIF.c: Fixed some ANSI specific bits to avoid
	compile problems with non-ANSI compilers (ie, replace const with
	CONST, etc).  [Bug: 4223].
d169 3
a171 2
	* unix/configure.in: Applied patch from [Bug: 4237]; ensures that
	srcdir is fully qualified.
d173 2
a174 3
	* unix/Makefile.in: Applied patch from [Bug: 4237]; if tcltest was
	not compiled, make test/tktest failed.  Now it has a rule to build
	tcltest if it has not been built.
d176 3
a178 1
2000-03-28  Eric Melski  <ericm@@scriptics.com>
d180 1
a180 2
	* library/tkfbox.tcl: Moved an overlooked tkFDialog* function in
	::tk::dialog::file namespace.
d182 3
a184 2
	* tests/unixWm.test: Added tests for memory leak conditions in
	tkUnixWm.c.
d186 1
a186 2
	* tests/canvas.test: Added test for bad configuration options on
	empty and non-empty canvas.
d188 8
a195 3
	* generic/tkCanvas.c: Removed bad code in CANV_CONFIGURE block of
	CanvasWidgetCmd; this was causing non-empty canvases to improperly
	handle bad configuration options [Bug: 4456].
d197 1
a197 1
2000-03-27  Eric Melski  <ericm@@scriptics.com>
d199 1
a199 2
	* unix/tkUnixWm.c: Applied patch from [Bug: 4405]; fixes memory
	leak in Unix wm command.
d201 1
a201 1
2000-03-24  Eric Melski  <ericm@@scriptics.com>
d203 3
a205 2
	* tests/filebox.test: 
	* tests/choosedir.test: Updated tests.
d207 1
a207 2
	* library/xmfbox.tcl: Updated to stash data array in
	::tk::dialog::file namespace instead of in global namespace.
d209 3
a211 7
	* library/tkfbox.tcl: Extended some functions to support creation
	of a choosedir dialog, to allow greater code reuse between the two
	dialogs.  Moved tkFDialog* functions into a namespace
	(::tk::dialog::file).  Because these are private Tk functions (and
	should thus not be used directly by users), this should not impact
	anybody (the tk_getOpenFile and tk_getSaveFile commands still
	exist at the global scope).
d213 1
a213 3
	* library/tk.tcl: 
	* library/tclIndex: Updated function names for tkFDialog*
	functions and choosedir functions.
d215 4
a218 2
	* library/choosedir.tcl: New and improved implementation of
	tk_chooseDirectory dialog.  Based on tk_getOpenFile dialog.
d220 2
a221 1
2000-03-23  Eric Melski  <ericm@@scriptics.com>
d223 1
a223 2
	* generic/tkWindow.c: 
	* generic/tkInt.h: Updated Tcl_OptionCmd -> Tcl_OptionObjCmd
d225 2
a226 1
	* generic/tkOption.c: Tcl_Obj'ectified the "option" command.
d228 1
a228 1
2000-03-22  Eric Melski  <ericm@@scriptics.com>
d230 3
a232 3
	* library/listbox.tcl (tkListboxCancel): Added a check for empty
	string value for tkPriv(listboxPrev).  Without this check, it's
	possible to get a stack trace under certain conditions. [Bug: 4373].
d234 1
a234 1
2000-03-15  Sven Delmas  <sven@@scriptics.com>
d236 8
a243 6
	* win/tkWinDialog.c: Changed the behavior for the
	tk_chooseDirectory dialog under Windows. Instead of trying to
	return the currently selected listbox entry (which didn't work in
	case the user selected the initial directory anyway), we now
	return the value shown in the entry. This seems to be in
	accordance with the expected behavior for this dialog.
d245 1
a245 1
2000-03-14  Eric Melski  <ericm@@scriptics.com>
d247 1
a247 2
	* tests/choosedir.test: Marked test 3.1 and 3.2 as bad until the
	issue with those tests on IRIX can be determined.
d249 7
a255 1
2000-03-10  Eric Melski  <ericm@@scriptics.com>
d257 2
a258 2
	* library/menu.tcl: Applied patch from [Bug: 4155]; protects
	against grabs on non-viewable windows.
d260 8
a267 1
2000-03-08  Eric Melski  <ericm@@scriptics.com>
d269 1
a269 3
	* tests/choosedir.test: Modified test 3.1 (-mustexist works) to be
	more careful about cleaning up its potentially troublesome after 
	events.
d271 2
a272 1
2000-03-07  Eric Melski  <ericm@@scriptics.com>
d274 2
a275 2
	* tests/button.test: 
	* generic/tkButton.c: Added -disabledforeground/-state to labels.
d277 1
a277 1
2000-03-07  Jeff Hobbs  <hobbs@@scriptics.com>
d279 10
a288 5
	* tests/entry.test:
	* generic/tkEntry.c (EntrySetValue): malloc the value when
	validating because validation could cause the pointer to become
	invalid.  Also fixed configure to not trigger focus-based
	validation.  Improved use of Tcl_WrongNumArgs. [Bug: 4320]
d290 1
a290 1
2000-03-06  Eric Melski  <ericm@@scriptics.com>
d292 9
a300 7
	* library/menu.tcl: Added a check in tkMenuFirstEntry that changes
	menu behavior to only auto-post an immediate child cascade if we
	are currently on a menubar menu.  This prevents massive
	auto-cascading in cases where the first entry of the cascade is
	itself a cascade, and the first entry of that cascade is a
	cascade, and the first entry of that cascade is a cascade
	... [Bug: 676].
d302 3
a304 2
	* generic/tkOldConfig.c: Added check for NULL tkwin value in
	Tk_ConfigureWidget [Bug: 4079]
d306 2
a307 2
	* generic/tkWindow.c: Added check for NULL tkwin value in
	Tk_NameToWindow [Bug: 4079]
d309 1
a309 1
2000-03-02  Jeff Hobbs  <hobbs@@scriptics.com>
d311 2
a312 4
	* tests/color.test:
	* xlib/xcolors.c (XParseColor FindColor):
	* win/tkWinColor.c (XAllocColor): Fixed bit fiddling for colors to
	return "correct" values for color mapping. [Bug: 4282]
d314 1
a314 2
	* unix/Makefile.in (SCRIPT_INSTALL_DIR): removed extraneous '/'
	* unix/aclocal.m4: corrected TCL_NEEDS_EXP_FILE to be 1 for AIX
d316 1
a316 2
	* win/tkWinInt.h: change extern to EXTERN for TkWinChildProc
	declaration with extra #defs. [Bug: 4240]
d318 1
a318 2
	* library/focus.tcl: fixed tkFocusOK to protect $w in
	uplevel with list. [Bug: 4208]
d320 1
a320 3
	* doc/CrtItemType.3: fixed docs for Tk_CreateItemType to reflect
	changes made in 8.3.0 (but old style would still work as well).
	[Bug: 4252]
d322 1
a322 4
	* tests/config.test: extra test to check object cleanup when
	destroying the widget
	* generic/tkListbox.c (DestroyListbox): fixed crash in
	DestroyListbox due to null tkwin.  [Bug: 4207]
d324 1
a324 9
	* tests/entry.test: added test suite for entry validation
	* doc/entry.n: improved docs discussing caveats and gotchas when
	mixing textvar with widget validation
	* generic/tkEntry.c (EntryValidateChange): improved handling of
	validation with relation to -textvariable.  Previously, it would
	turn off whenever the textvar was set.  Now it will it will turn
	off only when the textvar is set and validation returns 0.  Added
	%V (type of validation occuring) to %-subs to help work with
	trickier validation.
d326 131
a456 1
2000-03-01  Eric Melski  <ericm@@scriptics.com>
d458 1
a458 3
	* tests/clrpick.test: 
	* library/clrpick.tcl: Added code to make color chooser dialog
	inherit screen setting from parent (bug #2334)
d460 2
a461 1
2000-02-25  Jeff Hobbs  <hobbs@@scriptics.com>
d463 1
a463 3
	* win/tkWinWm.c (RaiseWinWhenIdle): Checked for the possibility
	that the window could be destroyed (can occur with
	wm deiconify .toplevel; destroy .toplevel).
d465 1
a465 1
2000-02-25  Eric Melski  <ericm@@scriptics.com>
d467 2
a468 4
	* generic/tkImgGIF.c: Applied "spirit of" the patch in 1605 (the
	submitted patch was more complicated than necessary and did not
	extend to writing GIF's, only reading), to allow reading/writing
	of GIF files on EBCDIC and other non-ASCII based systems.
d470 13
a482 1
2000-02-14  Eric Melski  <ericm@@scriptics.com>
d484 1
a484 2
	* unix/tk.spec: RPM specification for producing a binary Tk RPM
	for Linux.
d486 62
a547 2
	* unix/Makefile.in: Added rpm target to generate Tk
	binary RPM.
d549 1
a549 1
2000-02-10  Jeff Hobbs  <hobbs@@scriptics.com>
d551 21
a571 1
	8.3.0 RELEASE
d573 1
a573 1
	* changes: updated for 8.3.0 release
d575 4
a578 1
	* generic/tkImgGIF.c (FileReadGIF): added cast for trashBuffer
d580 2
a581 3
	* generic/tkIntXlibDecls.h:
	* generic/tkInt.decls: declared some Xlib emulation calls for
	the Mac
d583 1
a583 2
	* generic/tkFrame.c (TkInstallFrameMenu): added extra panic to
	inform user of bad call when framePtr is NULL [Bug: 2530]
d585 3
a587 2
	* generic/tkMenu.c (DestroyMenuInstance): Placed checks around
	menu name objects before trying to incr the ref.  [Bug: 3402]
d589 1
a589 1
	* generic/tkTest.c: removed USE_OLD_IMAGE def for Mac
d591 3
a593 3
	* library/listbox.tcl:
	* library/text.tcl: added support for <4> and <5> for mousewheel
	style scrolling on Unix for mice that map to these buttons.
d595 3
a597 2
	* tests/scrollbar.test: fixed check of testmetrics command to
	allow unix tests to run (testmetrics is mac/pc only)
d599 1
a599 2
	* unix/tkUnixWm.c (Tk_CoordsToWindow): qualified delete of error
	handler as the goto label is reached from above and below.
d601 2
a602 3
	* unix/configure.in:
	* unix/aclocal.m4: cleaned up macros to coincide with tcl.m4,
	added -export-dynamic to LDFLAGS for FreeBSD-3+ [Bug: 2998]
d604 1
a604 112
	* unix/README:
	* unix/Makefile.in (dist): removed porting.notes and porting.old
	from distribution and CVS.  The information was very outdated.  Now
	refer to http://dev.scriptics.com/services/support/platforms.html

	* xlib/xgc.c: #def'd out XDrawSegments for the Mac, and added
	some extra include info for the Mac

2000-02-09  Jim Ingham  <jingham@@cygnus.com>

	* mac/tkMacButton.c: Stop removing the appearance window from the
	Window List.  It is not clear why Ray did this, and it causes the
	Appearance manager to crash at random times.
	
	* mac/tkMacWM.c: Add support in unsupported1 style for the Appearance
	specification of window styles, including floating window support.
	* mac/tkMacWindowMgr.c: Operate on the front non-floating window,
	unless the mouse is directly over the floating window.  Also,
	keystrokes go to the front non-floating window.
	* mac/tkMacAppInit.c: Initialize floating window support.
	* mac/tkMacScrlbr.c:
	* mac/tkMacmenu.c: Fixes for floating windows - operate on the 
	FrontNonFloatingWindow.
	* mac/tkMacLibrary.r: Fix typo in File info string.
	* mac/tkMacApplication.r: Fix typo in file info string.  Add
	Finder balloon help for no apparent reason.
	
	* mac/tkMacSubwindows.c: Change panic in tkMacGetDrawablePort to
	Debugger.  This is only a temporary fix.  The panic is only
	triggered when a safeTk interpreter is torn down, and ignoring it
	does no harm.  I haven't figured out how to avoid it yet, however.
	Also use the Appearance MoveWindowStructure call when available.
	
	New Files:
	* MW_TkOldImageHeader.h: Handle #defining USE_OLD_IMAGE for tkImgPPM.c.
	* MW_TkTestHeader.h:
	* MW_TkTestHeader.pch:
	* MW_TkHeader.h: Add separate prefix files for test & release
	versions of Tk, so we can just have separate targets w/o having to
	edit files.
	
	* tclets.r: The D&D Tclets icon in rez form so we can have a
	target for this.

	The above are curtesy of Daniel Steffen (steffen@@math.mq.edu.au)
	
	* tkMacAppearanceStubs.c: Stubs of the Mac Appearance calls I use
	so I can link the static 68K Shell without putting ifdef's all
	over the code.
	
2000-02-08  Jeff Hobbs  <hobbs@@scriptics.com>

	* generic/tk.decls:
	* generic/tkBind.c:
	* generic/tkInt.decls:
	* generic/tkIntDecls.h:
	* generic/tkStubInit.c:
	* mac/tkMacKeyboard.c:
	* unix/tkUnixKey.c:
	* win/tkWinKey.c: Fix for keyboard handling of "dead" keys and
	caps lock from Peter Spjuth. [Bug: 4105 3359 2493]
	Split functions into platform specific files:
	Static functions GetKeySym(), SetKeycodeAndState() and InitKeymapInfo()
	from tkBind.c moved into platform files tkWinKey.c tkUnixKey.c and
	tkMacKeyboard.c.  GetKeySym() and SetKeycodeAndState() renamed to 
	Tkp* and made public (as private functions) in tkInt.decls.

	Step 2, fixes in tkWinKey.c
	New static function: KeycodeToKeysym(), based on XKeycodeToKeysym()
	but with different arguments, and a lot of improvements.
	TkpGetString() changed to use KeycodeToKeysym() + other fixes.
	TkpGetKeySym() changed to use KeycodeToKeysym() + other fixes.
	InitKeymapInfo() changed to use KeycodeToKeysym().
	TkpSetKeycodeAndState() rewritten, mostly by copying code from
	XKeysymToKeycode().
	XKeycodeToKeysym() rewritten. Preferably it should be removed.

	EXPLANATION: The main problem is ToAscii() which has a lot of side
	effects, and also that XKeycodeToKeysym() is not provided enough
	input to do a proper job.  The changes' main goal is to avoid
	calling ToAscii() if not necessary, and to provide it with as
	correct information as possible when called.  Also some attempts
	to clean up what ToAscii() did are done.  See the code for details.

	BUGS FIXED: Typing shifted (and AltGr) dead keys did not work.
	Keyboard lock lamps did not work on Win98.
	Events regarding AltGr-keys behaved badly.
	Example: On a Swedish keyboard, $ is typed with AltGr-4.
	That keyboard event would get the keysym '4' not 'dollar'.
	Also, doing [event generete . <Key-dollar>] would send keysym '4'.
	Translation to ascii in TkpGetString did not handle return and
	tab correctly. I.e. [event generate . <Key-Return>] gave wrong %A

	* generic/tkDecls.h:
	* generic/tk.decls:
	* generic/tk.h: moved new public functions created in dash patch
	to the stubs interface [Bug: 4062]

	* generic/tk.h: 
	* doc/CrtImgType.3:
	* doc/CrtPhImgFmt.3:
	* generic/tk.h:
	* generic/tkImgGIF.c:
	* generic/tkImgPhoto.c:
	* generic/tkStubImg.c (new file):
	* generic/tkTest.c:
	* unix/Makefile.in:
	* win/Makefile.in:
	* win/makefile.vc: improved support for moving from the old style
	image C API to the new obj'ified one with new Tk_InitImageArgs
	command and stub'ing of image code.  See docs for how to make the
	transition. [Bug: 4060]
d606 2
a607 2
	* library/tk.tcl: wrapped check for tcl_platform(os) around info
	exists because it won't in safe interpreters
d609 1
a609 2
	* win/tkWinFont.c: corrected symbol font use to only work on 8-bit
	characters [Bug: 2406]
d611 4
a614 1
	* unix/aclocal.m4: changed all -fpic to -fPIC
d616 1
a616 4
	* README:
	* unix/configure.in:
	* win/configure.in:
	* generic/tk.h (TK_RELEASE_SERIAL): Moved to 8.3.0 patchlevel
d618 6
a623 1
2000-02-07  Eric Melski  <ericm@@scriptics.com>
d625 1
a625 4
	* library/tkfbox.tcl: Applied patch from bug #4117,
	tk_getOpenFile/getSaveFile doesn't do the right thing when user
	types a directory name in the entry and a default extension is
	specified.
d627 6
a632 1
2000-02-05  Jeff Hobbs  <hobbs@@scriptics.com>
d634 1
a634 3
	* unix/tkUnixScale.c (TkpDestroyScale): changed ckfree to
	Tcl_EventuallyFree to behave with Tcl_Preserve in TkpDisplayScale
	(prevents possible segfault).
d636 4
a639 1
2000-02-03  Eric Melski  <ericm@@scriptics.com>
d641 1
a641 1
	* tests/canvText.test: test for fix for bug #2525.
d643 2
a644 4
	* generic/tkFont.c (Tk_ComputeTextLayout): Was erroneously setting
	the width of newline-only text display chunks to some arbitrary
	huge number, instead of 0; this was interfering with things like
	the canvas find enclosed feature. (bug #2525).
d646 1
a646 5
	* tests/text.test: 
	* generic/tkText.c (DumpLine/DumpSegment): Changed DumpSegment to
	take a TkTextIndex instead of two integer offsets, so that it
	could use TkTextPrintIndex to format the offsets into an index,
	which makes it UTF smart (bug #2582).
d648 38
a685 1
2000-02-01  Eric Melski  <ericm@@scriptics.com>
d687 1
a687 6
	* library/tk.tcl: 
	* library/tclIndex: 
	* library/choosedir.tcl: Moved choosedir functions into the
	::tk::dialog::chooseDir namespace instead of a toplevel
	::tkChooseDirectory namespace.  Additional cleanup on the
	chooseDir dialog.
d689 7
a695 1
2000-02-01  Jeff Hobbs  <hobbs@@scriptics.com>
d697 1
a697 2
	* doc/text.n: clarified docs on what happens during a search with
	-count when images/windows are embedded
d699 2
a700 1
	* win/Makefile.in (install-*): reduced verbosity of install
d702 1
a702 2
	* win/tkWinPixmap.c (XGetGeometry): added support for windows in
	XGetGeometry [Bug: 4069]
d704 1
a704 2
	* win/tkWinFont.c (GetScreenFont): fixed possible mem overrun with
	long font names [Bug: 4108]
d706 4
a709 3
	* win/tkWinDialog.c: added EnableWindow calls to dialogs to
	correct for possible loss of control in parent Tk toplevel
	[Bug: 1212 et al]
d711 5
a715 5
	* generic/tkRectOval.c (ConfigureRectOval): 
	* generic/tkCanvLine.c (ConfigureLine): 
	* generic/tkCanvPoly.c (ConfigurePoly): 
	* generic/tkCanvArc.c (Configure/DisplayArc): fixed handling for
	negative dash values [Bug: 4104]
d717 4
a720 5
	* generic/tkScale.c (TkRoundToResolution): fixed incorrect
	assumption that (N+1)*delta = N*delta + delta with floating point
	math [Bug: 3689, 4099]
	(DestroyScale) Fixed check for cancelling TkpDisplayScale (was
	REDRAW_ALL, is now REDRAW_PENDING)
d722 1
a722 1
	* tests/listbox.test: corrected test case for listbox itemconfigure
d724 3
a726 2
	* unix/aclocal.m4: added *BSD ELF recognition for
	SHARED_LIB_SUFFIX determination (from Tcl's tcl.m4)
d728 2
a729 1
2000-01-27  Eric Melski  <ericm@@scriptics.com>
d731 3
a733 2
	* generic/tkImgPhoto.c: Removed unneccesary object translation in 
	MatchStringFormat (bug #4103).
d735 1
a735 1
2000-01-27  Eric Melski  <ericm@@scriptics.com>
d737 4
a740 2
	* generic/tkImgGIF.c: Additional code cleanup (now we only have
	one decoder!  neat!)
d742 11
a752 1
2000-01-26  Eric Melski  <ericm@@scriptics.com>
d754 3
a756 3
	* doc/getOpenFile.n: 
	* doc/chooseDirectory.n: Man page/cross links for
	tk_chooseDirectory (bug #1786).
d758 1
a758 2
	* library/tk.tcl: 
	* library/tclIndex: Added hooks for tk_chooseDirectory. (bug #1786)
d760 4
a763 2
	* library/choosedir.tcl: tk_chooseDirectory implementation for
	Unix/Mac (bug #1786).
d765 2
a766 2
	* generic/tkImgPhoto.c: Added some comments regarding slow
	processing of transparent images.
d768 1
a768 3
	* generic/tkImgGIF.c: Improved GIF decoder for ~60% speed
	increase.  Added some comments on how to further improve the
	implementation, time permitting.
d770 5
a774 2
	* doc/photo.n: Added a description of what the -data string can
	contain (base64 or binary data).
d776 15
a790 2
	* generic/tkImgPhoto.c: Fixed bug with use of binary data for
	"-data" option to "image create" command.
d792 1
a792 1
2000-01-21  Eric Melski  <ericm@@scriptics.com>
d794 3
a796 3
	* library/tkfbox.tcl: Fixed bug relating to incorrect parent
	values for error message boxes displayed by the file dialog (bug
	#3616).
d798 1
a798 3
	* tests/text.test: 
	* generic/tkText.c: Fixed bug relating to regexp searching for
	empty lines; previously, the starting line was ignored. (bug #1643).
d800 6
a805 1
2000-01-20  Jeff Hobbs  <hobbs@@scriptics.com>
d807 1
a807 2
	* library/text.tcl: fixed double-click selection behavior where
	there were embedded windows/widgets in the same line. [Bug: 3989]
d809 2
a810 2
	* win/tkWinWm.c (TkWmProtocolEventProc): cached atom name as the
	window could get destroyed during eval [Bug: 2513]
d812 1
a812 3
	* generic/tkCanvLine.c (LineCoords): fixed segfault when too few
	coords were passed to a line with certain options set (it should
	always have thrown an error anyway). [Bug: 4042]
d814 9
a822 3
	* tests/text.test:
	* generic/tkText.c: fixed missing " in error case and missing
	'dump' in subcommand listing [Bug: 4036]
d824 4
a827 4
	* generic/tkListbox.c: adjusted use of basic string concatenation
	in (non-K&R behavior) [Bug: 4027]
	Swapped bg/fg class for -select(bg|fg) for listbox and their
	items [Bug: 4039]
d829 3
a831 2
	* unix/mkLinks:
	* doc/WindowId.3: added docs for Tk_IsContainer and Tk_IsEmbedded
d833 1
a833 2
	* doc/text.n: clarified mark gravity definition and usage of
	``word'' in binding definitions.  [Bug: 2004 2277 1388]
d835 6
a840 3
	* generic/tkInt.h: moved new TkDisplay useInputMethods structure
	element to end to not disturb position of previous elements in
	the structure (as compared to Tk <=8.2).
d842 1
a842 1
2000-01-20  Eric Melski  <ericm@@scriptics.com>
d844 2
a845 2
	* tests/grid.test: Added a test for the consecutive ^ and multiple
	widget case (bug #1386).
d847 1
a847 7
	* generic/tkGrid.c: Fixed interpretation of consecutive ^
	characters in grid command.  Previously, ^ ^ was interpreted as
	meaning that there must be a 2-column widget above to extend,
	neglecting the case where there was actually 2 1-column widgets
	above.  Now, ^ ^ is interpreted as a possible width; the gridder
	will consume as many ^'s as there are columns in the widget, and
	leave the rest for the extension of other widgets.  (bug #1386).
d849 3
a851 1
2000-01-19  Eric Melski  <ericm@@scriptics.com>
d853 60
a912 3
	* library/tk.tcl: Created a virtual event <<PrevWindow>> for
	reverse tab traversals, with one default binding <Shift-Tab>, and
	OS specific bindings for Linux, HP-UX, and IRIX. (bug #3163)
d914 1
a914 1
2000-01-13  Jeff Hobbs  <hobbs@@scriptics.com>
d916 6
a921 5
	* changes: updated changes file to reflect 8.3b2 mods
	* README:
	* generic/tk.h:
	* unix/configure.in:
	* win/configure.in: updated to patchlevel 8.3b2
d923 1
a923 3
	* win/tkWinWm.c: added visibility event handler to make sure
	that transient window wrappers would be updated when the master
	was initially mapped.
d925 2
a926 1
2000-01-12  Jeff Hobbs  <hobbs@@scriptics.com>
d928 1
a928 2
	* tests/text.test: changed test to reflect change of -hidden
	to -elide in search options.
d930 1
a930 2
	* win/tkWinScrlbr.c: added check for valid hwnd in ModalLoopProc
	to avoid crash when building statically
d932 10
a941 4
	* doc/event.n:
	* generic/tkBind.c: prevented core with event -warp on Windows
	when window wasn't mapped [Bug: 4004] and added docs stating
	the requirement for mapped windows.
d943 1
a943 2
	* generic/tkCanvas.c: fixed mem leak with TagSearchExprInit
	[Bug: 3977]
d945 2
a946 3
	* generic/tkStubInit.c:
	* generic/tkDecls.h: remove non-existent
	Tk_(Get|Create)CanvasVisitor prototypes
d948 1
a948 3
	* generic/tkText.c:
	* generic/tkEntry.c: fixed cursor to not blink when widget was
	disabled [Bug: 1807]
d950 110
a1059 2
	* generic/tkRectOval.c: added note about change to bloat for
	RectOval bounds calculation for WIN32 only
d1061 1
a1061 2
	* library/dialog.tcl: improved handling of $default arg to allow
	for name of given button, as well as bounds checking
d1063 1
a1063 10
	* doc/wm.n:
	* tests/winWm.test:
	* tests/unixWm.test:
	* mac/tkMacWm.c:
	* unix/tkUnixWm.c: fixed possible X error being raised [Bug: 3377]
	* win/tkWinWm.c: wm deiconify in zoom state [Bug: 2077],
	fixed possible flashing of unmapped toplevel in deiconify [Bug: 3338]
	and fixed mapping of transient window [Bug: 572]
	Also, for all wm's, extended 'wm state' command to allow setting
	of the state, and added official support of 'zoomed' state on Win.
d1065 1
a1065 1
	* unix/aclocal.m4: strtod bug on Tru64 [Bug: 3378]
d1067 205
a1271 2
	* unix/Makefile.in: added tests to prevent unnecessary chmod +x
	in source dirs while installing [Bug: 3367]
d1273 1
a1273 1
	* unix/configure.in: properly sub'ed in TK_SHARED_BUILD [Bug: 3385]
d1275 48
a1322 1
2000-01-05  Jeff Hobbs  <hobbs@@scriptics.com>
d1324 1
a1324 8
	* doc/text.n:
	* generic/tkText.c:
	* generic/tkText.h:
	* generic/tkTextBTree.c:
	* generic/tkTextDisp.c:
	* generic/tkTextTag.c: removed the -state option for text tags,
	and reoriented it around -elide, as -state disabled was never
	implemented, and -state hidden is better as -elide.
d1326 4
a1329 1
	* mac/tkMacClipboard.c: fixed i18n problems with clipboard [Bug: 3544]
d1331 2
a1332 10
	* library/entry.tcl:
	* library/focus.tcl:
	* library/listbox.tcl:
	* library/scale.tcl:
	* library/scrlbar.tcl:
	* library/tearoff.tcl:
	* library/text.tcl:
	* library/tkfbox.tcl:
	* library/xmfbox.tcl: fixed unprotected arg parsing through eval/after
	[Bug: 3943]
d1334 1
a1334 2
	* unix/Makefile.in: added unix/aclocal.m4 to distribution [Bug: 3938]
	* unix/aclocal.m4: changed NetBSD SHLIB_CFLAGS from -fpic to -fPIC
d1336 2
a1337 1
	* win/tkWinImage.c: added static declaration to function
d1339 1
a1339 1
1999-12-22  Jeff Hobbs  <hobbs@@scriptics.com>
d1341 80
a1420 1
	* changes: updated changes file
d1422 1
a1422 4
	* generic/tkScale.c:
	* generic/tkScale.h:
	* mac/tkMacScale.c:
	* unix/tkUnixScale.c: fixed potential segv from patch in 3897
d1424 3
a1426 1
	* tests/unixWm.test: nonPOrtable -> nonPortable
d1428 1
a1428 1
1999-12-21  Jeff Hobbs  <hobbs@@scriptics.com>
d1430 2
a1431 5
	* generic/tk.h:
	* unix/configure.in:
	* win/configure.in:
	* win/aclocal.m4:
	* README: updated for patch level 8.3b1
d1433 2
a1434 2
	* unix/tkUnixWm.c: fixed panic in Tk_CoordsToWindow to print error
	and continue instead (for Tix) [Bug: 716 et al]
d1436 1
a1436 4
	* scale.test:
	* generic/tkScale.c:
	* generic/tkScale.h: fixed possible core when freeing options
	(cursor) associated with scale widget [Bug: 3897]
d1438 27
a1464 2
	* doc/MeasureChar.3: fixed docs for Tk_MeasureChars to reflect code
	* doc/listbox.n: fixed formatting problem
d1466 1
a1466 2
	* generic/tk3d.c: added extra calculations to ensure that thin
	frames get refreshed too [Bug: 3596]
d1468 2
a1469 7
	* unix/tkUnixMenu.c:
	* unix/tkUnixFont.c:
	* generic/tkCanvText.c:
	* generic/tkEntry.c:
	* generic/tkFont.c:
	* generic/tkImgPPM.c: removed extranneous vars that were set but
	never used.
d1471 1
a1471 1
	* mac/tclMacHLEvents.c: fixed applescript for I18N [Bug: 3644]
d1473 2
a1474 3
	* unix/aclocal.m4: removed -O flag for AIX when using the IBM
	compiler (several versions have a bug that crops up in the text
	widget). [Bug: 2316]
d1476 2
a1477 2
	* unix/Makefile.in: removed extra slash in SCRIPT_INSTALL_DIR
	[Bug: 3896]
d1479 3
a1481 2
	* library/listbox.tcl: added extra checks for existence of
	tkPriv(listboxSelection) before it was used. [Bug: 3892]
d1483 1
a1483 1
1999-12-16  Jeff Hobbs  <hobbs@@scriptics.com>
d1485 74
a1558 4
	* doc/GetCursor.3:
	* win/tkWinCursor.c: added support for Windows cursors to
	TkGetCursorByName (.ani, .cur) using -cursor @@<filename>
	(Ascher) [Bug: 1350]
d1560 1
a1560 4
	* win/tkWinWm.c: fixed 'wm deiconify' to update position of the
	toplevel if event is waiting before mapping. (Mao) [Bug: 3687]
	This removes the need for 'update idle' before 'wm deiconify' on
	Windows.
d1562 3
a1564 1
	* doc/listbox.n: added doc for <<ListboxSelect>> [Bug: 3500]
d1566 1
a1566 124
	* doc/getOpenFile.n: removed note that -initialfile didn't work
	for tk_getOpenFile
	* library/tkfbox.tcl: updated tk_get*File to better match the
	Windows file box it emulates, give proper support to -initialfile,
	and fixes lack of global tkPriv call.  [Bug: 3735 3882]

	* doc/tk.n: added doc for 'tk useinputmethods ...'
	* tests/tk.test:
	* unix/tkUnixKey.c:
	* generic/tkCmds.c:
	* generic/tkEvent.c:
	* generic/tkWindow.c:
	* generic/tkInt.h: add 'tk useinputmethods ?-display win? ?bool?'
	call to provide support for disabling/enabling the use of XIM on
	X.  This was previously all done at compile time, and always on.
	Now it is turned off by default, even when available, and the user
	must turn it on to use XIM (per display).

	* generic/tkCanvUtil.c: fixed bug in Tk_CanvasPsOutline that freed
	mem it shouldn't.

	* generic/tkFont.c: added "bitstream cyberbit" (popular Windows
	CJK font) to list of font fallbacks. (kenny) [Bug: 2407]

	* mac/tkMacMenu.c: finished bug 3075 by changing the char values of
	what was checked (verified correctness on Mac).

1999-12-13  Jeff Hobbs  <hobbs@@scriptics.com>

	* doc/canvas.n: added docs for items added by dash patch (-*dash*,
	-state, -active*, -disabled*, -offset, essentially rewrote the
	man patch for completely updated 8.3 canvas widget.
	* doc/entry.n: added docs for entry widget validation
	* doc/event.n: added docs for -warp
	* doc/text.n: doc'ed new -state value 'hidden'
	* doc/GetDash.3: (new file) man page explaining Tk_GetDash
	* generic/tkStubInit.c:
	* generic/tkDecls.h:
	* generic/tkIntXlibDecls.h:
	* generic/tkInt.decls: added XSetDashes and XWarpPointer
	* generic/tk.decls: added Tk_CreateSmoothMethod, and reserved
	two spots
	* generic/tk.h: added Tk_SmoothMethod struct,
	state item to canvas record, #defines for item state,
	support for using old char*-based canvas item C creation
	procedures with -DUSE_OLD_CANVAS,
	Tk_Dash, Tk_TSOffset (-offsets) & Tk_Outline structs and #defs,
	decls for dash, outline and postscript routines
	* generic/tkBind.c: added support for Quadruple clicks, and added
	the -warp option to 'event' with pointer warping routines
	* xlib/xgc.c:
	* generic/tkRectOval.c:
	* generic/tkCanvArc.c:
	* generic/tkCanvBmap.c:
	* generic/tkCanvImg.c:
	* generic/tkCanvLine.c:
	* generic/tkCanvPoly.c:
	* generic/tkCanvPs.c:
	* generic/tkCanvText.c:
	* generic/tkCanvUtil.c:
	* generic/tkCanvWind.c:
	* generic/tkCanvas.c:
	* generic/tkCanvas.h: Canvas and items received overhaul to with
	the addition of the dash patch (Nijtmans, et al)  This includes
	objectification of the 'canvas' command, as well as support for
	(where appropriate) dashes in items, extended stipple support,
	state for all items, and postscript generation of images and
	windows.  See the new canvas man page for related docs.
	* generic/tkEntry.c: added entry widget validation, see entry.n
	* generic/tkEvent.c: on simulated events, ButtonPress should
	be matched with ButtonRelease to be correct
	* generic/tkFont.c: corrected possible null reference
	* generic/tkFrame.c: made frame a Tcl_Obj based command
	* generic/tkGet.c: added TkGetDoublePixels
	* generic/tkImage.c: bug fixes from Img patch and new
	Tk_PostscriptImage and Tk_SetTSOrigin functions
	* generic/tkImgBmap.c: new ImgBmapPostscript function
	* generic/tkImgPhoto.c: new Tk_CreatePhotoOption, Tk_DitherPhoto
	* generic/tkInt.h: declarations for some new functions
	* generic/tkMessage.c: reworked relief drawing
	* generic/tkOldConfig.c: added TK_CONFIG_OBJS so old style
	ConfigureWidget calls can pass in Tcl_Obj arrays
	* generic/tkScrollbar.c:
	* generic/tkScrollbar.h: made -orient use an option table
	* generic/tkText.c:
	* generic/tkText.h: made -wrap and -state use option tables
	* generic/tkTextBTree.c:
	* generic/tkTextDisp.c:
	* generic/tkTextImage.c:
	* generic/tkTextMark.c:
	* generic/tkTextTag.c:
	* generic/tkTextWind.c: added support for -elide and -state hidden
	* generic/tkTrig.c: changed TkMakeBezierCurve to support returning
	the upper limit of points needed for spline
	* generic/tkUtil.c: new option table parsing routines
	* generic/tkWindow.c: init'ing of warp stuff, mouseButtonState

	related bug ids for the fixes:
	[Bug: 648 1541 1540 1779 2168 2311 2297 2340 2348 2578 3386]

	* tests/bind.test:
	* tests/canvImg.test:
	* tests/canvPsArc.tcl:
	* tests/canvPsImg.tcl: (new file)
	* tests/canvRect.test:
	* tests/canvText.test:
	* tests/canvas.test:
	* tests/defs.tcl:
	* tests/entry.test:
	* tests/event.test:
	* tests/font.test:
	* tests/frame.test:
	* tests/imgPhoto.test:
	* tests/safe.test:
	* tests/scale.test:
	* tests/scrollbar.test:
	* tests/select.test:
	* tests/text.test:
	* tests/textDisp.test:
	* tests/textTag.test:
	* tests/unixFont.test:
	* tests/unixWm.test:
	* tests/visual_bb.test:
	* tests/winClipboard.test: tests for the dash patch changes
d1568 58
a1625 1
	* unix/mkLinks: added GetDash.3 into the mkLink step
d1627 1
a1627 5
	* mac/tkMacDraw.c: mac still needs pointer warping routine
	* mac/tkMacXStubs.c:
	* win/tkWinDraw.c:
	* win/tkWinPointer.c: added support for pointer warping and
	platform specific support for dash patch items
d1629 4
a1632 1
1999-12-12  Jeff Hobbs  <hobbs@@scriptics.com>
d1634 205
a1838 2
	* generic/tkText.c: fixed bug in TextSearchCmd for multibyte chars
	(Darley) [Bug: 3839]
d1840 1
a1840 2
	* unix/aclocal.m4: added warning when configuring with
	--enable-threads that Tk may have problems
d1842 15
a1856 1
1999-12-09  Jeff Hobbs  <hobbs@@scriptics.com>
d1858 139
a1996 1
	* generic/tkImgGIF.c: updated casting
d1998 1
a1998 1
	* win/makefile.vc: removed 16bit stuff, simplified makefile.
d2000 7
a2006 1
1999-12-06  Scott Redman  <redman@@scriptics.com>
d2008 1
a2008 2
	* generic/tkMain.c: need to include tclInt.h for new hook
	functions that are internal-use-only.
d2010 3
a2012 1
1999-12-06  Jeff Hobbs  <hobbs@@scriptics.com>
d2014 1
a2014 2
	* library/comdlg.tcl: removed tclVerifyInteger and tclSortNoCase,
	they weren't used, and were not actually correct
d2016 3
a2018 5
	* mac/tkMacFont.c:
	* mac/tkMacMenu.c:
	* mac/tkMacWindowMgr.c: fixed greyed out menu items, handling of
	... elipsis, font mapping problem, and enabled generated menu
	posting [Bug: 3705]
d2020 1
a2020 1
1999-12-02  Jeff Hobbs  <hobbs@@scriptics.com>
d2022 3
a2024 4
	* generic/tkInt.h:
	* generic/tkWindow.c:
	* generic/tkCmds.c: converted Tk_DestroyCmd, Tk_LowerCmd and
	Tk_RaiseCmd to their ObjCmd equivalent.
d2026 1
a2026 3
	* library/msgbox.tcl: added color icons for tk_messageBox on Unix
	and Mac when tk_strictMotif isn't set. (Hipp)
	* library/tk.tcl: added window bounds checking to ::tk::PlaceWindow
d2028 4
a2031 2
	* tests/imgPPM.test: fixed test 2.2 to use -format ppm (since
	we know have GIF write capability)
d2033 1
a2033 1
1999-12-01  Scott Redman <redman@@scriptics.com>
d2035 10
a2044 5
	* generic/tkMain.c :
	* unix/tkAppInit.c: 
	* win/winMain.c: Added added hooks into the main() code for
	supporting TclPro and other "big" shells more easily without
	requiring a copy of the main() code.
d2046 23
a2068 1
1999-11-29  Jeff Hobbs  <hobbs@@scriptics.com>
d2070 2
a2071 2
	* generic/tkImgGIF.c: added GIF writing that uses miGIF RLE
	[Bug: 2039, new patch]
d2073 1
a2073 1
	* library/entry.tcl: fixed up tkEntrySeeInsert (Nemthi)
d2075 66
a2140 2
	* generic/tkListbox.c: fixed 'get' of listbox to return a string
	when only one item is requested.
d2142 3
a2144 2
	* tests/clrpick.test:
	* tests/filebox.test: minor whitespace cleanup
d2146 1
a2146 1
	* library/tk.tcl: fixed missing $w in ::tk::PlaceWindow
d2148 4
a2151 1
1999-11-24  Jeff Hobbs  <hobbs@@scriptics.com>
d2153 1
a2153 7
	* library/clrpick.tcl:
	* library/msgbox.tcl:
	* library/tk.tcl:
	* library/tkfbox.tcl:
	* library/xmfbox.tcl: fixed dialogs to center over -parent,
	added utility functions ::tk::PlaceWindow, ::tk::SetFocusGrab,
	::tk::RestoreFocusGrab to tk.tcl to help
d2155 3
a2157 1
1999-11-23  Eric Melski  <ericm@@scriptics.com>
d2159 1
a2159 2
	* tests/listbox.test: Added a test to check that the topIndex is
	update when items are removed from the listvar variable.
d2161 2
a2162 2
	* generic/tkListbox.c: Added a check the updates the topIndex when
	items are removed from the listvar variable.
d2164 1
a2164 2
	* tests/listbox.test: Added a test to check that the vertical
	scrollbar is updated when the listvar changes.
d2166 4
a2169 3
	* generic/tkListbox.c (ListboxListVarProc): added a check that
	sets the UPDATE_V_SCROLLBAR flag if the length of the listvar has
	changed.
d2171 1
a2171 1
1999-11-23  Jeff Hobbs  <hobbs@@scriptics.com>
d2173 2
a2174 5
	* generic/tk.h:
	* generic/tkConfig.c: added support for TK_OPTION_DONT_SET_DEFAULT
	as equiv for TK_CONFIG_DONT_SET_DEFAULT
	* generic/tkListbox.c: added TK_OPTION_DONT_SET_DEFAULT to the
	item specs
d2176 1
a2176 1
1999-11-19  Jeff Hobbs  <hobbs@@scriptics.com>
d2178 13
a2190 3
	* generic/tkColor.c:
	* generic/tkColor.h: fixed Tk_NameOfColor to work correctly,
	with minor change to TkColor struct.
d2192 3
a2194 2
	* generic/tkConsole.c: added static declaration to
	ConsoleDeleteProc function (proto already had it)
d2196 1
a2196 6
	* win/tkWinInt.h: removed TkFontAttributes typedef (was
	redundant with tkFont.h).
	* win/tkWinPort.h: put #ifndef __GNUC__ around redefinition
	of str[n]casecmp, as cygwin uses the originals.
	* win/tkWinX.c: changed GetCurrentTime to GetTickCount (the
	former is deprecated).  [Bug: 2053]
d2198 2
a2199 1
1999-11-19  Eric Melski  <ericm@@scriptics.com>
d2201 2
a2202 1
	* tests/listbox.test: Added tests for itemcget and itemconfigure.
d2204 4
a2207 2
	* doc/listbox.n: Added documentation for -listvar option and for
	itemconfigure and itemcget commands.
d2209 1
a2209 2
	* generic/tkListbox.c: Added support for itemconfigure/itemcget
	listbox subcommands (addresses rfe #936)
d2211 2
a2212 1
1999-11-17  Eric Melski  <ericm@@scriptics.com>
d2214 4
a2217 1
	* tests/listbox.test: Updated tests for new error messages.
d2219 4
a2222 1
	* generic/tkListbox.c: Improved error messages for bad -listvar's.
d2224 1
a2224 1
	* tests/listbox.test: Added tests for bad -listvar's.
d2226 11
a2236 2
	* generic/tkListbox.c: Added handlers for bad -listvar's (ie, bad
	lists)
d2238 1
a2238 1
	* tests/listbox.test: Added tests for ListboxUpdateHScrollbar.
d2240 3
a2242 2
	* generic/tkListbox.c: Changed some old static buffers to base
	size on TCL_DOUBLLE_SPACE instead of (completely) hardcoding the size.
d2244 1
a2244 2
	* tests/listbox.test: New tests for -listvar functionality, and an
	odd extra case that wasn't covered before.
d2246 3
a2248 1
	* generic/tkListbox.c: Tests exposed some bugs, now fixed.
d2250 1
a2250 1
1999-11-16  Eric Melski  <ericm@@scriptics.com>
d2252 3
a2254 2
	* tests/listbox.test: Fixed tests to comply with new objectified
	error messages.  No -listvar specific tests yet.
d2256 1
a2256 3
	* win/tkWinDefault.h: 
	* unix/tkUnixDefault.h: 
	* mac/tkMacDefault.h: Added default value for -listvar option.
d2258 3
a2260 2
	* generic/tkWindow.c: Changed "listbox" mapping from old-school to
	new-school objectified command.
d2262 4
a2265 3
	* generic/tkListbox.c: Objectified listbox; added support for
	-listvar option.  Converted internal structure to use a Tcl list
	object to store the data.
d2267 1
a2267 2
	* generic/tkInt.h: Changed reference to Tk_ListboxCmd to
	Tk_ListboxObjCmd.
d2269 4
a2272 1
1999-11-09  Jeff Hobbs  <hobbs@@scriptics.com>
d2274 1
a2274 1
	* generic/tkGrid.c: changed Tcl_Alloc to ckalloc
d2276 4
a2279 2
	* generic/tkEntry.c: fixed C expr error in destroy of entry
	that could lead to 'malformed bucket chain' error
d2281 1
a2281 2
	* win/winMain.c: corrected winMain to not do a DebugBreak when
	returning an error message from the top level
d2283 4
a2286 1
1999-10-30  Jeff Hobbs  <hobbs@@scriptics.com>
d2288 3
a2290 2
	* win/tkWinKey.c: fixed XKeysymToKeycode to handle mapping of
	symbolic keysyms (Left, Home, ...) with event generate
d2292 1
a2292 5
	* library/entry.tcl: change tkEntrySeeInsert to avoid the use
	of a while loop that could eat CPU tremendously.  Behavior of
	moving the cursor at the right edge changes slightly (previously
	it tried to keep the cursor at the right edge, now it moves the
	cursor to a "central right" location - better IMHO).
d2294 3
a2296 1
1999-10-28  Jeff Hobbs  <hobbs@@scriptics.com>
d2298 1
a2298 17
	* doc/CrtImgType.3:
	* doc/CrtPhImgFmt.3:
	* doc/FindPhoto.3:
	* doc/photo.n:
	* generic/tk.h:
	* generic/tkCmds.c:
	* generic/tkImage.c:
	* generic/tkImgBmap.c:
	* generic/tkImgGIF.c:
	* generic/tkImgPPM.c:
	* generic/tkImgPhoto.c:
	* generic/tkInt.h:
	* generic/tkTest.c:
	* generic/tkWindow.c:
	* tests/imgPhoto.test: added Img patch (Nijtmans) with docs,
	headers #def'd with USE_OLD_IMAGE.  Upgrades image stuff to
	Tcl_Obj API, adds alpha channel (images are now 32 bpp)
d2300 9
a2308 1
	* makefile.vc: changed 'c:/program files' to c:/progra~1
d2310 1
a2310 1
1999-10-19  Jeff Hobbs  <hobbs@@scriptics.com>
d2312 2
a2313 3
	* library/scrlbar.tcl: changed tkScrollButtonUp to check for
	existence of tkPriv(relief) in order to avoid spurious release
	events
d2315 7
a2321 1
	* unix/Makefile.in: added ChangeLog to dist archive
d2323 1
a2323 1
1999-09-24  Jeff Hobbs  <hobbs@@scriptics.com>
d2325 2
a2326 5
	* */README:
	* win/makefile.vc:
	* */configure.in:
	* generic/tk.h:
	* library/tk.tcl: up'd to 8.3a1
d2328 4
a2331 1
	* unix/Makefile.in: changed 'mkdir' to 'mkdir -p'
d2333 1
a2333 2
	* library/dialog.tcl: changed {Times 18} to {Times 12} for
	dialog font.
d2335 2
a2336 1
1999-09-16  Jeff Hobbs  <hobbs@@scriptics.com>
d2338 1
a2338 2
	* generic/tkFont.c: fixed processing of font options and error
	returned [Bug: 2075]
d2340 72
a2411 3
	* win/tkWinWm.c: fixed bug in 'wm deiconify' that raised the
	wrong toplevel, and changed it to not set focus on overridden
	toplevels
d2413 1
a2413 1
1999-09-15  Jeff Hobbs  <hobbs@@scriptics.com>
d2415 2
a2416 7
	* unix/aclocal.m4: added fix for FreeBSD-[1-2] recognition [Bug: 2070]
	and fix to AIX-* to get ldAix right [Bug: 2624], fixed AIX
	version check (readjust from 8-21 fix) and several other config
	fixes for AIX
	* mac/tkMacMenubutton.c:
	* unix/tkUnixMenubu.c: fixed permanently stippled menubutton image
	* win/tkWinButton.c: fixed possible pointer smash [Bug: 2733]
d2418 1
a2418 1
1999-09-14  Jeff Hobbs  <hobbs@@scriptics.com>
d2420 131
a2550 1
	* win/tkWinMenu.c: fix for stack overrun in GetTextFace [Bug: 909]
d2552 1
a2552 1
1999-09-01  Jeff Hobbs  <hobbs@@scriptics.com>
d2554 4
a2557 28
	* win/tkWinDraw.c:
	* unix/tkUnixDraw.c: fixed header style for TkpDrawHighlightBorder
	* generic/tkCanvas.c: fixed GC error (bg <> fg) in tkCanvas.c
	(from code added to support TkpDrawHighlightBorder) [Bug: 2676]
	* unix/aclocal.m4: added -bnoentry to the AIX-* flags
	* library/msgbox.tcl: changed the behavior of tk_messageBox on
	Unix to be more Windows like in handling of <Return> and the
	default button
	* library/button.tcl:
	* library/clrpick.tcl:
	* library/comdlg.tcl:
	* library/console.tcl:
	* library/dialog.tcl:
	* library/entry.tcl:
	* library/focus.tcl:
	* library/listbox.tcl:
	* library/menu.tcl:
	* library/msgbox.tcl:
	* library/palette.tcl:
	* library/safetk.tcl:
	* library/scale.tcl:
	* library/scrlbar.tcl:
	* library/tearoff.tcl:
	* library/text.tcl:
	* library/tk.tcl:
	* library/tkfbox.tcl:
	* library/xmfbox.tcl: updated commands to use [string] ops
	instead of expr equality operators
d2559 1
a2559 1
1999-08-21  Jeff Hobbs  <hobbs@@scriptics.com>
d2561 1
a2561 2
	* unix/aclocal.m4: Changed AIX-4.[2-9] check to AIX-4.[1-9]
	[Bug: 1909]
d2563 6
a2568 1
1999-08-20  Jeff Hobbs  <hobbs@@scriptics.com>
d2570 1
a2570 2
	* generic/tkCursor.c: fixed bug in GetCursorFromObj that caused
	panic [Bug: 2562]
d2572 1
a2572 1
	* TK 8.2.0 RELEASED
d2574 1
a2574 1
1999-08-13  Jim Ingham  <jingham@@cygnus.com>
d2576 27
a2602 5
	* mac/tkMacMenu.c: Tk_DrawChars ends up setting the menu background
	wrong.	There is no clean way to stop it, so I use lower level routines
	here to draw the text.
	* mac/tkMacProjects.sea.hqx: Rearrange the projects so that the build 
	directory is separate from the sources.  Much more convenient! 
d2604 1
a2604 1
1999-08-10  Jeff Hobbs  <hobbs@@scriptics.com>
d2606 76
a2681 6
	* win/tkWinWm.c: changed "wm deiconify" on Windows to raise and
	force the focus on the deiconified window (behavioral change from
	8.1 to comply better with Windows style) [Bug: 1609]
	* doc/wm.n: clarified behavior of "wm deiconify".
	* generic/tkInt.decls: added TkSetFocusWin
	* generic/tkFocus.c: changed static SetFocus to TkSetFocusWin
d2683 1
a2683 4
	* library/clrpick.tcl:
	* library/console.tcl:
	* library/tk.tcl: fixed code where abbreviations where used
	in calling widget methods (confuses iWidgets) [Bug: 2422]
d2685 11
a2695 1
1999-08-09  Jeff Hobbs  <hobbs@@scriptics.com>
d2697 1
a2697 7
	* library/button.tcl: cleaned up programming (config -> configure)
	and fixed Windows relief bug [Bug: 664]
	* library/entry.tcl: changed Entry C/C/P to not use global data
	(now uses tkPriv(data)) [Bug: 1475]
	* library/listbox.tcl: fixed extended mode script error [Bug: 866]
	* doc/options.n: clarified that -troughcolor doesn't work on Windows
	* doc/wm.n: fixed wm positionfrom docs [Bug: 2284]
d2699 4
a2702 1
1999-08-01  Jeff Hobbs  <hobbs@@scriptics.com>
d2704 1
a2704 5
	* mac/tkMacPort.h: wrapped panic in #ifndef panic to avoid
	compiler errors when used with stubs-#defines, from Vince Darley.
	[Bug: 2389]
	
1999-07-31  Scott Redman  <redman@@scriptics.com>
d2706 1
a2706 2
	* xlib/X11/Xlib.h: Remove XFillRectangle since it is now in the
	stub tables.
d2708 4
a2711 1
1999-07-30  Jeff Hobbs  <hobbs@@scriptics.com>
d2713 1
a2713 1
	* generic/tkInt.decls: Added stub entry for XFillRectangle [Bug: 2446]
d2715 2
a2716 1
1999-07-30    <redman@@scriptics.com>
d2718 1
a2718 34
	* win/makefile.vc: Corrected building threaded tktest.exe on
	Windows.  Needed to link in .obj files from Tcl, needs to change
	later so that code is in Tk and doesn't require a Tcl build.
	Also added runtest target.

1999-07-29    <redman@@scriptics.com>

	* generic/tkConsole.c: Allow tcl to open CON and NUL, even for std
	channels.  Checking for bad/unusable std channels was moved to Tk
	since its only purpose was to check whether to use the Tk Console
	Window for the std channels.  [Bug: 2393 2392 2209 2458]

	* win/Makefile.in: Corrected building threaded tktest.exe on
	Windows.  Needed to link in .obj files from Tcl, needs to change
	later so that code is in Tk and doesn't require a Tcl build.

1999-07-22    <redman@@scriptics.com>

	* Changed version to 8.2b2

	* win/tkWinPort.h: Block out include of sys/stat.h in order to
	build extensions with MetroWerks compiler for Win32. [Bug: 2385]
	
	* unix/Makefile.in: Need to make install-sh executable before
	calling (with chmod +x).  [Bug: 2413]
	
	* library/menu.tcl: Applied patch from Jeff Hobbs to fix typo.
	[Bug: 2425]
	
1999-07-21    <redman@@scriptics.com>

	* unix/Makefile.in: Add Windows configure script to distribution.

1999-07-16    <redman@@scriptics.com>
d2720 2
d2723 3
a2725 2
	* win/Makefile.in:  Copy the prolog.ps from the generic directory
	for install-libraries.
d2727 1
a2727 2
	* unix/aclocal.m4: Check for Alpha/Linux to set the IEEE flag to
	the compiler to be -mieee.  Patch from Don Porter.
d2729 7
a2735 1
1999-07-08    <stanton@@scriptics.com>
d2737 1
a2737 1
	* tests/unixSelect.test: Fixed broken test.
d2739 5
a2743 2
	* win/makefile.vc: Added special case target to ensure that 
	tkStubLib.obj is built with -DSTATIC_BUILD.
d2745 5
a2749 4
	* win/tkWinX.c (TkWinChildProc): Changed to pass
	WM_WINDOWPOSCHANGED through to DefWindowProc to make OpenGL
	sub-windows happy.  This allows Windows to generate the WM_SIZE
	and WM_MOVE messages.
d2751 1
a2751 1
1999-07-08    <redman@@scriptics.com>
d2753 3
a2755 1
	* unix/configure.in: Fix Tk stub lib file names and flags.
d2757 2
a2758 1
1999-06-30    <redman@@scriptics.com>
d2760 2
a2761 2
	* generic/tkGrid.c: removed deprecated functions (applied patch
	from Jan Nijtmans). [Bug: 2080]
d2763 1
a2763 4
	* generic/tkImgGIF.c:
	* generic/tkImgPPM.c:
	* generic/tkImgPhoto.c: Applied patch to allow Img extension to
	work with 8.2, from Jan Nijtmans. [Bug: 2068]
d2765 3
a2767 5
	* win/tkWinWm.c: Applied patch from Don Porter to prevent the
	windows code from calling the Tcl functions when the stub table
	has not been initialized in TkWinWmCleanup.  [Bug: 2269]
	
1999-06-16    <wart@@scriptics.com>
d2769 1
a2769 4
	* unix/configure.in:
	* unix/Makefile.in:
	* unix/aclocal.m4: Numerous build changes to make Tk conform to
	the proposed TEA spec
d2771 2
a2772 3
	* tkConsole.c: changed some variable types from (int) to (size_t)
	to prevent compiler warnings.  Cast return value from strlen()
	to (int) in one place for the same reason.
d2774 1
a2774 1
1999-06-03    <stanton@@scriptics.com>
d2776 8
a2783 4
	* unix/tkUnixSelect.c: 
	* tests/unixSelect.test: 
	* generic/tkSelect.c: Fixed selection code to handle Unicode data
	in COMPOUND_TEXT and STRING selections. [Bug: 1791]
d2785 1
a2785 1
1999-06-02    <stanton@@scriptics.com>
d2787 3
a2789 3
	* generic/tkIntXlibDecls.h: 
	* xlib/X11/Xlib.h: Added Mac specific defines to help with
	compilation. 
d2791 1
a2791 1
	* generic/tkFont.c: lint
d2793 2
a2794 1
1999-06-01    <stanton@@scriptics.com>
d2796 1
a2796 4
	* unix/tkUnixSelect.c: Improved I18N selection support.
	COMPOUND_TEXT is converted to/from iso2022, and STRING is
	converted to/from iso8859-1.  There are still a few loose ends to
	tie up before this is completely done.
d2798 1
a2798 1
	* unix/tkUnixFont.c: Eliminated redundant case folding code.
d2800 1
a2800 2
	* generic/tkFont.c: Eliminated use of isupper/tolower in favor of
	Unicode variants.
d2802 3
a2804 1
1999-05-24    <stanton@@scriptics.com>
d2806 8
a2813 8
	* generic/tkStubLib.c: 
	* generic/tkStubInit.c:
	* generic/tkIntXlibDecls.h: 
	* generic/tkIntPlatDecls.h: 
	* generic/tkIntDecls.h: 
	* generic/tkInt.decls: 
	* generic/tkConsole.c: Various changes to try to get the Mac
	builds working.
d2815 1
a2815 1
1999-05-21    <stanton@@scriptics.com>
d2817 1
a2817 2
	* win/tkWinClipboard.c: Fixed clipboard code to handle lack of
	CF_LOCALE information (e.g. from command.com).
d2819 2
a2820 1
1999-05-20    <redman@@scriptics.com>
d2822 2
a2823 4
	* library/console.tcl: Changed copyright string to read 1999
	Scriptics Corp. in wish console about box.
	
1999-05-19    <redman@@scriptics.com>
d2825 1
a2825 3
	* generic/tk.h: Add extern "C" block around entire header file for
	C++ compilers to fix linkage issues.  Submitted by Don Porter and
	Paul Duffin.
d2827 3
a2829 1
1999-05-18    <stanton@@scriptics.com>
d2831 3
a2833 3
	* tests/winClipboard.test: 
	* win/tkWinClipboard.c: Fixed clipboard code so it handles Unicode
	data properly on Windows NT and 95. [Bug: 1791]
d2835 2
a2836 1
1999-05-07    <stanton@@scriptics.com>
d2838 1
a2838 2
	* library/menu.tcl: Fixed bug where tk_popup fails when called too
	quickly. [Bug: 2009]
d2840 4
a2843 1
1999-04-30    <stanton@@scriptics.com>
d2845 1
a2845 1
	* Changed version number to 8.1.1.
d2847 3
a2849 1
1999-04-30    <stanton@@scriptics.com>
d2851 1
a2851 17
	* Merged changes from 8.1.0 branch:

	* generic/tkDecls.h: 
	* generic/tkIntDecls.h: 
	* generic/tkIntPlatDecls.h: 
	* generic/tkIntXlibDecls.h: 
	* generic/tkPlatDecls.h: 
	* generic/tkStubInit.c: Changed to avoid the need for forward
	declarations in stub initializers.  Added extern "C" blocks around
	stub table pointer declarations so the stubs can be used from C++
	code. [Bug: 1934]

	* generic/tkInt.decls: Added TkClipBox, XDrawSegments, and
	XForceScreenSaver to stubs.

	* generic/tkStubLib.c: Reordered declarations to avoid
	circularities and forward references.
d2853 44
a2896 10
	* generic/tkStubInit.c: Added includes for Mac.

	* generic/tkMenubutton.c: lint

	* generic/tkEntry.c: Fixed bad option table entry.

	* generic/tkImgBmap.c:
	* generic/tkImgPPM.c:
	* generic/tkImgPhoto.c: Set the -translation and -encoding options
	to binary for image files. (reported by Marco Gazzetta)
d2898 1
a2898 1
1999-04-23    <stanton@@scriptics.com>
d2900 2
a2901 2
	* generic/tkInt.decls: Added TkClipBox, XDrawSegments, and
	XForceScreenSaver to stubs.
d2903 1
a2903 2
	* generic/tkStubLib.c: Reordered declarations to avoid
	circularities and forward references.
d2905 5
a2909 1
	* generic/tkStubInit.c: Added includes for Mac.
d2911 1
a2911 1
	* generic/tkMenubutton.c: lint
d2913 12
a2924 1
	* generic/tkEntry.c: Fixed bad option table entry.
d2926 1
a2926 1
1999-04-22    <redman@@scriptics.com>
d2928 2
a2929 4
	* generic/tkImgBmap.c:
	* generic/tkImgPPM.c:
	* generic/tkImgPhoto.c: Set the -translation and -encoding options
	to binary for image files. (reported by Marco Gazzetta)
d2931 3
a2933 1
1999-04-20    <redman@@scriptics.com>
d2935 12
a2946 3
	* xlib/X11/Xlib.h: changed definition of Status type to use a
	typedef instead of a #define to avoid conflicting with the cygwin
	win32 headers [Bug 1804]
d2948 1
a2948 1
1999-04-15    <stanton@@scriptics.com>
d2950 13
a2962 1
	* Merged 8.1 branch into the main trunk
d2964 1
a2964 1
1999-04-09    <redman@@scriptics.com>
d2966 27
a2992 3
	* generic/tkWindow.c: Fixed deadlock situation when the Initialize()
	function returns without releasing the mutex.  Found while testing
	Bug 1700, during safe.test (tk).
d2994 1
a2994 1
1999-04-06    <stanton@@scriptics.com>
d2996 4
a2999 7
	* generic/tkMain.c (Tk_MainEx): Changed to reset result before
	calling Tcl_EvalFile.  The ensures that error messages will be
	generated cleanly.

	* tests/winfo.test: Enabled tests that previously failed.

1999-04-05    <stanton@@scriptics.com>
d3001 5
a3005 17
	* library/bgerror.tcl:
	* library/button.tcl:
	* library/clrpick.tcl:
	* library/console.tcl:
	* library/dialog.tcl:
	* library/entry.tcl:
	* library/focus.tcl:
	* library/listbox.tcl:
	* library/menu.tcl:
	* library/msgbox.tcl:
	* library/palette.tcl:
	* library/scale.tcl:
	* library/scrlbar.tcl:
	* library/tearoff.tcl:
	* library/text.tcl:
	* library/tk.tcl: Lots of minor performance improvements
	contributed by Jeffrey Hobbs. [Bug: 1118]
d3007 1
a3007 2
	* win/tkWinWm.c (Tk_WmCmd): Fixed bad code in tracing
	suboption. [Bug: 1519]
d3009 2
a3010 3
	* library/tkfbox.tcl: Change to restore button text after an
	action to avoid the sticky "Open" button in a save dialog.
	[Bug: 1640]
d3012 1
a3012 35
	* library/entry.tcl: Fixed so selection is returned using the
	-show character during cut and paste operations. [Bug: 1687]
	
1999-04-5     <redman@@scriptics.com>

	* generic/tkInt.decls:
	* generic/tkIntXlibDecls.h:
	* generic/tkStubInit.c:
	* xlib/xgc.c:
	* xlib/X11/Xlib.h:
	* xlib/X11/Xutil.h: Added more X functions to the Win & Mac stubs
	tables.
	
1999-04-05    <stanton@@scriptics.com>

	* unix/configure.in:
	* generic/tkCanvPs.c: Added configure test for pw_gecos field in
	pwd to support OS/390. [Bug: 1724]

1999-04-02    <stanton@@scriptics.com>

	* tests/text.test: 
	* generic/tkText.c: Fixed handling of Unicode in text searches.
	The -count option was returning byte counts instead of character
	counts. [Bug: 1056, 1148, 1666]

1999-04-01    <redman@@scriptics.com>

	* generic/tk.decls:
	* generic/tk.h:
	* generic/tkStubInit.c:
	* generic/tkWindow.c:
	* unix/Makefile.in:
	* win/makefile.vc: Tk now uses its own stub library to store
	pointers to its own stubs table.
d3014 5
a3018 65
	* doc/dde.n: (removed)
	* doc/send.n:
	* generic/tk.decls:
	* tests/winSend.test:
	* generic/tkPlatDecls.h:
	* win/tkWinSend.c:  Removed the DDE-based send and dde commands,
	they were causing Tk to lock up when any window on the system was
	not processing its message queue (more importantly, windows in Tcl
	and Tk).  The send command needs to be rewritten to prevent the
	deadlock situation (soon).  The dde command is being pushed into
	its own package and will provide almost all of the capabilities
	that send did before (using a "dde eval" command), not yet
	completed.

1999-03-31    <redman@@scriptics.com>

	* win/tkWinSend.c: Modified dde/send code to work properly on
	Win95/Win98. String lengths are not returned properly by DDE, so
	NULL terminate all strings going in and ignore the string length
	coming back out.  Do not destroy handles until all necessary work
	on those handles (and child handles) is done.

1999-03-30    <stanton@@scriptics.com>

	* generic/tkWindow.c (Tk_DestroyWindow): Image handlers are now
	finalized before the font subsystem since complex image handlers
	may contain references to fonts (e.g. Tix compound images).
	[Bug: 1603]

1999-03-29    <stanton@@scriptics.com>

	* doc/MeasureChar.3: 
	* doc/TextLayout.3: 
	* generic/tk.decls: 
	* generic/tkCanvText.c: 
	* generic/tkEntry.c:
	* generic/tkFont.c: 
	* generic/tkListbox.c: 
	* generic/tkMessage.c: 
	* mac/tkMacFont.c: 
	* unix/tkUnixButton.c: 
	* unix/tkUnixFont.c: 
	* unix/tkUnixMenu.c: 
	* win/tkWinFont.c: 
	* win/tkWinMenu.c: Standardized text layout and font interfaces
	so they are consistent with respect to byte versus character
	oriented indices.  The layout functions all manipulate character
	oriented values while the lower level measurement functions all
	operate on byte oriented values.  This distinction was not clear
	and so the functions were being used improperly in a number of
	places.  [Bug: 1053, 747, 749, 1646]

	* generic/tk.decls: Eliminated uses of C++ STL types string and
	list from declarations.

	* generic/tkFont.c: Changes to named fonts were not being
	propagated in some cases. [Bug: 1144]
	
	* xlib/X11/Xlib.h:
	* generic/tkInt.decls: Added XParseColor to xlib stub
	tables. [Bug: 1574] 

	* doc/GetBitmap.3: 
	* generic/tkBitmap.c (BitmapInit): Eliminated use of Tk_Uid's in
	bitmaps.  Added a few CONST declarations.
d3020 1
a3020 1
1999-03-29    <redman@@scriptics.com>
d3022 1
a3022 2
	* unix/configure.in:
	* unix/Makefile.in:
d3024 25
a3048 18
	* generic/tkDecls.h:
	* generic/tkIntDecls.h:
	* generic/tkIntPlatDecls.h:
	* generic/tkPlatDecls.h:
	* generic/tkIntXlibDecls.h: Removed stub functions. Always use the
	Tcl stubs when building with --enable-shared.
	

1999-03-26    <redman@@scriptics.com>

	* generic/tkTextIndex.c:
	* tests/testIndex.test: Avoid looking past the beginning of the
	array storing data for the text widget (.t index end-2c).  Added
	test case to check for the bug.  [Bug 991]
	
	* generic/tkConsole.c: Copy static strings into a Tcl_DString
	before passing to Tcl_Eval, in case the compiler puts static
	strings into read-only memory.
d3050 1
a3050 6
1999-03-26    <suresh@@scriptics.com>
	
	* unix/configure.in:
	--nameble-shared is now the default and builds Tk as a shared
	library; specify --disable-shared to build a static Tk library
	and shell.
d3052 5
a3056 1
1999-03-26    <surles@@scriptics.com>
d3058 1
a3058 3
	* library/menu.tcl: Fixed bug reported by Bryan Oakley in the
	menubutton bindings.  There was a false assumption that there was
	always a menu attached to the button.  [Bug 1116] 
d3060 1
a3060 1
1999-03-26    <redman@@scriptics.com>
d3062 1
a3062 4
	* unix/configure.in: Removed --enable-tcl-stub.  Linking Tk to Tcl
 	stubs is causing too many problems when linking executables like wish.
  	Until the Tk is a fully loadable extension, linking against the Tcl
 	stubs is not supported in Tk.
d3064 2
a3065 1
1999-03-19    <redman@@scriptics.com>
d3067 2
a3068 9
	* generic/tkBitmap.c:
	* generic/tkCursor.c:
	* generic/tkGC.c: When creating hash tables that key off of XID
 	handles, make sure to pass TCL_ONE_WORD_KEYS.  XIDs are guaranteed
 	to be 32bit numbers, although on some 64bit systems (including 64bit
 	Solaris 7) they are packed into a 64bit value where the upper 32bits
 	are zero. The normal method of sizeof(XID)/sizeof(int) causes the
 	hash table code to assume that the XID is a pointer to an array of 
	two ints, which it is not.  Tk now supports 64bit Solaris 7.
d3070 124
a3193 1
1999-03-17    <stanton@@scriptics.com>
d3195 2
a3196 3
	* win/makefile.vc: 
	* generic/tk.h: Changed to use TCL_BETA_RELEASE macro, and fixed
	so this works in rc files.
d3198 1
a3198 6
	* win/makefile.vc: 
	* win/makefile.bc: 
	* win/README: 
	* unix/configure.in: 
	* generic/tk.h: 
	* README: Updated version to 8.1b3.
d3200 92
a3291 1
1999-03-14    <stanton@@GASPODE>
d3293 1
a3293 1
	* unix/configure.in: Added missing stub related definitions.
d3295 2
a3296 1
	* unix/Makefile.in: Install tkDecls.h in addition to tk.h.
d3298 1
a3298 2
	* generic/tkStubLib.c: Added flags to ensure we are using Tcl
	stub macros.
d3300 3
a3302 1
1999-03-11    <stanton@@GASPODE>
d3304 1
a3304 2
	* generic/tkInt.decls: Added reserved slot for XSetDashes for use
	by the dash patch.
d3306 2
a3307 1
1999-03-10    <redman@@scriptics.com>
d3309 1
a3309 149
	* xlib/xdraw.c:
	* xlib/X11/Xlib.h:
	* mac/tkMac.h:
	* mac/tkMacInt.h:
	* mac/tkMacPort.h:
	* mac/tkMacXStubs.c:
	* mac/tkMacAppInit.c:
	* mac/tkMacCursor.c:
	* win/makefile.vc:
	* win/tkWin.h:
	* win/tkWinInt.h:
	* win/tkWinPort.h:
	* win/winMain.c:
	* generic/tk.h:
	* generic/tkInt.h:
	* generic/tk.decls:
	* generic/tkInt.decls:
	* generic/tkDecls.h:
	* generic/tkPlatDecls.h:
	* generic/tkIntDecls.h:
	* generic/tkIntPlatDecls.h:
	* generic/tkIntXlibDecls.h:
	* generic/tkStubs.c:
	* generic/tkPlatStubs.c:
	* generic/tkIntStubs.c:
	* generic/tkIntPlatStubs.c:
	* generic/tkIntXlibStubs.c:
	* generic/tkStubInit.c:
	* generic/tkStubLib.c:
	* generic/tkBind.c:
	* generic/tkCmds.c:
	* generic/tkConfig.c:
	* generic/tkConsole.c: 
	* generic/tkCursor.c:
	* generic/tkGrab.c:
	* generic/tkImgPhoto.c:
	* generic/tkMain.c:
	* generic/tkMenu.c:
	* generic/tkPointer.c:
	* generic/tkTextDisp.c:
	* generic/tkWindow.c:
	* unix/tkUnixInt.h:
	* unix/tkUnixPort.h:
	* unix/Makefile.in:
	* unix/configure.in:
	* unix/tkConfig.sh.in:
	* unix/tkUnix.c:
	* unix/tkUnix3d.c:
	* unix/tkUnixDraw.c:
	* unix/tkUnixFont.c:
	* unix/tkUnixMenubu.c: Stubs implementation for 8.1.  Tk_Main() is
	replaced with a macro which calls Tk_MainEx(). Tk can link to the Tcl
	stubs library, wish links directly to Tcl and Tk. Use
	--enable-tcl-stubs to link Tk to the Tcl stubs library (Unix), on
	by default on Windows. Exported all public functions through the
	stubs mechanism (see the *.decls files) and many of the internal
	functions. Most of the changes dealt with shifting around the
	function declarations in the header files.  Mac code may not
	compile, but it shouldn't take much work to fix this.
	
	* mac/tkMacMenu.c: Added dummy TkpMenuThreadInit for Mac to be
	consistent with Unix and Windows versions.
	
1999-03-08    <lfb@@scriptics.com>

	* win/tkWinWm.c: Toplevel class no longer shared between 
	threads.
	
	* win/tkWinX.c: Multiple threads no longer share the same
	TkDisplay structure.  Required because TkDisplay stores much
	thread-specific data for a given thread.

	* win/tkWinSend.c: Moved application instance handle out
	out thread-local storage.  DDE was failing to initialize
	when the instance handles were different between threads.
	
	* win/makefile.vc: Added THREADDEFINES for building with
	threads enabled.
	
	* generic/tkMenu.c:
	* win/tkWinMenu.c:
	* unix/tkUnixMenu.c: Added TkpMenuThreadInit for initializing
	thread-specific Menu state.

1999-03-01    <redman@@scriptics.com>

	* win/tkWinWm.c: 
	* win/tkWinPointer.c:
	* win/tkWinInt.h: Fix "focus -force" for Windows.  The Win32 API
	function SetForegroundWindow() does not work unless the window
	handle is a toplevel window (a Windows toplevel).  The handle
	being passed was a Tk toplevel, which is a child of the Windows
	toplevel.

1999-02-26    <redman@@scriptics.com>

	* win/cat.c: Remove this file, use the one in the Tcl source directory.

	* win/makefile.vc: Remove the wishc.exe from the default targets.  Add
	a separate console-wish target to build it.  The need for a 
	console-wish will go away soon, so we don't want to encourage its
	use.

1999-02-25    <redman@@scriptics.com>

	* win/tkWinWm.c: Properly initialize the tsdPtr->firstWindow field.
	
	* win/cat.c: Code for cat32.exe, copied from the Tcl sources. Required
	in order to run the test suite from the makefile

	* win/winMain.c: Add main() for a console-based wishc.exe, which meant
	adding code to disable the call to Tk_ConsoleInit().
	
	* generic/tkConsole.c: Check the standard handles before creating the
	new standard channels.	This allows a windows app that has stdin,
	stdout, or stderr to correctly connect to them.
	
	* generic/tkMain.c: Add a proper check for the interactive mode, since
	the standard channels may actually be connected in windows mode or
	even in the console-based wish.
	
	* win/makefile.vc: Add targets for wishc.exe (console-based wish) and
	cat32.exe (for testing). Fix the test suite target so it can be run
	from the makefile (which can happen since the standard handles have
	been fixed).

1999-02-12    <lfb@@scriptics.com>

	* generic/tkMenuButton.h:
	* generic/tkMenuButton.c:
	* mac/tkMacMenubutton.c:
	* mac/tkMacDefault.h
	* unix/tkUnixMenubu.c: Eliminated Tk_Uids used by -state option.
	* unix/tkUnixDefault.h
	* win/tkWinDefault.h
	

	* generic/tk.h:
	* generic/tkScale.h:
	* generic/tkScale.c:
	* generic/tkWindow.c:
	* unix/tkUnixScale.c:	
	* unix/tkUnixDefault.h:
	* unix/tkWinDefault.h:
	* mac/tkMacDefault.h:  Objectified scale widget.

	* win/tkWinX.c: Removed Thread-specific data from process
	initialization code that was stopping the Tk Dll from 
	loading.
d3311 2
a3312 1
1999-02-11    <stanton@@GASPODE>
d3314 1
a3314 10
	* README:
	* generic/tk.h: 
	* unix/configure.in:
	* win/README:
	* win/makefile.bc:
	* win/makefile.vc: Updated version to 8.1b2.
	
	* unix/tkUnixSend.c: Fixed one more Tcl_*ObjVar instance.
	
1999-02-04    <stanton@@GASPODE>
d3316 11
a3326 7
	* Various cleanup related to the Tcl_Eval and Tcl_ObjSetVar
	changes in Tcl.
	
	INTEGRATED PATCHES FROM 8.0.5b2: 
	
	* win/tkWinMenu.c (TkpDestroyMenu): Changed so modalMenuPtr is
	cleared when it is being destroyed.
d3328 1
a3328 3
	* generic/tkImgPhoto.c: Changed so color tables are freed
	immediately instead of being delayed.  This ensures that color
	tables are properly disposed at process exit.
d3330 3
a3332 2
	* library/prolog.ps: Changed string that determines font height to
	include European character with an umlaut.
d3334 1
a3334 3
	* generic/tkImgBmap.c (ImgBmapConfigureInstance): If an image
	mask changed but ended up with the same XID, the GC failed to be
	updated and so the new mask was not used. [Bug: 970]
d3336 3
a3338 3
	* generic/tkFocus.c (SetFocus): Changed so focus window is always
	set if -force is specified.  This fixes the problem on Windows
	where Tk does not activate the window if it already has focus.
d3340 1
a3340 2
	* generic/tkConsole.c: Fixed so errors in console eval are
	reported properly.  Eliminated duplicate result messages. [Bug: 973]
d3342 62
a3403 2
	* win/tkWinWm.c: Changed so windows that aren't resizable don't
	have resize handles and the zoom box is disabled.
d3405 3
a3407 3
	* win/tkWinInt.h:
	* win/tkWinPointer.c: Changed to cancel the mouse timer when a
	user initiated move/resize loop begins.
d3409 1
a3409 4
	* unix/configure.in: TK_LD_SEARCH_FLAGS was set incorrectly if
	SHLIB_LD_LIBS='${LIBS}', and shared linking is performed through
	the C compiler. Systems affected are Linux, MP-RAS and NEXTSTEP,
	but also with gcc on many more systems. [Bug: 908]
d3411 2
a3412 5
	* win/makefile.vc: First stab at install target.  Fixed quoting so
	paths with spaces work.
	
	* tests/main.test:
	* tests/unixWm.test: Better cleanup of temporary files.
d3414 280
a3693 7
	* mac/tkMacAppInit.c:
	* generic/tkTest.c:
	* generic/tkAppInit.c:
	* win/winMain.c: Changed some EXTERN declarations to extern
	since they are not defining exported interfaces.  This avoids
	generating useless declspec() attributes and makes the windows
	makefile simpler.
d3695 1
a3695 4
	* library/menu.tcl (tkMenuFind): Changed so keyboard shortcuts
	will only be found in the current toplevel.  Previously, they
	might be found in menus attached to other toplevels that might not
	even be mapped. [Bug: 924]
d3697 190
a3886 2
	* generic/tkCanvLine.c: Changed to treat zero width lines like
	they have width 1 for purposes of selection. [Bug: 925]
d3888 1
a3888 2
	* win/tkWinFont.c (Tk_MeasureChars): Added a workaround for a bug
	in GetTextExtentExPoint on Win NT 4.0/Japanese. [Bug: 1006]
d3890 5
a3894 2
	* unix/tkUnixSend.c (Tk_SetAppName): Fixed uninitialized memory
	access bug. [Bug: 919]
d3896 1
a3896 1
1999-1-28    <stanton@@GASPODE>
d3898 12
a3909 2
	* generic/tkGrid.c: Fixed bug in "grid forget" that failed to cancel
	pending idle handlers, resulting in a crash in a few odd cases.
d3911 1
a3911 84
1999-01-06  <lfb@@JUSTICE>

	* generic/tk.h, generic/tkGet.c, generic/tkConfig.c, 
	* generic/tkOldConfig.c, generic/tkEntry.c, generic/tkMenubutton.c, 
	* generic/tkMenubutton.h, generic/tkScale.c, generic/tkScale.h, 
	* generic/tkTextDisplay.c, generic/tkText.c, unix/tkUnixMenubu.c, 
	* unix/tkUnixScale.c, mac/tkMacMenu.c, mac/tkMacMenubutton.c, 
	
	Removed global Tk_Uids dealing with "-state" configuration option
	and added new TK_CONFIG_STATE configSpec that doesn't use 
	Tk_Uids.

1998-12-11    === Tk 8.1b1 Release ===
	
1998-12-11    <stanton@@GASPODE>

	* generic/tkMain.c (Tk_Main): Fixed improper command line encoding
	handling. 

1998-12-08    <stanton@@GASPODE>

	* win/tkWinClipboard.c (TkSelGetSelection, TkWinClipboardRender):
	Changed to handle multibyte characters properly. [Bug: 935]

1998-12-07    <stanton@@GASPODE>

	* library/xmfbox.tcl (tkMotifFDialog_Create): In the cached case,
	the data array was not being initialized with the correct set of
	widgets.

1998-12-4    <welch@@SAGE>

	* Changed patchLevel to 8.1b1

	* generic/tkMenu.c (ConfigureMenuCloneEntries): The -menu configuration
	option was being incorrectly specified as just "menu". 

1998-11-30    <stanton@@GASPODE>

	* generic/tkButton.c (ConfigureButton): The error result was
	getting lost when restoring configuration options. [Bug: 619]

1998-11-25    <stanton@@GASPODE>

	* unix/tkUnixFont.c (GetFontAttributes): Initialize an unspecified
	family to an empty string.
	(FontMapLoadPage): if the font included characters below 32, the
	index computation was incorrect because the range was shifted up
	to 32.
	(CreateClosestFont): check for empty locale as well as NULL.

	* generic/tkFont.c (TkFontParseXLFD): initialize charset to
	iso8859-1 if no charset is specified.

	* mac/tkMacHLEvents.c (OdocHandler): added conversion from
	external string to UTF [Bug: 869]

	* integrated tk8.0.4 changes.
	
	* generic/tkBind.c: fixed deletion order bug where a crash would
	result if a binding deleted "."

	* generic/tkMenu.c (MenuWidgetObjCmd): disabled menu entries were
	getting reenabled whenever the mouse passed over the entry [Bug: 860]

	* unix/tkUnixMenu.c (TkpComputeStandardMenuGeometry): hidemargin
	option was not honored properly in menus [Bug: 859]

1998-11-24    <stanton@@GASPODE>

	* tkMacMenu.c, tkUnixMenu.c, tkWinMenu.c, tkMenuDraw.c, tkMenu.h,
	* tkMenu.c: Backed out the previous fix for bug 620 and
	eliminated a bunch of code that created unnecessary objects.
	Changed back to using internal types instead of objects for many
	configuration options.	There are many more fixes like this that
	could be made, but some require a little restructuring of the
	code. In any case the leaks are fixed and there is a lot less
	allocation happening. [Bug: 620]

1998-11-19    <stanton@@GASPODE>

	* tkMenu.c (DestroyMenuEntry): fixed memory leaks [Bug: 620]
	
	* tkWinX.c (GetTranslatedKey): fixed bad code merge
d3913 161
a4073 2
	* tkWinWm.c, tkWinMenu.c: fixed titles and menus so they properly
	display Unicode [Bug: 819]
@


1.1.1.8
log
@one more time: import tcl 8.4.0
@
text
@d3 1
a3 1
	* unix/Makefile.in: added DYLIB_INSTALL_DIR variable for macosx
d9 1
a9 1
	* macosx/Tcl.pbproj/project.pbxproj:
d19 1
a19 1
2002-09-06  Don Porter  <dgp@@users.sourceforge.net>
d21 2
a22 2
	* doc/file.n:  Format correction, and clarified [file normalize]
	returns an absolute path.
d24 36
a59 1
	* doc/tcltest.n:  Added examples section, as long promised.
d61 5300
a5360 1
2002-09-06  Reinhard Max  <max@@suse.de>
d5362 1
a5362 1
	* tests/tcltest.test: Added nonRoot flag to tests 8.3, 8.4, and 8.12.
d5364 1
a5364 1
2002-09-05  Don Porter  <dgp@@users.sourceforge.net>
d5366 112
a5477 1
	* doc/tcltest.n:  Clarified phrasing.
d5479 1
a5479 4
	* generic/tclBasic.c (TclRenameCommand,CallCommandTraces):
	* tests/trace.test (trace-27.1): Corrected memory leak when a rename
	trace deleted the command being traced.  Test added.  Thanks to
	Hemang Lavana for the fix.  [Bug 604609]
d5481 3
a5483 2
	* generic/tclVar.c (TclDeleteVars):  Corrected logic for setting the
	TCL_INTERP_DESTROYED flag when calling variable traces. [Tk Bug 605121]
d5485 2
a5486 1
2002-09-04  Miguel Sofer  <msofer@@users.sourceforge.net>
d5488 3
a5490 2
	* generic/tclVar.c (DeleteArray): leak plug [Bug 604239]. Thanks
	to dkf and dgp for the long and difficult discussion in the chat.
d5492 27
a5518 1
2002-09-03  Jeff Hobbs  <jeffh@@ActiveState.com>
d5520 7
a5526 1
	* generic/tclVar.c (Tcl_UpVar2): code cleanup to not use goto
d5528 3
a5530 2
	* unix/configure: remove -pthread from LIBS on FreeBSD in thread
	* unix/tcl.m4:    enabled build. [Bug #602849]
d5532 2
a5533 1
2002-09-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d5535 1
a5535 4
	* generic/tclInterp.c (AliasCreate): a Tcl_Obj was leaked on error
	return from TclPreventAliasLoop.
	
2002-09-03  Daniel Steffen  <das@@users.sourceforge.net>
d5537 2
a5538 2
	* macosx/Tcl.pbproj/project.pbxproj: Bumped version number to
	8.4.0 and updated copyright info.
d5540 1
a5540 1
2002-09-03  Miguel Sofer  <msofer@@users.sourceforge.net>
d5542 1
a5542 2
	* generic/tclVar.c (Tcl_UpVar2): a Tcl_Obj was being leaked on
	error return from TclGetFrame.
d5544 3
a5546 1
2002-09-03  Don Porter  <dgp@@users.sourceforge.net>
d5548 1
a5548 1
	* changes:  Updated changes for 8.4.0 release.
d5550 6
a5555 1
2002-09-02  Jeff Hobbs  <jeffh@@ActiveState.com>
d5557 1
a5557 2
	* unix/tclUnixFile.c (TclpObjLink): removed unnecessary/unfreed
	extra native char*.
d5559 2
a5560 2
	* unix/tclUnixChan.c (Tcl_MakeTcpClientChannel): make sure to init
	flags field of TcpState ptr to 0.
d5562 1
a5562 3
	* unix/configure:
	* unix/tcl.m4: added 64-bit gcc compilation support on HP-11.
	[Patch #601051] (martin)
d5564 2
a5565 9
	* README:		Bumped version number to 8.4.0
	* generic/tcl.h:
	* tools/tcl.wse.in:
	* unix/configure:
	* unix/configure.in:
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure:
	* win/configure.in:
d5567 1
a5567 7
	* generic/tclInterp.c (SlaveCreate): make sure that the memory and
	checkmem commands are initialized in non-safe slave interpreters
	when TCL_MEM_DEBUG is used. [Bug #583445]

	* win/tclWinConsole.c (ConsoleCloseProc): only wait on writable
	pipe if there was something to write.  This may prevent infinite
	wait on exit.
d5569 3
a5571 2
	* tests/exec.test: marked exec-18.1 unixOnly until the Windows
	incompatability (in the test, not the core) can be resolved.
d5573 1
a5573 2
	* tests/http.test (http-3.11): added close $fp that was causing an
	error on Windows because the file was not closed before deleting.
d5575 2
a5576 2
	* unix/tclUnixInit.c (Tcl_MacOSXGetLibraryPath): made this static
	function only appear when HAVE_CFBUNDLE is defined.
d5578 1
a5578 1
2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>
d5580 5
a5584 2
	* unix/tcl.m4: added TK_SHLIB_LD_EXTRAS analogue of existing
	TCL_SHLIB_LD_EXTRAS for linker settings only used when linking Tk.
d5586 1
a5586 1
	* unix/configure: regen
d5588 7
a5594 1
2002-08-31  Daniel Steffen  <das@@users.sourceforge.net>
d5596 2
a5597 1
	*** macosx-8-4-branch merged into the mainline [tcl patch #602770] ***
d5599 2
a5600 1
	* generic/tcl.decls: added new macosx specific entry to stubs table.
d5602 1
a5602 25
	* tools/genStubs.tcl: added generation of platform guards for
	macosx. This is a little more complex than it seems, because MacOS
	X IS "unix" plus a little bit, for the purposes of Tcl. BUT
	unfortunately, Tk uses "unix" to mean X11. So added platform keys
	for macosx (the little added to "unix"), "aqua" and "x11" to
	distinguish these for Tk.
	
	* generic/tcl.h: added a #ifnded RESOURCE_INCLUDED so that tcl.h
	can be passed to the resource compiler.
	
	* generic/tcl.h:
	* generic/tclNotify.c: added a few Notifier procs, to be able to
	modify more bits of the Tcl notifier dynamically. Required to get
	Mac OS X Tk to live on top of the Tcl Unix threaded notifier.
	Changes the size of the Tcl_NotifierProcs structure, but doesn't
	move any elements around.

	* unix/tclUnixNotfy.c: moved the call to Tcl_ConditionNotify till
	AFTER we are done mucking with the pointer swap. Fixes cases where
	the thread waiting on the condition wakes & accesses the
	waitingListPtr before it gets reset, causing a hang.

	* library/auto.tcl (tcl_findLibrary): added checking the
	directories in the tcl_pkgPath for library files on macosx to
	enable support of the standard Mac OSX library locations
d5604 4
a5607 11
	* unix/Makefile.in:
	* unix/configure.in:
	* unix/tcl.m4: added MAC_OSX_DIR.  Added PLAT_OBJS to the OBJS:
	there are some MacOS X specific files now for Tcl, and when I get
	he resource & applescript stuff ported over, and restore support
	for FindFiles, etc, there will be a few more.
	Added LD_LIBRARY_PATH_VAR configure variable to avoid having to set
	all possible LD_LIBRARY_PATH analogues on all platforms.
	LD_LIBRARY_PATH_VAR is "LD_LIBRARY_PATH" by default, "LIBPATH" on
	AIX, "SHLIB_PATH" on HPUX and "DYLD_LIBRARY_PATH" on Mac OSX.
	Added configure option to package Tcl as a framework on Mac OSX.
d5609 2
a5610 2
	* macosx/tclMacOSXBundle.c (new): support for finding Tcl extension
	packaged as 'bundles' in the standard Mac OSX library locations.
d5612 2
a5613 2
	* unix/tclUnixInit.c: added support for findig the tcl script
	library inside Tcl packaged as a framework on Mac OSX.
d5615 2
a5616 3
	* macosx/Tcl.pbproj/jingham.pbxuser (new):
	* macosx/Tcl.pbproj/project.pbxproj (new): project for Apple's
	ProjectBuilder IDE.
d5618 3
a5620 2
	* macosx/Makefile (new): simple makefile for building the project
	from the command line via the ProjectBuilder tool 'pbxbuild'.
d5622 4
a5625 3
	* unix/configure:
	* generic/tclStubInit.c:
	* generic/tclPlatDecls.h: regen
d5627 9
a5635 1
2002-08-29  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5637 1
a5637 3
	* win/tclWinThrd.c (TclpFinalizeThreadData, TclWinFreeAllocCache):
	  Applied patch for bug #599428, provided by Miguel Sofer
	  <msofer@@users.sourceforge.net>.
d5639 3
a5641 1
2002-08-28  David Gravereaux <davygrvy@@pobox.com>
d5643 1
a5643 8
	* generic/tclEnv.c:
	* unix/configure.in:
	* win/tclWinPort.h:  putenv() on some systems copies the buffer
	rather than taking reference to it.  This causes memory leaks
	and is know to effect mswindows (msvcrt) and NetBSD 1.5.2 .  This
	patch tests for this behavior and turns on -DHAVE_PUTENV_THAT_COPIES=1
	when approriate.  Thanks to David Welton for assistance.
	[Bug 414910]
d5645 3
a5647 1
	* unix/configure: regen'd
d5649 1
a5649 1
2002-08-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5651 4
a5654 1
	* doc/eval.n: Added mention of list command and corrected "SEE ALSO".
d5656 1
a5656 3
	* unix/configure.in: Cache handling of ac_cv_type_socklen_t was
	wrong. [Bug 600931] reported by John Ellson.  Fixed by putting the
	brackets where they belong.
d5658 2
a5659 1
2002-08-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d5661 2
a5662 3
	* generic/tclCompCmds.c: fix for [Bug 599788] (error in element
	name causing segfault), reported by Tom Wilkason. Fixed by copying
	the tokens instead of the source string.
d5664 1
a5664 1
2002-08-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d5666 1
a5666 4
	* generic/tclThreadAlloc.c: small optimisation, reducing the
	new allocator's overhead.
	
2002-08-23  Miguel Sofer  <msofer@@users.sourceforge.net>
d5668 1
a5668 2
	* generic/tclObj.c (USE_THREAD_ALLOC): fixed leak [Bug 597936]. 
	Thanks to Zoran Vasiljevic.
d5670 1
a5670 1
2002-08-23  Miguel Sofer  <msofer@@users.sourceforge.net>
d5672 3
a5674 2
	* generic/tclThreadAlloc.c (USE_THREAD_ALLOC): moving objects
	between caches as a block, instead of one-by-one.
d5676 2
a5677 1
2002-08-22  Miguel Sofer  <msofer@@users.sourceforge.net>
d5679 2
a5680 3
	* generic/tclBasic.c:
	* generic/tclCmdMZ.c: fix for freed memory r/w in delete traces
	[Bug 589863], patch by Hemang Lavana.
d5682 1
a5682 1
2002-08-20  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5684 3
a5686 8
	* win/Makefile.in (CFLAGS): 
	* unix/Makefile.in (MEM_DEBUG_FLAGS): Added usage of @@MEM_DEBUG_FLAGS@@.
	* win/configure.in:
	* unix/configure.in: Added usage of SC_ENABLE_MEMDEBUG.
	* win/tcl.m4:
	* unix/tcl.m4: Added macro SC_ENABLE_MEMDEBUG. Allows a user of
	  configure to (de)activate memory validation and debugging
	  (TCL_MEM_DEBUG). No need to modify the makefile anymore.
d5688 2
a5689 1
2002-08-20  Don Porter  <dgp@@users.sourceforge.net>
d5691 2
a5692 1
	* generic/tclCkalloc.c:	CONSTified MemoryCmd and CheckmemCmd.
a5693 3
	* README:		Bumped version number to 8.4b3 to distinguish
	* generic/tcl.h:	HEAD from the 8.4b2 release.
	* tools/tcl.wse.in:
d5695 2
a5696 3
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure.in:
d5698 112
a5809 2
	* unix/configure:	autoconf
	* win/configure:
d5811 2
a5812 8
	* library/http/http.tcl:	Corrected installation directory of
	* library/msgcat/msgcat.tcl:	the package tcltest 2.2.  Added
	* library/opt/optparse.tcl:	comments in other packages to remind
	* library/tcltest/tcltest.tcl:	that installation directories need 
	* unix/Makefile.in:		updates to match increasing version
	* win/Makefile.in:		numbers. [Bug 597450]
	* win/makefile.bc:
	* win/makefile.vc:
d5814 2
a5815 1
2002-08-19  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d5817 1
a5817 2
	* unix/tclUnixTest.c (TestfilehandlerCmd): Changed
	  readable/writable to the more common readable|writable.
d5819 4
a5822 2
	  Fixes SF #596034 reported by Larry Virden
	  <lvirden@@users.sourceforge.net>.
d5824 1
a5824 1
2002-08-16  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5826 4
a5829 10
	* tests/fCmd.test: Added test to make sure that the cause of the
	problem is detectable with an unpatched Tcl.
	* doc/ObjectType.3: Added note on the root cause of this problem
	to the documentation, since it is possible for user code to
	trigger this sort of behaviour too.
	* generic/tclIOUtil.c (SetFsPathFromAny): Objects should only have
	their old representation deleted when we know that we are about to
	install a new one.  This stops a weird TclX bug under Linux with
	certain kinds of memory debugging enabled which essentally came
	down to a double-free of a string.
d5831 1
a5831 1
2002-08-14  Miguel Sofer  <msofer@@users.sourceforge.net>
d5833 3
a5835 9
	* generic/tclInt.h:
	* generic/tclObj.c: (code cleanup) factored the parts in the macros 
	TclNewObj() / TclDecrRefCount() into a common part for all
	memory allocators and two new macros TclAllocObjStorage() /
	TclFreeObjStorage() that are specific to each allocator and fully
	describe the differences. Removed allocator-specific code from
	tclObj.c by using the macros.
	
2002-08-12  Miguel Sofer  <msofer@@users.sourceforge.net>
d5837 1
a5837 3
	* generic/tclCmdMZ.c: fixing UMR in delete traces, [Bug 589863].
	
2002-08-08  David Gravereaux <davygrvy@@pobox.com>
d5839 1
a5839 2
	* tools/man2help.tcl: Fixed $argv handling bug where if -bitmap
	wasn't specified $argc was off by one.
d5841 4
a5844 1
2002-08-08  Miguel Sofer  <msofer@@users.sourceforge.net>
d5846 5
a5850 2
	* tests/uplevel.test: added 6.1 to test [uplevel] with shadowed
	commands [Bug 524383]
d5852 1
a5852 1
	* tests/subst.test: added 5.8-10 as further tests for [Bug 495207] 
d5854 6
a5859 1
2002-08-08  Don Porter  <dgp@@users.sourceforge.net>
d5861 1
a5861 1
	* tests/README: Noted removal of defs.tcl.
d5863 2
a5864 1
2002-08-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d5866 1
a5866 1
	* doc/lsearch.n: corrected lsearch docs to use -inline in examples.
d5868 2
a5869 1
	*** 8.4b2 TAGGED FOR RELEASE ***
d5871 2
a5872 131
	* tests/fCmd.test:
	* tests/unixFCmd.test: updated tests for new link copy behavior.
	* generic/tclFCmd.c (CopyRenameOneFile): changed the behavior to
	follow links to endpoints and copy that file/directory instead of
	just copying the surface link.  This means that trying to copy a
	link that has no endpoint (danling link) is an error.
	[Patch #591647] (darley)
	(CopyRenameOneFile): this is currently disabled by default until
	further issues with such behavior (like relative links) can be
	handled correctly.

	* tests/README: slight wording improvements

2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>

	* docs/BoolObj.3: added description of valid string reps for a
	boolean object [Bug 584794]
	* generic/tclObj.c: optimised Tcl_GetBooleanFromObj and
	SetBooleanFromAny to avoid parsing the string rep when it can be
	avoided [Bugs 584650, 472576]
	
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.h:
	* generic/tclObj.c: making tclCmdNameType static ([Bug 584567],
	Don Porter).
	
2002-08-07  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclObj.c (Tcl_NewObj): added conditional code for
	USE_THREAD_ALLOC; objects allocated through Tcl_NewObj() were
	otherwise being leaked. [Bug 587488] reported by Sven Sass.
	
2002-08-06  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclInt.decls:
	* unix/tclUnixThrd.c: Added stubs and implementations for
	non-threaded build for the tclUnixThrd.c procs TclpReaddir,
	TclpLocaltime, TclpGmtime and TclpInetNtoa.
	Fixes link errors in stubbed & threaded extensions that include
	tclUnixPort.h and use any of the procs readdir, localtime, 
	gmtime or inet_ntoa (e.g. TclX 8.4) [Bug 589526]
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c: Regen.

2002-08-05  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:	The setup and cleanup scripts are now
	* library/tcltest/pkgIndex.tcl:	skipped when a test is skipped, fixing
	* tests/tcltest.test:		[Bug 589859].  Test for bug added, and
	corrected tcltest package bumped to version 2.2.

	* generic/tcl.decls:	Restored Tcl_Concat to return (char *).  Like
	* generic/tclDecls.h:	Tcl_Merge, it transfers ownership of a dynamic
	* generic/tclUtil.c:	allocated string to the caller.

2002-08-04  Don Porter  <dgp@@users.sourceforge.net>

	* doc/CmdCmplt.3:	Applied Patch 585105 to fully CONST-ify
	* doc/Concat.3:		all remaining public interfaces of Tcl.
	* doc/CrtCommand.3:	Notably, the parser no longer writes on 
	* doc/CrtSlave.3:	the string it is parsing, so it is no
	* doc/CrtTrace.3:	longer necessary for Tcl_Eval() to be
	* doc/Eval.3:		given a writable string.  Also, the
	* doc/ExprLong.3:	refactoring of the Tcl_*Var* routines
	* doc/LinkVar.3:	by Miguel Sofer is included, so that the
	* doc/ParseCmd.3:	"part1" argument for them no longer needs
	* doc/SetVar.3:		to be writable either.
	* doc/TraceVar.3:
	* doc/UpVar.3:		Compatibility support has been enhanced so
	* generic/tcl.decls	that a #define of USE_NON_CONST will remove
	* generic/tcl.h		all possible source incompatibilities with
	* generic/tclBasic.c	the 8.3 version of the header file(s).
	* generic/tclCmdMZ.c	The new #define of USE_COMPAT_CONST now does
	* generic/tclCompCmds.c	what USE_NON_CONST used to do -- disable
	* generic/tclCompExpr.c only those new CONST's that introduce
	* generic/tclCompile.c	irreconcilable incompatibilities.
	* generic/tclCompile.h
	* generic/tclDecls.h	Several bugs are also fixed by this patch.
	* generic/tclEnv.c	[Bugs 584051,580433] [Patches 585105,582429]
	* generic/tclEvent.c	
	* generic/tclInt.decls
	* generic/tclInt.h
	* generic/tclIntDecls.h
	* generic/tclInterp.c
	* generic/tclLink.c
	* generic/tclObj.c
	* generic/tclParse.c
	* generic/tclParseExpr.c
	* generic/tclProc.c
	* generic/tclTest.c
	* generic/tclUtf.c
	* generic/tclUtil.c
	* generic/tclVar.c
	* mac/tclMacTest.c
	* tests/expr-old.test
	* tests/parseExpr.test
	* unix/tclUnixTest.c
	* unix/tclXtTest.c
	* win/tclWinTest.c

2002-08-01  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: bugfix (reading freed memory). Testsuite
	passed on linux/i386, compile-13.1 hung on linux/alpha.

2002-08-01  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: added a reference count for the complete
	execution stack, instead of Tcl_Preserve/Tcl_Release. 

2002-08-01  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tclCkalloc.c (TclFinalizeMemorySubsystem):
	Don't lock the ckalloc mutex before invoking the
	Tcl_DumpActiveMemory function since it also
	locks the same mutex. This code is only executed
	when "memory onexit filename" has been executed
	and Tcl is compiled with -DTCL_MEM_DEBUG.

2002-08-01  Reinhard Max  <max@@suse.de>

	* win/tclWinPort.h: The windows headers don't provide socklen_t,
	so we have to do it.

2002-07-31  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInt.h (USE_THREAD_ALLOC): for unshared objects,
	TclDecrRefCount now frees the internal rep before the string rep -
	just like the non-macro Tcl_DecrRefCount/TclFreeObj [Bug 524802]. 
	For the other allocators the fix was done on 2002-03-06.
d5874 3
a5876 1
2002-07-31  Miguel Sofer  <msofer@@users.sourceforge.net>
d5878 5
a5882 2
	* generic/tclInterp.c: signed/unsigned comparison warning fixed
	(Vince Darley).
d5884 5
a5888 1
2002-07-31  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d5890 1
a5890 1
	* unix/tcl.m4 (SC_BUGGY_STRTOD): Enabled caching of test results.
d5892 2
a5893 2
	* unix/tcl.m4 (SC_BUGGY_STRTOD): Solaris 2.8 still has a buggy
	strtod() implementation; make sure we detect it.
d5895 1
a5895 13
	* tests/expr.test (expr-22.*): Marked as non-portable because it
	seems that these tests have an annoying tendency to fail in
	unexpected ways.  [Bugs 584825, 584950, 585986]

2002-07-30  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tests/io.test: 
	* generic/tclIO.c (WriteChars): Added flag to break out of loop if
	  nothing of the input is consumed at all, to prevent infinite
	  looping of called with a non-UTF-8 string. Fixes Bug 584603
	  (partially). Added new test "io-60.1". Might need additional
	  changes to Tcl_Main so that unprintable results are printed as
	  binary data.
d5897 2
a5898 1
2002-07-29  Mo DeJong  <mdejong@@users.sourceforge.net>
d5900 1
a5900 62
	* unix/Makefile.in: Use CC_SEARCH_FLAGS instead of
	LD_SEARCH_FLAGS when linking with ${CC}.
	* unix/configure: Regen.
	* unix/configure.in: Don't subst CC_SEARCH_FLAGS or
	LD_SEARCH_FLAGS since this is now done in tcl.m4.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Document and
	set CC_SEARCH_FLAGS whenever LD_SEARCH_FLAGS is set.
	[Tcl patch 588290]

2002-07-29  Reinhard Max  <max@@suse.de>

	* unix/tcl.m4 (SC_SERIAL_PORT): Fixed detection for cases when
                                        configure's stdin is not a tty.
	
	* unix/tclUnixPort.h: 
	* generic/tclIOSock.c:          Changed size_t to socklen_t in
                                        socket-related function calls.

	* unix/configure.in:            Added test and fallback definition
                                        for socklen_t.
	
	* unix/configure:               generated.

2002-07-29  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclObj.c: fixed a comment

	* generic/tcl.h: 
	* generic/tclBasic.c: 
	* generic/tclInterp.c: added the new flag TCL_EVAL_INVOKE to
	the interface of the Tcl_Eval* functions, removing the
	TCL_EVAL_NO_TRACEBACK added yesterday: alias invocations not only 
	require no tracebacks, but also look up the command name in the
	global scope - see new test interp-9.4
	* tests/interp.test: added 9.3 to test for safety of aliases to
	hidden commands, 9.4 to test for correct command lookup scope.

2002-07-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/regc_locale.c (cclass): [[:xdigit:]] is only a defined
	concept on western characters, so should not allow any unicode
	digit, and hence number of ranges in [[:xdigit:]] is fixed.
	* tests/reg.test: Added test to detect the bug.
	* generic/regc_cvec.c (newcvec): Corrected initial size value in
	character vector structure.  [Bug 578363]  Many thanks to
	pvgoran@@users.sf.net for tracking this down.

2002-07-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tcl.h: 
	* generic/tclBasic.c: added the new flag TCL_EVAL_NO_TRACEBACK to
	the interface of the Tcl_Eval* functions. Modified the error
	message for too many nested evaluations.
	* generic/tclInterp.h: changed the Alias struct to be of variable
	length and store the prefix arguments directly (instead of a
	pointer to a Tcl_Obj list). Made AliasObjCmd call Tcl_EvalObjv
	instead of TclObjInvoke - thus making aliases trigger execution
	traces [Bug 582522].
	* tests/interp.test:
	* tests/stack.test: adapted to the new error message.
	* tests/trace.test: added tests for aliases firing the exec
	traces. 
d5902 2
a5903 1
2002-07-27  Mo DeJong  <mdejong@@users.sourceforge.net>
d5905 1
a5905 21
	* unix/Makefile.in: Revert fix for Tcl bug 529801
	since it was incorrect and broke the build on
	other systems. Fix Tcl bug 587299.
	Add MAJOR_VERSION, MINOR_VERSION, PATCH_LEVEL,
	SHLIB_LD_FLAGS, SHLIB_LD_LIBS, CC_SEARCH_FLAGS,
	LD_SEARCH_FLAGS, and LIB_FILE variables to support
	more generic library build/install rules.
	* unix/configure: Regen.
	* unix/configure.in: Move AC_PROG_RANLIB into
	tcl.m4. Move shared build test and setting
	of MAKE_LIB and MAKE_STUB_LIB into tcl.m4.
	Move subst of a number of variables into
	tcl.m4 where they are defined.
	* unix/tcl.m4 (SC_ENABLE_SYMBOLS, SC_CONFIG_CFLAGS):
	Subst vars where they are defined. Add MAKE_LIB,
	MAKE_STUB_LIB, INSTALL_LIB, and INSTALL_STUB_LIB
	rules to deal with the ugly details of running
	ranlib on static libs at build and install time.
	Replace TCL_SHLIB_LD_EXTRAS with SHLIB_LD_FLAGS
	and use it when building a shared library.
	* unix/tclConfig.sh.in: Add TCL_CC_SEARCH_FLAGS.
d5907 3
a5909 1
2002-07-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d5911 2
a5912 4
	* generic/tclExecute.c: fixed Tcl_Obj leak in code corresponding
	to the macro NEXT_INST_V(x, 0, 1) [Bug 587495].
	
2002-07-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d5914 2
a5915 2
	* generic/tclVar.c (TclObjLookupVar): leak fix and improved
	comments. 
d5917 2
a5918 1
2002-07-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d5920 3
a5922 3
	* generic/tclVar.c (TclLookupVar): removed early returns that
	prevented the parens from being restored. also removed goto label
	as it was not necessary.
d5924 2
a5925 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d5927 2
a5928 3
	* generic/tclExecute.c: 
	* tests/expr-old.test: fix for erroneous error messages in [expr],
	[Bug  587140] reported by Martin Lemburg.
d5930 1
a5930 3
2002-07-25  Joe English  <jenglish@@users.sourceforge.net>
	* generic/tclProc.c: fix for Tk Bug #219218 "error handling 
	with bgerror in Tk"
d5932 3
a5934 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d5936 3
a5938 2
	* generic/tclExecute.c: restoring full TCL_COMPILE_DEBUG
	functionality.
d5940 1
a5940 1
2002-07-24  Don Porter  <dgp@@users.sourceforge.net>
d5942 2
a5943 2
	* tests/unixInit.test: relaxed unixInit-3.1 to accept iso8859-15
	as a valid C encoding.  [Bug 575336]
d5945 2
a5946 1
2002-07-24  Miguel Sofer  <msofer@@users.sourceforge.net>
d5948 3
a5950 4
	* generic/tclExecute.c: restoring the tcl_traceCompile
	functionality while I repair tcl_traceExec. The core now compiles
	and runs also under TCL_COMPILE_DEBUG, but execution in the
	bytecode engine can still not be traced.
d5952 3
a5954 1
2002-07-24  Daniel Steffen  <das@@users.sourceforge.net>
d5956 4
a5959 6
	* unix/Makefile.in:
	* unix/configure.in: corrected fix for [Bug 529801]: ranlib
	only needed for static builds on Mac OS X.
	* unix/configure: Regen.
	* unix/tclLoadDyld.c: fixed small bugs introduced by Vince,
	implemented library unloading correctly (needs OS X 10.2).
d5961 2
a5962 1
2002-07-23  Joe English  <jenglish@@users.sourceforge.net>
d5964 2
a5965 6
	* doc/OpenFileChnl.3: (Updates from Larry Virden)
	* doc/open.n:
	* doc/tclsh.1: Fix section numbers in Unix man page references.
	* doc/lset.n:  In EXAMPLES section, include command to set the 
	initial value used in subsequent examples.
	* doc/http.n: Package version updated to 2.4.
d5967 3
a5969 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d5971 1
a5971 4
	* unix/configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Enable 64 bit compilation
	when using the native compiler on a 64 bit version of IRIX.
	[Tcl bug 219220]
d5973 2
a5974 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d5976 7
a5982 2
	* unix/Makefile.in: Combine ranlib tests and
	avoid printing unless ranlib is actually run.
d5984 1
a5984 1
2002-07-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d5986 3
a5988 38
	* unix/tcl.m4 (SC_PATH_X): Set XINCLUDES to "" instead
	of "# no special path needed" or "# no include files found"
	when x headers cannot be located.

2002-07-22  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclIOUtil.c: made tclNativeFilesystem static
	(since 07-19 changes removed its usage elsewhere), and
	added comments about its usage.
	* generic/tclLoad.c:
	* generic/tcl.h:
	* generic/tcl.decls: 
	* doc/FileSystem.3: converted last load-related ClientData
	parameter to Tcl_LoadHandle opaque structure, removing a 
	couple of casts in the process.
	
	* generic/tclInt.h: removed tclNativeFilesystem declaration
	since it is now static again.
	
2002-07-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/expr.test (expr-22.*): Added tests to help detect the
	corrected handling.
	* generic/tclExecute.c (IllegalExprOperandType): Improved error
	message generated when attempting to manipulate Inf and NaN values.
	* generic/tclParseExpr.c (GetLexeme): Allowed parser to recognise
	'Inf' as a floating-point number. [Bug 218000]

2002-07-21  Don Porter  <dgp@@users.sourceforge.net>

	* tclIOUtil.c: Silence compiler warning. [Bug 584408].

2002-07-19  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclIOUtil.c: fix to GetFilesystemRecord
	* win/tclWinFile.c:
	* unix/tclUnixFile.c: fix to subtle problem with links shown
	up by latest tclkit builds.
d5990 1
a5990 1
2002-07-19  Mo DeJong  <mdejong@@users.sourceforge.net>
d5992 3
a5994 1
	* unix/configure:
d5996 5
a6000 5
	* win/configure:
	* win/configure.in: Add AC_PREREQ(2.13) in an attempt
	to make it more clear that the configure scripts
	must be generated with autoconf version 2.13.
	[Bug 583573]
d6002 1
a6002 1
2002-07-19  Vince Darley  <vincentdarley@@users.sourceforge.net>
d6004 2
a6005 2
	* unix/Makefile.in: fix to build on MacOS X [Bug 529801], bug
	report and fix from jcw.
d6007 2
a6008 1
2002-07-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6010 4
a6013 1
	* win/tclWinSerial.c (no_timeout): Made this variable static.
d6015 2
a6016 4
	* generic/tclExecute.c, generic/tclCompile.c, generic/tclBasic.c: 
	* generic/tclCompile.h (builtinFuncTable, instructionTable): Added
	prefix to these symbols because they are visible outside the Tcl
	library.
d6018 3
a6020 5
	* generic/tclCompExpr.c (operatorTable): 
	* unix/tclUnixTime.c (tmKey):
	* generic/tclIOUtil.c (theFilesystemEpoch, filesystemWantToModify,
	filesystemIteratorsInProgress, filesystemOkToModify): Made these
	variables static.
d6022 3
a6024 4
	* unix/tclUnixFile.c:		Renamed nativeFilesystem to
	* win/tclWinFile.c:		tclNativeFilesystem and declared
	* generic/tclIOUtil.c:		it properly in tclInt.h
	* generic/tclInt.h: 
d6026 2
a6027 1
	* generic/tclUtf.c (totalBytes): Made this array static and const.
d6029 2
a6030 3
	* generic/tclParse.c (typeTable): Made this array static and const.
	(Tcl_ParseBraces): Simplified error handling case so that scans
	are only performed when needed, and flags are simpler too.
d6032 10
a6041 2
	* license.terms: Added AS to list of copyright holders; it's only
	fair for the current gatekeepers to be listed here!
d6043 1
a6043 3
	* tests/cmdMZ.test: Renamed constraint for clarity. [Bug#583427]
	Added tests for the [time] command, which was previously only
	indirectly tested!
d6045 2
a6046 1
2002-07-18  Vince Darley  <vincentdarley@@users.sourceforge.net>
d6048 1
a6048 4
	* generic/tclInt.h:
	* generic/tcl.h:
	* */*Load*.c: added comments on changes of 07/17 and 
	replaced clientData with Tcl_LoadHandle in all locations.
d6050 1
a6050 11
	* generic/tclFCmd.c:
	* tests/fileSystem.test: fixed a 'knownBug' with 'file
	attributes ""'
	* tests/winFCmd.test: 
	* tests/winPipe.test:
	* tests/fCmd.test:
	* tessts/winFile.test: added 'pcOnly' constraint to some
	tests to make for more useful 'tests skipped' log from 
	running all tests on non-Windows platforms.
	
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d6052 8
a6059 3
	* generic/tclBasic.c (CallCommandTraces): delete traces now
	receive the FQ old name of the command. 
	[Bug 582532] (Don Porter)
d6061 1
a6061 1
2002-07-18  Vince Darley  <vincentdarley@@users.sourceforge.net>
d6063 10
a6072 4
	* tests/ioUtil.test: added constraints to 1.4,2.4 so they
	don't run outside of tcltest. [Bugs 583276,583277]
	
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d6074 2
a6075 2
	* generic/tclVar.c (DupParsedVarName): nasty bug fixed, reported
	by Vince Darley.
d6077 1
a6077 1
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d6079 1
a6079 5
	* generic/tclVar.c (TclPtrIncrVar): missing CONST in declarations,
	inconsistent with tclInt.h. Thanks to Vince Darley for reporting,
	boo to gcc for not complaining.
	
2002-07-17  Vince Darley  <vincentdarley@@users.sourceforge.net>
d6081 1
a6081 15
	* generic/tclInt.h:
	* generic/tclIOUtil.c:
	* generic/tclLoadNone.c:
	* unix/tclLoadAout.c:
	* unix/tclLoadDl.c:
	* unix/tclLoadDld.c:
	* unix/tclLoadDyld.c:
	* unix/tclLoadNext.c:
	* unix/tclLoadOSF.c:
	* unix/tclLoadShl.c:
	* mac/tclMacLoad.c:
	* win/tclWinLoad.c: modified to move more functionality
	to the generic code and avoid duplication.  Partial replacement
	of internal uses of clientData with opaque Tcl_LoadHandle.  A
	little further work still needed, but significant changes are done.
d6083 4
a6086 1
2002-07-17  D. Richard Hipp    <drh@@hwaci.com>
d6088 1
a6088 3
	* library/msgcat/msgcat.tcl: fix a comment that was causing
	problems for programs (ex: mktclapp) that embed the initialization
	scripts in strings.
d6090 1
a6090 1
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d6092 5
a6096 6
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c: removing the now redundant functions to access
	indexed variables: Tcl(Get|Set|Incr)IndexedScalar() and
	Tcl(Get|Set|Incr)ElementOfIndexedArray(). 
d6098 2
a6099 1
2002-07-17  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6101 4
a6104 2
	* generic/tclExecute.c (TclExecuteByteCode): Minor fixes to make
	this file compile with SunPro CC...
d6106 2
a6107 1
2002-07-17  Miguel Sofer  <msofer@@users.sourceforge.net>
d6109 2
a6110 9
	* generic/tclExecute.c: modified to do variable lookup explicitly,
	and then either inlining the variable access or else calling the new
	TclPtr(Set|Get|Incr)Var functions in tclVar.c
	* generic/tclInt.h: declare some functions previously local to
	tclVar.c for usage by TEBC.
	* generic/tclVar.c: removed local declarations; moved all special
	accessor functions for indexed variables to the end of the file -
	they are unused and ready for removal, but left there for the time
	being as they are in the internal stubs table.
d6112 7
a6118 4
	** WARNING FOR BYTECODE MAINTAINERS **
	TCL_COMPILE_DEBUG is currently not functional; will be fixed ASAP.
	
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d6120 1
a6120 3
	* unix/Makefile.in:
	* win/Makefile.in: Add a more descriptive warning
	in the event `make genstubs` needs to be rerun.
d6122 3
a6124 1
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d6126 2
a6127 6
	* unix/Makefile.in: Use dltest.marker file
	to keep track of when the dltest package
	is up to date. This fixes [Tcl bug 575768]
	since tcltest is no longer linked every time.
	* unix/dltest/Makefile.in: Create ../dltest.marker
	after a successful `make all` run in dltest.
d6129 2
a6130 1
2002-07-16  Mo DeJong  <mdejong@@users.sourceforge.net>
d6132 1
a6132 2
	* unix/configure: Regen.
	* unix/configure.in: Remove useless subst of TCL_BIN_DIR.
d6134 4
a6137 1
2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d6139 4
a6142 3
	* generic/tclVar.c: inaccurate comment fixed
	
2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d6144 1
a6144 60
	* generic/tclBasic.c (Tcl_AddObjErrorInfo):
	* generic/tclExecute.c (TclUpdateReturnInfo):
	* generic/tclInt.h:	
	* generic/tclProc.c: 
	Added two Tcl_Obj to the ExecEnv structure to hold the fully
	qualified names "::errorInfo" and "::errorCode" to cache the
	addresses of the corresponding variables. The two most frequent
	setters of these variables now profit from the new variable name
	caching. 

2002-07-15  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclVar.c: refactorisation to reuse already looked-up Var
	pointers; definition of three new Tcl_Obj types to cache variable
	name parsing and lookup for later reuse; modification of internal
	functions to profit from the caching. 
	
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclNamesp.c: adding CONST qualifiers to variable names
	passed to Tcl_FindNamespaceVar and to variable resolvers; adding
	CONST qualifier to the 'msg' argument to TclLookupVar. Needed to
	avoid code duplication in the new tclVar.c code.

	* tests/set-old.test:
	* tests/var.test: slight modification of error messages due to the
	modifications in the tclVar.c code.

2002-07-15  Don Porter  <dgp@@users.sourceforge.net>

	* tests/unixInit.test:	Improved constraints to protect /tmp.	
	  [Bug 581403]

2002-07-15  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* tests/winFCmd.test: renamed 'win2000' and 'notWin2000' to
	more appropriate constraint names.
	* win/tclWinFile.c: updated comments to reflect 07-11 changes.
	* win/tclWinFCmd.c: made ConvertFileNameFormat static again,
	since no longer used in tclWinFile.c
	* mac/tclMacFile.c: completed TclpObjLink implementation which
	was previously lacking.
	* generic/tclIOUtil.c: comment cleanup and code speedup.
	
2002-07-14  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclInt.h:	Removed declarations that duplicated entries
	  in the (internal) stub table.
	
	* library/tcltest/tcltest.tcl:  Corrected errors in handling of
	  configuration options -constraints and -limitconstraints.

	* README:		Bumped HEAD to version 8.4b2 so we can
	* generic/tcl.h:	distinguish it from the 8.4b1 release.
	* tools/tcl.wse.in:
	* unix/configure*:
	* unix/tcl.spec:
	* win/README.binary:
	* win/configure*:
d6146 124
a6269 1
2002-07-11  Vince Darley  <vincentdarley@@users.sourceforge.net>
d6271 1
a6271 6
	* doc/file.n:
	* win/tclWinFile.c: on Win 95/98/ME the long form of the path
	is used as a normalized form.  This is required because short
	forms are not a robust representation.  The file normalization
	function has been sped up, but more performance gains might be
	possible, if speed is still an issue on these platforms.
d6273 5
a6277 1
2002-07-11  Don Porter  <dgp@@users.sourceforge.net>
d6279 1
a6279 2
	* library/tcltest/tcltest.tcl: Corrected reaction to existing but
	false ::tcl_interactive.
d6281 2
a6282 1
	* doc/Hash.3: Overlooked CONST documentation update.
d6284 2
a6285 1
2002-07-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6287 1
a6287 10
	* generic/tclCkalloc.c: ckalloc() and friends take the block size
	as an unsigned, so we should use %ud when reporting it in fprintf()
	and panic().

2002-07-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.c: now setting local vars undefined at
	compile time, instead of waiting until the proc is initialized. 
	* generic/tclProc.c: use macro TclSetVarUndefined instead of
	directly etting the flag.
d6289 1
a6289 1
2002-07-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6291 1
a6291 2
	* tests/cmdAH.test: [file attr -perm] is Unix-only, so add [catch]
	when not inside a suitably-protected test.
d6293 1
a6293 1
2002-07-10  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6295 2
a6296 110
	* tests/unixFCmd.test, tests/fileName.test: 
	* tests/fCmd.test: Removed [exec] of Unix utilities that have
	equivalents in standard Tcl.  [Bug 579268]  Also simplified some
	of unixFCmd.test while I was at it.

2002-07-10  Don Porter  <dgp@@users.sourceforge.net>

	* tests/tcltest.test:  Greatly reduced the number of [exec]s, using
	slave interps instead.
	* library/tcltest/tcltest.tcl:  Fixed bug uncovered in the conversion
	where a message was written to stdout instead of [outputChannel].

	* tests/basic.test:	Cleaned up, constrained, and reduced the
	* tests/compile.test:	amount of [exec] usage in the test suite.
	* tests/encoding.test:
	* tests/env.test:
	* tests/event.test:
	* tests/exec.test:
	* tests/io.test:
	* tests/ioCmd.test:
	* tests/regexp.test:
	* tests/regexpComp.test:
	* tests/socket.test:
	* tests/tcltest.test:
	* tests/unixInit.test:
	* tests/winDde.test:
	* tests/winPipe.test:

2002-07-10  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/cmdAH.test: Removed [exec] of Unix utilities. [Bug 579211]

	* tests/expr.test: Added tests to make sure that this works.
	* generic/tclExecute.c (ExprCallMathFunc): Functions should also
	be able to return wide-ints.  [Bug 579284]

2002-07-08  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tests/socket.test: Fixed bug #578164. The original reason for
	  the was a DNS outage while running the testsuite. Changed [info
	  hostname] to 127.0.0.1 to bypass DNS, knowing that we operate on
	  the local host.

2002-07-08  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n:		Fixed incompatibility in [viewFile].
	* library/tcltest/tcltest.tcl:	Corrected docs.  Bumped to 2.2.1.
	* library/tcltest/pkgIndex.tcl: [Bug 578163]

2002-07-08  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* tests/cmdAH.test:
	* tests/fCmd.test:
	* tests/fileName.test: tests which rely on 'file link' need a
	constraint so they don't run on older Windows OS. [Bug 578158]
	* generic/tclIOUtil.c:
	* generic/tcl.h:
	* generic/tclInt.h:
	* generic/tclTest.c:
	* mac/tclMacChan.c:
	* unix/tclUnixChan.c:
	* win/tclWinChan.c:
	* doc/FileSystem.3: cleaned up internal handling of
	Tcl_FSOpenFileChannel to remove duplicate code, and make
	writing external vfs's clearer and easier.  No
	functionality change.  Also clarify that objects with refCount
	zero should not be passed in to the Tcl_FS API, and prevent
	segfaults from occuring on such user errors. [Bug 578617]
	
2002-07-06  Don Porter  <dgp@@users.sourceforge.net>

	* tests/pkgMkIndex.test:  Constrained tests of [load] package indexing
	to those platforms where the testing shared libraries have been built.
	[Bug 578166].

2002-07-05  Don Porter  <dgp@@users.sourceforge.net>
	* changes: added recent changes

2002-07-05  Reinhard Max  <max@@suse.de>

	* generic/tclClock.c (FormatClock): Convert the format string to
	UTF8 before calling TclpStrftime, so that non-ASCII characters
	don't get mangled when the result string is being converted back.
	* tests/clock.test: Added a test for that.

2002-07-05  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/Makefile.in (ro-test,ddd,GDB,DDD): Created new targets to
	allow running the test suite with a read-only current directory,
	running under ddd instead of gdb, and factored out some executable
	names for broken sites (like mine) where gdb and ddd are installed
	with non-standard names...

	* tests/httpold.test: Altered test names to httpold-* to avoid
	clashes with http.test, and stopped tests from failing when the
	current directory is not writable...

	* tests/event.test:		Stop these tests from failing
	* tests/ioUtil.test:		when the current directory is
	* tests/regexp.test:		not writable...
	* tests/regexpComp.test: 
	* tests/source.test: 
	* tests/unixFile.test: 
	* tests/unixNotfy.test: 

	* tests/unixFCmd.test:		Trying to make these test-files
	* tests/macFCmd.test:		not bomb out with an error when
	* tests/http.test:		the current directory is not
	* tests/fileName.test:		writable...
	* tests/env.test:
d6298 1
a6298 1
2002-07-05  Jeff Hobbs  <jeffh@@ActiveState.com>
d6300 2
a6301 1
	*** 8.4b1 TAGGED FOR RELEASE ***
d6303 5
a6307 1
2002-07-04  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6309 1
a6309 205
	* tests/cmdMZ.test (cmdMZ-1.4): 
	* tests/cmdAH.test: More fixing of writable-current-dir
	assumption. [Bug 575824]

2002-07-04  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/basic.test: Same issue as below; fixed [Bug 575817]
	
2002-07-04  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tests/socket.test: 
	* tests/winPipe.test: 
	* tests/pid.test: Fixed SF Bug #575848. See below for a
	  description the general problem.

	* All the bugs below are instances of the same problem: The
	  testsuite assumes [pwd] = [temporaryDirectory] and writable.

	* tests/iogt.test: Fixed bug #575860.
	* tests/io.test:   Fixed bug #575862.
	* tests/exec.test: 
	* tests/ioCmd.test: Fixed bug #575836.

2002-07-03  Don Porter  <dgp@@users.sourceforge.net>

	* tests/pkg1/direct1.tcl: removed
	* tests/pkg1/pkgIndex.tcl: removed
	* tests/pkgMkIndex.test:  Imported auxilliary files from tests/pkg1
	  into the test file pkgMkIndex.test itself.  Formatting fixes.

	* unix/Makefile.in: removed tests/pkg/* from `make dist`

	* tests/pkg/circ1.tcl: removed
	* tests/pkg/circ2.tcl: removed
	* tests/pkg/circ3.tcl: removed
	* tests/pkg/global.tcl: removed
	* tests/pkg/import.tcl: removed
	* tests/pkg/pkg1.tcl: removed
	* tests/pkg/pkg2_a.tcl: removed
	* tests/pkg/pkg2_b.tcl: removed
	* tests/pkg/pkg3.tcl: removed
	* tests/pkg/pkg4.tcl: removed
	* tests/pkg/pkg5.tcl: removed
	* tests/pkg/pkga.tcl: removed
	* tests/pkg/samename.tcl: removed
	* tests/pkg/simple.tcl: removed
	* tests/pkg/spacename.tcl: removed
	* tests/pkg/std.tcl: removed
	* tests/pkgMkIndex.test: Fixed [Bug 575857] where this test file
	  expected to be able to write to [file join [testsDirectory]
	  pkg].  Part of the fix was to import several auxilliary files
	  into the test file itself.

	* tests/main.test:	Cheap fix for [Bugs 575851, 575858].  Avoid
	* tests/tcltest.test:	non-writable . by [cd [temporaryDirectory]].

	* library/auto.tcl: Fix [tcl_findLibrary] to be sure it sets
	  $varName only if a successful library script is found.
	  [Bug 577033]

2002-07-03  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompCmds.c (TclCompileCatchCmd): return
	  TCL_OUT_LINE_COMPILE instead of TCL_ERROR: let the failure
	  happen at runtime so that it can be caught [Bug 577015].

2002-07-02  Joe English  <jenglish@@users.sourceforge.net>

	* doc/tcltest.n: Markup fixes, spellcheck.

2002-07-02  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n: more refinements of the documentation.

	* library/tcltest/tcltest.tcl: Added trace to be sure the stdio
	  constraint is updated whenever the [interpreter] changes.

	* doc/tcltest.n:		Reverted [makeFile] and [viewFile] to
	* library/tcltest/tcltest.tcl:	their former behavior, and documented
	* tests/cmdAH.test:		it.  Corrected misspelling of hook
	* tests/event.test:		procedure.  Restored tests.
	* tests/http.test:
	* tests/io.test:

	* library/tcltest/tcltest.tcl: Simplified logic of
	  [GetMatchingFiles] and [GetMatchingDirectories], removing
	  special case processing.

	* doc/tcltest.n: More documentation updates.  Reference sections
	  are complete.  Only examples need adding.

2002-07-02  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* tests/fCmd.test: 
	* generic/tclCmdAH.c: clearer error msgs for 'file link',
	as per the man page.

2002-07-01  Joe English  <jenglish@@users.sourceforge.net>

	* doc/Access.3:
	* doc/AddErrInfo.3:
	* doc/Alloc.3:
	* doc/Backslash.3:
	* doc/CrtChannel.3:
	* doc/CrtSlave.3:
	* doc/Encoding.3:
	* doc/Eval.3:
	* doc/FileSystem.3:
	* doc/Notifier.3:
	* doc/OpenFileChnl.3:
	* doc/ParseCmd.3:
	* doc/RegExp.3:
	* doc/Tcl_Main.3:
	* doc/Thread.3:
	* doc/TraceCmd.3:
	* doc/Utf.3:
	* doc/WrongNumArgs.3:
	* doc/binary.n:
	* doc/clock.n:
	* doc/expr.n:
	* doc/fconfigure.n:
	* doc/glob.n:
	* doc/http.n:
	* doc/interp.n:
	* doc/lsearch.n:
	* doc/lset.n:
	* doc/msgcat.n:
	* doc/packagens.n:
	* doc/pkgMkIndex.n:
	* doc/registry.n:
	* doc/resource.n:
	* doc/safe.n:
	* doc/scan.n:
	* doc/tclvars.n:  Spell-check, fixed typos (Updates from Larry Virden).

2002-07-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Made Solaris use gcc for linking
	when building with gcc to resolve problems with undefined symbols
	being present when tcl library used with non-gcc linker at later
	stage. Symbols were compiler-generated, so it is the compiler's
	business to define them. [Bug #541181] 

2002-07-01  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n: more work in progress updating tcltest docs.

	* library/tcltest/tcltest.tcl: Change [configure -match] to
	stop treating an empty list as a list of the single pattern "*".
	Changed the default value to [list *] so default operation
	remains the same.

	* tests/pkg/samename.tcl: restored.  needed by pkgMkIndex.test.

	* library/tcltest/tcltest.tcl: restored writeability testing of
	-tmpdir, augmented by a special exception for the deafault value.

2002-07-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/concat.n: Documented the *real* behaviour of [concat]!

2002-06-30  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n: more work in progress updating tcltest docs.

	* tests/README:		Updated the instructions on running and
	* tests/cmdMZ.test:	adding to the test suite.  Also updated
	* tests/encoding.test:	several tests, mostly to correctly create
	* tests/fCmd.test:	and destroy any temporary files in the
	* tests/info.test:	[temporaryDirectory] of tcltest.
	* tests/interp.test:

	* library/tcltest/tcltest.tcl:	Stopped checking for writeability
	of -tmpdir value because no default directory can be guaranteed to
	be writeable.

	* tests/autoMkindex.tcl: removed.
	* tests/pkg/samename.tcl: removed.
	* tests/pkg/magicchar.tcl: removed.
	* tests/pkg/magicchar2.tcl: removed.
	* tests/autoMkindex.test: Updated auto_mkIndex tests to use
	[makeFile] and [removeFile] so tests are done in [temporaryDirecotry]
	where write access is guaranteed.

	* library/tcltest/tcltest.tcl:	Fixed [makeFile] and [viewFile] to
	* tests/cmdAH.test:		accurately reflect a file's contents.
	* tests/event.test:		Updated tests that depended on buggy
	* tests/http.test:		behavior.  Also added warning messages
	* tests/io.test:		to "-debug 1" operations to debug test
	* tests/iogt.test:		calls to (make|remove)(File|Directory).

	* unix/mkLinks: `make mklinks` on 6-27 commits.

2002-06-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.h: modified the macro TclEmitPush to not
	call its first argument repeatedly or pass it to other macros,
	[Bug 575194] reported by Peter Spjuth.

2002-06-28  Don Porter  <dgp@@users.sourceforge.net>

	* docs/tcltest.n:	Doc revisions in progress.
	* library/tcltest/tcltest.tcl: Corrected -testdir default value.
	Was not reliable, and disagreed with docs!  Thanks to Hemang Lavana.
	[Bug 575150]
d6311 4
a6314 1
2002-06-28  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6316 3
a6318 48
	* unix/tclUnixThrd.c:	Renamed the Tcl_Platform* #defines to
	* unix/tclUnixPipe.c:	TclOS* because they are only used
	* unix/tclUnixFile.c:	internally.  Also stopped double-#def
	* unix/tclUnixFCmd.c:	of TclOSlstat [Bug #566099, post-rename]
	* unix/tclUnixChan.c:
	* unix/tclUnixPort.h:

	* doc/string.n: Improved documentation for [string last] along
	lines described in Bug #574799 so it indicates that the supplied
	index marks the end of the search space.

2002-06-27  Don Porter  <dgp@@users.sourceforge.net>

	* doc/dde.n:		Work in progress updating the documentation
	* doc/http.n:		of the packages that come bundled with
	* doc/msgcat.n:		the Tcl source distribution, notably tcltest.
	* doc/registry.n:
	* doc/tcltest.n:

	* library/tcltest/tcltest.tcl:  Made sure that the TCLTEST_OPTIONS
	environment variablle configures tcltest at package load time.

2002-06-26  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* tests/fileSystem.test: 
	* generic/tclIOUtil.c: fix to handling of empty paths ""
	which are not claimed by any filesystem (Bug #573758).
	Ensure good error messages are given in all cases.
	* tests/cmdAH.test:
	* unix/tclUnixFCmd.c: fix to bug reported as part of
	(Patch #566669).  Thanks to Taguchi, Takeshi for the report.
	
2002-06-26  Reinhard Max  <max@@suse.de>

	* unix/tclUnixTime.c: Make [clock format] respect locale settings.
	* tests/clock.test:   Bug #565880. ***POTENTIAL INCOMPATIBILITY***

2002-06-26  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/CrtInterp.3:
	* doc/StringObj.3: clarifications by Don Porter, bugs #493995 and
	#500930. 
	
2002-06-24  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:	Corrected suppression of -verbose skip
	* tests/tcltest.test:		and start by [test -output].  Also
	corrected test suite errors exposed by corrected code.  [Bug 564656]
d6320 2
a6321 1
2002-06-25  Reinhard Max  <max@@suse.de>
d6323 1
a6323 4
	* unix/tcl.m4:       New macro SC_CONFIG_MANPAGES.
	* unix/configure.in: Added support for symlinks and compression
	* unix/Makefile.in:  when installing the manpages. [Patch 518052]
	* unix/mkLinks.tcl:  Default is still hardlinks and no compression.
d6325 5
a6329 2
	* unix/mkLinks:      generated
	* unix/configure:
d6331 1
a6331 1
	* unix/README:       Added documentation for the new features.
d6333 2
a6334 2
	* unix/tcl.m4 (SC_PATH_TCLCONFIG): Replaced ${exec_prefix}/lib by
	${libdir}.
d6336 1
a6336 1
2002-06-25  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6338 2
a6339 80
	* generic/tclUtil.c (TclGetIntForIndex): Fix of critical bug
	#533364 generated when the index is bad and the result is a shared
	object.  The T_ASTO(T_GOR, ...) idiom likely exists elsewhere
	though.  Also removed some cruft that just complicated things to
	no advantage.
	(SetEndOffsetFromAny): Same fix, though this wasn't on the path
	excited by the bug.

2002-06-24  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:	Implementation of TIP 101.  Adds
	* tests/parseOld.test:		and exports a [configure] command
	* tests/tcltest.test:		from tcltest.

2002-06-22  Don Porter  <dgp@@users.sourceforge.net>

	* changes: updated changes file for 8.4b1 release.

	* library/tcltest/tcltest.tcl:	Corrections to tcltest and the
	* tests/basic.test:		Tcl test suite so that a test
	* tests/cmdInfo.test:		with options -constraints knownBug
	* tests/compile.test:		-limitConstraints 1 only tests the
	* tests/encoding.test:		knownBug tests.  Mostly involves
	* tests/env.test:		replacing direct access to the
	* tests/event.test:		testConstraints array with calls
	* tests/exec.test:		to the testConstraint command
	* tests/execute.test:		(which requires tcltest version 2)
	* tests/fCmd.test:
	* tests/format.test:
	* tests/http.test:
	* tests/httpold.test:
	* tests/ioUtil.test:
	* tests/link.test:
	* tests/load.test:
	* tests/namespace.test:
	* tests/pkgMkIndex.test:
	* tests/reg.test:
	* tests/result.test:
	* tests/scan.test:
	* tests/stack.test:

2002-06-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tools/tcl.wse.in (Disk Label), unix/tcl.spec (version): 
	* win/README.binary, README, win/configure.in, unix/configure.in: 
	* generic/tcl.h (TCL_RELEASE_*, TCL_PATCH_LEVEL): Bump to beta1.

2002-06-21  Joe English  <jenglish@@users.sourceforge.net>

	* generic/tclCompExpr.c:
	* generic/tclParseExpr.c: LogSyntaxError() should reset 
	the interpreter result [Bug 550142 "Tcl_ExprObj -> abort"] 

2002-06-21  Don Porter  <dgp@@users.sourceforge.net>
	
	* unix/Makefile.in:	Updated all package install directories
	* win/Makefile.in:	to match current Major.minor versions
	* win/makefile.bc:	of the packages.  Added tcltest package
	* win/makefile.vc:	to installation on Windows.

	* library/init.tcl:  Corrected comments and namespace style
	issues.  Thanks to Bruce Stephens. [Bug 572025]

2002-06-21  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* tests/cmdAH.test:          Added TIP#99 implementation
	* tests/fCmd.test:           of 'file link'.  Supports creation
	* tests/fileName.test:       of symbolic and hard links in the
	* tests/fileSystem.test:     native filesystems and in vfs's,
	* generic/tclTest.c:         when the individual filesystem
	* generic/tclCmdAH.c:        supports the concept.
	* generic/tclIOUtil.c:       
	* generic/tcl.h:
	* generic/tcl.decls:
	* doc/FileSystem.3:
	* doc/file.n:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: Also enhanced speed of 'file normalize' on
	Windows.
d6341 2
a6342 1
2002-06-20  Miguel Sofer  <msofer@@users.sourceforge.net>
d6344 1
a6344 3
	* generic/tclBasic.c (TclEvalObjvInternal): fix for [Bug 571385]
	in the implementation of TIP#62 (command tracing). Vince Darley,
	Hemang Lavana & Don Porter: thanks.
d6346 1
a6346 1
2002-06-20  Miguel Sofer  <msofer@@users.sourceforge.net>
d6348 7
a6354 2
	* generic/tclExecute.c (TclCompEvalObj): clarified and simplified
	the logic for compilation/recompilation.
d6356 1
a6356 2
2002-06-19  Joe English  <jenglish@@users.sourceforge.net>
	* doc/file.n: Fixed indentation.  No substantive changes.
d6358 2
a6359 1
2002-06-19  Jeff Hobbs  <jeffh@@ActiveState.com>
d6361 2
a6362 27
	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): get the resultPtr again
	as the Tcl_ObjSetVar2 may cause the result to change.
	[Patch #558324] (watson)

2002-06-19  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TEBC): removing unused "for(;;)" loop;
	improved comments; re-indentation.

2002-06-18  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TEBC): 
	- elimination of duplicated code in the non-immediate INST_INCR
	  instructions. 
	- elimination of 103 (!) TclDecrRefCount macros. The different
	  instructions now jump back to a common "DecrRefCount zone" at
	  the top of the loop. The macro "ADJUST_PC" was replaced by two
	  macros "NEXT_INST_F" and "NEXT_INST_V" that take three params
	  (pcAdjustment, # of stack objects to discard, resultObjPtr
	  handling flag). The only instructions that retain a
	  TclDecrRefCount are INST_POP (for speed), the common code for
	  the non-immediate INST_INCR, INST_FOREACH_STEP and the two
	  INST_LSET.

	The object size of tclExecute.o was reduced by approx 20% since
	the start of the consolidation drive, while making room for some
	peep-hole optimisation at runtime.
d6364 2
a6365 1
2002-06-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d6367 3
a6369 2
	* generic/tclExecute.c (TEBC, INST_DONE): small bug in the panic
	code for tcl-stack corruption.
d6371 1
a6371 1
2002-06-17  David Gravereaux <davygrvy@@pobox.com>
d6373 5
a6377 2
	Trims to support the removal of RESOURCE_INCLUDED from rc
	scripts	from FR #565088.
d6379 1
a6379 2
	* generic/tcl.h: moved the #ifndef RC_INVOKED start block up in
	the file.  rc scripts don't need to know thread mutexes.
d6381 3
a6383 3
	* win/tcl.rc:
	* win/tclsh.rc: removed the #define RESOURCE_INCLUDED to let the
	built-in -DRC_INVOKED to the work.
d6385 2
a6386 1
2002-06-17  Jeff Hobbs  <jeffh@@ActiveState.com>
d6388 6
a6393 74
	* doc/CrtTrace.3:        Added TIP#62 implementation of command
	* doc/trace.n:           execution tracing [FR #462580] (lavana).
	* generic/tcl.h:         This includes enter/leave tracing as well
	* generic/tclBasic.c:    as inter-procedure stepping.
	* generic/tclCmdMZ.c:
	* generic/tclCompile.c:
	* generic/tclExecute.c:
	* generic/tclInt.decls:
	* generic/tclInt.h:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclVar.c:
	* tests/trace.test:

2002-06-17  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* win/tclWinPipe.c (BuildCommandLine): Fixed bug #554068 ([exec]
	  on windows did not treat { in filenames well.). Bug reported by
	  Vince Darley <vincentdarley@@users.sourceforge.net>, patch
	  provided by Vince too.

2002-06-17  Joe English  <jenglish@@users.sourceforge.net>

	* generic/tcl.h: #ifdef logic for K&R C backwards compatibility
	changed to assume modern C by default.  See SF FR #565088 for
	full details.

2002-06-17  Don Porter  <dgp@@users.sourceforge.net>

	* doc/msgcat.n: Corrected en_UK references to en_GB.  UK is not
	a country designation recognized in ISO 3166.

	* library/msgcat/msgcat.tcl:  More Windows Registry locale codes
	from Bruno Haible.

	* doc/msgcat.n:
	* library/msgcat/msgcat.tcl:
	* library/msgcat/pkgIndex.tcl:
	* tests/msgcat.test:  Revised locale initialization to interpret
	environment variable locale values according to XPG4, and to
	recognize the LC_ALL and LC_MESSAGES values over that of LANG.
	Also added many Windows Registry locale values to those 
	recognized by msgcat.  Revised tests and docs.  Bumped to
	version 1.3.  Thanks to Bruno Haible for the report and
	assistance crafting the solution.  [Bug 525522, 525525]

2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.c (TclCompileTokens): a better algorithm for
	the previous bug fix.

2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompile.c (TclCompileTokens): 
	* tests/compile.test: [Bug 569438] in the processing of dollar
	variables; report by Georgios Petasis. 
	
2002-06-16  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: bug in the consolidation of the
	INCR_..._STK instructions; the bug could not be exercised as the
	(faulty) instruction INST_INCR_ARRAY_STK was never compiled-in
	(related to [Bug 569438]).

2002-06-14  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TclExecuteByteCode): runtime peep-hole
	optimisation of variables (INST_STORE, INST_INCR) and commands
	(INST_INVOKE); faster check for the existence of a catch.
	(TclExecuteByteCode): runtime peep-hole optimisation of
	comparisons.
	(TclExecuteByteCode): runtime peep-hole optimisation of
	INST_FOREACH - relies on peculiarities of the code produced by the
	bytecode compiler.
d6395 1
a6395 1
2002-06-14  David Gravereaux <davygrvy@@pobox.com>
d6397 1
a6397 3
	* win/rules.vc: The test for compiler optimizations was in error.
	Thanks goes to Roy Terry <royterry@@earthlink.net> for his
	assistance with this.
d6399 2
a6400 1
2002-06-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6402 2
a6403 58
	* doc/trace.n, tests/trace.test: 
	* generic/tclCmdMZ.c (Tcl_TraceObjCmd,TclTraceCommandObjCmd)
	(TclTraceVariableObjCmd): Changed references to "trace list" to
	"trace info" as mandated by TIP#102.

2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TclExecuteByteCode): consolidated code for
	the conditional branch instructions.

2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TclExecuteByteCode): fixed the previous
	patch - wouldn't compile with TCL_COMPILE_DEBUG set.

2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TclExecuteByteCode): consolidated the
	handling of exception returns to INST_INVOKE and INST_EVAL, as
	well as most of the code for INST_CONTINUE and INST_BREAK, in the
	new jump target "processExceptionReturn".

2002-06-13  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c (TclExecuteByteCode): consolidated variable
	handling opcodes, replaced redundant code with some 'goto'. All
	store/append/lappend opcodes on the same data type now share the
	main code; same with incr opcodes.
	* generic/tclVar.c: added the bit TCL_TRACE_READS to the possible
	flags to Tcl_SetVar2Ex - it causes read traces to be fired prior
	to setting the variable. This is used in the core for [lappend].

	***NOTE*** the usage of TCL_TRACE_READS in Tcl_(Obj)?GetVar.* is
	not documented; there, it causes the call to create the variable
	if it does not exist. The new usage in Tcl_(Obj)?SetVar.* remains
	undocumented too ...
	
2002-06-13  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* tests/fCmd.test:
	* tests/winFile.test:
	* tests/fileSystem.test:
	* generic/tclTest.c:
	* generic/tclCmdAH.c:
	* generic/tclIOUtil.c:
	* doc/FileSystem.3:
	* mac/tclMacFile.c:
	* unix/tclUnixFile.c:
	* win/tclWinFile.c: fixed up further so both compiles and
	actually works with VC++ 5 or 6.
	* win/tclWinInt.h: 
	* win/tclWin32Dll.c: cleaned up code and vfs tests and
	added tests for the internal changes of 2002-06-12, to see
	whether WinTcl on NTFS can coexist peacefully with links
	in the filesystem.  Added new test command 'testfilelink'
	to enable the newer code to be tested.
	* tests/fCmd.test: (made certain tests of 'testfilelink' not
	run on unix).
d6405 1
a6405 1
2002-06-12  Miguel Sofer  <msofer@@users.sourceforge.net>
d6407 1
a6407 4
	* tclBasic.c (Tcl_DeleteTrace): fixed [Bug 568123] (thanks to
	Hemang Lavana)
	
2002-06-12  Jeff Hobbs  <jeffh@@ActiveState.com>
d6409 1
a6409 205
	* win/tclWinFile.c: corrected the symbolic link handling code to
	allow it to compile.  Added real definition of REPARSE_DATA_BUFFER
	(found in winnt.h).  Most of the added definitions appear to have
	correct, cross-Win-version equivalents in winnt.h and should be
	removed, but just making things "work" for now.

2002-06-12  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclIOUtil.c:
	* generic/tcl.decls:
	* generic/tclDecls.h: made code for Tcl_FSNewNativePath
	agree with man pages.
	
	* doc/FileSystem.3: clarified the circumstances under which
	certain functions are called in the presence of symlinks.
	
	* win/tclWinFile.c:
	* win/tclWinPort.h: 
	* win/tclWinInt.h: 
	* win/tclWinFCmd.c:  Fix for Windows to allow 'file lstat', 
	'file type', 'glob -type l', 'file copy', 'file delete', 
	'file normalize', and all VFS code to work correctly in the 
	presence of symlinks (previously Tcl's behaviour was not very 
	well defined).  This also fixes possible serious problems in 
	all versions of WinTcl where 'file delete' on a NTFS symlink 
	could delete the original, not the symlink.
	Note: symlinks cannot yet be created in pure Tcl.

2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c: 
	* generic/tclCompCmds.c:
	* generic/tclInt.h: reverted the new compilation functions;
	replaced by a more general approach described below.

	* generic/tclCompCmds.c:
	* generic/tclCompile.c: made *all* compiled variable access
	attempts create an indexed variable - even get or incr without
	previous set. This allows indexed access to local variables that
	are created and set at runtime, for example by [global], [upvar],
	[variable], [regexp], [regsub].

2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/global.n:
	* doc/info.n:
	* test/info.test:
	* generic/tclCmdIL.c: fix for [Bug 567386], [info locals] was
	reporting some linked variables.
	
	* generic/tclBasic.c: 
	* generic/tclCompCmds.c:
	* generic/tclInt.h: added compile functions for [global],
	[variable] and [upvar]. They just declare the new local variables,
	the commands themselves are not compiled-in. This gives a notably
	faster read access to these linked variables.

2002-06-11  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: optimised algorithm for exception range
	lookup; part of [Patch 453709].

2002-06-10  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* unix/tclUnixFCmd.c: fixed [Bug #566669]
	* generic/tclIOUtil.c: improved and sped up handling of
	native paths (duplication and conversion to normalized paths),
	particularly on Windows.
	* modified part of above commit, due to problems on Linux. 
	Will re-examine bug report and evaluate more closely.

2002-06-07  Don Porter  <dgp@@users.sourceforge.net>

	* tests/tcltest.test:  More corrections to test suite so that tests
	of failing [test]s don't show up themselves as failing tests.

2002-06-07  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclExecute.c: Tidied up headers in relation to float.h
	to cut the cruft and ensure DBL_MAX is defined since doubles seem
	to be the same size everywhere; if the assumption isn't true, the
	variant platforms had better have run configure...

	* unix/tclUnixPort.h (EOVERFLOW): Added code to define it if it
	wasn't previously defined.  Also some other general tidying and
	adding of comments.  [Tcl bugs 563122, 564595]
	* compat/tclErrno.h: Added definition for EOVERFLOW copied from
	Solaris headers; I've been unable to find any uses of EFTYPE,
	which was the error code previously occupying the slot, in Tcl, or
	any definition of it in the Solaris headers.

2002-06-06  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/dltest/Makefile.in: Remove hard coded CFLAGS=-g
	and add CFLAGS_DEBUG, CFLAGS_OPTIMIZE, and
	CFLAGS_DEFAULT varaibles. [Tcl bug 565488]

2002-06-06  Don Porter  <dgp@@users.sourceforge.net>

	* tests/tcltest.test:  Corrections to test suite so that tests
	of failing [test]s don't show up themselves as failing tests.

	* tests/io.test: Fixed up namespace variable resolution issues
	revealed by running test suite with "-singleproc 1".

	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test: Several updates to tcltest.
	  1) changed to lazy initialization of test constraints
	  2) deprecated [initConstraintsHook]
	  3) repaired badly broken [limitConstraints].
	  4) deprecated [threadReap] and [mainThread]
	[Patch 512214, Bug 558742, Bug 461000, Bug 534903]

2002-06-06  Daniel Steffen  <das@@users.sourceforge.net>

	* unix/tclUnixThrd.c (TclpReaddir, TclpLocaltime, TclpGmtime):
	added mutex wrapped calls to readdir, localtime & gmtime in
	case their thread-safe *_r counterparts are not available.
	* unix/tcl.m4: added configure check for readdir_r
	* unix/tcl.m4 (Darwin): set TCL_DEFAULT_ENCODING to utf-8 on
	MacOSX (where posix file apis expect utf-8, not iso8859-1).   
	* unix/configure: regen
	* unix/Makefile.in: set DYLD_LIBRARY_PATH in parallel       
	to LD_LIBRARY_PATH for MacOSX dynamic linker.
	* generic/tclEnv.c (TclSetEnv): fix env var setting on
	MacOSX (adapted from patch #524352 by jkbonfield).

2002-06-05  Don Porter  <dgp@@users.sourceforge.net>

	* doc/Tcl_Main.3: Documented $tcl_rcFileName and added more
	clarifications about the intended use of Tcl_Main(). [Bug 505651]

2002-06-05  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclFileName.c (TclGlob): mac specific fix to
	recent changes in 'glob -tails' handling.
	* mac/tclMacPort.h:
	* mac/tclMacChan.c: fixed TIP#91 bustage.
	* mac/tclMacResource.c (Tcl_MacConvertTextResource): added utf
	conversion of text resource contents.
	* tests/macFCmd.test (macFCmd-1.2): allow CWIE creator.

2002-06-04  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:
	* tests/init.test:
	* tests/tcltest.test:	Added more TIP 85 tests from Arjen Markus.
	Converted tcltest.test to use a private namespace.  Fixed bugs in
	[tcltest::Eval] revealed by calling [tcltest::test] from a non-global
	namespace, and namespace errors in init.test.

2002-06-04  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/README: Update msys+mingw URL.

2002-06-03  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* library/tcltest/pkgIndex.tcl:
	* tests/tcltest.test:  Implementation of TIP 85.  Allows tcltest
	users to add new legal values of the -match option to [test],
	associating each with a Tcl command that does the matching of
	expected results with actual results of tests.  Thanks to
	Arjen Markus.  => tcltest 2.1 [Patch 521362]

2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/namespace.n: added description of [namepace forget]
	behaviour for unqualified patterns [Bug 559268]

2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclExecute.c: reverting an accidental modification in
	the last commit.
	
2002-06-03  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/Tcl.n: clarify the empty variable name issue ([Bug 549285]
	reported by Tom Krehbiel, patch by Don Porter).

2002-05-31  Don Porter  <dgp@@users.sourceforge.net>

	* library/package.tcl:  Fixed leak of slave interp in [pkg_mkIndex].
	Thanks to Helmut for report.  [Bug 550534]

	* tests/io.test:
	* tests/main.test:  Use the "stdio" constraint to control whether
	an [open "|[interpreter]"] is attempted.

	* generic/tclExecute.c (TclMathInProgress,TclExecuteByteCode
		ExprCallMathFunc):
	* generic/tclInt.h (TclMathInProgress):
	* unix/Makefile.in (tclMtherr.*):
	* unix/configure.in (NEED_MATHERR):
	* unix/tclAppInit.c (matherr):
	* unix/tclMtherr.c (removed file):
	* win/tclWinMtherr.c (_matherr): Removed internal routine
	TclMathInProgress and Unix implementation of matherr().  These
	are now obsolete, dealing with very old versions of the C math
	library.  Windows version is retained in case Borland compilers
	require it, but it is inactive.  Thanks to Joe English.
	[Bug 474335, Patch 555635].
	* unix/configure: regen
d6411 1
a6411 1
2002-05-30  Miguel Sofer  <msofer@@users.sourceforge.net>
d6413 2
a6414 15
	* generic/tclCompExpr.c:
	* generic/tclCompile.c:
	* generic/tclCompile.h: removed exprIsJustVarRef and
	exprIsComparison from the ExprInfo and CompileEnv structs. These
	were set, but not used since dec 1999 [Bug 562383].

2002-05-30  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c (TclGlob): fix to longstanding
	'knownBug' in fileName tests 15.2-15.4, and fix to a new
	Tcl 8.4 bug in certain uses of 'glob -tails'.
	* tests/fileName.test: removed 'knownBug' flag from some tests,
	added some new tests for above bugs.
	
2002-05-29  Jeff Hobbs  <jeffh@@ActiveState.com>
d6416 1
a6416 139
	* unix/configure: regen'ed
	* unix/configure.in: replaced bigendian check with autoconf
	standard AC_C_BIG_ENDIAN, which defined WORDS_BIGENDIAN on
	bigendian systems.
	* generic/tclUtf.c (Tcl_UniCharNcmp): 
	* generic/tclInt.h (TclUniCharNcmp): use WORDS_BIGENDIAN instead of
	TCL_OPTIMIZE_UNICODE_COMPARE to enable memcmp alternative.

	* generic/tclExecute.c (TclExecuteByteCode INST_STR_CMP):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): changed the case for
	choosing the Tcl_UniCharNcmp compare to when both objs are of
	StringType, as benchmarks show that is the optimal check (both
	bigendian and littleendian systems).

2002-05-29  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclMain.c: Removed "dummy" reference to Tcl_LinkVar.
	It is no longer needed since Tcl_Main() now actually calls
	Tcl_LinkVar().  Thanks to Joe English for pointing that out.

2002-05-29  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tclExecute.c (TclExecuteByteCode): 
	* generic/tclCmdMZ.c (Tcl_StringObjCmd): Use the macro version.
	* generic/tclInt.h (TclUniCharNcmp): Optimised still further with
	a macro for use in sensitive places like tclExecute.c

	* generic/tclUtf.c (Tcl_UniCharNcmp): Use new flag to figure out
	when we can use an optimal comparison scheme, and default to the
	old scheme in other cases which is at least safe.
	* unix/configure.in (TCL_OPTIMIZE_UNICODE_COMPARE): New optional
	flag that indicates when we can use memcmp() to compare Unicode
	strings (i.e. when the high-byte of a Tcl_UniChar precedes the
	low-byte.)

2002-05-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c:
	* generic/tclUtf.c: added TclpUtfNcmp2 private command that
	mirrors Tcl_UtfNcmp, but takes n in bytes, not utf-8 chars.  This
	provides a faster alternative for comparing utf strings	internally.
	(Tcl_UniCharNcmp, Tcl_UniCharNcasecmp): removed the explicit end
	of string check as it wasn't correct for the function (by doc and
	logic).

	* generic/tclCmdMZ.c (Tcl_StringObjCmd): reworked the string equal
	comparison code to use TclpUtfNcmp2 as well as short-circuit for
	equal objects or unequal length strings in the equal case.
	Removed the use of goto and streamlined the other parts.

	* generic/tclExecute.c (TclExecuteByteCode): added check for
	object equality in the comparison instructions.  Added
	short-circuit for != length strings in INST_EQ, INST_NEQ and
	INST_STR_CMP.  Reworked INST_STR_CMP to use TclpUtfNcmp2 where
	appropriate, and only use Tcl_UniCharNcmp when at least one of the
	objects is a Unicode obj with no utf bytes.

	* generic/tclCompCmds.c (TclCompileStringCmd): removed error
	creation in code that no longer throws an error.

	* tests/string.test:
	* tests/stringComp.test: added more string comparison checks.

	* tests/clock.test: better qualified 9.1 constraint check for %s.

2002-05-28  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclThreadAlloc.c (TclpRealloc, TclpFree): protect
	against the case when NULL is based.

	* tests/clock.test: added clock-9.1
	* compat/strftime.c:
	* generic/tclClock.c:
	* generic/tclInt.decls:
	* generic/tclIntDecls.h:
	* unix/tclUnixTime.c: fix for Windows msvcrt mem leak caused by
	using an env(TZ) setting trick for in clock format -gmt 1.  This
	also makes %s seem to work correctly with -gmt 1 as well as
	making it a lot faster by avoid the env(TZ) hack.  TclpStrftime
	now takes useGMT as an arg.  [Bug #559376]

2002-05-28  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclIOUtil.c: fixes to Tcl_FSLoadFile when called on
	a file inside a vfs.  This should avoid leaving temporary 
	files sitting around on exit. [Bug #545579]
	
2002-05-27  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* win/tclWinError.c: Added comment on conversion of
	ERROR_NEGATIVE_SEEK because that is a mapping that really belongs,
	and not a catch-all case.
	* win/tclWinPort.h (EOVERFLOW): Should be either EFBIG or EINVAL
	* generic/tclPosixStr.c (Tcl_ErrnoId, Tcl_ErrnoMsg): EOVERFLOW can
	potentially be a synonym for EINVAL.

2002-05-24  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	=== Changes due to TIP#91 ===

	* win/tclWinPort.h: Added declaration of EOVERFLOW.
	* doc/CrtChannel.3: Added documentation of wideSeekProc.
	* generic/tclIOGT.c (TransformSeekProc, TransformWideSeekProc):
	Adapted to use the new channel mechanism.
	* unix/tclUnixChan.c (FileSeekProc, FileWideSeekProc): Renamed
	FileSeekProc to FileWideSeekProc and created new FileSeekProc
	which has the old-style interface and which errors out with
	EOVERFLOW when the returned file position can't fit into the
	return type (int for historical reasons.)
	* win/tclWinChan.c (FileSeekProc, FileWideSeekProc): Renamed
	FileSeekProc to FileWideSeekProc and created new FileSeekProc
	which has the old-style interface and which errors out with
	EOVERFLOW when the returned file position can't fit into the
	return type (int for historical reasons.)
	* mac/tclMacChan.c (FileSeek): Reverted to old interface; Macs
	lack large-file support because I can't see how to add it.
	* generic/tclIO.c (Tcl_Seek, Tcl_Tell): Given these functions
	knowledge of the new arrangement of channel types.
	(Tcl_ChannelVersion): Added recognition of new version code.
	(HaveVersion): New function to do version checking.
	(Tcl_ChannelBlockModeProc, Tcl_ChannelFlushProc)
	(Tcl_ChannelHandlerProc): Made these functions use HaveVersion for
	ease of future maintainability.
	(Tcl_ChannelBlockModeProc): Obvious lookup function.
	* generic/tcl.h (Tcl_ChannelType): New wideSeekProc field, and
	seekProc type restored to old interpretation.
	(TCL_CHANNEL_VERSION_3): New channel version.

2002-05-24  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
	
	* tests/winPipe.test: Applied patch for SF Tcl Bug #549617. Patch
	  and bug report by Kevin Kenny <kennykb@@users.sourceforge.net>.

	* win/tclWinSock.c (TcpWatchProc): Fixed SF Tcl Bug #557878. We
	  are not allowed to mess with the watch mask if the socket is a
	  server socket. I believe that the original reporter is George
	  Peter Staplin.
d6418 2
a6419 1
2002-05-21  Mo DeJong  <mdejong@@users.sourceforge.net>
d6421 2
a6422 7
	* unix/configure: Regen.
	* unix/configure.in: Invoke SC_ENABLE_SHARED before
	calling SC_CONFIG_CFLAGS so that the SHARED_BUILD
	variable can be checked inside SC_CONFIG_CFLAGS.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Pass -non_shared
	instead of -shared to ld when configured with
	--disable-shared under OSF. [Tcl bug 540390]
d6424 1
a6424 1
2002-05-20  Daniel Steffen  <das@@users.sourceforge.net>
d6426 1
a6426 3
	* generic/tclInt.h: added prototype for TclpFilesystemPathType().
	* mac/tclMacChan.c: use MSL provided creator type if available
	instead of the default 'MPW '.
d6428 2
a6429 1
2002-05-16  Joe English  <jenglish@@users.sf.net>
d6431 3
a6433 3
	* doc/CrtObjCmd.3: 
	Added Tcl_GetCommandFromObj, Tcl_GetCommandFullName
	(Tcl Bug #547987, #414921)
d6435 2
a6436 1
2002-05-14  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6438 3
a6440 3
	* unix/tclUnixChan.c (TtyOutputProc): #if/#endif-ed this function
	out to stop compiler warnings.  Also much general tidying of
	comments in this file and removal of whitespace from blank lines.
d6442 2
a6443 1
2002-05-13  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6445 1
a6445 4
	* unix/tclUnixChan.c (SETBREAK): Solaris thinks ioctl() takes a
	signed second argument, and Linux thinks ioctl() takes an unsigned
	second argument.  So need a longer definition of this macro to get
	neither to spew warnings...
d6447 1
a6447 1
2002-05-13  Vince Darley  <vincentdarley@@users.sourceforge.net>
d6449 2
a6450 10
	* generic/tclEvent.c: 
	* generic/tclIOUtil.c:
	* generic/tclInt.h: clean up all memory allocated by the
	filesystem, via introduction of 'TclFinalizeFilesystem'.
	Move TclFinalizeLoad into TclFinalizeFilesystem so we can
	be sure it is called at just the right time.
	Fix bad comment also.  [Bug #555078 and 'fs' part of #543549]
	* win/tclWinChan.c: fix comment referring to wrong function.
	
2002-05-10  Don Porter  <dgp@@users.sourceforge.net>
d6452 2
a6453 23
	* tests/load.test:
	* tests/safe.test:
	* tests/tcltest.test: Corrected some list-quoting issues and
	other matters that cause tests to fail when the patch includes
	special characters.  Report from Vince Darley.  [Bug 554068].

2002-05-08    David Gravereaux <davygrvy@@pobox.com>

	* doc/file.n:
	* tools/man2tcl.c:
	* tools/man2help2.tcl:  Thanks to Peter Spjuth
	<peter.spjuth@@space.se>, again.  My prior fix for
	single-quote macro mis-understanding was wrong.	 Reverted to
	reimpliment the 'macro2' proc which handles single-quote macros
	and restored file.n text arrangement to avoid single-quotes on
	the first line.  Sorry for all the confusion.

2002-05-08  David Gravereaux <davygrvy@@pobox.com>

	* tools/man2tcl.c:
	* tools/man2help2.tcl: Proper source of macro error mis-
	understanding single-quote as the leading macro command found
	and repaired.
d6455 1
a6455 2
	* doc/file.n: Reverted to prior state before I messed with
	it.
d6457 2
a6458 1
2002-05-08  Don Porter  <dgp@@users.sourceforge.net>
d6460 5
a6464 66
	* library/tcltest/tcltest.tcl: Corrected [uplevel] quoting when
	[source]-ing test script in subdirectories.
	* tests/fileName.test:
	* tests/load.test:
	* tests/main.test:
	* tests/tcltest.test: 
	* tests/unixInit.test: Fixes to test suite when there's a space
	in the working path.  Thanks to Kevin Kenny.

2002-05-07  David Gravereaux <davygrvy@@pobox.com>

	-- Changes from Peter Spjuth <peter.spjuth@@space.se>
	* tools/man2tcl.c: Increased line buffer size and a bail-out if
	that should ever be over-run.
	* tools/man2help.tcl: Include Courier New font in rtf header.
	* tools/man2help2.tcl: Improved handling of CS/CE fields.  Use
	Courier New for code samples and indent better.

	* doc/file.n:
	* doc/TraceCmd.3:  winhelp conversion tools where understanding
	a ' as the first character on a line to be an unknown macro.
	Not knowing how to repair tools/man2tcl.c, I decided to rearrange
	the text in the docs instead.

2002-05-07  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c: fix to similar segfault when using 
	'glob -types nonsense -dir dirname -join * *'. [Bug 553320]
	
	* doc/FileSystem.3: further documentation on vfs.
	* tests/cmdAH.test:
	* tests/fileSystem.test:
	* tests/pkgMkindex.test: Fix to testsuite bugs when running out
	of directory whose name contains '{' or '['.

2002-05-07  Miguel Sofer  <msofer@@users.sourceforge.net>

	* tests/basic.test: Fix for [Bug 549607]
	* tests/encoding.test: Fix for [Bug 549610]
	These are testsuite bugs that caused failures when the filename
	contained spaces. Report & fix by Kevin Kenny.

2002-05-02  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFileName.c: fix to freeing a bad object 
	(i.e. segfault) when using 'glob -types nonsense -dir dirname'.
	* generic/tclWinFile.c: fix to [Bug 551306], also wrapped some 
	long lines.
	* tests/fileName.test: added several tests for the above bugs.
	* doc/FileSystem.3: clarified documentation on refCount
	requirements of the object returned by the path type function.
	* generic/tclIOUtil.c:
	* win/tclWinFile.c:
	* unix/tclUnixFile.c:
	* mac/tclMacFile.c: moved TclpFilesystemPathType to the
	platform specific directories, so we can add missing platform-
	specific implementations.  On Windows, 'file system' now returns 
	useful results like "native NTFS", "native FAT" for that system.  
	Unix and MacOS still only return "native".
	* doc/file.n: clarified documentation.
	* tests/winFile.test: test for 'file system' returning correct
	values.
	* tests/fileSystem.test: test for 'file system' returning correct
	values.  Clean up after failed previous test run.
	
2002-04-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d6466 1
a6466 3
	* unix/configure:
	* unix/tcl.m4: change HP-11 SHLIB_LD_LIBS from "" to ${LIBS} so
	that the .sl knows its dependent libs.
d6468 17
a6484 1
2002-04-26  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6486 1
a6486 4
	* tests/obj.test (obj-11.[56]): Test conversion to boolean more
	thoroughly.
	* generic/tclObj.c (SetBooleanFromAny): Was not calling an integer
	parsing function on native 64-bit platforms!  [Bug 548686]
d6488 1
a6488 1
2002-04-24  Jeff Hobbs  <jeffh@@ActiveState.com>
d6490 3
a6492 3
	* generic/tclInt.h: corrected TclRememberJoinableThread decl to
	use VOID instead of void.
	* generic/tclThreadJoin.c: noted that this code isn't needed on Unix.
d6494 1
a6494 1
2002-04-23  Jeff Hobbs  <jeffh@@ActiveState.com>
d6496 1
a6496 2
	* doc/exec.n: 
	* doc/tclvars.n: doc updates [Patch #509426] (gravereaux)
d6498 5
a6502 1
2002-04-24  Daniel Steffen  <das@@users.sourceforge.net>
d6504 1
a6504 4
	* mac/tclMacResource.r: added check of
	TCLTK_NO_LIBRARY_TEXT_RESOURCES #define to allow disabling the
	inclusion of the tcl library code in the resource fork of Tcl
	executables and shared libraries.
d6506 2
a6507 1
2002-04-23  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6509 1
a6509 2
	* doc/TraceCmd.3: New file that documents Tcl_CommandTraceInfo,
	Tcl_TraceCommand and Tcl_UntraceCommand [Bug 414927]
d6511 2
a6512 1
2002-04-22  Jeff Hobbs  <jeffh@@ActiveState.com>
d6514 3
a6516 13
	* generic/tclAlloc.c:
	* generic/tclInt.h:
	* generic/tclThreadAlloc.c (new):
	* unix/Makefile.in:
	* unix/tclUnixThrd.c:
	* win/Makefile.in:
	* win/tclWinInt.h:
	* win/tclWinThrd.c: added new threaded allocator contributed by
	AOL that significantly reduces lock contention when multiple
	threads are in use.  Only Windows and Unix implementations are
	ready, and the Windows one may need work.  It is only used by
	default on Unix for now, and requires that USE_THREAD_ALLOC be
	defined (--enable-threads on Unix will define this).
d6518 1
a6518 3
	* generic/tclIOUtil.c (Tcl_FSRegister, Tcl_FSUnregister):
	corrected calling of Tcl_ConditionWait to ensure that there would
	be a condition to wait upon.
d6520 7
a6526 1
	* generic/tclCmdAH.c (Tcl_FileObjCmd): added cast in FILE_SIZE.
d6528 1
a6528 2
	* win/tclWinFCmd.c (DoDeleteFile): check return of setattr API
	calls in file deletion for correct Win32 API handling.
d6530 1
a6530 2
	* win/Makefile.in: correct dependencies for shell, gdb, runtest
	targets.
d6532 1
a6532 4
	* doc/clock.n:
	* compat/strftime.c (_fmt): change strftime to correctly handle
	localized %c, %x and %X on Windows.  Added some notes about how
	the other values could be further localized.
d6534 28
a6561 1
2002-04-19  Don Porter  <dgp@@users.sourceforge.net>
d6563 1
a6563 2
	* generic/tclMain.c (Tcl_Main):  Free the memory allocated for the
	startup script path.  [Bug 543549]
d6565 2
a6566 4
	* library/msgcat/msgcat.tcl:  [mcmax] wasn't using the caller's
	namespace when determining the max translated length.  Also
	made revisions for better use of namespace variables and more
	efficient [uplevel]s.
d6568 1
a6568 4
	* doc/msgcat.n:
	* library/msgcat/msgcat.tcl:
	* library/msgcat/pkgIndex.tcl:  Added [mcload] to the export list
	of msgcat; bumped to 1.2.3.  [Bug 544727]
d6570 2
a6571 1
2002-04-20  Daniel Steffen  <das@@users.sourceforge.net>
d6573 1
a6573 11
	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* generic/tclStubInit.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacUtil.c: Modified TclpObjNormalizePath to be alias
	file aware, and replaced various calls to FSpLocationFrom*Path
	by calls to new alias file aware versions FSpLLocationFrom*Path.
	The alias file aware routines don't resolve the last component of
	a path if it is an alias. This allows [file copy/delete] etc. to
	act correctly on alias files. (c.f. discussion in Bug #511666)
d6575 1
a6575 1
2002-04-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6577 5
a6581 3
	* tests/lindex.test (lindex-3.7): 
	* generic/tclUtil.c (TclGetIntForIndex): Stopped indexes from
	hitting wide ints.  [Bug #526717]
d6583 1
a6583 1
2002-04-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d6585 6
a6590 3
	* generic/tclNamesp.c:
	* tests/info.test: [Bug 545325] info level didn't report
	namespace eval, bug report by Richard Suchenwirth.
d6592 4
a6595 1
2002-04-18  Don Porter  <dgp@@users.sourceforge.net>
d6597 1
a6597 3
	* doc/subst.n:  Clarified documentation on handling unusual return
	codes during substitution, and on variable substitutions implied
	by command substitution, and vice versa.  [Bug 536838]
d6599 7
a6605 1
2002-04-18  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6607 1
a6607 3
	* generic/tclCmdIL.c (InfoBodyCmd): 
	* tests/info.test (info-2.6): Proc bodies without string reps
	would report as empty [Bug #545644]
d6609 5
a6613 4
	* generic/tclCmdMZ.c (Tcl_SubstObj): More clarification for
	comment on behaviour when substitutions are not well-formed,
	prompted by [Bug #536831]; alas, removing the ill-defined
	behaviour is a lot of work.
d6615 2
a6616 1
2002-04-18  Miguel Sofer  <msofer@@users.sourceforge.net>
d6618 1
a6618 4
	* generic/tclExecute.c:
	* tests/expr-old.test: fix for [Bug #542588] (Phil Ehrens), where
	"too large integers" were reported as "floating-point value" in
	[expr] error messages.
d6620 1
a6620 1
2002-04-17  Jeff Hobbs  <jeffh@@ActiveState.com>
d6622 1
a6622 4
	* generic/tclEncoding.c (EscapeFromUtfProc): 
	* generic/tclIO.c (WriteChars, Tcl_Close): corrected the handling
	of outputting end escapes for escape-based encodings.
	[Bug #526524] (yamamoto)
d6624 4
a6627 1
2002-04-17  Don Porter  <dgp@@users.sourceforge.net>
d6629 1
a6629 4
	* doc/tcltest.n:  Removed [saveState] and [restoreState] from
	tcltest 2 documentation, effectively deprecating them.  [Bug 495660]
	* library/tcltest/tcltest.tcl: Made separate export for commands
	kept only for tcltest 1 compatibility.
d6631 4
a6634 3
	* tests/iogt.test: Revised to run tests in a namespace, rather than
	use the useless and buggy [saveState] and [restoreState] commands
	of tcltest.  Updated to use tcltest 2 as well.  [Patch 544911]
d6636 3
a6638 1
2002-04-16  Don Porter  <dgp@@users.sourceforge.net>
d6640 1
a6640 3
	* tests/io.test: Revised to run tests in a namespace, rather than
	use the useless and buggy [saveState] and [restoreState] commands
	of tcltest.  Updated to use tcltest 2 as well.  [Patch 544546]
d6642 1
a6642 1
2002-04-15  Miguel Sofer  <msofer@@users.sourceforge.net>
d6644 8
a6651 4
	* generic/tclProc.c:
	* tests/proc-old.test: Improved stack trace for TCL_BREAK and
	TCL_CONTINUE returns from procs. Patch by Don Porter
	[Bug 536955]. 
d6653 1
a6653 4
	* generic/tclExecute.c:
	* tests/compile.test: made bytecodes check for a catch before
	  returning; the compiled [return] is otherwise non-catchable. 
	  [Bug 542142] reported by Andreas Kupries.
d6655 1
a6655 1
2002-04-15  Don Porter  <dgp@@users.sourceforge.net>
d6657 1
a6657 2
	* tests/socket.test:  Increased timeout values so that tests have
	time to successfully complete even on slow/busy machines.  [Bug 523470]
d6659 6
a6664 7
	* doc/tcltest.n:
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test:  Revised [tcltest::test] to return errors
	when called with invalid syntax and to accept exactly two arguments
	as documented.  Improved error messages.  [Bug 497446, Patch 513983]
	***POTENTIAL INCOMPATIBILITY***: Incompatible with previous
	tcltest 2.* releases, found only in alpha releases of Tcl 8.4.
d6666 1
a6666 1
2002-04-11  Jeff Hobbs  <jeffh@@ActiveState.com>
d6668 1
a6668 2
	* generic/tclNotify.c (TclFinalizeNotifier): remove remaining
	unserviced events on finalization.
d6670 7
a6676 4
	* win/tcl.m4: Enabled COFF as well as CV style debug info with
	--enable-symbols to allow Dr. Watson users to see function info.
	More info on debugging levels can be obtained at:
	http://msdn.microsoft.com/library/en-us/dnvc60/html/gendepdebug.asp
d6678 1
a6678 1
	* tests/ioCmd.test: fixed iocmd-8.15 to have mac and unixPc variants.
d6680 1
a6680 2
	* generic/tclParse.c (Tcl_ParseVar): conditionally incr obj
	refcount to prevent possible mem leak.
d6682 1
a6682 1
2002-04-08  Daniel Steffen  <das@@users.sourceforge.net>
d6684 2
a6685 72
	* generic/tcl.h: no <sys/types.h> on mac.
	* mac/tclMacFile.c: minor fixes to Vince's changes from 03-24.
	* mac/tclMacOSA.c:
	* mac/tclMacResource.c: added missing Tcl_UtfToExternalDString
	conversions of resource file names.
	* mac/tclMacSock.c (TcpGetOptionProc): fixed bug introduced
	by Andreas on 02-25; changed strcmp's to strncmp's so that
	option comparison behaves like on other platforms.
	* mac/tcltkMacBuildSupport.sea.hqx (CW Pro6 changes): added
	support to allow Tk to hookup C library stderr/stdout to TkConsole.
	* tests/basic.test:
	* tests/cmdAH.test:
	* tests/encoding.test:
	* tests/fileSystem.test:
	* tests/ioCmd.test: fixed tests failing on mac: check for 
	existence of [exec], changed some result strings.

2002-04-06  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/tclUnixFCmd.c (Realpath): added a little extra code to
	initialize a realpath arg when compiling in PURIFY mode in order
	to prevent spurious purify warnings.  We should really create our
	own realpath implementation, but this will at least quiet purify
	for now.

2002-04-05  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclCmdMZ.c (Tcl_SubstObj):
	* tests/subst.test:  Corrected [subst] so that return codes
	TCL_BREAK and TCL_CONTINUE returned by variable substitution
	have the same effect as when those codes are returned by command
	substitution.  [Bug 536879]

2002-04-03  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/tcltest/tcltest.tcl: added getMatchingFiles back (alias
	to GetMatchingFiles), which was a public function in tcltest 1.0.

2002-04-01  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclEnv.c:
	* generic/tclIOUtil.c: invalidate filesystem cache when the
	user changes env(HOME).  Fixes [Bug #535621].  Also cleaned up
	some of the documentation.
	* tests/fileSystem.test: added test for bug just fixed.
	
2002-04-01  Kevin Kenny  <kennykb@@acm.org>

	* win/tclWinTime.c (Tcl_GetTime): made the checks of clock
	frequency more permissive to cope with the fact that Win98SE
	is observed to return 1.19318 in place of 1.193182 for the
	performance counter frequency.
	
2002-03-29  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclCmdMZ.c (Tcl_TraceObjCmd, TraceVarProc)
	(TraceCommandProc, TclTraceCommandObjCmd):  corrected
	potential double-free of traces on variables by flagging in
	Trace*Proc that it will free the var in case the eval wants to
	delete the var trace as well. [Bug #536937]
	Also converted Tcl_UntraceVar -> Tcl_UntraceVar2 and Tcl_Eval to
	Tcl_EvalEx in Trace*Proc for slight efficiency improvement.

2002-03-29  Don Porter  <dgp@@users.sourceforge.net>

	* doc/AllowExc.3:
	* generic/tclBasic.c (Tcl_EvalObjv,Tcl_EvalEx,Tcl_EvalObjEx):
	* generic/tclCompile.h (TclCompEvalObj):
	* generic/tclExecute.c (TclCompEvalObj,TclExecuteByteCode):
	* tests/basic.test: Corrected problems with Tcl_AllowExceptions
	having influence over the wrong scope of Tcl_*Eval* calls.  Patch
	from Miguel Sofer.  Report from Jean-Claude Wippler.  [Bug 219181]
d6687 4
a6690 1
2002-03-28  Don Porter  <dgp@@users.sourceforge.net>
d6692 5
a6696 2
	* generic/tclVar.c: Refactored CallTraces to collect repeated
	handling of its returned value into CallTraces itself.
d6698 4
a6701 1
2002-03-28  David Gravereaux <davygrvy@@pobox.com>
d6703 3
a6705 131
	* tools/feather.bmp:
	* tools/man2help.tcl:
	* tools/man2help2.tcl:
	* win/makefile.vc: More winhelp target fixups.  Added a feather
	bitmap to the non-scrollable area and changed the color to be
	yellow from a plain white.  The colors can be whatever we want
	them to be, but thought I would start with something bold.
	[Bug 527941]

	* doc/SetVar.3:
	* doc/TraceVar.3:
	* doc/UpVar.3:  .AP macro syntax repair.

2002-03-27  David Gravereaux <davygrvy@@pobox.com>

	* tools/man2help.tcl:
	* win/makefile.vc:  winhelp target now copies all needed files
	from tools/ to a workarea under $(OUT_DIR) and builds it from
	there.  No build cruft is left in tools/ anymore.  All paths
	used in man2help.tcl are now relative to where the script is.
	[Bug 527941]

2002-03-27  David Gravereaux <davygrvy@@pobox.com>

	* win/.cvsignore:
	* win/buildall.vc.bat:
	* win/coffbase.txt:
	* win/makefile.vc:
	* win/nmakehlp.c (new):
	* win/rules.vc:  First draft fix for [Bug 527941].  More changes
	need to done to the makehelp target to get to stop leaving build
	files in the tools/ directory.  This does not address the syntax
	errors in the man files.  Having the contents of tcl.hpj(.in)
	inside makefile.vc allows for version numbers to be replaced with
	macros.
	
	The new nmakehlp.c is built by rules.vc in preprocessing and removes
	the need to use tricky shell syntax that wasn't compatible on Win9x
	systems.  Clean targets made Win9x complient.  This is a first draft
	repair for [Bug 533862].

2002-03-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_EvalEx): passing the correct commandSize
	to TclEvalObjvInternal. [Bug 219362], fix by David Knoll.

2002-03-28  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_EvalEx):
	* tests/basic.test: avoid exceptional returns at level 0 
	[Bug 219181] 

2002-03-27  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n ([mainThread]):
	* library/tcltest/tcltest.tcl:
	* tests/tcltest.test:  Major code cleanup to deal with whitespace,
	coding conventions, and namespace issues, with several minor bugs
	fixed in the process.

	* tests/main.test: Added missing [after cancel]s.

2002-03-25  Don Porter  <dgp@@users.sourceforge.net>

	* tests/main.test: Removed workarounds for Bug 495977.

	* library/tcltest/tcltest.tcl:  Keep the value of $::auto_path
	unchanged, so that the tcltest package can test code that depends
	on auto-loading.  If a testing application needs $::auto_path pruned,
	it should do that itself.  [Bug 495726]
	Improve the processing of the -constraints option to [test] so that
	constraint lists can have arbitrary whitespace, and non-lists don't
	blow things up.  [Bug 495977]
	Corrected faulty variable initialization. [Bug 534845]

2002-03-25  Miguel Sofer  <msofer@@users.sourceforge.net>

	* doc/CrtTrace.3: small doc correction
	* generic/tclBasic.c (Tcl_DeleteTrace): Allow NULL callback on
	trace deletions [Bug 534728] (Hemang Lavana).

2002-03-24  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_EvalObjv): replaced obscure, incorrect
	code as described in [Bug 533907] (Don Porter).

2002-03-24  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:  Use [interpreter] to set/query the
	executable currently running the tcltest package.  [Bug 454050]

	* library/tcltest/tcltest.tcl:  Allow non-proc commands to be used
	as the customization hooks.  [Bug 495662]

2002-03-24  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclFilename.c:
	* generic/tclFCmd.c:
	* generic/tclTest.c:
	* generic/tcl.h:
	* generic/tclIOUtil.c:
	* win/tclWinFile.c:
	* win/tclWinFCmd.c:
	* win/tclWinPipe.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixFCmd.c:
	* mac/tclMacFile.c:
	* doc/FileSystem.3:
	* doc/file.n:
	* tests/cmdAH.test:
	* tests/fileName.test:
	* tests/fileSystem.test: (new file)	
	* tests/winFCmd.test: fix [Bug 511666] and [Bug 511658],
	and improved documentation of some aspects of the filesystem,
	particularly 'Tcl_FSMatchInDirectory' which now might match
	a single file/directory only, and 'file normalize' which
	wasn't very clear before.  Removed inconsistency betweens
	docs and the Tcl_Filesystem structure.  Also fixed 
	[Bug 523217] and corrected file normalization on Unix so that 
	it expands symbolic links.  Added some new tests of the 
	filesystem code (in the new file 'fileSystem.test'), and 
	some extra tests for correct handling of symbolic links.
	Fix to [Bug 530960] which shows up on Win98.  Made comparison
	with ".com" case insensitive in tclWinPipe.c
	
	***POTENTIAL INCOMPATIBILITY***: But only between alpha
	releases (users of the new Tcl_Filesystem lookup table in Tcl
	8.4a4 need to handle the new way in which Tcl may call
	Tcl_FSMatchInDirectory, and 'file normalize' on unix now
	behaves correctly).  Only known impact is with the 'tclvfs'
	extension.
d6707 1
a6707 1
2002-03-22  Miguel Sofer  <msofer@@users.sourceforge.net>
d6709 4
a6712 4
	* tests/basic.test (basic-46.1): adding test for [Bug 533758],
	fixed earlier today.
	
2002-03-22  Jeff Hobbs  <jeffh@@ActiveState.com>
d6714 1
a6714 1
	* win/tclWinInt.h: moved undef of TCL_STORAGE_CLASS. [Bug #478579]
d6716 3
a6718 1
2002-03-22  Miguel Sofer  <msofer@@users.sourceforge.net>
d6720 1
a6720 6
	* generic/tclBasic.c (Tcl_EvalObjEx):
	* generic/tclExecute.c (TclCompEvalObj): fixed the errorInfo for
	return codes other than (TCL_OK, TCL_ERROR) to runLevel 0 
	[Bug 533758]. Removed the static RecordTracebackInfo(), as its
	functionality is easily replicated by Tcl_LogCommandInfo. Bug
	and redundancy noted by Don Porter.
d6722 1
a6722 1
2002-03-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6724 4
a6727 1
	* doc/expr.n: Improved documentation for ceil and floor [Bug 530535]
d6729 1
a6729 1
2002-03-20  Don Porter  <dgp@@users.sourceforge.net>
d6731 2
a6732 27
	* doc/SetVar.3:
	* doc/TraceVar.3:
	* doc/UpVar.3:
	* generic/tcl.h (Tcl_VarTraceProc):
	* generic/tcl.decls (Tcl_GetVar2, Tcl_SetVar2, Tcl_TraceVar2,
	  Tcl_UnsetVar2, Tcl_UntraceVar2, Tcl_UpVar2, Tcl_VarTraceInfo2,
	  Tcl_GetVar2Ex, TclSetVar2Ex):
	* generic/tclCmdMZ.c (TraceVarProc):
	* generic/tclEnv.c (EnvTraceProc):
	* generic/tclEvent.c (VwaitVarProc):
	* generic/tclInt.decls (TclLookupVar,TclPrecTraceProc):
	* generic/tclLink.c (LinkTraceProc):
	* generic/tclUtil.c (TclPrecTraceProc):
	* generic/tclVar.c (CallTraces, MakeUpvar, VarErrMsg, TclLookupVar,
	  Tcl_GetVar2, Tcl_SetVar2, Tcl_TraceVar2, Tcl_UnsetVar2,
	  Tcl_UntraceVar2, Tcl_UpVar2, Tcl_VarTraceInfo2, Tcl_GetVar2Ex,
	  TclSetVar2Ex): Updated interfaces of generic/tclVar.c according
	to TIP 27.  In particular, the "part2" arguments were CONSTified.
	[Patch 532642]
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs

2002-03-15  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/compile.test (compile-12.3): Test to detect bug 530320.
	* generic/tclCompile.c (TclCompileTokens): Fixed buffer overrun
	reported in bug 530320.
d6734 1
a6734 1
2002-03-14  Mo DeJong  <mdejong@@users.sourceforge.net>
d6736 8
a6743 76
	* win/configure: Regen.
	* win/configure.in: Add configure time test for SEH
	support in the compiler.
	* win/tclWin32Dll.c (ESP, EBP, TclpCheckStackSpace,
	_except_checkstackspace_handler):
	* win/tclWinChan.c (ESP, EBP, Tcl_MakeFileChannel,
	_except_makefilechannel_handler):
	* win/tclWinFCmd.c (ESP, EBP, DoRenameFile,
	_except_dorenamefile_handler,
	DoCopyFile, _except_docopyfile_handler):
	Implement SEH support under gcc using inline asm.
	Tcl and Tk should now compile with Mingw 1.1. [Patch 525746]

2002-03-14  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile): Handle
	an SEH exception with EXCEPTION_EXECUTE_HANDLER instead
	of restarting the faulting instruction with
	EXCEPTION_CONTINUE_EXECUTION. Bug 466102 provides an
	example of how restarting could send Tcl into an
	infinite loop. [Patch 525746]

2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile, DoDeleteFile,
	DoRemoveJustDirectory): Make sure we don't pass NULL or ""
	as a path name to Win32 API functions since this was
	crashing under Windows 98.

2002-03-11  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:
	* library/tcltest/pkgIndex.tcl: Bumped tcltest package to 2.0.2.

2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl (getMatchingFiles): Pass
	a proper list to foreach to avoid munging a Windows
	patch like D:\Foo\Bar into D:FooBar before the glob.

2002-03-11  Mo DeJong  <mdejong@@users.sourceforge.net>

	* generic/tclEncoding.c: Fix typo in comment.
	* generic/tclIO.c (DoReadChars, ReadBytes, ReadChars):
	Use NULL value instead of pointer set to NULL to make
	things more clear. Reorder arguments so that they
	match the function signatures. Cleanup little typos
	and add more descriptive comment.

2002-03-08  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/README: Update to indicate that Mingw 1.1 is
	required to build Tcl. Add section describing new
	msys based build process. Update Cygwin build
	instructions so users know where to find Mingw 1.1.

2002-03-08  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinFCmd.c (DoCopyFile): correctly set retval to TCL_OK.

2002-03-07  Mo DeJong  <mdejong@@users.sourceforge.net>

	* win/tclWin32Dll.c (TclpCheckStackSpace):
	* win/tclWinFCmd.c (DoRenameFile, DoCopyFile): Replace
	hard coded constants with Win32 symbolic names.
	Move control flow statements out of __try blocks
	since the documentation indicates it is frowned upon.

2002-03-07  Don Porter  <dgp@@users.sourceforge.net>

	* doc/interp.n:
	* generic/tclInterp.c(Tcl_InterpObjCmd,SlaveObjCmd,SlaveRecursionLimit):
	* generic/tclTest.c:
	* tests/interp.test: Added the [interp recursionlimit] command to
	set/query the recursion limit of an interpreter.  Proposal and
	implementation from Stephen Trier. [TIP 87, Patch 522849]
d6745 1
a6745 1
2002-03-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6747 2
a6748 11
	* generic/tcl.h, tools/tcl.wse.in, unix/configure.in,
	* unix/tcl.spec, win/README.binary, win/configure.in, README:
	Bumped patchlevel; this might need to change in the future, but it
	will help us distinguish between the CVS version and the most
	recent released version.

2002-03-06  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclInt.h: for unshared objects, TclDecrRefCount now
	frees the internal rep before the string rep - just like the
	non-macro Tcl_DecrRefCount/TclFreeObj [Bug 524802]. 
d6750 1
a6750 1
2002-03-06  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d6752 4
a6755 4
	* doc/lsearch.n: Documentation of new features, plus examples.
	* tests/lsearch.test: Tests of new features.
	* generic/tclCmdIL.c (Tcl_LsearchObjCmd): TIP#80 support.  See
	http://purl.org/tcl/tip/80 for details.
d6757 3
a6759 1
2002-03-05  Jeff Hobbs  <jeffh@@ActiveState.com>
d6761 1
a6761 1
	*** 8.4a4 TAGGED FOR RELEASE ***
d6763 3
a6765 4
	* unix/tclUnixChan.c: initial remedy for [Bug #525783] flush
	problem introduced by TIP #35.  This may not satisfy true serial
	channels, but it restores the correct flushing of std* channels on
	exit.
d6767 1
a6767 1
	* unix/README: added --enable-langinfo doc.
d6769 2
a6770 2
	* unix/tcl.spec:
	* tools/tcl.wse.in: fixed URL refs to use www.tcl.tk or SF.
d6772 1
a6772 1
2002-03-04  Jeff Hobbs  <jeffh@@ActiveState.com>
d6774 1
a6774 6
	* README:
	* mac/README:
	* unix/Makefile.in:
	* unix/README:
	* win/README:
	* win/README.binary: updated to use www.tcl.tk URL.
d6776 1
a6776 1
	* unix/Makefile.in: added older ChangeLogs to dist target.
d6778 1
a6778 7
	* tests/io.test:
	* tests/encoding.test: corrected iso2022 encoding results.
	added encoding-24.*
	* generic/tclEncoding.c (EscapeFromUtfProc): corrected output of
	escape codes as per RFC 1468. [Patch #474358] (taguchi)
	(TclFinalizeEncodingSubsystem): corrected potential double-free
	when encodings were finalized on exit. [Bug #219314, #524674]
d6780 9
a6788 1
2002-03-01  Jeff Hobbs  <jeffh@@ActiveState.com>
d6790 2
a6791 5
	* library/encoding/iso2022-jp.enc: 
	* library/encoding/iso2022.enc: 
	* tools/encoding/iso2022-jp.esc:
	* tools/encoding/iso2022.esc: gave <ESC>$B precedence over <ESC>$@@,
	based on comments (point 1) in [Bug #219283] (rfc 1468)
d6793 2
a6794 5
	* tests/encoding.test: added encoding-23.* tests
	* generic/tclIO.c (FilterInputBytes): reset the TCL_ENCODING_START
	flags in the ChannelState when using 'gets'. [Bug #523988]
	Also reduced the value of ENCODING_LINESIZE from 30 to 20 as this
	seems to improve the performance of 'gets' according to tclbench.
d6796 1
a6796 1
2002-02-28  Jeff Hobbs  <jeffh@@ActiveState.com>
d6798 1
a6798 3
	* generic/tclCmdMZ.c (TraceCommandProc): ensure that TraceCommandInfo
	structure was also deleted when a command was deleted to prevent a
	mem leak.
d6800 1
a6800 2
	* generic/tclBasic.c (Tcl_CreateObjTrace): set tracePtr->flags
	correctly.
d6802 6
a6807 2
	* generic/tclTimer.c (TimerExitProc): remove remaining events in
	tls on thread exit.
d6809 2
a6810 1
2002-02-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d6812 2
a6813 3
	* generic/tclNamesp.c: allow cached fully-qualified namespace
	names to be usable from different namespaces within the same
	interpreter without forcing a new lookup [Patch 458872]. 
d6815 1
a6815 1
2002-02-28  Miguel Sofer  <msofer@@users.sourceforge.net>
d6817 1
a6817 2
	* generic/tclExecute.c: Replaced a few direct stack accesses 
	with the POP_OBJECT() macro [Bug 507181] (Don Porter).
d6819 1
a6819 1
2002-02-27  Don Porter  <dgp@@users.sourceforge.net>
d6821 1
a6821 8
	* doc/GetIndex.3:
	* generic/tcl.decls (Tcl_GetIndexFromObjStruct):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObjStruct):  Revised the
	prototype of the Tcl_GetIndexFromObjStruct to take its struct
	table as a (CONST VOID *) argument, better describing what it is,
	maintaining source compatibility, and adding CONST correctness
	according to TIP 27.  Thanks to Joe English for an elegant
	solution. [Bug 520304]
d6823 4
a6826 1
	* generic/tclDecls.h: make genstubs
d6828 1
a6828 3
	* generic/tclMain.c (Tcl_Main,StdinProc):  Corrected some reference
	count management errors on the interactive command Tcl_Obj found by
	Purify.  Thanks to Jeff Hobbs for the report and assistance.
d6830 3
a6832 1
2002-02-27  Jeff Hobbs  <jeffh@@ActiveState.com>
d6834 1
a6834 2
	* generic/tclBasic.c (Tcl_EvalTokensStandard): corrected mem leak
	in error case.
d6836 1
a6836 1
	* generic/tclTest.c (TestStatProc[123]): correct harmless UMRs.
d6838 1
a6838 1
	* generic/tclLink.c (Tcl_LinkVar): correct mem leak in error case.
d6840 3
a6842 1
2002-02-27  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d6844 1
a6844 3
	* tests/socket.test (2.7): Accepted and applied patch for Tcl SF
	  bug #523470 provided by Don Porter <dgp@@users.sourceforge.net>
	  to avoid timing problems in that test.
d6846 3
a6848 8
	* unix/tclUnixChan.c (TclpOpenFileChannel): Added code to regonize
	  "/dev/tty" (by name) and to not handle it as tty / serial
	  line. This is the controlling terminal and is special. Setting
	  it into raw mode as is done for other tty's is a bad idea. This
	  is a hackish fix for expect SGF Bug #520624. The fix has
	  limitation: Tcl_MakeFileChannel handles tty's specially too, but
	  is unable to recognize /dev/tty as it only gets a file
	  descriptor, and no name for it.
d6850 1
a6850 1
2002-02-26  Jeff Hobbs  <jeffh@@ActiveState.com>
d6852 1
a6852 1
	* generic/tclCmdAH.c (StoreStatData): corrected mem leak.
d6854 17
a6870 2
	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): prevent obj leak in
	  remedial regsub case.
d6872 2
a6873 2
	* generic/tclFileName.c (Tcl_TranslateFileName): decr refcount for
	  error case to prevent mem leak.
d6875 3
a6877 1
	* generic/tclVar.c (Tcl_ArrayObjCmd): removed extra obj allocation.
d6879 4
a6882 3
	* unix/tclUnixSock.c (Tcl_GetHostName): added an extra
	  gethostbyname check to guard against failure with truncated
	  names returned by uname.
d6884 9
a6892 3
	* unix/configure:
	* unix/tcl.m4 (SC_SERIAL_PORT): added sys/modem.h check and defined
	  _XOPEN_SOURCE_EXTENDED for HP-11 to get updated header decls.
d6894 3
a6896 2
	* unix/tclUnixChan.c: added Unix implementation of TIP #35, serial
	  port support. [Patch #438509] (schroedter)
d6898 1
a6898 1
2002-02-26  Miguel Sofer  <msofer@@users.sourceforge.net>
d6900 14
a6913 4
	* generic/tclCmpCmds.c: (bugfix to the bugfix, hopefully the last)
	  Bugfix to the new [for] compiling code: was setting a
	  exceptArray parameter using another param which wasn't yet
	  initialised, thus filling it with noise.
d6915 65
a6979 1
2002-02-25  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d6981 1
a6981 3
	* mac/tclMacSock.c (TcpGetOptionProc): Changed to recognize the
	  option "-error". Essentially ignores the option, always
	  returning an empty string.
d6983 21
a7003 1
2002-02-25  Jeff Hobbs  <jeffh@@ActiveState.com>
d7005 1
a7005 44
	* doc/Alloc.3:
	* doc/LinkVar.3:
	* doc/ObjectType.3:
	* doc/PkgRequire.3:
	* doc/Preserve.3:
	* doc/TCL_MEM_DEBUG.3: Updated documentation to describe the ckalloc,
	ckfree, ckrealloc, attemptckalloc, and attemptckrealloc macros, and
	to accurately describe when and how they are used. [Bug #497459] (dgp)

	* generic/tclHash.c (AllocArrayEntry, AllocStringEntry):
	Before invoking ckalloc when creating a Tcl_HashEntry,
	check that the amount of memory being allocated is
	at least as large as sizeof(Tcl_HashEntry). The previous
	code was allocating memory regions that were one
	or two bytes short. [Bug #521950] (dejong)

2002-02-25  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclBasic.c (Tcl_EvalEx): avoiding a buffer overrun
	reported by Joe English, and restoring tcl7.6 behaviour for
	[subst]: badly terminated nested scripts will raise an error
	and not be evaluated. [Bug #495207]

2002-02-25  Don Porter  <dgp@@users.sourceforge.net>

	* unix/tclUnixPort.h: corrected strtoll prototype mismatch on Tru64.
	* compat/strtod.c (strtod): simplified #includes
	* compat/strtol.c (strtol): gather result in a long before returning
	as a long: necessary on platforms where sizeof(int) != sizeof(long).

2002-02-25  Daniel Steffen  <das@@users.sourceforge.net>

	* unix/tclLoadDyld.c: updated to use Mac OS X 10.1 dyld APIs that
	have more libdl-like semantics. (bug #514392)

2002-02-25  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompCmds: fixing a bug in patch dated 2002-02-22, in
	the code for [for] and [while]. Under certain conditions, for long
	bodies, the exception range parameters were badly computed. Tests
	forthcoming: I still can't reproduce the conditions in the
	testsuite (!), although the bug (with assorted segfault or panic!)
	can be triggered from the console or with the new parse.bench in  
	tclbench.
d7007 6
a7012 1
2002-02-25  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d7014 3
a7016 2
	* compat/strtoul.c, compat/strtol.c, compat/strtod.c: Added UCHAR,
	CONST and #includes to clean up GCC output.
d7018 1
a7018 1
2002-02-23  Don Porter  <dgp@@users.sourceforge.net>
d7020 4
a7023 5
	* compat/strtoull.c (strtoull):
	* compat/strtoll.c (strtoll):
	* compat/strtoul.c (strtoul): Fixed failure to handle leading
	sign symbols '+' and '-' and '0X' and raise overflow errors.
	[Bug 440916]  Also corrects prototype and errno problems.
d7025 1
a7025 1
2002-02-23  Mo DeJong  <mdejong@@users.sourceforge.net>
d7027 9
a7035 12
	* configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Link with -n32
	instead of -32 when building on IRIX64-6.* system.
	[Tcl bug 521707]

2002-02-22  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclInt.h:
	* generic/tclObj.c: renamed global variable emptyString ->
	tclEmptyString because it is no longer static.
	* generic/tclPkg.c: Fix for panic when library is loaded on a
	platform without backlinking without proper use of stubs. [Bug 476537]
d7037 1
a7037 1
2002-02-22  Jeff Hobbs  <jeffh@@ActiveState.com>
d7039 10
a7048 2
	* tests/regexpComp.test: updated regexp-11.[1-4] to match changes
	in regexp.test for new regsub syntax
d7050 1
a7050 3
	* unix/configure:
	* unix/tcl.m4: added --enable-64bit support for AIX-4 (using -q64
	flag) when using IBM's xlc compiler.
d7052 1
a7052 12
	* tests/safe.test: updated safe-8.5 and safe-8.7
	* library/safe.tcl (CheckFileName): removed the limit on
	sourceable file names (was only *.tcl or tclIndex files with no
	more than one dot and 14 chars).  There is enough internal
	protection in a safe interpreter already.  Fixes [Tk Bug #521560].

2002-02-22  Miguel Sofer  <msofer@@users.sourceforge.net>

	* generic/tclCompCmds: [FR 465811]. Optimising [if], [for] and
	[while] for constant conditions; in addition, [for] and [while]
	are now compiled with the "loop rotation" optimisation (thanks to
	Kevin Kenny). 
d7054 1
a7054 1
2002-02-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d7056 2
a7057 13
	--- TIP#76 CHANGES ---
	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): Final-argument-less
	[regsub] returns the modified string.
	* doc/regsub.n: Updated docs.
	* tests/regexp.test: Updated and added tests.

	* compat/strtoll.c (strtoll): 
	* compat/strtoull.c (strtoull): 
	* unix/tclUnixPort.h:
	* win/tclWinPort.h: Const-ing 64-bit compatability declarations.
	Note that the return pointer is non-const because it is entirely
	legal for the functions to be called from somewhere that owns the
	string being passed.  Fixes problem reported by Larry Virden.
d7059 1
a7059 1
2002-02-21  David Gravereaux <davygrvy@@pobox.com>
d7061 2
a7062 27
	* win/mkd.bat (removed):
	* win/coffbase.txt (new):
	* win/makefile.bc:
	* win/makefile.vc:  Changed the 'setup' target to stop using
	the mkd.bat file and just make the directory right in the rule.
	Same change to makefile.bc.  configure.in nor Makefile.in use
	it.

	coffbase.txt will be the master list for our "prefered base
	addresses" set by the linker.  This should improve load-time
	(NT only) by avoiding relocations.  Submissions to the list
	by extension authors are encouraged.

	Added a 'tidy' target to compliment 'clean' and 'hose' to remove
	just the outputs. Also removed the $(winlibs) macro as it wasn't
	being used.

	Stuff left to do:
	1) get the winhelp target to stop building in the tools/
	directory.
	2) stop using rmd.bat
	3) add more dependacy rules.

	* win/tclAppInit.c:  Reverted back to -r1.6, as the header file
	change to tclPort.h won't allow for easy embedded support
	outside of the source dist.  Thanks to Don Porter for pointing
	this out to me.
d7064 1
a7064 1
2002-02-21  David Gravereaux <davygrvy@@pobox.com>
d7066 8
d7075 140
a7214 3
	* win/rules.vc:  Added a new "loimpact" option that sets the
	-ws:aggressive linker option.  Off by default.  It's said to
	keep the heap use low at the expense of alloc speed.
d7216 1
a7216 5
	* win/tclAppInit.c: Changed #include "tcl.h" to be tclPort.h to
	remove the raw windows.h include.  tclPort.h brings in windows.h
	already and lessens the pre-compiled-header mush and the randomly
	useless	#pragma comment (lib,...) references throughout the big
	windows.h tree (as observed at high linker warning levels).
d7218 10
a7227 1
2002-02-21  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d7229 7
a7235 2
	* generic/tcl.h: Better guessing of LP64/ILP32 architecture, but
	now sensitive to presence of (suitable) <limits.h>
d7237 3
a7239 1
2002-02-20  Don Porter <dgp@@users.sourceforge.net>
d7241 2
a7242 5
	* generic/tcl.decls (Tcl_RegExpRange,Tcl_GetIndexFromObjStruct):
	Overlooked a few source incompatibilities.  Now using CONST84.
	* generic/tclDecls.h: make genstubs
	* generic/tcl.h (Tcl_CmdObjTraceProc): silence warning from Sun
	Workshop compiler.
d7244 3
a7246 1
2002-02-20  David Gravereaux <davygrvy@@pobox.com>
d7248 3
a7250 27
	* win/buildall.vc.bat:
	* win/makefile.vc:
	* win/rules.vc: General clean-ups.  Added compiler and linker tests
	for a) the pentium 0x0F errata, b) optimizing (not all have this),
	and c) linker v6 section alignment confusion.  All these are tested
	first to make sure any D4002 or LNK1117 warnings aren't displayed.
	The pentium 0x0F errata is a recommended switch.  The v5 linker's
	section alignment default is 512, but the v6 linker was changed
	to 4096 in an attempt to speed loading on Win98.  I changed the
	default to always be 512 across both linkers, unless linking
	statically, then 4096 is used for the claimed speed effect. Using
	a 512 alignment saves 12k bytes of dead space in the DLL.

	Added IA64 B-stepping errata switch when the compiler supports it.

	Added profiling to $(lflags) when requested and also removed the
	explict -entry option as the default works fine as is.

	Removed win/tclWinInit.c from the special case section to let it
	use the common implicit rule as the $(EXTFLAGS) macro it had was
	never referenced anywhere.

2002-02-20  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tcl.h: Added code to guess the correct settings for
	TCL_WIDE_INT_IS_LONG and TCL_WIDE_INT_TYPE when configure doesn't
	tell us them, as can happen with extensions.
d7252 2
a7253 1
2002-02-19  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>
d7255 2
a7256 5
	* doc/format.n: Updated docs to list the specification.
	* generic/tclCmdAH.c (Tcl_FormatObjCmd): Made behaviour on 64-bit
	platforms correctly meet the specification, that %d works with the
	native word-sized integer, instead of trying to guess (wrongly)
	from the value being passed.
d7258 3
a7260 1
2002-02-19  Don Porter <dgp@@users.sourceforge.net>
d7262 4
a7265 1
	* changes: First draft of updated changes for 8.4a4 release.
d7267 13
a7279 1
2002-02-15  Jeff Hobbs  <jeffh@@ActiveState.com>
d7281 4
a7284 2
	* unix/tclUnixPort.h: add strtoll/strtoull declarations for
	platforms that do not define them.
d7286 2
a7287 2
	* generic/tclIndexObj.c (STRING_AT): removed ptrdiff_t cast and
	use of VOID* in default case (GNU-ism).
d7289 2
a7290 124
2002-02-15  Kevin Kenny  <kennykb@@acm.org>

	* compat/strtoll.c:
	* compat/strtoul.c:
	* compat/strtoull.c:
	* generic/tclIOUtil.c:
	* generic/tclPosixStr.c:
	* generic/tclTest.c:
	* generic/tclTestObj.c:
	* tests/get.test:
	* win/Makefile.vc: Further tweaks to the TIP 72 patch to make it
	compile under VC++.
	
2002-02-15  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* tclExecute.c:
	* tclIOGT.c:
	* tclIndexObj.c: Touchups to the TIP 72 patch to make it
	  compileable under Windows again. The changes are not complete,
	  there is one nasty regarding _stati64

2002-02-15  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	+----------------------+
	| TIP #72 IMPLEMENTED. |
	+----------------------+

	There are a lot of changes from this TIP, so please see
	http://purl.org/tcl/tip/72.html for discussion of
	backward-compatability issues, but the main ones modifications are
	in:

	* generic/tcl.h: New types.
	* generic/tcl.decls: New public functions.
	* generic/tclExecute.c: 64-bit aware bytecode engine.
	* generic/tclBinary.c: 64-bit handling in [binary] command.
	* generic/tclScan.c: 64-bit handling in [scan] command.
	* generic/tclCmdAH.c: 64-bit handling in [file] and [format]
	commands.
	* generic/tclBasic.c: New "wordSize" entry in ::tcl_platform.
	* generic/tclFCmd.c: Large-file support (with many consequences.)
	* generic/tclIO.c: Large-file support (with many consequences.)
	* compat/strtoll.c, compat/strtoull.c: New support functions.
	* unix/tcl.m4, unix/configure: 64-bit support and greatly enhanced
	cacheing.

	Most other changes, including all those in doc/* and test/* as
	well as the majority in the platform directories, follow on from
	these.

	Also coming out of the woodwork:
	* generic/tclIndex.c: Better support for Cray PVP.
	* win/tclWinMtherr.c: Better Borland support.

	Note that, in a number of places through the Unix part of the
	platform support, there are Tcl_Platform* references.  These are
	expanded into the correct way to call that particular underlying
	function, i.e. with or without a '64' suffix, and should be used
	by people working on the core in preference to the API functions
	they overlay so that the code remains portable depending on the
	presence or absence of 64-bit support on the underlying platform.

	***POTENTIAL INCOMPATIBILITY***: Extracted from the TIP

	SUMMARY OF INCOMPATIBILITIES AND FIXES 
	======================================

	The behaviour of expressions containing constants that appear
	positive but which have a negative internal representation will
	change, as these will now usually be interpreted as wide
	integers. This is always fixable by replacing the constant with
	int(constant).

	Extensions creating new channel types will need to be altered as
	different types are now in use in those areas. The change to the
	declaration of Tcl_FSStat and Tcl_FSLstat (which are the new
	preferred API in any case) are less serious as no non-alpha
	releases have been made yet with those API functions.

	Scripts that are lax about the use of the l modifier in format and
	scan will probably need to be rewritten. This should be very
	uncommon though as previously it had absolutely no effect.

	Extensions that create new math functions that take more than one
	argument will need to be recompiled (the size of Tcl_Value
	changes), and functions that accept arguments of any type
	(TCL_EITHER) will need to be rewritten to handle wide integer
	values. (I do not expect this to affect many extensions at all.)

2002-02-14  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIOCmd.c (Tcl_GetsObjCmd): Trivial fix for bug
	  #517503, a memory leak reported by Miguel Sofer
	  <msofer@@users.sourceforge.net>. The leak happens if an error
	  occurs for "set var [gets $chan]" and leak one empty object.

2002-02-12  David Gravereaux <davygrvy@@pobox.com>

	* djgpp/ (new directory)
	* djgpp/Makefile (new):
	* unix/tclAppInit.c:
	* unix/tclMtherr.c:
	* unix/tclUnixFCmd.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixInit.c:
	* unix/tclUnixPort.h:  Early stage of DJGPP support for building
	Tcl on DOS.  Dynamic loading isn't working, yet.  Requires watt32
	for the TCP/IP stack.  No autoconf, yet.  Barely tested, but
	makes a working exe that runs Tcl in protected-mode, flat memory.
	[exec] and pipes will need the most work as multi-tasking on DOS
	has to be carefully.

2002-02-10  Kevin Kenny  <kennykb@@acm.org>

	* doc/CrtObjCmd.3:
	* doc/CrtTrace.3:
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclBasic.c:
	* generic/tclInt.h:
	* generic/tclTest.c:
	* tests/basic.test: Added Tcl_CreateObjTrace,
	Tcl_GetCommandInfoFromToken and Tcl_SetCommandInfoFromToken.
	(TIPs #32 and #79.)
d7292 2
a7293 4
	* generic/tclDecls.h:
	* generic/tclStubInit.c: Regenerated Stubs tables.
	
2002-02-08  Jeff Hobbs  <jeffh@@ActiveState.com>
d7295 1
a7295 92
	* unix/configure:
	* unix/tcl.m4: added -pthread for FreeBSD to EXTRA_CFLAGS and
	LDFLAGS.  Also triggered nodots only for FreeBSD-3.
	Added AC_DEFINE(_POSIX_PTHREAD_SEMANTICS) for Solaris.

	* unix/tclUnixPort.h:
	* unix/tclUnixThrd.c: added thread-safe versions of readdir,
	localtime, gmtime and inet_ntoa for threaded build. (jgdavidson)

	* generic/tclScan.c (Tcl_ScanObjCmd): prevented ckfree being
	called on a pointer to NULL.

2002-02-07  Don Porter <dgp@@users.sourceforge.net>

	* doc/DString.3:
	* doc/Encoding.3:
	* doc/GetCwd.3:
	* doc/SplitPath.3:
	* doc/Translate.3:
	* doc/Utf.3:
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclEncoding.c:
	* generic/tclEnv.c:
	* generic/tclFileName.c:
	* generic/tclIOUtil.c:
	* generic/tclUtf.c:
	* generic/tclUtil.c:
	* mac/tclMacInit.c:
	* unix/tclUnixFile.c:
	* unix/tclUnixInit.c:
	* unix/tclUnixPipe.c:
	* win/tclWin32Dll.c:
	* win/tclWinFCmd.c:
	* win/tclWinFile.c:
	* win/tclWinInit.c: Partial TIP 27 rollback.  Following routines
	restored to return (char *): Tcl_DStringAppend,
	Tcl_DStringAppendElement, Tcl_JoinPath, Tcl_TranslateFileName,
	Tcl_ExternalToUtfDString, Tcl_UtfToExternalDString,
	Tcl_UniCharToUtfDString, Tcl_GetCwd, Tcl_WinTCharToUtf.  Also
	restored Tcl_WinUtfToTChar to return (TCHAR *) and 
	Tcl_UtfToUniCharDString to return (Tcl_UniChar *).  Modified
	some callers.  This change recognizes that Tcl_DStrings are
	de-facto white-box objects.

	* generic/tclDecls.h:
	* generic/tclPlatDecls.h: make genstubs

	* generic/tclCmdMZ.c: corrected use of C++-style comment.

2002-02-06  Jeff Hobbs  <jeffh@@ActiveState.com>

	* tests/scan.test:
	* generic/tclScan.c (Tcl_ScanObjCmd): corrected scan 0x... %x
	handling that didn't accept the 0x as a prelude to a base 16
	number.  [Bug #495213]

	* generic/tclCompCmds.c (TclCompileRegexpCmd): made early check
	for bad RE to stop checking further.

	* generic/tclCmdMZ.c (Tcl_RegsubObjCmd): added special case to
	search for simple 'string map' style regsub calls.
	Delayed creation of resultPtr object until an initial match is
	made, as the input string object can then be reused for no matches.
	(Tcl_StringObjCmd): optimization improvements to the STR_MAP
	algorithm for zero-length and nocase cases.

	* tests/regexp.test:
	* tests/regexpComp.test: extra code coverage tests.

	* tests/string.test: added 10.18 and 10.19 extra tests.

	* generic/regc_locale.c (casecmp): slight performance improvement.

2002-02-05  Don Porter <dgp@@users.sourceforge.net>

	* library/http/http.tcl:
	* library/http/pkgIndex.tcl:  Corrected use of http::error when
	::error was intended.  Bump to http 2.4.2.

2002-02-04  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* unix/tclUnixChan.c (FileOutputProc): Fixed [bug 465765] reported
	  by Dale Talcott <daletalcott@@users.sourceforge.net>. Avoid
	  writing nothing into a file as STREAM based implementations will
	  consider this a EOF (if the file is a pipe). Not done in the
	  generic layer as this type of writing is actually useful to
	  check the state of a socket.

	* doc/open.n: Fixed [Bug 511540], added cross-reference to 'pid'
	  as the command to use to retrieve the pid of a command pipeline
	  created via 'open'.
d7297 2
a7298 1
2002-02-01  Jeff Hobbs  <jeffh@@ActiveState.com>
d7300 1
a7300 2
	* generic/tclCmdMZ.c (Tcl_RegexpObjCmd): handle quirky about case
	earlier to avoid shimmering problem.
d7302 9
a7310 1
2002-02-01  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d7312 3
a7314 3
	* tests/io.test: io-39.22 split into two tests, one platform
	  dependent, the other not. -eofchar is not empty on the windows
	  platform.
d7316 2
a7317 1
2002-02-01  Vince Darley <vincentdarley@@users.sourceforge.net>
d7319 1
a7319 2
	* generic/tclTest.c: fix to picky windows compiler problem
	  with the 'MainLoop' function declaration.
d7321 2
a7322 1
2002-01-31  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>
d7324 1
a7324 2
	* win/tclWinFCmd.c: TIP 27: Applied patch fixing CONST warnings on
	  behalf of Don Porter <dgp@@users.sourceforge.net>.
d7326 3
a7328 1
2002-01-30  Don Porter <dgp@@users.sourceforge.net>
d7330 1
a7330 11
	* generic/tcl.decls:
	* generic/tcl.h:
	* generic/tclInt.h: For each interface identified in the TIP 27
	  changes below as a POTENTIAL INCOMPATIBILITY, the source of the
	  incompatibility has been parameterized so that it can be
	  removed.  When compiling extension code against the Tcl header
	  files, use the compiler flag -DUSE_NON_CONST to remove the
	  irresolvable source incompatibilities introduced by the TIP 27
	  changes.  Resolvable changes are left for extension authors to
	  resolve.
	* generic/tclDecls.h: make genstubs
d7332 1
a7332 1
2002-01-30  Vince Darley <vincentdarley@@users.sourceforge.net>
d7334 2
a7335 3
	* doc/FileSystem.3: added documentation for 3 public
	functions which had been overlooked.  Fixes [Bug 507701].
	* unix/mkLinks: make mklinks
d7337 1
a7337 1
2002-01-29  Jeff Hobbs  <jeffh@@ActiveState.com>
d7339 2
a7340 3
	* tests/regexpComp.test:
	* generic/tclCompCmds.c (TclCompileRegexpCmd): enhanced to support
	-nocase and -- options.
d7342 1
a7342 1
2002-01-28  Mo DeJong  <mdejong@@users.sourceforge.net>
d7344 6
a7349 62
	* unix/tcl.m4 (SC_LOAD_TCLCONFIG):
	* win/tcl.m4 (SC_LOAD_TCLCONFIG): Set TCL_LIB_SPEC,
	TCL_STUB_LIB_SPEC, and TCL_STUB_LIB_PATH to the
	values of TCL_BUILD_LIB_SPEC, TCL_BUILD_STUB_LIB_SPEC,
	and TCL_BUILD_STUB_LIB_PATH when tclConfig.sh is loaded
	from the build directory. A Tcl extension should
	make use of the non-build versions of these variables
	since they will work in both cases. This modification
	was described in TIP 34.

2002-01-28  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/tclWinReg.c (regConnectRegistryProc,RecursiveDeleteKey)
	(DeleteKey,GetKeyNames,GetType,GetValue,OpenSubKey,SetValue):
	redid the CONSTification as previous changes caused failing tests.

	* tests/regexpComp.test (new):
	* generic/tclInt.h:
	* generic/tclBasic.c: added TclCompileRegexpCmd entry
	* generic/tclCompCmds.c (TclCompileStringCmd): corrected to return
	TCL_OUT_LINE_COMPILE instead of TCL_ERROR for parsing errors, so
	it only throws the error for runtime compile, in case the user
	modifies 'string'.
	(TclCompileRegexpCmd): first try at a byte-compiled regexp
	command.  It handles static strings and ^$ bounded static strings.
	(TclCompileAppendCmd): made TclPushVarName call always use
	TCL_CREATE_VAR as numWords is always > 2 at that point.

	* generic/tclExecute.c (TclExecuteByteCode:INST_LIST): correct
	possibly dangerous decr in macro call.

	* win/tclWinInit.c (TclpFindVariable): CONSTification touch-up

	* win/tclWinReg.c (OpenSubKey): corrected bug introduced in
	CONSTification that dropped pointer reference.

	* ChangeLog.2000 (new file):
	* ChangeLog: broke changes from 2000 into ChangeLog.2000 to reduce
	  size of the main ChangeLog.

2002-01-28  David Gravereaux <davygrvy@@pobox.com>

	* generic/tclPlatDecls.h:  Added preprocessor logic to force a
	typedef of TCHAR when __STDC__ is defined when using the uncommon
	-Za compiler switch with the microsoft compiler.

2002-01-27  Don Porter <dgp@@users.sourceforge.net>

	* doc/package.n: Documented global namespace context for script
	evaluation by [package require].

2002-01-27  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclInt.decls:
	* generic/tclIntPlatDecls.h:
	* mac/tclMacChan.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacInit.c:
	* mac/tclMacLoad.c:
	* mac/tclMacResource.c:
	* mac/tclMacSock.c: TIP 27 CONSTification induced changes
d7351 2
a7352 3
	* tests/event.test:
	* tests/main.test: added catches/constraints to test that
	use features that don't exist on the mac.
d7354 2
a7355 1
2002-01-25  Mo DeJong  <mdejong@@users.sourceforge.net>
d7357 1
a7357 2
	Make -eofchar and -translation options read only for
	server sockets. [Bug 496733]
d7359 2
a7360 280
	* generic/tclIO.c (Tcl_GetChannelOption, Tcl_SetChannelOption):
	Instead of returning nothing for the -translation option
	on a server socket, always return "auto". Return the empty
	string enclosed in quotes for the -eofchar option on
	a server socket. Fixup -eofchar usage message so that
	it matches the implementation.
	* tests/io.test: Add -eofchar tests and -translation tests
	to ensure options are read only on server sockets.
	* tests/socket.test: Update tests to account for -eofchar
	and -translation option changes.

2002-01-25  Don Porter <dgp@@users.sourceforge.net>

	* compat/strstr.c (strstr):
	* generic/tclCmdAH.c (Tcl_FormatObjCmd):
	* generic/tclCmdIL.c (InfoNameOfExecutableCmd):
	* generic/tclEnv.c (ReplaceString):
	* generic/tclFileName.c (ExtractWinRoot):
	* generic/tclIO.c (FlushChannel,Tcl_BadChannelOption):
	* generic/tclStringObj.c (AppendUnicodeToUtfRep):
	* generic/tclThreadTest.c (TclCreateThread):
	* generic/tclUtf.c (Tcl_UtfPrev):
	* mac/tclMacFCmd.c (TclpObjListVolumes):
	* mac/tclMacResource.c (TclMacRegisterResourceFork,
	  BuildResourceForkList):
	* win/tclWinInit.c (AppendEnvironment):  Sought out and eliminated
	instances of CONST-casting that are no longer needed after the
	TIP 27 effort.

	* Following is [Patch 501006]
	* generic/tclInt.decls (Tcl_AddInterpResolvers, Tcl_Export,
	  Tcl_FindNamespace, Tcl_GetInterpResolvers, Tcl_ForgetImport,
	  Tcl_Import, Tcl_RemoveInterpResolvers):
	* generic/tclNamesp.c (Tcl_Export, Tcl_Import, Tcl_ForgetImport,
	  Tcl_FindNamespace):
	* generic/tclResolve.c (Tcl_AddInterpResolvers,Tcl_GetInterpResolvers,
	  Tcl_RemoveInterpResolvers): Updated APIs in generic/tclResolve.c
	and generic/tclNamesp.c according to the guidelines of TIP 27.
	* generic/tclIntDecls.h: make genstubs

	* Following is [Patch 505630]
	* doc/AddErrorInfo.3:
	* generic/tcl.decls (Tcl_LogCommandInfo):
	* generic/tclBasic.c (Tcl_LogCommandInfo): Updated interfaces
	of generic/tclBasic.cc according to TIP 27.
	* generic/tclDecls.h: make genstubs

	* Following is [Patch 506818]
	* doc/Hash.3:
	* generic/tcl.decls (Tcl_HashStats):
	* generic/tclHash.c (Tcl_HashStats):  Updated APIs of generic/tclHash.c
	according to guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs
	* generic/tclVar.c (Tcl_ArrayObjCmd): Updated callers.

	* Following is [Patch 506807]
	* doc/ObjectType.3:
	* generic/tcl.decls (Tcl_GetObjType):
	* generic/tclObj.c (Tcl_GetObjType): Updated APIs of generic/tclObj.c
	according to guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs

	* Following is [Patch 507304]
	* doc/Encoding.3:
	* generic/tcl.decls (Tcl_WinUtfToTChar,Tcl_WinTCharToUtf):
	* win/tclWin32Dll.c (Tcl_WinUtfToTChar,Tcl_WinTCharToUtf):
	Updated interfaces in win/tclWin32Dll.c according to TIP 27.
	* generic/tclPlatDecls.h: make genstubs
	* generic/tclIOUtil.c (TclpNativeToNormalized):
	* win/tclWinFCmd.c (TclpObjNormalizePath):
	* win/tclWinFile.c (TclpFindExecutable,TclpMatchInDirectory,
	  NativeIsExec,NativeStat):
	* win/tclWinLoad.c (TclpLoadFile):
	* win/tclWinPipe.c (TclpOpenFile,ApplicationType):
	* win/tclWinReg.c (regConnectRegistryProc,RecursiveDeleteKey,DeleteKey,
	  GetKeyNames,GetType,GetValue,OpenSubKey,SetValue):
	* win/tclWinSerial.c (SerialSetOptionProc): Update callers.

	* Following is [Patch 505072]
	* doc/Concat.3:
	* doc/Encoding.3:
	* doc/Filesystem.3:
	* doc/Macintosh.3:
	* doc/OpenFileChnl.3
	* doc/SetResult.3:
	* doc/SetVar.3:
	* doc/SplitList.3:
	* doc/SplitPath.3:
	* doc/Translate.3:
	* generic/tcl.h (Tcl_FSMatchInDirectoryProc):
	* generic/tclInt.h (TclpMatchInDirectory):
	* generic/tcl.decls (Tcl_Concat,Tcl_GetStringResult,Tcl_GetVar,
	  Tcl_GetVar2,Tcl_JoinPath,Tcl_Merge,Tcl_OpenCommandChannel,Tcl_SetVar,
	  Tcl_SetVar2,Tcl_SplitList,Tcl_SplitPath,Tcl_TranslateFileName,
	  Tcl_ExternalToUtfDString,Tcl_GetEncodingName,Tcl_UtfToExternalDString,
	  Tcl_GetDefaultEncodingDir,Tcl_SetDefaultEncodingDir,
	  Tcl_FSMatchInDirectory,Tcl_MacEvalResource,Tcl_MacFindResource):
	* generic/tclInt.decls (TclCreatePipeline,TclGetEnv,TclpGetCwd,
	  TclpCreateProcess):
	* mac/tclMacFile.c (TclpGetCwd):
	* generic/tclEncoding.c (Tcl_GetDefaultEncodingDir,
	  Tcl_SetDefaultEncodingDir,Tcl_GetEncodingName,
	  Tcl_ExternalToUtfDString,Tcl_UtfToExternalDString, OpenEncodingFile,
	  LoadEscapeEncoding):
	* generic/tclFileName.c (DoTildeSubst,Tcl_JoinPath,Tcl_SplitPath,
	  Tcl_TranslateFileName): 
	* generic/tclIOUtil.c (Tcl_FSMatchInDirectory):
	* generic/tclPipe.c (FileForRedirect,TclCreatePipeline,
	  Tcl_OpenCommandChannel):
	* generic/tclResult.c (Tcl_GetStringResult):
	* generic/tclUtil.c (Tcl_Concat,Tcl_SplitList,Tcl_Merge):
	* generic/tclVar.c (Tcl_GetVar,Tcl_GetVar2,Tcl_SetVar,Tcl_SetVar2):
	* mac/tclMacResource.c (Tcl_MacEvalResource,Tcl_MacFindResource):
	Updated interfaces of generic/tclEncoding, generic/tclFilename.c,
	generic/tclIOUtil.c, generic/tclPipe.c, generic/tclResult.c,
	generic/tclUtil.c, generic/tclVar.c and mac/tclMacResource.c according
	to TIP 27.  Tcl_TranslateFileName rewritten as wrapper around
	VFS-aware version.
	***POTENTIAL INCOMPATIBILITY*** 
	Includes source incompatibilities: argv arguments of Tcl_Concat,
	Tcl_JoinPath, Tcl_OpenCommandChannel, Tcl_Merge; argvPtr arguments of
	Tcl_SplitList and Tcl_SplitPath.
	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs

	* generic/tclCkalloc.c (MemoryCmd):
	* generic/tclClock.c (FormatClock):
	* generic/tclCmdAH.c (Tcl_CaseObjCmd,Tcl_EncodingObjCmd,Tcl_FileObjCmd):
	* generic/tclCmdIL.c (InfoLibraryCmd,InfoPatchLevelCmd,
	  InfoTclVersionCmd):
	* generic/tclCompCmds.c (TclCompileForeachCmd):
	* generic/tclCompCmds.h (TclCompileForeachCmd):
	* generic/tclCompile.c (TclFindCompiledLocal):
	* generic/tclEnv.c (TclSetupEnv,TclSetEnv,Tcl_PutEnv,TclGetEnv,
	  EnvTraceProc):
	* generic/tclEvent.c (Tcl_BackgroundError):
	* generic/tclIO.c (Tcl_BadChannelOption,Tcl_SetChannelOption):
	* generic/tclIOCmd.c (Tcl_ExecObjCmd,Tcl_OpenObjCmd):
	* generic/tclIOSock.c (TclSockGetPort):
	* generic/tclIOUtil.c (SetFsPathFromAny):
	* generic/tclLink.c (LinkTraceProc):
	* generic/tclMain.c (Tcl_Main):
	* generic/tclNamesp.c (TclTeardownNamespace):
	* generic/tclProc.c (TclCreateProc):
	* generic/tclTest.c (TestregexpObjCmd,TesttranslatefilenameCmd,
	  TestchmodCmd,GetTimesCmd,TestsetCmd,TestOpenFileChannelProc1,
	  TestOpenFileChannelProc2,TestOpenFileChannelProc3,AsyncHandlerProc,
	  TestpanicCmd):
	* generic/tclThreadTest.c (ThreadErrorProc,ThreadEventProc):
	* generic/tclUtil.c (TclPrecTraceProc):
	* mac/tclMacFCmd.c (GetFileSpecs):
	* mac/tclMacFile.c (TclpMatchInDirectory):
	* mac/tclMacInit.c (TclpInitLibraryPath,Tcl_SourceRCFile):
	* mac/tclMacOSA.c (tclOSAStore,tclOSALoad):
	* mac/tclMacResource.c (Tcl_MacEvalResource):
	* unix/tclUnixFCmd.c (TclpObjNormalizePath):
	* unix/tclUnixFile.c (TclpMatchInDirectory,TclpGetUserHome,TclpGetCwd,
	  TclpReadLink):
	* unix/tclUnixInit.c (TclpInitLibraryPath,TclpSetVariables,
	  Tcl_SourceRCFile):
	* unix/tclUnixPipe.c (TclpOpenFile,TclpCreateTempFile,
	  TclpCreateProcess):
	* win/tclWinFile.c (TclpGetCwd,TclpMatchInDirectory):
	* win/tclWinInit.c (TclpInitLibraryPath,Tcl_SourceRCFile,
	  TclpSetVariables):
	* win/tclWinPipe.c (TclpCreateProcess): Updated callers.

2002-01-24  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclIOUtil.c (SetFsPathFromAny):  Corrected tilde-substitution
	of pathnames where > 1 separator follows the ~.  [Bug 504950]

2002-01-24  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/http/pkgIndex.tcl:
	* library/http/http.tcl: don't add port in default case to handle
	broken servers.  http bumped to 2.4.1  [Bug #504508]

2002-01-23  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* unix/mkLinks: Regenerated.
	* doc/CrtChannel.3:
	* doc/ChnlStack.3: Moved documentation for 'Tcl_GetTopChannel'
	  from 'CrtChannel' to 'ChnlStack'. Added documentation of
	  'Tcl_GetStackedChannel'. Bug #506147 reported by Mark Patton
	  <msp@@users.sourceforge.net>.

2002-01-23  Don Porter <dgp@@users.sourceforge.net>

	* win/tclWinFile.c (NativeAccess,NativeStat,NativeIsExec,
	  TclpGetUserHome):
	* win/tclWinPort.h (TclWinSerialReopen):
	* win/tclWinSerial.c (TclWinSerialReopen):
	* win/tclWinSock.c (Tcl_OpenTcpServer):  Corrections to earlier
	TIP 27 changes.  Thanks to Andreas Kupries for the feedback.
	* generic/tclPlatDecls.h: make genstubs

	* doc/GetHostName.3:
	* doc/GetOpnFl.3:
	* doc/OpenTcp.3:
	* tcl.decls (Tcl_GetHostName,Tcl_GetOpenFile,Tcl_OpenTcpClient,
	  Tcl_OpenTclServer):
	* mac/tclMacSock.c (CreateSocket,Tcl_OpenTcpClient,Tcl_OpenTcpServer,
	  Tcl_GetHostName,GetHostFromString):
	* unix/tclUnixChan.c (CreateSocket,CreateSocketAddress,
	  Tcl_OpenTcpClient,Tcl_OpenTcpServer,Tcl_GetOpenFile):
	* unix/tclUnixSock.c (Tcl_GetHostName):
	* win/tclWinSock.c (CreateSocket,CreateSocketAddress,
	  Tcl_OpenTcpClient,Tcl_OpenTcpServer,Tcl_GetHostName):
	Updated socket interfaces according to TIP 27.
	* generic/tclCmdIL.c (InfoHostnameCmd): Updated callers.
	* generic/tclDecls.h: make genstubs

2002-01-21  David Gravereaux <davygrvy@@pobox.com>

	* generic/tclLoadNone.c: TclpLoadFile() didn't match proto of
	  typedef Tcl_FSLoadFileProc.  OK'd by vincentdarley.
	  [Patch #502488]

2002-01-21  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIO.c (WriteChars): Fix for SF #506297, reported by
	  Martin Forssen <ruric@@users.sourceforge.net>. The encoding
	  chosen in the script exposing the bug writes out three intro
	  characters when TCL_ENCODING_START is set, but does not consume
	  any input as TCL_ENCODING_END is cleared. As some output was
	  generated the enclosing loop calls UtfToExternal again, again
	  with START set. Three more characters in the out and still no
	  use of input ... To break this infinite loop we remove
	  TCL_ENCODING_START from the set of flags after the first call
	  (no condition is required, the later calls remove an unset flag,
	  which is a no-op). This causes the subsequent calls to
	  UtfToExternal to consume and convert the actual input.

2002-01-21  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclTest.c: Converted declarations of TestReport file system
	  to more portable form.  [Bug 501417].

	* generic/tcl.decls (Tcl_TraceCommand,Tcl_UntraceCommand,
	  Tcl_CommandTraceInfo):
	* generic/tclCmdMZ.c (Tcl_TraceCommand,Tcl_UntraceCommand,
	  Tcl_CommandTraceInfo): Updated APIs in generic/tclCmdMZ.c 
	  according to the guidelines of TIP 27.
	* generic/tclDecls.h: make genstubs

2002-01-18  Don Porter <dgp@@users.sourceforge.net>

	* win/tclWinChan.c:
	* win/tclWinFCmd.c:
	* win/tclWinFile.c: Overlooked callers of Tcl_FSGetNativePath

	* win/tclWinDde.c:
	* win/tclWinReg.c: Overlooked callers of Tcl_GetIndexFromObj

2002-01-18  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclThreadTest.c:
	* mac/tclMacChan.c:
	* mac/tclMacFCmd.c:
	* mac/tclMacFile.c:
	* mac/tclMacLoad.c:
	* mac/tclMacResource.c: TIP 27 CONSTification broke the mac
	  build in a number of places.

2002-01-17  Andreas Kupries  <andreas_kupries@@users.sourceforge.net>

	* generic/tclIOCmd.c (Tcl_GetsObjCmd): Fixed bug #504642 as
	  reported by Brian Griffin <bgriffin@@users.sourceforge.net>,
	  using his patch. Before the patch the generic I/O layer held an
	  unannounced reference to the interp result to store the read
	  line into. This unfortunately has disastrous results if the
	  channel driver executes a tcl script to perform its operation,
	  this freeing the interp result. In that case we are
	  dereferencing essentially a dangling reference. It is not truly
	  dangling because the object is in the free list, but this only
	  causes us to smash the free list and have the error occur later
	  somewhere else. The patch simply creates a new object for the
	  line and later sets it into the interp result when we are done
	  with reading.
d7362 2
a7363 192
2002-01-16  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/tcl.m4 (SC_LOAD_TCLCONFIG):
	* win/tcl.m4 (SC_LOAD_TCLCONFIG): Subst TCL_DBGX
	into TCL_STUB_LIB_FILE and TCL_STUB_LIB_FLAG
	variables so that an extension does not need
	to subst TCL_DBGX into its makefile. [Tk Bug 504356]

2002-01-16  Don Porter <dgp@@users.sourceforge.net>

	* doc/FileSystem.3:
	* doc/GetCwd.3:
	* doc/GetIndex.3:
	* generic/tcl.decls (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_GetCwd, Tcl_FSFileAttrStrings, Tcl_FSGetNativePath,
	  Tcl_FSGetTranslatedStringPath):
	* generic/tcl.h (Tcl_FSFileAttrStringsProc):
	* generic/tclFCmd.c (TclFileAttrsCmd):
	* generic/tclIOUtil.c (Tcl_GetCwd,NativeFileAttrStrings,
	  Tcl_FSFileAttrStrings,Tcl_FSGetTranslatedStringPath,
	  Tcl_FSGetNativePath):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObj,Tcl_GetIndexFromObjStruct):
	More TIP 27 updates in tclIOUtil.c and tclIndexObj.c that were
	overlooked before.  [Patch 504671]
	***POTENTIAL INCOMPATIBILITY*** 
	Includes a source incompatibility in the tablePtr arguments of
	the Tcl_GetIndexFromObj* routines.
	* generic/tclDecls.h: make genstubs

	* generic/tclBinary.c (Tcl_BinaryObjCmd):
	* generic/tclClock.c (Tcl_ClockObjCmd):
	* generic/tclCmdAH.c (Tcl_EncodingObjCmd, Tcl_FileObjCmd):
	* generic/tclCmdIL.c (Tcl_InfoObjCmd,Tcl_LsearchObjCmd,Tcl_LsortObjCmd):
	* generic/tclCmdMZ.c (Tcl_TraceObjCmd,Tcl_RegexpObjCmd,Tcl_RegsubObjCmd,
	  Tcl_StringObjCmd,Tcl_SubstObjCmd,Tcl_SwitchObjCmd,
	  TclTraceCommandObjCmd,TclTraceVariableObjCmd):
	* generic/tclCompCmds.c (TclCompileStringCmd):
	* generic/tclEvent.c (Tcl_UpdateObjCmd):
	* generic/tclFileName.c (Tcl_GlobObjCmd):
	* generic/tclIO.c (Tcl_FileEventObjCmd):
	* generic/tclIOCmd.c (Tcl_SeekObjCmd,Tcl_ExecObjCmd,Tcl_SocketObjCmd,
	  Tcl_FcopyObjCmd):
	* generic/tclInterp.c (Tcl_InterpObjCmd,SlaveObjCmd):
	* generic/tclNamesp.c (Tcl_NamespaceObjCmd):
	* generic/tclPkg.c (Tcl_PackageObjCmd):
	* generic/tclTest.c (Tcltest_Init,TestencodingObjCmd,TestgetplatformCmd,
	  TestlocaleCmd,TestregexpObjCmd,TestsaveresultCmd,
	  TestGetIndexFromObjStructObjCmd,TestReportFileAttrStrings):
	* generic/tclTestObj.c (TestindexObjCmd,TeststringObjCmd):
	* generic/tclTimer.c (Tcl_AfterObjCmd):
	* generic/tclVar.c (Tcl_ArrayObjCmd):
	* mac/tclMacFCmd.c (SetFileFinderAttributes):
	* unix/tclUnixChan.c (TclpOpenFileChannel):
	* unix/tclUnixFCmd.c (tclpFileAttrStrings):
	* unix/tclUnixFile.c (TclpObjAccess,TclpObjChdir,TclpObjStat,
	  TclpObjLstat):
	* win/tclWinFCmd.c (tclpFileAttrStrings): Updated callers.

	* doc/RegExp.3:
	* doc/Utf.3:
	* generic/tcl.decls:
	* generic/tclInt.decls:
	* generic/tclRegexp.c:
	* generic/tclUtf.c:  Updated APIs in generic/tclUtf.c and
	generic/tclRegexp.c according to the guidelines of TIP 27.
	[Patch 471509]

	* generic/regc_locale.c (element,cclass):
	* generic/tclCmdMZ.c (Tcl_StringObjCmd):
	* generic/tclFileName.c (TclpGetNativePathType,SplitMacPath):
	* generic/tclIO.c (ReadChars):
	* mac/tclMacLoad.c (TclpLoadFile):
	* win/tclWinFile.c (TclpGetUserHome): Updated callers.

	* generic/tclDecls.h: 
	* generic/tclIntDecls.h: make genstubs

	* doc/ParseCmd.3 (Tcl_ParseVar):
	* generic/tcl.decls (Tcl_ParseVar):
	* generic/tclParse.c (Tcl_ParseVar):
	* generic/tclTest.c (TestparsevarObjCmd): Updated APIs in
	generic/tclParse.c according to the guidelines of TIP 27.  Updated
	callers.  [Patch 501046]
	* generic/tclDecls.h: make genstubs

	* generic/tcl.decls (Tcl_RecordAndEval):
	* generic/tclDecls.h: make genstubs
	* generic/tclHistory.c (Tcl_RecordAndEval): Updated APIs in
	generic/tclHistory.c according to the guidelines of TIP 27.
	[Patch 504091]

	* doc/CrtSlave.3:
	* generic/tcl.decls (Tcl_CreateAlias, Tcl_CreateAliasObj,
	  Tcl_CreateSlave, Tcl_GetAlias, Tcl_GetAliasObj, Tcl_GetSlave):
	* generic/tclInterp.c (Tcl_CreateAlias, Tcl_CreateAliasObj,
	  Tcl_CreateSlave, Tcl_GetAlias, Tcl_GetAliasObj, Tcl_GetSlave):
	Updated APIs in the file generic/tclInterp.c according to the
	guidelines of TIP 27.  [Patch 501371]
	***POTENTIAL INCOMPATIBILITY*** 
	Includes a source incompatibility in the targetCmdPtr arguments of
	the Tcl_GetAlias* routines.

	* generic/tclDecls.h: make genstubs

2002-01-15  Don Porter <dgp@@users.sourceforge.net>

	* doc/SetErrno.3 (Tcl_ErrnoMsg): Corrected documentation for
	Tcl_ErrnoMsg; it takes an integer argument.  Thanks to Georgios
	Petasis.  [Bug 468183]

	* doc/AddErrInfo.3 (Tcl_PosixError):
	* doc/Eval.3 (Tcl_EvalFile):
	* doc/FileSystem.c (Tcl_FSOpenFileChannel,Tcl_FSOpenFileChannelProc):
	* doc/OpenFileChnl.3 (Tcl_OpenFileChannel):
	* doc/SetErrno.3 (Tcl_ErrnoId,Tcl_ErrnoMsg):
	* doc/Signal.3 (Tcl_SignalId,Tcl_SignalMsg):
	* generic/tcl.decls (Tcl_ErrnoId,TclErrnoMsg,Tcl_EvalFile,
	  Tcl_OpenFileChannel,Tcl_PosixError,Tcl_SignalId,Tcl_SignalMsg,
	  Tcl_FSOpenFileChannel):
	* generic/tcl.h (Tcl_FSOpenFileChannelProc):
	* generic/tclIO.c (FlushChannel):
	* generic/tclIOUtil.c (Tcl_OpenFileChannel,Tcl_EvalFile,TclGetOpenMode,
	  Tcl_PosixError,Tcl_FSOpenFileChannel):
	* generic/tclInt.decls (TclGetOpenMode):
	* generic/tclInt.h (TclOpenFileChannelProc_,TclGetOpenMode,
	  TclpOpenFileChannel):
	* generic/tclPipe.c (TclCleanupChildren):
	* generic/tclPosixStr.c (Tcl_ErrnoId,Tcl_ErrnoMsg,Tcl_SignalId,
	  Tcl_SignalMsg):
	* generic.tclTest.c (PretendTclpOpenFileChannel,
	  TestOpenFileChannelProc1,TestOpenFileChannelProc2,
	  TestOpenFileChannelProc3,TestReportOpenFileChannel):
	* mac/tclMacChan.c (TclpOpenFileChannel):
	* unix/tclUnixChan.c (TclpOpenFileChannel):
	* win/tclWinChan.c (TclpOpenFileChannel): Updated APIs in
	  generic/tclIOUtil.c and generic/tclPosixStr.c according to the
	  guidelines of TIP 27.  Updated callers.  [Patch 499196]

	* generic/tclDecls.h:
	* generic/tclIntDecls.h: make genstubs

	* doc/CrtChannel.3:
	* doc/OpenFileChnl.3:
	* generic/tcl.decls:
	* generic/tclIO.h:
	* generic/tclIO.c (DoWrite, Tcl_RegisterChannel, Tcl_GetChannel,
	  Tcl_CreateChannel, Tcl_GetChannelName, CloseChannel, Tcl_Write,
	  Tcl_WriteRaw, Tcl_Ungets, Tcl_BadChannelOption, Tcl_GetChannelOption,
	  Tcl_SetChannelOption, Tcl_GetChannelNamesEx, Tcl_ChannelName):
	Updated APIs in the file generic/tclIO.c according to the guidelines
	of TIP 27.  Several minor documentation corrections as well.
	[Patch 503565]
	* generic/tclDecls.h: make genstubs

	* generic/tcl.h (Tcl_DriverOutputProc, Tcl_DriverGetOptionProc,
	  Tcl_DriverSetOptionProc):
	* generic/tclIOGT.c (TransformOutputProc, TransformGetOptionProc,
	  TransformSetOptionProc):
	* mac/tclMacChan.c (FileOutput, StdIOOutput):
	* man/tclMacSock.c (TcpGetOptionProc, TcpOutput):
	* unix/tclUnixChan.c (FileOutputProc, TcpGetOptionProc, TcpOutputProc,
	  TtyGetOptionProc, TtySetOptionProc):
	* unix/tclUnixPipe.c (PipeOuputProc):
	* win/tclWinChan.c (FileOutputProc):
	* win/tclWinConsole.c (ConsleOutputProc):
	* win/tclWinPipe.c (PipeOuputProc):
	* win/tclWinSerial.c (SerialOutputProc, SerialGetOptionProc,
	  SerialSetOptionProc):
	* win/tclWinSock.c (TcpGetOptionProc, TcpOutput): Updated channel
	driver interface according to the guidelines of TIP 27.  See also
	[Bug 500348].

	* doc/CrtChannel.3:
	* generic/tcl.h:
	* generic/tclIO.c:
	* generic/tclIO.h:
	* generic/tclInt.h:
	* tools/checkLibraryDoc.tcl:
	Moved Tcl_EolTranslation enum declaration from generic/tcl.h to
	generic/tclInt.h (renamed to TclEolTranslation).  It is not used
	anywhere in Tcl's public interface.

2002-01-14  Don Porter <dgp@@users.sourceforge.net>

	* doc/GetIndex.3:
	* doc/WrongNumArgs.3:
	* generic/tcl.decls (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_WrongNumArgs):
	* generic/tclIndexObj.c (Tcl_GetIndexFromObj, Tcl_GetIndexFromObjStruct,
	  Tcl_WrongNumArgs):  Updated APIs in the file generic/tclIndexObj.c
	according to the guidelines of TIP 27.  [Patch 501491]
	* generic/tclDecls.h: make genstubs
d7365 2
a7366 1
2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d7368 1
a7368 5
	* unix/configure: Regen.
	* unix/configure.in:
	* win/configure: Regen.
	* win/configure.in: Use ${libdir} instead of ${exec_prefix}/lib
	to properly support the --libdir option to configure. [Bug 489370]
d7370 8
a7377 1
2002-01-11  Andreas Kupries  <andreas_kupries@@users.sourceforge.net> 
d7379 1
a7379 12
	* win/tclWinSerial.c (SerialSetOptionProc): Applied patch for SF
	  bug #500348 supplied by Rolf Schroedter
	  <schroedter@@users.sourceforge.net>. The function modified the
	  contents of the the 'value' string and now does not do this
	  anymore. This is a followup to the change made on 2001-12-17.

2002-01-11  David Gravereaux <davygrvy@@pobox.com>

	* win/makefile.vc: Removed -GD compiler option.  It was intended
	for future use, but MS is again changing the future at their whim.
	The D4002 warning was harmless though, but someone using VC .NET
	logged it as a concern.  [Bug #501565]
d7381 3
a7383 1
2002-01-11  Mo DeJong  <mdejong@@users.sourceforge.net>
d7385 2
a7386 161
	* unix/Makefile.in: Burn Tcl build directory
	into tcltest executable to avoid crashes caused
	by ld loading a previously installed version
	of the tcl shared library. [Bug 218110]

2002-01-10  Don Porter <dgp@@users.sourceforge.net>,
	Kevin Kenny <kennykb@@users.sourceforge.net>
	
	* unix/tclLoadDld.c (TclpLoadFile):  syntax error: unbalanced
	parens.  Kevin notes that it's far from clear that this file is
	ever included in an actual build; Linux without dlopen appears to
	be a nonexistent configuration.
	
2002-01-08  Don Porter <dgp@@users.sourceforge.net>,
	Kevin Kenny <kennykb@@users.sourceforge.net>

	* doc/StaticPkg.3 (Tcl_StaticPackage):
	* generic/tcl.decls (Tcl_StaticPackage):
	* generic/tclDecls.h (Tcl_StaticPackage):
	* generic/tclInt.decls (TclGuessPackageName):
	* generic/tclInt.h (TclGuessPackageName):
	* generic/tclLoad.c (Tcl_StaticPackage):
	* generic/tclLoadNone.c (TclGuessPackageName):
	* mac/tclMacLoad.c (TclGuessPackageName):
	* unix/tclLoadAout.c (TclGuessPackageName):
	* unix/tclLoadDl.c (TclGuessPackageName):
	* unix/tclLoadDld.c (TclGuessPackageName):
	* unix/tclLoadDyld.c (TclGuessPackageName):
	* unix/tclLoadNext.c (TclGuessPackageName):
	* unix/tclLoadOSF.c (TclGuessPackageName):
	* unix/tclLoadShl.c (TclGuessPackageName):
	* win/tclWinLoad.c (TclGuessPackageName):  Updated APIs in 
	the files */tcl*Load*.c according to the guidelines of TIP 27.
	[Patch 501096]

2002-01-09  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclTest.c (MainLoop):
	* tests/main.test (Tcl_Main-1.{3,4,5,6}):  Corrected some non-portable
	tests from the new Tcl_Main changes.  Thanks to Kevin Kenny.

2002-01-07  Don Porter <dgp@@users.sourceforge.net>

	* generic/tclEvent.c (TclInExit):
	* generic/tclIOUtil.c (SetFsPathFromAbsoluteNormalized,
	  SetFsPathFromAny,Tcl_FSNewNativePath,DupFsPathInternalRep):
	* generic/tclListObj.c (TclLsetList,TclLsetFlat):  Added some type
	casts to satisfy picky compilers.

	* generic/tclMain.c:  Bug fix: neglected the NULL case in
	TclGetStartupScriptFileName().  Broke Tk/wish.

2002-01-05  Don Porter <dgp@@users.sourceforge.net>

	* doc/Tcl_Main.3:
	* generic/tclMain.c:  Substantial rewrite and expanded documentation
	of Tcl_Main to correct a number of bugs and flaws:

		* Interactive Tcl_Main can now enter a main loop, exit
		  that loop and continue interactive operations.  The loop
		  may even exit in the midst of interactive command typing
		  without loss of the partial command.  [Bugs 486453, 474131]
		* Tcl_Main now gracefully handles deletion of its master
		  interpreter.
		* Interactive Tcl_Main can now operate with non-blocking stdin
		* Interactive Tcl_Main can now detect EOF on stdin even in
		  mid-command.  [Bug 491341]
		* Added VFS-aware internal routines for managing the
		  startup script selection.
		* Tcl variable 'tcl_interactive' is now linked to C variable
		  'tty' so that one can disable/enable interactive prompts
		  at the script level when there is no startup script.  This
		  is meant for use by the test suite.
		* Consistent use of the Tcl libraries standard channels as
		  returned by Tcl_GetStdChannel(); as opposed to the channels
		  named 'stdin', 'stdout', and 'stderr' in the master interp,
		  which can be different or unavailable.
		* Tcl_Main now calls Tcl_Exit() if evaluation of [exit] in the
		  master interpreter returns, assuring Tcl_Main does not return.
		* Documented Tcl_Main's absence from public stub table
		* Documented that Tcl_Main does not return.
		* Documented Tcl variables set by Tcl_Main.
		* All prompts are done from a single procedure, Prompt.
		* Use of Tcl_Obj-enabled interfaces everywhere.

	* generic/tclInt.decls (TclGetStartupScriptPath,
	  TclSetStartupScriptPath): New internal VFS-aware routines for
	managing the startup script of Tcl_Main.
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c: make genstubs

	* generic/tclTest.c (TestsetmainloopCmd,TestexitmainloopCmd,
	  Tcltest_Init,TestinterpdeleteCmd):
	* tests/main.test (new):  Added new file to test suite that
	thoroughly tests generic/tclMain.c; added some new test commands
	for testing Tcl_SetMainLoop().

2002-01-04  Don Porter <dgp@@users.sourceforge.net>

	* doc/Alloc.3:
	* doc/Concat.3:
	* doc/CrtMathFnc.3:
	* doc/Hash.3:
	* doc/Interp.3:
	* doc/LinkVar.3:
	* doc/ObjectType.3:
	* doc/PkgRequire.3:
	* doc/Preserve.3:
	* doc/SetResult.3:
	* doc/SplitList.3:
	* doc/SplitPath.3:
	* doc/TCL_MEM_DEBUG.3: Updated documentation to describe the ckalloc,
	ckfree, ckrealloc, attemptckalloc, and attemptckrealloc macros, and
	to accurately describe when and how they are used.  [Bug 497459]

	* generic/tclThreadJoin.c (TclRememberJoinableThread,TclJoinThread):
	Replaced Tcl_Alloc and Tcl_Free calls with ckalloc and ckfree so that
	memory debugging is supported.

2002-01-04  Daniel Steffen <das@@users.sourceforge.net>

	* mac/tclMacTime.c (TclpGetTZName): fix for daylight savings TZName bug

2002-01-03  Don Porter <dgp@@users.sourceforge.net>

	* doc/FileSystem.3:
	* generic/tclIOUtil.c: Updated some old uses of "fileName" to
	new VFS terminology, "pathPtr".

2002-01-03  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/basic.test (basic-39.4): Greatly simplified test while
	still leaving it so that it crashes when run without the fix to
	the [foreach] implementation.
	* generic/tclCmdAH.c (Tcl_ForeachObjCmd): Stopped Bug #494348 from
	happening by not trying to be so clever with cacheing; if nothing
	untoward is happening anyway, the less efficient technique will
	only add a few instruction cycles (one function call and a few
	derefs/assigns per list per iteration, with no change in the
	number of tests) and if something odd *is* going on, the code is
	now far more robust.

	* tests/basic.test (basic-39.4): Reproducable script from Bug #494348

2002-01-02  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tests/util.test (Wrapper_Tcl_StringMatch,util-5.*): Rewrote so
	the test is performed with the right internal function since
	[string match] no longer uses Tcl_StringCaseMatch internally.

	* tests/string.test (string-11.51):
	* generic/tclUtf.c (Tcl_UniCharCaseMatch):
	* generic/tclUtil.c (Tcl_StringCaseMatch): Fault with matching
	case-insensitive non-ASCII patterns containing upper case
	characters.  [Bug #233257]

	******************************************************************
	*** CHANGELOG ENTRIES FOR 2001 IN "ChangeLog.2001"             ***
	*** CHANGELOG ENTRIES FOR 2000 IN "ChangeLog.2000"             ***
	*** CHANGELOG ENTRIES FOR 1999 AND EARLIER IN "ChangeLog.1999" ***
	******************************************************************
@


1.1.1.9
log
@import tcl 8.4.1
@
text
@a0 358
2002-10-22  Jeff Hobbs  <jeffh@@ActiveState.com>

	*** 8.4.1 TAGGED FOR RELEASE ***

	* changes: updated for 8.4.1 release

	* win/Makefile.in: removed @@MEM_DEBUG_FLAGS@@ subst.
	* win/configure: regen
	* win/configure.in: removed SC_ENABLE_MEMDEBUG call
	* win/tcl.m4: replaced SC_ENABLE_MEMDEBUG with a more intelligent
	SC_ENABLE_SYMBOLS that takes yes|no|mem|compile|all as options now.

2002-10-22  Daniel Steffen  <das@@users.sourceforge.net>

	* library/auto.tcl (tcl_findLibrary):
	* library/package.tcl (tclPkgUnknown): on macosx, search inside the
	Resources/Scripts subdirectory of any potential package directory
	* macosx/Tcl.pbproj/project.pbxproj: add standard Frameworks dirs
	to TCL_PACKAGE_PATH make argument.
	* unix/tclUnixInit.c (TclpSetVariables): on macosx, add embedded
	framework dirs to tcl_pkgPath: @@executable_path/../Frameworks and
	@@executable_path/../PrivateFrameworks (if they exist), as well as
	the dirs in DYLD_FRAMEWORK_PATH (if set). [Patch #624509]
	use standard MAXPATHLEN instead of literal 1024

2002-10-22  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/StringObj.3, doc/Object.3: Documented that Tcl_Obj's
	standard string form is a modified UTF-8; apparently, this was not
	mentioned anywhere in the main docs, and lead to [Bug 624919].

2002-10-21  Daniel Steffen  <das@@users.sourceforge.net>

	* macosx/Tcl.pbproj/project.pbxproj: bumped version to 8.4.1
	* generic/tcl.h: Added reminder comment to edit
	macosx/Tcl.pbproj/project.pbxproj when version number changes.

2002-10-18  Jeff Hobbs  <jeffh@@ActiveState.com>

	* library/reg/pkgIndex.tcl:
	* win/configure:
	* win/configure.in:
	* win/Makefile.in:
	* win/makefile.vc:
	* win/makefile.bc:    Updated to reg1.1

	* doc/registry.n:      Added support for broadcasting changes to
	* tests/registry.test: the registry Environment. Noted proper code
	* win/tclWinReg.c:     in the docs. [Patch #625453]

	* unix/Makefile.in (dist): add any mac/tcl*.sea.hqx files

2002-10-17  Don Porter  <dgp@@users.sourceforge.net>

	* generic/tclVar.c:	Fixed code that check for proper # of args to
	* tests/var.test:	[array names].  Added test.  [Bug 624755]

2002-10-16  Jeff Hobbs  <jeffh@@ActiveState.com>

	* win/configure:                 add workaround for cygwin windres
	* win/tcl.m4 (SC_CONFIG_CFLAGS): problem. [Patch #624010] (howell)

2002-10-15  Jeff Hobbs  <jeffh@@ActiveState.com>

	* README: added archives.tcl.tk note

	* unix/configure:
	* unix/tcl.m4: Correct AIX-5 ppc build flags.
	Correct HP 11 64-bit gcc building. [Patch #601051] (martin)

2002-10-15  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* generic/tclCmdMZ.c:
	* tests/trace.test: applied patch from Hemang Levana to fix
	[Bug #615043] in execution traces with idle tasks firing.

2002-10-14  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclEnv.c (Tcl_PutEnv): correct possible mem leak.
	[Patch #623269] (brouwers)

2002-10-11  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* generic/tcl.h: Need a different strategy through the maze of
	#defines to let people building with Cygwin build correctly.  Also
	made some comments less misleading...

2002-10-10  Jeff Hobbs  <jeffh@@ActiveState.com>

	* README: fixed minor nits [Bug #607776] (virden)

	* win/configure:
	* win/tcl.m4: enable USE_THREAD_ALLOC (new threaded allocator) by
	default in cygwin configure on Windows.

2002-10-10  Don Porter  <dgp@@users.sourceforge.net>

	* doc/Tcl.n:	Clarified that namespace separators are legal in
			the variable names during $-subtitution. [Bug 615139]
	
	* doc/regexp.n:	Typo correction.  Thanks Ronnie Brunner. [Bug 606826]

2002-10-10  Vince Darley  <vincentdarley@@users.sourceforge.net>

	* unix/tclLoadAout.c
	* unix/tclLoadDl.c
	* unix/tclLoadDld.c
	* unix/tclLoadDyld.c
	* unix/tclLoadNext.c
	* unix/tclLoadOSF.c
	* unix/tclLoadShl.c
	* win/tclWinLoad.c: allow either full paths or simply dll names
	to be specified when loading files (the latter will be looked
	up by the OS on your PATH/LD_LIBRARY_PATH as appropriate).
	Fixes [Bug 611108]

2002-10-09  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/README: doc'ed --enable-symbols options.
	* unix/Makefile.in: removed @@MEM_DEBUG_FLAGS@@ subst.
	* unix/configure: regen
	* unix/configure.in: removed SC_ENABLE_MEMDEBUG call
	* unix/tcl.m4: replaced SC_ENABLE_MEMDEBUG with a more intelligent
	SC_ENABLE_SYMBOLS that takes yes|no|mem|compile|all as options now.

2002-10-09  Kevin B. Kenny  <kennykb@@acm.org>

	* win/tclWinTime.c: Added code to set an exit handler that
	terminates the thread that calibrates the performance counter, so
	that the thread won't outlive unloading the Tcl DLL. [Tcl bug
	620735].

2002-10-09  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/binary.n: More clarification of [binary scan]'s behaviour.

2002-10-09  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclIntDecls.h: fixed botched regen.

2002-10-09  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tclInt.decls: made TclSetPreInitScript() declaration
	generic as it is used on mac & aqua as well.
	* generic/tclIntDecls.h:
	* generic/tclStubInit.c: regen.
	* generic/tclCompile.h: added prototype for TclCompileVariableCmd.

	* mac/tclMacPort.h: removed incorrect <fcntl.h> definitions
	and obsolete <stat.h> definitions.
	* mac/tclMacChan.c: removed obsolete GetOpenMode() and replaced 
	associated constants with the <fcntl.h> analogues (they existing
	defs were inconsistent with <fcntl.h> which was causing havoc when
	Tcl_GetOpenMode was used instead of private GetOpenMode).

	* mac/tclMacFCmd.c: removed GenerateUniqueName(), use equivalent
	(and identiaclly named) routine from MoreFiles instead.

	* mac/tclMacLoad.c: CONSTification, fixes to Vince's last changes.

	* mac/tclMacFile.c: 
	* mac/tclMacTest.c:
	* mac/tclMacUnix.c: CONSTification.

	* mac/tclMacOSA.c: CONSTificcation, sprintf fixes, UH 3.4.x changes;
	fix for missing autoname token from TclOSACompileCmd. (bdesgraupes)
	* mac/AppleScript.html(AppleScript delete): doc fix. (bdesgraupes)

	* mac/tcltkMacBuildSupport.sea.hqx: updated MoreFiles to 1.5.3, 
	updated build instructions for 8.4.
	* mac/tclMacProjects.sea.hqx: rebuilt archive.

2002-10-09  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/Alloc.3: Added a note to mention that attempting to allocate
	a zero-length block can return NULL.  [Tk bug 619544]

2002-10-04  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/binary.n: Doc improvements [Patch 616480]

	* tests/fCmd.test, tests/winFCmd.test:
	* tools/eolFix.tcl, tools/genStubs.tcl: [file exist] -> [file exists]
	Thanks to David Welton.

2002-10-03  Don Porter  <dgp@@users.sourceforge.net>

	* doc/tcltest.n: fixed typo [Bug 618018].  Thanks to "JJM".

2002-10-03  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* tools/man2help2.tcl: 
	* tests/http.test, tests/httpd, tests/httpold.test: 
	* tests/env.test, tests/binary.test, tests/autoMkindex.test: 
	* library/init.tcl, library/http/http.tcl: [info exist] should
	really be [info exists].  [Bug 602566]

	* doc/lsearch.n: Better specification of what happens when -sorted
	is mixed with other options. [Bug 617816]

2002-10-01  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclProc.c (TclCreateProc): mask out VAR_UNDEFINED for
	precompiled locals to support 8.3 precompiled code.
	(Tcl_ProcObjCmd): correct 2002-09-26 fix to look for tclProcBodyType.

2002-10-01  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* doc/socket.n: Mentioned that ports may be specified as serivce
	names as well as integers. [Bug 616843]

2002-09-30  Jeff Hobbs  <jeffh@@ActiveState.com>

	* generic/tclCompCmds.c (TclCompileRegexpCmd): correct the
	checking for bad re's that didn't terminate the re string.
	Resultant compiles were correct, but much slower than necessary.

2002-09-29  David Gravereaux <davygrvy@@pobox.com>

	* win/tclAppInit.c: Added proper exiting conditions using Win32
	console signals.  This handles the existing lack of a Ctrl+C exit
	to call exit handlers when built for thread support.  Also, properly
	handles exits from other conditions such as CTRL_CLOSE_EVENT,
	CTRL_LOGOFF_EVENT, and CTRL_SHUTDOWN_EVENT signals.  In all cases,
	exit handlers will be called.  [Bug 219355]

	* win/makefile.vc: Added missing tclThreadAlloc.c to the build
	rules and defines USE_THREAD_ALLOC when TCL_THREADS is defined
	to get the new behavior by default.

2002-09-27  Don Porter  <dgp@@users.sourceforge.net>

	* README:		Bumped to version 8.4.1 to avoid confusion
	* generic/tcl.h:	of CVS snapshots with the actual 8.4.0
	* tools/tcl.wse.in:	release.
	* unix/configure.in:
	* unix/tcl.spec:
	* win/configure.in:

	* unix/configure:	autoconf
	* win/configure:

2002-09-26  Jeff Hobbs  <jeffh@@ActiveState.com>

	* unix/configure: regen.
	* unix/tcl.m4: improve AIX-4/5 64bit compilation support.

	* generic/tclProc.c (Tcl_ProcObjCmd): correct overeager
	optimization of noop proc to handle the precompiled case. (sofer)

	* unix/ldAix (nmopts): add -X32_64 to make it work for 32 or 64bit
	mode compilation.

	* library/encoding/koi8-u.enc: removed extraneous spaces that
	confused encoding reader. [Bug #615115]

	* unix/Makefile.in: generate source dists with -src designator and
	do not generate .Z anymore (just .gz and .zip).

2002-09-18  Mumit Khan <khan@@nanotech.wisc.edu>

	Added basic Cygwin support.

	* win/tcl.m4 (SC_PATH_TCLCONFIG): Support one-tree build.
	(SC_PATH_TKCONFIG): Likewise.
	(SC_PROG_TCLSH): Likewise.
	(SC_CONFIG_CFLAGS): Assume real Cygwin port and remove -mno-cygwin 
	flags.  Add -mwin32 to extra_cflags and extra_ldflags.
	Remove ``-e _WinMain@@16'' from LDFLAGS_WINDOW.
	* win/configure.in: Allow Cygwin build.
	(SEH test): Define to be 1 instead of empty value.
	(EXCEPTION_DISPOSITION): Add test.
	* win/configure: Regenerate.

	* generic/tcl.h: Don't explicitly define __WIN32__ for Cygwin, let
	the user decide whether to use Windows or POSIX personality.
	(TCL_WIDE_INT_TYPE, TCL_LL_MODIFIER, struct Tcl_StatBuf): Define
	for Cygwin.
	* generic/tclEnv.c (Tcl_CygwinPutenv): putenv replacement for
	Cygwin.
	* generic/tclFileName.c (Tcl_TranslateFileName): Convert POSIX 
	to native format.
	(TclDoGlob): Likewise.
	* generic/tclPlatDecls.h (TCHAR): Define for Cygwin.
	* win/tclWinPort.h (putenv, TclpSysAlloc, TclpSysFree, 
	TclpSysRealloc): Define for Cygwin.

2002-09-26  Daniel Steffen  <das@@users.sourceforge.net>

	* macosx/Makefile: preserve environment value of INSTALL_ROOT.
	When embedding only use deployment build. Force relink before
	embedded build to ensure new linker flags are picked up.

	* macosx/Tcl.pbproj/project.pbxproj: add symbolic links to
	debug lib, stub libs and tclConfig.sh in framework toplevel.
	Configure target dependency fix. Fix to 'clean' action. Added
	private tcl headers to framework. Install tclsh symbolic link.
	Html doc build works when no installed tclsh available. Made
	html doc structure in framework more like in Apple frameworks.

2002-09-24  Donal K. Fellows  <fellowsd@@cs.man.ac.uk>

	* unix/tcl.m4 (SC_TCL_64BIT_FLAGS): Yet more robust 64-bit value
	detection to close [Bug 613117] on more systems.

	* generic/tclCompile.c (TclPrintSource): More CONSTifying.
	* generic/tclExecute.c (EvalStatsCmd): Object-ify to reduce
	warnings.  Thanks to 'CoderX2' on the chat for bringing this to my
	attention...

	* unix/tcl.m4: Forgot to define TCL_WIDE_INT_IS_LONG at the
	appropriate moment.  I believe this is the cause of [Bug 613117]

	* doc/lset.n: Changed 'list' to 'varName' for consistency with
	lappend documentation.  Thanks to Glenn Jackman [Bug 611719]

2002-09-22  Don Porter  <dgp@@users.sourceforge.net>

	* library/tcltest/tcltest.tcl:  Corrected [puts -nonewline] within
	test bodies.  Thanks to Harald Kirsch.  [Bug 612786, Patch 612788]
	Also corrected reporting of body return code.  Thanks to David
	Taback [Bug 611922]
	* library/tcltest/pkgIndex.tcl: Bump to version 2.2.1.
	* tests/tcltest.test: added tests for these bugs.

2002-09-15  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/configure: Regen.
	* unix/tcl.m4 (SC_CONFIG_CFLAGS): Add PEEK_XCLOSEIM
	define under Linux. This is used by Tk to double
	check that an X input context is cleaned up
	before it is closed.

2002-09-12  David Gravereaux <davygrvy@@pobox.com>

	* win/coffbase.txt: Added BLT to the virtual base address
	listings table should BLT's build tools decide to use it.

2002-09-12  Daniel Steffen  <das@@users.sourceforge.net>

	* generic/tcl.h:
	* mac/tclMacApplication.r:
	* mac/tclMacLibrary.r:
	* mac/tclMacResource.r: unified use of the two equivalent 
	resource compiler header inclusion defines RC_INVOKED and
	RESOURCE_INCLUDED, now use RC_INVOKED throughout. 

2002-09-10  Mo DeJong  <mdejong@@users.sourceforge.net>

	* unix/README: Add note about building extensions
	with the same compiler Tcl was built with.
	[Tk Bug 592096]

2002-09-10  Daniel Steffen  <das@@users.sourceforge.net>

	* macosx/Tcl.pbproj/project.pbxproj: disabled building html
	documentation during embedded build.

@


